import{r as c,m as W,f as ce,aF as pe,b4 as ue,v as L,b5 as b,j as o,c as g,aR as R,aL as ge,M as he,E as K,_ as X,aK as me,ap as _,aQ as q,ai as Q,aN as fe,aM as xe,N as Y,aO as be,aS as ye}from"./index-BIyIgwS4.js";import{q as ve,A as H,D as Ie,S as je,I as Z,C as we,f as Ce,_ as Fe,P as ze}from"./FileHelper-8inOMdj8-8VXLhO12.js";import{e as Ee}from"./InputInstructions-CWrzjlV--n3Hf1PP9.js";import{p as Re,r as Se}from"./useTextInputAutoExpand-B5nEdsJC-DTKFLxU2.js";import{r as Te}from"./inputUtils-DCYiajnz-DsrlAoKH.js";import{i as Me}from"./ErrorOutline.esm-B7r5abii-8TGLClC0.js";import{t as J}from"./UploadFileInfo-B5SttewO-BfvME59S.js";import"./base-input-GLmTpqXt-CImyaDRq.js";var G=c.forwardRef(function(e,t){var i={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(K,X({iconAttrs:i,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),c.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),c.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 005 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}))});G.displayName="AttachFile";var ee=c.forwardRef(function(e,t){var i={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(K,X({iconAttrs:i,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),c.createElement("rect",{width:24,height:24,fill:"none"}),c.createElement("path",{d:"M3 5.51v3.71c0 .46.31.86.76.97L11 12l-7.24 1.81c-.45.11-.76.51-.76.97v3.71c0 .72.73 1.2 1.39.92l15.42-6.49c.82-.34.82-1.5 0-1.84L4.39 4.58C3.73 4.31 3 4.79 3 5.51z"}))});ee.displayName="Send";const te=(e,t)=>t===b.Directory?{...e,webkitdirectory:"",multiple:!0}:e,De=(e,t)=>{if(!t||t.length===0)return!0;const i=e.name.toLowerCase(),a=i.lastIndexOf(".");if(a===-1||a===i.length-1)return t.some(f=>f===""||f===".");const p=i.substring(a),n=i.substring(a+1);return t.some(f=>{const y=f.toLowerCase();return y.startsWith(".")?p===y:n===y})},Le=(e,t)=>De(e,t)?{isValid:!0}:{isValid:!1,errorMessage:`${e.type||"This type of"} files are not allowed.`},oe=e=>{switch(e){case b.None:return"a file";case b.Single:return"a file";case b.Multiple:return"files";case b.Directory:return"a directory";default:return Y(e),"a file"}},Be=g("div",{target:"e3id6jz12"})(({theme:e,height:t})=>({backgroundColor:e.colors.transparent,position:"absolute",left:0,bottom:0,minHeight:`max(${e.sizes.emptyDropdownHeight}, ${t})`,width:"100%",zIndex:e.zIndices.priority}),""),Ue=g("div",{target:"e3id6jz11"})(({theme:e,height:t})=>({border:`${e.sizes.borderWidth} solid`,borderColor:e.colors.primary,borderRadius:e.radii.chatInput,backgroundColor:e.colors.secondaryBg,color:e.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",height:t,width:"100%",fontWeight:e.fontWeights.bold}),""),He=g("div",{target:"e3id6jz10"})(({theme:e,disabled:t})=>({display:"flex",alignItems:"top",height:"100%",marginTop:`-${e.sizes.borderWidth}`,cursor:t?"not-allowed":"auto"}),""),We=g("div",{target:"e3id6jz9"})(({disabled:e})=>({pointerEvents:e?"none":"auto"}),""),Pe=g("div",{target:"e3id6jz8"})(({theme:e})=>({marginTop:"0.625em",marginLeft:e.spacing.sm,height:e.spacing.xl,width:e.sizes.borderWidth,backgroundColor:e.colors.fadedText20}),""),$e=g("div",{target:"e3id6jz7"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingLeft:e.spacing.sm,paddingRight:e.spacing.sm,overflowX:"auto"}),""),Ne=g("div",{target:"e3id6jz6"})({name:"zjik7",styles:"display:flex"}),ke=g("div",{target:"e3id6jz5"})({name:"ou8xsw",styles:"flex:0 0 auto"}),Ve=g("div",{target:"e3id6jz4"})(({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing.sm,gap:e.spacing.twoXS}),""),Ae=g("div",{target:"e3id6jz3"})(({theme:e})=>({color:e.colors.fadedText60}),""),Oe=g("div",{target:"e3id6jz2"})(({theme:e,fileStatus:t})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:t.type==="uploaded"?e.colors.bodyText:e.colors.fadedText60}),""),Ke=g("div",{target:"e3id6jz1"})(({theme:e})=>({marginRight:e.spacing.md,color:e.colors.fadedText60}),""),Xe=g("small",{target:"e3id6jz0"})(({theme:e})=>({display:"flex",alignItems:"center",maxHeight:e.sizes.smallElementHeight,color:e.colors.fadedText60,"& :hover":{color:e.colors.bodyText}}),""),_e=({getRootProps:e,getInputProps:t,acceptFile:i,disabled:a,theme:p})=>{const n=te(t(),i);return o.jsxs(He,{disabled:a,children:[o.jsxs(We,{"data-testid":"stChatInputFileUploadButton",disabled:a,...e(),children:[o.jsx("input",{...n}),o.jsx(me,{content:`Upload or drag and drop ${oe(i)}`,placement:_.TOP,onMouseEnterDelay:500,children:o.jsx(q,{kind:Q.MINIMAL,disabled:a,children:o.jsx(R,{content:G,size:"lg",color:a?p.colors.fadedText40:p.colors.fadedText60})})})]}),o.jsx(Pe,{})]})},qe=c.memo(_e),Qe=({getRootProps:e,getInputProps:t,acceptFile:i,inputHeight:a})=>{const p=te(t(),i);return o.jsxs(o.Fragment,{children:[o.jsx(Be,{height:a,...e(),children:o.jsx("input",{...p})}),o.jsx(Ue,{height:a,children:`Drag and drop ${oe(i)} here`})]})},Ye=c.memo(Qe);function Ze({children:e,content:t}){const i=W();return o.jsx(ye,{content:t,placement:_.TOP,overrides:{Body:{style:{top:`-${i.sizes.minElementHeight}`}}},children:e})}const Je=({fileInfo:e})=>{const t=W(),{type:i}=e.status;switch(i){case"uploading":return o.jsx(be,{"data-testid":"stChatInputFileIconSpinner",size:"lg",margin:"0",padding:"0"});case"error":return o.jsx(Ze,{content:e.status.errorMessage,children:o.jsx(R,{color:t.colors.redTextColor,content:Me,size:"lg"})});case"uploaded":return o.jsx(R,{content:ze,size:"lg"});default:return Y(i),null}},Ge=({fileInfo:e,onDelete:t})=>o.jsxs(Ve,{className:"stChatInputFile","data-testid":"stChatInputFile",children:[o.jsx(Ae,{children:o.jsx(Je,{fileInfo:e})}),o.jsx(Oe,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:e.name,fileStatus:e.status,children:e.name}),o.jsx(Ke,{children:Ce(e.size,H.Byte)}),o.jsx(Xe,{"data-testid":"stChatInputDeleteBtn",children:o.jsx(q,{onClick:()=>t(e.id),kind:Q.MINIMAL,children:o.jsx(R,{content:Fe,size:"lg"})})})]}),et=c.memo(Ge),tt=({items:e,onDelete:t})=>o.jsx($e,{"data-testid":"stChatUploadedFiles",children:o.jsx(Ne,{children:e.map(i=>o.jsx(ke,{children:o.jsx(et,{fileInfo:i,onDelete:t})},i.id))})}),ot=c.memo(tt),it=(e,t)=>{const i=[],a=[];return e.forEach(p=>{const n=Le(p,t.fileType);n.isValid?i.push(p):a.push({file:p,errors:[{code:Z.FileInvalidType,message:n.errorMessage||"File type not allowed."}]})}),{accepted:i,rejected:a}},rt=({acceptMultipleFiles:e,acceptDirectoryFiles:t,maxFileSize:i,uploadClient:a,uploadFile:p,addFiles:n,getNextLocalFileId:f,deleteExistingFiles:y,onUploadComplete:j,element:v})=>(m,h)=>{if(t&&m.length>0){const{accepted:u,rejected:x}=it(m,v);m=u,h=[...h,...x]}if(!e&&m.length===0&&h.length>1){const u=h.findIndex(x=>x.errors?.[0].code===Z.TooManyFiles);u>=0&&(m.push(h[u].file),h.splice(u,1))}if(!e&&m.length>0&&y(),a.fetchFileURLs(m).then(u=>{ge(u,m).forEach(([x,w])=>{p(x,w)})}).catch(u=>{n(m.map(x=>new J(x.name,x.size,f(),{type:"error",errorMessage:u})))}),h.length>0){const u=h.map(x=>we(x,f(),i));n(u)}j()},st=({getNextLocalFileId:e,addFiles:t,updateFile:i,uploadClient:a,element:p,onUploadProgress:n,onUploadComplete:f})=>(y,j)=>{const v=j.webkitRelativePath||j.name,m=new AbortController,h=new J(v,j.size,e(),{type:"uploading",abortController:m,progress:1});t([h]),a.uploadFile({formId:"",...p},y.uploadUrl,j,u=>n(u,h.id),m.signal).then(()=>f(h.id,y)).catch(u=>{u instanceof DOMException&&u.name==="AbortError"||i(h.id,h.setStatus({type:"error",errorMessage:u?u.toString():"Unknown error"}))})},at=g("div",{target:"e1d2x3se4"})({name:"1nibcdy",styles:"border:none;position:relative;display:flex"}),nt=g("div",{target:"e1d2x3se3"})(({theme:e,extended:t})=>({border:`${e.sizes.borderWidth} solid`,borderColor:e.colors.widgetBorderColor??e.colors.transparent,borderRadius:e.radii.chatInput,backgroundColor:e.colors.secondaryBg,position:"relative",flexGrow:1,display:"flex",alignItems:"center",paddingLeft:e.spacing.lg,maxHeight:t?"none":e.sizes.minElementHeight,gap:e.spacing.sm,overflow:"hidden",":focus-within":{borderColor:e.colors.primary}}),""),lt=g("button",{target:"e1d2x3se2"})(({theme:e,disabled:t,extended:i})=>{const a=he(e),[p,n]=a?[e.colors.gray60,e.colors.gray80]:[e.colors.gray80,e.colors.gray40];return{border:"none",backgroundColor:e.colors.transparent,borderTopRightRadius:i?"0":e.radii.chatInput,borderTopLeftRadius:i?e.radii.default:"0",borderBottomRightRadius:e.radii.chatInput,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:e.lineHeights.none,margin:e.spacing.none,padding:e.spacing.sm,color:t?p:n,pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:a?e.colors.gray10:e.colors.gray90},"&:hover":{color:e.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:e.colors.transparent,borderColor:e.colors.transparent,color:e.colors.gray60,cursor:"not-allowed"}}},""),dt=g("div",{target:"e1d2x3se1"})(({theme:e})=>({display:"flex",alignItems:"flex-end",height:"100%",position:"absolute",right:0,marginBottom:`-${e.sizes.borderWidth}`,pointerEvents:"none"}),""),ct=g("div",{target:"e1d2x3se0"})(({theme:e})=>({position:"absolute",bottom:"0px",right:`calc(${e.iconSizes.xl} + 2 * ${e.spacing.sm} + ${e.spacing.sm})`}),""),B=(e,t,i)=>i.map(a=>a.id===e?t:a),U=(e,t)=>t.find(i=>i.id===e);function pt({disabled:e,element:t,widgetMgr:i,fragmentId:a,uploadClient:p}){const n=W(),{placeholder:f,maxChars:y}=t,j=c.useRef(0),v=c.useRef(null),{width:m,elementRef:h}=ce(),{innerWidth:u,innerHeight:x}=pe(),[w,T]=c.useState(t.default),[F,z]=c.useState([]),[E,M]=c.useState(!1),C=Re({textareaRef:v,dependencies:[f]}),D=c.useMemo(()=>F.some(r=>r.status.type==="uploading")?!1:w!==""||F.length>0,[F,w]),I=ue(t.acceptFile),P=ve(t.maxUploadSizeMb,H.Megabyte,H.Byte),$=c.useCallback(r=>z(l=>[...l,...r]),[]),N=c.useCallback(r=>{z(l=>{const d=U(r,l);return L(d)?l:(d.status.type==="uploading"&&d.status.abortController.abort(),d.status.type==="uploaded"&&d.status.fileUrls.deleteUrl&&p.deleteFile(d.status.fileUrls.deleteUrl),l.filter(s=>s.id!==r))})},[p]),ie=()=>{const r=F.filter(l=>l.status.type==="uploaded").map(l=>{const{name:d,size:s,status:S}=l,{fileId:le,fileUrls:de}=S;return new fe({fileId:le,fileUrls:de,name:d,size:s})});return new xe({uploadedFileInfo:r})},k=()=>j.current++,re=rt({acceptMultipleFiles:I===b.Multiple||I===b.Directory,acceptDirectoryFiles:I===b.Directory,maxFileSize:P,uploadClient:p,uploadFile:st({getNextLocalFileId:k,addFiles:$,updateFile:(r,l)=>{z(d=>B(r,l,d))},uploadClient:p,element:t,onUploadProgress:(r,l)=>{z(d=>{const s=U(l,d);if(L(s)||s.status.type!=="uploading")return d;const S=Math.round(r.loaded*100/r.total);return s.status.progress===S?d:B(l,s.setStatus({type:"uploading",abortController:s.status.abortController,progress:S}),d)})},onUploadComplete:(r,l)=>{z(d=>{const s=U(r,d);return L(s)||s.status.type!=="uploading"?d:B(s.id,s.setStatus({type:"uploaded",fileId:l.fileId,fileUrls:l}),d)})}}),addFiles:$,getNextLocalFileId:k,deleteExistingFiles:()=>F.forEach(r=>N(r.id)),onUploadComplete:()=>{v.current&&v.current.focus()},element:t}),{getRootProps:V,getInputProps:A}=Ie({onDrop:re,multiple:I===b.Multiple||I===b.Directory,accept:je(t.fileType),maxSize:P}),O=()=>{if(v.current&&v.current.focus(),!D||e)return;const r={data:w,fileUploaderState:ie()};i.setChatInputValue(t,r,{fromUi:!0},a),z([]),T(""),C.clearScrollHeight()},se=r=>{const{metaKey:l,ctrlKey:d,shiftKey:s}=r;Te(r)&&!s&&!d&&!l&&(r.preventDefault(),O())},ae=r=>{const{value:l}=r.target;y!==0&&l.length>y||(T(l),C.updateScrollHeight())};c.useEffect(()=>{if(t.setValue){t.setValue=!1;const r=t.value||"";T(r)}},[t]),c.useEffect(()=>{const r=s=>{s.preventDefault(),s.stopPropagation(),!E&&s.dataTransfer?.types.includes("Files")&&M(!0)},l=s=>{s.preventDefault(),s.stopPropagation(),E&&(s.clientX<=0&&s.clientY<=0||s.clientX>=u&&s.clientY>=x)&&M(!1)},d=s=>{s.preventDefault(),s.stopPropagation(),E&&M(!1)};return window.addEventListener("dragover",r),window.addEventListener("drop",d),window.addEventListener("dragleave",l),()=>{window.removeEventListener("dragover",r),window.removeEventListener("drop",d),window.removeEventListener("dragleave",l)}},[E,u,x]);const ne=I!==b.None&&E;return o.jsxs(o.Fragment,{children:[I===b.None?null:o.jsx(ot,{items:[...F],onDelete:N}),o.jsx(at,{className:"stChatInput","data-testid":"stChatInput",ref:h,children:ne?o.jsx(Ye,{getRootProps:V,getInputProps:A,acceptFile:I,inputHeight:C.height}):o.jsxs(nt,{extended:C.isExtended,children:[I===b.None?null:o.jsx(qe,{getRootProps:V,getInputProps:A,acceptFile:I,disabled:e,theme:n}),o.jsx(Se,{inputRef:v,value:w,placeholder:f,onChange:ae,onKeyDown:se,"aria-label":f,disabled:e,rows:1,overrides:{Root:{style:{minHeight:n.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",borderBottomRightRadius:"0",borderBottomLeftRadius:"0"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{fontWeight:n.fontWeights.normal,lineHeight:n.lineHeights.inputWidget,"::placeholder":{color:n.colors.fadedText60},height:C.height,maxHeight:C.maxHeight,paddingLeft:n.spacing.none,paddingBottom:n.spacing.sm,paddingTop:n.spacing.sm,paddingRight:`calc(${n.iconSizes.xl} + 2 * ${n.spacing.sm} + ${n.spacing.sm})`}}}}),m>n.breakpoints.hideWidgetDetails&&o.jsx(ct,{children:o.jsx(Ee,{dirty:D,value:w,maxLength:y,type:"chat",inForm:!1})}),o.jsx(dt,{children:o.jsx(lt,{onClick:O,disabled:!D||e,extended:C.isExtended,"data-testid":"stChatInputSubmitButton",children:o.jsx(R,{content:ee,size:"xl",color:"inherit"})})})]})})]})}const vt=c.memo(pt);export{vt as default};
