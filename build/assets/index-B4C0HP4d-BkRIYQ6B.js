import{r as Re,L as SF,m as PF,e as qB,M as KB,N as IF,O as iC,j as $l,c as ZB,Q as ub,R as nC,y as MF,T as BF,U as Bi,V as RF,W as LF,X as df,Y as _e,Z as zc,_ as YB,$ as DF}from"./index-BIyIgwS4.js";import{p as kF,_ as ms}from"./slicedToArray-CQ1aOJ-Q-fFO-C-TS.js";import{l as $c,p as th,b as G2,a as Ap,y as j2}from"./inherits-BwU0tCO4-DkeIG_qH.js";import{v as OF,d as QB}from"./withFullScreenWrapper-CsmVH3u1-BwamaUTy.js";import{y as FF,X as NF}from"./Toolbar-Dj6ALImb-BVamUnHI.js";import{U as zF}from"./useBasicWidgetState-DH5OpqC3-H5wMmJFo.js";import"./FormClearHelper-DcUb9gFm-uvoV81fq.js";var rC={};function UF(i,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in i)){const o=Object.getOwnPropertyDescriptor(n,r);o&&Object.defineProperty(i,r,o.get?o:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}async function Am(i,t,e,n){return n._parse(i,t,e,n)}function vr(i,t){if(!i)throw new Error(t||"loader assertion failed.")}const Cy=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),sC=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);sC&&parseFloat(sC[1]);const oC=globalThis,aC=globalThis.process||{},VF=globalThis.navigator||{};function JB(i){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function pf(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||JB()}function GF(i){return pf()?JB()?"Electron":(VF.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const $B="4.1.0";function jF(i){try{const t=window[i],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class WF{constructor(t,e,n="sessionStorage"){this.storage=jF(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function HF(i){let t;return i<10?t=`${i.toFixed(2)}ms`:i<100?t=`${i.toFixed(1)}ms`:i<1e3?t=`${i.toFixed(0)}ms`:t=`${(i/1e3).toFixed(2)}s`,t}function XF(i,t=8){const e=Math.max(t-i.length,0);return`${" ".repeat(e)}${i}`}var Og;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Og||(Og={}));const qF=10;function lC(i){return typeof i!="string"?i:(i=i.toUpperCase(),Og[i]||Og.WHITE)}function KF(i,t,e){return!pf&&typeof i=="string"&&(t&&(i=`\x1B[${lC(t)}m${i}\x1B[39m`),e&&(i=`\x1B[${lC(e)+qF}m${i}\x1B[49m`)),i}function ZF(i,t=["constructor"]){const e=Object.getPrototypeOf(i),n=Object.getOwnPropertyNames(e),r=i;for(const o of n){const s=r[o];typeof s=="function"&&(t.find(l=>o===l)||(r[o]=s.bind(i)))}}function W2(i,t){if(!i)throw new Error("Assertion failed")}function Ad(){let i;if(pf()&&oC.performance)i=oC?.performance?.now?.();else if("hrtime"in aC){const t=aC?.hrtime?.();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}const md={debug:pf()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},YF={enabled:!0,level:0};function gd(){}const uC={},cC={once:!0};class Mp{constructor({id:t}={id:""}){this.VERSION=$B,this._startTs=Ad(),this._deltaTs=Ad(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new WF(`__probe-${this.id}__`,YF),this.timeStamp(`${this.id} started`),ZF(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ad()-this._startTs).toPrecision(10))}getDelta(){return Number((Ad()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,md.warn,arguments,cC)}error(t){return this._getLogFunction(0,t,md.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,md.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,md.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,md.debug||md.info,arguments,cC)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||gd,n&&[n],{tag:JF(e)}):gd}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||gd)}group(t,e,n={collapsed:!1}){const r=hC({logLevel:t,message:e,opts:n}),{collapsed:o}=n;return r.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,e,n={}){return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||gd)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=t6(t)}_getLogFunction(t,e,n,r,o){if(this._shouldLog(t)){o=hC({logLevel:t,message:e,args:r,opts:o}),n=n||o.method,W2(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Ad();const s=o.tag||o.message;if(o.once&&s)if(!uC[s])uC[s]=Ad();else return gd;return e=QF(this.id,o.message,o),n.bind(console,e,...o.args)}return gd}}Mp.VERSION=$B;function t6(i){if(!i)return 0;let t;switch(typeof i){case"number":t=i;break;case"object":t=i.logLevel||i.priority||0;break;default:return 0}return W2(Number.isFinite(t)&&t>=0),t}function hC(i){const{logLevel:t,message:e}=i;i.logLevel=t6(t);const n=i.args?Array.from(i.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),i.message=t;break;case"object":Object.assign(i,t);break}typeof i.message=="function"&&(i.message=i.message());const r=typeof i.message;return W2(r==="string"||r==="object"),Object.assign(i,{args:n},i.opts)}function QF(i,t,e){if(typeof t=="string"){const n=e.time?XF(HF(e.total)):"";t=e.time?`${i}: ${n}  ${t}`:`${i}: ${t}`,t=KF(t,e.color,e.background)}return t}function JF(i){for(const t in i)for(const e in i[t])return e||"untitled";return"empty"}globalThis.probe={};const e6=new Mp({id:"@probe.gl/log"}),r_="4.3.3",$F=r_[0]>="0"&&r_[0]<="9"?`v${r_}`:"";function tN(){const i=new Mp({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=i,globalThis.loaders.version=$F,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=i,i}const eN=tN();function i6(i,t){return n6(i||{},t)}function n6(i,t,e=0){if(e>3)return t;const n={...i};for(const[r,o]of Object.entries(t))o&&typeof o=="object"&&!Array.isArray(o)?n[r]=n6(n[r]||{},t[r],e+1):n[r]=t[r];return n}function iN(i){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,i)}function nN(i){return globalThis.loaders?.modules?.[i]||null}const rN="latest";function sN(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const r6=sN();function Yu(i,t){if(!i)throw new Error(t||"loaders.gl assertion failed.")}const Oa=typeof process!="object"||String(process)!=="[object process]"||process.browser,H2=typeof importScripts=="function",oN=typeof window<"u"&&typeof window.orientation<"u",fC=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);fC&&parseFloat(fC[1]);class aN{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,e){this.name=t,this.workerThread=e,this.result=new Promise((n,r)=>{this._resolve=n,this._reject=r})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Yu(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Yu(this.isRunning),this.isRunning=!1,this._reject(t)}}class s_{terminate(){}}const o_=new Map;function lN(i){Yu(i.source&&!i.url||!i.source&&i.url);let t=o_.get(i.source||i.url);return t||(i.url&&(t=uN(i.url),o_.set(i.url,t)),i.source&&(t=s6(i.source),o_.set(i.source,t))),Yu(t),t}function uN(i){if(!i.startsWith("http"))return i;const t=cN(i);return s6(t)}function s6(i){const t=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(t)}function cN(i){return`try {
  importScripts('${i}');
} catch (error) {
  console.error(error);
  throw error;
}`}function o6(i,t=!0,e){const n=e||new Set;if(i){if(dC(i))n.add(i);else if(dC(i.buffer))n.add(i.buffer);else if(!ArrayBuffer.isView(i)&&t&&typeof i=="object")for(const r in i)o6(i[r],t,n)}return e===void 0?Array.from(n):[]}function dC(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const a_=()=>{};class cb{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Oa||typeof s_<"u"&&!Oa}constructor(t){const{name:e,source:n,url:r}=t;Yu(n||r),this.name=e,this.source=n,this.url=r,this.onMessage=a_,this.onError=o=>console.log(o),this.worker=Oa?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=a_,this.onError=a_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||o6(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=lN({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new s_(e,{eval:!1})}else if(this.source)t=new s_(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class hN{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return cb.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(r,o,s)=>r.done(s),n=(r,o)=>r.error(o)){const r=new Promise(o=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:o}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new aN(e.name,t);t.onMessage=r=>e.onMessage(n,r.type,r.payload),t.onError=r=>e.onError(n,r),e.onStart(n);try{await n.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!Oa||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new cb({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return oN?this.maxMobileConcurrency:this.maxConcurrency}}const fN={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Vc{props;workerPools=new Map;static _workerFarm;static isSupported(){return cb.isSupported()}static getWorkerFarm(t={}){return Vc._workerFarm=Vc._workerFarm||new Vc({}),Vc._workerFarm.setProps(t),Vc._workerFarm}constructor(t){this.props={...fN},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:r}=t;let o=this.workerPools.get(e);return o||(o=new hN({name:e,source:n,url:r}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function dN(i,t={}){const e=t[i.id]||{},n=Oa?`${i.id}-worker.js`:`${i.id}-worker-node.js`;let r=e.workerUrl;if(!r&&i.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(Oa?r=`modules/${i.module}/dist/${n}`:r=`modules/${i.module}/src/workers/${i.id}-worker-node.ts`),!r){let o=i.version;o==="latest"&&(o=rN);const s=o?`@${o}`:"";r=`https://unpkg.com/@loaders.gl/${i.module}${s}/dist/${n}`}return Yu(r),r}function pN(i,t=r6){Yu(i,"no worker provided");const e=i.version;return!(!t||!e)}const l_={};async function qh(i,t=null,e={},n=null){return t&&(i=AN(i,t,e,n)),l_[i]=l_[i]||mN(i),await l_[i]}function AN(i,t,e={},n=null){if(!e.useLocalLibraries&&i.startsWith("http"))return i;n=n||i;const r=e.modules||{};return r[n]?r[n]:Oa?e.CDN?(Yu(e.CDN.startsWith("http")),`${e.CDN}/${t}@${r6}/dist/libs/${n}`):H2?`../src/libs/${n}`:`modules/${t}/src/libs/${n}`:`modules/${t}/dist/libs/${n}`}async function mN(i){if(i.endsWith("wasm"))return await yN(i);if(!Oa)try{const{requireFromFile:e}=globalThis.loaders||{};return await e?.(i)}catch(e){return console.error(e),null}if(H2)return importScripts(i);const t=await vN(i);return gN(t,i)}function gN(i,t){if(!Oa){const{requireFromString:n}=globalThis.loaders||{};return n?.(i,t)}if(H2)return eval.call(globalThis,i),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(i))}catch{e.text=i}return document.body.appendChild(e),null}async function yN(i){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};return Oa||!t||i.startsWith("http")?await(await fetch(i)).arrayBuffer():await t(i)}async function vN(i){const{readFileAsText:t}=globalThis.loaders||{};return Oa||!t||i.startsWith("http")?await(await fetch(i)).text():await t(i)}const Lc={};function _N(i,t){return!Vc.isSupported()||!Oa&&!t?._nodeWorkers?!1:i.worker&&t?.worker}async function bN(i,t,e,n,r){const o=i.id,s=dN(i,e),l=Vc.getWorkerFarm(e).getWorkerPool({name:o,url:s});e=JSON.parse(JSON.stringify(e)),n=JSON.parse(JSON.stringify(n||{}));const c=await l.startJob("process-on-worker",xN.bind(null,r));return c.postMessage("process",{input:t,options:e,context:n}),await(await c.result).result}async function xN(i,t,e,n){switch(e){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:r,input:o,options:s}=n;try{const l=await i(o,s);t.postMessage("done",{id:r,result:l})}catch(l){const c=l instanceof Error?l.message:"unknown error";t.postMessage("error",{id:r,error:c})}break;default:console.warn(`parse-with-worker unknown message ${e}`)}}function wN(i,t=5){return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?pC(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?pC(i,0,t):""}function pC(i,t,e){if(i.byteLength<=t+e)return"";const n=new DataView(i);let r="";for(let o=0;o<e;o++)r+=String.fromCharCode(n.getUint8(t+o));return r}function EN(i){try{return JSON.parse(i)}catch{throw new Error(`Failed to parse JSON from data starting with "${wN(i)}"`)}}function CN(i,t,e){if(e=e||i.byteLength,i.byteLength<e||t.byteLength<e)return!1;const n=new Uint8Array(i),r=new Uint8Array(t);for(let o=0;o<n.length;++o)if(n[o]!==r[o])return!1;return!0}function TN(...i){return SN(i)}function SN(i){const t=i.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),e=t.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(e);let r=0;for(const o of t)n.set(o,r),r+=o.byteLength;return n.buffer}function X2(i,t,e){const n=e!==void 0?new Uint8Array(i).subarray(t,t+e):new Uint8Array(i).subarray(t);return new Uint8Array(n).buffer}function mm(i,t){return vr(i>=0),vr(t>0),i+(t-1)&-4}function PN(i,t,e){let n;if(i instanceof ArrayBuffer)n=new Uint8Array(i);else{const r=i.byteOffset,o=i.byteLength;n=new Uint8Array(i.buffer||i.arrayBuffer,r,o)}return t.set(n,e),e+mm(n.byteLength,4)}async function IN(i){const t=[];for await(const e of i)t.push(e);return TN(...t)}function AC(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}class mC{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=AC(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(AC()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Bp{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:n}=t;let r=this.stats[e];return r||(t instanceof mC?r=t:r=new mC(e,n),this.stats[e]=r),r}}const MN="Queued Requests",BN="Active Requests",RN="Cancelled Requests",LN="Queued Requests Ever",DN="Active Requests Ever",kN={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class a6{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(t={}){this.props={...kN,...t},this.stats=new Bp({id:this.props.id}),this.stats.get(MN),this.stats.get(BN),this.stats.get(RN),this.stats.get(LN),this.stats.get(DN)}scheduleRequest(t,e=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:e},r=new Promise(o=>(n.resolve=o,n));return this.requestQueue.push(n),this.requestMap.set(t,r),this._issueNewRequests(),r}_issueRequest(t){const{handle:e,resolve:n}=t;let r=!1;const o=()=>{r||(r=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort((e,n)=>e.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let ON="";const gC={};function FN(i){for(const t in gC)if(i.startsWith(t)){const e=gC[t];i=i.replace(t,e)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i=`${ON}${i}`),i}function NN(i){return i&&typeof i=="object"&&i.isBuffer}function l6(i){if(NN(i)||i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const t=i;return new TextEncoder().encode(t).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function zN(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const i=window.location?.pathname;return i?.slice(0,i.lastIndexOf("/")+1)||""}function u6(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(t+1):""}function q2(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(0,t):""}function UN(...i){const t=[];for(let o=0;o<i.length;o++)t[o]=i[o];let e="",n=!1,r;for(let o=t.length-1;o>=-1&&!n;o--){let s;o>=0?s=t[o]:(r===void 0&&(r=zN()),s=r),s.length!==0&&(e=`${s}/${e}`,n=s.charCodeAt(0)===SA)}return e=VN(e,!n),n?`/${e}`:e.length>0?e:"."}const SA=47,u_=46;function VN(i,t){let e="",n=-1,r=0,o,s=!1;for(let l=0;l<=i.length;++l){if(l<i.length)o=i.charCodeAt(l);else{if(o===SA)break;o=SA}if(o===SA){if(!(n===l-1||r===1))if(n!==l-1&&r===2){if(e.length<2||!s||e.charCodeAt(e.length-1)!==u_||e.charCodeAt(e.length-2)!==u_){if(e.length>2){const c=e.length-1;let y=c;for(;y>=0&&e.charCodeAt(y)!==SA;--y);if(y!==c){e=y===-1?"":e.slice(0,y),n=l,r=0,s=!1;continue}}else if(e.length===2||e.length===1){e="",n=l,r=0,s=!1;continue}}t&&(e.length>0?e+="/..":e="..",s=!0)}else{const c=i.slice(n+1,l);e.length>0?e+=`/${c}`:e=c,s=!1}n=l,r=0}else o===u_&&r!==-1?++r:r=-1}return e}class GN{fetch;loadOptions;_needsRefresh=!0;props;constructor(t){this.props={...t},this.loadOptions={...t.loadOptions},this.fetch=jN(this.loadOptions)}setProps(t){this.props=Object.assign(this.props,t),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(t=!0){const e=this._needsRefresh;return t&&(this._needsRefresh=!1),e}}function jN(i){const t=i?.fetch;if(t&&typeof t=="function")return(n,r)=>t(n,r);const e=i?.fetch;return e&&typeof e!="function"?n=>fetch(n,e):n=>fetch(n)}class K2 extends GN{static type="template";static testURL=t=>!1}const WN=i=>typeof i=="boolean",OA=i=>typeof i=="function",gm=i=>i!==null&&typeof i=="object",yC=i=>gm(i)&&i.constructor==={}.constructor,HN=i=>!!i&&typeof i[Symbol.iterator]=="function",XN=i=>i&&typeof i[Symbol.asyncIterator]=="function",Af=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,mf=i=>typeof Blob<"u"&&i instanceof Blob,qN=i=>i&&typeof i=="object"&&i.isBuffer,KN=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||gm(i)&&OA(i.tee)&&OA(i.cancel)&&OA(i.getReader),ZN=i=>gm(i)&&OA(i.read)&&OA(i.pipe)&&WN(i.readable),c6=i=>KN(i)||ZN(i);class YN extends Error{constructor(t,e){super(t),this.reason=e.reason,this.url=e.url,this.response=e.response}reason;url;response}const QN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,JN=/^([-\w.]+\/[-\w.+]+)/;function vC(i,t){return i.toLowerCase()===t.toLowerCase()}function $N(i){const t=JN.exec(i);return t?t[1]:i}function _C(i){const t=QN.exec(i);return t?t[1]:""}const h6=/\?.*/;function t9(i){const t=i.match(h6);return t&&t[0]}function Z2(i){return i.replace(h6,"")}function e9(i){if(i.length<50)return i;const t=i.slice(i.length-15);return`${i.substr(0,32)}...${t}`}function Ty(i){return Af(i)?i.url:mf(i)?i.name||"":typeof i=="string"?i:""}function Y2(i){if(Af(i)){const t=i,e=t.headers.get("content-type")||"",n=Z2(t.url);return $N(e)||_C(n)}return mf(i)?i.type||"":typeof i=="string"?_C(i):""}function i9(i){return Af(i)?i.headers["content-length"]||-1:mf(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function f6(i){if(Af(i))return i;const t={},e=i9(i);e>=0&&(t["content-length"]=String(e));const n=Ty(i),r=Y2(i);r&&(t["content-type"]=r);const o=await s9(i);o&&(t["x-first-bytes"]=o),typeof i=="string"&&(i=new TextEncoder().encode(i));const s=new Response(i,{headers:t});return Object.defineProperty(s,"url",{value:n}),s}async function n9(i){if(!i.ok)throw await r9(i)}async function r9(i){const t=e9(i.url);let e=`Failed to fetch resource (${i.status}) ${i.statusText}: ${t}`;e=e.length>100?`${e.slice(0,100)}...`:e;const n={reason:i.statusText,url:i.url,response:i};try{const r=i.headers.get("Content-Type");n.reason=!i.bodyUsed&&r?.includes("application/json")?await i.json():await i.text()}catch{}return new YN(e,n)}async function s9(i){if(typeof i=="string")return`data:,${i.slice(0,5)}`;if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(e=>{const n=new FileReader;n.onload=r=>e(r?.target?.result),n.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5);return`data:base64,${o9(t)}`}return null}function o9(i){let t="";const e=new Uint8Array(i);for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function a9(i){return!l9(i)&&!u9(i)}function l9(i){return i.startsWith("http:")||i.startsWith("https:")}function u9(i){return i.startsWith("data:")}async function bC(i,t){if(typeof i=="string"){const e=FN(i);return a9(e)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(e,t):await fetch(e,t)}return await f6(i)}const xC=new Mp({id:"loaders.gl"});class c9{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class h9{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const d6={fetch:null,mimeType:void 0,nothrow:!1,log:new h9,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Cy,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},f9={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function p6(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state||(i._state={}),i._state}function A6(){const i=p6();return i.globalOptions=i.globalOptions||{...d6},i.globalOptions}function d9(i,t,e,n){return e=e||[],e=Array.isArray(e)?e:[e],p9(i,e),m9(t,i,n)}function p9(i,t){wC(i,null,d6,f9,t);for(const e of t){const n=i&&i[e.id]||{},r=e.options&&e.options[e.id]||{},o=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};wC(n,e.id,r,o,t)}}function wC(i,t,e,n,r){const o=t||"Top level",s=t?`${t}.`:"";for(const l in i){const c=!t&&gm(i[l]),y=l==="baseUri"&&!t,_=l==="workerUrl"&&t;if(!(l in e)&&!y&&!_){if(l in n)xC.warn(`${o} loader option '${s}${l}' no longer supported, use '${n[l]}'`)();else if(!c){const C=A9(l,r);xC.warn(`${o} loader option '${s}${l}' not recognized. ${C}`)()}}}}function A9(i,t){const e=i.toLowerCase();let n="";for(const r of t)for(const o in r.options){if(i===o)return`Did you mean '${r.id}.${o}'?`;const s=o.toLowerCase();(e.startsWith(s)||s.startsWith(e))&&(n=n||`Did you mean '${r.id}.${o}'?`)}return n}function m9(i,t,e){const n={...i.options||{}};return g9(n,e),n.log===null&&(n.log=new c9),EC(n,A6()),EC(n,t),n}function EC(i,t){for(const e in t)if(e in t){const n=t[e];yC(n)&&yC(i[e])?i[e]={...i[e],...t[e]}:i[e]=t[e]}}function g9(i,t){t&&!("baseUri"in i)&&(i.baseUri=t)}function Q2(i){return i?(Array.isArray(i)&&(i=i[0]),Array.isArray(i?.extensions)):!1}function J2(i){vr(i,"null loader"),vr(Q2(i),"invalid loader");let t;return Array.isArray(i)&&(t=i[1],i=i[0],i={...i,options:{...i.options,...t}}),(i?.parseTextSync||i?.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const m6=()=>{const i=p6();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function Rp(i){const t=m6();i=Array.isArray(i)?i:[i];for(const e of i){const n=J2(e);t.find(r=>n===r)||t.unshift(n)}}function y9(){return m6()}const v9=/\.([^.]+)$/;async function _9(i,t=[],e,n){if(!g6(i))return null;let r=CC(i,t,{...e,nothrow:!0},n);if(r)return r;if(mf(i)&&(i=await i.slice(0,10).arrayBuffer(),r=CC(i,t,e,n)),!r&&!e?.nothrow)throw new Error(y6(i));return r}function CC(i,t=[],e,n){if(!g6(i))return null;if(t&&!Array.isArray(t))return J2(t);let r=[];t&&(r=r.concat(t)),e?.ignoreRegisteredLoaders||r.push(...y9()),x9(r);const o=b9(i,r,e,n);if(!o&&!e?.nothrow)throw new Error(y6(i));return o}function b9(i,t,e,n){const r=Ty(i),o=Y2(i),s=Z2(r)||n?.url;let l=null,c="";return e?.mimeType&&(l=c_(t,e?.mimeType),c=`match forced by supplied MIME type ${e?.mimeType}`),l=l||w9(t,s),c=c||(l?`matched url ${s}`:""),l=l||c_(t,o),c=c||(l?`matched MIME type ${o}`:""),l=l||C9(t,i),c=c||(l?`matched initial data ${v6(i)}`:""),e?.fallbackMimeType&&(l=l||c_(t,e?.fallbackMimeType),c=c||(l?`matched fallback MIME type ${o}`:"")),c&&eN.log(1,`selectLoader selected ${l?.name}: ${c}.`),l}function g6(i){return!(i instanceof Response&&i.status===204)}function y6(i){const t=Ty(i),e=Y2(i);let n="No valid loader found (";n+=t?`${u6(t)}, `:"no url provided, ",n+=`MIME type: ${e?`"${e}"`:"not provided"}, `;const r=i?v6(i):"";return n+=r?` first bytes: "${r}"`:"first bytes: not available",n+=")",n}function x9(i){for(const t of i)J2(t)}function w9(i,t){const e=t&&v9.exec(t),n=e&&e[1];return n?E9(i,n):null}function E9(i,t){t=t.toLowerCase();for(const e of i)for(const n of e.extensions)if(n.toLowerCase()===t)return e;return null}function c_(i,t){for(const e of i)if(e.mimeTypes?.some(n=>vC(t,n))||vC(t,`application/x.${e.id}`))return e;return null}function C9(i,t){if(!t)return null;for(const e of i)if(typeof t=="string"){if(T9(t,e))return e}else if(ArrayBuffer.isView(t)){if(TC(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&TC(t,0,e))return e;return null}function T9(i,t){return t.testText?t.testText(i):(Array.isArray(t.tests)?t.tests:[t.tests]).some(e=>i.startsWith(e))}function TC(i,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>S9(i,t,e,n))}function S9(i,t,e,n){if(n instanceof ArrayBuffer)return CN(n,i,n.byteLength);switch(typeof n){case"function":return n(i);case"string":const r=hb(i,t,n.length);return n===r;default:return!1}}function v6(i,t=5){return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?hb(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?hb(i,0,t):""}function hb(i,t,e){if(i.byteLength<t+e)return"";const n=new DataView(i);let r="";for(let o=0;o<e;o++)r+=String.fromCharCode(n.getUint8(t+o));return r}const P9=256*1024;function*I9(i,t){const e=t?.chunkSize||P9;let n=0;const r=new TextEncoder;for(;n<i.length;){const o=Math.min(i.length-n,e),s=i.slice(n,n+o);n+=o,yield r.encode(s)}}const M9=256*1024;function*B9(i,t={}){const{chunkSize:e=M9}=t;let n=0;for(;n<i.byteLength;){const r=Math.min(i.byteLength-n,e),o=new ArrayBuffer(r),s=new Uint8Array(i,n,r);new Uint8Array(o).set(s),n+=r,yield o}}const R9=1024*1024;async function*L9(i,t){const e=t?.chunkSize||R9;let n=0;for(;n<i.size;){const r=n+e,o=await i.slice(n,r).arrayBuffer();n=r,yield o}}function SC(i,t){return Cy?D9(i,t):k9(i)}async function*D9(i,t){const e=i.getReader();let n;try{for(;;){const r=n||e.read();t?._streamReadAhead&&(n=e.read());const{done:o,value:s}=await r;if(o)return;yield l6(s)}}catch{e.releaseLock()}}async function*k9(i,t){for await(const e of i)yield l6(e)}function O9(i,t){if(typeof i=="string")return I9(i,t);if(i instanceof ArrayBuffer)return B9(i,t);if(mf(i))return L9(i,t);if(c6(i))return SC(i,t);if(Af(i))return SC(i.body,t);throw new Error("makeIterator")}const _6="Cannot convert supplied data type";function F9(i,t,e){if(t.text&&typeof i=="string")return i;if(qN(i)&&(i=i.buffer),i instanceof ArrayBuffer){const n=i;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(i)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(i);let n=i.buffer;const r=i.byteLength||i.length;return(i.byteOffset!==0||r!==n.byteLength)&&(n=n.slice(i.byteOffset,i.byteOffset+r)),n}throw new Error(_6)}async function N9(i,t,e){const n=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||n)return F9(i,t);if(mf(i)&&(i=await f6(i)),Af(i)){const r=i;return await n9(r),t.binary?await r.arrayBuffer():await r.text()}if(c6(i)&&(i=O9(i,e)),HN(i)||XN(i))return IN(i);throw new Error(_6)}function b6(i,t){const e=A6(),n=i||e;return typeof n.fetch=="function"?n.fetch:gm(n.fetch)?r=>bC(r,n.fetch):t?.fetch?t?.fetch:bC}function z9(i,t,e){if(e)return e;const n={fetch:b6(t,i),...i};if(n.url){const r=Z2(n.url);n.baseUrl=r,n.queryString=t9(n.url),n.filename=u6(r),n.baseUrl=q2(r)}return Array.isArray(n.loaders)||(n.loaders=null),n}function U9(i,t){if(i&&!Array.isArray(i))return i;let e;if(i&&(e=Array.isArray(i)?i:[i]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...n]:n}return e&&e.length?e:void 0}async function Fg(i,t,e,n){t&&!Array.isArray(t)&&!Q2(t)&&(n=void 0,e=t,t=void 0),i=await i,e=e||{};const r=Ty(i),o=U9(t,n),s=await _9(i,o,e);return s?(e=d9(e,s,o,r),n=z9({url:r,_parse:Fg,loaders:o},e,n||null),await V9(s,i,e,n)):null}async function V9(i,t,e,n){if(pN(i),e=i6(i.options,e),Af(t)){const o=t,{ok:s,redirected:l,status:c,statusText:y,type:_,url:C}=o,I=Object.fromEntries(o.headers.entries());n.response={headers:I,ok:s,redirected:l,status:c,statusText:y,type:_,url:C}}t=await N9(t,i,e);const r=i;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,e,n);if(_N(i,e))return await bN(i,t,e,n,Fg);if(r.parseText&&typeof t=="string")return await r.parseText(t,e,n);if(r.parse)return await r.parse(t,e,n);throw Yu(!r.parseSync),new Error(`${i.id} loader - no parser found and worker is disabled`)}function G9(i){switch(i.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}const PC=100;class j9{schema;options;shape;length=0;rows=null;cursor=0;_headers=[];constructor(t,e){if(this.options=e,this.schema=t,!Array.isArray(t)){this._headers=[];for(const n in t)this._headers[t[n].index]=t[n].name}}rowCount(){return this.length}addArrayRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="array-row-table",this.rows=this.rows||new Array(PC),this.rows[this.length]=t,this.length++}addObjectRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="object-row-table",this.rows=this.rows||new Array(PC),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function x6(i,t){if(!i)throw new Error("null row");const e={};if(t)for(let n=0;n<t.length;n++)e[t[n]]=i[n];else for(let n=0;n<i.length;n++){const r=`column-${n}`;e[r]=i[n]}return e}function w6(i,t){if(!i)throw new Error("null row");if(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=i[t[n]];return e}return Object.values(i)}function W9(i){const t=[];for(let e=0;e<i.length;e++){const n=`column-${e}`;t.push(n)}return t}function H9(i){return Object.keys(i)}const IC=100;class X9{schema;options;length=0;objectRows=null;arrayRows=null;cursor=0;_headers=null;constructor(t,e){if(this.options=e,this.schema=t,t){this._headers=[];for(const n in t)this._headers[t[n].index]=t[n].name}}rowCount(){return this.length}addArrayRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||=W9(t),this.options.shape){case"object-row-table":const n=x6(t,this._headers);this.addObjectRow(n,e);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(IC),this.arrayRows[this.length]=t,this.length++;break}}addObjectRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||=H9(t),this.options.shape){case"array-row-table":const n=w6(t,this._headers);this.addArrayRow(n,e);break;case"object-row-table":this.objectRows=this.objectRows||new Array(IC),this.objectRows[this.length]=t,this.length++;break}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const q9=100;class K9{schema;length=0;allocated=0;columns={};constructor(t,e){this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let e=0;for(const n in this.columns)this.columns[n][this.length]=t[e++];this.length++}addObjectRow(t){this._reallocateColumns();for(const e in t)this.columns[e][this.length]=t[e];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const e in this.schema){const n=this.schema[e];t[n.name]=this.columns[n.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:q9,this.columns={};for(const t in this.schema){const e=this.schema[t],n=e.type||Float32Array,r=this.columns[e.index];if(r&&ArrayBuffer.isView(r)){const o=new n(this.allocated);o.set(r),this.columns[e.index]=o}else r?(r.length=this.allocated,this.columns[e.index]=r):this.columns[e.index]=new n(this.allocated)}}}_pruneColumns(){for(const[t,e]of Object.entries(this.columns))this.columns[t]=e.slice(0,this.length)}}const Z9={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},Y9="TableBatchBuilder";class Ng{schema;options;aggregator=null;batchCount=0;bytesUsed=0;isChunkComplete=!1;lastBatchEmittedMs=Date.now();totalLength=0;totalBytes=0;rowBytes=0;static ArrowBatch;constructor(t,e){this.schema=t,this.options={...Z9,...e}}limitReached(){return!!(this.options?.limit&&this.totalLength>=this.options.limit||this.options?._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const e=this._getTableBatchType();this.aggregator=new e(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const e=this._getTableBatchType();this.aggregator=new e(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),typeof t=="string"&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?t.length*8:Object.keys(t).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;t?.bytesUsed&&(this.bytesUsed=t.bytesUsed);const e=this.aggregator.getBatch();return e.count=this.batchCount,e.bytesUsed=this.bytesUsed,Object.assign(e,t),this.batchCount++,this.aggregator=null,e}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return X9;case"columnar-table":return K9;case"arrow-table":if(!Ng.ArrowBatch)throw new Error(Y9);return Ng.ArrowBatch;default:return j9}}}function E6(i){let t=1/0,e=1/0,n=1/0,r=-1/0,o=-1/0,s=-1/0;const l=i.POSITION?i.POSITION.value:[],c=l&&l.length;for(let y=0;y<c;y+=3){const _=l[y],C=l[y+1],I=l[y+2];t=_<t?_:t,e=C<e?C:e,n=I<n?I:n,r=_>r?_:r,o=C>o?C:o,s=I>s?I:s}return[[t,e,n],[r,o,s]]}function Q9(i,t,e){const n=G9(t.value),r=e||J9(t);return{name:i,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:n}]},nullable:!1,metadata:r}}function J9(i){const t={};return"byteOffset"in i&&(t.byteOffset=i.byteOffset.toString(10)),"byteStride"in i&&(t.byteStride=i.byteStride.toString(10)),"normalized"in i&&(t.normalized=i.normalized.toString()),t}class MC extends Array{enqueue(t){return this.push(t)}dequeue(){return this.shift()}}class $9{_values;_settlers;_closed;constructor(){this._values=new MC,this._settlers=new MC,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const e=this._settlers.dequeue();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.enqueue(t)}next(){if(this._values.length>0){const t=this._values.dequeue();return t instanceof Error?Promise.reject(t):Promise.resolve({value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((t,e)=>{this._settlers.enqueue({resolve:t,reject:e})})}}async function Qu(i,t,e,n){let r,o;!Array.isArray(t)&&!Q2(t)?(r=[],o=t):(r=t,o=e);const s=b6(o);let l=i;return typeof i=="string"&&(l=await s(i)),mf(i)&&(l=await s(i)),Array.isArray(r)?await Fg(l,r,o):await Fg(l,r,o)}const tz="4.3.3",ez=globalThis.loaders?.parseImageNode,fb=typeof Image<"u",db=typeof ImageBitmap<"u",iz=!!ez,pb=Cy?!0:iz;function nz(i){switch(i){case"auto":return db||fb||pb;case"imagebitmap":return db;case"image":return fb;case"data":return pb;default:throw new Error(`@loaders.gl/images: image ${i} not supported in this environment`)}}function rz(){if(db)return"imagebitmap";if(fb)return"image";if(pb)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function sz(i){const t=oz(i);if(!t)throw new Error("Not an image");return t}function C6(i){switch(sz(i)){case"data":return i;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=i.width,t.height=i.height,e.drawImage(i,0,0),e.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function oz(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const az=/^data:image\/svg\+xml/,lz=/\.svg((\?|#).*)?$/;function $2(i){return i&&(az.test(i)||lz.test(i))}function uz(i,t){if($2(t)){let e=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(e=unescape(encodeURIComponent(e)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(e)}`}return T6(i,t)}function T6(i,t){if($2(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function S6(i,t,e){const n=uz(i,e),r=self.URL||self.webkitURL,o=typeof n!="string"&&r.createObjectURL(n);try{return await cz(o||n,t)}finally{o&&r.revokeObjectURL(o)}}async function cz(i,t){const e=new Image;return e.src=i,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((n,r)=>{try{e.onload=()=>n(e),e.onerror=o=>{const s=o instanceof Error?o.message:"error";r(new Error(s))}}catch(o){r(o)}})}const hz={};let BC=!0;async function fz(i,t,e){let n;$2(e)?n=await S6(i,t,e):n=T6(i,e);const r=t&&t.imagebitmap;return await dz(n,r)}async function dz(i,t=null){if((pz(t)||!BC)&&(t=null),t)try{return await createImageBitmap(i,t)}catch(e){console.warn(e),BC=!1}return await createImageBitmap(i)}function pz(i){for(const t in i||hz)return!1;return!0}function Az(i){return!vz(i,"ftyp",4)||(i[8]&96)===0?null:mz(i)}function mz(i){switch(gz(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function gz(i,t,e){return String.fromCharCode(...i.slice(t,e))}function yz(i){return[...i].map(t=>t.charCodeAt(0))}function vz(i,t,e=0){const n=yz(t);for(let r=0;r<n.length;++r)if(n[r]!==i[r+e])return!1;return!0}const eu=!1,FA=!0;function tx(i){const t=ym(i);return bz(t)||Ez(t)||xz(t)||wz(t)||_z(t)}function _z(i){const t=new Uint8Array(i instanceof DataView?i.buffer:i),e=Az(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function bz(i){const t=ym(i);return t.byteLength>=24&&t.getUint32(0,eu)===2303741511?{mimeType:"image/png",width:t.getUint32(16,eu),height:t.getUint32(20,eu)}:null}function xz(i){const t=ym(i);return t.byteLength>=10&&t.getUint32(0,eu)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,FA),height:t.getUint16(8,FA)}:null}function wz(i){const t=ym(i);return t.byteLength>=14&&t.getUint16(0,eu)===16973&&t.getUint32(2,FA)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,FA),height:t.getUint32(22,FA)}:null}function Ez(i){const t=ym(i);if(!(t.byteLength>=3&&t.getUint16(0,eu)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:e,sofMarkers:n}=Cz();let r=2;for(;r+9<t.byteLength;){const o=t.getUint16(r,eu);if(n.has(o))return{mimeType:"image/jpeg",height:t.getUint16(r+5,eu),width:t.getUint16(r+7,eu)};if(!e.has(o))return null;r+=2,r+=t.getUint16(r,eu)}return null}function Cz(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function ym(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function Tz(i,t){const{mimeType:e}=tx(i)||{},n=globalThis.loaders?.parseImageNode;return vr(n),await n(i,e)}async function Sz(i,t,e){t=t||{};const n=(t.image||{}).type||"auto",{url:r}=e||{},o=Pz(n);let s;switch(o){case"imagebitmap":s=await fz(i,t,r);break;case"image":s=await S6(i,t,r);break;case"data":s=await Tz(i);break;default:vr(!1)}return n==="data"&&(s=C6(s)),s}function Pz(i){switch(i){case"auto":case"data":return rz();default:return nz(i),i}}const Iz=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Mz=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Bz={image:{type:"auto",decode:!0}},zg={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:tz,mimeTypes:Mz,extensions:Iz,parse:Sz,tests:[i=>!!tx(new DataView(i))],options:Bz},h_={};function Rz(i){if(h_[i]===void 0){const t=Cy?Dz(i):Lz(i);h_[i]=t}return h_[i]}function Lz(i){const t=["image/png","image/jpeg","image/gif"],e=globalThis.loaders?.imageFormatsNode||t;return!!globalThis.loaders?.parseImageNode&&e.includes(i)}function Dz(i){switch(i){case"image/avif":case"image/webp":return kz(i);default:return!0}}function kz(i){try{return document.createElement("canvas").toDataURL(i).indexOf(`data:${i}`)===0}catch{return!1}}const $i=new Mp({id:"deck"});let Ab={};function Oz(i){Ab=i}function mo(i,t,e,n){$i.level>0&&Ab[i]&&Ab[i].call(null,t,e,n)}function Fz(i){const t=i[0],e=i[i.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const Nz={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Fz,parseTextSync:JSON.parse};function zz(){const i="9.2.2",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==i)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${i}`);return t||($i.log(1,`deck.gl ${i}`)(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:$i,_registerLoggers:Oz},Rp([Nz,[zg,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const Uz=zz();function ex(i,t){if(!i)throw new Error(t||"shadertools: assertion failed.")}const f_={number:{type:"number",validate(i,t){return Number.isFinite(i)&&typeof t=="object"&&(t.max===void 0||i<=t.max)&&(t.min===void 0||i>=t.min)}},array:{type:"array",validate(i,t){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function Vz(i){const t={};for(const[e,n]of Object.entries(i))t[e]=Gz(n);return t}function Gz(i){let t=RC(i);if(t!=="object")return{value:i,...f_[t],type:t};if(typeof i=="object")return i?i.type!==void 0?{...i,...f_[i.type],type:i.type}:i.value===void 0?{type:"object",value:i}:(t=RC(i.value),{...i,...f_[t],type:t}):{type:"object",value:null};throw new Error("props")}function RC(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const jz=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Wz=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,Hz={vertex:jz,fragment:Wz},LC=/void\s+main\s*\([^)]*\)\s*\{\n?/,DC=/}\n?[^{}]*$/,d_=[],dg="__LUMA_INJECT_DECLARATIONS__";function Xz(i){const t={vertex:{},fragment:{}};for(const e in i){let n=i[e];const r=qz(e);typeof n=="string"&&(n={order:0,injection:n}),t[r][e]=n}return t}function qz(i){const t=i.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Ug(i,t,e,n=!1){const r=t==="vertex";for(const o in e){const s=e[o];s.sort((c,y)=>c.order-y.order),d_.length=s.length;for(let c=0,y=s.length;c<y;++c)d_[c]=s[c].injection;const l=`${d_.join(`
`)}
`;switch(o){case"vs:#decl":r&&(i=i.replace(dg,l));break;case"vs:#main-start":r&&(i=i.replace(LC,c=>c+l));break;case"vs:#main-end":r&&(i=i.replace(DC,c=>l+c));break;case"fs:#decl":r||(i=i.replace(dg,l));break;case"fs:#main-start":r||(i=i.replace(LC,c=>c+l));break;case"fs:#main-end":r||(i=i.replace(DC,c=>l+c));break;default:i=i.replace(o,c=>c+l)}}return i=i.replace(dg,""),n&&(i=i.replace(/\}\s*$/,o=>o+Hz[t])),i}function Vg(i){i.map(t=>P6(t))}function P6(i){if(i.instance)return;Vg(i.dependencies||[]);const{propTypes:t={},deprecations:e=[],inject:n={}}=i,r={normalizedInjections:Xz(n),parsedDeprecations:Kz(e)};t&&(r.propValidators=Vz(t)),i.instance=r;let o={};t&&(o=Object.entries(t).reduce((s,[l,c])=>{const y=c?.value;return y&&(s[l]=y),s},{})),i.defaultUniforms={...i.defaultUniforms,...o}}function I6(i,t,e){i.deprecations?.forEach(n=>{n.regex?.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())})}function Kz(i){return i.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),i}function ix(i){Vg(i);const t={},e={};M6({modules:i,level:0,moduleMap:t,moduleDepth:e});const n=Object.keys(e).sort((r,o)=>e[o]-e[r]).map(r=>t[r]);return Vg(n),n}function M6(i){const{modules:t,level:e,moduleMap:n,moduleDepth:r}=i;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const o of t)n[o.name]=o,(r[o.name]===void 0||r[o.name]<e)&&(r[o.name]=e);for(const o of t)o.dependencies&&M6({modules:o.dependencies,level:e+1,moduleMap:n,moduleDepth:r})}function Zz(i){switch(i?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function Yz(i,t){if(Number(i.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return i=kC(i,Qz),i;case"fragment":return i=kC(i,Jz),i;default:throw new Error(t)}}const B6=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Qz=[...B6,[mb("attribute"),"in $1"],[mb("varying"),"out $1"]],Jz=[...B6,[mb("varying"),"in $1"]];function kC(i,t){for(const[e,n]of t)i=i.replace(e,n);return i}function mb(i){return new RegExp(`\\b${i}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function R6(i,t){let e="";for(const n in i){const r=i[n];if(e+=`void ${r.signature} {
`,r.header&&(e+=`  ${r.header}`),t[n]){const o=t[n];o.sort((s,l)=>s.order-l.order);for(const s of o)e+=`  ${s.injection}
`}r.footer&&(e+=`  ${r.footer}`),e+=`}
`}return e}function L6(i){const t={vertex:{},fragment:{}};for(const e of i){let n,r;typeof e!="string"?(n=e,r=n.hook):(n={},r=e),r=r.trim();const[o,s]=r.split(":"),l=r.replace(/\(.+/,""),c=Object.assign(n,{signature:s});switch(o){case"vs":t.vertex[l]=c;break;case"fs":t.fragment[l]=c;break;default:throw new Error(o)}}return t}function $z(i,t){return{name:tU(i,t),language:"glsl",version:eU(i)}}function tU(i,t="unnamed"){const e=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(i);return e?e[1]:t}function eU(i){let t=100;const e=i.match(/[^\s]+/g);if(e&&e.length>=2&&e[0]==="#version"){const n=parseInt(e[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const D6=`

${dg}
`,iU=`precision highp float;
`;function nU(i){const t=ix(i.modules||[]);return{source:sU(i.platformInfo,{...i,source:i.source,stage:"vertex",modules:t}),getUniforms:k6(t)}}function rU(i){const{vs:t,fs:e}=i,n=ix(i.modules||[]);return{vs:OC(i.platformInfo,{...i,source:t,stage:"vertex",modules:n}),fs:OC(i.platformInfo,{...i,source:e,stage:"fragment",modules:n}),getUniforms:k6(n)}}function sU(i,t){const{source:e,stage:n,modules:r,hookFunctions:o=[],inject:s={},log:l}=t;ex(typeof e=="string","shader source must be a string");const c=e;let y="";const _=L6(o),C={},I={},k={};for(const V in s){const X=typeof s[V]=="string"?{injection:s[V],order:0}:s[V],H=/^(v|f)s:(#)?([\w-]+)$/.exec(V);if(H){const $=H[2],Y=H[3];$?Y==="decl"?I[V]=[X]:k[V]=[X]:C[V]=[X]}else k[V]=[X]}const z=r;for(const V of z){l&&I6(V,c,l);const X=O6(V,"wgsl");y+=X;const H=V.injections?.[n]||{};for(const $ in H){const Y=/^(v|f)s:#([\w-]+)$/.exec($);if(Y){const ct=Y[2]==="decl"?I:k;ct[$]=ct[$]||[],ct[$].push(H[$])}else C[$]=C[$]||[],C[$].push(H[$])}}return y+=D6,y=Ug(y,n,I),y+=R6(_[n],C),y+=c,y=Ug(y,n,k),y}function OC(i,t){const{source:e,stage:n,language:r="glsl",modules:o,defines:s={},hookFunctions:l=[],inject:c={},prologue:y=!0,log:_}=t;ex(typeof e=="string","shader source must be a string");const C=r==="glsl"?$z(e).version:-1,I=i.shaderLanguageVersion,k=C===100?"#version 100":"#version 300 es",z=e.split(`
`).slice(1).join(`
`),V={};o.forEach(rt=>{Object.assign(V,rt.defines)}),Object.assign(V,s);let X="";switch(r){case"wgsl":break;case"glsl":X=y?`${k}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${Zz(i)}
${n==="fragment"?iU:""}

// ----- APPLICATION DEFINES -------------------------

${oU(V)}

`:`${k}
`;break}const H=L6(l),$={},Y={},ct={};for(const rt in c){const nt=typeof c[rt]=="string"?{injection:c[rt],order:0}:c[rt],Ot=/^(v|f)s:(#)?([\w-]+)$/.exec(rt);if(Ot){const Kt=Ot[2],ft=Ot[3];Kt?ft==="decl"?Y[rt]=[nt]:ct[rt]=[nt]:$[rt]=[nt]}else ct[rt]=[nt]}for(const rt of o){_&&I6(rt,z,_);const nt=O6(rt,n);X+=nt;const Ot=rt.instance?.normalizedInjections[n]||{};for(const Kt in Ot){const ft=/^(v|f)s:#([\w-]+)$/.exec(Kt);if(ft){const st=ft[2]==="decl"?Y:ct;st[Kt]=st[Kt]||[],st[Kt].push(Ot[Kt])}else $[Kt]=$[Kt]||[],$[Kt].push(Ot[Kt])}}return X+="// ----- MAIN SHADER SOURCE -------------------------",X+=D6,X=Ug(X,n,Y),X+=R6(H[n],$),X+=z,X=Ug(X,n,ct),r==="glsl"&&C!==I&&(X=Yz(X,n)),X.trim()}function k6(i){return function(t){const e={};for(const n of i){const r=n.getUniforms?.(t,e);Object.assign(e,r)}return e}}function oU(i={}){let t="";for(const e in i){const n=i[e];(n||Number.isFinite(n))&&(t+=`#define ${e.toUpperCase()} ${i[e]}
`)}return t}function O6(i,t){let e;switch(t){case"vertex":e=i.vs||"";break;case"fragment":e=i.fs||"";break;case"wgsl":e=i.source||"";break;default:ex(!1)}if(!i.name)throw new Error("Shader module must have a name");const n=i.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${i.name} ---------------

`;return t!=="wgsl"&&(r+=`#define MODULE_${n}
`),r+=`${e}
`,r}const aU=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,lU=/^\s*\#\s*endif\s*$/;function uU(i,t){const e=i.split(`
`),n=[];let r=!0;for(const o of e){const s=o.match(aU),l=o.match(lU);s?(s[1],r=!1):l?r=!0:r&&n.push(o)}return n.join(`
`)}class Gh{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Gh.defaultShaderAssembler=Gh.defaultShaderAssembler||new Gh,Gh.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(e=>e.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==e)}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){const e=this._getModuleList(t.modules),n=this._hookFunctions,{source:r,getUniforms:o}=nU({...t,source:t.source,modules:e,hookFunctions:n});return{source:t.platformInfo.shaderLanguage==="wgsl"?uU(r):r,getUniforms:o,modules:e}}assembleGLSLShaderPair(t){const e=this._getModuleList(t.modules),n=this._hookFunctions;return{...rU({...t,vs:t.vs,fs:t.fs,modules:e,hookFunctions:n}),modules:e}}_getModuleList(t=[]){const e=new Array(this._defaultModules.length+t.length),n={};let r=0;for(let o=0,s=this._defaultModules.length;o<s;++o){const l=this._defaultModules[o],c=l.name;e[r++]=l,n[c]=!0}for(let o=0,s=t.length;o<s;++o){const l=t[o],c=l.name;n[c]||(e[r++]=l,n[c]=!0)}return e.length=r,Vg(e),e}}const cU=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,hU=`#version 300 es
${cU}`;function F6(i){const{input:t,inputChannels:e,output:n}=i||{};if(!t)return hU;if(!e)throw new Error("inputChannels");const r=fU(e),o=dU(t,e);return`#version 300 es
in ${r} ${t};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function fU(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${i}`)}}function dU(i,t){switch(t){case 1:return`vec4(${i}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${i}, 0.0, 1.0)`;case 3:return`vec4(${i}, 1.0)`;case 4:return i;default:throw new Error(`invalid channels: ${t}`)}}class pU{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new Bp({id:t})),this.stats.get(t)}}const N6=new pU,Xe=new Mp({id:"luma.gl"}),p_={};function Sy(i="id"){p_[i]=p_[i]||1;const t=p_[i]++;return`${i}-${t}`}let pr=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(i,t,e){if(!i)throw new Error("no device");this._device=i,this.props=AU(t,e);const n=this.props.id!=="undefined"?this.props.id:Sy(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(i){this._attachedResources.add(i)}detachResource(i){this._attachedResources.delete(i)}destroyAttachedResource(i){this._attachedResources.delete(i)&&i.destroy()}destroyAttachedResources(){for(const i of Object.values(this._attachedResources))i.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const i=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];i.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(i,t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").addCount(i),e.get(`${t} Memory`).addCount(i),this.allocatedBytes=i}trackDeallocatedMemory(i=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${i} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const i=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];i.get("Resources Created").incrementCount(),i.get(`${t}s Created`).incrementCount(),i.get(`${t}s Active`).incrementCount()}};function AU(i,t){const e={...t};for(const n in i)i[n]!==void 0&&(e[n]=i[n]);return e}class br extends pr{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,e){const n={...e};(e.usage||0)&br.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(t,n,br.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createBuffer({...this.props,...t})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,e,n){const r=ArrayBuffer.isView(t)?t.buffer:t,o=Math.min(t?t.byteLength:n,br.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(o):e===0&&n===r.byteLength?this.debugData=r.slice(0,o):this.debugData=r.slice(e,e+o)}static defaultProps={...pr.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}}function z6(i){const[t,e,n]=sx[i],r=i.includes("norm"),o=!r&&!i.startsWith("float"),s=i.startsWith("s");return{signedType:t,primitiveType:e,byteLength:n,normalized:r,integer:o,signed:s}}function mU(i){const t=i;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}function gU(i,t){switch(t){case 1:return i;case 2:return i+i%2;default:return i+(4-i%4)%4}}function nx(i){const t=ArrayBuffer.isView(i)?i.constructor:i;if(t===Uint8ClampedArray)return"uint8";const e=Object.values(sx).find(n=>t===n[4]);if(!e)throw new Error(t.name);return e[0]}function rx(i){const[,,,,t]=sx[i];return t}const sx={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function ox(i){let t;i.endsWith("-webgl")&&(i.replace("-webgl",""),t=!0);const[e,n]=i.split("x"),r=e,o=n?parseInt(n):1,s=z6(r),l={type:r,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(l.webglOnly=!0),l}function yU(i,t,e){const n=e?mU(i):i;switch(n){case"unorm8":return t===1?"unorm8":t===3?"unorm8x3-webgl":`${n}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(t===1||t===3)throw new Error(`size: ${t}`);return`${n}x${t}`;default:return t===1?n:`${n}x${t}`}}function vU(i,t,e){if(!t||t>4)throw new Error(`size ${t}`);const n=t,r=nx(i);return yU(r,n,e)}function _U(i){let t;switch(i.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return i.components<=2?"float16x2":"float16x4"}return i.components===1?t:`${t}x${i.components}`}const ho="texture-compression-bc",dr="texture-compression-astc",Zl="texture-compression-etc2",bU="texture-compression-etc1-webgl",c0="texture-compression-pvrtc-webgl",A_="texture-compression-atc-webgl",h0="float32-renderable-webgl",m_="float16-renderable-webgl",xU="rgb9e5ufloat-renderable-webgl",g_="snorm8-renderable-webgl",mA="norm16-renderable-webgl",y_="snorm16-renderable-webgl",f0="float32-filterable",FC="float16-filterable-webgl";function U6(i){const t=CU[i];if(!t)throw new Error(`Unsupported texture format ${i}`);return t}const wU={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:g_},rg8snorm:{render:g_},"rgb8snorm-webgl":{},rgba8snorm:{render:g_},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:mA},rg16unorm:{render:mA},"rgb16unorm-webgl":{f:mA},rgba16unorm:{render:mA},r16snorm:{f:y_},rg16snorm:{render:y_},"rgb16snorm-webgl":{f:mA},rgba16snorm:{render:y_},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:m_,filter:"float16-filterable-webgl"},rg16float:{render:m_,filter:FC},rgba16float:{render:m_,filter:FC},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:h0,filter:f0},rg32float:{render:!1,filter:f0},"rgb32float-webgl":{render:h0,filter:f0},rgba32float:{render:h0,filter:f0},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:xU},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:h0},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},EU={"bc1-rgb-unorm-webgl":{f:ho},"bc1-rgb-unorm-srgb-webgl":{f:ho},"bc1-rgba-unorm":{f:ho},"bc1-rgba-unorm-srgb":{f:ho},"bc2-rgba-unorm":{f:ho},"bc2-rgba-unorm-srgb":{f:ho},"bc3-rgba-unorm":{f:ho},"bc3-rgba-unorm-srgb":{f:ho},"bc4-r-unorm":{f:ho},"bc4-r-snorm":{f:ho},"bc5-rg-unorm":{f:ho},"bc5-rg-snorm":{f:ho},"bc6h-rgb-ufloat":{f:ho},"bc6h-rgb-float":{f:ho},"bc7-rgba-unorm":{f:ho},"bc7-rgba-unorm-srgb":{f:ho},"etc2-rgb8unorm":{f:Zl},"etc2-rgb8unorm-srgb":{f:Zl},"etc2-rgb8a1unorm":{f:Zl},"etc2-rgb8a1unorm-srgb":{f:Zl},"etc2-rgba8unorm":{f:Zl},"etc2-rgba8unorm-srgb":{f:Zl},"eac-r11unorm":{f:Zl},"eac-r11snorm":{f:Zl},"eac-rg11unorm":{f:Zl},"eac-rg11snorm":{f:Zl},"astc-4x4-unorm":{f:dr},"astc-4x4-unorm-srgb":{f:dr},"astc-5x4-unorm":{f:dr},"astc-5x4-unorm-srgb":{f:dr},"astc-5x5-unorm":{f:dr},"astc-5x5-unorm-srgb":{f:dr},"astc-6x5-unorm":{f:dr},"astc-6x5-unorm-srgb":{f:dr},"astc-6x6-unorm":{f:dr},"astc-6x6-unorm-srgb":{f:dr},"astc-8x5-unorm":{f:dr},"astc-8x5-unorm-srgb":{f:dr},"astc-8x6-unorm":{f:dr},"astc-8x6-unorm-srgb":{f:dr},"astc-8x8-unorm":{f:dr},"astc-8x8-unorm-srgb":{f:dr},"astc-10x5-unorm":{f:dr},"astc-10x5-unorm-srgb":{f:dr},"astc-10x6-unorm":{f:dr},"astc-10x6-unorm-srgb":{f:dr},"astc-10x8-unorm":{f:dr},"astc-10x8-unorm-srgb":{f:dr},"astc-10x10-unorm":{f:dr},"astc-10x10-unorm-srgb":{f:dr},"astc-12x10-unorm":{f:dr},"astc-12x10-unorm-srgb":{f:dr},"astc-12x12-unorm":{f:dr},"astc-12x12-unorm-srgb":{f:dr},"pvrtc-rgb4unorm-webgl":{f:c0},"pvrtc-rgba4unorm-webgl":{f:c0},"pvrtc-rbg2unorm-webgl":{f:c0},"pvrtc-rgba2unorm-webgl":{f:c0},"etc1-rbg-unorm-webgl":{f:bU},"atc-rgb-unorm-webgl":{f:A_},"atc-rgba-unorm-webgl":{f:A_},"atc-rgbai-unorm-webgl":{f:A_}},CU={...wU,...EU},TU=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],SU=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class PU{getInfo(t){return NC(t)}isColor(t){return t.startsWith("rgba")||t.startsWith("bgra")||t.startsWith("rgb")}isDepthStencil(t){return t.startsWith("depth")||t.startsWith("stencil")}isCompressed(t){return TU.some(e=>t.startsWith(e))}getCapabilities(t){const e=U6(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=NC(t),o=t.startsWith("depth")||t.startsWith("stencil"),s=r?.signed,l=r?.integer,c=r?.webgl;return n.render&&=!s,n.filter&&=!o&&!s&&!l&&!c,n}}const np=new PU;function NC(i){let t=IU(i);if(np.isCompressed(i)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=MU(i);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const e=SU.exec(i);if(e){const[,n,r,o,s,l]=e,c=`${o}${r}`,y=z6(c),_=y.byteLength*8,C=n.length,I=[_,C>=2?_:0,C>=3?_:0,C>=4?_:0];t={format:i,attachment:t.attachment,dataType:y.signedType,components:C,channels:n,integer:y.integer,signed:y.signed,normalized:y.normalized,bitsPerChannel:I,bytesPerPixel:y.byteLength*n.length,packed:t.packed,srgb:t.srgb},l==="-webgl"&&(t.webgl=!0),s==="-srgb"&&(t.srgb=!0)}return i.endsWith("-webgl")&&(t.webgl=!0),i.endsWith("-srgb")&&(t.srgb=!0),t}function IU(i){const t=U6(i),e=t.bytesPerPixel||1,n=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:i,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:e,bitsPerChannel:n,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function MU(i){const t=/.*-(\d+)x(\d+)-.*/.exec(i);if(t){const[,e,n]=t;return{blockWidth:Number(e),blockHeight:Number(n)}}return null}function BU(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}function RU(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}class LU{}class DU{features;disabledFeatures;constructor(t=[],e){this.features=new Set(t),this.disabledFeatures=e||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures?.[t]&&this.features.has(t)}}class $h{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(t,e)=>{},onResize:(t,e)=>{const[n,r]=t.getDevicePixelSize();Xe.log(1,`${t} resized => ${n}x${r}px`)()},onPositionChange:(t,e)=>{const[n,r]=t.getPosition();Xe.log(1,`${t} repositioned => ${n},${r}`)()},onVisibilityChange:t=>Xe.log(1,`${t} Visibility changed ${t.isVisible}`)(),onDevicePixelRatioChange:(t,e)=>Xe.log(1,`${t} DPR changed ${e.oldRatio} => ${t.devicePixelRatio}`)(),debug:Xe.get("debug")||void 0,debugShaders:Xe.get("debug-shaders")||void 0,debugFramebuffers:!!Xe.get("debug-framebuffers"),debugFactories:!!Xe.get("debug-factories"),debugWebGL:!!Xe.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=N6;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(t){this.props={...$h.defaultProps,...t},this.id=this.props.id||Sy(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(t){return ox(t)}isVertexFormatSupported(t){return!0}getTextureFormatInfo(t){return np.getInfo(t)}getTextureFormatCapabilities(t){let e=this._textureCaps[t];if(!e){const n=this._getDeviceTextureFormatCapabilities(t);e=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[t]=e}return e}getMipLevelCount(t,e,n=1){const r=Math.max(t,e,n);return 1+Math.floor(Math.log2(r))}isExternalImage(t){return BU(t)}getExternalImageSize(t){return RU(t)}isTextureFormatSupported(t){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return np.isCompressed(t)}pushDebugGroup(t){this.commandEncoder.pushDebugGroup(t)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(t){this.commandEncoder?.insertDebugMarker(t)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(t,e,...n){return this.props.onError(t,e)?()=>{}:Xe.error(t.message,e,...n)}debug(){if(this.props.debug)debugger;else Xe.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(t){return this.commandEncoder.beginRenderPass(t)}beginComputePass(t){return this.commandEncoder.beginComputePass(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,e){throw new Error("not implemented")}readPixelsToBufferWebGL(t,e){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,e){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_getDeviceTextureFormatCapabilities(t){const e=np.getCapabilities(t),n=o=>(typeof o=="string"?this.features.has(o):o)??!0,r=n(e.create);return{format:t,create:r,render:r&&n(e.render),filter:r&&n(e.filter),blend:r&&n(e.blend),store:r&&n(e.store)}}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e={...t};if((t.usage||0)&br.INDEX&&(t.indexType||(t.data instanceof Uint32Array?e.indexType="uint32":t.data instanceof Uint16Array&&(e.indexType="uint16")),!e.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return e}}const kU="set luma.log.level=1 (or higher) to trace rendering",zC="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class Gg{static defaultProps={...$h.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=N6;log=Xe;VERSION="9.2.4";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Xe.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Xe.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Xe.error("This version of luma.gl has already been initialized")()}Xe.log(1,`${this.VERSION} - ${kU}`)(),globalThis.luma=this}async createDevice(t={}){const e={...Gg.defaultProps,...t},n=this.selectAdapter(e.type,e.adapters);if(!n)throw new Error(zC);return e.waitForPageLoad&&await n.pageLoaded,await n.create(e)}async attachDevice(t,e){const n=this._getTypeFromHandle(t,e.adapters),r=n&&this.selectAdapter(n,e.adapters);if(!r)throw new Error(zC);return await r?.attach?.(t,e)}registerAdapters(t){for(const e of t)this.preregisteredAdapters.set(e.type,e)}getSupportedAdapters(t=[]){const e=this._getAdapterMap(t);return Array.from(e).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapterType(t=[]){const e=["webgpu","webgl","null"],n=this._getAdapterMap(t);for(const r of e)if(n.get(r)?.isSupported?.())return r;return null}selectAdapter(t,e=[]){let n=t;t==="best-available"&&(n=this.getBestAvailableAdapterType(e));const r=this._getAdapterMap(e);return n&&r.get(n)||null}enforceWebGL2(t=!0,e=[]){const n=this._getAdapterMap(e).get("webgl");n||Xe.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(t)}setDefaultDeviceProps(t){Object.assign(Gg.defaultProps,t)}_getAdapterMap(t=[]){const e=new Map(this.preregisteredAdapters);for(const n of t)e.set(n.type,n);return e}_getTypeFromHandle(t,e=[]){return t instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&t instanceof GPUDevice||t?.queue?"webgpu":t===null?"null":(t instanceof WebGLRenderingContext?Xe.warn("WebGL1 is not supported",t)():Xe.warn("Unknown handle type",t)(),null)}}const gb=new Gg;class OU{get pageLoaded(){return zU()}}const FU=pf()&&typeof document<"u",NU=()=>FU&&document.readyState==="complete";let d0=null;function zU(){return d0||(NU()||typeof window>"u"?d0=Promise.resolve():d0=new Promise(i=>window.addEventListener("load",()=>i()))),d0}function UU(){let i,t;return{promise:new Promise((e,n)=>{i=e,t=n}),resolve:i,reject:t}}class jh{static isHTMLCanvas(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}static isOffscreenCanvas(t){return typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=UU();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(t){if(this.props={...jh.defaultProps,...t},t=this.props,this.initialized=this._initializedResolvers.promise,pf()?t.canvas?typeof t.canvas=="string"?this.canvas=GU(t.canvas):this.canvas=t.canvas:this.canvas=jU(t):this.canvas={width:t.width||1,height:t.height||1},jh.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):jh.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],jh.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(e=>this._handleIntersection(e)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(e=>this._handleResize(e));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(t){return"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const t=this.device.limits.maxTextureDimension2D;return[t,t]}setDrawingBufferSize(t,e){this.canvas.width=t,this.canvas.height=e,this.drawingBufferWidth=t,this.drawingBufferHeight=e}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(t,e=!0){const n=this.cssToDeviceRatio(),[r,o]=this.getDrawingBufferSize();return WU(t,n,r,o,e)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[t,e]=this.getDevicePixelSize();return t/e}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),[e]=this.getCSSSize();return e?t/e:1}catch{return 1}}resize(t){this.setDrawingBufferSize(t.width,t.height)}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}_handleIntersection(t){const e=t.find(r=>r.target===this.canvas);if(!e)return;const n=e.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(t){const e=t.find(c=>c.target===this.canvas);if(!e)return;this.cssWidth=e.contentBoxSize[0].inlineSize,this.cssHeight=e.contentBoxSize[0].blockSize;const n=this.getDevicePixelSize(),r=e.devicePixelContentBoxSize?.[0].inlineSize||e.contentBoxSize[0].inlineSize*devicePixelRatio,o=e.devicePixelContentBoxSize?.[0].blockSize||e.contentBoxSize[0].blockSize*devicePixelRatio,[s,l]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(r,s)),this.devicePixelHeight=Math.max(1,Math.min(o,l)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:n})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const t=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*t,this.cssHeight*t)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const t=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:t}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(t=100){const e=setInterval(()=>{this.destroyed?clearInterval(e):this.updatePosition()},t)}updatePosition(){const t=this.htmlCanvas?.getBoundingClientRect();if(t){const e=[t.left,t.top];if(this._position??=e,e[0]!==this._position[0]||e[1]!==this._position[1]){const n=this._position;this._position=e,this.device.props.onPositionChange?.(this,{oldPosition:n})}}}}function VU(i){if(typeof i=="string"){const t=document.getElementById(i);if(!t)throw new Error(`${i} is not an HTML element`);return t}return i||document.body}function GU(i){const t=document.getElementById(i);if(!jh.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}function jU(i){const{width:t,height:e}=i,n=document.createElement("canvas");n.id=Sy("lumagl-auto-created-canvas"),n.width=t||1,n.height=e||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(e)?`${e}px`:"100%",i?.visible||(n.style.visibility="hidden");const r=VU(i?.container||null);return r.insertBefore(n,r.firstChild),n}function WU(i,t,e,n,r){const o=i,s=UC(o[0],t,e);let l=VC(o[1],t,n,r),c=UC(o[0]+1,t,e);const y=c===e-1?c:c-1;c=VC(o[1]+1,t,n,r);let _;return r?(c=c===0?c:c+1,_=l,l=c):_=c===n-1?c:c-1,{x:s,y:l,width:Math.max(y-s+1,1),height:Math.max(_-l+1,1)}}function UC(i,t,e){return Math.min(Math.round(i*t),e-1)}function VC(i,t,e,n){return n?Math.max(0,e-1-Math.round(i*t)):Math.min(Math.round(i*t),e-1)}class tf extends pr{static defaultProps={...pr.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,e){e=tf.normalizeProps(t,e),super(t,e,tf.defaultProps)}static normalizeProps(t,e){return e}}const HU={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class ps extends pr{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(t,e){if(e=ps.normalizeProps(t,e),super(t,e,ps.defaultProps),this.dimension=this.props.dimension,this.baseDimension=HU[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(t.isExternalImage(e.data)){const n=t.getExternalImageSize(e.data);this.width=n?.width||1,this.height=n?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&Xe.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}setSampler(t){this.sampler=t instanceof tf?t:this.device.createSampler(t)}clone(t){return this.device.createTexture({...this.props,...t})}static normalizeProps(t,e){const n={...e},{width:r,height:o}=n;return typeof r=="number"&&(n.width=Math.max(1,Math.ceil(r))),typeof o=="number"&&(n.height=Math.max(1,Math.ceil(o))),n}_initializeData(t){this.device.isExternalImage(t)?this.copyExternalImage({image:t,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):t&&this.copyImageData({data:t,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:e,height:n,depth:r}=this,o={...ps.defaultCopyDataOptions,width:e,height:n,depth:r,...t},s=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!s.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return o.bytesPerRow=t.bytesPerRow||e*(s.bytesPerPixel||4),o.rowsPerImage=t.rowsPerImage||n,o}_normalizeCopyExternalImageOptions(t){const e=this.device.getExternalImageSize(t.image),n={...ps.defaultCopyExternalImageOptions,...e,...t};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}static defaultProps={...pr.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:ps.TEXTURE|ps.RENDER_ATTACHMENT|ps.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class Py extends pr{get[Symbol.toStringTag](){return"TextureView"}constructor(t,e){super(t,e,Py.defaultProps)}static defaultProps={...pr.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function XU(i,t,e){let n="";const r=t.split(/\r?\n/),o=i.slice().sort((s,l)=>s.lineNum-l.lineNum);switch(e?.showSourceCode||"no"){case"all":let s=0;for(let l=1;l<=r.length;l++)for(n+=V6(r[l-1],l,e);o.length>s&&o[s].lineNum===l;){const c=o[s++];n+=v_(c,r,c.lineNum,{...e,inlineSource:!1})}for(;o.length>s;){const l=o[s++];n+=v_(l,[],0,{...e,inlineSource:!1})}return n;case"issues":case"no":for(const l of i)n+=v_(l,r,l.lineNum,{inlineSource:e?.showSourceCode!=="no"});return n}}function v_(i,t,e,n){if(n?.inlineSource){const o=qU(t,e),s=i.linePos>0?`${" ".repeat(i.linePos+5)}^^^
`:"";return`
${o}${s}${i.type.toUpperCase()}: ${i.message}

`}const r=i.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${i.type.toUpperCase()}: ${i.message}</b></div>`:`${i.type.toUpperCase()}: ${i.message}`}function qU(i,t,e){let n="";for(let r=t-2;r<=t;r++){const o=i[r-1];o!==void 0&&(n+=V6(o,t,e))}return n}function V6(i,t,e){const n=e?.html?ZU(i):i;return`${KU(String(t),4)}: ${n}${e?.html?"<br/>":`
`}`}function KU(i,t){let e="";for(let n=i.length;n<t;++n)e+=" ";return e+i}function ZU(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Iy extends pr{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,e){e={...e,debugShaders:e.debugShaders||t.props.debugShaders||"errors"},super(t,{id:YU(e),...e},Iy.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const e=await this.getCompilationInfo();t==="warnings"&&e?.length===0||this._displayShaderLog(e,this.id)}_displayShaderLog(t,e){if(typeof document>"u"||!document?.createElement)return;const n=e,r=`${this.stage} shader "${n}"`;let o=XU(t,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Compilation error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),l.onclick=()=>{const c=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(c)}}static defaultProps={...pr.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function YU(i){return QU(i.source)||i.id||Sy(`unnamed ${i.stage}-shader`)}function QU(i,t="unnamed"){const e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(i);return e?e[1]:t}class My extends pr{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(t,e={}){super(t,e,My.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(t){const e=this.colorAttachments.map(r=>r.texture.clone(t)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:e,depthStencilAttachment:n})}resize(t){let e=!t;if(t){const[n,r]=Array.isArray(t)?t:[t.width,t.height];e=e||r!==this.height||n!==this.width,this.width=n,this.height=r}e&&(Xe.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,n)=>{if(typeof e=="string"){const r=this.createColorTexture(e,n);return this.attachResource(r),r.view}return e instanceof ps?e.view:e});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const e=this.createDepthStencilTexture(t);this.attachResource(e),this.depthStencilAttachment=e.view}else t instanceof ps?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,e){return this.device.createTexture({id:`${this.id}-color-attachment-${e}`,usage:ps.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ps.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,e){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const r=this.colorAttachments[n].texture.clone({width:t,height:e});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:t,height:e});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}static defaultProps={...pr.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class Kh extends pr{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,e){super(t,e,Kh.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...pr.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class Uh extends pr{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(t,e){e=Uh.normalizeProps(t,e),super(t,e,Uh.defaultProps)}static normalizeProps(t,e){return e}static defaultProps={...pr.defaultProps,framebuffer:null,parameters:void 0,clearColor:Uh.defaultClearColor,clearColors:void 0,clearDepth:Uh.defaultClearDepth,clearStencil:Uh.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class jg extends pr{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(t,e){super(t,e,jg.defaultProps),this.shaderLayout=e.shaderLayout}static defaultProps={...pr.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class ax extends pr{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,e){super(t,e,ax.defaultProps)}static defaultProps={...pr.defaultProps,measureExecutionTime:void 0}}class lx extends pr{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,e){super(t,e,lx.defaultProps)}static defaultProps={...pr.defaultProps}}function G6(i){return e7[i]}function JU(i){const[t,e]=t7[i],n=t==="i32"||t==="u32",r=t!=="u32",o=$U[t]*e;return{primitiveType:t,components:e,byteLength:o,integer:n,signed:r}}const $U={f32:4,f16:2,i32:4,u32:4},t7={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},e7={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function j6(i,t){const e={};for(const n of i.attributes){const r=n7(i,t,n.name);r&&(e[n.name]=r)}return e}function i7(i,t,e=16){const n=j6(i,t),r=new Array(e).fill(null);for(const o of Object.values(n))r[o.location]=o;return r}function n7(i,t,e){const n=r7(i,e),r=s7(t,e);if(!n)return null;const o=JU(n.type),s=_U(o),l=r?.vertexFormat||s,c=ox(l);return{attributeName:r?.attributeName||n.name,bufferName:r?.bufferName||n.name,location:n.location,shaderType:n.type,primitiveType:o.primitiveType,shaderComponents:o.components,vertexFormat:l,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:o.integer,stepMode:r?.stepMode||n.stepMode||"vertex",byteOffset:r?.byteOffset||0,byteStride:r?.byteStride||0}}function r7(i,t){const e=i.attributes.find(n=>n.name===t);return e||Xe.warn(`shader layout attribute "${t}" not present in shader`),e||null}function s7(i,t){o7(i);let e=a7(i,t);return e||(e=l7(i,t),e)?e:(Xe.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function o7(i){for(const t of i)(t.attributes&&t.format||!t.attributes&&!t.format)&&Xe.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function a7(i,t){for(const e of i)if(e.format&&e.name===t)return{attributeName:e.name,bufferName:t,stepMode:e.stepMode,vertexFormat:e.format,byteOffset:0,byteStride:e.byteStride||0};return null}function l7(i,t){for(const e of i){let n=e.byteStride;if(typeof e.byteStride!="number")for(const o of e.attributes||[]){const s=ox(o.format);n+=s.byteLength}const r=e.attributes?.find(o=>o.attribute===t);if(r)return{attributeName:r.attribute,bufferName:e.name,stepMode:e.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:n}}return null}class ux extends pr{static defaultProps={...pr.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,e){super(t,e,ux.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=i7(e.shaderLayout,e.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(t,e){this.device.reportError(new Error("constant attributes not supported"),this)()}}class cx extends pr{static defaultProps={...pr.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,e){super(t,e,cx.defaultProps)}}class hx extends pr{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,e){super(t,e,hx.defaultProps)}static defaultProps={...pr.defaultProps,type:void 0,count:void 0}}let p0;function W6(i){return(!p0||p0.byteLength<i)&&(p0=new ArrayBuffer(i)),p0}function u7(i,t){const e=W6(i.BYTES_PER_ELEMENT*t);return new i(e,0,t)}function c7(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Wg(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":c7(i)}const h7=1024;class f7{layout={};byteLength;constructor(t,e={}){let n=0;for(const[o,s]of Object.entries(t)){const l=G6(s),{type:c,components:y}=l,_=y*(e?.[o]??1);n=gU(n,_);const C=n;n+=_,this.layout[o]={type:c,size:_,offset:C}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,h7)}getData(t){const e=W6(this.byteLength),n={i32:new Int32Array(e),u32:new Uint32Array(e),f32:new Float32Array(e),f16:new Uint16Array(e)};for(const[r,o]of Object.entries(t)){const s=this.layout[r];if(!s){Xe.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:l,size:c,offset:y}=s,_=n[l];if(c===1){if(typeof o!="number"&&typeof o!="boolean"){Xe.warn(`Supplied value for single component uniform ${r} is not a number: ${o}`)();continue}_[y]=Number(o)}else{if(!Wg(o)){Xe.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${o}`)();continue}_.set(o,y)}}return new Uint8Array(e,0,this.byteLength)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function d7(i,t,e=16){if(i!==t)return!1;const n=i,r=t;if(!Wg(n))return!1;if(Wg(r)&&n.length===r.length){for(let o=0;o<n.length;++o)if(r[o]!==n[o])return!1}return!0}function p7(i){return Wg(i)?i.slice():i}class A7{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name||"unnamed",t?.name&&t?.shaderLayout){const e=t?.shaderLayout.bindings?.find(r=>r.type==="uniform"&&r.name===t?.name);if(!e)throw new Error(t?.name);const n=e;for(const r of n.uniforms||[])this.bindingLayout[r.name]=r}}setUniforms(t){for(const[e,n]of Object.entries(t))this._setUniform(e,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${e}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,e){d7(this.uniforms[t],e)||(this.uniforms[t]=p7(e),this.modifiedUniforms[t]=!0,this.modified=!0)}}class m7{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(const[e,n]of Object.entries(t)){const r=e,o=new f7(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(r,o);const s=new A7({name:e});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(r,s)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(const[e,n]of Object.entries(t))this.uniformBlocks.get(e)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t)?.byteLength||0}getUniformBufferData(t){const e=this.uniformBlocks.get(t)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(t)?.getData(e)}createUniformBuffer(t,e,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(e),o=t.createBuffer({usage:br.UNIFORM|br.COPY_DST,byteLength:r}),s=this.getUniformBufferData(e);return o.write(s),o}getManagedUniformBuffer(t,e){if(!this.uniformBuffers.get(e)){const n=this.getUniformBufferByteLength(e),r=t.createBuffer({usage:br.UNIFORM|br.COPY_DST,byteLength:n});this.uniformBuffers.set(e,r)}return this.uniformBuffers.get(e)}updateUniformBuffers(){let t=!1;for(const e of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(e);t||=n}return t&&Xe.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){const e=this.uniformBlocks.get(t);let n=this.uniformBuffers.get(t),r=!1;if(n&&e?.needsRedraw){r||=e.needsRedraw;const o=this.getUniformBufferData(t);n=this.uniformBuffers.get(t),n?.write(o);const s=this.uniformBlocks.get(t)?.getAllUniforms();Xe.log(4,`Writing to uniform buffer ${String(t)}`,o,s)()}return r}}let Fa=class{constructor(i,t){this.name=i,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}};class GC{constructor(t,e,n){this.name=t,this.type=e,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Gc extends Fa{constructor(t,e){super(t,e),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Xc extends Fa{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class yb extends Fa{constructor(t,e,n){super(t,n),this.format=e}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}let ef=class extends Fa{constructor(i,t,e,n){super(i,e),this.format=t,this.access=n}get isTemplate(){return!0}getTypeName(){let i=this.name;if(this.format!==null){if(i==="vec2"||i==="vec3"||i==="vec4"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"){if(this.format.name==="f32")return i+="f",i;if(this.format.name==="i32")return i+="i",i;if(this.format.name==="u32")return i+="u",i;if(this.format.name==="bool")return i+="b",i;if(this.format.name==="f16")return i+="h",i}i+=`<${this.format.name}>`}else if(i==="vec2"||i==="vec3"||i==="vec4")return i;return i}};var Uc;(i=>{i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})(Uc||(Uc={}));class A0{constructor(t,e,n,r,o,s,l){this.name=t,this.type=e,this.group=n,this.binding=r,this.attributes=o,this.resourceType=s,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}let g7=class{constructor(i,t){this.name=i,this.type=t}};class y7{constructor(t,e,n,r){this.name=t,this.type=e,this.locationType=n,this.location=r,this.interpolation=null}}let jC=class{constructor(i,t,e,n){this.name=i,this.type=t,this.locationType=e,this.location=n}};class v7{constructor(t,e,n,r){this.name=t,this.type=e,this.attributes=n,this.id=r}}class _7{constructor(t,e,n){this.name=t,this.type=e,this.attributes=n}}class b7{constructor(t,e=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=e,this.attributes=n}}let x7=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}};function w7(i){var t=(32768&i)>>15,e=(31744&i)>>10,n=1023&i;return e==0?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):e==31?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,e-15)*(1+n/Math.pow(2,10))}const H6=new Float32Array(1),E7=new Int32Array(H6.buffer),fo=new Uint16Array(1);function C7(i){H6[0]=i;const t=E7[0],e=t>>31&1;let n=t>>23&255,r=8388607&t;if(n===255)return fo[0]=e<<15|31744|(r!==0?512:0),fo[0];if(n===0){if(r===0)return fo[0]=e<<15,fo[0];r|=8388608;let o=113;for(;!(8388608&r);)r<<=1,o--;return n=127-o,r&=8388607,n>0?(r=(r>>126-n)+(r>>127-n&1),fo[0]=e<<15|n<<10|r>>13,fo[0]):(fo[0]=e<<15,fo[0])}return n=n-127+15,n>=31?(fo[0]=e<<15|31744,fo[0]):n<=0?n<-10?(fo[0]=e<<15,fo[0]):(r=(8388608|r)>>1-n,fo[0]=e<<15|r>>13,fo[0]):(r>>=13,fo[0]=e<<15|n<<10|r,fo[0])}const fx=new Uint32Array(1),X6=new Float32Array(fx.buffer,0,1);function WC(i){const t=112+(i>>6&31)<<23|(63&i)<<17;return fx[0]=t,X6[0]}function T7(i,t,e,n,r,o,s,l,c){const y=n*(s>>=r)*(o>>=r)+e*s+t*l;switch(c){case"r8unorm":return[Jn(i,y,"8unorm",1)[0]];case"r8snorm":return[Jn(i,y,"8snorm",1)[0]];case"r8uint":return[Jn(i,y,"8uint",1)[0]];case"r8sint":return[Jn(i,y,"8sint",1)[0]];case"rg8unorm":{const _=Jn(i,y,"8unorm",2);return[_[0],_[1]]}case"rg8snorm":{const _=Jn(i,y,"8snorm",2);return[_[0],_[1]]}case"rg8uint":{const _=Jn(i,y,"8uint",2);return[_[0],_[1]]}case"rg8sint":{const _=Jn(i,y,"8sint",2);return[_[0],_[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const _=Jn(i,y,"8unorm",4);return[_[0],_[1],_[2],_[3]]}case"rgba8snorm":{const _=Jn(i,y,"8snorm",4);return[_[0],_[1],_[2],_[3]]}case"rgba8uint":{const _=Jn(i,y,"8uint",4);return[_[0],_[1],_[2],_[3]]}case"rgba8sint":{const _=Jn(i,y,"8sint",4);return[_[0],_[1],_[2],_[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const _=Jn(i,y,"8unorm",4);return[_[2],_[1],_[0],_[3]]}case"r16uint":return[Jn(i,y,"16uint",1)[0]];case"r16sint":return[Jn(i,y,"16sint",1)[0]];case"r16float":return[Jn(i,y,"16float",1)[0]];case"rg16uint":{const _=Jn(i,y,"16uint",2);return[_[0],_[1]]}case"rg16sint":{const _=Jn(i,y,"16sint",2);return[_[0],_[1]]}case"rg16float":{const _=Jn(i,y,"16float",2);return[_[0],_[1]]}case"rgba16uint":{const _=Jn(i,y,"16uint",4);return[_[0],_[1],_[2],_[3]]}case"rgba16sint":{const _=Jn(i,y,"16sint",4);return[_[0],_[1],_[2],_[3]]}case"rgba16float":{const _=Jn(i,y,"16float",4);return[_[0],_[1],_[2],_[3]]}case"r32uint":return[Jn(i,y,"32uint",1)[0]];case"r32sint":return[Jn(i,y,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Jn(i,y,"32float",1)[0]];case"rg32uint":{const _=Jn(i,y,"32uint",2);return[_[0],_[1]]}case"rg32sint":{const _=Jn(i,y,"32sint",2);return[_[0],_[1]]}case"rg32float":{const _=Jn(i,y,"32float",2);return[_[0],_[1]]}case"rgba32uint":{const _=Jn(i,y,"32uint",4);return[_[0],_[1],_[2],_[3]]}case"rgba32sint":{const _=Jn(i,y,"32sint",4);return[_[0],_[1],_[2],_[3]]}case"rgba32float":{const _=Jn(i,y,"32float",4);return[_[0],_[1],_[2],_[3]]}case"rg11b10ufloat":{const _=new Uint32Array(i.buffer,y,1)[0],C=(4192256&_)>>11,I=(4290772992&_)>>22;return[WC(2047&_),WC(C),(function(k){const z=112+(k>>5&31)<<23|(31&k)<<18;return fx[0]=z,X6[0]})(I),1]}}return null}function Jn(i,t,e,n){const r=[0,0,0,0];for(let o=0;o<n;++o)switch(e){case"8unorm":r[o]=i[t]/255,t++;break;case"8snorm":r[o]=i[t]/255*2-1,t++;break;case"8uint":r[o]=i[t],t++;break;case"8sint":r[o]=i[t]-127,t++;break;case"16uint":r[o]=i[t]|i[t+1]<<8,t+=2;break;case"16sint":r[o]=(i[t]|i[t+1]<<8)-32768,t+=2;break;case"16float":r[o]=w7(i[t]|i[t+1]<<8),t+=2;break;case"32uint":case"32sint":r[o]=i[t]|i[t+1]<<8|i[t+2]<<16|i[t+3]<<24,t+=4;break;case"32float":r[o]=new Float32Array(i.buffer,t,1)[0],t+=4}return r}function nr(i,t,e,n,r){for(let o=0;o<n;++o)switch(e){case"8unorm":i[t]=255*r[o],t++;break;case"8snorm":i[t]=.5*(r[o]+1)*255,t++;break;case"8uint":i[t]=r[o],t++;break;case"8sint":i[t]=r[o]+127,t++;break;case"16uint":new Uint16Array(i.buffer,t,1)[0]=r[o],t+=2;break;case"16sint":new Int16Array(i.buffer,t,1)[0]=r[o],t+=2;break;case"16float":{const s=C7(r[o]);new Uint16Array(i.buffer,t,1)[0]=s,t+=2;break}case"32uint":new Uint32Array(i.buffer,t,1)[0]=r[o],t+=4;break;case"32sint":new Int32Array(i.buffer,t,1)[0]=r[o],t+=4;break;case"32float":new Float32Array(i.buffer,t,1)[0]=r[o],t+=4}return r}const __={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};let hu=class q6{constructor(){this.id=q6._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(t){t(this)}searchBlock(t,e){if(t){e(Hg.instance);for(const n of t)n instanceof Array?this.searchBlock(n,e):n.search(e);e(Xg.instance)}}constEvaluate(t,e){throw new Error("Cannot evaluate node")}constEvaluateString(t){return this.constEvaluate(t).toString()}};hu._id=0;let Hg=class extends hu{};Hg.instance=new Hg;class Xg extends hu{}Xg.instance=new Xg;const K6=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);let Fr=class extends hu{constructor(){super()}},tm=class extends Fr{constructor(i,t,e,n,r,o){super(),this.calls=new Set,this.name=i,this.args=t,this.returnType=e,this.body=n,this.startLine=r,this.endLine=o}get astNodeType(){return"function"}search(i){if(this.attributes)for(const t of this.attributes)i(t);i(this);for(const t of this.args)i(t);this.searchBlock(this.body,i)}};class S7 extends Fr{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}let Z6=class extends Fr{constructor(i,t){super(),this.condition=i,this.body=t}get astNodeType(){return"while"}search(i){this.condition.search(i),this.searchBlock(this.body,i)}};class vb extends Fr{constructor(t,e){super(),this.body=t,this.loopId=e}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}let Y6=class extends Fr{constructor(i,t,e,n){super(),this.init=i,this.condition=t,this.increment=e,this.body=n}get astNodeType(){return"for"}search(i){var t,e,n;(t=this.init)===null||t===void 0||t.search(i),(e=this.condition)===null||e===void 0||e.search(i),(n=this.increment)===null||n===void 0||n.search(i),this.searchBlock(this.body,i)}},Wu=class extends Fr{constructor(i,t,e,n,r){super(),this.attributes=null,this.name=i,this.type=t,this.storage=e,this.access=n,this.value=r}get astNodeType(){return"var"}search(i){var t;i(this),(t=this.value)===null||t===void 0||t.search(i)}};class dx extends Fr{constructor(t,e,n){super(),this.attributes=null,this.name=t,this.type=e,this.value=n}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class NA extends Fr{constructor(t,e,n,r,o){super(),this.attributes=null,this.name=t,this.type=e,this.storage=n,this.access=r,this.value=o}get astNodeType(){return"let"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class pg extends Fr{constructor(t,e,n,r,o){super(),this.attributes=null,this.name=t,this.type=e,this.storage=n,this.access=r,this.value=o}get astNodeType(){return"const"}constEvaluate(t,e){return this.value.constEvaluate(t,e)}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}var Wd,PA,xe,ce;(i=>{i.increment="++",i.decrement="--"})(Wd||(Wd={})),(i=>{i.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for IncrementOperator");return i[e]}})(Wd||(Wd={}));class Q6 extends Fr{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}(i=>{i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(PA||(PA={})),(i=>{i.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for AssignOperator");return e}})(PA||(PA={}));let J6=class extends Fr{constructor(i,t,e){super(),this.operator=i,this.variable=t,this.value=e}get astNodeType(){return"assign"}search(i){this.variable.search(i),this.value.search(i)}};class px extends Fr{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}isBuiltin(){return K6.has(this.name)}search(t){for(const e of this.args)e.search(t);t(this)}}class $6 extends Fr{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}search(t){var e;this.searchBlock(this.body,t),(e=this.continuing)===null||e===void 0||e.search(t)}}class tR extends Fr{constructor(t,e){super(),this.condition=t,this.cases=e}get astNodeType(){return"switch"}search(t){t(this);for(const e of this.cases)e.search(t)}}class eR extends Fr{constructor(t,e,n,r){super(),this.condition=t,this.body=e,this.elseif=n,this.else=r}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class iR extends Fr{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class P7 extends Fr{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class I7 extends Fr{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class nR extends Fr{constructor(t,e){super(),this.severity=t,this.rule=e}get astNodeType(){return"diagnostic"}}class Ax extends Fr{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class M7 extends Fr{constructor(){super()}get astNodeType(){return"discard"}}class rR extends Fr{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class sR extends Fr{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class He extends Fr{constructor(t){super(),this.attributes=null,this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let e=t[0];if(e.name==="f32")return e;for(let n=1;n<t.length;++n){const r=He._priority.get(e.name);He._priority.get(t[n].name)<r&&(e=t[n])}return e.name==="x32"?He.i32:e}getTypeName(){return this.name}}He.x32=new He("x32"),He.f32=new He("f32"),He.i32=new He("i32"),He.u32=new He("u32"),He.f16=new He("f16"),He.bool=new He("bool"),He.void=new He("void"),He._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class HC extends He{constructor(t){super(t)}}class Gu extends He{constructor(t,e,n,r){super(t),this.members=e,this.startLine=n,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}search(t){for(const e of this.members)t(e)}}class me extends He{constructor(t,e,n){super(t),this.format=e,this.access=n}get astNodeType(){return"template"}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}me.vec2f=new me("vec2",He.f32,null),me.vec3f=new me("vec3",He.f32,null),me.vec4f=new me("vec4",He.f32,null),me.vec2i=new me("vec2",He.i32,null),me.vec3i=new me("vec3",He.i32,null),me.vec4i=new me("vec4",He.i32,null),me.vec2u=new me("vec2",He.u32,null),me.vec3u=new me("vec3",He.u32,null),me.vec4u=new me("vec4",He.u32,null),me.vec2h=new me("vec2",He.f16,null),me.vec3h=new me("vec3",He.f16,null),me.vec4h=new me("vec4",He.f16,null),me.vec2b=new me("vec2",He.bool,null),me.vec3b=new me("vec3",He.bool,null),me.vec4b=new me("vec4",He.bool,null),me.mat2x2f=new me("mat2x2",He.f32,null),me.mat2x3f=new me("mat2x3",He.f32,null),me.mat2x4f=new me("mat2x4",He.f32,null),me.mat3x2f=new me("mat3x2",He.f32,null),me.mat3x3f=new me("mat3x3",He.f32,null),me.mat3x4f=new me("mat3x4",He.f32,null),me.mat4x2f=new me("mat4x2",He.f32,null),me.mat4x3f=new me("mat4x3",He.f32,null),me.mat4x4f=new me("mat4x4",He.f32,null),me.mat2x2h=new me("mat2x2",He.f16,null),me.mat2x3h=new me("mat2x3",He.f16,null),me.mat2x4h=new me("mat2x4",He.f16,null),me.mat3x2h=new me("mat3x2",He.f16,null),me.mat3x3h=new me("mat3x3",He.f16,null),me.mat3x4h=new me("mat3x4",He.f16,null),me.mat4x2h=new me("mat4x2",He.f16,null),me.mat4x3h=new me("mat4x3",He.f16,null),me.mat4x4h=new me("mat4x4",He.f16,null),me.mat2x2i=new me("mat2x2",He.i32,null),me.mat2x3i=new me("mat2x3",He.i32,null),me.mat2x4i=new me("mat2x4",He.i32,null),me.mat3x2i=new me("mat3x2",He.i32,null),me.mat3x3i=new me("mat3x3",He.i32,null),me.mat3x4i=new me("mat3x4",He.i32,null),me.mat4x2i=new me("mat4x2",He.i32,null),me.mat4x3i=new me("mat4x3",He.i32,null),me.mat4x4i=new me("mat4x4",He.i32,null),me.mat2x2u=new me("mat2x2",He.u32,null),me.mat2x3u=new me("mat2x3",He.u32,null),me.mat2x4u=new me("mat2x4",He.u32,null),me.mat3x2u=new me("mat3x2",He.u32,null),me.mat3x3u=new me("mat3x3",He.u32,null),me.mat3x4u=new me("mat3x4",He.u32,null),me.mat4x2u=new me("mat4x2",He.u32,null),me.mat4x3u=new me("mat4x3",He.u32,null),me.mat4x4u=new me("mat4x4",He.u32,null);class Ag extends He{constructor(t,e,n,r){super(t),this.storage=e,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class zA extends He{constructor(t,e,n,r){super(t),this.attributes=e,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class IA extends He{constructor(t,e,n){super(t),this.format=e,this.access=n}get astNodeType(){return"sampler"}}class xl extends hu{constructor(){super(),this.postfix=null}}class nf extends xl{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class tu extends xl{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const e of this.args)e.search(t)}constEvaluate(t,e){return e&&(e[0]=this.type),t.evalExpression(this,t.context)}}class mx extends xl{constructor(t,e){super(),this.cachedReturnValue=null,this.name=t,this.args=e}get astNodeType(){return"callExpr"}setCachedReturnValue(t){this.cachedReturnValue=t}get isBuiltin(){return K6.has(this.name)}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){for(const e of this.args)e.search(t);t(this)}}class ca extends xl{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}constEvaluate(t,e){return t.evalExpression(this,t.context)}}class oR extends xl{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}constEvaluate(t,e){if(this.initializer){const n=t.evalExpression(this.initializer,t.context);return n!==null&&this.postfix?n.getSubData(t,this.postfix,t.context):n}return null}search(t){this.initializer.search(t)}}class Cs extends xl{constructor(t,e){super(),this.value=t,this.type=e}get astNodeType(){return"literalExpr"}constEvaluate(t,e){return e!==void 0&&(e[0]=this.type),this.value}get isScalar(){return this.value instanceof ae}get isVector(){return this.value instanceof Xt||this.value instanceof ln}get scalarValue(){return this.value instanceof ae?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Xt||this.value instanceof ln?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class aR extends xl{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class mp extends xl{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class lR extends xl{constructor(){super()}}class fs extends lR{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.right.search(t)}}class ol extends lR{constructor(t,e,n){super(),this.operator=t,this.left=e,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(t,e){return t.name===e.name?t:t.name==="f32"||e.name==="f32"?He.f32:t.name==="u32"||e.name==="u32"?He.u32:He.i32}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.left.search(t),this.right.search(t)}}class uR extends hu{constructor(t){super(),this.body=t}search(t){t(this),this.searchBlock(this.body,t)}}class mg extends xl{constructor(){super()}get astNodeType(){return"default"}}class cR extends uR{constructor(t,e){super(e),this.selectors=t}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class hR extends uR{constructor(t){super(t)}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class XC extends hu{constructor(t,e,n){super(),this.name=t,this.type=e,this.attributes=n}get astNodeType(){return"argument"}}class B7 extends hu{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class qC extends hu{constructor(t,e,n){super(),this.name=t,this.type=e,this.attributes=n}get astNodeType(){return"member"}}class fR extends hu{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}}class za{constructor(t,e){this.parent=null,this.typeInfo=t,this.parent=e,this.id=za._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(t,e,n,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(t,e,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}za._id=0;class _b extends za{constructor(){super(new Fa("void",null),null)}toString(){return"void"}}_b.void=new _b;class yd extends za{constructor(t){super(new yb("pointer",t.typeInfo,null),null),this.reference=t}clone(){return this}setDataValue(t,e,n,r){this.reference.setDataValue(t,e,n,r)}getSubData(t,e,n){return e?this.reference.getSubData(t,e,n):this}toString(){return`&${this.reference.toString()}`}}class ae extends za{constructor(t,e,n=null){super(e,n),t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array?this.data=t:this.typeInfo.name==="x32"?t-Math.floor(t)!==0?this.data=new Float32Array([t]):this.data=t>=0?new Uint32Array([t]):new Int32Array([t]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([t]):this.typeInfo.name==="u32"?this.data=new Uint32Array([t]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([t]):console.error("ScalarData2: Invalid type",e)}clone(){if(this.data instanceof Float32Array)return new ae(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ae(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ae(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(t){this.data[0]=t}setDataValue(t,e,n,r){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(e instanceof ae))return void console.error("SetDataValue: Invalid value",e);let o=e.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(t,e,n){return e?(console.error("getSubData: Scalar data does not support postfix",e),null):this}toString(){return`${this.value}`}}function R7(i,t,e){const n=t.length;return n===2?e==="f32"?new Xt(new Float32Array(t),i.getTypeInfo("vec2f")):e==="i32"||e==="bool"?new Xt(new Int32Array(t),i.getTypeInfo("vec2i")):e==="u32"?new Xt(new Uint32Array(t),i.getTypeInfo("vec2u")):e==="f16"?new Xt(new Float32Array(t),i.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${e}`),null):n===3?e==="f32"?new Xt(new Float32Array(t),i.getTypeInfo("vec3f")):e==="i32"||e==="bool"?new Xt(new Int32Array(t),i.getTypeInfo("vec3i")):e==="u32"?new Xt(new Uint32Array(t),i.getTypeInfo("vec3u")):e==="f16"?new Xt(new Float32Array(t),i.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${e}`),null):n===4?e==="f32"?new Xt(new Float32Array(t),i.getTypeInfo("vec4f")):e==="i32"||e==="bool"?new Xt(new Int32Array(t),i.getTypeInfo("vec4i")):e==="u32"?new Xt(new Uint32Array(t),i.getTypeInfo("vec4u")):e==="f16"?new Xt(new Float32Array(t),i.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${e}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class Xt extends za{constructor(t,e,n=null){if(super(e,n),t instanceof Float32Array||t instanceof Uint32Array||t instanceof Int32Array)this.data=t;else{const r=this.typeInfo.name;r==="vec2f"||r==="vec3f"||r==="vec4f"?this.data=new Float32Array(t):r==="vec2i"||r==="vec3i"||r==="vec4i"?this.data=new Int32Array(t):r==="vec2u"||r==="vec3u"||r==="vec4u"?this.data=new Uint32Array(t):r==="vec2h"||r==="vec3h"||r==="vec4h"?this.data=new Float32Array(t):r==="vec2b"||r==="vec3b"||r==="vec4b"?this.data=new Int32Array(t):r==="vec2"||r==="vec3"||r==="vec4"?this.data=new Float32Array(t):console.error(`VectorData: Invalid type ${r}`)}}clone(){if(this.data instanceof Float32Array)return new Xt(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Xt(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Xt(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,e,n,r){n instanceof nf?console.error("TODO: Set vector postfix"):e instanceof Xt?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,n){if(e===null)return this;let r=t.getTypeInfo("f32");if(this.typeInfo instanceof ef)r=this.typeInfo.format||r;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?r=t.getTypeInfo("f32"):s==="vec2i"||s==="vec3i"||s==="vec4i"?r=t.getTypeInfo("i32"):s==="vec2b"||s==="vec3b"||s==="vec4b"?r=t.getTypeInfo("bool"):s==="vec2u"||s==="vec3u"||s==="vec4u"?r=t.getTypeInfo("u32"):s==="vec2h"||s==="vec3h"||s==="vec4h"?r=t.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${s}`)}let o=this;for(;e!==null&&o!==null;){if(e instanceof mp){const s=e.index;let l=-1;if(s instanceof Cs){if(!(s.value instanceof ae))return console.error(`GetSubData: Invalid array index ${s.value}`),null;l=s.value.value}else{const c=t.evalExpression(s,n);if(!(c instanceof ae))return console.error("GetSubData: Unknown index type",s),null;l=c.value}if(l<0||l>=o.data.length)return console.error("GetSubData: Index out of range",l),null;if(o.data instanceof Float32Array){const c=new Float32Array(o.data.buffer,o.data.byteOffset+4*l,1);return new ae(c,r)}if(o.data instanceof Int32Array){const c=new Int32Array(o.data.buffer,o.data.byteOffset+4*l,1);return new ae(c,r)}if(o.data instanceof Uint32Array){const c=new Uint32Array(o.data.buffer,o.data.byteOffset+4*l,1);return new ae(c,r)}throw"GetSubData: Invalid data type"}if(!(e instanceof nf))return console.error("GetSubData: Unknown postfix",e),null;{const s=e.value.toLowerCase();if(s.length===1){let c=0;if(s==="x"||s==="r")c=0;else if(s==="y"||s==="g")c=1;else if(s==="z"||s==="b")c=2;else{if(s!=="w"&&s!=="a")return console.error(`GetSubData: Unknown member ${s}`),null;c=3}if(this.data instanceof Float32Array){let y=new Float32Array(this.data.buffer,this.data.byteOffset+4*c,1);return new ae(y,r,this)}if(this.data instanceof Int32Array){let y=new Int32Array(this.data.buffer,this.data.byteOffset+4*c,1);return new ae(y,r,this)}if(this.data instanceof Uint32Array){let y=new Uint32Array(this.data.buffer,this.data.byteOffset+4*c,1);return new ae(y,r,this)}}const l=[];for(const c of s)c==="x"||c==="r"?l.push(this.data[0]):c==="y"||c==="g"?l.push(this.data[1]):c==="z"||c==="b"?l.push(this.data[2]):c==="w"||c==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${c}`);o=R7(t,l,r.name)}e=e.postfix}return o}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class ln extends za{constructor(t,e,n=null){super(e,n),t instanceof Float32Array?this.data=t:this.data=new Float32Array(t)}clone(){return new ln(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,e,n,r){n instanceof nf?console.error("TODO: Set matrix postfix"):e instanceof ln?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,n){if(e===null)return this;const r=this.typeInfo.name;if(t.getTypeInfo("f32"),this.typeInfo instanceof ef)this.typeInfo.format;else if(r.endsWith("f"))t.getTypeInfo("f32");else if(r.endsWith("i"))t.getTypeInfo("i32");else if(r.endsWith("u"))t.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;t.getTypeInfo("f16")}if(e instanceof mp){const o=e.index;let s=-1;if(o instanceof Cs){if(!(o.value instanceof ae))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;s=o.value.value}else{const y=t.evalExpression(o,n);if(!(y instanceof ae))return console.error("GetDataValue: Unknown index type",o),null;s=y.value}if(s<0||s>=this.data.length)return console.error("GetDataValue: Index out of range",s),null;const l=r.endsWith("h")?"h":"f";let c;if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h"||r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h")c=new Xt(new Float32Array(this.data.buffer,this.data.byteOffset+2*s*4,2),t.getTypeInfo(`vec2${l}`));else if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h"||r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h")c=new Xt(new Float32Array(this.data.buffer,this.data.byteOffset+3*s*4,3),t.getTypeInfo(`vec3${l}`));else{if(r!=="mat2x4"&&r!=="mat2x4f"&&r!=="mat2x4h"&&r!=="mat3x4"&&r!=="mat3x4f"&&r!=="mat3x4h"&&r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${r}`),null;c=new Xt(new Float32Array(this.data.buffer,this.data.byteOffset+4*s*4,4),t.getTypeInfo(`vec4${l}`))}return e.postfix?c.getSubData(t,e.postfix,n):c}return console.error("GetDataValue: Invalid postfix",e),null}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class $r extends za{constructor(t,e,n=0,r=null){super(e,r),this.buffer=t instanceof ArrayBuffer?t:t.buffer,this.offset=n}clone(){const t=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new $r(t.buffer,this.typeInfo,0,null)}setDataValue(t,e,n,r){if(e===null)return void console.log("setDataValue: NULL data.");let o=this.offset,s=this.typeInfo;for(;n;){if(n instanceof mp)if(s instanceof Xc){const l=n.index;if(l instanceof Cs){if(!(l.value instanceof ae))return void console.error(`SetDataValue: Invalid index type ${l.value}`);o+=l.value.value*s.stride}else{const c=t.evalExpression(l,r);if(!(c instanceof ae))return void console.error("SetDataValue: Unknown index type",l);o+=c.value*s.stride}s=s.format}else console.error(`SetDataValue: Type ${s.getTypeName()} is not an array`);else{if(!(n instanceof nf))return void console.error("SetDataValue: Unknown postfix type",n);{const l=n.value;if(s instanceof Gc){let c=!1;for(const y of s.members)if(y.name===l){o+=y.offset,s=y.type,c=!0;break}if(!c)return void console.error(`SetDataValue: Member ${l} not found`)}else if(s instanceof Fa){const c=s.getTypeName();let y=0;if(l==="x"||l==="r")y=0;else if(l==="y"||l==="g")y=1;else if(l==="z"||l==="b")y=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);y=3}if(!(e instanceof ae))return void console.error("SetDataValue: Invalid value",e);const _=e.value;return c==="vec2f"?void(new Float32Array(this.buffer,o,2)[y]=_):c==="vec3f"?void(new Float32Array(this.buffer,o,3)[y]=_):c==="vec4f"?void(new Float32Array(this.buffer,o,4)[y]=_):c==="vec2i"?void(new Int32Array(this.buffer,o,2)[y]=_):c==="vec3i"?void(new Int32Array(this.buffer,o,3)[y]=_):c==="vec4i"?void(new Int32Array(this.buffer,o,4)[y]=_):c==="vec2u"?void(new Uint32Array(this.buffer,o,2)[y]=_):c==="vec3u"?void(new Uint32Array(this.buffer,o,3)[y]=_):c==="vec4u"?void(new Uint32Array(this.buffer,o,4)[y]=_):void console.error(`SetDataValue: Type ${c} is not a struct`)}}}n=n.postfix}this.setData(t,e,s,o,r)}setData(t,e,n,r,o){const s=n.getTypeName();if(s!=="f32"&&s!=="f16")if(s!=="i32"&&s!=="atomic<i32>"&&s!=="x32")if(s!=="u32"&&s!=="atomic<u32>")if(s!=="bool"){if(s==="vec2f"||s==="vec2h"){const l=new Float32Array(this.buffer,r,2);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(s==="vec3f"||s==="vec3h"){const l=new Float32Array(this.buffer,r,3);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(s==="vec4f"||s==="vec4h"){const l=new Float32Array(this.buffer,r,4);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(s==="vec2i"){const l=new Int32Array(this.buffer,r,2);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(s==="vec3i"){const l=new Int32Array(this.buffer,r,3);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(s==="vec4i"){const l=new Int32Array(this.buffer,r,4);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(s==="vec2u"){const l=new Uint32Array(this.buffer,r,2);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(s==="vec3u"){const l=new Uint32Array(this.buffer,r,3);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(s==="vec4u"){const l=new Uint32Array(this.buffer,r,4);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(s==="vec2b"){const l=new Uint32Array(this.buffer,r,2);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1]))}if(s==="vec3b"){const l=new Uint32Array(this.buffer,r,3);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2]))}if(s==="vec4b"){const l=new Uint32Array(this.buffer,r,4);return void(e instanceof Xt?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(s==="mat2x2f"||s==="mat2x2h"){const l=new Float32Array(this.buffer,r,4);return void(e instanceof ln?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3]))}if(s==="mat2x3f"||s==="mat2x3h"){const l=new Float32Array(this.buffer,r,6);return void(e instanceof ln?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5]))}if(s==="mat2x4f"||s==="mat2x4h"){const l=new Float32Array(this.buffer,r,8);return void(e instanceof ln?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7]))}if(s==="mat3x2f"||s==="mat3x2h"){const l=new Float32Array(this.buffer,r,6);return void(e instanceof ln?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5]))}if(s==="mat3x3f"||s==="mat3x3h"){const l=new Float32Array(this.buffer,r,9);return void(e instanceof ln?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8]))}if(s==="mat3x4f"||s==="mat3x4h"){const l=new Float32Array(this.buffer,r,12);return void(e instanceof ln?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11]))}if(s==="mat4x2f"||s==="mat4x2h"){const l=new Float32Array(this.buffer,r,8);return void(e instanceof ln?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7]))}if(s==="mat4x3f"||s==="mat4x3h"){const l=new Float32Array(this.buffer,r,12);return void(e instanceof ln?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11]))}if(s==="mat4x4f"||s==="mat4x4h"){const l=new Float32Array(this.buffer,r,16);return void(e instanceof ln?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11],l[12]=e.data[12],l[13]=e.data[13],l[14]=e.data[14],l[15]=e.data[15]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11],l[12]=e[12],l[13]=e[13],l[14]=e[14],l[15]=e[15]))}if(e instanceof $r){if(n===e.typeInfo)return void new Uint8Array(this.buffer,r,e.buffer.byteLength).set(new Uint8Array(e.buffer));console.error("SetDataValue: Type mismatch",s,e.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${s}`)}else e instanceof ae&&(new Int32Array(this.buffer,r,1)[0]=e.value);else e instanceof ae&&(new Uint32Array(this.buffer,r,1)[0]=e.value);else e instanceof ae&&(new Int32Array(this.buffer,r,1)[0]=e.value);else e instanceof ae&&(new Float32Array(this.buffer,r,1)[0]=e.value)}getSubData(t,e,n){var r,o,s;if(e===null)return this;let l=this.offset,c=this.typeInfo;for(;e;){if(e instanceof mp){const _=e.index,C=_ instanceof xl?t.evalExpression(_,n):_;let I=0;if(C instanceof ae?I=C.value:typeof C=="number"?I=C:console.error("GetDataValue: Invalid index type",_),c instanceof Xc)l+=I*c.stride,c=c.format;else{const k=c.getTypeName();k==="mat4x4"||k==="mat4x4f"||k==="mat4x4h"?(l+=16*I,c=t.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${c.getTypeName()} is not an array`)}}else{if(!(e instanceof nf))return console.error("GetDataValue: Unknown postfix type",e),null;{const _=e.value;if(c instanceof Gc){let C=!1;for(const I of c.members)if(I.name===_){l+=I.offset,c=I.type,C=!0;break}if(!C)return console.error(`GetDataValue: Member ${_} not found`),null}else if(c instanceof Fa){const C=c.getTypeName();if(C==="vec2f"||C==="vec3f"||C==="vec4f"||C==="vec2i"||C==="vec3i"||C==="vec4i"||C==="vec2u"||C==="vec3u"||C==="vec4u"||C==="vec2b"||C==="vec3b"||C==="vec4b"||C==="vec2h"||C==="vec3h"||C==="vec4h"||C==="vec2"||C==="vec3"||C==="vec4"){if(_.length>0&&_.length<5){let I="f";const k=[];for(let z=0;z<_.length;++z){const V=_[z].toLowerCase();let X=0;if(V==="x"||V==="r")X=0;else if(V==="y"||V==="g")X=1;else if(V==="z"||V==="b")X=2;else{if(V!=="w"&&V!=="a")return console.error(`Unknown member ${_}`),null;X=3}if(_.length===1){if(C.endsWith("f"))return this.buffer.byteLength<l+4*X+4?(console.log("Insufficient buffer data"),null):new ae(new Float32Array(this.buffer,l+4*X,1),t.getTypeInfo("f32"),this);if(C.endsWith("h"))return new ae(new Float32Array(this.buffer,l+4*X,1),t.getTypeInfo("f16"),this);if(C.endsWith("i"))return new ae(new Int32Array(this.buffer,l+4*X,1),t.getTypeInfo("i32"),this);if(C.endsWith("b"))return new ae(new Int32Array(this.buffer,l+4*X,1),t.getTypeInfo("bool"),this);if(C.endsWith("u"))return new ae(new Uint32Array(this.buffer,l+4*X,1),t.getTypeInfo("i32"),this)}if(C==="vec2f")k.push(new Float32Array(this.buffer,l,2)[X]);else if(C==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const H=new Float32Array(this.buffer,l,3);k.push(H[X])}else if(C==="vec4f")k.push(new Float32Array(this.buffer,l,4)[X]);else if(C==="vec2i")I="i",k.push(new Int32Array(this.buffer,l,2)[X]);else if(C==="vec3i")I="i",k.push(new Int32Array(this.buffer,l,3)[X]);else if(C==="vec4i")I="i",k.push(new Int32Array(this.buffer,l,4)[X]);else if(C==="vec2u"){I="u";const H=new Uint32Array(this.buffer,l,2);k.push(H[X])}else C==="vec3u"?(I="u",k.push(new Uint32Array(this.buffer,l,3)[X])):C==="vec4u"&&(I="u",k.push(new Uint32Array(this.buffer,l,4)[X]))}return k.length===2?c=t.getTypeInfo(`vec2${I}`):k.length===3?c=t.getTypeInfo(`vec3${I}`):k.length===4?c=t.getTypeInfo(`vec4${I}`):console.error(`GetDataValue: Invalid vector length ${k.length}`),new Xt(k,c,null)}return console.error(`GetDataValue: Unknown member ${_}`),null}return console.error(`GetDataValue: Type ${C} is not a struct`),null}}}e=e.postfix}const y=c.getTypeName();return y==="f32"?new ae(new Float32Array(this.buffer,l,1),c,this):y==="i32"?new ae(new Int32Array(this.buffer,l,1),c,this):y==="u32"?new ae(new Uint32Array(this.buffer,l,1),c,this):y==="vec2f"?new Xt(new Float32Array(this.buffer,l,2),c,this):y==="vec3f"?new Xt(new Float32Array(this.buffer,l,3),c,this):y==="vec4f"?new Xt(new Float32Array(this.buffer,l,4),c,this):y==="vec2i"?new Xt(new Int32Array(this.buffer,l,2),c,this):y==="vec3i"?new Xt(new Int32Array(this.buffer,l,3),c,this):y==="vec4i"?new Xt(new Int32Array(this.buffer,l,4),c,this):y==="vec2u"?new Xt(new Uint32Array(this.buffer,l,2),c,this):y==="vec3u"?new Xt(new Uint32Array(this.buffer,l,3),c,this):y==="vec4u"?new Xt(new Uint32Array(this.buffer,l,4),c,this):c instanceof ef&&c.name==="atomic"?((r=c.format)===null||r===void 0?void 0:r.name)==="u32"?new ae(new Uint32Array(this.buffer,l,1)[0],c.format,this):((o=c.format)===null||o===void 0?void 0:o.name)==="i32"?new ae(new Int32Array(this.buffer,l,1)[0],c.format,this):(console.error(`GetDataValue: Invalid atomic format ${(s=c.format)===null||s===void 0?void 0:s.name}`),null):new $r(this.buffer,c,l,this)}toString(){let t="";if(this.typeInfo instanceof Xc)if(this.typeInfo.format.name==="f32"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let n=1;n<e.length;++n)t+=`, ${e[n]}`}else if(this.typeInfo.format.name==="i32"){const e=new Int32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let n=1;n<e.length;++n)t+=`, ${e[n]}`}else if(this.typeInfo.format.name==="u32"){const e=new Uint32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let n=1;n<e.length;++n)t+=`, ${e[n]}`}else if(this.typeInfo.format.name==="vec2f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}]`;for(let n=1;n<e.length/2;++n)t+=`, [${e[2*n]}, ${e[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}]`;for(let n=4;n<e.length;n+=4)t+=`, [${e[n]}, ${e[n+1]}, ${e[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}]`;for(let n=4;n<e.length;n+=4)t+=`, [${e[n]}, ${e[n+1]}, ${e[n+2]}, ${e[n+3]}]`}else t="[...]";else this.typeInfo instanceof Gc?t+="{...}":t="[...]";return t}}class ju extends za{constructor(t,e,n,r){super(e,null),this.data=t,this.descriptor=n,this.view=r}clone(){return new ju(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var t,e;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(t=n[0])!==null&&t!==void 0?t:0:n instanceof Object&&(e=n.width)!==null&&e!==void 0?e:0}get height(){var t,e;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(t=n[1])!==null&&t!==void 0?t:0:n instanceof Object&&(e=n.height)!==null&&e!==void 0?e:0}get depthOrArrayLayers(){var t,e;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(t=n[2])!==null&&t!==void 0?t:0:n instanceof Object&&(e=n.depthOrArrayLayers)!==null&&e!==void 0?e:0}get format(){var t;return this.descriptor&&(t=this.descriptor.format)!==null&&t!==void 0?t:"rgba8unorm"}get sampleCount(){var t;return this.descriptor&&(t=this.descriptor.sampleCount)!==null&&t!==void 0?t:1}get mipLevelCount(){var t;return this.descriptor&&(t=this.descriptor.mipLevelCount)!==null&&t!==void 0?t:1}get dimension(){var t;return this.descriptor&&(t=this.descriptor.dimension)!==null&&t!==void 0?t:"2d"}getMipLevelSize(t){if(t>=this.mipLevelCount)return[0,0,0];const e=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<e.length;++n)e[n]=Math.max(1,e[n]>>t);return e}get texelByteSize(){const t=this.format,e=__[t];return e?e.isDepthStencil?4:e.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const t=this.format,e=__[t];return!!e&&e.isDepthStencil}getGpuSize(){const t=this.format,e=__[t],n=this.width;if(!t||n<=0||!e)return-1;const r=this.height,o=this.depthOrArrayLayers,s=this.dimension;return n/e.blockWidth*(s==="1d"?1:r/e.blockHeight)*e.bytesPerBlock*o}getPixel(t,e,n=0,r=0){const o=this.texelByteSize,s=this.bytesPerRow,l=this.height,c=this.data[r];return T7(new Uint8Array(c),t,e,n,r,l,s,o,this.format)}setPixel(t,e,n,r,o){const s=this.texelByteSize,l=this.bytesPerRow,c=this.height,y=this.data[r];(function(_,C,I,k,z,V,X,H,$,Y){const ct=k*(X>>=z)*(V>>=z)+I*X+C*H;switch($){case"r8unorm":return void nr(_,ct,"8unorm",1,Y);case"r8snorm":return void nr(_,ct,"8snorm",1,Y);case"r8uint":return void nr(_,ct,"8uint",1,Y);case"r8sint":return void nr(_,ct,"8sint",1,Y);case"rg8unorm":return void nr(_,ct,"8unorm",2,Y);case"rg8snorm":return void nr(_,ct,"8snorm",2,Y);case"rg8uint":return void nr(_,ct,"8uint",2,Y);case"rg8sint":return void nr(_,ct,"8sint",2,Y);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void nr(_,ct,"8unorm",4,Y);case"rgba8snorm":return void nr(_,ct,"8snorm",4,Y);case"rgba8uint":return void nr(_,ct,"8uint",4,Y);case"rgba8sint":return void nr(_,ct,"8sint",4,Y);case"r16uint":return void nr(_,ct,"16uint",1,Y);case"r16sint":return void nr(_,ct,"16sint",1,Y);case"r16float":return void nr(_,ct,"16float",1,Y);case"rg16uint":return void nr(_,ct,"16uint",2,Y);case"rg16sint":return void nr(_,ct,"16sint",2,Y);case"rg16float":return void nr(_,ct,"16float",2,Y);case"rgba16uint":return void nr(_,ct,"16uint",4,Y);case"rgba16sint":return void nr(_,ct,"16sint",4,Y);case"rgba16float":return void nr(_,ct,"16float",4,Y);case"r32uint":return void nr(_,ct,"32uint",1,Y);case"r32sint":return void nr(_,ct,"32sint",1,Y);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void nr(_,ct,"32float",1,Y);case"rg32uint":return void nr(_,ct,"32uint",2,Y);case"rg32sint":return void nr(_,ct,"32sint",2,Y);case"rg32float":return void nr(_,ct,"32float",2,Y);case"rgba32uint":return void nr(_,ct,"32uint",4,Y);case"rgba32sint":return void nr(_,ct,"32sint",4,Y);case"rgba32float":return void nr(_,ct,"32float",4,Y);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(y),t,e,n,r,c,l,s,this.format,o)}}(i=>{i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(ce||(ce={}));class he{constructor(t,e,n){this.name=t,this.type=e,this.rule=n}toString(){return this.name}}class kt{}xe=kt,kt.none=new he("",ce.reserved,""),kt.eof=new he("EOF",ce.token,""),kt.reserved={asm:new he("asm",ce.reserved,"asm"),bf16:new he("bf16",ce.reserved,"bf16"),do:new he("do",ce.reserved,"do"),enum:new he("enum",ce.reserved,"enum"),f16:new he("f16",ce.reserved,"f16"),f64:new he("f64",ce.reserved,"f64"),handle:new he("handle",ce.reserved,"handle"),i8:new he("i8",ce.reserved,"i8"),i16:new he("i16",ce.reserved,"i16"),i64:new he("i64",ce.reserved,"i64"),mat:new he("mat",ce.reserved,"mat"),premerge:new he("premerge",ce.reserved,"premerge"),regardless:new he("regardless",ce.reserved,"regardless"),typedef:new he("typedef",ce.reserved,"typedef"),u8:new he("u8",ce.reserved,"u8"),u16:new he("u16",ce.reserved,"u16"),u64:new he("u64",ce.reserved,"u64"),unless:new he("unless",ce.reserved,"unless"),using:new he("using",ce.reserved,"using"),vec:new he("vec",ce.reserved,"vec"),void:new he("void",ce.reserved,"void")},kt.keywords={array:new he("array",ce.keyword,"array"),atomic:new he("atomic",ce.keyword,"atomic"),bool:new he("bool",ce.keyword,"bool"),f32:new he("f32",ce.keyword,"f32"),i32:new he("i32",ce.keyword,"i32"),mat2x2:new he("mat2x2",ce.keyword,"mat2x2"),mat2x3:new he("mat2x3",ce.keyword,"mat2x3"),mat2x4:new he("mat2x4",ce.keyword,"mat2x4"),mat3x2:new he("mat3x2",ce.keyword,"mat3x2"),mat3x3:new he("mat3x3",ce.keyword,"mat3x3"),mat3x4:new he("mat3x4",ce.keyword,"mat3x4"),mat4x2:new he("mat4x2",ce.keyword,"mat4x2"),mat4x3:new he("mat4x3",ce.keyword,"mat4x3"),mat4x4:new he("mat4x4",ce.keyword,"mat4x4"),ptr:new he("ptr",ce.keyword,"ptr"),sampler:new he("sampler",ce.keyword,"sampler"),sampler_comparison:new he("sampler_comparison",ce.keyword,"sampler_comparison"),struct:new he("struct",ce.keyword,"struct"),texture_1d:new he("texture_1d",ce.keyword,"texture_1d"),texture_2d:new he("texture_2d",ce.keyword,"texture_2d"),texture_2d_array:new he("texture_2d_array",ce.keyword,"texture_2d_array"),texture_3d:new he("texture_3d",ce.keyword,"texture_3d"),texture_cube:new he("texture_cube",ce.keyword,"texture_cube"),texture_cube_array:new he("texture_cube_array",ce.keyword,"texture_cube_array"),texture_multisampled_2d:new he("texture_multisampled_2d",ce.keyword,"texture_multisampled_2d"),texture_storage_1d:new he("texture_storage_1d",ce.keyword,"texture_storage_1d"),texture_storage_2d:new he("texture_storage_2d",ce.keyword,"texture_storage_2d"),texture_storage_2d_array:new he("texture_storage_2d_array",ce.keyword,"texture_storage_2d_array"),texture_storage_3d:new he("texture_storage_3d",ce.keyword,"texture_storage_3d"),texture_depth_2d:new he("texture_depth_2d",ce.keyword,"texture_depth_2d"),texture_depth_2d_array:new he("texture_depth_2d_array",ce.keyword,"texture_depth_2d_array"),texture_depth_cube:new he("texture_depth_cube",ce.keyword,"texture_depth_cube"),texture_depth_cube_array:new he("texture_depth_cube_array",ce.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new he("texture_depth_multisampled_2d",ce.keyword,"texture_depth_multisampled_2d"),texture_external:new he("texture_external",ce.keyword,"texture_external"),u32:new he("u32",ce.keyword,"u32"),vec2:new he("vec2",ce.keyword,"vec2"),vec3:new he("vec3",ce.keyword,"vec3"),vec4:new he("vec4",ce.keyword,"vec4"),bitcast:new he("bitcast",ce.keyword,"bitcast"),block:new he("block",ce.keyword,"block"),break:new he("break",ce.keyword,"break"),case:new he("case",ce.keyword,"case"),continue:new he("continue",ce.keyword,"continue"),continuing:new he("continuing",ce.keyword,"continuing"),default:new he("default",ce.keyword,"default"),diagnostic:new he("diagnostic",ce.keyword,"diagnostic"),discard:new he("discard",ce.keyword,"discard"),else:new he("else",ce.keyword,"else"),enable:new he("enable",ce.keyword,"enable"),fallthrough:new he("fallthrough",ce.keyword,"fallthrough"),false:new he("false",ce.keyword,"false"),fn:new he("fn",ce.keyword,"fn"),for:new he("for",ce.keyword,"for"),function:new he("function",ce.keyword,"function"),if:new he("if",ce.keyword,"if"),let:new he("let",ce.keyword,"let"),const:new he("const",ce.keyword,"const"),loop:new he("loop",ce.keyword,"loop"),while:new he("while",ce.keyword,"while"),private:new he("private",ce.keyword,"private"),read:new he("read",ce.keyword,"read"),read_write:new he("read_write",ce.keyword,"read_write"),return:new he("return",ce.keyword,"return"),requires:new he("requires",ce.keyword,"requires"),storage:new he("storage",ce.keyword,"storage"),switch:new he("switch",ce.keyword,"switch"),true:new he("true",ce.keyword,"true"),alias:new he("alias",ce.keyword,"alias"),type:new he("type",ce.keyword,"type"),uniform:new he("uniform",ce.keyword,"uniform"),var:new he("var",ce.keyword,"var"),override:new he("override",ce.keyword,"override"),workgroup:new he("workgroup",ce.keyword,"workgroup"),write:new he("write",ce.keyword,"write"),r8unorm:new he("r8unorm",ce.keyword,"r8unorm"),r8snorm:new he("r8snorm",ce.keyword,"r8snorm"),r8uint:new he("r8uint",ce.keyword,"r8uint"),r8sint:new he("r8sint",ce.keyword,"r8sint"),r16uint:new he("r16uint",ce.keyword,"r16uint"),r16sint:new he("r16sint",ce.keyword,"r16sint"),r16float:new he("r16float",ce.keyword,"r16float"),rg8unorm:new he("rg8unorm",ce.keyword,"rg8unorm"),rg8snorm:new he("rg8snorm",ce.keyword,"rg8snorm"),rg8uint:new he("rg8uint",ce.keyword,"rg8uint"),rg8sint:new he("rg8sint",ce.keyword,"rg8sint"),r32uint:new he("r32uint",ce.keyword,"r32uint"),r32sint:new he("r32sint",ce.keyword,"r32sint"),r32float:new he("r32float",ce.keyword,"r32float"),rg16uint:new he("rg16uint",ce.keyword,"rg16uint"),rg16sint:new he("rg16sint",ce.keyword,"rg16sint"),rg16float:new he("rg16float",ce.keyword,"rg16float"),rgba8unorm:new he("rgba8unorm",ce.keyword,"rgba8unorm"),rgba8unorm_srgb:new he("rgba8unorm_srgb",ce.keyword,"rgba8unorm_srgb"),rgba8snorm:new he("rgba8snorm",ce.keyword,"rgba8snorm"),rgba8uint:new he("rgba8uint",ce.keyword,"rgba8uint"),rgba8sint:new he("rgba8sint",ce.keyword,"rgba8sint"),bgra8unorm:new he("bgra8unorm",ce.keyword,"bgra8unorm"),bgra8unorm_srgb:new he("bgra8unorm_srgb",ce.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new he("rgb10a2unorm",ce.keyword,"rgb10a2unorm"),rg11b10float:new he("rg11b10float",ce.keyword,"rg11b10float"),rg32uint:new he("rg32uint",ce.keyword,"rg32uint"),rg32sint:new he("rg32sint",ce.keyword,"rg32sint"),rg32float:new he("rg32float",ce.keyword,"rg32float"),rgba16uint:new he("rgba16uint",ce.keyword,"rgba16uint"),rgba16sint:new he("rgba16sint",ce.keyword,"rgba16sint"),rgba16float:new he("rgba16float",ce.keyword,"rgba16float"),rgba32uint:new he("rgba32uint",ce.keyword,"rgba32uint"),rgba32sint:new he("rgba32sint",ce.keyword,"rgba32sint"),rgba32float:new he("rgba32float",ce.keyword,"rgba32float"),static_assert:new he("static_assert",ce.keyword,"static_assert")},kt.tokens={decimal_float_literal:new he("decimal_float_literal",ce.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new he("hex_float_literal",ce.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new he("int_literal",ce.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new he("uint_literal",ce.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new he("name",ce.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new he("ident",ce.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new he("and",ce.token,"&"),and_and:new he("and_and",ce.token,"&&"),arrow:new he("arrow ",ce.token,"->"),attr:new he("attr",ce.token,"@"),forward_slash:new he("forward_slash",ce.token,"/"),bang:new he("bang",ce.token,"!"),bracket_left:new he("bracket_left",ce.token,"["),bracket_right:new he("bracket_right",ce.token,"]"),brace_left:new he("brace_left",ce.token,"{"),brace_right:new he("brace_right",ce.token,"}"),colon:new he("colon",ce.token,":"),comma:new he("comma",ce.token,","),equal:new he("equal",ce.token,"="),equal_equal:new he("equal_equal",ce.token,"=="),not_equal:new he("not_equal",ce.token,"!="),greater_than:new he("greater_than",ce.token,">"),greater_than_equal:new he("greater_than_equal",ce.token,">="),shift_right:new he("shift_right",ce.token,">>"),less_than:new he("less_than",ce.token,"<"),less_than_equal:new he("less_than_equal",ce.token,"<="),shift_left:new he("shift_left",ce.token,"<<"),modulo:new he("modulo",ce.token,"%"),minus:new he("minus",ce.token,"-"),minus_minus:new he("minus_minus",ce.token,"--"),period:new he("period",ce.token,"."),plus:new he("plus",ce.token,"+"),plus_plus:new he("plus_plus",ce.token,"++"),or:new he("or",ce.token,"|"),or_or:new he("or_or",ce.token,"||"),paren_left:new he("paren_left",ce.token,"("),paren_right:new he("paren_right",ce.token,")"),semicolon:new he("semicolon",ce.token,";"),star:new he("star",ce.token,"*"),tilde:new he("tilde",ce.token,"~"),underscore:new he("underscore",ce.token,"_"),xor:new he("xor",ce.token,"^"),plus_equal:new he("plus_equal",ce.token,"+="),minus_equal:new he("minus_equal",ce.token,"-="),times_equal:new he("times_equal",ce.token,"*="),division_equal:new he("division_equal",ce.token,"/="),modulo_equal:new he("modulo_equal",ce.token,"%="),and_equal:new he("and_equal",ce.token,"&="),or_equal:new he("or_equal",ce.token,"|="),xor_equal:new he("xor_equal",ce.token,"^="),shift_right_equal:new he("shift_right_equal",ce.token,">>="),shift_left_equal:new he("shift_left_equal",ce.token,"<<=")},kt.simpleTokens={"@":xe.tokens.attr,"{":xe.tokens.brace_left,"}":xe.tokens.brace_right,":":xe.tokens.colon,",":xe.tokens.comma,"(":xe.tokens.paren_left,")":xe.tokens.paren_right,";":xe.tokens.semicolon},kt.literalTokens={"&":xe.tokens.and,"&&":xe.tokens.and_and,"->":xe.tokens.arrow,"/":xe.tokens.forward_slash,"!":xe.tokens.bang,"[":xe.tokens.bracket_left,"]":xe.tokens.bracket_right,"=":xe.tokens.equal,"==":xe.tokens.equal_equal,"!=":xe.tokens.not_equal,">":xe.tokens.greater_than,">=":xe.tokens.greater_than_equal,">>":xe.tokens.shift_right,"<":xe.tokens.less_than,"<=":xe.tokens.less_than_equal,"<<":xe.tokens.shift_left,"%":xe.tokens.modulo,"-":xe.tokens.minus,"--":xe.tokens.minus_minus,".":xe.tokens.period,"+":xe.tokens.plus,"++":xe.tokens.plus_plus,"|":xe.tokens.or,"||":xe.tokens.or_or,"*":xe.tokens.star,"~":xe.tokens.tilde,_:xe.tokens.underscore,"^":xe.tokens.xor,"+=":xe.tokens.plus_equal,"-=":xe.tokens.minus_equal,"*=":xe.tokens.times_equal,"/=":xe.tokens.division_equal,"%=":xe.tokens.modulo_equal,"&=":xe.tokens.and_equal,"|=":xe.tokens.or_equal,"^=":xe.tokens.xor_equal,">>=":xe.tokens.shift_right_equal,"<<=":xe.tokens.shift_left_equal},kt.regexTokens={decimal_float_literal:xe.tokens.decimal_float_literal,hex_float_literal:xe.tokens.hex_float_literal,int_literal:xe.tokens.int_literal,uint_literal:xe.tokens.uint_literal,ident:xe.tokens.ident},kt.storage_class=[xe.keywords.function,xe.keywords.private,xe.keywords.workgroup,xe.keywords.uniform,xe.keywords.storage],kt.access_mode=[xe.keywords.read,xe.keywords.write,xe.keywords.read_write],kt.sampler_type=[xe.keywords.sampler,xe.keywords.sampler_comparison],kt.sampled_texture_type=[xe.keywords.texture_1d,xe.keywords.texture_2d,xe.keywords.texture_2d_array,xe.keywords.texture_3d,xe.keywords.texture_cube,xe.keywords.texture_cube_array],kt.multisampled_texture_type=[xe.keywords.texture_multisampled_2d],kt.storage_texture_type=[xe.keywords.texture_storage_1d,xe.keywords.texture_storage_2d,xe.keywords.texture_storage_2d_array,xe.keywords.texture_storage_3d],kt.depth_texture_type=[xe.keywords.texture_depth_2d,xe.keywords.texture_depth_2d_array,xe.keywords.texture_depth_cube,xe.keywords.texture_depth_cube_array,xe.keywords.texture_depth_multisampled_2d],kt.texture_external_type=[xe.keywords.texture_external],kt.any_texture_type=[...xe.sampled_texture_type,...xe.multisampled_texture_type,...xe.storage_texture_type,...xe.depth_texture_type,...xe.texture_external_type],kt.texel_format=[xe.keywords.r8unorm,xe.keywords.r8snorm,xe.keywords.r8uint,xe.keywords.r8sint,xe.keywords.r16uint,xe.keywords.r16sint,xe.keywords.r16float,xe.keywords.rg8unorm,xe.keywords.rg8snorm,xe.keywords.rg8uint,xe.keywords.rg8sint,xe.keywords.r32uint,xe.keywords.r32sint,xe.keywords.r32float,xe.keywords.rg16uint,xe.keywords.rg16sint,xe.keywords.rg16float,xe.keywords.rgba8unorm,xe.keywords.rgba8unorm_srgb,xe.keywords.rgba8snorm,xe.keywords.rgba8uint,xe.keywords.rgba8sint,xe.keywords.bgra8unorm,xe.keywords.bgra8unorm_srgb,xe.keywords.rgb10a2unorm,xe.keywords.rg11b10float,xe.keywords.rg32uint,xe.keywords.rg32sint,xe.keywords.rg32float,xe.keywords.rgba16uint,xe.keywords.rgba16sint,xe.keywords.rgba16float,xe.keywords.rgba32uint,xe.keywords.rgba32sint,xe.keywords.rgba32float],kt.const_literal=[xe.tokens.int_literal,xe.tokens.uint_literal,xe.tokens.decimal_float_literal,xe.tokens.hex_float_literal,xe.keywords.true,xe.keywords.false],kt.literal_or_ident=[xe.tokens.ident,xe.tokens.int_literal,xe.tokens.uint_literal,xe.tokens.decimal_float_literal,xe.tokens.hex_float_literal,xe.tokens.name],kt.element_count_expression=[xe.tokens.int_literal,xe.tokens.uint_literal,xe.tokens.ident],kt.template_types=[xe.keywords.vec2,xe.keywords.vec3,xe.keywords.vec4,xe.keywords.mat2x2,xe.keywords.mat2x3,xe.keywords.mat2x4,xe.keywords.mat3x2,xe.keywords.mat3x3,xe.keywords.mat3x4,xe.keywords.mat4x2,xe.keywords.mat4x3,xe.keywords.mat4x4,xe.keywords.atomic,xe.keywords.bitcast,...xe.any_texture_type],kt.attribute_name=[xe.tokens.ident,xe.keywords.block,xe.keywords.diagnostic],kt.assignment_operators=[xe.tokens.equal,xe.tokens.plus_equal,xe.tokens.minus_equal,xe.tokens.times_equal,xe.tokens.division_equal,xe.tokens.modulo_equal,xe.tokens.and_equal,xe.tokens.or_equal,xe.tokens.xor_equal,xe.tokens.shift_right_equal,xe.tokens.shift_left_equal],kt.increment_operators=[xe.tokens.plus_plus,xe.tokens.minus_minus];class KC{constructor(t,e,n,r,o){this.type=t,this.lexeme=e,this.line=n,this.start=r,this.end=o}toString(){return this.lexeme}isTemplateType(){return kt.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==kt.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class L7{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new KC(kt.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}const e=kt.simpleTokens[t];if(e)return this._addToken(e),!0;let n=kt.none;const r=this._isAlpha(t),o=t==="_";if(this._isAlphaNumeric(t)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)t+=this._advance(),s=this._peekAhead()}if(r){const s=kt.keywords[t];if(s)return this._addToken(s),!0}if(r||o)return this._addToken(kt.tokens.ident),!0;for(;;){let s=this._findType(t);const l=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(l=="=")return this._current++,t+=l,this._addToken(kt.tokens.minus_equal),!0;if(l=="-")return this._current++,t+=l,this._addToken(kt.tokens.minus_minus),!0;const c=this._tokens.length-1;if((kt.literal_or_ident.indexOf(this._tokens[c].type)!=-1||this._tokens[c].type==kt.tokens.paren_right)&&l!=">")return this._addToken(s),!0}if(t==">"&&(l==">"||l=="=")){let c=!1,y=this._tokens.length-1;for(let _=0;_<5&&y>=0&&kt.assignment_operators.indexOf(this._tokens[y].type)===-1;++_,--y)if(this._tokens[y].type===kt.tokens.less_than){y>0&&this._tokens[y-1].isArrayOrTemplateType()&&(c=!0);break}if(c)return this._addToken(s),!0}if(s===kt.none){let c=t,y=0;const _=2;for(let C=0;C<_;++C)if(c+=this._peekAhead(C),s=this._findType(c),s!==kt.none){y=C;break}if(s===kt.none)return n!==kt.none&&(this._current--,this._addToken(n),!0);t=c,this._current+=y+1}if(n=s,this._isAtEnd())break;t+=this._advance()}return n!==kt.none&&(this._addToken(n),!0)}_findType(t){for(const e in kt.regexTokens){const n=kt.regexTokens[e];if(this._match(t,n.rule))return n}return kt.literalTokens[t]||kt.none}_match(t,e){const n=e.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return!this._isNumeric(t)&&!this._isWhitespace(t)&&t!=="_"&&t!=="."&&t!=="("&&t!==")"&&t!=="["&&t!=="]"&&t!=="{"&&t!=="}"&&t!==","&&t!==";"&&t!==":"&&t!=="="&&t!=="!"&&t!=="<"&&t!==">"&&t!=="+"&&t!=="-"&&t!=="*"&&t!=="/"&&t!=="%"&&t!=="&"&&t!=="|"&&t!=="^"&&t!=="~"&&t!=="@"&&t!=="#"&&t!=="?"&&t!=="'"&&t!=="`"&&t!=='"'&&t!=="\\"&&t!==`
`&&t!=="\r"&&t!=="	"&&t!=="\0"}_isNumeric(t){return t>="0"&&t<="9"}_isAlphaNumeric(t){return this._isAlpha(t)||this._isNumeric(t)||t==="_"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new KC(t,e,this._line,this._start,this._current))}}function vi(i){return Array.isArray(i)||i?.buffer instanceof ArrayBuffer}const qg=new Float32Array(1),D7=new Uint32Array(qg.buffer),k7=new Uint32Array(qg.buffer),Kg=new Int32Array(1),O7=new Float32Array(Kg.buffer),F7=new Uint32Array(Kg.buffer),Zg=new Uint32Array(1),N7=new Float32Array(Zg.buffer),z7=new Int32Array(Zg.buffer);function ZC(i,t,e){if(t===e)return i;if(t==="f32"){if(e==="i32"||e==="x32")return qg[0]=i,D7[0];if(e==="u32")return qg[0]=i,k7[0]}else if(t==="i32"||t==="x32"){if(e==="f32")return Kg[0]=i,O7[0];if(e==="u32")return Kg[0]=i,F7[0]}else if(t==="u32"){if(e==="f32")return Zg[0]=i,N7[0];if(e==="i32"||e==="x32")return Zg[0]=i,z7[0]}return console.error(`Unsupported cast from ${t} to ${e}`),i}class U7{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class m0{constructor(t,e){this.align=t,this.size=e}}class nu{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new x7,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}updateAST(t){for(const e of t)e instanceof tm&&this._functions.set(e.name,new U7(e));for(const e of t)if(e instanceof Gu){const n=this.getTypeInfo(e,null);n instanceof Gc&&this.structs.push(n)}for(const e of t)if(e instanceof Ax)this.aliases.push(this._getAliasInfo(e));else{if(e instanceof dx){const n=e,r=this._getAttributeNum(n.attributes,"id",0),o=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new v7(n.name,o,n.attributes,r));continue}if(this._isUniformVar(e)){const n=e,r=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),l=new A0(n.name,s,r,o,n.attributes,Uc.Uniform,n.access);l.access||(l.access="read"),this.uniforms.push(l);continue}if(this._isStorageVar(e)){const n=e,r=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(s),c=new A0(n.name,s,r,o,n.attributes,l?Uc.StorageTexture:Uc.Storage,n.access);c.access||(c.access="read"),this.storage.push(c);continue}if(this._isTextureVar(e)){const n=e,r=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(s),c=new A0(n.name,s,r,o,n.attributes,l?Uc.StorageTexture:Uc.Texture,n.access);c.access||(c.access="read"),l?this.storage.push(c):this.textures.push(c);continue}if(this._isSamplerVar(e)){const n=e,r=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),l=new A0(n.name,s,r,o,n.attributes,Uc.Sampler,n.access);this.samplers.push(l);continue}}for(const e of t)if(e instanceof tm){const n=this._getAttribute(e,"vertex"),r=this._getAttribute(e,"fragment"),o=this._getAttribute(e,"compute"),s=n||r||o,l=new b7(e.name,s?.name,e.attributes);l.attributes=e.attributes,l.startLine=e.startLine,l.endLine=e.endLine,this.functions.push(l),this._functions.get(e.name).info=l,s&&(this._functions.get(e.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(e,!!s),l.inputs=this._getInputs(e.args),l.outputs=this._getOutputs(e.returnType),this.entry[s.name].push(l)),l.arguments=e.args.map(c=>new _7(c.name,this.getTypeInfo(c.type,c.attributes),c.attributes)),l.returnType=e.returnType?this.getTypeInfo(e.returnType,e.attributes):null;continue}for(const e of this._functions.values())e.info&&(e.info.inUse=e.inUse,this._addCalls(e.node,e.info.calls));for(const e of this._functions.values())e.node.search(n=>{var r,o,s;if(n instanceof fR){if(n.value)if(vi(n.value))for(const l of n.value)for(const c of this.overrides)l===c.name&&((r=e.info)===null||r===void 0||r.overrides.push(c));else for(const l of this.overrides)n.value===l.name&&((o=e.info)===null||o===void 0||o.overrides.push(l))}else if(n instanceof ca)for(const l of this.overrides)n.name===l.name&&((s=e.info)===null||s===void 0||s.overrides.push(l))});for(const e of this.uniforms)this._markStructsInUse(e.type);for(const e of this.storage)this._markStructsInUse(e.type)}getFunctionInfo(t){for(const e of this.functions)if(e.name==t)return e;return null}getStructInfo(t){for(const e of this.structs)if(e.name==t)return e;return null}getOverrideInfo(t){for(const e of this.overrides)if(e.name==t)return e;return null}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const e of t.members)this._markStructsInUse(e.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const e=this._getAlias(t.name);e&&this._markStructsInUse(e)}}_addCalls(t,e){var n;for(const r of t.calls){const o=(n=this._functions.get(r.name))===null||n===void 0?void 0:n.info;o&&e.add(o)}}findResource(t,e,n){if(n){for(const r of this.entry.compute)if(r.name===n){for(const o of r.resources)if(o.group==t&&o.binding==e)return o}for(const r of this.entry.vertex)if(r.name===n){for(const o of r.resources)if(o.group==t&&o.binding==e)return o}for(const r of this.entry.fragment)if(r.name===n){for(const o of r.resources)if(o.group==t&&o.binding==e)return o}}for(const r of this.uniforms)if(r.group==t&&r.binding==e)return r;for(const r of this.storage)if(r.group==t&&r.binding==e)return r;for(const r of this.textures)if(r.group==t&&r.binding==e)return r;for(const r of this.samplers)if(r.group==t&&r.binding==e)return r;return null}_findResource(t){for(const e of this.uniforms)if(e.name==t)return e;for(const e of this.storage)if(e.name==t)return e;for(const e of this.textures)if(e.name==t)return e;for(const e of this.samplers)if(e.name==t)return e;return null}_markStructsFromAST(t){const e=this.getTypeInfo(t,null);this._markStructsInUse(e)}_findResources(t,e){const n=[],r=this,o=[];return t.search(s=>{if(s instanceof Hg)o.push({});else if(s instanceof Xg)o.pop();else if(s instanceof Wu){const l=s;e&&l.type!==null&&this._markStructsFromAST(l.type),o.length>0&&(o[o.length-1][l.name]=l)}else if(s instanceof tu){const l=s;e&&l.type!==null&&this._markStructsFromAST(l.type)}else if(s instanceof NA){const l=s;e&&l.type!==null&&this._markStructsFromAST(l.type),o.length>0&&(o[o.length-1][l.name]=l)}else if(s instanceof ca){const l=s;if(o.length>0&&o[o.length-1][l.name])return;const c=r._findResource(l.name);c&&n.push(c)}else if(s instanceof mx){const l=s,c=r._functions.get(l.name);c&&(e&&(c.inUse=!0),t.calls.add(c.node),c.resources===null&&(c.resources=r._findResources(c.node,e)),n.push(...c.resources))}else if(s instanceof px){const l=s,c=r._functions.get(l.name);c&&(e&&(c.inUse=!0),t.calls.add(c.node),c.resources===null&&(c.resources=r._findResources(c.node,e)),n.push(...c.resources))}}),[...new Map(n.map(s=>[s.name,s])).values()]}getBindGroups(){const t=[];function e(n,r){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),r>=t[n].length&&(t[n].length=r+1)}for(const n of this.uniforms)e(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.storage)e(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.textures)e(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.samplers)e(n.group,n.binding),t[n.group][n.binding]=n;return t}_getOutputs(t,e=void 0){if(e===void 0&&(e=[]),t instanceof Gu)this._getStructOutputs(t,e);else{const n=this._getOutputInfo(t);n!==null&&e.push(n)}return e}_getStructOutputs(t,e){for(const n of t.members)if(n.type instanceof Gu)this._getStructOutputs(n.type,e);else{const r=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(r!==null){const o=this.getTypeInfo(n.type,n.type.attributes),s=this._parseInt(r.value),l=new jC(n.name,o,r.name,s);e.push(l)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const n=this.getTypeInfo(t,t.attributes),r=this._parseInt(e.value);return new jC("",n,e.name,r)}return null}_getInputs(t,e=void 0){e===void 0&&(e=[]);for(const n of t)if(n.type instanceof Gu)this._getStructInputs(n.type,e);else{const r=this._getInputInfo(n);r!==null&&e.push(r)}return e}_getStructInputs(t,e){for(const n of t.members)if(n.type instanceof Gu)this._getStructInputs(n.type,e);else{const r=this._getInputInfo(n);r!==null&&e.push(r)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const n=this._getAttribute(t,"interpolation"),r=this.getTypeInfo(t.type,t.attributes),o=this._parseInt(e.value),s=new y7(t.name,r,e.name,o);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new g7(t.name,this.getTypeInfo(t.type,null))}getTypeInfoByName(t){for(const e of this.structs)if(e.name==t)return e;for(const e of this.aliases)if(e.name==t)return e.type;return null}getTypeInfo(t,e=null){if(this._types.has(t))return this._types.get(t);if(t instanceof Ag){const r=t.type?this.getTypeInfo(t.type,t.attributes):null,o=new yb(t.name,r,e);return this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof zA){const r=t,o=r.format?this.getTypeInfo(r.format,r.attributes):null,s=new Xc(r.name,e);return s.format=o,s.count=r.count,this._types.set(t,s),this._updateTypeInfo(s),s}if(t instanceof Gu){const r=t,o=new Gc(r.name,e);o.startLine=r.startLine,o.endLine=r.endLine;for(const s of r.members){const l=this.getTypeInfo(s.type,s.attributes);o.members.push(new GC(s.name,l,s.attributes))}return this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof IA){const r=t,o=r.format instanceof He,s=r.format?o?this.getTypeInfo(r.format,null):new Fa(r.format,null):null,l=new ef(r.name,s,e,r.access);return this._types.set(t,l),this._updateTypeInfo(l),l}if(t instanceof me){const r=t,o=r.format?this.getTypeInfo(r.format,null):null,s=new ef(r.name,o,e,r.access);return this._types.set(t,s),this._updateTypeInfo(s),s}const n=new Fa(t.name,e);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var e,n,r;const o=this._getTypeSize(t);if(t.size=(e=o?.size)!==null&&e!==void 0?e:0,t instanceof Xc&&t.format){const s=this._getTypeSize(t.format);t.stride=Math.max((n=s?.size)!==null&&n!==void 0?n:0,(r=s?.align)!==null&&r!==void 0?r:0),this._updateTypeInfo(t.format)}t instanceof yb&&this._updateTypeInfo(t.format),t instanceof Gc&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let n=0,r=0,o=0,s=0;for(let l=0,c=t.members.length;l<c;++l){const y=t.members[l],_=this._getTypeSize(y);if(!_)continue;(e=this._getAlias(y.type.name))!==null&&e!==void 0||y.type;const C=_.align,I=_.size;n=this._roundUp(C,n+r),r=I,o=n,s=Math.max(s,C),y.offset=n,y.size=I,this._updateTypeInfo(y.type)}t.size=this._roundUp(s,o+r),t.align=s}_getTypeSize(t){var e,n;if(t==null)return null;const r=this._getAttributeNum(t.attributes,"size",0),o=this._getAttributeNum(t.attributes,"align",0);if(t instanceof GC&&(t=t.type),t instanceof Fa){const s=this._getAlias(t.name);s!==null&&(t=s)}{const s=nu._typeInfo[t.name];if(s!==void 0){const l=((e=t.format)===null||e===void 0?void 0:e.name)==="f16"?2:1;return new m0(Math.max(o,s.align/l),Math.max(r,s.size/l))}}{const s=nu._typeInfo[t.name.substring(0,t.name.length-1)];if(s){const l=t.name[t.name.length-1]==="h"?2:1;return new m0(Math.max(o,s.align/l),Math.max(r,s.size/l))}}if(t instanceof Xc){let s=t,l=8,c=8;const y=this._getTypeSize(s.format);return y!==null&&(c=y.size,l=y.align),c=s.count*this._getAttributeNum((n=t?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(l,c)),r&&(c=r),new m0(Math.max(o,l),Math.max(r,c))}if(t instanceof Gc){let s=0,l=0,c=0,y=0,_=0;for(const C of t.members){const I=this._getTypeSize(C.type);I!==null&&(s=Math.max(I.align,s),c=this._roundUp(I.align,c+y),y=I.size,_=c)}return l=this._roundUp(s,_+y),new m0(Math.max(o,s),Math.max(r,l))}return null}_isUniformVar(t){return t instanceof Wu&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Wu&&t.storage=="storage"}_isTextureVar(t){return t instanceof Wu&&t.type!==null&&nu._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Wu&&t.type!==null&&nu._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,e){const n=t;if(!n||!n.attributes)return null;const r=n.attributes;for(let o of r)if(o.name==e)return o;return null}_getAttributeNum(t,e,n){if(t===null)return n;for(let r of t)if(r.name==e){let o=r!==null&&r.value!==null?r.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(t,e){return Math.ceil(e/t)*t}}nu._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},nu._textureTypes=kt.any_texture_type.map(i=>i.name),nu._samplerTypes=kt.sampler_type.map(i=>i.name);let gx=0;class yx{constructor(t,e,n){this.id=gx++,this.name=t,this.value=e,this.node=n}clone(){return new yx(this.name,this.value,this.node)}}class vx{constructor(t){this.id=gx++,this.name=t.name,this.node=t}clone(){return new vx(this.node)}}class _x{constructor(t){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=gx++,t&&(this.parent=t,this.currentFunctionName=t.currentFunctionName)}getVariable(t){var e;return this.variables.has(t)?(e=this.variables.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getVariable(t):null}getFunction(t){var e;return this.functions.has(t)?(e=this.functions.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getFunction(t):null}createVariable(t,e,n){this.variables.set(t,new yx(t,e,n??null))}setVariable(t,e,n){const r=this.getVariable(t);r!==null?r.value=e:this.createVariable(t,e,n)}getVariableValue(t){var e;return(e=this.getVariable(t)?.value)!==null&&e!==void 0?e:null}clone(){return new _x(this)}}class V7{evalExpression(t,e){return null}getTypeInfo(t){return null}getVariableName(t,e){return""}}class G7{constructor(t){this.exec=t}getTypeInfo(t){return this.exec.getTypeInfo(t)}All(t,e){const n=this.exec.evalExpression(t.args[0],e);let r=!0;if(n instanceof Xt)return n.data.forEach(o=>{o||(r=!1)}),new ae(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${t.line}`)}Any(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt){const r=n.data.some(o=>o);return new ae(r?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${t.line}`)}Select(t,e){const n=this.exec.evalExpression(t.args[2],e);if(!(n instanceof ae))throw new Error(`Select() expects a bool condition. Line ${t.line}`);return n.value?this.exec.evalExpression(t.args[1],e):this.exec.evalExpression(t.args[0],e)}ArrayLength(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.evalExpression(n,e);if(r instanceof $r&&r.typeInfo.size===0){const o=r.typeInfo,s=r.buffer.byteLength/o.stride;return new ae(s,this.getTypeInfo("u32"))}return new ae(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.abs(o)),n.typeInfo);const r=n;return new ae(Math.abs(r.value),r.typeInfo)}Acos(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.acos(o)),n.typeInfo);const r=n;return new ae(Math.acos(r.value),n.typeInfo)}Acosh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.acosh(o)),n.typeInfo);const r=n;return new ae(Math.acosh(r.value),n.typeInfo)}Asin(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.asin(o)),n.typeInfo);const r=n;return new ae(Math.asin(r.value),n.typeInfo)}Asinh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.asinh(o)),n.typeInfo);const r=n;return new ae(Math.asinh(r.value),n.typeInfo)}Atan(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.atan(o)),n.typeInfo);const r=n;return new ae(Math.atan(r.value),n.typeInfo)}Atanh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.atanh(o)),n.typeInfo);const r=n;return new ae(Math.atanh(r.value),n.typeInfo)}Atan2(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);if(n instanceof Xt&&r instanceof Xt)return new Xt(n.data.map((l,c)=>Math.atan2(l,r.data[c])),n.typeInfo);const o=n,s=r;return new ae(Math.atan2(o.value,s.value),n.typeInfo)}Ceil(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.ceil(o)),n.typeInfo);const r=n;return new ae(Math.ceil(r.value),n.typeInfo)}_clamp(t,e,n){return Math.min(Math.max(t,e),n)}Clamp(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e),o=this.exec.evalExpression(t.args[2],e);if(n instanceof Xt&&r instanceof Xt&&o instanceof Xt)return new Xt(n.data.map((y,_)=>this._clamp(y,r.data[_],o.data[_])),n.typeInfo);const s=n,l=r,c=o;return new ae(this._clamp(s.value,l.value,c.value),n.typeInfo)}Cos(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.cos(o)),n.typeInfo);const r=n;return new ae(Math.cos(r.value),n.typeInfo)}Cosh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.cosh(o)),n.typeInfo);const r=n;return new ae(Math.cos(r.value),n.typeInfo)}CountLeadingZeros(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.clz32(o)),n.typeInfo);const r=n;return new ae(Math.clz32(r.value),n.typeInfo)}_countOneBits(t){let e=0;for(;t!==0;)1&t&&e++,t>>=1;return e}CountOneBits(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>this._countOneBits(o)),n.typeInfo);const r=n;return new ae(this._countOneBits(r.value),n.typeInfo)}_countTrailingZeros(t){if(t===0)return 32;let e=0;for(;!(1&t);)t>>=1,e++;return e}CountTrailingZeros(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>this._countTrailingZeros(o)),n.typeInfo);const r=n;return new ae(this._countTrailingZeros(r.value),n.typeInfo)}Cross(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);if(n instanceof Xt&&r instanceof Xt){if(n.data.length!==3||r.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${t.line}`),null;const o=n.data,s=r.data;return new Xt([o[1]*s[2]-s[1]*o[2],o[2]*s[0]-s[2]*o[0],o[0]*s[1]-s[0]*o[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${t.line}`),null}Degrees(t,e){const n=this.exec.evalExpression(t.args[0],e),r=180/Math.PI;return n instanceof Xt?new Xt(n.data.map(o=>o*r),n.typeInfo):new ae(n.value*r,this.getTypeInfo("f32"))}Determinant(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof ln){const r=n.data,o=n.typeInfo.getTypeName(),s=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new ae(r[0]*r[3]-r[1]*r[2],s);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new ae(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),s);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new ae(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),s);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${t.line}`),null}Distance(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);if(n instanceof Xt&&r instanceof Xt){let l=0;for(let c=0;c<n.data.length;++c)l+=(n.data[c]-r.data[c])*(n.data[c]-r.data[c]);return new ae(Math.sqrt(l),this.getTypeInfo("f32"))}const o=n,s=r;return new ae(Math.abs(o.value-s.value),n.typeInfo)}_dot(t,e){let n=0;for(let r=0;r<t.length;++r)n+=e[r]*t[r];return n}Dot(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);return n instanceof Xt&&r instanceof Xt?new ae(this._dot(n.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${t.line}`),null)}Dot4U8Packed(t,e){return console.error(`TODO: dot4U8Packed. Line ${t.line}`),null}Dot4I8Packed(t,e){return console.error(`TODO: dot4I8Packed. Line ${t.line}`),null}Exp(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.exp(o)),n.typeInfo);const r=n;return new ae(Math.exp(r.value),n.typeInfo)}Exp2(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.pow(2,o)),n.typeInfo);const r=n;return new ae(Math.pow(2,r.value),n.typeInfo)}ExtractBits(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e),o=this.exec.evalExpression(t.args[2],e);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${t.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${t.line}`),null;const s=r.value,l=o.value;if(n instanceof Xt)return new Xt(n.data.map(y=>y>>s&(1<<l)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${t.line}`),null;const c=n.value;return new ae(c>>s&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e),o=this.exec.evalExpression(t.args[2],e);if(n instanceof Xt&&r instanceof Xt&&o instanceof Xt){const s=this._dot(r.data,o.data);return new Xt(s<0?Array.from(n.data):n.data.map(l=>-l),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${t.line}`),null}_firstLeadingBit(t){return t===0?-1:31-Math.clz32(t)}FirstLeadingBit(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>this._firstLeadingBit(o)),n.typeInfo);const r=n;return new ae(this._firstLeadingBit(r.value),n.typeInfo)}_firstTrailingBit(t){return t===0?-1:Math.log2(t&-t)}FirstTrailingBit(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>this._firstTrailingBit(o)),n.typeInfo);const r=n;return new ae(this._firstTrailingBit(r.value),n.typeInfo)}Floor(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.floor(o)),n.typeInfo);const r=n;return new ae(Math.floor(r.value),n.typeInfo)}Fma(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e),o=this.exec.evalExpression(t.args[2],e);if(n instanceof Xt&&r instanceof Xt&&o instanceof Xt)return n.data.length!==r.data.length||n.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${t.line}`),null):new Xt(n.data.map((y,_)=>y*r.data[_]+o.data[_]),n.typeInfo);const s=n,l=r,c=o;return new ae(s.value*l.value+c.value,s.typeInfo)}Fract(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>o-Math.floor(o)),n.typeInfo);const r=n;return new ae(r.value-Math.floor(r.value),n.typeInfo)}Frexp(t,e){return console.error(`TODO: frexp. Line ${t.line}`),null}InsertBits(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e),o=this.exec.evalExpression(t.args[2],e),s=this.exec.evalExpression(t.args[3],e);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${t.line}`),null;const l=o.value,c=(1<<s.value)-1<<l,y=~c;if(n instanceof Xt&&r instanceof Xt)return new Xt(n.data.map((I,k)=>I&y|r.data[k]<<l&c),n.typeInfo);const _=n.value,C=r.value;return new ae(_&y|C<<l&c,n.typeInfo)}InverseSqrt(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>1/Math.sqrt(o)),n.typeInfo);const r=n;return new ae(1/Math.sqrt(r.value),n.typeInfo)}Ldexp(t,e){return console.error(`TODO: ldexp. Line ${t.line}`),null}Length(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt){let o=0;return n.data.forEach(s=>{o+=s*s}),new ae(Math.sqrt(o),this.getTypeInfo("f32"))}const r=n;return new ae(Math.abs(r.value),n.typeInfo)}Log(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.log(o)),n.typeInfo);const r=n;return new ae(Math.log(r.value),n.typeInfo)}Log2(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.log2(o)),n.typeInfo);const r=n;return new ae(Math.log2(r.value),n.typeInfo)}Max(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);if(n instanceof Xt&&r instanceof Xt)return new Xt(n.data.map((l,c)=>Math.max(l,r.data[c])),n.typeInfo);const o=n,s=r;return new ae(Math.max(o.value,s.value),n.typeInfo)}Min(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);if(n instanceof Xt&&r instanceof Xt)return new Xt(n.data.map((l,c)=>Math.min(l,r.data[c])),n.typeInfo);const o=n,s=r;return new ae(Math.min(o.value,s.value),n.typeInfo)}Mix(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e),o=this.exec.evalExpression(t.args[2],e);if(n instanceof Xt&&r instanceof Xt&&o instanceof Xt)return new Xt(n.data.map((c,y)=>n.data[y]*(1-o.data[y])+r.data[y]*o.data[y]),n.typeInfo);const s=r,l=o;return new ae(n.value*(1-l.value)+s.value*l.value,n.typeInfo)}Modf(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);if(n instanceof Xt&&r instanceof Xt)return new Xt(n.data.map((s,l)=>s%r.data[l]),n.typeInfo);const o=r;return new ae(n.value%o.value,n.typeInfo)}Normalize(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt){const r=this.Length(t,e).value;return new Xt(n.data.map(o=>o/r),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${t.line}`),null}Pow(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);if(n instanceof Xt&&r instanceof Xt)return new Xt(n.data.map((l,c)=>Math.pow(l,r.data[c])),n.typeInfo);const o=n,s=r;return new ae(Math.pow(o.value,s.value),n.typeInfo)}QuantizeToF16(t,e){const n=this.exec.evalExpression(t.args[0],e);return n instanceof Xt?new Xt(n.data.map(r=>r),n.typeInfo):new ae(n.value,n.typeInfo)}Radians(t,e){const n=this.exec.evalExpression(t.args[0],e);return n instanceof Xt?new Xt(n.data.map(r=>r*Math.PI/180),n.typeInfo):new ae(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(t,e){let n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);if(n instanceof Xt&&r instanceof Xt){const o=this._dot(n.data,r.data);return new Xt(n.data.map((s,l)=>s-2*o*r.data[l]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${t.line}`),null}Refract(t,e){let n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e),o=this.exec.evalExpression(t.args[2],e);if(n instanceof Xt&&r instanceof Xt&&o instanceof ae){const s=this._dot(r.data,n.data);return new Xt(n.data.map((l,c)=>{const y=1-o.value*o.value*(1-s*s);if(y<0)return 0;const _=Math.sqrt(y);return o.value*l-(o.value*s+_)*r.data[c]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${t.line}`),null}ReverseBits(t,e){return console.error(`TODO: reverseBits. Line ${t.line}`),null}Round(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.round(o)),n.typeInfo);const r=n;return new ae(Math.round(r.value),n.typeInfo)}Saturate(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.min(Math.max(o,0),1)),n.typeInfo);const r=n;return new ae(Math.min(Math.max(r.value,0),1),n.typeInfo)}Sign(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.sign(o)),n.typeInfo);const r=n;return new ae(Math.sign(r.value),n.typeInfo)}Sin(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.sin(o)),n.typeInfo);const r=n;return new ae(Math.sin(r.value),n.typeInfo)}Sinh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.sinh(o)),n.typeInfo);const r=n;return new ae(Math.sinh(r.value),n.typeInfo)}_smoothstep(t,e,n){const r=Math.min(Math.max((n-t)/(e-t),0),1);return r*r*(3-2*r)}SmoothStep(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e),o=this.exec.evalExpression(t.args[2],e);if(o instanceof Xt&&n instanceof Xt&&r instanceof Xt)return new Xt(o.data.map((y,_)=>this._smoothstep(n.data[_],r.data[_],y)),o.typeInfo);const s=n,l=r,c=o;return new ae(this._smoothstep(s.value,l.value,c.value),o.typeInfo)}Sqrt(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.sqrt(o)),n.typeInfo);const r=n;return new ae(Math.sqrt(r.value),n.typeInfo)}Step(t,e){const n=this.exec.evalExpression(t.args[0],e),r=this.exec.evalExpression(t.args[1],e);if(r instanceof Xt&&n instanceof Xt)return new Xt(r.data.map((s,l)=>s<n.data[l]?0:1),r.typeInfo);const o=n;return new ae(r.value<o.value?0:1,o.typeInfo)}Tan(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.tan(o)),n.typeInfo);const r=n;return new ae(Math.tan(r.value),n.typeInfo)}Tanh(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.tanh(o)),n.typeInfo);const r=n;return new ae(Math.tanh(r.value),n.typeInfo)}_getTransposeType(t){const e=t.getTypeName();return e==="mat2x2f"||e==="mat2x2h"?t:e==="mat2x3f"?this.getTypeInfo("mat3x2f"):e==="mat2x3h"?this.getTypeInfo("mat3x2h"):e==="mat2x4f"?this.getTypeInfo("mat4x2f"):e==="mat2x4h"?this.getTypeInfo("mat4x2h"):e==="mat3x2f"?this.getTypeInfo("mat2x3f"):e==="mat3x2h"?this.getTypeInfo("mat2x3h"):e==="mat3x3f"||e==="mat3x3h"?t:e==="mat3x4f"?this.getTypeInfo("mat4x3f"):e==="mat3x4h"?this.getTypeInfo("mat4x3h"):e==="mat4x2f"?this.getTypeInfo("mat2x4f"):e==="mat4x2h"?this.getTypeInfo("mat2x4h"):e==="mat4x3f"?this.getTypeInfo("mat3x4f"):e==="mat4x3h"?this.getTypeInfo("mat3x4h"):(e==="mat4x4f"||e==="mat4x4h"||console.error(`Invalid matrix type ${e}`),t)}Transpose(t,e){const n=this.exec.evalExpression(t.args[0],e);if(!(n instanceof ln))return console.error(`Transpose() expects a matrix argument. Line ${t.line}`),null;const r=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const o=n.data;return new ln([o[0],o[2],o[1],o[3]],r)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const o=n.data;return new ln([o[0],o[3],o[6],o[1],o[4],o[7]],r)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const o=n.data;return new ln([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],r)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const o=n.data;return new ln([o[0],o[3],o[1],o[4],o[2],o[5]],r)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const o=n.data;return new ln([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],r)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const o=n.data;return new ln([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],r)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const o=n.data;return new ln([o[0],o[4],o[1],o[5],o[2],o[6]],r)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const o=n.data;return new ln([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],r)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const o=n.data;return new ln([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],r)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(t,e){const n=this.exec.evalExpression(t.args[0],e);if(n instanceof Xt)return new Xt(n.data.map(o=>Math.trunc(o)),n.typeInfo);const r=n;return new ae(Math.trunc(r.value),n.typeInfo)}Dpdx(t,e){return console.error(`TODO: dpdx. Line ${t.line}`),null}DpdxCoarse(t,e){return console.error(`TODO: dpdxCoarse. Line ${t.line}`),null}DpdxFine(t,e){return console.error("TODO: dpdxFine"),null}Dpdy(t,e){return console.error("TODO: dpdy"),null}DpdyCoarse(t,e){return console.error("TODO: dpdyCoarse"),null}DpdyFine(t,e){return console.error("TODO: dpdyFine"),null}Fwidth(t,e){return console.error("TODO: fwidth"),null}FwidthCoarse(t,e){return console.error("TODO: fwidthCoarse"),null}FwidthFine(t,e){return console.error("TODO: fwidthFine"),null}TextureDimensions(t,e){const n=t.args[0],r=t.args.length>1?this.exec.evalExpression(t.args[1],e).value:0;if(n instanceof ca){const o=n.name,s=e.getVariableValue(o);if(s instanceof ju){if(r<0||r>=s.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${t.line}`),null;const l=s.getMipLevelSize(r),c=s.dimension;return c==="1d"?new ae(l[0],this.getTypeInfo("u32")):c==="3d"?new Xt(l,this.getTypeInfo("vec3u")):c==="2d"?new Xt(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${c} not found. Line ${t.line}`),null)}return console.error(`Texture ${o} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${t.line}`),null}TextureGather(t,e){return console.error("TODO: textureGather"),null}TextureGatherCompare(t,e){return console.error("TODO: textureGatherCompare"),null}TextureLoad(t,e){const n=t.args[0],r=this.exec.evalExpression(t.args[1],e),o=t.args.length>2?this.exec.evalExpression(t.args[2],e).value:0;if(!(r instanceof Xt)||r.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${t.line}`),null;if(n instanceof ca){const s=n.name,l=e.getVariableValue(s);if(l instanceof ju){const c=Math.floor(r.data[0]),y=Math.floor(r.data[1]);if(c<0||c>=l.width||y<0||y>=l.height)return console.error(`Texture ${s} out of bounds. Line ${t.line}`),null;const _=l.getPixel(c,y,0,o);return _===null?(console.error(`Invalid texture format for textureLoad. Line ${t.line}`),null):new Xt(_,this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${t.line}`),null}TextureNumLayers(t,e){const n=t.args[0];if(n instanceof ca){const r=n.name,o=e.getVariableValue(r);return o instanceof ju?new ae(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${t.line}`),null}TextureNumLevels(t,e){const n=t.args[0];if(n instanceof ca){const r=n.name,o=e.getVariableValue(r);return o instanceof ju?new ae(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${t.line}`),null}TextureNumSamples(t,e){const n=t.args[0];if(n instanceof ca){const r=n.name,o=e.getVariableValue(r);return o instanceof ju?new ae(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${t.line}`),null}TextureSample(t,e){return console.error("TODO: textureSample"),null}TextureSampleBias(t,e){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(t,e){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(t,e){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(t,e){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(t,e){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(t,e){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(t,e){const n=t.args[0],r=this.exec.evalExpression(t.args[1],e),o=t.args.length===4?this.exec.evalExpression(t.args[2],e).value:0,s=t.args.length===4?this.exec.evalExpression(t.args[3],e).data:this.exec.evalExpression(t.args[2],e).data;if(s.length!==4)return console.error(`Invalid value argument for textureStore. Line ${t.line}`),null;if(!(r instanceof Xt)||r.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${t.line}`),null;if(n instanceof ca){const l=n.name,c=e.getVariableValue(l);if(c instanceof ju){const y=c.getMipLevelSize(0),_=Math.floor(r.data[0]),C=Math.floor(r.data[1]);return _<0||_>=y[0]||C<0||C>=y[1]?(console.error(`Texture ${l} out of bounds. Line ${t.line}`),null):(c.setPixel(_,C,0,o,Array.from(s)),null)}return console.error(`Texture ${l} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${t.line}`),null}AtomicLoad(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e);return e.getVariable(r).value.getSubData(this.exec,n.postfix,e)}AtomicStore(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e),o=e.getVariable(r);let s=t.args[1];const l=this.exec.evalExpression(s,e),c=o.value.getSubData(this.exec,n.postfix,e);return c instanceof ae&&l instanceof ae&&(c.value=l.value),o.value instanceof $r&&o.value.setDataValue(this.exec,c,n.postfix,e),null}AtomicAdd(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e),o=e.getVariable(r);let s=t.args[1];const l=this.exec.evalExpression(s,e),c=o.value.getSubData(this.exec,n.postfix,e),y=new ae(c.value,c.typeInfo);return c instanceof ae&&l instanceof ae&&(c.value+=l.value),o.value instanceof $r&&o.value.setDataValue(this.exec,c,n.postfix,e),y}AtomicSub(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e),o=e.getVariable(r);let s=t.args[1];const l=this.exec.evalExpression(s,e),c=o.value.getSubData(this.exec,n.postfix,e),y=new ae(c.value,c.typeInfo);return c instanceof ae&&l instanceof ae&&(c.value-=l.value),o.value instanceof $r&&o.value.setDataValue(this.exec,c,n.postfix,e),y}AtomicMax(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e),o=e.getVariable(r);let s=t.args[1];const l=this.exec.evalExpression(s,e),c=o.value.getSubData(this.exec,n.postfix,e),y=new ae(c.value,c.typeInfo);return c instanceof ae&&l instanceof ae&&(c.value=Math.max(c.value,l.value)),o.value instanceof $r&&o.value.setDataValue(this.exec,c,n.postfix,e),y}AtomicMin(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e),o=e.getVariable(r);let s=t.args[1];const l=this.exec.evalExpression(s,e),c=o.value.getSubData(this.exec,n.postfix,e),y=new ae(c.value,c.typeInfo);return c instanceof ae&&l instanceof ae&&(c.value=Math.min(c.value,l.value)),o.value instanceof $r&&o.value.setDataValue(this.exec,c,n.postfix,e),y}AtomicAnd(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e),o=e.getVariable(r);let s=t.args[1];const l=this.exec.evalExpression(s,e),c=o.value.getSubData(this.exec,n.postfix,e),y=new ae(c.value,c.typeInfo);return c instanceof ae&&l instanceof ae&&(c.value=c.value&l.value),o.value instanceof $r&&o.value.setDataValue(this.exec,c,n.postfix,e),y}AtomicOr(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e),o=e.getVariable(r);let s=t.args[1];const l=this.exec.evalExpression(s,e),c=o.value.getSubData(this.exec,n.postfix,e),y=new ae(c.value,c.typeInfo);return c instanceof ae&&l instanceof ae&&(c.value=c.value|l.value),o.value instanceof $r&&o.value.setDataValue(this.exec,c,n.postfix,e),y}AtomicXor(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e),o=e.getVariable(r);let s=t.args[1];const l=this.exec.evalExpression(s,e),c=o.value.getSubData(this.exec,n.postfix,e),y=new ae(c.value,c.typeInfo);return c instanceof ae&&l instanceof ae&&(c.value=c.value^l.value),o.value instanceof $r&&o.value.setDataValue(this.exec,c,n.postfix,e),y}AtomicExchange(t,e){let n=t.args[0];n instanceof fs&&(n=n.right);const r=this.exec.getVariableName(n,e),o=e.getVariable(r);let s=t.args[1];const l=this.exec.evalExpression(s,e),c=o.value.getSubData(this.exec,n.postfix,e),y=new ae(c.value,c.typeInfo);return c instanceof ae&&l instanceof ae&&(c.value=l.value),o.value instanceof $r&&o.value.setDataValue(this.exec,c,n.postfix,e),y}AtomicCompareExchangeWeak(t,e){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(t,e){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(t,e){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(t,e){return console.error("TODO: pack4xI8"),null}Pack4xU8(t,e){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(t,e){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(t,e){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(t,e){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(t,e){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(t,e){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(t,e){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(t,e){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(t,e){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(t,e){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(t,e){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(t,e){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(t,e){return console.error("TODO: unpack2x16float"),null}StorageBarrier(t,e){return null}TextureBarrier(t,e){return null}WorkgroupBarrier(t,e){return null}WorkgroupUniformLoad(t,e){return null}SubgroupAdd(t,e){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(t,e){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(t,e){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(t,e){return console.error("TODO: subgroupAll"),null}SubgroupAnd(t,e){return console.error("TODO: subgroupAnd"),null}SubgroupAny(t,e){return console.error("TODO: subgroupAny"),null}SubgroupBallot(t,e){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(t,e){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(t,e){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(t,e){return console.error("TODO: subgroupElect"),null}SubgroupMax(t,e){return console.error("TODO: subgroupMax"),null}SubgroupMin(t,e){return console.error("TODO: subgroupMin"),null}SubgroupMul(t,e){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(t,e){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(t,e){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(t,e){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(t,e){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(t,e){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(t,e){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(t,e){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(t,e){return console.error("TODO: subgroupXor"),null}QuadBroadcast(t,e){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(t,e){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(t,e){return console.error("TODO: quadSwapX"),null}QuadSwapY(t,e){return console.error("TODO: quadSwapY"),null}}const b_={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Lo={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Ao extends V7{constructor(t,e){var n;super(),this.ast=t??[],this.reflection=new nu,this.reflection.updateAST(this.ast),this.context=(n=e?.clone())!==null&&n!==void 0?n:new _x,this.builtins=new G7(this),this.typeInfo={bool:this.getTypeInfo(He.bool),i32:this.getTypeInfo(He.i32),u32:this.getTypeInfo(He.u32),f32:this.getTypeInfo(He.f32),f16:this.getTypeInfo(He.f16),vec2f:this.getTypeInfo(me.vec2f),vec2u:this.getTypeInfo(me.vec2u),vec2i:this.getTypeInfo(me.vec2i),vec2h:this.getTypeInfo(me.vec2h),vec3f:this.getTypeInfo(me.vec3f),vec3u:this.getTypeInfo(me.vec3u),vec3i:this.getTypeInfo(me.vec3i),vec3h:this.getTypeInfo(me.vec3h),vec4f:this.getTypeInfo(me.vec4f),vec4u:this.getTypeInfo(me.vec4u),vec4i:this.getTypeInfo(me.vec4i),vec4h:this.getTypeInfo(me.vec4h),mat2x2f:this.getTypeInfo(me.mat2x2f),mat2x3f:this.getTypeInfo(me.mat2x3f),mat2x4f:this.getTypeInfo(me.mat2x4f),mat3x2f:this.getTypeInfo(me.mat3x2f),mat3x3f:this.getTypeInfo(me.mat3x3f),mat3x4f:this.getTypeInfo(me.mat3x4f),mat4x2f:this.getTypeInfo(me.mat4x2f),mat4x3f:this.getTypeInfo(me.mat4x3f),mat4x4f:this.getTypeInfo(me.mat4x4f)}}getVariableValue(t){var e,n;const r=(n=(e=this.context.getVariable(t))===null||e===void 0?void 0:e.value)!==null&&n!==void 0?n:null;if(r===null)return null;if(r instanceof ae)return r.value;if(r instanceof Xt||r instanceof ln)return Array.from(r.data);if(r instanceof $r&&r.typeInfo instanceof Xc){if(r.typeInfo.format.name==="u32")return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="i32")return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="f32")return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(t){(t=t??{}).constants&&this._setOverrides(t.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(t,e,n,r){const o=this.context.clone();(r=r??{}).constants&&this._setOverrides(r.constants,o),this._execStatements(this.ast,o);const s=o.getFunction(t);if(!s)return void console.error(`Function ${t} not found`);if(typeof e=="number")e=[e,1,1];else{if(e.length===0)return void console.error("Invalid dispatch count");e.length===1?e=[e[0],1,1]:e.length===2?e=[e[0],e[1],1]:e.length>3&&(e=[e[0],e[1],e[2]])}const l=e[0],c=e[1],y=e[2],_=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new Xt(e,_));const C=this.reflection.getFunctionInfo(t);C===null&&console.error(`Function ${t} not found in reflection data`);for(const I in n)for(const k in n[I]){const z=n[I][k];o.variables.forEach(V=>{var X;const H=V.node;if(H?.attributes){let $=null,Y=null;for(const ct of H.attributes)ct.name==="binding"?$=ct.value:ct.name==="group"&&(Y=ct.value);if(k==$&&I==Y){let ct=!1;for(const rt of C.resources)if(rt.name===V.name&&rt.group===parseInt(I)&&rt.binding===parseInt(k)){ct=!0;break}if(ct)if(z.texture!==void 0&&z.descriptor!==void 0){const rt=new ju(z.texture,this.getTypeInfo(H.type),z.descriptor,(X=z.texture.view)!==null&&X!==void 0?X:null);V.value=rt}else z.uniform!==void 0?V.value=new $r(z.uniform,this.getTypeInfo(H.type)):V.value=new $r(z,this.getTypeInfo(H.type))}}})}for(let I=0;I<y;++I)for(let k=0;k<c;++k)for(let z=0;z<l;++z)o.setVariable("@workgroup_id",new Xt([z,k,I],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[z,k,I],o)}execStatement(t,e){if(t instanceof iR)return this.evalExpression(t.value,e);if(t instanceof rR){if(t.condition){const n=this.evalExpression(t.condition,e);if(!(n instanceof ae))throw new Error("Invalid break-if condition");if(!n.value)return null}return Ao._breakObj}if(t instanceof sR)return Ao._continueObj;if(t instanceof NA)this._let(t,e);else if(t instanceof Wu)this._var(t,e);else if(t instanceof pg)this._const(t,e);else if(t instanceof tm)this._function(t,e);else{if(t instanceof eR)return this._if(t,e);if(t instanceof tR)return this._switch(t,e);if(t instanceof Y6)return this._for(t,e);if(t instanceof Z6)return this._while(t,e);if(t instanceof $6)return this._loop(t,e);if(t instanceof vb){const n=e.clone();return n.currentFunctionName=e.currentFunctionName,this._execStatements(t.body,n)}if(t instanceof J6)this._assign(t,e);else if(t instanceof Q6)this._increment(t,e);else{if(t instanceof Gu)return null;if(t instanceof dx){const n=t.name;e.getVariable(n)===null&&e.setVariable(n,new ae(0,this.getTypeInfo("u32")))}else if(t instanceof px)this._call(t,e);else{if(t instanceof nR||t instanceof Ax)return null;console.error("Invalid statement type.",t,`Line ${t.line}`)}}}return null}evalExpression(t,e){return t instanceof ol?this._evalBinaryOp(t,e):t instanceof Cs?this._evalLiteral(t,e):t instanceof ca?this._evalVariable(t,e):t instanceof mx?this._evalCall(t,e):t instanceof tu?this._evalCreate(t,e):t instanceof oR?this._evalConst(t,e):t instanceof aR?this._evalBitcast(t,e):t instanceof fs?this._evalUnaryOp(t,e):(console.error("Invalid expression type",t,`Line ${t.line}`),null)}getTypeInfo(t){var e;if(t instanceof He){const r=this.reflection.getTypeInfo(t);if(r!==null)return r}let n=(e=this.typeInfo[t])!==null&&e!==void 0?e:null;return n!==null||(n=this.reflection.getTypeInfoByName(t)),n}_setOverrides(t,e){for(const n in t){const r=t[n],o=this.reflection.getOverrideInfo(n);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?e.setVariable(n,new ae(r,o.type)):o.type.name==="bool"?e.setVariable(n,new ae(r?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?e.setVariable(n,new Xt(r,o.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(t,e,n){const r=[1,1,1];for(const _ of t.node.attributes)if(_.name==="workgroup_size"){if(_.value.length>0){const C=n.getVariableValue(_.value[0]);r[0]=C instanceof ae?C.value:parseInt(_.value[0])}if(_.value.length>1){const C=n.getVariableValue(_.value[1]);r[1]=C instanceof ae?C.value:parseInt(_.value[1])}if(_.value.length>2){const C=n.getVariableValue(_.value[2]);r[2]=C instanceof ae?C.value:parseInt(_.value[2])}}const o=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Xt(r,o));const l=r[0],c=r[1],y=r[2];for(let _=0,C=0;_<y;++_)for(let I=0;I<c;++I)for(let k=0;k<l;++k,++C){const z=[k,I,_],V=[k+e[0]*r[0],I+e[1]*r[1],_+e[2]*r[2]];n.setVariable("@local_invocation_id",new Xt(z,o)),n.setVariable("@global_invocation_id",new Xt(V,o)),n.setVariable("@local_invocation_index",new ae(C,s)),this._dispatchExec(t,n)}}_dispatchExec(t,e){for(const n of t.node.args)for(const r of n.attributes)if(r.name==="builtin"){const o=`@${r.value}`,s=e.getVariable(o);s!==void 0&&e.variables.set(n.name,s)}this._execStatements(t.node.body,e)}getVariableName(t,e){for(;t instanceof fs;)t=t.right;return t instanceof ca?t.name:(console.error("Unknown variable type",t,"Line",t.line),null)}_execStatements(t,e){for(const n of t){if(n instanceof Array){const o=e.clone(),s=this._execStatements(n,o);if(s)return s;continue}const r=this.execStatement(n,e);if(r)return r}return null}_call(t,e){const n=e.clone();n.currentFunctionName=t.name;const r=e.getFunction(t.name);if(r){for(let o=0;o<r.node.args.length;++o){const s=r.node.args[o],l=this.evalExpression(t.args[o],n);n.setVariable(s.name,l,s)}this._execStatements(r.node.body,n)}else t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)&&this._evalCreate(t,e)}_increment(t,e){const n=this.getVariableName(t.variable,e),r=e.getVariable(n);r?t.operator==="++"?r.value instanceof ae?r.value.value++:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):t.operator==="--"?r.value instanceof ae?r.value.value--:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):console.error(`Unknown increment operator ${t.operator}. Line ${t.line}`):console.error(`Variable ${n} not found. Line ${t.line}`)}_getVariableData(t,e){if(t instanceof ca){const n=this.getVariableName(t,e),r=e.getVariable(n);return r===null?(console.error(`Variable ${n} not found. Line ${t.line}`),null):r.value.getSubData(this,t.postfix,e)}if(t instanceof fs){if(t.operator==="*"){const n=this._getVariableData(t.right,e);return n instanceof yd?n.reference.getSubData(this,t.postfix,e):(console.error(`Variable ${t.right} is not a pointer. Line ${t.line}`),null)}if(t.operator==="&"){const n=this._getVariableData(t.right,e);return new yd(n)}}return null}_assign(t,e){let n=null,r="<var>",o=null;if(t.variable instanceof fs){const c=this._getVariableData(t.variable,e),y=this.evalExpression(t.value,e),_=t.operator;if(_==="="){if(c instanceof ae||c instanceof Xt||c instanceof ln){if(y instanceof ae||y instanceof Xt||y instanceof ln&&c.data.length===y.data.length)return void c.data.set(y.data);console.error(`Invalid assignment. Line ${t.line}`)}else if(c instanceof $r&&y instanceof $r&&c.buffer.byteLength-c.offset>=y.buffer.byteLength-y.offset)return void(c.buffer.byteLength%4==0?new Uint32Array(c.buffer,c.offset,c.typeInfo.size/4).set(new Uint32Array(y.buffer,y.offset,y.typeInfo.size/4)):new Uint8Array(c.buffer,c.offset,c.typeInfo.size).set(new Uint8Array(y.buffer,y.offset,y.typeInfo.size)));return console.error(`Invalid assignment. Line ${t.line}`),null}if(_==="+=")return c instanceof ae||c instanceof Xt||c instanceof ln?y instanceof ae||y instanceof Xt||y instanceof ln?void c.data.set(y.data.map((C,I)=>c.data[I]+C)):void console.error(`Invalid assignment . Line ${t.line}`):void console.error(`Invalid assignment. Line ${t.line}`);if(_==="-=")return(c instanceof ae||c instanceof Xt||c instanceof ln)&&(y instanceof ae||y instanceof Xt||y instanceof ln)?void c.data.set(y.data.map((C,I)=>c.data[I]-C)):void console.error(`Invalid assignment. Line ${t.line}`)}if(t.variable instanceof fs){if(t.variable.operator==="*"){r=this.getVariableName(t.variable.right,e);const c=e.getVariable(r);if(!(c&&c.value instanceof yd))return void console.error(`Variable ${r} is not a pointer. Line ${t.line}`);n=c.value.reference;let y=t.variable.postfix;if(!y){let _=t.variable.right;for(;_ instanceof fs;){if(_.postfix){y=_.postfix;break}_=_.right}}y&&(n=n.getSubData(this,y,e))}}else{o=t.variable.postfix,r=this.getVariableName(t.variable,e);const c=e.getVariable(r);if(c===null)return void console.error(`Variable ${r} not found. Line ${t.line}`);n=c.value}if(n instanceof yd&&(n=n.reference),n===null)return void console.error(`Variable ${r} not found. Line ${t.line}`);const s=this.evalExpression(t.value,e),l=t.operator;if(l!=="="){const c=n.getSubData(this,o,e);if(c instanceof Xt&&s instanceof ae){const y=c.data,_=s.value;if(l==="+=")for(let C=0;C<y.length;++C)y[C]+=_;else if(l==="-=")for(let C=0;C<y.length;++C)y[C]-=_;else if(l==="*=")for(let C=0;C<y.length;++C)y[C]*=_;else if(l==="/=")for(let C=0;C<y.length;++C)y[C]/=_;else if(l==="%=")for(let C=0;C<y.length;++C)y[C]%=_;else if(l==="&=")for(let C=0;C<y.length;++C)y[C]&=_;else if(l==="|=")for(let C=0;C<y.length;++C)y[C]|=_;else if(l==="^=")for(let C=0;C<y.length;++C)y[C]^=_;else if(l==="<<=")for(let C=0;C<y.length;++C)y[C]<<=_;else if(l===">>=")for(let C=0;C<y.length;++C)y[C]>>=_;else console.error(`Invalid operator ${l}. Line ${t.line}`)}else if(c instanceof Xt&&s instanceof Xt){const y=c.data,_=s.data;if(y.length!==_.length)return void console.error(`Vector length mismatch. Line ${t.line}`);if(l==="+=")for(let C=0;C<y.length;++C)y[C]+=_[C];else if(l==="-=")for(let C=0;C<y.length;++C)y[C]-=_[C];else if(l==="*=")for(let C=0;C<y.length;++C)y[C]*=_[C];else if(l==="/=")for(let C=0;C<y.length;++C)y[C]/=_[C];else if(l==="%=")for(let C=0;C<y.length;++C)y[C]%=_[C];else if(l==="&=")for(let C=0;C<y.length;++C)y[C]&=_[C];else if(l==="|=")for(let C=0;C<y.length;++C)y[C]|=_[C];else if(l==="^=")for(let C=0;C<y.length;++C)y[C]^=_[C];else if(l==="<<=")for(let C=0;C<y.length;++C)y[C]<<=_[C];else if(l===">>=")for(let C=0;C<y.length;++C)y[C]>>=_[C];else console.error(`Invalid operator ${l}. Line ${t.line}`)}else{if(!(c instanceof ae&&s instanceof ae))return void console.error(`Invalid type for ${t.operator} operator. Line ${t.line}`);l==="+="?c.value+=s.value:l==="-="?c.value-=s.value:l==="*="?c.value*=s.value:l==="/="?c.value/=s.value:l==="%="?c.value%=s.value:l==="&="?c.value&=s.value:l==="|="?c.value|=s.value:l==="^="?c.value^=s.value:l==="<<="?c.value<<=s.value:l===">>="?c.value>>=s.value:console.error(`Invalid operator ${l}. Line ${t.line}`)}return void(n instanceof $r&&n.setDataValue(this,c,o,e))}if(n instanceof $r)n.setDataValue(this,s,o,e);else if(o){if(!(n instanceof Xt||n instanceof ln))return void console.error(`Variable ${r} is not a vector or matrix. Line ${t.line}`);if(o instanceof mp){const c=this.evalExpression(o.index,e).value;if(n instanceof Xt){if(!(s instanceof ae))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[c]=s.value}else{if(!(n instanceof ln))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);{const y=this.evalExpression(o.index,e).value;if(y<0)return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);if(!(s instanceof Xt))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);{const _=n.typeInfo.getTypeName();if(_==="mat2x2"||_==="mat2x2f"||_==="mat2x2h"){if(!(y<2&&s.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[2*y]=s.data[0],n.data[2*y+1]=s.data[1]}else if(_==="mat2x3"||_==="mat2x3f"||_==="mat2x3h"){if(!(y<2&&s.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[3*y]=s.data[0],n.data[3*y+1]=s.data[1],n.data[3*y+2]=s.data[2]}else if(_==="mat2x4"||_==="mat2x4f"||_==="mat2x4h"){if(!(y<2&&s.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[4*y]=s.data[0],n.data[4*y+1]=s.data[1],n.data[4*y+2]=s.data[2],n.data[4*y+3]=s.data[3]}else if(_==="mat3x2"||_==="mat3x2f"||_==="mat3x2h"){if(!(y<3&&s.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[2*y]=s.data[0],n.data[2*y+1]=s.data[1]}else if(_==="mat3x3"||_==="mat3x3f"||_==="mat3x3h"){if(!(y<3&&s.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[3*y]=s.data[0],n.data[3*y+1]=s.data[1],n.data[3*y+2]=s.data[2]}else if(_==="mat3x4"||_==="mat3x4f"||_==="mat3x4h"){if(!(y<3&&s.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[4*y]=s.data[0],n.data[4*y+1]=s.data[1],n.data[4*y+2]=s.data[2],n.data[4*y+3]=s.data[3]}else if(_==="mat4x2"||_==="mat4x2f"||_==="mat4x2h"){if(!(y<4&&s.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[2*y]=s.data[0],n.data[2*y+1]=s.data[1]}else if(_==="mat4x3"||_==="mat4x3f"||_==="mat4x3h"){if(!(y<4&&s.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[3*y]=s.data[0],n.data[3*y+1]=s.data[1],n.data[3*y+2]=s.data[2]}else{if(_!=="mat4x4"&&_!=="mat4x4f"&&_!=="mat4x4h")return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);if(!(y<4&&s.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[4*y]=s.data[0],n.data[4*y+1]=s.data[1],n.data[4*y+2]=s.data[2],n.data[4*y+3]=s.data[3]}}}}}else if(o instanceof nf){const c=o.value;if(!(n instanceof Xt))return void console.error(`Invalid assignment to ${c}. Variable ${r} is not a vector. Line ${t.line}`);if(s instanceof ae){if(c.length>1)return void console.error(`Invalid assignment to ${c} for variable ${r}. Line ${t.line}`);if(c==="x")n.data[0]=s.value;else if(c==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${c} for variable ${r}. Line ${t.line}`);n.data[1]=s.value}else if(c==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${c} for variable ${r}. Line ${t.line}`);n.data[2]=s.value}else if(c==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${c} for variable ${r}. Line ${t.line}`);n.data[3]=s.value}}else{if(!(s instanceof Xt))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);if(c.length!==s.data.length)return void console.error(`Invalid assignment to ${c} for variable ${r}. Line ${t.line}`);for(let y=0;y<c.length;++y){const _=c[y];if(_==="x"||_==="r")n.data[0]=s.data[y];else if(_==="y"||_==="g"){if(s.data.length<2)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${t.line}`);n.data[1]=s.data[y]}else if(_==="z"||_==="b"){if(s.data.length<3)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${t.line}`);n.data[2]=s.data[y]}else{if(_!=="w"&&_!=="a")return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${t.line}`);if(s.data.length<4)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${t.line}`);n.data[3]=s.data[y]}}}}}else n instanceof ae&&s instanceof ae?n.value=s.value:n instanceof Xt&&s instanceof Xt||n instanceof ln&&s instanceof ln?n.data.set(s.data):console.error(`Invalid assignment to ${r}. Line ${t.line}`)}_function(t,e){const n=new vx(t);e.functions.set(t.name,n)}_const(t,e){let n=null;t.value!==null&&(n=this.evalExpression(t.value,e)),e.createVariable(t.name,n,t)}_let(t,e){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,e),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof fs||(n=n.clone())}else{const r=t.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||r==="array"){const o=new tu(t.type,[]);n=this._evalCreate(o,e)}}e.createVariable(t.name,n,t)}_var(t,e){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,e),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof fs||(n=n.clone())}else{if(t.type===null)return void console.error(`Variable ${t.name} has no type. Line ${t.line}`);const r=t.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||t.type instanceof zA||t.type instanceof Gu||t.type instanceof me){const o=new tu(t.type,[]);n=this._evalCreate(o,e)}}e.createVariable(t.name,n,t)}_switch(t,e){e=e.clone();const n=this.evalExpression(t.condition,e);if(!(n instanceof ae))return console.error(`Invalid if condition. Line ${t.line}`),null;let r=null;for(const o of t.cases)if(o instanceof cR)for(const s of o.selectors){if(s instanceof mg){r=o;continue}const l=this.evalExpression(s,e);if(!(l instanceof ae))return console.error(`Invalid case selector. Line ${t.line}`),null;if(l.value===n.value)return this._execStatements(o.body,e)}else o instanceof hR&&(r=o);return r?this._execStatements(r.body,e):null}_if(t,e){e=e.clone();const n=this.evalExpression(t.condition,e);if(!(n instanceof ae))return console.error(`Invalid if condition. Line ${t.line}`),null;if(n.value)return this._execStatements(t.body,e);for(const r of t.elseif){const o=this.evalExpression(r.condition,e);if(!(o instanceof ae))return console.error(`Invalid if condition. Line ${t.line}`),null;if(o.value)return this._execStatements(r.body,e)}return t.else?this._execStatements(t.else,e):null}_getScalarValue(t){return t instanceof ae?t.value:(console.error("Expected scalar value.",t),0)}_for(t,e){for(e=e.clone(),this.execStatement(t.init,e);this._getScalarValue(this.evalExpression(t.condition,e));){const n=this._execStatements(t.body,e);if(n===Ao._breakObj)break;if(n!==null&&n!==Ao._continueObj)return n;this.execStatement(t.increment,e)}return null}_loop(t,e){for(e=e.clone();;){const n=this._execStatements(t.body,e);if(n===Ao._breakObj)break;if(n===Ao._continueObj){if(t.continuing&&this._execStatements(t.continuing.body,e)===Ao._breakObj)break}else if(n!==null)return n}return null}_while(t,e){for(e=e.clone();this._getScalarValue(this.evalExpression(t.condition,e));){const n=this._execStatements(t.body,e);if(n===Ao._breakObj)break;if(n!==Ao._continueObj&&n!==null)return n}return null}_evalBitcast(t,e){const n=this.evalExpression(t.value,e),r=t.type;if(n instanceof ae){const o=ZC(n.value,n.typeInfo.name,r.name);return new ae(o,this.getTypeInfo(r))}if(n instanceof Xt){const o=n.typeInfo.getTypeName();let s="";if(o.endsWith("f"))s="f32";else if(o.endsWith("i"))s="i32";else if(o.endsWith("u"))s="u32";else if(o.endsWith("b"))s="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${t.line}`),null;s="f16"}const l=r.getTypeName();let c="";if(l.endsWith("f"))c="f32";else if(l.endsWith("i"))c="i32";else if(l.endsWith("u"))c="u32";else if(l.endsWith("b"))c="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${c}. Line ${t.line}`),null;c="f16"}const y=(function(_,C,I){if(C===I)return _;const k=new Array(_.length);for(let z=0;z<_.length;z++)k[z]=ZC(_[z],C,I);return k})(Array.from(n.data),s,c);return new Xt(y,this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${t.line}`),null}_evalConst(t,e){return e.getVariableValue(t.name).clone().getSubData(this,t.postfix,e)}_evalCreate(t,e){var n;if(t instanceof tu){if(t.type===null)return _b.void;switch(t.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(t,e);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(t,e);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(t,e)}}const r=t instanceof tu?t.type.name:t.name,o=t instanceof tu?this.getTypeInfo(t.type):this.getTypeInfo(t.name);if(o===null)return console.error(`Unknown type ${r}. Line ${t.line}`),null;if(o.size===0)return null;const s=new $r(new ArrayBuffer(o.size),o,0);if(o instanceof Gc){if(t.args)for(let l=0;l<t.args.length;++l){const c=o.members[l],y=t.args[l],_=this.evalExpression(y,e);s.setData(this,_,c.type,c.offset,e)}}else if(o instanceof Xc){let l=0;if(t.args)for(let c=0;c<t.args.length;++c){const y=t.args[c],_=this.evalExpression(y,e);o.format===null&&(((n=_.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=_.typeInfo),s.setData(this,_,o.format,l,e),l+=o.stride}}else console.error(`Unknown type "${r}". Line ${t.line}`);return t instanceof tu?s.getSubData(this,t.postfix,e):s}_evalLiteral(t,e){const n=this.getTypeInfo(t.type),r=n.name;return r==="x32"||r==="u32"||r==="f32"||r==="f16"||r==="i32"||r==="bool"?new ae(t.scalarValue,n):r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"?this._callConstructorVec(t,e):r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"?this._callConstructorMatrix(t,e):t.value}_evalVariable(t,e){const n=e.getVariableValue(t.name);return n===null?n:n.getSubData(this,t.postfix,e)}_maxFormatTypeInfo(t){let e=t[0];if(e.name==="f32")return e;for(let n=1;n<t.length;++n){const r=Ao._priority.get(e.name);Ao._priority.get(t[n].name)<r&&(e=t[n])}return e.name==="x32"?this.getTypeInfo("i32"):e}_evalUnaryOp(t,e){const n=this.evalExpression(t.right,e);if(t.operator==="&")return new yd(n);if(t.operator==="*")return n instanceof yd?n.reference.getSubData(this,t.postfix,e):(console.error(`Invalid dereference. Line ${t.line}`),null);const r=n instanceof ae?n.value:n instanceof Xt?Array.from(n.data):null;switch(t.operator){case"+":{if(vi(r)){const l=r.map((c,y)=>+c);return new Xt(l,n.typeInfo)}const o=r,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ae(+o,s)}case"-":{if(vi(r)){const l=r.map((c,y)=>-c);return new Xt(l,n.typeInfo)}const o=r,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ae(-o,s)}case"!":{if(vi(r)){const l=r.map((c,y)=>c?0:1);return new Xt(l,n.typeInfo)}const o=r,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ae(o?0:1,s)}case"~":{if(vi(r)){const l=r.map((c,y)=>~c);return new Xt(l,n.typeInfo)}const o=r,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ae(~o,s)}}return console.error(`Invalid unary operator ${t.operator}. Line ${t.line}`),null}_evalBinaryOp(t,e){const n=this.evalExpression(t.left,e),r=this.evalExpression(t.right,e),o=n instanceof ae?n.value:n instanceof Xt||n instanceof ln?Array.from(n.data):null,s=r instanceof ae?r.value:r instanceof Xt||r instanceof ln?Array.from(r.data):null;switch(t.operator){case"+":{if(vi(o)&&vi(s)){const _=o,C=s;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k+C[z]);return new Xt(I,n.typeInfo)}if(vi(o)){const _=s,C=o.map((I,k)=>I+_);return new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_+I);return new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l+c,y)}case"-":{if(vi(o)&&vi(s)){const _=o,C=s;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k-C[z]);return new Xt(I,n.typeInfo)}if(vi(o)){const _=s,C=o.map((I,k)=>I-_);return new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_-I);return new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l-c,y)}case"*":{if(vi(o)&&vi(s)){const _=o,C=s;if(n instanceof ln&&r instanceof ln){const I=(function(X,H,$,Y){if(Lo[H.name]===void 0||Lo[Y.name]===void 0)return null;const ct=Lo[H.name][0],rt=Lo[H.name][1],nt=Lo[Y.name][0];if(ct!==Lo[Y.name][1])return null;const Ot=new Array(nt*rt);for(let Kt=0;Kt<rt;Kt++)for(let ft=0;ft<nt;ft++){let st=0;for(let Ut=0;Ut<ct;Ut++)st+=X[Ut*rt+Kt]*$[ft*ct+Ut];Ot[Kt*nt+ft]=st}return Ot})(_,n.typeInfo,C,r.typeInfo);if(I===null)return console.error(`Matrix multiplication failed. Line ${t.line}.`),null;const k=Lo[r.typeInfo.name][0],z=Lo[n.typeInfo.name][1],V=this.getTypeInfo(`mat${k}x${z}f`);return new ln(I,V)}if(n instanceof ln&&r instanceof Xt){const I=(function(k,z,V,X){if(Lo[z.name]===void 0||b_[X.name]===void 0)return null;const H=Lo[z.name][0],$=Lo[z.name][1];if(H!==V.length)return null;const Y=new Array($);for(let ct=0;ct<$;ct++){let rt=0;for(let nt=0;nt<H;nt++)rt+=k[nt*$+ct]*V[nt];Y[ct]=rt}return Y})(_,n.typeInfo,C,r.typeInfo);return I===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new Xt(I,r.typeInfo)}if(n instanceof Xt&&r instanceof ln){const I=(function(k,z,V,X){if(b_[z.name]===void 0||Lo[X.name]===void 0)return null;const H=Lo[X.name][0],$=Lo[X.name][1];if($!==k.length)return null;const Y=[];for(let ct=0;ct<H;ct++){let rt=0;for(let nt=0;nt<$;nt++)rt+=k[nt]*V[nt*H+ct];Y[ct]=rt}return Y})(_,n.typeInfo,C,r.typeInfo);return I===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new Xt(I,n.typeInfo)}{if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k*C[z]);return new Xt(I,n.typeInfo)}}if(vi(o)){const _=s,C=o.map((I,k)=>I*_);return n instanceof ln?new ln(C,n.typeInfo):new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_*I);return r instanceof ln?new ln(C,r.typeInfo):new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l*c,y)}case"%":{if(vi(o)&&vi(s)){const _=o,C=s;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k%C[z]);return new Xt(I,n.typeInfo)}if(vi(o)){const _=s,C=o.map((I,k)=>I%_);return new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_%I);return new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l%c,y)}case"/":{if(vi(o)&&vi(s)){const _=o,C=s;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k/C[z]);return new Xt(I,n.typeInfo)}if(vi(o)){const _=s,C=o.map((I,k)=>I/_);return new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_/I);return new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l/c,y)}case"&":{if(vi(o)&&vi(s)){const _=o,C=s;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k&C[z]);return new Xt(I,n.typeInfo)}if(vi(o)){const _=s,C=o.map((I,k)=>I&_);return new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_&I);return new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l&c,y)}case"|":{if(vi(o)&&vi(s)){const _=o,C=s;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k|C[z]);return new Xt(I,n.typeInfo)}if(vi(o)){const _=s,C=o.map((I,k)=>I|_);return new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_|I);return new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l|c,y)}case"^":{if(vi(o)&&vi(s)){const _=o,C=s;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k^C[z]);return new Xt(I,n.typeInfo)}if(vi(o)){const _=s,C=o.map((I,k)=>I^_);return new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_^I);return new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l^c,y)}case"<<":{if(vi(o)&&vi(s)){const _=o,C=s;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k<<C[z]);return new Xt(I,n.typeInfo)}if(vi(o)){const _=s,C=o.map((I,k)=>I<<_);return new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_<<I);return new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l<<c,y)}case">>":{if(vi(o)&&vi(s)){const _=o,C=s;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const I=_.map((k,z)=>k>>C[z]);return new Xt(I,n.typeInfo)}if(vi(o)){const _=s,C=o.map((I,k)=>I>>_);return new Xt(C,n.typeInfo)}if(vi(s)){const _=o,C=s.map((I,k)=>_>>I);return new Xt(C,r.typeInfo)}const l=o,c=s,y=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ae(l>>c,y)}case">":if(vi(o)&&vi(s)){const l=o,c=s;if(l.length!==c.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=l.map((_,C)=>_>c[C]?1:0);return new Xt(y,n.typeInfo)}if(vi(o)){const l=s,c=o.map((y,_)=>y>l?1:0);return new Xt(c,n.typeInfo)}if(vi(s)){const l=o,c=s.map((y,_)=>l>y?1:0);return new Xt(c,r.typeInfo)}return new ae(o>s?1:0,this.getTypeInfo("bool"));case"<":if(vi(o)&&vi(s)){const l=o,c=s;if(l.length!==c.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=l.map((_,C)=>_<c[C]?1:0);return new Xt(y,n.typeInfo)}if(vi(o)){const l=s,c=o.map((y,_)=>y<l?1:0);return new Xt(c,n.typeInfo)}if(vi(s)){const l=o,c=s.map((y,_)=>l<y?1:0);return new Xt(c,r.typeInfo)}return new ae(o<s?1:0,this.getTypeInfo("bool"));case"==":if(vi(o)&&vi(s)){const l=o,c=s;if(l.length!==c.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=l.map((_,C)=>_===c[C]?1:0);return new Xt(y,n.typeInfo)}if(vi(o)){const l=s,c=o.map((y,_)=>y==l?1:0);return new Xt(c,n.typeInfo)}if(vi(s)){const l=o,c=s.map((y,_)=>l==y?1:0);return new Xt(c,r.typeInfo)}return new ae(o===s?1:0,this.getTypeInfo("bool"));case"!=":if(vi(o)&&vi(s)){const l=o,c=s;if(l.length!==c.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=l.map((_,C)=>_!==c[C]?1:0);return new Xt(y,n.typeInfo)}if(vi(o)){const l=s,c=o.map((y,_)=>y!==l?1:0);return new Xt(c,n.typeInfo)}if(vi(s)){const l=o,c=s.map((y,_)=>l!==y?1:0);return new Xt(c,r.typeInfo)}return new ae(o!==s?1:0,this.getTypeInfo("bool"));case">=":if(vi(o)&&vi(s)){const l=o,c=s;if(l.length!==c.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=l.map((_,C)=>_>=c[C]?1:0);return new Xt(y,n.typeInfo)}if(vi(o)){const l=s,c=o.map((y,_)=>y>=l?1:0);return new Xt(c,n.typeInfo)}if(vi(s)){const l=o,c=s.map((y,_)=>l>=y?1:0);return new Xt(c,r.typeInfo)}return new ae(o>=s?1:0,this.getTypeInfo("bool"));case"<=":if(vi(o)&&vi(s)){const l=o,c=s;if(l.length!==c.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=l.map((_,C)=>_<=c[C]?1:0);return new Xt(y,n.typeInfo)}if(vi(o)){const l=s,c=o.map((y,_)=>y<=l?1:0);return new Xt(c,n.typeInfo)}if(vi(s)){const l=o,c=s.map((y,_)=>l<=y?1:0);return new Xt(c,r.typeInfo)}return new ae(o<=s?1:0,this.getTypeInfo("bool"));case"&&":if(vi(o)&&vi(s)){const l=o,c=s;if(l.length!==c.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=l.map((_,C)=>_&&c[C]?1:0);return new Xt(y,n.typeInfo)}if(vi(o)){const l=s,c=o.map((y,_)=>y&&l?1:0);return new Xt(c,n.typeInfo)}if(vi(s)){const l=o,c=s.map((y,_)=>l&&y?1:0);return new Xt(c,r.typeInfo)}return new ae(o&&s?1:0,this.getTypeInfo("bool"));case"||":if(vi(o)&&vi(s)){const l=o,c=s;if(l.length!==c.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=l.map((_,C)=>_||c[C]?1:0);return new Xt(y,n.typeInfo)}if(vi(o)){const l=s,c=o.map((y,_)=>y||l?1:0);return new Xt(c,n.typeInfo)}if(vi(s)){const l=o,c=s.map((y,_)=>l||y?1:0);return new Xt(c,r.typeInfo)}return new ae(o||s?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${t.operator}. Line ${t.line}`),null}_evalCall(t,e){if(t.cachedReturnValue!==null)return t.cachedReturnValue;const n=e.clone();n.currentFunctionName=t.name;const r=e.getFunction(t.name);if(!r)return t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)?this._evalCreate(t,e):(console.error(`Unknown function "${t.name}". Line ${t.line}`),null);for(let o=0;o<r.node.args.length;++o){const s=r.node.args[o],l=this.evalExpression(t.args[o],n);n.createVariable(s.name,l,s)}return this._execStatements(r.node.body,n)}_callBuiltinFunction(t,e){switch(t.name){case"all":return this.builtins.All(t,e);case"any":return this.builtins.Any(t,e);case"select":return this.builtins.Select(t,e);case"arrayLength":return this.builtins.ArrayLength(t,e);case"abs":return this.builtins.Abs(t,e);case"acos":return this.builtins.Acos(t,e);case"acosh":return this.builtins.Acosh(t,e);case"asin":return this.builtins.Asin(t,e);case"asinh":return this.builtins.Asinh(t,e);case"atan":return this.builtins.Atan(t,e);case"atanh":return this.builtins.Atanh(t,e);case"atan2":return this.builtins.Atan2(t,e);case"ceil":return this.builtins.Ceil(t,e);case"clamp":return this.builtins.Clamp(t,e);case"cos":return this.builtins.Cos(t,e);case"cosh":return this.builtins.Cosh(t,e);case"countLeadingZeros":return this.builtins.CountLeadingZeros(t,e);case"countOneBits":return this.builtins.CountOneBits(t,e);case"countTrailingZeros":return this.builtins.CountTrailingZeros(t,e);case"cross":return this.builtins.Cross(t,e);case"degrees":return this.builtins.Degrees(t,e);case"determinant":return this.builtins.Determinant(t,e);case"distance":return this.builtins.Distance(t,e);case"dot":return this.builtins.Dot(t,e);case"dot4U8Packed":return this.builtins.Dot4U8Packed(t,e);case"dot4I8Packed":return this.builtins.Dot4I8Packed(t,e);case"exp":return this.builtins.Exp(t,e);case"exp2":return this.builtins.Exp2(t,e);case"extractBits":return this.builtins.ExtractBits(t,e);case"faceForward":return this.builtins.FaceForward(t,e);case"firstLeadingBit":return this.builtins.FirstLeadingBit(t,e);case"firstTrailingBit":return this.builtins.FirstTrailingBit(t,e);case"floor":return this.builtins.Floor(t,e);case"fma":return this.builtins.Fma(t,e);case"fract":return this.builtins.Fract(t,e);case"frexp":return this.builtins.Frexp(t,e);case"insertBits":return this.builtins.InsertBits(t,e);case"inverseSqrt":return this.builtins.InverseSqrt(t,e);case"ldexp":return this.builtins.Ldexp(t,e);case"length":return this.builtins.Length(t,e);case"log":return this.builtins.Log(t,e);case"log2":return this.builtins.Log2(t,e);case"max":return this.builtins.Max(t,e);case"min":return this.builtins.Min(t,e);case"mix":return this.builtins.Mix(t,e);case"modf":return this.builtins.Modf(t,e);case"normalize":return this.builtins.Normalize(t,e);case"pow":return this.builtins.Pow(t,e);case"quantizeToF16":return this.builtins.QuantizeToF16(t,e);case"radians":return this.builtins.Radians(t,e);case"reflect":return this.builtins.Reflect(t,e);case"refract":return this.builtins.Refract(t,e);case"reverseBits":return this.builtins.ReverseBits(t,e);case"round":return this.builtins.Round(t,e);case"saturate":return this.builtins.Saturate(t,e);case"sign":return this.builtins.Sign(t,e);case"sin":return this.builtins.Sin(t,e);case"sinh":return this.builtins.Sinh(t,e);case"smoothstep":return this.builtins.SmoothStep(t,e);case"sqrt":return this.builtins.Sqrt(t,e);case"step":return this.builtins.Step(t,e);case"tan":return this.builtins.Tan(t,e);case"tanh":return this.builtins.Tanh(t,e);case"transpose":return this.builtins.Transpose(t,e);case"trunc":return this.builtins.Trunc(t,e);case"dpdx":return this.builtins.Dpdx(t,e);case"dpdxCoarse":return this.builtins.DpdxCoarse(t,e);case"dpdxFine":return this.builtins.DpdxFine(t,e);case"dpdy":return this.builtins.Dpdy(t,e);case"dpdyCoarse":return this.builtins.DpdyCoarse(t,e);case"dpdyFine":return this.builtins.DpdyFine(t,e);case"fwidth":return this.builtins.Fwidth(t,e);case"fwidthCoarse":return this.builtins.FwidthCoarse(t,e);case"fwidthFine":return this.builtins.FwidthFine(t,e);case"textureDimensions":return this.builtins.TextureDimensions(t,e);case"textureGather":return this.builtins.TextureGather(t,e);case"textureGatherCompare":return this.builtins.TextureGatherCompare(t,e);case"textureLoad":return this.builtins.TextureLoad(t,e);case"textureNumLayers":return this.builtins.TextureNumLayers(t,e);case"textureNumLevels":return this.builtins.TextureNumLevels(t,e);case"textureNumSamples":return this.builtins.TextureNumSamples(t,e);case"textureSample":return this.builtins.TextureSample(t,e);case"textureSampleBias":return this.builtins.TextureSampleBias(t,e);case"textureSampleCompare":return this.builtins.TextureSampleCompare(t,e);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(t,e);case"textureSampleGrad":return this.builtins.TextureSampleGrad(t,e);case"textureSampleLevel":return this.builtins.TextureSampleLevel(t,e);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(t,e);case"textureStore":return this.builtins.TextureStore(t,e);case"atomicLoad":return this.builtins.AtomicLoad(t,e);case"atomicStore":return this.builtins.AtomicStore(t,e);case"atomicAdd":return this.builtins.AtomicAdd(t,e);case"atomicSub":return this.builtins.AtomicSub(t,e);case"atomicMax":return this.builtins.AtomicMax(t,e);case"atomicMin":return this.builtins.AtomicMin(t,e);case"atomicAnd":return this.builtins.AtomicAnd(t,e);case"atomicOr":return this.builtins.AtomicOr(t,e);case"atomicXor":return this.builtins.AtomicXor(t,e);case"atomicExchange":return this.builtins.AtomicExchange(t,e);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(t,e);case"pack4x8snorm":return this.builtins.Pack4x8snorm(t,e);case"pack4x8unorm":return this.builtins.Pack4x8unorm(t,e);case"pack4xI8":return this.builtins.Pack4xI8(t,e);case"pack4xU8":return this.builtins.Pack4xU8(t,e);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(t,e);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(t,e);case"pack2x16snorm":return this.builtins.Pack2x16snorm(t,e);case"pack2x16unorm":return this.builtins.Pack2x16unorm(t,e);case"pack2x16float":return this.builtins.Pack2x16float(t,e);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(t,e);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(t,e);case"unpack4xI8":return this.builtins.Unpack4xI8(t,e);case"unpack4xU8":return this.builtins.Unpack4xU8(t,e);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(t,e);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(t,e);case"unpack2x16float":return this.builtins.Unpack2x16float(t,e);case"storageBarrier":return this.builtins.StorageBarrier(t,e);case"textureBarrier":return this.builtins.TextureBarrier(t,e);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(t,e);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(t,e);case"subgroupAdd":return this.builtins.SubgroupAdd(t,e);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(t,e);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(t,e);case"subgroupAll":return this.builtins.SubgroupAll(t,e);case"subgroupAnd":return this.builtins.SubgroupAnd(t,e);case"subgroupAny":return this.builtins.SubgroupAny(t,e);case"subgroupBallot":return this.builtins.SubgroupBallot(t,e);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(t,e);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(t,e);case"subgroupElect":return this.builtins.SubgroupElect(t,e);case"subgroupMax":return this.builtins.SubgroupMax(t,e);case"subgroupMin":return this.builtins.SubgroupMin(t,e);case"subgroupMul":return this.builtins.SubgroupMul(t,e);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(t,e);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(t,e);case"subgroupOr":return this.builtins.SubgroupOr(t,e);case"subgroupShuffle":return this.builtins.SubgroupShuffle(t,e);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(t,e);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(t,e);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(t,e);case"subgroupXor":return this.builtins.SubgroupXor(t,e);case"quadBroadcast":return this.builtins.QuadBroadcast(t,e);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(t,e);case"quadSwapX":return this.builtins.QuadSwapX(t,e);case"quadSwapY":return this.builtins.QuadSwapY(t,e)}const n=e.getFunction(t.name);if(n){const r=e.clone();for(let o=0;o<n.node.args.length;++o){const s=n.node.args[o],l=this.evalExpression(t.args[o],r);r.setVariable(s.name,l,s)}return this._execStatements(n.node.body,r)}return null}_callConstructorValue(t,e){if(!t.args||t.args.length===0)return new ae(0,this.getTypeInfo(t.type));const n=this.evalExpression(t.args[0],e);return n.typeInfo=this.getTypeInfo(t.type),n.getSubData(this,t.postfix,e).clone()}_callConstructorVec(t,e){const n=this.getTypeInfo(t.type),r=t.type.getTypeName(),o=b_[r];if(o===void 0)return console.error(`Invalid vec constructor ${r}. Line ${t.line}`),null;const s=[];if(t instanceof Cs)if(t.isVector){const l=t.vectorValue;for(const c of l)s.push(c)}else s.push(t.scalarValue);else if(t.args)for(const l of t.args){const c=this.evalExpression(l,e);if(c instanceof Xt){const y=c.data;for(let _=0;_<y.length;++_){let C=y[_];s.push(C)}}else if(c instanceof ae){let y=c.value;s.push(y)}}if(t.type instanceof me&&t.type.format===null&&(t.type.format=me.f32),s.length===0){const l=new Array(o).fill(0);return new Xt(l,n).getSubData(this,t.postfix,e)}if(s.length===1)for(;s.length<o;)s.push(s[0]);return s.length<o?(console.error(`Invalid vec constructor. Line ${t.line}`),null):new Xt(s.length>o?s.slice(0,o):s,n).getSubData(this,t.postfix,e)}_callConstructorMatrix(t,e){const n=this.getTypeInfo(t.type),r=t.type.getTypeName(),o=Lo[r];if(o===void 0)return console.error(`Invalid matrix constructor ${r}. Line ${t.line}`),null;const s=[];if(t instanceof Cs)if(t.isVector){const l=t.vectorValue;for(const c of l)s.push(c)}else s.push(t.scalarValue);else if(t.args)for(const l of t.args){const c=this.evalExpression(l,e);c instanceof Xt?s.push(...c.data):c instanceof ae?s.push(c.value):c instanceof ln&&s.push(...c.data)}if(n instanceof ef&&n.format===null&&(n.format=this.getTypeInfo("f32")),s.length===0){const l=new Array(o[2]).fill(0);return new ln(l,n).getSubData(this,t.postfix,e)}return s.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${t.line}`),null):new ln(s,n).getSubData(this,t.postfix,e)}}Ao._breakObj=new za(new Fa("BREAK",null),null),Ao._continueObj=new za(new Fa("CONTINUE",null),null),Ao._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class j7{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class W7{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new j7,this._exec=new Ao,this._forwardTypeCount=0}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const e=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;e.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const r=n.arrayType,o=n.countNode;if(o instanceof ca){const s=o.name,l=this._context.constants.get(s);if(l)try{const c=l.constEvaluate(this._exec);r.count=c}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of e)n.search(r=>{r instanceof qC||r instanceof Ag?r.type=this._forwardType(r.type):r instanceof zA?r.format=this._forwardType(r.format):r instanceof Wu||r instanceof NA||r instanceof pg?r.type=this._forwardType(r.type):r instanceof tm?r.returnType=this._forwardType(r.returnType):r instanceof XC&&(r.type=this._forwardType(r.type))});return e}_forwardType(t){if(t instanceof HC){const e=this._getType(t.name);if(e)return e}else t instanceof Ag?t.type=this._forwardType(t.type):t instanceof zA&&(t.format=this._forwardType(t.format));return t}_initialize(t){if(t)if(typeof t=="string"){const e=new L7(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_updateNode(t,e){return t.line=e??this._currentLine,t}_error(t,e){return{token:t,message:e,toString:()=>`${e}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==kt.eof}_match(t){if(t instanceof he)return!!this._check(t)&&(this._advance(),!0);for(let e=0,n=t.length;e<n;++e){const r=t[e];if(this._check(r))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),`${e}. Line:${this._currentLine}`)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){const n=e.type;let r=!1;for(const o of t){if(n===o)return!0;o===kt.tokens.name&&(r=!0)}if(r){const o=kt.tokens.name.rule.exec(e.lexeme);if(o&&o.index==0&&o[0]==e.lexeme)return!0}return!1}if(e.type===t)return!0;if(t===kt.tokens.name){const n=kt.tokens.name.rule.exec(e.lexeme);return n&&n.index==0&&n[0]==e.lexeme}return!1}_advance(){var t,e;return this._currentLine=(e=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&e!==void 0?e:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(kt.tokens.semicolon)&&!this._isAtEnd(););if(this._match(kt.keywords.alias)){const e=this._type_alias();return this._consume(kt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(kt.keywords.diagnostic)){const e=this._diagnostic();return this._consume(kt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(kt.keywords.requires)){const e=this._requires_directive();return this._consume(kt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(kt.keywords.enable)){const e=this._enable_directive();return this._consume(kt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const t=this._attribute();if(this._check(kt.keywords.var)){const e=this._global_variable_decl();return e!=null&&(e.attributes=t),this._consume(kt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(kt.keywords.override)){const e=this._override_variable_decl();return e!=null&&(e.attributes=t),this._consume(kt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(kt.keywords.let)){const e=this._global_let_decl();return e!=null&&(e.attributes=t),this._consume(kt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(kt.keywords.const)){const e=this._global_const_decl();return e!=null&&(e.attributes=t),this._consume(kt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(kt.keywords.struct)){const e=this._struct_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}if(this._check(kt.keywords.fn)){const e=this._function_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}return null}_function_decl(){if(!this._match(kt.keywords.fn))return null;const t=this._currentLine,e=this._consume(kt.tokens.ident,"Expected function name.").toString();this._consume(kt.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(kt.tokens.paren_right))do{if(this._check(kt.tokens.paren_right))break;const l=this._attribute(),c=this._consume(kt.tokens.name,"Expected argument name.").toString();this._consume(kt.tokens.colon,"Expected ':' for argument type.");const y=this._attribute(),_=this._type_decl();_!=null&&(_.attributes=y,n.push(this._updateNode(new XC(c,_,l))))}while(this._match(kt.tokens.comma));this._consume(kt.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(kt.tokens.arrow)){const l=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=l)}const o=this._compound_statement(),s=this._currentLine;return this._updateNode(new tm(e,n,r,o,t,s),t)}_compound_statement(){const t=[];for(this._consume(kt.tokens.brace_left,"Expected '{' for block.");!this._check(kt.tokens.brace_right);){const e=this._statement();e!==null&&t.push(e)}return this._consume(kt.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(kt.tokens.semicolon)&&!this._isAtEnd(););if(this._check(kt.tokens.attr)&&this._attribute(),this._check(kt.keywords.if))return this._if_statement();if(this._check(kt.keywords.switch))return this._switch_statement();if(this._check(kt.keywords.loop))return this._loop_statement();if(this._check(kt.keywords.for))return this._for_statement();if(this._check(kt.keywords.while))return this._while_statement();if(this._check(kt.keywords.continuing))return this._continuing_statement();if(this._check(kt.keywords.static_assert))return this._static_assert_statement();if(this._check(kt.tokens.brace_left))return this._compound_statement();let t=null;if(this._check(kt.keywords.return))t=this._return_statement();else if(this._check([kt.keywords.var,kt.keywords.let,kt.keywords.const]))t=this._variable_statement();else if(this._match(kt.keywords.discard))t=this._updateNode(new M7);else if(this._match(kt.keywords.break)){const e=this._updateNode(new rR);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];e.loopId=n.id}t=e,this._check(kt.keywords.if)&&(this._advance(),e.condition=this._optional_paren_expression())}else if(this._match(kt.keywords.continue)){const e=this._updateNode(new sR);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${e.line}`);{const n=this._currentLoop[this._currentLoop.length-1];e.loopId=n.id}t=e}else t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return t!=null&&this._consume(kt.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(kt.keywords.static_assert))return null;const t=this._currentLine,e=this._optional_paren_expression();return this._updateNode(new S7(e),t)}_while_statement(){if(!this._match(kt.keywords.while))return null;const t=this._updateNode(new Z6(null,null));return this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(kt.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_continuing_statement(){const t=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(kt.keywords.continuing))return null;const e=this._currentLine,n=this._compound_statement();return this._updateNode(new vb(n,t),e)}_for_statement(){if(!this._match(kt.keywords.for))return null;this._consume(kt.tokens.paren_left,"Expected '('.");const t=this._updateNode(new Y6(null,null,null,null));return this._currentLoop.push(t),t.init=this._check(kt.tokens.semicolon)?null:this._for_init(),this._consume(kt.tokens.semicolon,"Expected ';'."),t.condition=this._check(kt.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(kt.tokens.semicolon,"Expected ';'."),t.increment=this._check(kt.tokens.paren_right)?null:this._for_increment(),this._consume(kt.tokens.paren_right,"Expected ')'."),this._check(kt.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(kt.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(kt.tokens.equal)&&(e=this._short_circuit_or_expression()),this._updateNode(new Wu(t.name,t.type,t.storage,t.access,e),t.line)}if(this._match(kt.keywords.let)){const t=this._currentLine,e=this._consume(kt.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(kt.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(kt.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new NA(e,n,null,null,r),t)}if(this._match(kt.keywords.const)){const t=this._currentLine,e=this._consume(kt.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(kt.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(kt.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return n===null&&r instanceof Cs&&(n=r.type),this._updateNode(new pg(e,n,null,null,r),t)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(e==null)return null;if(!this._check(kt.increment_operators))return this._current=t,null;const n=this._consume(kt.increment_operators,"Expected increment operator");return this._updateNode(new Q6(n.type===kt.tokens.plus_plus?Wd.increment:Wd.decrement,e))}_assignment_statement(){let t=null;const e=this._currentLine;if(this._check(kt.tokens.brace_right))return null;let n=this._match(kt.tokens.underscore);if(n||(t=this._unary_expression()),!n&&t==null)return null;const r=this._consume(kt.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new J6(PA.parse(r.lexeme),t,o),e)}_func_call_statement(){if(!this._check(kt.tokens.ident))return null;const t=this._currentLine,e=this._current,n=this._consume(kt.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):this._updateNode(new px(n.lexeme,r),t)}_loop_statement(){if(!this._match(kt.keywords.loop))return null;this._check(kt.tokens.attr)&&this._attribute(),this._consume(kt.tokens.brace_left,"Expected '{' for loop.");const t=this._updateNode(new $6([],null));this._currentLoop.push(t);let e=this._statement();for(;e!==null;){if(Array.isArray(e))for(let n of e)t.body.push(n);else t.body.push(e);if(e instanceof vb){t.continuing=e;break}e=this._statement()}return this._currentLoop.pop(),this._consume(kt.tokens.brace_right,"Expected '}' for loop."),t}_switch_statement(){if(!this._match(kt.keywords.switch))return null;const t=this._updateNode(new tR(null,[]));if(this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(kt.tokens.attr)&&this._attribute(),this._consume(kt.tokens.brace_left,"Expected '{' for switch."),t.cases=this._switch_body(),t.cases==null||t.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(kt.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),t}_switch_body(){const t=[];let e=!1;for(;this._check([kt.keywords.default,kt.keywords.case]);){if(this._match(kt.keywords.case)){const n=this._case_selectors();for(const o of n)if(o instanceof mg){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");e=!0;break}this._match(kt.tokens.colon),this._check(kt.tokens.attr)&&this._attribute(),this._consume(kt.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(kt.tokens.brace_right,"Exected '}' for switch case."),t.push(this._updateNode(new cR(n,r)))}if(this._match(kt.keywords.default)){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(kt.tokens.colon),this._check(kt.tokens.attr)&&this._attribute(),this._consume(kt.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(kt.tokens.brace_right,"Exected '}' for switch default."),t.push(this._updateNode(new hR(n)))}}return t}_case_selectors(){const t=[];for(this._match(kt.keywords.default)?t.push(this._updateNode(new mg)):t.push(this._shift_expression());this._match(kt.tokens.comma);)this._match(kt.keywords.default)?t.push(this._updateNode(new mg)):t.push(this._shift_expression());return t}_case_body(){if(this._match(kt.keywords.fallthrough))return this._consume(kt.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const e=this._case_body();return e.length==0?t:[...t,e[0]]}_if_statement(){if(!this._match(kt.keywords.if))return null;const t=this._currentLine,e=this._optional_paren_expression();this._check(kt.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(kt.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let o=null;return this._match(kt.keywords.else)&&(this._check(kt.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new eR(e,n,r,o),t)}_match_elseif(){return this._tokens[this._current].type===kt.keywords.else&&this._tokens[this._current+1].type===kt.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){const e=this._optional_paren_expression(),n=this._compound_statement();return t.push(this._updateNode(new B7(e,n))),this._match_elseif()&&(this._check(kt.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(kt.keywords.return))return null;const t=this._short_circuit_or_expression();return this._updateNode(new iR(t))}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(kt.tokens.or_or);)t=this._updateNode(new ol(this._previous().toString(),t,this._short_circuit_and_expr()));return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(kt.tokens.and_and);)t=this._updateNode(new ol(this._previous().toString(),t,this._inclusive_or_expression()));return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(kt.tokens.or);)t=this._updateNode(new ol(this._previous().toString(),t,this._exclusive_or_expression()));return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(kt.tokens.xor);)t=this._updateNode(new ol(this._previous().toString(),t,this._and_expression()));return t}_and_expression(){let t=this._equality_expression();for(;this._match(kt.tokens.and);)t=this._updateNode(new ol(this._previous().toString(),t,this._equality_expression()));return t}_equality_expression(){const t=this._relational_expression();return this._match([kt.tokens.equal_equal,kt.tokens.not_equal])?this._updateNode(new ol(this._previous().toString(),t,this._relational_expression())):t}_relational_expression(){let t=this._shift_expression();for(;this._match([kt.tokens.less_than,kt.tokens.greater_than,kt.tokens.less_than_equal,kt.tokens.greater_than_equal]);)t=this._updateNode(new ol(this._previous().toString(),t,this._shift_expression()));return t}_shift_expression(){let t=this._additive_expression();for(;this._match([kt.tokens.shift_left,kt.tokens.shift_right]);)t=this._updateNode(new ol(this._previous().toString(),t,this._additive_expression()));return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([kt.tokens.plus,kt.tokens.minus]);)t=this._updateNode(new ol(this._previous().toString(),t,this._multiplicative_expression()));return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([kt.tokens.star,kt.tokens.forward_slash,kt.tokens.modulo]);)t=this._updateNode(new ol(this._previous().toString(),t,this._unary_expression()));return t}_unary_expression(){return this._match([kt.tokens.minus,kt.tokens.bang,kt.tokens.tilde,kt.tokens.star,kt.tokens.and])?this._updateNode(new fs(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(kt.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(kt.tokens.bracket_right,"Expected ']'.");const e=this._updateNode(new mp(t)),n=this._postfix_expression();return n&&(e.postfix=n),e}if(this._match(kt.tokens.period)){const t=this._consume(kt.tokens.name,"Expected member name."),e=this._postfix_expression(),n=this._updateNode(new nf(t.lexeme));return e&&(n.postfix=e),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_getType(t){const e=this._getStruct(t);if(e!==null)return e;switch(t){case"void":return He.void;case"bool":return He.bool;case"i32":return He.i32;case"u32":return He.u32;case"f32":return He.f32;case"f16":return He.f16;case"vec2f":return me.vec2f;case"vec3f":return me.vec3f;case"vec4f":return me.vec4f;case"vec2i":return me.vec2i;case"vec3i":return me.vec3i;case"vec4i":return me.vec4i;case"vec2u":return me.vec2u;case"vec3u":return me.vec3u;case"vec4u":return me.vec4u;case"vec2h":return me.vec2h;case"vec3h":return me.vec3h;case"vec4h":return me.vec4h;case"mat2x2f":return me.mat2x2f;case"mat2x3f":return me.mat2x3f;case"mat2x4f":return me.mat2x4f;case"mat3x2f":return me.mat3x2f;case"mat3x3f":return me.mat3x3f;case"mat3x4f":return me.mat3x4f;case"mat4x2f":return me.mat4x2f;case"mat4x3f":return me.mat4x3f;case"mat4x4f":return me.mat4x4f;case"mat2x2h":return me.mat2x2h;case"mat2x3h":return me.mat2x3h;case"mat2x4h":return me.mat2x4h;case"mat3x2h":return me.mat3x2h;case"mat3x3h":return me.mat3x3h;case"mat3x4h":return me.mat3x4h;case"mat4x2h":return me.mat4x2h;case"mat4x3h":return me.mat4x3h;case"mat4x4h":return me.mat4x4h;case"mat2x2i":return me.mat2x2i;case"mat2x3i":return me.mat2x3i;case"mat2x4i":return me.mat2x4i;case"mat3x2i":return me.mat3x2i;case"mat3x3i":return me.mat3x3i;case"mat3x4i":return me.mat3x4i;case"mat4x2i":return me.mat4x2i;case"mat4x3i":return me.mat4x3i;case"mat4x4i":return me.mat4x4i;case"mat2x2u":return me.mat2x2u;case"mat2x3u":return me.mat2x3u;case"mat2x4u":return me.mat2x4u;case"mat3x2u":return me.mat3x2u;case"mat3x3u":return me.mat3x3u;case"mat3x4u":return me.mat3x4u;case"mat4x2u":return me.mat4x2u;case"mat4x3u":return me.mat4x3u;case"mat4x4u":return me.mat4x4u}return null}_validateTypeRange(t,e){if(e.name==="i32"){if(t<-2147483648||t>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${t}. Line: ${this._currentLine}.`)}else if(e.name==="u32"&&(t<0||t>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${t}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(kt.tokens.ident)){const n=this._previous().toString();if(this._check(kt.tokens.paren_left)){const r=this._argument_expression_list(),o=this._getType(n);return o!==null?this._updateNode(new tu(o,r)):this._updateNode(new mx(n,r))}if(this._context.constants.has(n)){const r=this._context.constants.get(n);return this._updateNode(new oR(n,r.value))}return this._updateNode(new ca(n))}if(this._match(kt.tokens.int_literal)){const n=this._previous().toString();let r=n.endsWith("i")||n.endsWith("i")?He.i32:n.endsWith("u")||n.endsWith("U")?He.u32:He.x32;const o=parseInt(n);return this._validateTypeRange(o,r),this._updateNode(new Cs(new ae(o,this._exec.getTypeInfo(r)),r))}if(this._match(kt.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,He.u32),this._updateNode(new Cs(new ae(n,this._exec.getTypeInfo(He.u32)),He.u32))}if(this._match([kt.tokens.decimal_float_literal,kt.tokens.hex_float_literal])){let n=this._previous().toString(),r=n.endsWith("h");r&&(n=n.substring(0,n.length-1));const o=parseFloat(n);this._validateTypeRange(o,r?He.f16:He.f32);const s=r?He.f16:He.f32;return this._updateNode(new Cs(new ae(o,this._exec.getTypeInfo(s)),s))}if(this._match([kt.keywords.true,kt.keywords.false])){let n=this._previous().toString()===kt.keywords.true.rule;return this._updateNode(new Cs(new ae(n?1:0,this._exec.getTypeInfo(He.bool)),He.bool))}if(this._check(kt.tokens.paren_left))return this._paren_expression();if(this._match(kt.keywords.bitcast)){this._consume(kt.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(kt.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return this._updateNode(new aR(n,r))}const t=this._type_decl(),e=this._argument_expression_list();return this._updateNode(new tu(t,e))}_argument_expression_list(){if(!this._match(kt.tokens.paren_left))return null;const t=[];do{if(this._check(kt.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(kt.tokens.comma));return this._consume(kt.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(kt.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(kt.tokens.paren_right),t}_paren_expression(){this._consume(kt.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(kt.tokens.paren_right,"Expected ')'."),t}_struct_decl(){if(!this._match(kt.keywords.struct))return null;const t=this._currentLine,e=this._consume(kt.tokens.ident,"Expected name for struct.").toString();this._consume(kt.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(kt.tokens.brace_right);){const s=this._attribute(),l=this._consume(kt.tokens.name,"Expected variable name.").toString();this._consume(kt.tokens.colon,"Expected ':' for struct member type.");const c=this._attribute(),y=this._type_decl();y!=null&&(y.attributes=c),this._check(kt.tokens.brace_right)?this._match(kt.tokens.comma):this._consume(kt.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new qC(l,y,s)))}this._consume(kt.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,o=this._updateNode(new Gu(e,n,t,r),t);return this._context.structs.set(e,o),o}_global_variable_decl(){const t=this._variable_decl();if(!t)return null;if(this._match(kt.tokens.equal)){const e=this._const_expression();t.value=e}if(t.type!==null&&t.value instanceof Cs){if(t.value.type.name!=="x32"&&t.type.getTypeName()!==t.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${t.value.type.name} to ${t.type.name}. Line:${this._currentLine}`);t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type),t.value.type=t.type}else t.type===null&&t.value instanceof Cs&&(t.type=t.value.type.name==="x32"?He.i32:t.value.type,t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type));return t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(kt.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){var t;if(!this._match(kt.keywords.const))return null;const e=this._consume(kt.tokens.name,"Expected variable name"),n=this._currentLine;let r=null;if(this._match(kt.tokens.colon)){const c=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=c)}let o=null;this._consume(kt.tokens.equal,"const declarations require an assignment");const s=this._short_circuit_or_expression();try{let c=[He.f32],y=s.constEvaluate(this._exec,c);y instanceof ae&&this._validateTypeRange(y.value,c[0]),c[0]instanceof me&&c[0].format===null&&y.typeInfo instanceof ef&&y.typeInfo.format!==null&&(y.typeInfo.format.name==="f16"?c[0].format=He.f16:y.typeInfo.format.name==="f32"?c[0].format=He.f32:y.typeInfo.format.name==="i32"?c[0].format=He.i32:y.typeInfo.format.name==="u32"?c[0].format=He.u32:y.typeInfo.format.name==="bool"?c[0].format=He.bool:console.error(`TODO: impelement template format type ${y.typeInfo.format.name}`)),o=this._updateNode(new Cs(y,c[0])),this._exec.context.setVariable(e.toString(),y)}catch{o=s}if(r!==null&&o instanceof Cs){if(o.type.name!=="x32"&&r.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${r.name}. Line:${this._currentLine}`);o.type=r,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else r===null&&o instanceof Cs&&(r=(t=o?.type)!==null&&t!==void 0?t:He.f32,r===He.x32&&(r=He.i32));const l=this._updateNode(new pg(e.toString(),r,"","",o),n);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(kt.keywords.let))return null;const t=this._currentLine,e=this._consume(kt.tokens.name,"Expected variable name");let n=null;if(this._match(kt.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}let r=null;if(this._match(kt.tokens.equal)&&(r=this._const_expression()),n!==null&&r instanceof Cs){if(r.type.name!=="x32"&&n.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${n.name}. Line:${this._currentLine}`);r.type=n}else n===null&&r instanceof Cs&&(n=r.type.name==="x32"?He.i32:r.type);return r instanceof Cs&&r.isScalar&&this._validateTypeRange(r.scalarValue,n),this._updateNode(new NA(e.toString(),n,"","",r),t)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(kt.keywords.var))return null;const t=this._currentLine;let e="",n="";this._match(kt.tokens.less_than)&&(e=this._consume(kt.storage_class,"Expected storage_class.").toString(),this._match(kt.tokens.comma)&&(n=this._consume(kt.access_mode,"Expected access_mode.").toString()),this._consume(kt.tokens.greater_than,"Expected '>'."));const r=this._consume(kt.tokens.name,"Expected variable name");let o=null;if(this._match(kt.tokens.colon)){const s=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=s)}return this._updateNode(new Wu(r.toString(),o,e,n,null),t)}_override_decl(){if(!this._match(kt.keywords.override))return null;const t=this._consume(kt.tokens.name,"Expected variable name");let e=null;if(this._match(kt.tokens.colon)){const n=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=n)}return this._updateNode(new dx(t.toString(),e,null))}_diagnostic(){this._consume(kt.tokens.paren_left,"Expected '('");const t=this._consume(kt.tokens.ident,"Expected severity control name.");this._consume(kt.tokens.comma,"Expected ','");let e=this._consume(kt.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(kt.tokens.period)&&(e+=`.${this._consume(kt.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(kt.tokens.paren_right,"Expected ')'"),this._updateNode(new nR(t.toString(),e))}_enable_directive(){const t=this._consume(kt.tokens.ident,"identity expected.");return this._updateNode(new P7(t.toString()))}_requires_directive(){const t=[this._consume(kt.tokens.ident,"identity expected.").toString()];for(;this._match(kt.tokens.comma);){const e=this._consume(kt.tokens.ident,"identity expected.");t.push(e.toString())}return this._updateNode(new I7(t))}_type_alias(){const t=this._consume(kt.tokens.ident,"identity expected.");this._consume(kt.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(e===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const n=this._updateNode(new Ax(t.toString(),e));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([kt.tokens.ident,...kt.texel_format,kt.keywords.bool,kt.keywords.f32,kt.keywords.i32,kt.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const r=this._updateNode(new HC(n));return this._forwardTypeCount++,r}return this._updateNode(new He(n))}let t=this._texture_sampler_types();if(t)return t;if(this._check(kt.template_types)){let n=this._advance().toString(),r=null,o=null;return this._match(kt.tokens.less_than)&&(r=this._type_decl(),o=null,this._match(kt.tokens.comma)&&(o=this._consume(kt.access_mode,"Expected access_mode for pointer").toString()),this._consume(kt.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new me(n,r,o))}if(this._match(kt.keywords.ptr)){let n=this._previous().toString();this._consume(kt.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(kt.storage_class,"Expected storage_class for pointer");this._consume(kt.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let s=null;return this._match(kt.tokens.comma)&&(s=this._consume(kt.access_mode,"Expected access_mode for pointer").toString()),this._consume(kt.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Ag(n,r.toString(),o,s))}const e=this._attribute();if(this._match(kt.keywords.array)){let n=null,r=-1;const o=this._previous();let s=null;if(this._match(kt.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let c="";if(this._match(kt.tokens.comma)){s=this._shift_expression();try{c=s.constEvaluate(this._exec).toString(),s=null}catch{c="1"}}this._consume(kt.tokens.greater_than,"Expected '>' for array."),r=c?parseInt(c):0}const l=this._updateNode(new zA(o.toString(),e,n,r));return s&&this._deferArrayCountEval.push({arrayType:l,countNode:s}),l}return null}_texture_sampler_types(){if(this._match(kt.sampler_type))return this._updateNode(new IA(this._previous().toString(),null,null));if(this._match(kt.depth_texture_type))return this._updateNode(new IA(this._previous().toString(),null,null));if(this._match(kt.sampled_texture_type)||this._match(kt.multisampled_texture_type)){const t=this._previous();this._consume(kt.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(kt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new IA(t.toString(),e,null))}if(this._match(kt.storage_texture_type)){const t=this._previous();this._consume(kt.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(kt.texel_format,"Invalid texel format.").toString();this._consume(kt.tokens.comma,"Expected ',' after texel format.");const n=this._consume(kt.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(kt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new IA(t.toString(),e,n))}return null}_attribute(){let t=[];for(;this._match(kt.tokens.attr);){const e=this._consume(kt.attribute_name,"Expected attribute name"),n=this._updateNode(new fR(e.toString(),null));if(this._match(kt.tokens.paren_left)){if(n.value=this._consume(kt.literal_or_ident,"Expected attribute value").toString(),this._check(kt.tokens.comma)){this._advance();do{const r=this._consume(kt.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(r)}while(this._match(kt.tokens.comma))}this._consume(kt.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}}class H7 extends nu{constructor(t){super(),t&&this.update(t)}update(t){const e=new W7().parse(t);this.updateAST(e)}}function X7(i){const t={attributes:[],bindings:[]};let e;try{e=q7(i)}catch(o){return Xe.error(o.message)(),t}for(const o of e.uniforms){const s=[];for(const l of o.type?.members||[])s.push({name:l.name,type:YC(l.type)});t.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:s})}for(const o of e.textures)t.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of e.samplers)t.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const n=e.entry.vertex[0],r=n?.inputs.length||0;for(let o=0;o<r;o++){const s=n.inputs[o];if(s.locationType==="location"){const l=YC(s.type);t.attributes.push({name:s.name,location:Number(s.location),type:l})}}return t}function YC(i){return i?.format?`${i.name}<${i.format.name}>`:i.name}function q7(i){try{return new H7(i)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw typeof t=="object"&&t?.message&&(e+=`: ${t.message} `),typeof t=="object"&&t?.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}const K7=1/Math.PI*180,Z7=1/180*Math.PI,Y7={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Y7}};const Ss=globalThis.mathgl.config;function Q7(i,{precision:t=Ss.precision}={}){return i=eV(i),`${parseFloat(i.toPrecision(t))}`}function Zc(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function J7(i){return tV(i)}function $7(i){return ul(i)}function tV(i,t){return bx(i,e=>e*Z7,t)}function ul(i,t){return bx(i,e=>e*K7,t)}function Xu(i,t,e){return bx(i,n=>Math.max(t,Math.min(e,n)))}function gl(i,t,e){return Zc(i)?i.map((n,r)=>gl(n,t[r],e)):e*t+(1-e)*i}function Aa(i,t,e){const n=Ss.EPSILON;e&&(Ss.EPSILON=e);try{if(i===t)return!0;if(Zc(i)&&Zc(t)){if(i.length!==t.length)return!1;for(let r=0;r<i.length;++r)if(!Aa(i[r],t[r]))return!1;return!0}return i&&i.equals?i.equals(t):t&&t.equals?t.equals(i):typeof i=="number"&&typeof t=="number"?Math.abs(i-t)<=Ss.EPSILON*Math.max(1,Math.abs(i),Math.abs(t)):!1}finally{Ss.EPSILON=n}}function eV(i){return Math.round(i/Ss.EPSILON)*Ss.EPSILON}function iV(i){return i.clone?i.clone():new Array(i.length)}function bx(i,t,e){if(Zc(i)){const n=i;e=e||iV(n);for(let r=0;r<e.length&&r<n.length;++r){const o=typeof i=="number"?i:i[r];e[r]=t(o,r,e)}return e}return t(i)}class xx extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(t=[],e=0){for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Zc(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ss)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+Q7(this[n],t);return`${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Aa(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(n===void 0)return this.lerp(this,t,e);for(let r=0;r<this.ELEMENTS;++r){const o=t[r],s=typeof e=="number"?e:e[r];this[r]=o+n*(s-o)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=e[n];return this.check()}subtract(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=e[n];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(Ss.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function nV(i,t){if(i.length!==t)return!1;for(let e=0;e<i.length;++e)if(!Number.isFinite(i[e]))return!1;return!0}function $n(i){if(!Number.isFinite(i))throw new Error(`Invalid number ${JSON.stringify(i)}`);return i}function UA(i,t,e=""){if(Ss.debug&&!nV(i,t))throw new Error(`math.gl: ${e} some fields set to invalid numbers'`);return i}function hl(i,t){if(!i)throw new Error(`math.gl assertion ${t}`)}class wx extends xx{get x(){return this[0]}set x(t){this[0]=$n(t)}get y(){return this[1]}set y(t){this[1]=$n(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-t[n];e+=r*r}return $n(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return $n(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=e[n];return this.check()}divide(...t){for(const e of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return hl(t>=0&&t<this.ELEMENTS,"index is out of range"),$n(this[t])}setComponent(t,e){return hl(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}const VA=1e-6;let _l=typeof Float32Array<"u"?Float32Array:Array;function rV(){const i=new _l(2);return _l!=Float32Array&&(i[0]=0,i[1]=0),i}function QC(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function sV(i,t){return i[0]=-t[0],i[1]=-t[1],i}function dR(i,t,e,n){const r=t[0],o=t[1];return i[0]=r+n*(e[0]-r),i[1]=o+n*(e[1]-o),i}function oV(i,t,e){const n=t[0],r=t[1];return i[0]=e[0]*n+e[2]*r,i[1]=e[1]*n+e[3]*r,i}function aV(i,t,e){const n=t[0],r=t[1];return i[0]=e[0]*n+e[2]*r+e[4],i[1]=e[1]*n+e[3]*r+e[5],i}function pR(i,t,e){const n=t[0],r=t[1];return i[0]=e[0]*n+e[3]*r+e[6],i[1]=e[1]*n+e[4]*r+e[7],i}function AR(i,t,e){const n=t[0],r=t[1];return i[0]=e[0]*n+e[4]*r+e[12],i[1]=e[1]*n+e[5]*r+e[13],i}(function(){const i=rV();return function(t,e,n,r,o,s){let l,c;for(e||(e=2),n||(n=0),r?c=Math.min(r*e+n,t.length):c=t.length,l=n;l<c;l+=e)i[0]=t[l],i[1]=t[l+1],o(i,i,s),t[l]=i[0],t[l+1]=i[1];return t}})();function mR(i,t,e){const n=t[0],r=t[1],o=e[3]*n+e[7]*r||1;return i[0]=(e[0]*n+e[4]*r)/o,i[1]=(e[1]*n+e[5]*r)/o,i}function gR(i,t,e){const n=t[0],r=t[1],o=t[2],s=e[3]*n+e[7]*r+e[11]*o||1;return i[0]=(e[0]*n+e[4]*r+e[8]*o)/s,i[1]=(e[1]*n+e[5]*r+e[9]*o)/s,i[2]=(e[2]*n+e[6]*r+e[10]*o)/s,i}function lV(i,t,e){const n=t[0],r=t[1];return i[0]=e[0]*n+e[2]*r,i[1]=e[1]*n+e[3]*r,i[2]=t[2],i}function uV(i,t,e){const n=t[0],r=t[1];return i[0]=e[0]*n+e[2]*r,i[1]=e[1]*n+e[3]*r,i[2]=t[2],i[3]=t[3],i}function yR(i,t,e){const n=t[0],r=t[1],o=t[2];return i[0]=e[0]*n+e[3]*r+e[6]*o,i[1]=e[1]*n+e[4]*r+e[7]*o,i[2]=e[2]*n+e[5]*r+e[8]*o,i[3]=t[3],i}class Ex extends wx{constructor(t=0,e=0){super(2),Zc(t)&&arguments.length===1?this.copy(t):(Ss.debug&&($n(t),$n(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return Ss.debug&&($n(t.x),$n(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return AR(this,this,t),this.check()}transformAsVector(t){return mR(this,this,t),this.check()}transformByMatrix3(t){return pR(this,this,t),this.check()}transformByMatrix2x3(t){return aV(this,this,t),this.check()}transformByMatrix2(t){return oV(this,this,t),this.check()}}function vR(){const i=new _l(3);return _l!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function _R(i){const t=i[0],e=i[1],n=i[2];return Math.sqrt(t*t+e*e+n*n)}function JC(i,t,e){const n=new _l(3);return n[0]=i,n[1]=t,n[2]=e,n}function cV(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function hV(i){const t=i[0],e=i[1],n=i[2];return t*t+e*e+n*n}function fV(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function dV(i,t){const e=t[0],n=t[1],r=t[2];let o=e*e+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i}function Cx(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function gg(i,t,e){const n=t[0],r=t[1],o=t[2],s=e[0],l=e[1],c=e[2];return i[0]=r*c-o*l,i[1]=o*s-n*c,i[2]=n*l-r*s,i}function pV(i,t,e,n){const r=t[0],o=t[1],s=t[2];return i[0]=r+n*(e[0]-r),i[1]=o+n*(e[1]-o),i[2]=s+n*(e[2]-s),i}function Tx(i,t,e){const n=t[0],r=t[1],o=t[2];let s=e[3]*n+e[7]*r+e[11]*o+e[15];return s=s||1,i[0]=(e[0]*n+e[4]*r+e[8]*o+e[12])/s,i[1]=(e[1]*n+e[5]*r+e[9]*o+e[13])/s,i[2]=(e[2]*n+e[6]*r+e[10]*o+e[14])/s,i}function bR(i,t,e){const n=t[0],r=t[1],o=t[2];return i[0]=n*e[0]+r*e[3]+o*e[6],i[1]=n*e[1]+r*e[4]+o*e[7],i[2]=n*e[2]+r*e[5]+o*e[8],i}function xR(i,t,e){const n=e[0],r=e[1],o=e[2],s=e[3],l=t[0],c=t[1],y=t[2];let _=r*y-o*c,C=o*l-n*y,I=n*c-r*l,k=r*I-o*C,z=o*_-n*I,V=n*C-r*_;const X=s*2;return _*=X,C*=X,I*=X,k*=2,z*=2,V*=2,i[0]=l+_+k,i[1]=c+C+z,i[2]=y+I+V,i}function AV(i,t,e,n){const r=[],o=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i}function mV(i,t,e,n){const r=[],o=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i}function gV(i,t,e,n){const r=[],o=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i}function yV(i,t){const e=i[0],n=i[1],r=i[2],o=t[0],s=t[1],l=t[2],c=Math.sqrt((e*e+n*n+r*r)*(o*o+s*s+l*l)),y=c&&Cx(i,t)/c;return Math.acos(Math.min(Math.max(y,-1),1))}const wR=cV,ER=_R,x_=hV;(function(){const i=vR();return function(t,e,n,r,o,s){let l,c;for(e||(e=3),n||(n=0),r?c=Math.min(r*e+n,t.length):c=t.length,l=n;l<c;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],o(i,i,s),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2];return t}})();const w_=[0,0,0];let g0;class ve extends wx{static get ZERO(){return g0||(g0=new ve(0,0,0),Object.freeze(g0)),g0}constructor(t=0,e=0,n=0){super(-0,-0,-0),arguments.length===1&&Zc(t)?this.copy(t):(Ss.debug&&($n(t),$n(e),$n(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Ss.debug&&($n(t.x),$n(t.y),$n(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=$n(t)}angle(t){return yV(this,t)}cross(t){return gg(this,this,t),this.check()}rotateX({radians:t,origin:e=w_}){return AV(this,this,e,t),this.check()}rotateY({radians:t,origin:e=w_}){return mV(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=w_}){return gV(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Tx(this,this,t),this.check()}transformAsVector(t){return gR(this,this,t),this.check()}transformByMatrix3(t){return bR(this,this,t),this.check()}transformByMatrix2(t){return lV(this,this,t),this.check()}transformByQuaternion(t){return xR(this,this,t),this.check()}}let y0;class Sx extends wx{static get ZERO(){return y0||(y0=new Sx(0,0,0,0),Object.freeze(y0)),y0}constructor(t=0,e=0,n=0,r=0){super(-0,-0,-0,-0),Zc(t)&&arguments.length===1?this.copy(t):(Ss.debug&&($n(t),$n(e),$n(n),$n(r)),this[0]=t,this[1]=e,this[2]=n,this[3]=r)}set(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Ss.debug&&($n(t.x),$n(t.y),$n(t.z),$n(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=$n(t)}get w(){return this[3]}set w(t){this[3]=$n(t)}transform(t){return Tx(this,this,t),this.check()}transformByMatrix3(t){return yR(this,this,t),this.check()}transformByMatrix2(t){return uV(this,this,t),this.check()}transformByQuaternion(t){return xR(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class CR extends xx{toString(){let t="[";if(Ss.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+e]}`}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=$n(n),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let r=0;r<this.RANK;++r)e[r]=this[n+r];return e}setColumn(t,e){const n=t*this.RANK;for(let r=0;r<this.RANK;++r)this[n+r]=e[r];return this}}function vV(){const i=new _l(9);return _l!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function _V(i,t){if(i===t){const e=t[1],n=t[2],r=t[5];i[1]=t[3],i[2]=t[6],i[3]=e,i[5]=t[7],i[6]=n,i[7]=r}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i}function bV(i,t){const e=t[0],n=t[1],r=t[2],o=t[3],s=t[4],l=t[5],c=t[6],y=t[7],_=t[8],C=_*s-l*y,I=-_*o+l*c,k=y*o-s*c;let z=e*C+n*I+r*k;return z?(z=1/z,i[0]=C*z,i[1]=(-_*n+r*y)*z,i[2]=(l*n-r*s)*z,i[3]=I*z,i[4]=(_*e-r*c)*z,i[5]=(-l*e+r*o)*z,i[6]=k*z,i[7]=(-y*e+n*c)*z,i[8]=(s*e-n*o)*z,i):null}function xV(i){const t=i[0],e=i[1],n=i[2],r=i[3],o=i[4],s=i[5],l=i[6],c=i[7],y=i[8];return t*(y*o-s*c)+e*(-y*r+s*l)+n*(c*r-o*l)}function $C(i,t,e){const n=t[0],r=t[1],o=t[2],s=t[3],l=t[4],c=t[5],y=t[6],_=t[7],C=t[8],I=e[0],k=e[1],z=e[2],V=e[3],X=e[4],H=e[5],$=e[6],Y=e[7],ct=e[8];return i[0]=I*n+k*s+z*y,i[1]=I*r+k*l+z*_,i[2]=I*o+k*c+z*C,i[3]=V*n+X*s+H*y,i[4]=V*r+X*l+H*_,i[5]=V*o+X*c+H*C,i[6]=$*n+Y*s+ct*y,i[7]=$*r+Y*l+ct*_,i[8]=$*o+Y*c+ct*C,i}function wV(i,t,e){const n=t[0],r=t[1],o=t[2],s=t[3],l=t[4],c=t[5],y=t[6],_=t[7],C=t[8],I=e[0],k=e[1];return i[0]=n,i[1]=r,i[2]=o,i[3]=s,i[4]=l,i[5]=c,i[6]=I*n+k*s+y,i[7]=I*r+k*l+_,i[8]=I*o+k*c+C,i}function EV(i,t,e){const n=t[0],r=t[1],o=t[2],s=t[3],l=t[4],c=t[5],y=t[6],_=t[7],C=t[8],I=Math.sin(e),k=Math.cos(e);return i[0]=k*n+I*s,i[1]=k*r+I*l,i[2]=k*o+I*c,i[3]=k*s-I*n,i[4]=k*l-I*r,i[5]=k*c-I*o,i[6]=y,i[7]=_,i[8]=C,i}function tT(i,t,e){const n=e[0],r=e[1];return i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i[3]=r*t[3],i[4]=r*t[4],i[5]=r*t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function CV(i,t){const e=t[0],n=t[1],r=t[2],o=t[3],s=e+e,l=n+n,c=r+r,y=e*s,_=n*s,C=n*l,I=r*s,k=r*l,z=r*c,V=o*s,X=o*l,H=o*c;return i[0]=1-C-z,i[3]=_-H,i[6]=I+X,i[1]=_+H,i[4]=1-y-z,i[7]=k-V,i[2]=I-X,i[5]=k+V,i[8]=1-y-C,i}var bb;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(bb||(bb={}));const TV=Object.freeze([1,0,0,0,1,0,0,0,1]);class ts extends CR{static get IDENTITY(){return PV()}static get ZERO(){return SV()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return bb}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(TV)}fromObject(t){return this.check()}fromQuaternion(t){return CV(this,t),this.check()}set(t,e,n,r,o,s,l,c,y){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=o,this[5]=s,this[6]=l,this[7]=c,this[8]=y,this.check()}setRowMajor(t,e,n,r,o,s,l,c,y){return this[0]=t,this[1]=r,this[2]=l,this[3]=e,this[4]=o,this[5]=c,this[6]=n,this[7]=s,this[8]=y,this.check()}determinant(){return xV(this)}transpose(){return _V(this,this),this.check()}invert(){return bV(this,this),this.check()}multiplyLeft(t){return $C(this,t,this),this.check()}multiplyRight(t){return $C(this,this,t),this.check()}rotate(t){return EV(this,this,t),this.check()}scale(t){return Array.isArray(t)?tT(this,this,t):tT(this,this,[t,t]),this.check()}translate(t){return wV(this,this,t),this.check()}transform(t,e){let n;switch(t.length){case 2:n=pR(e||[-0,-0],t,this);break;case 3:n=bR(e||[-0,-0,-0],t,this);break;case 4:n=yR(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return UA(n,t.length),n}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let v0,_0=null;function SV(){return v0||(v0=new ts([0,0,0,0,0,0,0,0,0]),Object.freeze(v0)),v0}function PV(){return _0||(_0=new ts,Object.freeze(_0)),_0}function IV(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function MV(i,t){if(i===t){const e=t[1],n=t[2],r=t[3],o=t[6],s=t[7],l=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=n,i[9]=o,i[11]=t[14],i[12]=r,i[13]=s,i[14]=l}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function xb(i,t){const e=t[0],n=t[1],r=t[2],o=t[3],s=t[4],l=t[5],c=t[6],y=t[7],_=t[8],C=t[9],I=t[10],k=t[11],z=t[12],V=t[13],X=t[14],H=t[15],$=e*l-n*s,Y=e*c-r*s,ct=e*y-o*s,rt=n*c-r*l,nt=n*y-o*l,Ot=r*y-o*c,Kt=_*V-C*z,ft=_*X-I*z,st=_*H-k*z,Ut=C*X-I*V,K=C*H-k*V,dt=I*H-k*X;let Tt=$*dt-Y*K+ct*Ut+rt*st-nt*ft+Ot*Kt;return Tt?(Tt=1/Tt,i[0]=(l*dt-c*K+y*Ut)*Tt,i[1]=(r*K-n*dt-o*Ut)*Tt,i[2]=(V*Ot-X*nt+H*rt)*Tt,i[3]=(I*nt-C*Ot-k*rt)*Tt,i[4]=(c*st-s*dt-y*ft)*Tt,i[5]=(e*dt-r*st+o*ft)*Tt,i[6]=(X*ct-z*Ot-H*Y)*Tt,i[7]=(_*Ot-I*ct+k*Y)*Tt,i[8]=(s*K-l*st+y*Kt)*Tt,i[9]=(n*st-e*K-o*Kt)*Tt,i[10]=(z*nt-V*ct+H*$)*Tt,i[11]=(C*ct-_*nt-k*$)*Tt,i[12]=(l*ft-s*Ut-c*Kt)*Tt,i[13]=(e*Ut-n*ft+r*Kt)*Tt,i[14]=(V*Y-z*rt-X*$)*Tt,i[15]=(_*rt-C*Y+I*$)*Tt,i):null}function BV(i){const t=i[0],e=i[1],n=i[2],r=i[3],o=i[4],s=i[5],l=i[6],c=i[7],y=i[8],_=i[9],C=i[10],I=i[11],k=i[12],z=i[13],V=i[14],X=i[15],H=t*s-e*o,$=t*l-n*o,Y=e*l-n*s,ct=y*z-_*k,rt=y*V-C*k,nt=_*V-C*z,Ot=t*nt-e*rt+n*ct,Kt=o*nt-s*rt+l*ct,ft=y*Y-_*$+C*H,st=k*Y-z*$+V*H;return c*Ot-r*Kt+X*ft-I*st}function Zh(i,t,e){const n=t[0],r=t[1],o=t[2],s=t[3],l=t[4],c=t[5],y=t[6],_=t[7],C=t[8],I=t[9],k=t[10],z=t[11],V=t[12],X=t[13],H=t[14],$=t[15];let Y=e[0],ct=e[1],rt=e[2],nt=e[3];return i[0]=Y*n+ct*l+rt*C+nt*V,i[1]=Y*r+ct*c+rt*I+nt*X,i[2]=Y*o+ct*y+rt*k+nt*H,i[3]=Y*s+ct*_+rt*z+nt*$,Y=e[4],ct=e[5],rt=e[6],nt=e[7],i[4]=Y*n+ct*l+rt*C+nt*V,i[5]=Y*r+ct*c+rt*I+nt*X,i[6]=Y*o+ct*y+rt*k+nt*H,i[7]=Y*s+ct*_+rt*z+nt*$,Y=e[8],ct=e[9],rt=e[10],nt=e[11],i[8]=Y*n+ct*l+rt*C+nt*V,i[9]=Y*r+ct*c+rt*I+nt*X,i[10]=Y*o+ct*y+rt*k+nt*H,i[11]=Y*s+ct*_+rt*z+nt*$,Y=e[12],ct=e[13],rt=e[14],nt=e[15],i[12]=Y*n+ct*l+rt*C+nt*V,i[13]=Y*r+ct*c+rt*I+nt*X,i[14]=Y*o+ct*y+rt*k+nt*H,i[15]=Y*s+ct*_+rt*z+nt*$,i}function Yg(i,t,e){const n=e[0],r=e[1],o=e[2];let s,l,c,y,_,C,I,k,z,V,X,H;return t===i?(i[12]=t[0]*n+t[4]*r+t[8]*o+t[12],i[13]=t[1]*n+t[5]*r+t[9]*o+t[13],i[14]=t[2]*n+t[6]*r+t[10]*o+t[14],i[15]=t[3]*n+t[7]*r+t[11]*o+t[15]):(s=t[0],l=t[1],c=t[2],y=t[3],_=t[4],C=t[5],I=t[6],k=t[7],z=t[8],V=t[9],X=t[10],H=t[11],i[0]=s,i[1]=l,i[2]=c,i[3]=y,i[4]=_,i[5]=C,i[6]=I,i[7]=k,i[8]=z,i[9]=V,i[10]=X,i[11]=H,i[12]=s*n+_*r+z*o+t[12],i[13]=l*n+C*r+V*o+t[13],i[14]=c*n+I*r+X*o+t[14],i[15]=y*n+k*r+H*o+t[15]),i}function Px(i,t,e){const n=e[0],r=e[1],o=e[2];return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=t[7]*r,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=t[11]*o,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function RV(i,t,e,n){let r=n[0],o=n[1],s=n[2],l=Math.sqrt(r*r+o*o+s*s),c,y,_,C,I,k,z,V,X,H,$,Y,ct,rt,nt,Ot,Kt,ft,st,Ut,K,dt,Tt,ue;return l<VA?null:(l=1/l,r*=l,o*=l,s*=l,y=Math.sin(e),c=Math.cos(e),_=1-c,C=t[0],I=t[1],k=t[2],z=t[3],V=t[4],X=t[5],H=t[6],$=t[7],Y=t[8],ct=t[9],rt=t[10],nt=t[11],Ot=r*r*_+c,Kt=o*r*_+s*y,ft=s*r*_-o*y,st=r*o*_-s*y,Ut=o*o*_+c,K=s*o*_+r*y,dt=r*s*_+o*y,Tt=o*s*_-r*y,ue=s*s*_+c,i[0]=C*Ot+V*Kt+Y*ft,i[1]=I*Ot+X*Kt+ct*ft,i[2]=k*Ot+H*Kt+rt*ft,i[3]=z*Ot+$*Kt+nt*ft,i[4]=C*st+V*Ut+Y*K,i[5]=I*st+X*Ut+ct*K,i[6]=k*st+H*Ut+rt*K,i[7]=z*st+$*Ut+nt*K,i[8]=C*dt+V*Tt+Y*ue,i[9]=I*dt+X*Tt+ct*ue,i[10]=k*dt+H*Tt+rt*ue,i[11]=z*dt+$*Tt+nt*ue,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function TR(i,t,e){const n=Math.sin(e),r=Math.cos(e),o=t[4],s=t[5],l=t[6],c=t[7],y=t[8],_=t[9],C=t[10],I=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=o*r+y*n,i[5]=s*r+_*n,i[6]=l*r+C*n,i[7]=c*r+I*n,i[8]=y*r-o*n,i[9]=_*r-s*n,i[10]=C*r-l*n,i[11]=I*r-c*n,i}function LV(i,t,e){const n=Math.sin(e),r=Math.cos(e),o=t[0],s=t[1],l=t[2],c=t[3],y=t[8],_=t[9],C=t[10],I=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=o*r-y*n,i[1]=s*r-_*n,i[2]=l*r-C*n,i[3]=c*r-I*n,i[8]=o*n+y*r,i[9]=s*n+_*r,i[10]=l*n+C*r,i[11]=c*n+I*r,i}function SR(i,t,e){const n=Math.sin(e),r=Math.cos(e),o=t[0],s=t[1],l=t[2],c=t[3],y=t[4],_=t[5],C=t[6],I=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=o*r+y*n,i[1]=s*r+_*n,i[2]=l*r+C*n,i[3]=c*r+I*n,i[4]=y*r-o*n,i[5]=_*r-s*n,i[6]=C*r-l*n,i[7]=I*r-c*n,i}function DV(i,t){const e=t[0],n=t[1],r=t[2],o=t[4],s=t[5],l=t[6],c=t[8],y=t[9],_=t[10];return i[0]=Math.sqrt(e*e+n*n+r*r),i[1]=Math.sqrt(o*o+s*s+l*l),i[2]=Math.sqrt(c*c+y*y+_*_),i}function kV(i,t){const e=t[0],n=t[1],r=t[2],o=t[3],s=e+e,l=n+n,c=r+r,y=e*s,_=n*s,C=n*l,I=r*s,k=r*l,z=r*c,V=o*s,X=o*l,H=o*c;return i[0]=1-C-z,i[1]=_+H,i[2]=I-X,i[3]=0,i[4]=_-H,i[5]=1-y-z,i[6]=k+V,i[7]=0,i[8]=I+X,i[9]=k-V,i[10]=1-y-C,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function OV(i,t,e,n,r,o,s){const l=1/(e-t),c=1/(r-n),y=1/(o-s);return i[0]=o*2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o*2*c,i[6]=0,i[7]=0,i[8]=(e+t)*l,i[9]=(r+n)*c,i[10]=(s+o)*y,i[11]=-1,i[12]=0,i[13]=0,i[14]=s*o*2*y,i[15]=0,i}function FV(i,t,e,n,r){const o=1/Math.tan(t/2);if(i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,r!=null&&r!==1/0){const s=1/(n-r);i[10]=(r+n)*s,i[14]=2*r*n*s}else i[10]=-1,i[14]=-2*n;return i}const NV=FV;function zV(i,t,e,n,r,o,s){const l=1/(t-e),c=1/(n-r),y=1/(o-s);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*y,i[11]=0,i[12]=(t+e)*l,i[13]=(r+n)*c,i[14]=(s+o)*y,i[15]=1,i}const UV=zV;function VV(i,t,e,n){let r,o,s,l,c,y,_,C,I,k;const z=t[0],V=t[1],X=t[2],H=n[0],$=n[1],Y=n[2],ct=e[0],rt=e[1],nt=e[2];return Math.abs(z-ct)<VA&&Math.abs(V-rt)<VA&&Math.abs(X-nt)<VA?IV(i):(C=z-ct,I=V-rt,k=X-nt,r=1/Math.sqrt(C*C+I*I+k*k),C*=r,I*=r,k*=r,o=$*k-Y*I,s=Y*C-H*k,l=H*I-$*C,r=Math.sqrt(o*o+s*s+l*l),r?(r=1/r,o*=r,s*=r,l*=r):(o=0,s=0,l=0),c=I*l-k*s,y=k*o-C*l,_=C*s-I*o,r=Math.sqrt(c*c+y*y+_*_),r?(r=1/r,c*=r,y*=r,_*=r):(c=0,y=0,_=0),i[0]=o,i[1]=c,i[2]=C,i[3]=0,i[4]=s,i[5]=y,i[6]=I,i[7]=0,i[8]=l,i[9]=_,i[10]=k,i[11]=0,i[12]=-(o*z+s*V+l*X),i[13]=-(c*z+y*V+_*X),i[14]=-(C*z+I*V+k*X),i[15]=1,i)}function GV(){const i=new _l(4);return _l!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function jV(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i}function Ix(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function WV(i){const t=i[0],e=i[1],n=i[2],r=i[3];return Math.sqrt(t*t+e*e+n*n+r*r)}function HV(i){const t=i[0],e=i[1],n=i[2],r=i[3];return t*t+e*e+n*n+r*r}function XV(i,t){const e=t[0],n=t[1],r=t[2],o=t[3];let s=e*e+n*n+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),i[0]=e*s,i[1]=n*s,i[2]=r*s,i[3]=o*s,i}function qV(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]}function KV(i,t,e,n){const r=t[0],o=t[1],s=t[2],l=t[3];return i[0]=r+n*(e[0]-r),i[1]=o+n*(e[1]-o),i[2]=s+n*(e[2]-s),i[3]=l+n*(e[3]-l),i}function Lp(i,t,e){const n=t[0],r=t[1],o=t[2],s=t[3];return i[0]=e[0]*n+e[4]*r+e[8]*o+e[12]*s,i[1]=e[1]*n+e[5]*r+e[9]*o+e[13]*s,i[2]=e[2]*n+e[6]*r+e[10]*o+e[14]*s,i[3]=e[3]*n+e[7]*r+e[11]*o+e[15]*s,i}function ZV(i,t,e){const n=t[0],r=t[1],o=t[2],s=e[0],l=e[1],c=e[2],y=e[3],_=y*n+l*o-c*r,C=y*r+c*n-s*o,I=y*o+s*r-l*n,k=-s*n-l*r-c*o;return i[0]=_*y+k*-s+C*-c-I*-l,i[1]=C*y+k*-l+I*-s-_*-c,i[2]=I*y+k*-c+_*-l-C*-s,i[3]=t[3],i}(function(){const i=GV();return function(t,e,n,r,o,s){let l,c;for(e||(e=4),n||(n=0),r?c=Math.min(r*e+n,t.length):c=t.length,l=n;l<c;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],i[3]=t[l+3],o(i,i,s),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2],t[l+3]=i[3];return t}})();var wb;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(wb||(wb={}));const YV=45*Math.PI/180,QV=1,E_=.1,C_=500,JV=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class bn extends CR{static get IDENTITY(){return tG()}static get ZERO(){return $V()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return wb}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,r,o,s,l,c,y,_,C,I,k,z,V,X){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=o,this[5]=s,this[6]=l,this[7]=c,this[8]=y,this[9]=_,this[10]=C,this[11]=I,this[12]=k,this[13]=z,this[14]=V,this[15]=X,this.check()}setRowMajor(t,e,n,r,o,s,l,c,y,_,C,I,k,z,V,X){return this[0]=t,this[1]=o,this[2]=y,this[3]=k,this[4]=e,this[5]=s,this[6]=_,this[7]=z,this[8]=n,this[9]=l,this[10]=C,this[11]=V,this[12]=r,this[13]=c,this[14]=I,this[15]=X,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(JV)}fromObject(t){return this.check()}fromQuaternion(t){return kV(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:r,top:o,near:s=E_,far:l=C_}=t;return l===1/0?eG(this,e,n,r,o,s):OV(this,e,n,r,o,s,l),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:r=[0,1,0]}=t;return VV(this,e,n,r),this.check()}ortho(t){const{left:e,right:n,bottom:r,top:o,near:s=E_,far:l=C_}=t;return UV(this,e,n,r,o,s,l),this.check()}orthographic(t){const{fovy:e=YV,aspect:n=QV,focalDistance:r=1,near:o=E_,far:s=C_}=t;eT(e);const l=e/2,c=r*Math.tan(l),y=c*n;return this.ortho({left:-y,right:y,bottom:-c,top:c,near:o,far:s})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:r=.1,far:o=500}=t;return eT(e),NV(this,e,n,r,o),this.check()}determinant(){return BV(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),r=1/n[0],o=1/n[1],s=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*o,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*o,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*o,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),r=1/n[0],o=1/n[1],s=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*o,t[2]=this[2]*s,t[3]=this[4]*r,t[4]=this[5]*o,t[5]=this[6]*s,t[6]=this[8]*r,t[7]=this[9]*o,t[8]=this[10]*s,t}transpose(){return MV(this,this),this.check()}invert(){return xb(this,this),this.check()}multiplyLeft(t){return Zh(this,t,this),this.check()}multiplyRight(t){return Zh(this,this,t),this.check()}rotateX(t){return TR(this,this,t),this.check()}rotateY(t){return LV(this,this,t),this.check()}rotateZ(t){return SR(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return RV(this,this,t,e),this.check()}scale(t){return Px(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Yg(this,this,t),this.check()}transform(t,e){return t.length===4?(e=Lp(e||[-0,-0,-0,-0],t,this),UA(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let r;switch(n){case 2:r=AR(e||[-0,-0],t,this);break;case 3:r=Tx(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return UA(r,t.length),r}transformAsVector(t,e){let n;switch(t.length){case 2:n=mR(e||[-0,-0],t,this);break;case 3:n=gR(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return UA(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let b0,x0;function $V(){return b0||(b0=new bn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(b0)),b0}function tG(){return x0||(x0=new bn,Object.freeze(x0)),x0}function eT(i){if(i>Math.PI*2)throw Error("expected radians")}function eG(i,t,e,n,r,o){const s=2*o/(e-t),l=2*o/(r-n),c=(e+t)/(e-t),y=(r+n)/(r-n),_=-1,C=-1,I=-2*o;return i[0]=s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=0,i[7]=0,i[8]=c,i[9]=y,i[10]=_,i[11]=C,i[12]=0,i[13]=0,i[14]=I,i[15]=0,i}function iT(){const i=new _l(4);return _l!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function iG(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function PR(i,t,e){e=e*.5;const n=Math.sin(e);return i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i[3]=Math.cos(e),i}function nT(i,t,e){const n=t[0],r=t[1],o=t[2],s=t[3],l=e[0],c=e[1],y=e[2],_=e[3];return i[0]=n*_+s*l+r*y-o*c,i[1]=r*_+s*c+o*l-n*y,i[2]=o*_+s*y+n*c-r*l,i[3]=s*_-n*l-r*c-o*y,i}function nG(i,t,e){e*=.5;const n=t[0],r=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return i[0]=n*c+s*l,i[1]=r*c+o*l,i[2]=o*c-r*l,i[3]=s*c-n*l,i}function rG(i,t,e){e*=.5;const n=t[0],r=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return i[0]=n*c-o*l,i[1]=r*c+s*l,i[2]=o*c+n*l,i[3]=s*c-r*l,i}function sG(i,t,e){e*=.5;const n=t[0],r=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return i[0]=n*c+r*l,i[1]=r*c-n*l,i[2]=o*c+s*l,i[3]=s*c-o*l,i}function oG(i,t){const e=t[0],n=t[1],r=t[2];return i[0]=e,i[1]=n,i[2]=r,i[3]=Math.sqrt(Math.abs(1-e*e-n*n-r*r)),i}function yg(i,t,e,n){const r=t[0],o=t[1],s=t[2],l=t[3];let c=e[0],y=e[1],_=e[2],C=e[3],I,k,z,V,X;return I=r*c+o*y+s*_+l*C,I<0&&(I=-I,c=-c,y=-y,_=-_,C=-C),1-I>VA?(k=Math.acos(I),X=Math.sin(k),z=Math.sin((1-n)*k)/X,V=Math.sin(n*k)/X):(z=1-n,V=n),i[0]=z*r+V*c,i[1]=z*o+V*y,i[2]=z*s+V*_,i[3]=z*l+V*C,i}function aG(i,t){const e=t[0],n=t[1],r=t[2],o=t[3],s=e*e+n*n+r*r+o*o,l=s?1/s:0;return i[0]=-e*l,i[1]=-n*l,i[2]=-r*l,i[3]=o*l,i}function lG(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function IR(i,t){const e=t[0]+t[4]+t[8];let n;if(e>0)n=Math.sqrt(e+1),i[3]=.5*n,n=.5/n,i[0]=(t[5]-t[7])*n,i[1]=(t[6]-t[2])*n,i[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);const o=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[r*3+r]-t[o*3+o]-t[s*3+s]+1),i[r]=.5*n,n=.5/n,i[3]=(t[o*3+s]-t[s*3+o])*n,i[o]=(t[o*3+r]+t[r*3+o])*n,i[s]=(t[s*3+r]+t[r*3+s])*n}return i}const uG=jV,cG=Ix,hG=qV,fG=KV,dG=WV,pG=HV,MR=XV,AG=(function(){const i=vR(),t=JC(1,0,0),e=JC(0,1,0);return function(n,r,o){const s=Cx(r,o);return s<-.999999?(gg(i,t,r),ER(i)<1e-6&&gg(i,e,r),dV(i,i),PR(n,i,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(gg(i,r,o),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1+s,MR(n,n))}})();(function(){const i=iT(),t=iT();return function(e,n,r,o,s,l){return yg(i,n,s,l),yg(t,r,o,l),yg(e,i,t,2*l*(1-l)),e}})();(function(){const i=vV();return function(t,e,n,r){return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=r[0],i[4]=r[1],i[7]=r[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],MR(t,IR(t,i))}})();const mG=[0,0,0,1];class em extends xx{constructor(t=0,e=0,n=0,r=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,n,r)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return IR(this,t),this.check()}fromAxisRotation(t,e){return PR(this,t,e),this.check()}identity(){return iG(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=$n(t)}get y(){return this[1]}set y(t){this[1]=$n(t)}get z(){return this[2]}set z(t){this[2]=$n(t)}get w(){return this[3]}set w(t){this[3]=$n(t)}len(){return dG(this)}lengthSquared(){return pG(this)}dot(t){return hG(this,t)}rotationTo(t,e){return AG(this,t,e),this.check()}add(t){return uG(this,this,t),this.check()}calculateW(){return oG(this,this),this.check()}conjugate(){return lG(this,this),this.check()}invert(){return aG(this,this),this.check()}lerp(t,e,n){return n===void 0?this.lerp(this,t,e):(fG(this,t,e,n),this.check())}multiplyRight(t){return nT(this,this,t),this.check()}multiplyLeft(t){return nT(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return nG(this,this,t),this.check()}rotateY(t){return rG(this,this,t),this.check()}rotateZ(t){return sG(this,this,t),this.check()}scale(t){return cG(this,this,t),this.check()}slerp(t,e,n){let r,o,s;switch(arguments.length){case 1:({start:r=mG,target:o,ratio:s}=t);break;case 2:r=this,o=t,s=e;break;default:r=t,o=e,s=n}return yg(this,r,o,s),this.check()}transformVector4(t,e=new Sx){return ZV(e,t,this),UA(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const gG=.1,yG=1e-12,BR=1e-15,vG=1e-20;function RR(i,t=[],e=0){const n=Math.fround(i),r=i-n;return t[e]=n,t[e+1]=r,t}function _G(i){return i-Math.fround(i)}function bG(i){const t=new Float32Array(32);for(let e=0;e<4;++e)for(let n=0;n<4;++n){const r=e*4+n;RR(i[n*4+e],t,r*2)}return t}const xG=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,wG={name:"fp32",vs:xG},EG=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,CG={ONE:1},TG={name:"fp64arithmetic",vs:EG,defaultUniforms:CG,uniformTypes:{ONE:"f32"},fp64ify:RR,fp64LowPart:_G,fp64ifyMatrix4:bG},SG=[0,1,1,1],PG=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,IG=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,rT={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:SG},vs:PG,fs:IG,getUniforms:MG};function MG(i={},t){const e={};if(i.highlightedObjectColor!==void 0)if(i.highlightedObjectColor===null)e.isHighlightActive=!1;else{e.isHighlightActive=!0;const n=i.highlightedObjectColor.slice(0,3);e.highlightedObjectColor=n}if(i.highlightColor){const n=Array.from(i.highlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),e.highlightColor=n}return i.isActive!==void 0&&(e.isActive=!!i.isActive,e.isAttribute=!!i.isAttribute),i.useFloatColors!==void 0&&(e.useFloatColors=!!i.useFloatColors),e}const sT=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,BG=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,RG=5,LG=255;var im;(function(i){i[i.POINT=0]="POINT",i[i.DIRECTIONAL=1]="DIRECTIONAL"})(im||(im={}));const rp={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:im.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:BG,vs:sT,fs:sT,getUniforms:DG};function DG(i,t={}){if(i=i&&{...i},!i)return{...rp.defaultUniforms};i.lights&&(i={...i,...OG(i.lights),lights:void 0});const{ambientLight:e,pointLights:n,directionalLights:r}=i||{};if(!(e||n&&n.length>0||r&&r.length>0))return{...rp.defaultUniforms,enabled:0};const o={...rp.defaultUniforms,...t,...kG({ambientLight:e,pointLights:n,directionalLights:r})};return i.enabled!==void 0&&(o.enabled=i.enabled?1:0),o}function kG({ambientLight:i,pointLights:t=[],directionalLights:e=[]}){const n={};n.ambientColor=T_(i);let r=0;for(const o of t){n.lightType=im.POINT;const s=r;n[`lightColor${s}`]=T_(o),n[`lightPosition${s}`]=o.position,n[`lightAttenuation${s}`]=o.attenuation||[1,0,0],r++}for(const o of e){n.lightType=im.DIRECTIONAL;const s=r;n[`lightColor${s}`]=T_(o),n[`lightDirection${s}`]=o.direction,r++}return r>RG&&Xe.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=e.length,n.pointLightCount=t.length,n}function OG(i){const t={pointLights:[],directionalLights:[]};for(const e of i||[])switch(e.type){case"ambient":t.ambientLight=e;break;case"directional":t.directionalLights?.push(e);break;case"point":t.pointLights?.push(e);break}return t}function T_(i={}){const{color:t=[0,0,0],intensity:e=1}=i;return t.map(n=>n*e/LG)}const LR=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,DR=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,kR=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,By={props:{},name:"gouraudMaterial",vs:DR.replace("phongMaterial","gouraudMaterial"),fs:LR.replace("phongMaterial","gouraudMaterial"),source:kR.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[rp],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(i){const t={...i};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...By.defaultUniforms,...t}}},Mx={name:"phongMaterial",dependencies:[rp],source:kR,vs:LR,fs:DR,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(i){const t={...i};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...Mx.defaultUniforms,...t}}},FG=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,NG=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,zG=`struct PBRFragmentInputs {
  pbr_vPosition: vec3f,
  pbr_vUV: vec2f,
  pbr_vTBN: mat3f,
  pbr_vNormal: vec3f
};

var fragmentInputs: PBRFragmentInputs;

fn pbr_setPositionNormalTangentUV(position: vec4f, normal: vec4f, tangent: vec4f, uv: vec2f)
{
  var pos: vec4f = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  let normalW: vec3f = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  let tangentW: vec3f = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  let bitangentW: vec3f = cross(normalW, tangentW) * tangent.w;
  fragmentInputs,pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  fragmentInputs.pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}

struct pbrMaterialUniforms {
  // Material is unlit
  unlit: uint32,

  // Base color map
  baseColorMapEnabled: uint32,
  baseColorFactor: vec4f,

  normalMapEnabled : uint32,
  normalScale: f32,  // #ifdef HAS_NORMALMAP

  emissiveMapEnabled: uint32,
  emissiveFactor: vec3f, // #ifdef HAS_EMISSIVEMAP

  metallicRoughnessValues: vec2f,
  metallicRoughnessMapEnabled: uint32,

  occlusionMapEnabled: i32,
  occlusionStrength: f32, // #ifdef HAS_OCCLUSIONMAP
  
  alphaCutoffEnabled: i32,
  alphaCutoff: f32, // #ifdef ALPHA_CUTOFF
  
  // IBL
  IBLenabled: i32,
  scaleIBLAmbient: vec2f, // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  scaleDiffBaseMR: vec4f,
  scaleFGDSpec: vec4f
  // #endif
} 
  
@binding(2) @group(0) var<uniform> material : pbrMaterialUniforms;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  NdotL: f32,                  // cos angle between normal and light direction
  NdotV: f32,                  // cos angle between normal and view direction
  NdotH: f32,                  // cos angle between normal and half vector
  LdotH: f32,                  // cos angle between light direction and half vector
  VdotH: f32,                  // cos angle between view direction and half vector
  perceptualRoughness: f32,    // roughness value, as authored by the model creator (input to shader)
  metalness: f32,              // metallic value at the surface
  reflectance0: vec3f,            // full reflectance color (normal incidence angle)
  reflectance90: vec3f,           // reflectance color at grazing angle
  alphaRoughness: f32,         // roughness mapped to a more linear change in the roughness (proposed by [2])
  diffuseColor: vec3f,            // color contribution from diffuse lighting
  specularColor: vec3f,           // color contribution from specular lighting
  n: vec3f,                       // normal at surface point
  v: vec3f,                       // vector from surface point to camera
};

const M_PI = 3.141592653589793;
const c_MinRoughness = 0.04;

fn SRGBtoLINEAR(srgbIn: vec4f ) -> vec4f
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  var linOut: vec3f = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  var bLess: vec3f = step(vec3(0.04045),srgbIn.xyz);
  var linOut: vec3f = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4f(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
fn getNormal() -> vec3f
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  var pos_dx: vec3f = dFdx(pbr_vPosition);
  var pos_dy: vec3f = dFdy(pbr_vPosition);
  var tex_dx: vec3f = dFdx(vec3(pbr_vUV, 0.0));
  var tex_dy: vec3f = dFdy(vec3(pbr_vUV, 0.0));
  var t: vec3f = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  var ng: vec3f = normalize(pbr_vNormal);
#else
  var ng: vec3f = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  var b: vec3f = normalize(cross(ng, t));
  var tbn: mat3f = mat3f(t, b, ng);
#else // HAS_TANGENTS
  var tbn: mat3f = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
fn getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection) -> vec3f
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
fn diffuse(pbrInfo: PBRInfo) -> vec3<f32> {
  return pbrInfo.diffuseColor / PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
fn specularReflection(pbrInfo: PBRInfo) -> vec3<f32> {
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
fn geometricOcclusion(pbrInfo: PBRInfo) -> f32 {
  let NdotL: f32 = pbrInfo.NdotL;
  let NdotV: f32 = pbrInfo.NdotV;
  let r: f32 = pbrInfo.alphaRoughness;

  let attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  let attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
fn microfacetDistribution(pbrInfo: PBRInfo) -> f32 {
  let roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  let f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (PI * f * f);
}

fn PBRInfo_setAmbientLight(pbrInfo: ptr<function, PBRInfo>) {
  (*pbrInfo).NdotL = 1.0;
  (*pbrInfo).NdotH = 0.0;
  (*pbrInfo).LdotH = 0.0;
  (*pbrInfo).VdotH = 1.0;
}

fn PBRInfo_setDirectionalLight(pbrInfo: ptr<function, PBRInfo>, lightDirection: vec3<f32>) {
  let n = (*pbrInfo).n;
  let v = (*pbrInfo).v;
  let l = normalize(lightDirection);             // Vector from surface point to light
  let h = normalize(l + v);                      // Half vector between both l and v

  (*pbrInfo).NdotL = clamp(dot(n, l), 0.001, 1.0);
  (*pbrInfo).NdotH = clamp(dot(n, h), 0.0, 1.0);
  (*pbrInfo).LdotH = clamp(dot(l, h), 0.0, 1.0);
  (*pbrInfo).VdotH = clamp(dot(v, h), 0.0, 1.0);
}

fn PBRInfo_setPointLight(pbrInfo: ptr<function, PBRInfo>, pointLight: PointLight) {
  let light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

fn calculateFinalColor(pbrInfo: PBRInfo, lightColor: vec3<f32>) -> vec3<f32> {
  // Calculate the shading terms for the microfacet specular shading model
  let F = specularReflection(pbrInfo);
  let G = geometricOcclusion(pbrInfo);
  let D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  let diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  let specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

fn pbr_filterColor(colorUnused: vec4<f32>) -> vec4<f32> {
  // The albedo may be defined from a base texture or a flat color
  var baseColor: vec4<f32>;
  #ifdef HAS_BASECOLORMAP
  baseColor = SRGBtoLINEAR(textureSample(pbr_baseColorSampler, pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
  #else
  baseColor = pbrMaterial.baseColorFactor;
  #endif

  #ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
  #endif

  var color = vec3<f32>(0.0, 0.0, 0.0);

  if (pbrMaterial.unlit) {
    color = baseColor.rgb;
  } else {
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    var perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    var metallic = pbrMaterial.metallicRoughnessValues.x;
    #ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    let mrSample = textureSample(pbr_metallicRoughnessSampler, pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
    #endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    let alphaRoughness = perceptualRoughness * perceptualRoughness;

    let f0 = vec3<f32>(0.04);
    var diffuseColor = baseColor.rgb * (vec3<f32>(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    let specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    let reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflectance to 0%.
    let reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    let specularEnvironmentR0 = specularColor;
    let specularEnvironmentR90 = vec3<f32>(1.0, 1.0, 1.0) * reflectance90;

    let n = getNormal();                          // normal at surface point
    let v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    let NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    let reflection = -normalize(reflect(v, n));

    var pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

    #ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(&pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for (var i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(&pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for (var i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(&pbrInfo, lighting_getPointLight(i));
        let attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
    #endif

    // Calculate lighting contribution from image based lighting source (IBL)
    #ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
    #endif

    // Apply optional PBR terms for additional (optional) shading
    #ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      let ao = textureSample(pbr_occlusionSampler, pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
    #endif

    #ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      let emissive = SRGBtoLINEAR(textureSample(pbr_emissiveSampler, pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
    #endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
    #ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3<f32>(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3<f32>(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
    #endif
  }

  return vec4<f32>(pow(color, vec3<f32>(1.0 / 2.2)), baseColor.a);
}
`,oT=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,UG={name:"pbrProjection",vs:oT,fs:oT,getUniforms:i=>i,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},Bx={props:{},uniforms:{},name:"pbrMaterial",dependencies:[rp,UG],source:zG,vs:FG,fs:NG,defines:{LIGHTING_FRAGMENT:!0,HAS_NORMALMAP:!1,HAS_EMISSIVEMAP:!1,HAS_OCCLUSIONMAP:!1,HAS_BASECOLORMAP:!1,HAS_METALROUGHNESSMAP:!1,ALPHA_CUTOFF:!1,USE_IBL:!1,PBR_DEBUG:!1},getUniforms:i=>i,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},aT=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,VG={name:"layer",vs:aT,fs:aT,getUniforms:i=>({opacity:Math.pow(i.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},GG=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,Rx={name:"color",dependencies:[],source:GG,getUniforms:i=>({}),uniformTypes:{opacity:"f32"}},jG=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,OR="#define SMOOTH_EDGE_RADIUS 0.5",WG=`${OR}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,HG=`${OR}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,FR={name:"geometry",source:jG,vs:WG,fs:HG},XG=25;var As;(function(i){i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel"})(As||(As={}));var Ts;(function(i){i[i.None=0]="None",i[i.Left=1]="Left",i[i.Right=2]="Right",i[i.Up=4]="Up",i[i.Down=8]="Down",i[i.Horizontal=3]="Horizontal",i[i.Vertical=12]="Vertical",i[i.All=15]="All"})(Ts||(Ts={}));var wn;(function(i){i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Recognized=8]="Recognized",i[i.Cancelled=16]="Cancelled",i[i.Failed=32]="Failed"})(wn||(wn={}));const qG="compute",KG="auto",Eb="manipulation",vg="none",Cb="pan-x",Tb="pan-y";function ZG(i){if(i.includes(vg))return vg;const t=i.includes(Cb),e=i.includes(Tb);return t&&e?vg:t||e?t?Cb:Tb:i.includes(Eb)?Eb:KG}class YG{constructor(t,e){this.actions="",this.manager=t,this.set(e)}set(t){t===qG&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(const e of this.manager.recognizers)e.options.enable&&(t=t.concat(e.getTouchAction()));return ZG(t.join(" "))}}function Qg(i){return i.trim().split(/\s+/g)}function S_(i,t,e){if(i)for(const n of Qg(t))i.addEventListener(n,e,!1)}function P_(i,t,e){if(i)for(const n of Qg(t))i.removeEventListener(n,e,!1)}function lT(i){return(i.ownerDocument||i).defaultView}function QG(i,t){let e=i;for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function NR(i){const t=i.length;if(t===1)return{x:Math.round(i[0].clientX),y:Math.round(i[0].clientY)};let e=0,n=0,r=0;for(;r<t;)e+=i[r].clientX,n+=i[r].clientY,r++;return{x:Math.round(e/t),y:Math.round(n/t)}}function uT(i){const t=[];let e=0;for(;e<i.pointers.length;)t[e]={clientX:Math.round(i.pointers[e].clientX),clientY:Math.round(i.pointers[e].clientY)},e++;return{timeStamp:Date.now(),pointers:t,center:NR(t),deltaX:i.deltaX,deltaY:i.deltaY}}function zR(i,t){const e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)}function cT(i,t){const e=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(e*e+n*n)}function JG(i,t){const e=t.x-i.x,n=t.y-i.y;return Math.atan2(n,e)*180/Math.PI}function hT(i,t){const e=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.atan2(n,e)*180/Math.PI}function UR(i,t){return i===t?Ts.None:Math.abs(i)>=Math.abs(t)?i<0?Ts.Left:Ts.Right:t<0?Ts.Up:Ts.Down}function $G(i,t){const e=t.center;let n=i.offsetDelta,r=i.prevDelta;const o=i.prevInput;return(t.eventType===As.Start||o?.eventType===As.End)&&(r=i.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},n=i.offsetDelta={x:e.x,y:e.y}),{deltaX:r.x+(e.x-n.x),deltaY:r.y+(e.y-n.y)}}function VR(i,t,e){return{x:t/i||0,y:e/i||0}}function tj(i,t){return cT(t[0],t[1])/cT(i[0],i[1])}function ej(i,t){return hT(t[1],t[0])-hT(i[1],i[0])}function ij(i,t){const e=i.lastInterval||t,n=t.timeStamp-e.timeStamp;let r,o,s,l;if(t.eventType!==As.Cancel&&(n>XG||e.velocity===void 0)){const c=t.deltaX-e.deltaX,y=t.deltaY-e.deltaY,_=VR(n,c,y);o=_.x,s=_.y,r=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,l=UR(c,y),i.lastInterval=t}else r=e.velocity,o=e.velocityX,s=e.velocityY,l=e.direction;t.velocity=r,t.velocityX=o,t.velocityY=s,t.direction=l}function nj(i,t){const{session:e}=i,{pointers:n}=t,{length:r}=n;e.firstInput||(e.firstInput=uT(t)),r>1&&!e.firstMultiple?e.firstMultiple=uT(t):r===1&&(e.firstMultiple=!1);const{firstInput:o,firstMultiple:s}=e,l=s?s.center:o.center,c=t.center=NR(n);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=JG(l,c),t.distance=zR(l,c);const{deltaX:y,deltaY:_}=$G(e,t);t.deltaX=y,t.deltaY=_,t.offsetDirection=UR(t.deltaX,t.deltaY);const C=VR(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=C.x,t.overallVelocityY=C.y,t.overallVelocity=Math.abs(C.x)>Math.abs(C.y)?C.x:C.y,t.scale=s?tj(s.pointers,n):1,t.rotation=s?ej(s.pointers,n):0,t.maxPointers=e.prevInput?t.pointers.length>e.prevInput.maxPointers?t.pointers.length:e.prevInput.maxPointers:t.pointers.length;let I=i.element;return QG(t.srcEvent.target,I)&&(I=t.srcEvent.target),t.target=I,ij(e,t),t}function rj(i,t,e){const n=e.pointers.length,r=e.changedPointers.length,o=t&As.Start&&n-r===0,s=t&(As.End|As.Cancel)&&n-r===0;e.isFirst=!!o,e.isFinal=!!s,o&&(i.session={}),e.eventType=t;const l=nj(i,e);i.emit("hammer.input",l),i.recognize(l),i.session.prevInput=l}let sj=class{constructor(i){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=i,this.element=i.element,this.target=i.options.inputTarget||i.element}callback(i,t){rj(this.manager,i,t)}init(){S_(this.element,this.evEl,this.domHandler),S_(this.target,this.evTarget,this.domHandler),S_(lT(this.element),this.evWin,this.domHandler)}destroy(){P_(this.element,this.evEl,this.domHandler),P_(this.target,this.evTarget,this.domHandler),P_(lT(this.element),this.evWin,this.domHandler)}};const oj={pointerdown:As.Start,pointermove:As.Move,pointerup:As.End,pointercancel:As.Cancel,pointerout:As.Cancel},aj="pointerdown",lj="pointermove pointerup pointercancel";class uj extends sj{constructor(t){super(t),this.evEl=aj,this.evWin=lj,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){const{store:e}=this;let n=!1;const r=oj[t.type],o=t.pointerType,s=o==="touch";let l=e.findIndex(c=>c.pointerId===t.pointerId);r&As.Start&&(t.buttons||s)?l<0&&(e.push(t),l=e.length-1):r&(As.End|As.Cancel)&&(n=!0),!(l<0)&&(e[l]=t,this.callback(r,{pointers:e,changedPointers:[t],eventType:r,pointerType:o,srcEvent:t}),n&&e.splice(l,1))}}const cj=["","webkit","Moz","MS","ms","o"];function hj(i,t){const e=t[0].toUpperCase()+t.slice(1);for(const n of cj){const r=n?n+e:t;if(r in i)return r}}const fj=1,fT=2,dT={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};let dj=class{constructor(i,t){this.options={...dT,...t,cssProps:{...dT.cssProps,...t.cssProps},inputTarget:t.inputTarget||i},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=i,this.input=new uj(this),this.touchAction=new YG(this,this.options.touchAction),this.toggleCssProps(!0)}set(i){return Object.assign(this.options,i),i.touchAction&&this.touchAction.update(),i.inputTarget&&(this.input.destroy(),this.input.target=i.inputTarget,this.input.init()),this}stop(i){this.session.stopped=i?fT:fj}recognize(i){const{session:t}=this;if(t.stopped)return;this.session.prevented&&i.srcEvent.preventDefault();let e;const{recognizers:n}=this;let{curRecognizer:r}=t;(!r||r&&r.state&wn.Recognized)&&(r=t.curRecognizer=null);let o=0;for(;o<n.length;)e=n[o],t.stopped!==fT&&(!r||e===r||e.canRecognizeWith(r))?e.recognize(i):e.reset(),!r&&e.state&(wn.Began|wn.Changed|wn.Ended)&&(r=t.curRecognizer=e),o++}get(i){const{recognizers:t}=this;for(let e=0;e<t.length;e++)if(t[e].options.event===i)return t[e];return null}add(i){if(Array.isArray(i)){for(const e of i)this.add(e);return this}const t=this.get(i.options.event);return t&&this.remove(t),this.recognizers.push(i),i.manager=this,this.touchAction.update(),i}remove(i){if(Array.isArray(i)){for(const e of i)this.remove(e);return this}const t=typeof i=="string"?this.get(i):i;if(t){const{recognizers:e}=this,n=e.indexOf(t);n!==-1&&(e.splice(n,1),this.touchAction.update())}return this}on(i,t){if(!i||!t)return;const{handlers:e}=this;for(const n of Qg(i))e[n]=e[n]||[],e[n].push(t)}off(i,t){if(!i)return;const{handlers:e}=this;for(const n of Qg(i))t?e[n]&&e[n].splice(e[n].indexOf(t),1):delete e[n]}emit(i,t){const e=this.handlers[i]&&this.handlers[i].slice();if(!e||!e.length)return;const n=t;n.type=i,n.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<e.length;)e[r](n),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(i){const{element:t}=this;if(t){for(const[e,n]of Object.entries(this.options.cssProps)){const r=hj(t.style,e);i?(this.oldCssProps[r]=t.style[r],t.style[r]=n):t.style[r]=this.oldCssProps[r]||""}i||(this.oldCssProps={})}}},pj=1;function Aj(){return pj++}function pT(i){return i&wn.Cancelled?"cancel":i&wn.Ended?"end":i&wn.Changed?"move":i&wn.Began?"start":""}class GR{constructor(t){this.options=t,this.id=Aj(),this.state=wn.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(const r of t)this.recognizeWith(r);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{simultaneous:n}=this;return n[e.id]||(n[e.id]=e,e.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(const n of t)this.dropRecognizeWith(n);return this}let e;return typeof t=="string"?e=this.manager.get(t):e=t,e&&delete this.simultaneous[e.id],this}requireFailure(t){if(Array.isArray(t)){for(const r of t)this.requireFailure(r);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{requireFail:n}=this;return n.indexOf(e)===-1&&(n.push(e),e.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(const n of t)this.dropRequireFailure(n);return this}let e;if(typeof t=="string"?e=this.manager.get(t):e=t,e){const n=this.requireFail.indexOf(e);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;const{state:e}=this;e<wn.Ended&&this.manager.emit(this.options.event+pT(e),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),e>=wn.Ended&&this.manager.emit(this.options.event+pT(e),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=wn.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(wn.Failed|wn.Possible)))return!1;t++}return!0}recognize(t){const e={...t};if(!this.options.enable){this.reset(),this.state=wn.Failed;return}this.state&(wn.Recognized|wn.Cancelled|wn.Failed)&&(this.state=wn.Possible),this.state=this.process(e),this.state&(wn.Began|wn.Changed|wn.Ended|wn.Cancelled)&&this.tryEmit(e)}getEventNames(){return[this.options.event]}reset(){}}class jR extends GR{attrTest(t){const e=this.options.pointers;return e===0||t.pointers.length===e}process(t){const{state:e}=this,{eventType:n}=t,r=e&(wn.Began|wn.Changed),o=this.attrTest(t);return r&&(n&As.Cancel||!o)?e|wn.Cancelled:r||o?n&As.End?e|wn.Ended:e&wn.Began?e|wn.Changed:wn.Began:wn.Failed}}class AT extends GR{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Eb]}process(t){const{options:e}=this,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,o=t.deltaTime<e.time;if(this.reset(),t.eventType&As.Start&&this.count===0)return this.failTimeout();if(r&&o&&n){if(t.eventType!==As.End)return this.failTimeout();const s=this.pTime?t.timeStamp-this.pTime<e.interval:!0,l=!this.pCenter||zR(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!l||!s?this.count=1:this.count+=1,this._input=t,this.count%e.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=wn.Recognized,this.tryEmit(this._input)},e.interval),wn.Began):wn.Recognized}return wn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=wn.Failed},this.options.interval),wn.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===wn.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}}const mj=["","start","move","end","cancel","up","down","left","right"];class mT extends jR{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Ts.All,...t}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:t}}=this,e=[];return t&Ts.Horizontal&&e.push(Tb),t&Ts.Vertical&&e.push(Cb),e}getEventNames(){return mj.map(t=>this.options.event+t)}directionTest(t){const{options:e}=this;let n=!0,{distance:r}=t,{direction:o}=t;const s=t.deltaX,l=t.deltaY;return o&e.direction||(e.direction&Ts.Horizontal?(o=s===0?Ts.None:s<0?Ts.Left:Ts.Right,n=s!==this.pX,r=Math.abs(t.deltaX)):(o=l===0?Ts.None:l<0?Ts.Up:Ts.Down,n=l!==this.pY,r=Math.abs(t.deltaY))),t.direction=o,n&&r>e.threshold&&!!(o&e.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&wn.Began)||!(this.state&wn.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;const e=Ts[t.direction].toLowerCase();e&&(t.additionalEvent=this.options.event+e),super.emit(t)}}const gj=["","start","move","end","cancel","in","out"];class yj extends jR{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[vg]}getEventNames(){return gj.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&wn.Began))}emit(t){if(t.scale!==1){const e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}super.emit(t)}}let Ry=class{constructor(i,t,e){this.element=i,this.callback=t,this.options=e}};const vj=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",_j=vj.indexOf("firefox")!==-1,gT=4.000244140625,bj=40,xj=.25;let wj=class extends Ry{constructor(i,t,e){super(i,t,{enable:!0,...e}),this.handleEvent=n=>{if(!this.options.enable)return;let r=n.deltaY;globalThis.WheelEvent&&(_j&&n.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(r/=globalThis.devicePixelRatio),n.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(r*=bj)),r!==0&&r%gT===0&&(r=Math.floor(r/gT)),n.shiftKey&&r&&(r=r*xj),this.callback({type:"wheel",center:{x:n.clientX,y:n.clientY},delta:-r,srcEvent:n,pointerType:"mouse",target:n.target})},i.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(i,t){i==="wheel"&&(this.options.enable=t)}};const yT=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];let Ej=class extends Ry{constructor(i,t,e){super(i,t,{enable:!0,...e}),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,yT.forEach(r=>i.addEventListener(r,this.handleEvent))}destroy(){yT.forEach(i=>this.element.removeEventListener(i,this.handleEvent))}enableEventType(i,t){switch(i){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(i){this.enableOverEvent&&i.type==="mouseover"&&this._emit("pointerover",i)}handleOutEvent(i){this.enableOutEvent&&i.type==="mouseout"&&this._emit("pointerout",i)}handleEnterEvent(i){this.enableEnterEvent&&i.type==="mouseenter"&&this._emit("pointerenter",i)}handleLeaveEvent(i){this.enableLeaveEvent&&i.type==="mouseleave"&&this._emit("pointerleave",i)}handleMoveEvent(i){if(this.enableMoveEvent)switch(i.type){case"mousedown":i.button>=0&&(this.pressed=!0);break;case"mousemove":i.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",i);break;case"mouseup":this.pressed=!1;break}}_emit(i,t){this.callback({type:i,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}};const vT=["keydown","keyup"];let Cj=class extends Ry{constructor(i,t,e){super(i,t,{enable:!0,tabIndex:0,...e}),this.handleEvent=n=>{const r=n.target||n.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:"keydown",srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:"keyup",srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,i.tabIndex=this.options.tabIndex,i.style.outline="none",vT.forEach(n=>i.addEventListener(n,this.handleEvent))}destroy(){vT.forEach(i=>this.element.removeEventListener(i,this.handleEvent))}enableEventType(i,t){i==="keydown"&&(this.enableDownEvent=t),i==="keyup"&&(this.enableUpEvent=t)}},Tj=class extends Ry{constructor(i,t,e){super(i,t,e),this.handleEvent=n=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},i.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(i,t){i==="contextmenu"&&(this.options.enable=t)}};const _T=1,Sb=2,bT=4,Sj={pointerdown:_T,pointermove:Sb,pointerup:bT,mousedown:_T,mousemove:Sb,mouseup:bT},Pj=0,Ij=1,Mj=2,Bj=1,Rj=2,Lj=4;function Dj(i){const t=Sj[i.srcEvent.type];if(!t)return null;const{buttons:e,button:n}=i.srcEvent;let r=!1,o=!1,s=!1;return t===Sb?(r=!!(e&Bj),o=!!(e&Lj),s=!!(e&Rj)):(r=n===Pj,o=n===Ij,s=n===Mj),{leftButton:r,middleButton:o,rightButton:s}}function kj(i,t){const e=i.center;if(!e)return null;const n=t.getBoundingClientRect(),r=n.width/t.offsetWidth||1,o=n.height/t.offsetHeight||1,s={x:(e.x-n.left-t.clientLeft)/r,y:(e.y-n.top-t.clientTop)/o};return{center:e,offsetCenter:s}}const Oj={srcElement:"root",priority:0};let Fj=class{constructor(i,t){this.handleEvent=e=>{if(this.isEmpty())return;const n=this._normalizeEvent(e);let r=e.srcEvent.target;for(;r&&r!==n.rootElement;){if(this._emit(n,r),n.handled)return;r=r.parentNode}this._emit(n,"root")},this.eventManager=i,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(i,t,e,n=!1,r=!1){const{handlers:o,handlersByElement:s}=this,l={...Oj,...e};let c=s.get(l.srcElement);c||(c=[],s.set(l.srcElement,c));const y={type:i,handler:t,srcElement:l.srcElement,priority:l.priority};n&&(y.once=!0),r&&(y.passive=!0),o.push(y),this._active=this._active||!y.passive;let _=c.length-1;for(;_>=0&&!(c[_].priority>=y.priority);)_--;c.splice(_+1,0,y)}remove(i,t){const{handlers:e,handlersByElement:n}=this;for(let r=e.length-1;r>=0;r--){const o=e[r];if(o.type===i&&o.handler===t){e.splice(r,1);const s=n.get(o.srcElement);s.splice(s.indexOf(o),1),s.length===0&&n.delete(o.srcElement)}}this._active=e.some(r=>!r.passive)}_emit(i,t){const e=this.handlersByElement.get(t);if(e){let n=!1;const r=()=>{i.handled=!0},o=()=>{i.handled=!0,n=!0},s=[];for(let l=0;l<e.length;l++){const{type:c,handler:y,once:_}=e[l];if(y({...i,type:c,stopPropagation:r,stopImmediatePropagation:o}),_&&s.push(e[l]),n)break}for(let l=0;l<s.length;l++){const{type:c,handler:y}=s[l];this.remove(c,y)}}}_normalizeEvent(i){const t=this.eventManager.getElement();return{...i,...Dj(i),...kj(i,t),preventDefault:()=>{i.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}};function Nj(i){if("recognizer"in i)return i;let t;const e=Array.isArray(i)?[...i]:[i];if(typeof e[0]=="function"){const n=e.shift(),r=e.shift()||{};t=new n(r)}else t=e.shift();return{recognizer:t,recognizeWith:typeof e[0]=="string"?[e[0]]:e[0],requireFailure:typeof e[1]=="string"?[e[1]]:e[1]}}let zj=class{constructor(i=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=i,!!i){this.manager=new dj(i,this.options);for(const e of this.options.recognizers){const{recognizer:n,recognizeWith:r,requireFailure:o}=Nj(e);this.manager.add(n),r&&n.recognizeWith(r),o&&n.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new wj(i,this._onOtherEvent,{enable:!1}),this.moveInput=new Ej(i,this._onOtherEvent,{enable:!1}),this.keyInput=new Cj(i,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Tj(i,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(i,t,e){this._addEventHandler(i,t,e,!1)}once(i,t,e){this._addEventHandler(i,t,e,!0)}watch(i,t,e){this._addEventHandler(i,t,e,!1,!0)}off(i,t){this._removeEventHandler(i,t)}_toggleRecognizer(i,t){const{manager:e}=this;if(!e)return;const n=e.get(i);n&&(n.set({enable:t}),e.touchAction.update()),this.wheelInput?.enableEventType(i,t),this.moveInput?.enableEventType(i,t),this.keyInput?.enableEventType(i,t),this.contextmenuInput?.enableEventType(i,t)}_addEventHandler(i,t,e,n,r){if(typeof i!="string"){e=t;for(const[c,y]of Object.entries(i))this._addEventHandler(c,y,e,n,r);return}const{manager:o,events:s}=this;if(!o)return;let l=s.get(i);if(!l){const c=this._getRecognizerName(i)||i;l=new Fj(this,c),s.set(i,l),o&&o.on(i,l.handleEvent)}l.add(i,t,e,n,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(i,t){if(typeof i!="string"){for(const[r,o]of Object.entries(i))this._removeEventHandler(r,o);return}const{events:e}=this,n=e.get(i);if(n&&(n.remove(i,t),n.isEmpty())){const{recognizerName:r}=n;let o=!1;for(const s of e.values())if(s.recognizerName===r&&!s.isEmpty()){o=!0;break}o||this._toggleRecognizer(r,!1)}}_getRecognizerName(i){return this.manager.recognizers.find(t=>t.getEventNames().includes(i))?.options.event}};const nn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(nn,"IDENTITY",{get:()=>($i.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const fa={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Oo={common:0,meters:1,pixels:2},Pb={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},xT={multipan:[mT,{threshold:10,direction:Ts.Vertical,pointers:2}],pinch:[yj,{},null,["multipan"]],pan:[mT,{threshold:1},["pinch"],["multipan"]],dblclick:[AT,{event:"dblclick",taps:2}],click:[AT,{event:"click"},null,["dblclick"]]};function Uj(i,t){if(i===t)return!0;if(Array.isArray(i)){const e=i.length;if(!t||t.length!==e)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}return!1}function vm(i){let t={},e;return n=>{for(const r in n)if(!Uj(n[r],t[r])){e=i(n),t=n;break}return e}}const wT=[0,0,0,0],Vj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],WR=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Gj=[0,0,0],HR=[0,0,0],jj=vm(Xj);function XR(i,t,e=HR){e.length<3&&(e=[e[0],e[1],0]);let n=e,r,o=!0;switch(t===nn.LNGLAT_OFFSETS||t===nn.METER_OFFSETS?r=e:r=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case fa.WEB_MERCATOR:(t===nn.LNGLAT||t===nn.CARTESIAN)&&(r=[0,0,0],o=!1);break;case fa.WEB_MERCATOR_AUTO_OFFSET:t===nn.LNGLAT?n=r:t===nn.CARTESIAN&&(n=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],r=i.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case fa.IDENTITY:n=i.position.map(Math.fround),n[2]=n[2]||0;break;case fa.GLOBE:o=!1,r=null;break;default:o=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:n,offsetMode:o}}function Wj(i,t,e){const{viewMatrixUncentered:n,projectionMatrix:r}=i;let{viewMatrix:o,viewProjectionMatrix:s}=i,l=wT,c=wT,y=i.cameraPosition;const{geospatialOrigin:_,shaderCoordinateOrigin:C,offsetMode:I}=XR(i,t,e);return I&&(c=i.projectPosition(_||C),y=[y[0]-c[0],y[1]-c[1],y[2]-c[2]],c[3]=1,l=Lp([],c,s),o=n||o,s=Zh([],r,o),s=Zh([],s,Vj)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:l,originCommon:c,cameraPosCommon:y,shaderCoordinateOrigin:C,geospatialOrigin:_}}function Hj({viewport:i,devicePixelRatio:t=1,modelMatrix:e=null,coordinateSystem:n=nn.DEFAULT,coordinateOrigin:r=HR,autoWrapLongitude:o=!1}){n===nn.DEFAULT&&(n=i.isGeospatial?nn.LNGLAT:nn.CARTESIAN);const s=jj({viewport:i,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:r});return s.wrapLongitude=o,s.modelMatrix=e||WR,s}function Xj({viewport:i,devicePixelRatio:t,coordinateSystem:e,coordinateOrigin:n}){const{projectionCenter:r,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:l,shaderCoordinateOrigin:c,geospatialOrigin:y}=Wj(i,e,n),_=i.getDistanceScales(),C=[i.width*t,i.height*t],I=Lp([],[0,0,-i.focalDistance,1],i.projectionMatrix)[3]||1,k={coordinateSystem:e,projectionMode:i.projectionMode,coordinateOrigin:c,commonOrigin:s.slice(0,3),center:r,pseudoMeters:!!i._pseudoMeters,viewportSize:C,devicePixelRatio:t,focalDistance:I,commonUnitsPerMeter:_.unitsPerMeter,commonUnitsPerWorldUnit:_.unitsPerMeter,commonUnitsPerWorldUnit2:Gj,scale:i.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:WR,cameraPosition:l};if(y){const z=i.getDistanceScales(y);switch(e){case nn.METER_OFFSETS:k.commonUnitsPerWorldUnit=z.unitsPerMeter,k.commonUnitsPerWorldUnit2=z.unitsPerMeter2;break;case nn.LNGLAT:case nn.LNGLAT_OFFSETS:i._pseudoMeters||(k.commonUnitsPerMeter=z.unitsPerMeter),k.commonUnitsPerWorldUnit=z.unitsPerDegree,k.commonUnitsPerWorldUnit2=z.unitsPerDegree2;break;case nn.CARTESIAN:k.commonUnitsPerWorldUnit=[1,1,z.unitsPerMeter[2]],k.commonUnitsPerWorldUnit2=[0,0,z.unitsPerMeter2[2]];break}}return k}const qj=Object.keys(nn).map(i=>`const COORDINATE_SYSTEM_${i}: i32 = ${nn[i]};`).join(""),Kj=Object.keys(fa).map(i=>`const PROJECTION_MODE_${i}: i32 = ${fa[i]};`).join(""),Zj=Object.keys(Oo).map(i=>`const UNIT_${i.toUpperCase()}: i32 = ${Oo[i]};`).join(""),Yj=`${qj}
${Kj}
${Zj}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,Qj=`${Yj}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,Jj=Object.keys(nn).map(i=>`const int COORDINATE_SYSTEM_${i} = ${nn[i]};`).join(""),$j=Object.keys(fa).map(i=>`const int PROJECTION_MODE_${i} = ${fa[i]};`).join(""),tW=Object.keys(Oo).map(i=>`const int UNIT_${i.toUpperCase()} = ${Oo[i]};`).join(""),eW=`${Jj}
${$j}
${tW}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,iW={};function nW(i=iW){return"viewport"in i?Hj(i):{}}const Ly={name:"project",dependencies:[wG,FR],source:Qj,vs:eW,getUniforms:nW,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},rW=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,sW=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Hs={name:"project32",dependencies:[Ly],source:rW,vs:sW};function oW(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function sp(i,t){const e=Lp([],t,i);return Ix(e,e,1/e[3]),e}function ET(i,t){const e=i%t;return e<0?t+e:e}function Ib(i,t,e){return i<t?t:i>e?e:i}function aW(i){return Math.log(i)*Math.LOG2E}const Lx=Math.log2||aW;function Ju(i,t){if(!i)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const fl=Math.PI,qR=fl/4,Na=fl/180,Mb=180/fl,gp=512,Jg=4003e4,Hd=85.051129,lW=1.5;function uW(i){return Lx(i)}function $u(i){const[t,e]=i;Ju(Number.isFinite(t)),Ju(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*Na,r=e*Na,o=gp*(n+fl)/(2*fl),s=gp*(fl+Math.log(Math.tan(qR+r*.5)))/(2*fl);return[o,s]}function lu(i){const[t,e]=i,n=t/gp*(2*fl)-fl,r=2*(Math.atan(Math.exp(e/gp*(2*fl)-fl))-qR);return[n*Mb,r*Mb]}function cW(i){const{latitude:t}=i;Ju(Number.isFinite(t));const e=Math.cos(t*Na);return uW(Jg*e)-9}function I_(i){const t=Math.cos(i*Na);return gp/Jg/t}function Bb(i){const{latitude:t,longitude:e,highPrecision:n=!1}=i;Ju(Number.isFinite(t)&&Number.isFinite(e));const r=gp,o=Math.cos(t*Na),s=r/360,l=s/o,c=r/Jg/o,y={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[s,l,c],degreesPerUnit:[1/s,1/l,1/c]};if(n){const _=Na*Math.tan(t*Na)/o,C=s*_/2,I=r/Jg*_,k=I/l*c;y.unitsPerDegree2=[0,C,I],y.unitsPerMeter2=[k,0,k]}return y}function KR(i,t){const[e,n,r]=i,[o,s,l]=t,{unitsPerMeter:c,unitsPerMeter2:y}=Bb({longitude:e,latitude:n,highPrecision:!0}),_=$u(i);_[0]+=o*(c[0]+y[0]*s),_[1]+=s*(c[1]+y[1]*s);const C=lu(_),I=(r||0)+(l||0);return Number.isFinite(r)||Number.isFinite(l)?[C[0],C[1],I]:C}function hW(i){const{height:t,pitch:e,bearing:n,altitude:r,scale:o,center:s}=i,l=oW();Yg(l,l,[0,0,-r]),TR(l,l,-e*Na),SR(l,l,n*Na);const c=o/t;return Px(l,l,[c,c,c]),s&&Yg(l,l,fV([],s)),l}function fW(i){const{width:t,height:e,altitude:n,pitch:r=0,offset:o,center:s,scale:l,nearZMultiplier:c=1,farZMultiplier:y=1}=i;let{fovy:_=nm(lW)}=i;n!==void 0&&(_=nm(n));const C=_*Na,I=r*Na,k=Dx(_);let z=k;s&&(z+=s[2]*l/Math.cos(I)/e);const V=C*(.5+(o?o[1]:0)/e),X=Math.sin(V)*z/Math.sin(Ib(Math.PI/2-I-V,.01,Math.PI-.01)),H=Math.sin(I)*X+z,$=z*10,Y=Math.min(H*y,$);return{fov:C,aspect:t/e,focalDistance:k,near:c,far:Y}}function nm(i){return 2*Math.atan(.5/i)*Mb}function Dx(i){return .5/Math.tan(.5*i*Na)}function ZR(i,t){const[e,n,r=0]=i;return Ju(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(r)),sp(t,[e,n,r,1])}function kx(i,t,e=0){const[n,r,o]=i;if(Ju(Number.isFinite(n)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(o))return sp(t,[n,r,o,1]);const s=sp(t,[n,r,0,1]),l=sp(t,[n,r,1,1]),c=s[2],y=l[2],_=c===y?0:((e||0)-c)/(y-c);return dR([],s,l,_)}function dW(i){const{width:t,height:e,bounds:n,minExtent:r=0,maxZoom:o=24,offset:s=[0,0]}=i,[[l,c],[y,_]]=n,C=pW(i.padding),I=$u([l,Ib(_,-Hd,Hd)]),k=$u([y,Ib(c,-Hd,Hd)]),z=[Math.max(Math.abs(k[0]-I[0]),r),Math.max(Math.abs(k[1]-I[1]),r)],V=[t-C.left-C.right-Math.abs(s[0])*2,e-C.top-C.bottom-Math.abs(s[1])*2];Ju(V[0]>0&&V[1]>0);const X=V[0]/z[0],H=V[1]/z[1],$=(C.right-C.left)/2/X,Y=(C.top-C.bottom)/2/H,ct=[(k[0]+I[0])/2+$,(k[1]+I[1])/2+Y],rt=lu(ct),nt=Math.min(o,Lx(Math.abs(Math.min(X,H))));return Ju(Number.isFinite(nt)),{longitude:rt[0],latitude:rt[1],zoom:nt}}function pW(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(Ju(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const CT=Math.PI/180;function AW(i,t=0){const{width:e,height:n,unproject:r}=i,o={targetZ:t},s=r([0,n],o),l=r([e,n],o);let c,y;const _=i.fovy?.5*i.fovy*CT:Math.atan(.5/i.altitude),C=(90-i.pitch)*CT;return _>C-.01?(c=TT(i,0,t),y=TT(i,e,t)):(c=r([0,0],o),y=r([e,0],o)),[s,l,y,c]}function TT(i,t,e){const{pixelUnprojectionMatrix:n}=i,r=sp(n,[t,0,1,1]),o=sp(n,[t,i.height,1,1]),s=(e*i.distanceScales.unitsPerMeter[2]-r[2])/(o[2]-r[2]),l=dR([],r,o,s),c=lu(l);return c.push(e),c}const ST=512;function mW(i){const{width:t,height:e,pitch:n=0}=i;let{longitude:r,latitude:o,zoom:s,bearing:l=0}=i;(r<-180||r>180)&&(r=ET(r+180,360)-180),(l<-180||l>180)&&(l=ET(l+180,360)-180);const c=Lx(e/ST);if(s<=c)s=c,o=0;else{const y=e/2/Math.pow(2,s),_=lu([0,y])[1];if(o<_)o=_;else{const C=lu([0,ST-y])[1];o>C&&(o=C)}}return{width:t,height:e,longitude:r,latitude:o,zoom:s,pitch:n,bearing:l}}const YR=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,gW=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,yW=`
${YR}
${gW}
`,vW=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,_W=`
${YR}
${vW}
`,bW=vm(TW),xW=vm(SW),wW=[0,0,0,1],EW=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function CW(i,t){const[e,n,r]=i,o=kx([e,n,r],t);return Number.isFinite(r)?o:[o[0],o[1],0]}function TW({viewport:i,center:t}){return new bn(i.viewProjectionMatrix).invert().transform(t)}function SW({viewport:i,shadowMatrices:t}){const e=[],n=i.pixelUnprojectionMatrix,r=i.isGeospatial?void 0:1,o=[[0,0,r],[i.width,0,r],[0,i.height,r],[i.width,i.height,r],[0,0,-1],[i.width,0,-1],[0,i.height,-1],[i.width,i.height,-1]].map(s=>CW(s,n));for(const s of t){const l=s.clone().translate(new ve(i.center).negate()),c=o.map(_=>l.transform(_)),y=new bn().ortho({left:Math.min(...c.map(_=>_[0])),right:Math.max(...c.map(_=>_[0])),bottom:Math.min(...c.map(_=>_[1])),top:Math.max(...c.map(_=>_[1])),near:Math.min(...c.map(_=>-_[2])),far:Math.max(...c.map(_=>-_[2]))});e.push(y.multiplyRight(s))}return e}function PW(i){const{shadowEnabled:t=!0,project:e}=i;if(!t||!e||!i.shadowMatrices||!i.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};const n=Ly.getUniforms(e),r=bW({viewport:e.viewport,center:n.center}),o=[],s=xW({shadowMatrices:i.shadowMatrices,viewport:e.viewport}).slice();for(let c=0;c<i.shadowMatrices.length;c++){const y=s[c],_=y.clone().translate(new ve(e.viewport.center).negate());n.coordinateSystem===nn.LNGLAT&&n.projectionMode===fa.WEB_MERCATOR?(s[c]=_,o[c]=r):(s[c]=y.clone().multiplyRight(EW),o[c]=_.transform(r))}const l={drawShadowMap:!!i.drawToShadowMap,useShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,color:i.shadowColor||wW,lightId:i.shadowLightId||0,lightCount:i.shadowMatrices.length,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};for(let c=0;c<s.length;c++)l[`viewProjectionMatrix${c}`]=s[c],l[`projectCenter${c}`]=o[c];for(let c=0;c<2;c++)l[`shadow_uShadowMap${c}`]=i.shadowMaps&&i.shadowMaps[c]||i.dummyShadowMap;return l}const PT={name:"shadow",dependencies:[Ly],vs:yW,fs:_W,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:PW,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},ma={...rT,defaultUniforms:{...rT.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},IW=[FR],MW=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],BW=[];function RW(i){const t=Gh.getDefaultShaderAssembler();for(const n of IW)t.addDefaultModule(n);t._hookFunctions.length=0;const e=i==="glsl"?MW:BW;for(const n of e)t.addShaderHook(n);return t}const LW=[255,255,255],DW=1;let kW=0;class OW{constructor(t={}){this.type="ambient";const{color:e=LW}=t,{intensity:n=DW}=t;this.id=t.id||`ambient-${kW++}`,this.color=e,this.intensity=n}}const FW=[255,255,255],NW=1,zW=[0,0,-1];let UW=0;class IT{constructor(t={}){this.type="directional";const{color:e=FW}=t,{intensity:n=NW}=t,{direction:r=zW}=t,{_shadow:o=!1}=t;this.id=t.id||`directional-${UW++}`,this.color=e,this.intensity=n,this.type="directional",this.direction=new ve(r).normalize().toArray(),this.shadow=o}getProjectedLight(t){return this}}class QR{constructor(t,e={id:"pass"}){const{id:n}=e;this.id=n,this.device=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class Dy extends QR{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[e,n]=this.device.canvasContext.getDrawingBufferSize(),r=t.clearCanvas??!0,o=t.clearColor??(r?[0,0,0,0]:!1),s=r?1:!1,l=r?0:!1,c=t.colorMask??15,y={viewport:[0,0,e,n]};t.colorMask&&(y.colorMask=c),t.scissorRect&&(y.scissorRect=t.scissorRect);const _=this.device.beginRenderPass({framebuffer:t.target,parameters:y,clearColor:o,clearDepth:s,clearStencil:l});try{return this._drawLayers(_,t)}finally{_.end(),this.device.submit()}}_drawLayers(t,e){const{target:n,shaderModuleProps:r,viewports:o,views:s,onViewportActive:l,clearStack:c=!0}=e;e.pass=e.pass||"unknown",c&&(this._lastRenderIndex=-1);const y=[];for(const _ of o){const C=s&&s[_.id];l?.(_);const I=this._getDrawLayerParams(_,e),k=_.subViewports||[_];for(const z of k){const V=this._drawLayersInViewport(t,{target:n,shaderModuleProps:r,viewport:z,view:C,pass:e.pass,layers:e.layers},I);y.push(V)}}return y}_getDrawLayerParams(t,{layers:e,pass:n,isPicking:r=!1,layerFilter:o,cullRect:s,effects:l,shaderModuleProps:c},y=!1){const _=[],C=JR(this._lastRenderIndex+1),I={layer:e[0],viewport:t,isPicking:r,renderPass:n,cullRect:s},k={};for(let z=0;z<e.length;z++){const V=e[z],X=this._shouldDrawLayer(V,I,o,k),H={shouldDrawLayer:X};X&&!y&&(H.shouldDrawLayer=!0,H.layerRenderIndex=C(V,X),H.shaderModuleProps=this._getShaderModuleProps(V,l,n,c),H.layerParameters={...V.context.deck?.props.parameters,...this.getLayerParameters(V,z,t)}),_[z]=H}return _}_drawLayersInViewport(t,{layers:e,shaderModuleProps:n,pass:r,target:o,viewport:s,view:l},c){const y=VW(this.device,{shaderModuleProps:n,target:o,viewport:s});if(l){const{clear:C,clearColor:I,clearDepth:k,clearStencil:z}=l.props;if(C){let V=[0,0,0,0],X=1,H=0;Array.isArray(I)?V=[...I.slice(0,3),I[3]||255].map($=>$/255):I===!1&&(V=!1),k!==void 0&&(X=k),z!==void 0&&(H=z),this.device.beginRenderPass({framebuffer:o,parameters:{viewport:y,scissorRect:y},clearColor:V,clearDepth:X,clearStencil:H}).end()}}const _={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:y});for(let C=0;C<e.length;C++){const I=e[C],k=c[C],{shouldDrawLayer:z}=k;if(z&&I.props.pickable&&_.pickableCount++,I.isComposite&&_.compositeCount++,I.isDrawable&&k.shouldDrawLayer){const{layerRenderIndex:V,shaderModuleProps:X,layerParameters:H}=k;_.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,V),X.project&&(X.project.viewport=s),I.context.renderPass=t;try{I._drawLayer({renderPass:t,shaderModuleProps:X,uniforms:{layerIndex:V},parameters:H})}catch($){I.raiseError($,`drawing ${I} to ${r}`)}}}return _}shouldDrawLayer(t){return!0}getShaderModuleProps(t,e,n){return null}getLayerParameters(t,e,n){return t.props.parameters}_shouldDrawLayer(t,e,n,r){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let o=t.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(e))return!1;e.layer=o,o=o.parent}if(n){const s=e.layer.id;if(s in r||(r[s]=n(e)),!r[s])return!1}return t.activateViewport(e.viewport),!0}_getShaderModuleProps(t,e,n,r){const o=this.device.canvasContext.cssToDeviceRatio(),s=t.internalState?.propsInTransition||t.props,l={layer:s,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:o,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(e)for(const c of e)MT(l,c.getShaderModuleProps?.(t,l));return MT(l,this.getShaderModuleProps(t,e,l),r)}}function JR(i=0,t={}){const e={},n=(r,o)=>{const s=r.props._offset,l=r.id,c=r.parent&&r.parent.id;let y;if(c&&!(c in t)&&n(r.parent,!1),c in e){const _=e[c]=e[c]||JR(t[c],t);y=_(r,o),e[l]=_}else Number.isFinite(s)?(y=s+(t[c]||0),e[l]=null):y=i;return o&&y>=i&&(i=y+1),t[l]=y,y};return n}function VW(i,{shaderModuleProps:t,target:e,viewport:n}){const r=t?.project?.devicePixelRatio??i.canvasContext.cssToDeviceRatio(),[,o]=i.canvasContext.getDrawingBufferSize(),s=e?e.height:o,l=n;return[l.x*r,s-(l.y+l.height)*r,l.width*r,l.height*r]}function MT(i,...t){for(const e of t)if(e)for(const n in e)i[n]?Object.assign(i[n],e[n]):i[n]=e[n];return i}class GW extends Dy{constructor(t,e){super(t,e);const n=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),r=t.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){const e=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),r=t.viewports[0],o=r.width*n,s=r.height*n,l=[1,1,1,1];(o!==e.width||s!==e.height)&&e.resize({width:o,height:s}),super.render({...t,clearColor:l,target:e,pass:"shadow"})}getLayerParameters(t,e,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,e,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const jW={color:[255,255,255],intensity:1},BT=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],WW=[0,0,0,200/255];class $R{constructor(t={}){this.id="lighting-effect",this.shadowColor=WW,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:e,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(e),n._addDefaultShaderModule(PT),this.dummyShadowMap=e.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:e,viewports:n,onViewportActive:r,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:t,layerFilter:e,viewports:n,onViewportActive:r,views:o,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,e){const n=this.shadow?{project:e.project,shadowMaps:this.shadowPasses.map(s=>s.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(s=>s.getProjectedLight({layer:t})),pointLights:this.pointLights.map(s=>s.getProjectedLight({layer:t}))},o=t.props.material;return{shadow:n,lighting:r,phongMaterial:o,gouraudMaterial:o}}cleanup(t){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(PT))}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const n=new bn().lookAt({eye:new ve(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new GW(t);this.shadowPasses[e]=n}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;!t&&e.length===0&&n.length===0&&(this.ambientLight=new OW(jW),this.directionalLights.push(new IT(BT[0]),new IT(BT[1])))}}class HW{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,{size:n=1,type:r,padding:o=0,copy:s=!1,initialize:l=!1,maxCount:c}){const y=r||t&&t.constructor||Float32Array,_=e*n+o;if(ArrayBuffer.isView(t)){if(_<=t.length)return t;if(_*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new y(t.buffer,0,_)}let C=1/0;c&&(C=c*n+o);const I=this._allocate(y,_,l,C);return t&&s?I.set(t):l||I.fill(0,0,4),this._release(t),I}release(t){this._release(t)}_allocate(t,e,n,r){let o=Math.max(Math.ceil(e*this.opts.overAlloc),1);o>r&&(o=r);const s=this._pool,l=t.BYTES_PER_ELEMENT*o,c=s.findIndex(y=>y.byteLength>=l);if(c>=0){const y=new t(s.splice(c,1)[0],0,o);return n&&y.fill(0),y}return new t(o)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:r}=n,o=e.findIndex(s=>s.byteLength>=r);o<0?e.push(n):(o>0||e.length<this.opts.poolSize)&&e.splice(o,0,n),e.length>this.opts.poolSize&&e.shift()}}const yp=new HW;function MA(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function XW(i){return[i[12],i[13],i[14]]}function qW(i){return{left:vd(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:vd(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:vd(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:vd(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:vd(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:vd(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const RT=new ve;function vd(i,t,e,n){RT.set(i,t,e);const r=RT.len();return{distance:n/r,normal:new ve(-i/r,-t/r,-e/r)}}function KW(i){return i-Math.fround(i)}let gA;function M_(i,t){const{size:e=1,startIndex:n=0}=t,r=t.endIndex!==void 0?t.endIndex:i.length,o=(r-n)/e;gA=yp.allocate(gA,o,{type:Float32Array,size:e*2});let s=n,l=0;for(;s<r;){for(let c=0;c<e;c++){const y=i[s++];gA[l+c]=y,gA[l+c+e]=KW(y)}l+=e*2}return gA.subarray(0,o*e*2)}function ZW(i){let t=null,e=!1;for(const n of i)n&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const YW=Math.PI/180,QW=MA(),LT=[0,0,0],JW={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function $W({width:i,height:t,orthographic:e,fovyRadians:n,focalDistance:r,padding:o,near:s,far:l}){const c=i/t,y=e?new bn().orthographic({fovy:n,aspect:c,focalDistance:r,near:s,far:l}):new bn().perspective({fovy:n,aspect:c,near:s,far:l});if(o){const{left:_=0,right:C=0,top:I=0,bottom:k=0}=o,z=Xu((_+i-C)/2,0,i)-i/2,V=Xu((I+t-k)/2,0,t)-t/2;y[8]-=z*2/i,y[9]+=V*2/t}return y}class ec{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||JW,this.focalDistance=t.focalDistance||1,this.position=t.position||LT,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?fa.WEB_MERCATOR:fa.WEB_MERCATOR_AUTO_OFFSET:fa.IDENTITY}equals(t){return t instanceof ec?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Aa(t.projectionMatrix,this.projectionMatrix)&&Aa(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:e=!0}={}){const n=this.projectPosition(t),r=ZR(n,this.pixelProjectionMatrix),[o,s]=r,l=e?s:this.height-s;return t.length===2?[o,l]:[o,l,r[2]]}unproject(t,{topLeft:e=!0,targetZ:n}={}){const[r,o,s]=t,l=e?o:this.height-o,c=n&&n*this.distanceScales.unitsPerMeter[2],y=kx([r,l,s],this.pixelUnprojectionMatrix,c),[_,C,I]=this.unprojectPosition(y);return Number.isFinite(s)?[_,C,I]:Number.isFinite(n)?[_,C,n]:[_,C]}projectPosition(t){const[e,n]=this.projectFlat(t),r=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,n,r]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t),r=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,n,r]}projectFlat(t){if(this.isGeospatial){const e=$u(t);return e[1]=Xu(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?lu(t):t}getBounds(t={}){const e={targetZ:t.z||0},n=this.unproject([0,0],e),r=this.unproject([this.width,0],e),o=this.unproject([0,this.height],e),s=this.unproject([this.width,this.height],e);return[Math.min(n[0],r[0],o[0],s[0]),Math.min(n[1],r[1],o[1],s[1]),Math.max(n[0],r[0],o[0],s[0]),Math.max(n[1],r[1],o[1],s[1])]}getDistanceScales(t){return t&&this.isGeospatial?Bb({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:n=1,height:r=1}){return t<this.x+this.width&&this.x<t+n&&e<this.y+this.height&&this.y<e+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,qW(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=cW({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Bb({latitude:n,longitude:e}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:o,modelMatrix:s}=t;let l=LT;if(o&&(l=s?new bn(s).transformAsVector(o,[]):o),this.isGeospatial){const c=this.projectPosition([e,n,0]);this.center=new ve(l).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(l)}_initMatrices(t){const{viewMatrix:e=QW,projectionMatrix:n=null,orthographic:r=!1,fovyRadians:o,fovy:s=75,near:l=.1,far:c=1e3,padding:y=null,focalDistance:_=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new bn().multiplyRight(e).translate(new ve(this.center).negate()),this.projectionMatrix=n||$W({width:this.width,height:this.height,orthographic:r,fovyRadians:o||s*YW,focalDistance:_,padding:y,near:l,far:c});const C=MA();Zh(C,C,this.projectionMatrix),Zh(C,C,this.viewMatrix),this.viewProjectionMatrix=C,this.viewMatrixInverse=xb([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=XW(this.viewMatrixInverse);const I=MA(),k=MA();Px(I,I,[this.width/2,-this.height/2,1]),Yg(I,I,[1,-1,0]),Zh(k,I,this.viewProjectionMatrix),this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=xb(MA(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||$i.warn("Pixel project matrix not invertible")()}}ec.displayName="Viewport";let rm=class Rb extends ec{constructor(t={}){const{latitude:e=0,longitude:n=0,zoom:r=0,pitch:o=0,bearing:s=0,nearZMultiplier:l=.1,farZMultiplier:c=1.01,nearZ:y,farZ:_,orthographic:C=!1,projectionMatrix:I,repeat:k=!1,worldOffset:z=0,position:V,padding:X,legacyMeterSizes:H=!1}=t;let{width:$,height:Y,altitude:ct=1.5}=t;const rt=Math.pow(2,r);$=$||1,Y=Y||1;let nt,Ot=null;if(I)ct=I[5]/2,nt=nm(ct);else{t.fovy?(nt=t.fovy,ct=Dx(nt)):nt=nm(ct);let ft;if(X){const{top:st=0,bottom:Ut=0}=X;ft=[0,Xu((st+Y-Ut)/2,0,Y)-Y/2]}Ot=fW({width:$,height:Y,scale:rt,center:V&&[0,0,V[2]*I_(e)],offset:ft,pitch:o,fovy:nt,nearZMultiplier:l,farZMultiplier:c}),Number.isFinite(y)&&(Ot.near=y),Number.isFinite(_)&&(Ot.far=_)}let Kt=hW({height:Y,pitch:o,bearing:s,scale:rt,altitude:ct});z&&(Kt=new bn().translate([512*z,0,0]).multiplyLeft(Kt)),super({...t,width:$,height:Y,viewMatrix:Kt,longitude:n,latitude:e,zoom:r,...Ot,fovy:nt,focalDistance:ct}),this.latitude=e,this.longitude=n,this.zoom=r,this.pitch=o,this.bearing=s,this.altitude=ct,this.fovy=nt,this.orthographic=C,this._subViewports=k?[]:null,this._pseudoMeters=H,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let r=e;r<=n;r++){const o=r?new Rb({...this,worldOffset:r}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t),r=(t[2]||0)*I_(t[1]);return[e,n,r]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t),r=(t[2]||0)/I_(n);return[e,n,r]}addMetersToLngLat(t,e){return KR(t,e)}panByPosition(t,e){const n=kx(e,this.pixelUnprojectionMatrix),r=this.projectFlat(t),o=QC([],r,sV([],n)),s=QC([],this.center,o),[l,c]=this.unprojectFlat(s);return{longitude:l,latitude:c}}getBounds(t={}){const e=AW(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:n,height:r}=this,{longitude:o,latitude:s,zoom:l}=dW({width:n,height:r,bounds:t,...e});return new Rb({width:n,height:r,longitude:o,latitude:s,zoom:l})}};rm.displayName="WebMercatorViewport";const DT=[0,0,0];function B_(i,t,e=!1){const n=t.projectPosition(i);if(e&&t instanceof rm){const[r,o,s=0]=i,l=t.getDistanceScales([r,o]);n[2]=s*l.unitsPerMeter[2]}return n}function tH(i){const{viewport:t,modelMatrix:e,coordinateOrigin:n}=i;let{coordinateSystem:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}=i;return r===nn.DEFAULT&&(r=t.isGeospatial?nn.LNGLAT:nn.CARTESIAN),o===void 0&&(o=r),s===void 0&&(s=n),{viewport:t,coordinateSystem:r,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:o,fromCoordinateOrigin:s}}function tL(i,{viewport:t,modelMatrix:e,coordinateSystem:n,coordinateOrigin:r,offsetMode:o}){let[s,l,c=0]=i;switch(e&&([s,l,c]=Lp([],[s,l,c,1],e)),n){case nn.LNGLAT:return B_([s,l,c],t,o);case nn.LNGLAT_OFFSETS:return B_([s+r[0],l+r[1],c+(r[2]||0)],t,o);case nn.METER_OFFSETS:return B_(KR(r,[s,l,c]),t,o);case nn.CARTESIAN:default:return t.isGeospatial?[s+r[0],l+r[1],c+r[2]]:t.projectPosition([s,l,c])}}function eH(i,t){const{viewport:e,coordinateSystem:n,coordinateOrigin:r,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:l}=tH(t),{autoOffset:c=!0}=t,{geospatialOrigin:y=DT,shaderCoordinateOrigin:_=DT,offsetMode:C=!1}=c?XR(e,n,r):{},I=tL(i,{viewport:e,modelMatrix:o,coordinateSystem:s,coordinateOrigin:l,offsetMode:C});if(C){const k=e.projectPosition(y||_);wR(I,I,k)}return I}let iH=1,nH=1;class eL{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:r=1,repeat:o=1}=t,s=iH++,l={time:0,delay:e,duration:n,rate:r,repeat:o};return this._setChannelTime(l,this.time),this.channels.set(s,l),s}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const r of e)this._setChannelTime(r,this.time);const n=this.animations.values();for(const r of n){const{animation:o,channel:s}=r;o.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=nH++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay,r=t.duration*t.repeat;n>=r?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}function rH(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function sH(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}let oH=0;class Ox{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:gb.stats.get(`animation-loop-${oH++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(t){if(this.props={...Ox.defaultAnimationLoopProps,...t},t=this.props,!t.device)throw new Error("No device provided");this.stats=t.stats||new Bp({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(t){this.props.onError(t),this._error=t}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const e=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=rH(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(sH(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const t=this.device?.getDefaultCanvasContext();if(!this.device||!t)throw new Error("loop");const e=t?.canvas,n=t.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:t,canvas:e,useDevicePixels:n,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:e,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[t,e]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let n=1;const r=this.device?.getDefaultCanvasContext().canvas;return r&&r.clientHeight?n=r.clientWidth/r.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}const R_={};function ic(i="id"){R_[i]=R_[i]||1;const t=R_[i]++;return`${i}-${t}`}class kT{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){if(this.id=t.id||ic("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&br.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}}function aH(i,t){if(t instanceof kT)return t;const e=lH(i,t),{attributes:n,bufferLayout:r}=uH(i,t);return new kT({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:e,attributes:n})}function lH(i,t){if(!t.indices)return;const e=t.indices.value;return i.createBuffer({usage:br.INDEX,data:e})}function uH(i,t){const e=[],n={};for(const[o,s]of Object.entries(t.attributes)){let l=o;switch(o){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(s){n[l]=i.createBuffer({data:s.value,id:`${o}-buffer`});const{value:c,size:y,normalized:_}=s;e.push({name:l,format:vU(c,y,_)})}}const r=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:e,vertexCount:r}}class Fx{static defaultProps={...Kh.defaultProps};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new Fx(t),t._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cachePipelines,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=t.props.debugFactories}createRenderPipeline(t){if(!this.cachingEnabled)return this.device.createRenderPipeline(t);const e={...Kh.defaultProps,...t},n=this._renderPipelineCache,r=this._hashRenderPipeline(e);let o=n[r]?.pipeline;return o?(n[r].useCount++,this.debug&&Xe.warn(`${this}: ${n[r].pipeline} reused, count=${n[r].useCount}, (id=${t.id})`)()):(o=this.device.createRenderPipeline({...e,id:e.id?`${e.id}-cached`:ic("unnamed-cached")}),o.hash=r,n[r]={pipeline:o,useCount:1},this.debug&&Xe.warn(`${this}: ${o} created, count=${n[r].useCount}`)()),o}createComputePipeline(t){if(!this.cachingEnabled)return this.device.createComputePipeline(t);const e={...jg.defaultProps,...t},n=this._computePipelineCache,r=this._hashComputePipeline(e);let o=n[r]?.pipeline;return o?(n[r].useCount++,this.debug&&Xe.warn(`${this}: ${n[r].pipeline} reused, count=${n[r].useCount}, (id=${t.id})`)()):(o=this.device.createComputePipeline({...e,id:e.id?`${e.id}-cached`:void 0}),o.hash=r,n[r]={pipeline:o,useCount:1},this.debug&&Xe.warn(`${this}: ${o} created, count=${n[r].useCount}`)()),o}release(t){if(!this.cachingEnabled){t.destroy();return}const e=this._getCache(t),n=t.hash;e[n].useCount--,e[n].useCount===0?(this._destroyPipeline(t),this.debug&&Xe.warn(`${this}: ${t} released and destroyed`)()):e[n].useCount<0?(Xe.error(`${this}: ${t} released, useCount < 0, resetting`)(),e[n].useCount=0):this.debug&&Xe.warn(`${this}: ${t} released, count=${e[n].useCount}`)()}_destroyPipeline(t){const e=this._getCache(t);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete e[t.hash],t.destroy(),!0}}_getCache(t){let e;if(t instanceof jg&&(e=this._computePipelineCache),t instanceof Kh&&(e=this._renderPipelineCache),!e)throw new Error(`${this}`);if(!e[t.hash])throw new Error(`${this}: ${t} matched incorrect entry`);return e}_hashComputePipeline(t){const{type:e}=this.device,n=this._getHash(t.shader.source);return`${e}/C/${n}`}_hashRenderPipeline(t){const e=t.vs?this._getHash(t.vs.source):0,n=t.fs?this._getHash(t.fs.source):0,r="-",o=this._getHash(JSON.stringify(t.bufferLayout)),{type:s}=this.device;switch(s){case"webgl":return`${s}/R/${e}/${n}V${r}BL${o}`;case"webgpu":default:const l=this._getHash(JSON.stringify(t.parameters));return`${s}/R/${e}/${n}V${r}T${t.topology}P${l}BL${o}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}}class Nx{static defaultProps={...Iy.defaultProps};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new Nx(t),t._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cacheShaders,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=!0}createShader(t){if(!this.cachingEnabled)return this.device.createShader(t);const e=this._hashShader(t);let n=this._cache[e];if(n)n.useCount++,this.debug&&Xe.warn(`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const r=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[e]=n={shader:r,useCount:1},this.debug&&Xe.warn(`${this}: Created new shader ${r.id}`)()}return n.shader}release(t){if(!this.cachingEnabled){t.destroy();return}const e=this._hashShader(t),n=this._cache[e];if(n)if(n.useCount--,n.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[e],n.shader.destroy(),this.debug&&Xe.warn(`${this}: Releasing shader ${t.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${t.id} released too many times`);this.debug&&Xe.warn(`${this}: Releasing shader ${t.id} count=${n.useCount}`)()}}_hashShader(t){return`${t.stage}:${t.source}`}}function cH(i,t){const e={},n="Values";if(i.attributes.length===0&&!i.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const r of i.attributes)if(r){const o=`${r.location} ${r.name}: ${r.type}`;e[`in ${o}`]={[n]:r.stepMode||"vertex"}}for(const r of i.varyings||[]){const o=`${r.location} ${r.name}`;e[`out ${o}`]={[n]:JSON.stringify(r)}}return e}let js=null,L_=null;function hH(i,{id:t,minimap:e,opaque:n,top:r="0",left:o="0",rgbaScale:s=1}){js||(js=document.createElement("canvas"),js.id=t,js.title=t,js.style.zIndex="100",js.style.position="absolute",js.style.top=r,js.style.left=o,js.style.border="blue 5px solid",js.style.transform="scaleY(-1)",document.body.appendChild(js),L_=js.getContext("2d")),(js.width!==i.width||js.height!==i.height)&&(js.width=i.width/2,js.height=i.height/2,js.style.width="400px",js.style.height="400px");const l=i.device.readPixelsToArrayWebGL(i),c=L_?.createImageData(i.width,i.height);if(c){for(let y=0;y<l.length;y+=4)c.data[0+y+0]=l[y+0]*s,c.data[0+y+1]=l[y+1]*s,c.data[0+y+2]=l[y+2]*s,c.data[0+y+3]=n?255:l[y+3]*s;L_?.putImageData(c,0,0)}}function Lb(i,t,e){if(i===t)return!0;if(!e||!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!Lb(i[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const n=Object.keys(i),r=Object.keys(t);if(n.length!==r.length)return!1;for(const o of n)if(!t.hasOwnProperty(o)||!Lb(i[o],t[o],e-1))return!1;return!0}return!1}class D_{bufferLayouts;constructor(t){this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(e=>e.name===t)||null}getAttributeNamesForBuffer(t){return t.attributes?t.attributes?.map(e=>e.attribute):[t.name]}mergeBufferLayouts(t,e){const n=[...t];for(const r of e){const o=n.findIndex(s=>s.name===r.name);o<0?n.push(r):n[o]=r}return n}getBufferIndex(t){const e=this.bufferLayouts.findIndex(n=>n.name===t);return e===-1&&Xe.warn(`BufferLayout: Missing buffer for "${t}".`)(),e}}function fH(i,t){const e=Object.fromEntries(i.attributes.map(r=>[r.name,r.location])),n=t.slice();return n.sort((r,o)=>{const s=r.attributes?r.attributes.map(_=>_.attribute):[r.name],l=o.attributes?o.attributes.map(_=>_.attribute):[o.name],c=Math.min(...s.map(_=>e[_])),y=Math.min(...l.map(_=>e[_]));return c-y}),n}function dH(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function pH(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":!1}function AH(i){return dH(i)||pH(i)}function mH(i){return AH(i)||typeof i=="number"||typeof i=="boolean"}function gH(i){const t={bindings:{},uniforms:{}};return Object.keys(i).forEach(e=>{const n=i[e];mH(n)?t.uniforms[e]=n:t.bindings[e]=n}),t}class yH{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(t,e){Object.assign(this.options,e);const n=ix(Object.values(t).filter(r=>r.dependencies));for(const r of n)t[r.name]=r;Xe.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[r,o]of Object.entries(t))this._addModule(o),o.name&&r!==o.name&&!this.options.disableWarnings&&Xe.warn(`Module name: ${r} vs ${o.name}`)()}destroy(){}setProps(t){for(const e of Object.keys(t)){const n=e,r=t[n]||{},o=this.modules[n];if(!o){this.options.disableWarnings||Xe.warn(`Module ${e} not found`)();continue}const s=this.moduleUniforms[n],l=this.moduleBindings[n],c=o.getUniforms?.(r,s)||r,{uniforms:y,bindings:_}=gH(c);this.moduleUniforms[n]={...s,...y},this.moduleBindings[n]={...l,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const t={};for(const e of Object.values(this.moduleBindings))Object.assign(t,e);return t}getDebugTable(){const t={};for(const[e,n]of Object.entries(this.moduleUniforms))for(const[r,o]of Object.entries(n))t[`${e}.${r}`]={type:this.modules[e].uniformTypes?.[r],value:String(o)};return t}_addModule(t){const e=t.name;this.moduleUniforms[e]=t.defaultUniforms||{},this.moduleBindings[e]={}}}let vH="";async function _H(i,t){const e=new Image;return e.crossOrigin="anonymous",e.src=i.startsWith("http")?i:vH+i,await e.decode(),t?await createImageBitmap(e,t):await createImageBitmap(e)}const bH=["+X","-X","+Y","-Y","+Z","-Z"],xH=["+X","-X","+Y","-Y","+Z","-Z"];class GA{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(t,e){this.device=t;const n=ic("async-texture");this.props={...GA.defaultProps,id:n,...e},this.id=this.props.id,e={...e},typeof e?.data=="string"&&e.dimension==="2d"&&(e.data=_H(e.data)),e.mipmaps&&(e.mipLevels="auto"),this.ready=new Promise((r,o)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=o}),this.initAsync(e)}async initAsync(t){const e=t.data,n=await iL(e).then(void 0,this.rejectReady);if(this.destroyed)return;const r=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!r)throw new Error("Texture size could not be determined");const o={...r,...t,data:void 0,mipLevels:1},s=this.device.getMipLevelCount(o.width,o.height);if(o.mipLevels=this.props.mipLevels==="auto"?s:Math.min(s,this.props.mipLevels),this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,t.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n);break}this.props.mipmaps&&this.generateMipmaps(),Xe.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(t={}){this.texture.setSampler(t instanceof tf?t:this.device.createSampler(t))}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){const e=this.texture;this.texture=e.clone(t),e.destroy()}return!0}isTextureLevelData(t){const e=t?.data;return ArrayBuffer.isView(e)}getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return this.getTextureDataSize(t[0]);if(this.device.isExternalImage(t))return this.device.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const e=Object.values(t)[0];return{width:e.width,height:e.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}setTextureData(t){}_setTexture1DData(t,e){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(t,e=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(t);n.length>1&&this.props.mipmaps!==!1&&Xe.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<n.length;r++){const o=n[r];this.device.isExternalImage(o)?this.texture.copyExternalImage({image:o,depth:e,mipLevel:r,flipY:!0}):this.texture.copyImageData({data:o.data,mipLevel:r})}}_setTexture3DData(t,e){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let n=0;n<e.length;n++)this._setTexture2DData(e[n],n)}_setTextureCubeData(t,e){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[n,r]of Object.entries(e)){const o=xH.indexOf(n);this._setTexture2DData(r,o)}}_setTextureArrayData(t,e){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let n=0;n<e.length;n++)this._setTexture2DData(e[n],n)}_setTextureCubeArrayData(t,e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(t,e,n,r=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&Xe.warn(`${this.id} has mipmap and multiple LODs.`)();const o=bH.indexOf(n);this._setTexture2DData(e,o)}_normalizeTextureData(t){const e=this.texture;let n;return ArrayBuffer.isView(t)?n=[{data:t,width:e.width,height:e.height}]:Array.isArray(t)?n=t:n=[t],n}static defaultProps={...ps.defaultProps,data:null,mipmaps:!1}}async function iL(i){if(i=await i,Array.isArray(i))return await Promise.all(i.map(iL));if(i&&typeof i=="object"&&i.constructor===Object){const t=i,e=await Promise.all(Object.values(t)),n=Object.keys(t),r={};for(let o=0;o<n.length;o++)r[n[o]]=e[o];return r}return i}const Lh=2,wH=1e4;class Rr{static defaultProps={...Kh.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Gh.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(t,e){this.props={...Rr.defaultProps,...e},e=this.props,this.id=e.id||ic("model"),this.device=t,Object.assign(this.userData,e.userData);const n=Object.fromEntries(this.props.modules?.map(l=>[l.name,l])||[]),r=e.shaderInputs||new yH(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const o=CH(t),s=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:l,getUniforms:c}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:s});this.source=l,this._getModuleUniforms=c,this.props.shaderLayout||=X7(this.source)}else{const{vs:l,fs:c,getUniforms:y}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:s});this.vs=l,this.fs=c,this._getModuleUniforms=y}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,e.geometry&&this.setGeometry(e.geometry),this.pipelineFactory=e.pipelineFactory||Fx.getDefaultPipelineFactory(this.device),this.shaderFactory=e.shaderFactory||Nx.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in e&&(this.isInstanced=e.isInstanced),e.instanceCount&&this.setInstanceCount(e.instanceCount),e.vertexCount&&this.setVertexCount(e.vertexCount),e.indexBuffer&&this.setIndexBuffer(e.indexBuffer),e.attributes&&this.setAttributes(e.attributes),e.constantAttributes&&this.setConstantAttributes(e.constantAttributes),e.bindings&&this.setBindings(e.bindings),e.transformFeedback&&(this.transformFeedback=e.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){const e=this._areBindingsLoading();if(e)return Xe.info(Lh,`>>> DRAWING ABORTED ${this.id}: ${e} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let n;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings});const{indexBuffer:o}=this.vertexArray,s=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(t){this._gpuGeometry?.destroy();const e=t&&aH(this.device,t);if(e){this.setTopology(e.topology||"triangle-list");const n=new D_(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(e.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(e)}this._gpuGeometry=e}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){const e=new D_(this.bufferLayout);this.bufferLayout=this._gpuGeometry?e.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){Lb(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new m7(this.shaderInputs.modules);for(const[e,n]of Object.entries(this.shaderInputs.modules))if(EH(n)){const r=this._uniformStore.getManagedUniformBuffer(this.device,e);this.bindings[`${e}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,e){const n=e?.disableWarnings??this.props.disableWarnings;t.indices&&Xe.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=fH(this.pipeline.shaderLayout,this.bufferLayout);const r=new D_(this.bufferLayout);for(const[o,s]of Object.entries(t)){const l=r.getBufferLayout(o);if(!l){n||Xe.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const c=r.getAttributeNamesForBuffer(l);let y=!1;for(const _ of c){const C=this._attributeInfos[_];if(C){const I=this.device.type==="webgpu"?r.getBufferIndex(C.bufferName):C.location;this.vertexArray.setBuffer(I,s),y=!0}}!y&&!n&&Xe.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,e){for(const[n,r]of Object.entries(t)){const o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,r):(e?.disableWarnings??this.props.disableWarnings)||Xe.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const t of Object.values(this.bindings))if(t instanceof GA&&!t.isReady)return t.id;return!1}_getBindings(){const t={};for(const[e,n]of Object.entries(this.bindings))n instanceof GA?n.isReady&&(t[e]=n.texture):t[e]=n;return t}_getBindingsUpdateTimestamp(){let t=0;for(const e of Object.values(this.bindings))e instanceof Py?t=Math.max(t,e.texture.updateTimestamp):e instanceof br||e instanceof ps?t=Math.max(t,e.updateTimestamp):e instanceof GA?t=e.texture?Math.max(t,e.texture.updateTimestamp):1/0:e instanceof tf||(t=Math.max(t,e.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const e={...t.attributes};for(const[n]of Object.entries(e))!this.pipeline.shaderLayout.attributes.find(r=>r.name===n)&&n!=="positions"&&delete e[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(e,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,e=null;this.pipeline&&(Xe.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,e=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=n:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:r}),this._attributeInfos=j6(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),e&&this.shaderFactory.release(e)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const t=Xe.level>3?0:wH;Xe.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,Xe.group(Lh,`>>> DRAWING MODEL ${this.id}`,{collapsed:Xe.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=cH(this.pipeline.shaderLayout,this.id);Xe.table(Lh,t)();const e=this.shaderInputs.getDebugTable();Xe.table(Lh,e)();const n=this._getAttributeDebugTable();Xe.table(Lh,this._attributeInfos)(),Xe.table(Lh,n)(),Xe.groupEnd(Lh)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){const e=this.device.props.debugFramebuffers;if(this._drawCount++,!e)return;const n=t.props.framebuffer;n&&hH(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[e,n]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[n.location];t[n.location]={name:e,type:n.shaderType,values:r?this._getBufferOrConstantValues(r,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:e}=this.vertexArray,n=e.indexType==="uint32"?new Uint32Array(e.debugData):new Uint16Array(e.debugData);t.indices={name:"indices",type:e.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,e){const n=rx(e);return(t instanceof br?new n(t.debugData):t).toString()}}function EH(i){return!!(i.uniformTypes&&!TH(i.uniformTypes))}function CH(i){return{type:i.type,shaderLanguage:i.info.shadingLanguage,shaderLanguageVersion:i.info.shadingLanguageVersion,gpu:i.info.gpu,features:i.features}}function TH(i){for(const t in i)return!1;return!0}class rf{device;model;transformFeedback;static defaultProps={...Rr.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(t){return t?.info?.type==="webgl"}constructor(t,e=rf.defaultProps){if(!rf.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Rr(this.device,{id:e.id||"buffer-transform-model",fs:e.fs||F6(),topology:e.topology||"point-list",varyings:e.outputs||e.varyings,...e}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:e.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t?.inputBuffers&&this.model.setAttributes(t.inputBuffers),t?.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);const e=this.device.beginRenderPass(t);this.model.draw(e),e.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const e=this.getBuffer(t);if(!e)throw new Error("BufferTransform#getBuffer");if(e instanceof br)return e.readAsync();const{buffer:n,byteOffset:r=0,byteLength:o=n.byteLength}=e;return n.readAsync(r,o)}}const SH="transform_output";class OT{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(t,e){this.device=t,this.sampler=t.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Rr(this.device,{id:e.id||ic("texture-transform-model"),fs:e.fs||F6({input:e.targetTextureVarying,inputChannels:e.targetTextureChannels,output:SH}),vertexCount:e.vertexCount,...e}),this._initialize(e),Object.seal(this)}destroy(){this.model.destroy();for(const t of this.bindings)t.framebuffer?.destroy()}delete(){this.destroy()}run(t){const{framebuffer:e}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:e,...t});this.model.draw(n),n.end(),this.device.submit()}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(t){this._updateBindings(t)}_updateBindings(t){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t)}_updateBinding(t,{sourceBuffers:e,sourceTextures:n,targetTexture:r}){if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,e),r){t.targetTexture=r;const{width:o,height:s}=r;t.framebuffer&&t.framebuffer.destroy(),t.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:s,colorAttachments:[r]}),t.framebuffer.resize({width:o,height:s})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const n in e)e[n].sampler=this.sampler}}class no{id;topology;vertexCount;indices;attributes;userData={};constructor(t){const{attributes:e={},indices:n=null,vertexCount:r=null}=t;this.id=t.id||ic("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[o,s]of Object.entries(e)){const l=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!l.size&&(l.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[o]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,e){return this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const r of Object.values(t)){const{value:o,size:s,constant:l}=r;!l&&o&&s!==void 0&&s>=1&&(n=Math.min(n,o.length/s))}return n}}const PH=`struct VertexInputs {
  @location(0) clipSpacePosition: vec2<f32>,
  @location(1) texCoord: vec2<f32>,
  @location(2) coordinate: vec2<f32>  
}

struct FragmentInputs {
  @builtin(position) Position : vec4<f32>,
  @location(0) position : vec2<f32>,
  @location(1) coordinate : vec2<f32>,
  @location(2) uv : vec2<f32>
};

@vertex
fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
  var outputs: FragmentInputs;
  outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
  outputs.position = inputs.clipSpacePosition;
  outputs.coordinate = inputs.coordinate;
  outputs.uv = inputs.texCoord;
  return outputs;
}
`,IH=`#version 300 es
in vec2 clipSpacePositions;
in vec2 texCoords;
in vec2 coordinates;

out vec2 position;
out vec2 coordinate;
out vec2 uv;

void main(void) {
  gl_Position = vec4(clipSpacePositions, 0., 1.);
  position = clipSpacePositions;
  coordinate = coordinates;
  uv = texCoords;
}
`,FT=[-1,-1,1,-1,-1,1,1,1];class MH extends Rr{constructor(t,e){const n=FT.map(r=>r===-1?0:r);e.source&&(e={...e,source:`${PH}
${e.source}`}),super(t,{id:e.id||ic("clip-space"),...e,vs:IH,vertexCount:4,geometry:new no({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(FT)},texCoords:{size:2,value:new Float32Array(n)},coordinates:{size:2,value:new Float32Array(n)}}})})}}class $g{id;matrix=new bn;display=!0;position=new ve;rotation=new ve;scale=new ve(1,1,1);userData={};props={};constructor(t={}){const{id:e}=t;this.id=e||ic(this.constructor.name),this._setScenegraphNodeProps(t)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(t){return this.position=t,this}setRotation(t){return this.rotation=t,this}setScale(t){return this.scale=t,this}setMatrix(t,e=!0){e?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){const{position:e,rotation:n,scale:r,update:o=!0}=t;return e&&this.setPosition(e),n&&this.setRotation(n),r&&this.setScale(r),o&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}update(t={}){const{position:e,rotation:n,scale:r}=t;return e&&this.setPosition(e),n&&this.setRotation(n),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(t,e){e=e||this.matrix;const n=new bn(t).multiplyRight(e),r=n.invert(),o=r.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:r,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(t){"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class Dp extends $g{children;constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;Xe.assert(e.every(n=>n instanceof $g),"every child must an instance of ScenegraphNode"),super(t),this.children=e}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((e,{worldMatrix:n})=>{const r=e.getBounds();if(!r)return;const[o,s]=r,l=new ve(o).add(s).divide([2,2,2]);n.transformAsPoint(l,l);const c=new ve(s).subtract(o).divide([2,2,2]);n.transformAsVector(c,c);for(let y=0;y<8;y++){const _=new ve(y&1?-1:1,y&2?-1:1,y&4?-1:1).multiply(c).add(l);for(let C=0;C<3;C++)t[0][C]=Math.min(t[0][C],_[C]),t[1][C]=Math.max(t[1][C],_[C])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const e of t)Array.isArray(e)?this.add(...e):this.children.push(e);return this}remove(t){const e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:e=new bn}={}){const n=new bn(e).multiplyRight(this.matrix);for(const r of this.children)r instanceof Dp?r.traverse(t,{worldMatrix:n}):t(r,{worldMatrix:n})}}class Db extends $g{model;bounds=null;managedResources;constructor(t){super(t),this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}class nL extends no{constructor(t={}){const{id:e=ic("cube-geometry"),indices:n=!0}=t;super(n?{...t,id:e,topology:"triangle-list",indices:{size:1,value:BH},attributes:{...NH,...t.attributes}}:{...t,id:e,topology:"triangle-list",indices:void 0,attributes:{...zH,...t.attributes}})}}const BH=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),RH=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),LH=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),DH=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),kH=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),OH=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),FH=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),NH={POSITION:{size:3,value:RH},NORMAL:{size:3,value:LH},TEXCOORD_0:{size:2,value:DH}},zH={POSITION:{size:3,value:kH},TEXCOORD_0:{size:2,value:OH},COLOR_0:{size:3,value:FH}},UH=`uniform screenUniforms {
  vec2 texSize;
} screen;
`,VH={name:"screen",fs:UH,uniformTypes:{texSize:"vec2<f32>"}};class GH extends QR{constructor(t,e){super(t,e);const{module:n,fs:r,id:o}=e,s={depthWriteEnabled:!1,depthCompare:"always",depthBias:0,blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"};this.model=new MH(t,{id:o,fs:r,modules:[n,VH],parameters:s})}render(t){this._renderPass(this.device,t)}delete(){this.model.destroy(),this.model=null}_renderPass(t,e){const{clearCanvas:n,inputBuffer:r,outputBuffer:o}=e,s=[r.width,r.height],l={texSrc:r.colorAttachments[0],texSize:s};this.model.shaderInputs.setProps({screen:l,...e.moduleProps});const c=this.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,...s]},clearColor:n?[0,0,0,0]:!1,clearDepth:1,clearStencil:!1});this.model.draw(c),c.end()}}class jH{constructor(t,e){this.id=`${t.name}-pass`,this.props=e,P6(t),this.module=t}setup({device:t}){this.passes=WH(t,this.module,this.id)}setProps(t){this.props=t}preRender(){}postRender(t){const e=this.passes,{target:n}=t;let r=t.inputBuffer,o=t.swapBuffer;for(let s=0;s<e.length;s++){const l=s===e.length-1,c=n!==void 0&&l;c&&(o=n);const y=!c||!!t.clearCanvas,_={},C=this.module.passes[s].uniforms;_[this.module.name]={...this.props,...C},e[s].render({clearCanvas:y,inputBuffer:r,outputBuffer:o,moduleProps:_});const I=o;o=r,r=I}return r}cleanup(){if(this.passes){for(const t of this.passes)t.delete();this.passes=void 0}}}function WH(i,t,e){return t.passes.map((n,r)=>{const o=qH(t,n),s=`${e}-${r}`;return new GH(i,{id:s,module:t,fs:o})})}const rL=`#version 300 es
uniform sampler2D texSrc;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,HH=i=>`${rL}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${i}(fragColor, screen.texSize, coordinate);
}
`,XH=i=>`${rL}
void main() {
  fragColor = ${i}(texSrc, screen.texSize, coordinate);
}
`;function qH(i,t){if(t.filter){const e=typeof t.filter=="string"?t.filter:`${i.name}_filterColor_ext`;return HH(e)}if(t.sampler){const e=typeof t.sampler=="string"?t.sampler:`${i.name}_sampleColor`;return XH(e)}return""}const KH={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class sL extends Dy{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:e,views:n,viewports:r,onViewportActive:o,pickingFBO:s,deviceRect:{x:l,y:c,width:y,height:_},cullRect:C,effects:I,pass:k="picking",pickZ:z,shaderModuleProps:V}){this.pickZ=z;const X=this._resetColorEncoder(z),H=[l,c,y,_],$=super.render({target:s,layers:t,layerFilter:e,views:n,viewports:r,onViewportActive:o,cullRect:C,effects:I?.filter(Y=>Y.useInPicking),pass:k,isPicking:!0,shaderModuleProps:V,clearColor:[0,0,0,0],colorMask:15,scissorRect:H});return this._colorEncoderState=null,{decodePickingColor:X&&YH.bind(null,X),stats:$}}shouldDrawLayer(t){const{pickable:e,operation:n}=t.props;return e&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(t,e,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,e,n){const r={...t.props.parameters},{pickable:o,operation:s}=t.props;return!this._colorEncoderState||s.includes("terrain")?r.blend=!1:o&&s.includes("draw")&&(Object.assign(r,KH),r.blend=!0,r.blendColor=ZH(this._colorEncoderState,t,n)),r}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function ZH(i,t,e){const{byLayer:n,byAlpha:r}=i;let o,s=n.get(t);return s?(s.viewports.push(e),o=s.a):(o=n.size+1,o<=255?(s={a:o,layer:t,viewports:[e]},n.set(t,s),r[o]=s):($i.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function YH(i,t){const e=i.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const Gd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},ty=Symbol.for("component"),qc=Symbol.for("propTypes"),k_=Symbol.for("deprecatedProps"),op=Symbol.for("asyncPropDefaults"),sf=Symbol.for("asyncPropOriginal"),jc=Symbol.for("asyncPropResolved");function ky(i,t=()=>!0){return Array.isArray(i)?oL(i,t,[]):t(i)?[i]:[]}function oL(i,t,e){let n=-1;for(;++n<i.length;){const r=i[n];Array.isArray(r)?oL(r,t,e):t(r)&&e.push(r)}return e}function QH({target:i,source:t,start:e=0,count:n=1}){const r=t.length,o=n*r;let s=0;for(let l=e;s<r;s++)i[l++]=t[s];for(;s<o;)s<o-s?(i.copyWithin(e+s,e,e+s),s*=2):(i.copyWithin(e+s,e,e+o-s),s=o);return i}class JH{constructor(t,e,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let r=t;typeof t=="string"&&(r=Qu(t)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const o of this._subscribers)o.onChange(this.getData())}}class $H{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:e,forceUpdate:n=!1,persistent:r=!0}){let o=this._resources[t];o?o.setData(e,n):(o=new JH(t,e,this._context),this._resources[t]=o),o.persistent=r}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const n in e){const r=e[n],o=this._resources[r.resourceId];o&&o.unsubscribe(r)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:n,requestId:r="default"}){const{_resources:o,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),o[t]||this.add({resourceId:t,data:null,persistent:!1}));const l=o[t];if(this._track(n,r,l,e),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,r){const o=this._consumers,s=o[t]=o[t]||{};let l=s[e];const c=l&&l.resourceId&&this._resources[l.resourceId];c&&(c.unsubscribe(l),this.prune()),n&&(l?(l.onChange=r,l.resourceId=n.id):l={onChange:r,resourceId:n.id},s[e]=l,n.subscribe(l))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const tX="layerManager.setLayers",eX="layerManager.activateViewport";class iX{constructor(t,e){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=l=>{mo(eX,this,l),l&&(this.context.viewport=l)};const{deck:n,stats:r,viewport:o,timeline:s}=e||{};this.layers=[],this.resourceManager=new $H({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:RW(t?.info?.shadingLanguage||"glsl"),defaultShaderModules:[VG],renderPass:void 0,stats:r||new Bp({id:"deck.gl"}),viewport:o||new ec({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new eL,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const r=n.getNeedsRedraw(t);e=e||r}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(e=>t.find(n=>e.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){mo(tX,this,e,t),this._lastRenderedLayers=t;const n=ky(t,Boolean);for(const r of n)r.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:e}=this.context;e.find(n=>n.name===t.name)||(e.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:e}=this.context,n=e.findIndex(r=>r.name===t.name);n>=0&&(e.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,e,n){n.raiseError(e,`${t} of ${n}`)}_updateLayers(t,e){const n={};for(const s of t)n[s.id]?$i.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(const s of t)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(e,n,r),this._finalizeOldLayers(n);let o=!1;for(const s of r)if(s.hasUniformTransition()){o=`Uniform transition in ${s}`;break}this._needsUpdate=o,this.layers=r}_updateSublayersRecursively(t,e,n){for(const r of t){r.context=this.context;const o=e[r.id];o===null&&$i.warn(`Multiple new layers with same id ${r.id}`)(),e[r.id]=null;let s=null;try{this._debug&&o!==r&&r.validateProps(),o?(this._transferLayerState(o,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),s=r.isComposite?r.getSubLayers():null}catch(l){this._handleError("matching",l,r)}s&&this._updateSublayersRecursively(s,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Gd.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=Gd.MATCHED,e!==t&&(t.lifecycle=Gd.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=Gd.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Gd.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function Or(i,t,e){if(i===t)return!0;if(!e||!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!Or(i[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const n=Object.keys(i),r=Object.keys(t);if(n.length!==r.length)return!1;for(const o of n)if(!t.hasOwnProperty(o)||!Or(i[o],t[o],e-1))return!1;return!0}return!1}class nX{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),r={x:t[0],y:t[1]};for(let o=n.length-1;o>=0;--o){const s=n[o];if(s.containsPixel(r)){const l=t.slice();return l[0]-=s.x,l[1]-=s.y,s.unproject(l,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=ky(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Or(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):$i.warn("missing `viewState` or `initialViewState`")()}_createController(t,e){const n=e.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>this.getView(t.id)?.makeViewport({viewState:r,width:this.width,height:this.height})})}_updateController(t,e,n,r){const o=t.controller;if(o&&n){const s={...e,...o,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!r||r.constructor!==o.type)&&(r=this._createController(t,s)),r&&r.setProps(s),r}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let r=t.length;r--;){const o=t[r],s=this.getViewState(o),l=o.makeViewport({viewState:s,width:this.width,height:this.height});let c=e[o.id];const y=!!o.controller;y&&!c&&(n=!0),(n||!y)&&c&&(c.finalize(),c=null),this.controllers[o.id]=this._updateController(o,s,l,c),l&&this._viewports.unshift(l)}for(const r in e){const o=e[r];o&&!this.controllers[r]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((n,r)=>!t[r].equals(e[r]))}}const rX=/([0-9]+\.?[0-9]*)(%|px)/;function Dc(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const t=rX.exec(i);if(t&&t.length>=3){const e=t[2]==="%",n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${i}`)}}function kc(i,t){return i.relative?Math.round(i.position*t):i.position}class vp{constructor(t){const{id:e,x:n=0,y:r=0,width:o="100%",height:s="100%",padding:l=null}=t;this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Dc(n),this._y=Dc(r),this._width=Dc(o),this._height=Dc(s),this._padding=l&&{left:Dc(l.left||0),right:Dc(l.right||0),top:Dc(l.top||0),bottom:Dc(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&Or(this.props,t.props,2)}clone(t){const e=this.constructor;return new e({...this.props,...t})}makeViewport({width:t,height:e,viewState:n}){n=this.filterViewState(n);const r=this.getDimensions({width:t,height:e});if(!r.height||!r.width)return null;const o=this.getViewportType(n);return new o({...n,...this.props,...r})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const n in this.props.viewState)n!=="id"&&(e[n]=this.props.viewState[n]);return e}return t}getDimensions({width:t,height:e}){const n={x:kc(this._x,t),y:kc(this._y,e),width:kc(this._width,t),height:kc(this._height,e)};return this._padding&&(n.padding={left:kc(this._padding.left,t),top:kc(this._padding.top,e),right:kc(this._padding.right,t),bottom:kc(this._padding.bottom,e)}),n}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class Oy{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:t,settings:e}=this;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const NT=()=>{},kb={BREAK:1,SNAP_TO_END:2,IGNORE:3},sX=i=>i,oX=kb.BREAK;let aX=class{constructor(i){this._onTransitionUpdate=t=>{const{time:e,settings:{interpolator:n,startProps:r,endProps:o,duration:s,easing:l}}=t,c=l(e/s),y=n.interpolateProps(r,o,c);this.propsInTransition=this.getControllerState({...this.props,...y}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=i.getControllerState,this.propsInTransition=null,this.transition=new Oy(i.timeline),this.onViewStateChange=i.onViewStateChange||NT,this.onStateChange=i.onStateChange||NT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(i){let t=!1;const e=this.props;if(this.props=i,!e||this._shouldIgnoreViewportChange(e,i))return!1;if(this._isTransitionEnabled(i)){let n=e;if(this.transition.inProgress){const{interruption:r,endProps:o}=this.transition.settings;n={...e,...r===kb.SNAP_TO_END?o:this.propsInTransition||e}}this._triggerTransition(n,i),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(i){const{transitionDuration:t,transitionInterpolator:e}=i;return(t>0||t==="auto")&&!!e}_isUpdateDueToCurrentTransition(i){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(i,this.propsInTransition):!1}_shouldIgnoreViewportChange(i,t){return this.transition.inProgress?this.transition.settings.interruption===kb.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(i,t):!0}_triggerTransition(i,t){const e=this.getControllerState(i),n=this.getControllerState(t).shortestPathFrom(e),r=t.transitionInterpolator,o=r.getDuration?r.getDuration(i,t):t.transitionDuration;if(o===0)return;const s=r.initializeProps(i,n);this.propsInTransition={};const l={duration:o,easing:t.transitionEasing||sX,interpolator:r,interruption:t.transitionInterruption||oX,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(i){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),i?.(t)}}};function eo(i,t){if(!i)throw new Error(t||"deck.gl: assertion failed.")}let lX=class{constructor(i){const{compare:t,extract:e,required:n}=i;this._propsToCompare=t,this._propsToExtract=e||t,this._requiredProps=n}arePropsEqual(i,t){for(const e of this._propsToCompare)if(!(e in i)||!(e in t)||!Aa(i[e],t[e]))return!1;return!0}initializeProps(i,t){const e={},n={};for(const r of this._propsToExtract)(r in i||r in t)&&(e[r]=i[r],n[r]=t[r]);return this._checkRequiredProps(e),this._checkRequiredProps(n),{start:e,end:n}}getDuration(i,t){return t.transitionDuration}_checkRequiredProps(i){this._requiredProps&&this._requiredProps.forEach(t=>{const e=i[t];eo(Number.isFinite(e)||Array.isArray(e),`${t} is required for transition`)})}};const uX=["longitude","latitude","zoom","bearing","pitch"],cX=["longitude","latitude","zoom"];let aL=class extends lX{constructor(i={}){const t=Array.isArray(i)?i:i.transitionProps,e=Array.isArray(i)?{}:i;e.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:uX,required:cX},super(e.transitionProps),this.opts=e}initializeProps(i,t){const e=super.initializeProps(i,t),{makeViewport:n,around:r}=this.opts;if(n&&r){const o=n(i),s=n(t),l=o.unproject(r);e.start.around=r,Object.assign(e.end,{around:s.project(l),aroundPosition:l,width:t.width,height:t.height})}return e}interpolateProps(i,t,e){const n={};for(const r of this._propsToExtract)n[r]=gl(i[r]||0,t[r]||0,e);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...n});Object.assign(n,r.panByPosition(t.aroundPosition,gl(i.around,t.around,e)))}return n}};const Nu={transitionDuration:0},hX=300,w0=i=>1-(1-i)*(1-i),_d={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Dh={};class fX{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new aX({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return e?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:n}=this.props,{offsetCenter:r}=t;return[r.x-e,r.y-n]}isPointInBounds(t,e){const{width:n,height:r}=this.props;if(e&&e.handled)return!1;const o=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=r;return o&&e&&e.stopPropagation(),o}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?hX:0;const{scrollZoom:n=!0,dragPan:r=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:l=!0,touchRotate:c=!1,keyboard:y=!0}=t,_=!!this.onViewStateChange;this.toggleEvents(_d.WHEEL,_&&n),this.toggleEvents(_d.PAN,_),this.toggleEvents(_d.PINCH,_&&(l||c)),this.toggleEvents(_d.MULTI_PAN,_&&c),this.toggleEvents(_d.DOUBLE_CLICK,_&&s),this.toggleEvents(_d.KEYBOARD,_&&y),this.scrollZoom=n,this.dragPan=r,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=l,this.touchRotate=c,this.keyboard=y}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(n=>{this._events[n]!==e&&(this._events[n]=e,e?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,e=null,n={}){const r={...t.getViewportProps(),...e},o=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),o){const s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const r=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(r,Nu,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,Nu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),r=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],o=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:w0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,Nu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),r=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],o=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:w0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=t;let s=2/(1+Math.exp(-Math.abs(o*n)));o<0&&s!==0&&(s=1/s);const l=r?{...this._getTransitionProps({around:e}),transitionDuration:250}:Nu,c=this.controllerState.zoom({pos:e,scale:s});return this.updateViewport(c,l,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,Nu,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,Nu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),r=[n[0],n[1]+=t.velocityY*e/2],o=this.controllerState.rotate({pos:r});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:w0},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return Dh._startPinchRotation=t.rotation,Dh._lastPinchEvent=t,this.updateViewport(n,Nu,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,r=this.getCenter(t);e=e.zoom({pos:r,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:Dh._startPinchRotation-n})}return this.updateViewport(e,Nu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Dh._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:n}=Dh;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const r=this.getCenter(t);let o=this.controllerState.rotateEnd();const s=Math.log2(t.scale),l=(s-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),c=Math.pow(2,s+l*e/2);o=o.zoom({pos:r,scale:c}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:r}),transitionDuration:e,transitionEasing:w0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Dh._startPinchRotation=null,Dh._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),r=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(r,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:r,rotateSpeedX:o,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let c;const y={};switch(t.srcEvent.code){case"Minus":c=e?l.zoomOut(n).zoomOut(n):l.zoomOut(n),y.isZooming=!0;break;case"Equal":c=e?l.zoomIn(n).zoomIn(n):l.zoomIn(n),y.isZooming=!0;break;case"ArrowLeft":e?(c=l.rotateLeft(o),y.isRotating=!0):(c=l.moveLeft(r),y.isPanning=!0);break;case"ArrowRight":e?(c=l.rotateRight(o),y.isRotating=!0):(c=l.moveRight(r),y.isPanning=!0);break;case"ArrowUp":e?(c=l.rotateUp(s),y.isRotating=!0):(c=l.moveUp(r),y.isPanning=!0);break;case"ArrowDown":e?(c=l.rotateDown(s),y.isRotating=!0):(c=l.moveDown(r),y.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),y),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?Nu:t?{...e,transitionInterpolator:new aL({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class dX{constructor(t,e){this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const zT=5,pX=1.2;let AX=class extends dX{constructor(i){const{width:t,height:e,latitude:n,longitude:r,zoom:o,bearing:s=0,pitch:l=0,altitude:c=1.5,position:y=[0,0,0],maxZoom:_=20,minZoom:C=0,maxPitch:I=60,minPitch:k=0,startPanLngLat:z,startZoomLngLat:V,startRotatePos:X,startBearing:H,startPitch:$,startZoom:Y,normalize:ct=!0}=i;eo(Number.isFinite(r)),eo(Number.isFinite(n)),eo(Number.isFinite(o)),super({width:t,height:e,latitude:n,longitude:r,zoom:o,bearing:s,pitch:l,altitude:c,maxZoom:_,minZoom:C,maxPitch:I,minPitch:k,normalize:ct,position:y},{startPanLngLat:z,startZoomLngLat:V,startRotatePos:X,startBearing:H,startPitch:$,startZoom:Y}),this.makeViewport=i.makeViewport}panStart({pos:i}){return this._getUpdatedState({startPanLngLat:this._unproject(i)})}pan({pos:i,startPos:t}){const e=this.getState().startPanLngLat||this._unproject(t);if(!e)return this;const n=this.makeViewport(this.getViewportProps()).panByPosition(e,i);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:i}){return this._getUpdatedState({startRotatePos:i,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:i,deltaAngleX:t=0,deltaAngleY:e=0}){const{startRotatePos:n,startBearing:r,startPitch:o}=this.getState();if(!n||r===void 0||o===void 0)return this;let s;return i?s=this._getNewRotation(i,n,o,r):s={bearing:r+t,pitch:o+e},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:i}){return this._getUpdatedState({startZoomLngLat:this._unproject(i),startZoom:this.getViewportProps().zoom})}zoom({pos:i,startPos:t,scale:e}){let{startZoom:n,startZoomLngLat:r}=this.getState();if(r||(n=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(i)),!r)return this;const{maxZoom:o,minZoom:s}=this.getViewportProps();let l=n+Math.log2(e);l=Xu(l,s,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(r,i)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(i=2){return this._zoomFromCenter(i)}zoomOut(i=2){return this._zoomFromCenter(1/i)}moveLeft(i=100){return this._panFromCenter([i,0])}moveRight(i=100){return this._panFromCenter([-i,0])}moveUp(i=100){return this._panFromCenter([0,i])}moveDown(i=100){return this._panFromCenter([0,-i])}rotateLeft(i=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-i})}rotateRight(i=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+i})}rotateUp(i=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+i})}rotateDown(i=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-i})}shortestPathFrom(i){const t=i.getViewportProps(),e={...this.getViewportProps()},{bearing:n,longitude:r}=e;return Math.abs(n-t.bearing)>180&&(e.bearing=n<0?n+360:n-360),Math.abs(r-t.longitude)>180&&(e.longitude=r<0?r+360:r-360),e}applyConstraints(i){const{maxZoom:t,minZoom:e,zoom:n}=i;i.zoom=Xu(n,e,t);const{maxPitch:r,minPitch:o,pitch:s}=i;i.pitch=Xu(s,o,r);const{normalize:l=!0}=i;return l&&Object.assign(i,mW(i)),i}_zoomFromCenter(i){const{width:t,height:e}=this.getViewportProps();return this.zoom({pos:[t/2,e/2],scale:i})}_panFromCenter(i){const{width:t,height:e}=this.getViewportProps();return this.pan({startPos:[t/2,e/2],pos:[t/2+i[0],e/2+i[1]]})}_getUpdatedState(i){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...i})}_unproject(i){const t=this.makeViewport(this.getViewportProps());return i&&t.unproject(i)}_getNewRotation(i,t,e,n){const r=i[0]-t[0],o=i[1]-t[1],s=i[1],l=t[1],{width:c,height:y}=this.getViewportProps(),_=r/c;let C=0;o>0?Math.abs(y-l)>zT&&(C=o/(l-y)*pX):o<0&&l>zT&&(C=1-s/l),C=Xu(C,-1,1);const{minPitch:I,maxPitch:k}=this.getViewportProps(),z=n+180*_;let V=e;return C>0?V=e+C*(k-e):C<0&&(V=e-C*(I-e)),{pitch:V,bearing:z}}},mX=class extends fX{constructor(){super(...arguments),this.ControllerState=AX,this.transition={transitionDuration:300,transitionInterpolator:new aL({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(i){i.position=i.position||[0,0,0];const t=this.props;super.setProps(i),(!t||t.height!==i.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...i,...this.state}))}};class lL extends vp{constructor(t={}){super(t)}getViewportType(){return rm}get ControllerType(){return mX}}lL.displayName="MapView";const gX=new $R;function yX(i,t){const e=i.order??1/0,n=t.order??1/0;return e-n}class vX{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(n=>n.id===t.id)){const n=e.findIndex(r=>yX(r,t)>0);n<0?e.push(t):e.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Or(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const r of this.effects)e[r.id]=r;const n=[];for(const r of t){const o=e[r.id];let s=r;o&&o!==r?o.setProps?(o.setProps(r.props),s=o):o.cleanup(this._context):o||r.setup(this._context),n.push(s),delete e[r.id]}for(const r in e)e[r].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(r=>r instanceof $R)||this._resolvedEffects.push(gX),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class _X extends Dy{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const bX="deckRenderer.renderLayers";class xX{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new _X(t),this.pickLayersPass=new sL(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);const r=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const o=e.render({...n,target:r});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=t.clearCanvas===void 0?!0:t.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,mo(bX,this,o,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const n of t)e.preRenderStats[n.id]=n.preRender(e),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,e=this.device.canvasContext.getDrawingBufferSize(),[n,r]=e;t.length===0&&[0,1].map(o=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:r});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${o}`,colorAttachments:[s]}))});for(const o of t)o.resize(e)}_postRender(t,e){const{renderBuffers:n}=this,r={...e,inputBuffer:n[0],swapBuffer:n[1]};for(const o of t)if(o.postRender){r.target=o.id===this.lastPostProcessEffect?e.target:void 0;const s=o.postRender(r);r.inputBuffer=s,r.swapBuffer=s===n[0]?n[1]:n[0]}}}const wX={pickedColor:null,pickedObjectIndex:-1};function UT({pickedColors:i,decodePickingColor:t,deviceX:e,deviceY:n,deviceRadius:r,deviceRect:o}){const{x:s,y:l,width:c,height:y}=o;let _=r*r,C=-1,I=0;for(let k=0;k<y;k++){const z=k+l-n,V=z*z;if(V>_)I+=4*c;else for(let X=0;X<c;X++){if(i[I+3]-1>=0){const H=X+s-e,$=H*H+V;$<=_&&(_=$,C=I)}I+=4}}if(C>=0){const k=i.slice(C,C+4),z=t(k);if(z){const V=Math.floor(C/4/c),X=C/4-V*c;return{...z,pickedColor:k,pickedX:s+X,pickedY:l+V}}$i.error("Picked non-existent layer. Is picking buffer corrupt?")()}return wX}function VT({pickedColors:i,decodePickingColor:t}){const e=new Map;if(i){for(let n=0;n<i.length;n+=4)if(i[n+3]-1>=0){const r=i.slice(n,n+4),o=r.join(",");if(!e.has(o)){const s=t(r);s?e.set(o,{...s,color:r}):$i.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(e.values())}function Ob({pickInfo:i,viewports:t,pixelRatio:e,x:n,y:r,z:o}){let s=t[0];t.length>1&&(s=EX(i?.pickedViewports||t,{x:n,y:r}));let l;if(s){const c=[n-s.x,r-s.y];o!==void 0&&(c[2]=o),l=s.unproject(c)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:r,pixel:[n,r],coordinate:l,devicePixel:i&&"pickedX"in i?[i.pickedX,i.pickedY]:void 0,pixelRatio:e}}function GT(i){const{pickInfo:t,lastPickedInfo:e,mode:n,layers:r}=i,{pickedColor:o,pickedLayer:s,pickedObjectIndex:l}=t,c=s?[s]:[];if(n==="hover"){const C=e.index,I=e.layerId,k=s?s.props.id:null;if(k!==I||l!==C){if(k!==I){const z=r.find(V=>V.props.id===I);z&&c.unshift(z)}e.layerId=k,e.index=l,e.info=null}}const y=Ob(i),_=new Map;return _.set(null,y),c.forEach(C=>{let I={...y};C===s&&(I.color=o,I.index=l,I.picked=!0),I=Fb({layer:C,info:I,mode:n});const k=I.layer;C===s&&n==="hover"&&(e.info=I),_.set(k.id,I),n==="hover"&&k.updateAutoHighlight(I)}),_}function Fb({layer:i,info:t,mode:e}){for(;i&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=i,t=i.getPickingInfo({info:t,mode:e,sourceLayer:n}),i=i.parent}return t}function EX(i,t){for(let e=i.length-1;e>=0;e--){const n=i[e];if(n.containsPixel(t))return n}return i[0]}class CX{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new sL(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(t){return this._pickClosestObjectAsync(t)}pickObjectsAsync(t){return this._pickVisibleObjectsAsync(t)}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:n,viewports:r},o=this.lastPickedInfo.info){const s=o&&o.layer&&o.layer.id,l=o&&o.viewport&&o.viewport.id,c=s?n.find(C=>C.id===s):null,y=l&&r.find(C=>C.id===l)||r[0],_=y&&y.unproject([t-y.x,e-y.y]);return{...o,x:t,y:e,viewport:y,coordinate:_,layer:c}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:t}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:t.width,height:t.height}),this.depthFBO?.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return e.length?e:null}async _pickClosestObjectAsync({layers:t,views:e,viewports:n,x:r,y:o,radius:s=0,depth:l=1,mode:c="query",unproject3D:y,onViewportActive:_,effects:C}){const I=this.device.canvasContext.cssToDeviceRatio(),k=this._getPickable(t);if(!k||n.length===0)return{result:[],emptyInfo:Ob({viewports:n,x:r,y:o,pixelRatio:I})};this._resizeBuffer();const z=this.device.canvasContext.cssToDevicePixels([r,o],!0),V=[z.x+Math.floor(z.width/2),z.y+Math.floor(z.height/2)],X=Math.round(s*I),{width:H,height:$}=this.pickingFBO,Y=this._getPickingRect({deviceX:V[0],deviceY:V[1],deviceRadius:X,deviceWidth:H,deviceHeight:$}),ct={x:r-s,y:o-s,width:s*2+1,height:s*2+1};let rt;const nt=[],Ot=new Set;for(let Kt=0;Kt<l;Kt++){let ft;if(Y){const Ut=this._drawAndSample({layers:k,views:e,viewports:n,onViewportActive:_,deviceRect:Y,cullRect:ct,effects:C,pass:`picking:${c}`});ft=UT({...Ut,deviceX:V[0],deviceY:V[1],deviceRadius:X,deviceRect:Y})}else ft={pickedColor:null,pickedObjectIndex:-1};let st;if(ft.pickedLayer&&y&&this.depthFBO){const{pickedColors:Ut}=this._drawAndSample({layers:[ft.pickedLayer],views:e,viewports:n,onViewportActive:_,deviceRect:{x:ft.pickedX,y:ft.pickedY,width:1,height:1},cullRect:ct,effects:C,pass:`picking:${c}:z`},!0);Ut[3]&&(st=Ut[0])}ft.pickedLayer&&Kt+1<l&&(Ot.add(ft.pickedLayer),ft.pickedLayer.disablePickingIndex(ft.pickedObjectIndex)),rt=GT({pickInfo:ft,lastPickedInfo:this.lastPickedInfo,mode:c,layers:k,viewports:n,x:r,y:o,z:st,pixelRatio:I});for(const Ut of rt.values())Ut.layer&&nt.push(Ut);if(!ft.pickedColor)break}for(const Kt of Ot)Kt.restorePickingColors();return{result:nt,emptyInfo:rt.get(null)}}_pickClosestObject({layers:t,views:e,viewports:n,x:r,y:o,radius:s=0,depth:l=1,mode:c="query",unproject3D:y,onViewportActive:_,effects:C}){const I=this.device.canvasContext.cssToDeviceRatio(),k=this._getPickable(t);if(!k||n.length===0)return{result:[],emptyInfo:Ob({viewports:n,x:r,y:o,pixelRatio:I})};this._resizeBuffer();const z=this.device.canvasContext.cssToDevicePixels([r,o],!0),V=[z.x+Math.floor(z.width/2),z.y+Math.floor(z.height/2)],X=Math.round(s*I),{width:H,height:$}=this.pickingFBO,Y=this._getPickingRect({deviceX:V[0],deviceY:V[1],deviceRadius:X,deviceWidth:H,deviceHeight:$}),ct={x:r-s,y:o-s,width:s*2+1,height:s*2+1};let rt;const nt=[],Ot=new Set;for(let Kt=0;Kt<l;Kt++){let ft;if(Y){const Ut=this._drawAndSample({layers:k,views:e,viewports:n,onViewportActive:_,deviceRect:Y,cullRect:ct,effects:C,pass:`picking:${c}`});ft=UT({...Ut,deviceX:V[0],deviceY:V[1],deviceRadius:X,deviceRect:Y})}else ft={pickedColor:null,pickedObjectIndex:-1};let st;if(ft.pickedLayer&&y&&this.depthFBO){const{pickedColors:Ut}=this._drawAndSample({layers:[ft.pickedLayer],views:e,viewports:n,onViewportActive:_,deviceRect:{x:ft.pickedX,y:ft.pickedY,width:1,height:1},cullRect:ct,effects:C,pass:`picking:${c}:z`},!0);Ut[3]&&(st=Ut[0])}ft.pickedLayer&&Kt+1<l&&(Ot.add(ft.pickedLayer),ft.pickedLayer.disablePickingIndex(ft.pickedObjectIndex)),rt=GT({pickInfo:ft,lastPickedInfo:this.lastPickedInfo,mode:c,layers:k,viewports:n,x:r,y:o,z:st,pixelRatio:I});for(const Ut of rt.values())Ut.layer&&nt.push(Ut);if(!ft.pickedColor)break}for(const Kt of Ot)Kt.restorePickingColors();return{result:nt,emptyInfo:rt.get(null)}}async _pickVisibleObjectsAsync({layers:t,views:e,viewports:n,x:r,y:o,width:s=1,height:l=1,mode:c="query",maxObjects:y=null,onViewportActive:_,effects:C}){const I=this._getPickable(t);if(!I||n.length===0)return[];this._resizeBuffer();const k=this.device.canvasContext.cssToDeviceRatio(),z=this.device.canvasContext.cssToDevicePixels([r,o],!0),V=z.x,X=z.y+z.height,H=this.device.canvasContext.cssToDevicePixels([r+s,o+l],!0),$=H.x+H.width,Y=H.y,ct={x:V,y:Y,width:$-V,height:X-Y},rt=this._drawAndSample({layers:I,views:e,viewports:n,onViewportActive:_,deviceRect:ct,cullRect:{x:r,y:o,width:s,height:l},effects:C,pass:`picking:${c}`}),nt=VT(rt),Ot=new Map,Kt=[],ft=Number.isFinite(y);for(let st=0;st<nt.length&&!(ft&&Kt.length>=y);st++){const Ut=nt[st];let K={color:Ut.pickedColor,layer:null,index:Ut.pickedObjectIndex,picked:!0,x:r,y:o,pixelRatio:k};K=Fb({layer:Ut.pickedLayer,info:K,mode:c});const dt=K.layer.id;Ot.has(dt)||Ot.set(dt,new Set);const Tt=Ot.get(dt),ue=K.object??K.index;Tt.has(ue)||(Tt.add(ue),Kt.push(K))}return Kt}_pickVisibleObjects({layers:t,views:e,viewports:n,x:r,y:o,width:s=1,height:l=1,mode:c="query",maxObjects:y=null,onViewportActive:_,effects:C}){const I=this._getPickable(t);if(!I||n.length===0)return[];this._resizeBuffer();const k=this.device.canvasContext.cssToDeviceRatio(),z=this.device.canvasContext.cssToDevicePixels([r,o],!0),V=z.x,X=z.y+z.height,H=this.device.canvasContext.cssToDevicePixels([r+s,o+l],!0),$=H.x+H.width,Y=H.y,ct={x:V,y:Y,width:$-V,height:X-Y},rt=this._drawAndSample({layers:I,views:e,viewports:n,onViewportActive:_,deviceRect:ct,cullRect:{x:r,y:o,width:s,height:l},effects:C,pass:`picking:${c}`}),nt=VT(rt),Ot=new Map,Kt=[],ft=Number.isFinite(y);for(let st=0;st<nt.length&&!(ft&&Kt.length>=y);st++){const Ut=nt[st];let K={color:Ut.pickedColor,layer:null,index:Ut.pickedObjectIndex,picked:!0,x:r,y:o,pixelRatio:k};K=Fb({layer:Ut.pickedLayer,info:K,mode:c});const dt=K.layer.id;Ot.has(dt)||Ot.set(dt,new Set);const Tt=Ot.get(dt),ue=K.object??K.index;Tt.has(ue)||(Tt.add(ue),Kt.push(K))}return Kt}async _drawAndSampleAsync({layers:t,views:e,viewports:n,onViewportActive:r,deviceRect:o,cullRect:s,effects:l,pass:c},y=!1){const _=y?this.depthFBO:this.pickingFBO,C={layers:t,layerFilter:this.layerFilter,views:e,viewports:n,onViewportActive:r,pickingFBO:_,deviceRect:o,cullRect:s,effects:l,pass:c,pickZ:y,preRenderStats:{},isPicking:!0};for(const $ of l)$.useInPicking&&(C.preRenderStats[$.id]=$.preRender(C));const{decodePickingColor:I}=this.pickLayersPass.render(C),{x:k,y:z,width:V,height:X}=o,H=new(y?Float32Array:Uint8Array)(V*X*4);return this.device.readPixelsToArrayWebGL(_,{sourceX:k,sourceY:z,sourceWidth:V,sourceHeight:X,target:H}),{pickedColors:H,decodePickingColor:I}}_drawAndSample({layers:t,views:e,viewports:n,onViewportActive:r,deviceRect:o,cullRect:s,effects:l,pass:c},y=!1){const _=y?this.depthFBO:this.pickingFBO,C={layers:t,layerFilter:this.layerFilter,views:e,viewports:n,onViewportActive:r,pickingFBO:_,deviceRect:o,cullRect:s,effects:l,pass:c,pickZ:y,preRenderStats:{},isPicking:!0};for(const $ of l)$.useInPicking&&(C.preRenderStats[$.id]=$.preRender(C));const{decodePickingColor:I}=this.pickLayersPass.render(C),{x:k,y:z,width:V,height:X}=o,H=new(y?Float32Array:Uint8Array)(V*X*4);return this.device.readPixelsToArrayWebGL(_,{sourceX:k,sourceY:z,sourceWidth:V,sourceHeight:X,target:H}),{pickedColors:H,decodePickingColor:I}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:n,deviceWidth:r,deviceHeight:o}){const s=Math.max(0,t-n),l=Math.max(0,e-n),c=Math.min(r,t+n+1)-s,y=Math.min(o,e+n+1)-l;return c<=0||y<=0?null:{x:s,y:l,width:c,height:y}}}const TX={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},SX="top-left",jT="__root";class PX{constructor({deck:t,parentElement:e}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,e?.classList.add("deck-widget-container"),this.parentElement=e}getWidgets(){return this.resolvedWidgets}setProps(t){if(t.widgets&&!Or(t.widgets,this.widgets,1)){const e=t.widgets.filter(Boolean);this._setWidgets(e)}}finalize(){for(const t of this.getWidgets())this._removeWidget(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(e=>e.id===t.id)||(this._addWidget(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}onRedraw({viewports:t,layers:e}){const n=t.reduce((r,o)=>(r[o.id]=o,r),{});for(const r of this.getWidgets()){const{viewId:o}=r;if(o){const s=n[o];s&&(r.onViewportChange&&r.onViewportChange(s),r.onRedraw?.({viewports:[s],layers:e}))}else{if(r.onViewportChange)for(const s of t)r.onViewportChange(s);r.onRedraw?.({viewports:t,layers:e})}}this.lastViewports=n,this._updateContainers()}onHover(t,e){for(const n of this.getWidgets()){const{viewId:r}=n;(!r||r===t.viewport?.id)&&n.onHover?.(t,e)}}onEvent(t,e){const n=Pb[e.type];if(n)for(const r of this.getWidgets()){const{viewId:o}=r;(!o||o===t.viewport?.id)&&r[n]?.(t,e)}}_setWidgets(t){const e={};for(const n of this.resolvedWidgets)e[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)e[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){const r=e[n.id];r?r.viewId!==n.viewId||r.placement!==n.placement?(this._removeWidget(r),this._addWidget(n)):n!==r&&(r.setProps(n.props),n=r):this._addWidget(n),e[n.id]=null,this.resolvedWidgets.push(n)}for(const n in e){const r=e[n];r&&this._removeWidget(r)}this.widgets=t}_addWidget(t){const{viewId:e=null,placement:n=SX}=t;t.widgetManager=this,t.deck=this.deck,t.rootElement=t._onAdd({deck:this.deck,viewId:e}),t.rootElement&&this._getContainer(e,n).append(t.rootElement),t.updateHTML()}_removeWidget(t){t.onRemove?.(),t.rootElement&&t.rootElement.remove(),t.rootElement=void 0,t.deck=void 0,t.widgetManager=void 0}_getContainer(t,e){const n=t||jT;let r=this.containers[n];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",this.parentElement?.append(r),this.containers[n]=r);let o=r.querySelector(`.${e}`);return o||(o=globalThis.document.createElement("div"),o.className=e,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,TX[e]),r.append(o)),o}_updateContainers(){const t=this.deck.width,e=this.deck.height;for(const n in this.containers){const r=this.lastViewports[n]||null,o=n===jT||r,s=this.containers[n];o?(s.style.display="block",s.style.left=`${r?r.x:0}px`,s.style.top=`${r?r.y:0}px`,s.style.width=`${r?r.width:t}px`,s.style.height=`${r?r.height:e}px`):s.style.display="none"}}}function WT(i,t){t&&Object.entries(t).map(([e,n])=>{e.startsWith("--")?i.style.setProperty(e,n):i.style[e]=n})}function IX(i,t){t&&Object.keys(t).map(e=>{e.startsWith("--")?i.style.removeProperty(e):i.style[e]=""})}class zx{constructor(t){this.viewId=null,this.props={...this.constructor.defaultProps,...t},this.id=this.props.id}setProps(t){const e=this.props,n=this.rootElement;n&&e.className!==t.className&&(e.className&&n.classList.remove(e.className),t.className&&n.classList.add(t.className)),n&&!Or(e.style,t.style,1)&&(IX(n,e.style),WT(n,t.style)),Object.assign(this.props,t),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const t=["deck-widget",this.className,this.props.className],e=document.createElement("div");return t.filter(n=>typeof n=="string"&&n.length>0).forEach(n=>e.classList.add(n)),WT(e,this.props.style),e}_onAdd(t){return this.onAdd(t)??this.onCreateRootElement()}onAdd(t){}onRemove(){}onViewportChange(t){}onRedraw(t){}onHover(t,e){}onClick(t,e){}onDrag(t,e){}onDragStart(t,e){}onDragEnd(t,e){}}zx.defaultProps={id:"widget",style:{},className:""};const MX={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class uL extends zx{constructor(t={}){super(t),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(t)}onCreateRootElement(){const t=document.createElement("div");return t.className=this.className,Object.assign(t.style,MX),t}onRenderHTML(t){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){const{deck:e}=this,n=e&&e.props.getTooltip;if(!n)return;const r=n(t);this.lastViewport=t.viewport,this.setTooltip(r,t.x,t.y)}setTooltip(t,e,n){const r=this.rootElement;if(r){if(typeof t=="string")r.innerText=t;else if(t)t.text&&(r.innerText=t.text),t.html&&(r.innerHTML=t.html),t.className&&(r.className=t.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${e}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(r.style,t.style)}}}uL.defaultProps={...zx.defaultProps};var Xd;(function(i){i[i.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",i[i.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",i[i.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i[i.ZERO=0]="ZERO",i[i.ONE=1]="ONE",i[i.SRC_COLOR=768]="SRC_COLOR",i[i.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.DST_ALPHA=772]="DST_ALPHA",i[i.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",i[i.DST_COLOR=774]="DST_COLOR",i[i.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",i[i.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",i[i.CONSTANT_COLOR=32769]="CONSTANT_COLOR",i[i.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",i[i.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",i[i.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",i[i.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",i[i.BLEND_EQUATION=32777]="BLEND_EQUATION",i[i.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",i[i.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",i[i.BLEND_DST_RGB=32968]="BLEND_DST_RGB",i[i.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",i[i.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",i[i.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",i[i.BLEND_COLOR=32773]="BLEND_COLOR",i[i.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",i[i.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",i[i.LINE_WIDTH=2849]="LINE_WIDTH",i[i.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",i[i.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",i[i.CULL_FACE_MODE=2885]="CULL_FACE_MODE",i[i.FRONT_FACE=2886]="FRONT_FACE",i[i.DEPTH_RANGE=2928]="DEPTH_RANGE",i[i.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",i[i.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",i[i.DEPTH_FUNC=2932]="DEPTH_FUNC",i[i.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",i[i.STENCIL_FUNC=2962]="STENCIL_FUNC",i[i.STENCIL_FAIL=2964]="STENCIL_FAIL",i[i.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",i[i.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",i[i.STENCIL_REF=2967]="STENCIL_REF",i[i.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",i[i.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",i[i.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",i[i.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",i[i.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",i[i.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",i[i.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",i[i.VIEWPORT=2978]="VIEWPORT",i[i.SCISSOR_BOX=3088]="SCISSOR_BOX",i[i.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",i[i.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",i[i.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",i[i.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",i[i.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",i[i.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",i[i.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",i[i.RED_BITS=3410]="RED_BITS",i[i.GREEN_BITS=3411]="GREEN_BITS",i[i.BLUE_BITS=3412]="BLUE_BITS",i[i.ALPHA_BITS=3413]="ALPHA_BITS",i[i.DEPTH_BITS=3414]="DEPTH_BITS",i[i.STENCIL_BITS=3415]="STENCIL_BITS",i[i.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",i[i.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",i[i.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",i[i.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",i[i.SAMPLES=32937]="SAMPLES",i[i.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",i[i.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",i[i.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",i[i.VENDOR=7936]="VENDOR",i[i.RENDERER=7937]="RENDERER",i[i.VERSION=7938]="VERSION",i[i.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",i[i.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",i[i.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",i[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.BUFFER_SIZE=34660]="BUFFER_SIZE",i[i.BUFFER_USAGE=34661]="BUFFER_USAGE",i[i.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",i[i.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",i[i.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",i[i.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",i[i.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",i[i.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",i[i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",i[i.CULL_FACE=2884]="CULL_FACE",i[i.FRONT=1028]="FRONT",i[i.BACK=1029]="BACK",i[i.FRONT_AND_BACK=1032]="FRONT_AND_BACK",i[i.BLEND=3042]="BLEND",i[i.DEPTH_TEST=2929]="DEPTH_TEST",i[i.DITHER=3024]="DITHER",i[i.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",i[i.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",i[i.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",i[i.SCISSOR_TEST=3089]="SCISSOR_TEST",i[i.STENCIL_TEST=2960]="STENCIL_TEST",i[i.NO_ERROR=0]="NO_ERROR",i[i.INVALID_ENUM=1280]="INVALID_ENUM",i[i.INVALID_VALUE=1281]="INVALID_VALUE",i[i.INVALID_OPERATION=1282]="INVALID_OPERATION",i[i.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",i[i.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",i[i.CW=2304]="CW",i[i.CCW=2305]="CCW",i[i.DONT_CARE=4352]="DONT_CARE",i[i.FASTEST=4353]="FASTEST",i[i.NICEST=4354]="NICEST",i[i.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",i[i.BYTE=5120]="BYTE",i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.SHORT=5122]="SHORT",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.INT=5124]="INT",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.FLOAT=5126]="FLOAT",i[i.DOUBLE=5130]="DOUBLE",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.ALPHA=6406]="ALPHA",i[i.RGB=6407]="RGB",i[i.RGBA=6408]="RGBA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",i[i.VERTEX_SHADER=35633]="VERTEX_SHADER",i[i.COMPILE_STATUS=35713]="COMPILE_STATUS",i[i.DELETE_STATUS=35712]="DELETE_STATUS",i[i.LINK_STATUS=35714]="LINK_STATUS",i[i.VALIDATE_STATUS=35715]="VALIDATE_STATUS",i[i.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",i[i.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",i[i.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",i[i.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",i[i.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",i[i.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",i[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",i[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",i[i.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",i[i.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",i[i.SHADER_TYPE=35663]="SHADER_TYPE",i[i.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",i[i.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",i[i.NEVER=512]="NEVER",i[i.LESS=513]="LESS",i[i.EQUAL=514]="EQUAL",i[i.LEQUAL=515]="LEQUAL",i[i.GREATER=516]="GREATER",i[i.NOTEQUAL=517]="NOTEQUAL",i[i.GEQUAL=518]="GEQUAL",i[i.ALWAYS=519]="ALWAYS",i[i.KEEP=7680]="KEEP",i[i.REPLACE=7681]="REPLACE",i[i.INCR=7682]="INCR",i[i.DECR=7683]="DECR",i[i.INVERT=5386]="INVERT",i[i.INCR_WRAP=34055]="INCR_WRAP",i[i.DECR_WRAP=34056]="DECR_WRAP",i[i.NEAREST=9728]="NEAREST",i[i.LINEAR=9729]="LINEAR",i[i.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",i[i.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",i[i.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",i[i.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE=5890]="TEXTURE",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i[i.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",i[i.TEXTURE0=33984]="TEXTURE0",i[i.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",i[i.REPEAT=10497]="REPEAT",i[i.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i[i.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",i[i.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",i[i.FLOAT_VEC2=35664]="FLOAT_VEC2",i[i.FLOAT_VEC3=35665]="FLOAT_VEC3",i[i.FLOAT_VEC4=35666]="FLOAT_VEC4",i[i.INT_VEC2=35667]="INT_VEC2",i[i.INT_VEC3=35668]="INT_VEC3",i[i.INT_VEC4=35669]="INT_VEC4",i[i.BOOL=35670]="BOOL",i[i.BOOL_VEC2=35671]="BOOL_VEC2",i[i.BOOL_VEC3=35672]="BOOL_VEC3",i[i.BOOL_VEC4=35673]="BOOL_VEC4",i[i.FLOAT_MAT2=35674]="FLOAT_MAT2",i[i.FLOAT_MAT3=35675]="FLOAT_MAT3",i[i.FLOAT_MAT4=35676]="FLOAT_MAT4",i[i.SAMPLER_2D=35678]="SAMPLER_2D",i[i.SAMPLER_CUBE=35680]="SAMPLER_CUBE",i[i.LOW_FLOAT=36336]="LOW_FLOAT",i[i.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",i[i.HIGH_FLOAT=36338]="HIGH_FLOAT",i[i.LOW_INT=36339]="LOW_INT",i[i.MEDIUM_INT=36340]="MEDIUM_INT",i[i.HIGH_INT=36341]="HIGH_INT",i[i.FRAMEBUFFER=36160]="FRAMEBUFFER",i[i.RENDERBUFFER=36161]="RENDERBUFFER",i[i.RGBA4=32854]="RGBA4",i[i.RGB5_A1=32855]="RGB5_A1",i[i.RGB565=36194]="RGB565",i[i.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",i[i.STENCIL_INDEX=6401]="STENCIL_INDEX",i[i.STENCIL_INDEX8=36168]="STENCIL_INDEX8",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i[i.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",i[i.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",i[i.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",i[i.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",i[i.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",i[i.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",i[i.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",i[i.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",i[i.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",i[i.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",i[i.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",i[i.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",i[i.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",i[i.NONE=0]="NONE",i[i.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",i[i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",i[i.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",i[i.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",i[i.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",i[i.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",i[i.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",i[i.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",i[i.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",i[i.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",i[i.READ_BUFFER=3074]="READ_BUFFER",i[i.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",i[i.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",i[i.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",i[i.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",i[i.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",i[i.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",i[i.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",i[i.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",i[i.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",i[i.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",i[i.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",i[i.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",i[i.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",i[i.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",i[i.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",i[i.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",i[i.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",i[i.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",i[i.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",i[i.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",i[i.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",i[i.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",i[i.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",i[i.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",i[i.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",i[i.RED=6403]="RED",i[i.RGB8=32849]="RGB8",i[i.RGBA8=32856]="RGBA8",i[i.RGB10_A2=32857]="RGB10_A2",i[i.TEXTURE_3D=32879]="TEXTURE_3D",i[i.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",i[i.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",i[i.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",i[i.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",i[i.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",i[i.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",i[i.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",i[i.SRGB=35904]="SRGB",i[i.SRGB8=35905]="SRGB8",i[i.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",i[i.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",i[i.RGBA32F=34836]="RGBA32F",i[i.RGB32F=34837]="RGB32F",i[i.RGBA16F=34842]="RGBA16F",i[i.RGB16F=34843]="RGB16F",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",i[i.R11F_G11F_B10F=35898]="R11F_G11F_B10F",i[i.RGB9_E5=35901]="RGB9_E5",i[i.RGBA32UI=36208]="RGBA32UI",i[i.RGB32UI=36209]="RGB32UI",i[i.RGBA16UI=36214]="RGBA16UI",i[i.RGB16UI=36215]="RGB16UI",i[i.RGBA8UI=36220]="RGBA8UI",i[i.RGB8UI=36221]="RGB8UI",i[i.RGBA32I=36226]="RGBA32I",i[i.RGB32I=36227]="RGB32I",i[i.RGBA16I=36232]="RGBA16I",i[i.RGB16I=36233]="RGB16I",i[i.RGBA8I=36238]="RGBA8I",i[i.RGB8I=36239]="RGB8I",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.R8=33321]="R8",i[i.RG8=33323]="RG8",i[i.R16F=33325]="R16F",i[i.R32F=33326]="R32F",i[i.RG16F=33327]="RG16F",i[i.RG32F=33328]="RG32F",i[i.R8I=33329]="R8I",i[i.R8UI=33330]="R8UI",i[i.R16I=33331]="R16I",i[i.R16UI=33332]="R16UI",i[i.R32I=33333]="R32I",i[i.R32UI=33334]="R32UI",i[i.RG8I=33335]="RG8I",i[i.RG8UI=33336]="RG8UI",i[i.RG16I=33337]="RG16I",i[i.RG16UI=33338]="RG16UI",i[i.RG32I=33339]="RG32I",i[i.RG32UI=33340]="RG32UI",i[i.R8_SNORM=36756]="R8_SNORM",i[i.RG8_SNORM=36757]="RG8_SNORM",i[i.RGB8_SNORM=36758]="RGB8_SNORM",i[i.RGBA8_SNORM=36759]="RGBA8_SNORM",i[i.RGB10_A2UI=36975]="RGB10_A2UI",i[i.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",i[i.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.HALF_FLOAT=5131]="HALF_FLOAT",i[i.RG=33319]="RG",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",i[i.CURRENT_QUERY=34917]="CURRENT_QUERY",i[i.QUERY_RESULT=34918]="QUERY_RESULT",i[i.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",i[i.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",i[i.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",i[i.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",i[i.DRAW_BUFFER0=34853]="DRAW_BUFFER0",i[i.DRAW_BUFFER1=34854]="DRAW_BUFFER1",i[i.DRAW_BUFFER2=34855]="DRAW_BUFFER2",i[i.DRAW_BUFFER3=34856]="DRAW_BUFFER3",i[i.DRAW_BUFFER4=34857]="DRAW_BUFFER4",i[i.DRAW_BUFFER5=34858]="DRAW_BUFFER5",i[i.DRAW_BUFFER6=34859]="DRAW_BUFFER6",i[i.DRAW_BUFFER7=34860]="DRAW_BUFFER7",i[i.DRAW_BUFFER8=34861]="DRAW_BUFFER8",i[i.DRAW_BUFFER9=34862]="DRAW_BUFFER9",i[i.DRAW_BUFFER10=34863]="DRAW_BUFFER10",i[i.DRAW_BUFFER11=34864]="DRAW_BUFFER11",i[i.DRAW_BUFFER12=34865]="DRAW_BUFFER12",i[i.DRAW_BUFFER13=34866]="DRAW_BUFFER13",i[i.DRAW_BUFFER14=34867]="DRAW_BUFFER14",i[i.DRAW_BUFFER15=34868]="DRAW_BUFFER15",i[i.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",i[i.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",i[i.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",i[i.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",i[i.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",i[i.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",i[i.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",i[i.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",i[i.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",i[i.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",i[i.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",i[i.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",i[i.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",i[i.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",i[i.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",i[i.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",i[i.SAMPLER_3D=35679]="SAMPLER_3D",i[i.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",i[i.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",i[i.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",i[i.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",i[i.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",i[i.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",i[i.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",i[i.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",i[i.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",i[i.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",i[i.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",i[i.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",i[i.MAX_SAMPLES=36183]="MAX_SAMPLES",i[i.SAMPLER_BINDING=35097]="SAMPLER_BINDING",i[i.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",i[i.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",i[i.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",i[i.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",i[i.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",i[i.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",i[i.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",i[i.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",i[i.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",i[i.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",i[i.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",i[i.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",i[i.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",i[i.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",i[i.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",i[i.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",i[i.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",i[i.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",i[i.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",i[i.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",i[i.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",i[i.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",i[i.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",i[i.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",i[i.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",i[i.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",i[i.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",i[i.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",i[i.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",i[i.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",i[i.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",i[i.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",i[i.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",i[i.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",i[i.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",i[i.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",i[i.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",i[i.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",i[i.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",i[i.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",i[i.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i[i.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",i[i.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",i[i.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",i[i.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",i[i.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",i[i.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",i[i.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",i[i.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",i[i.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",i[i.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",i[i.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",i[i.UNIFORM_TYPE=35383]="UNIFORM_TYPE",i[i.UNIFORM_SIZE=35384]="UNIFORM_SIZE",i[i.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",i[i.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",i[i.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",i[i.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",i[i.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",i[i.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",i[i.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",i[i.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",i[i.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",i[i.OBJECT_TYPE=37138]="OBJECT_TYPE",i[i.SYNC_CONDITION=37139]="SYNC_CONDITION",i[i.SYNC_STATUS=37140]="SYNC_STATUS",i[i.SYNC_FLAGS=37141]="SYNC_FLAGS",i[i.SYNC_FENCE=37142]="SYNC_FENCE",i[i.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",i[i.UNSIGNALED=37144]="UNSIGNALED",i[i.SIGNALED=37145]="SIGNALED",i[i.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",i[i.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",i[i.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",i[i.WAIT_FAILED=37149]="WAIT_FAILED",i[i.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",i[i.COLOR=6144]="COLOR",i[i.DEPTH=6145]="DEPTH",i[i.STENCIL=6146]="STENCIL",i[i.MIN=32775]="MIN",i[i.MAX=32776]="MAX",i[i.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",i[i.STREAM_READ=35041]="STREAM_READ",i[i.STREAM_COPY=35042]="STREAM_COPY",i[i.STATIC_READ=35045]="STATIC_READ",i[i.STATIC_COPY=35046]="STATIC_COPY",i[i.DYNAMIC_READ=35049]="DYNAMIC_READ",i[i.DYNAMIC_COPY=35050]="DYNAMIC_COPY",i[i.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",i[i.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",i[i.INVALID_INDEX=4294967295]="INVALID_INDEX",i[i.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",i[i.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",i[i.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",i[i.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",i[i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",i[i.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",i[i.R16_EXT=33322]="R16_EXT",i[i.RG16_EXT=33324]="RG16_EXT",i[i.RGB16_EXT=32852]="RGB16_EXT",i[i.RGBA16_EXT=32859]="RGBA16_EXT",i[i.R16_SNORM_EXT=36760]="R16_SNORM_EXT",i[i.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",i[i.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",i[i.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",i[i.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",i[i.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",i[i.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",i[i.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",i[i.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",i[i.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",i[i.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",i[i.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",i[i.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",i[i.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",i[i.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",i[i.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",i[i.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",i[i.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",i[i.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",i[i.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",i[i.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",i[i.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",i[i.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",i[i.LINE_WEBGL=6913]="LINE_WEBGL",i[i.FILL_WEBGL=6914]="FILL_WEBGL",i[i.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",i[i.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",i[i.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",i[i.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",i[i.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",i[i.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",i[i.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",i[i.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",i[i.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",i[i.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",i[i.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",i[i.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",i[i.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",i[i.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",i[i.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",i[i.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",i[i.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",i[i.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",i[i.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",i[i.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",i[i.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",i[i.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",i[i.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",i[i.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Xd||(Xd={}));const BX={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},RX=i=>({drawBuffersWEBGL(t){return i.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),LX=i=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return i.createVertexArray()},deleteVertexArrayOES(t){return i.deleteVertexArray(t)},isVertexArrayOES(t){return i.isVertexArray(t)},bindVertexArrayOES(t){return i.bindVertexArray(t)}}),DX=i=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return i.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return i.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return i.vertexAttribDivisor(...t)}});function kX(i=!0){const t=HTMLCanvasElement.prototype;if(!i&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(e,n){if(e==="webgl"||e==="experimental-webgl"){const r=this.originalGetContext("webgl2",n);return r instanceof HTMLElement&&OX(r),r}return this.originalGetContext(e,n)}}function OX(i){i.getExtension("EXT_color_buffer_float");const t={...BX,WEBGL_disjoint_timer_query:i.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:RX(i),OES_vertex_array_object:LX(i),ANGLE_instanced_arrays:DX(i)},e=i.getExtension;i.getExtension=function(r){return e.call(i,r)||(r in t?t[r]:null)};const n=i.getSupportedExtensions;i.getSupportedExtensions=function(){return(n.apply(i)||[])?.concat(Object.keys(t))}}async function cL(i,t){const e=document.getElementsByTagName("head")[0];if(!e)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",i),new Promise((r,o)=>{n.onload=r,n.onerror=s=>o(new Error(`Unable to load script '${i}': ${s}`)),e.appendChild(n)})}const FX=1;let oa=null,HT=!1;const Ux={debugSpectorJS:Xe.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function NX(i){if(!globalThis.SPECTOR)try{await cL(i.debugSpectorJSUrl||Ux.debugSpectorJSUrl)}catch(t){Xe.warn(String(t))}}function zX(i){if(i={...Ux,...i},!i.debugSpectorJS)return null;if(!oa&&globalThis.SPECTOR&&!globalThis.luma?.spector){Xe.probe(FX,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;oa=new t,globalThis.luma&&(globalThis.luma.spector=oa)}if(!oa)return null;if(HT||(HT=!0,oa.spyCanvases(),oa?.onCaptureStarted.add(t=>Xe.info("Spector capture started:",t)()),oa?.onCapture.add(t=>{Xe.info("Spector capture complete:",t)(),oa?.getResultUI(),oa?.resultView.display(),oa?.resultView.addCapture(t)})),i.gl){const t=i.gl,e=t.device;oa?.startCapture(i.gl,500),t.device=e,new Promise(n=>setTimeout(n,2e3)).then(n=>{Xe.info("Spector capture stopped after 2 seconds")(),oa?.stopCapture()})}return oa}const UX="https://unpkg.com/webgl-debug@2.0.1/index.js";function hL(i){return i.luma=i.luma||{},i.luma}async function VX(){pf()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await cL(UX))}function GX(i,t={}){return t.debugWebGL||t.traceWebGL?WX(i,t):jX(i)}function jX(i){const t=hL(i);return t.realContext?t.realContext:i}function WX(i,t){if(!globalThis.WebGLDebugUtils)return Xe.warn("webgl-debug not loaded")(),i;const e=hL(i);if(e.debugContext)return e.debugContext;globalThis.WebGLDebugUtils.init({...Xd,...i});const n=globalThis.WebGLDebugUtils.makeDebugContext(i,HX.bind(null,t),XX.bind(null,t));for(const s in Xd)!(s in n)&&typeof Xd[s]=="number"&&(n[s]=Xd[s]);class r{}Object.setPrototypeOf(n,Object.getPrototypeOf(i)),Object.setPrototypeOf(r,n);const o=Object.create(r);return e.realContext=i,e.debugContext=o,o.debug=!0,o}function XT(i,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let e=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,t);return e=`${e.slice(0,100)}${e.length>100?"...":""}`,`gl.${i}(${e})`}function HX(i,t,e,n){n=Array.from(n).map(l=>l===void 0?"undefined":l);const r=globalThis.WebGLDebugUtils.glEnumToString(t),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,n),s=`${r} in gl.${e}(${o})`;Xe.error(s)();debugger}function XX(i,t,e){let n="";Xe.level>=1&&(n=XT(t,e),i.traceWebGL&&Xe.log(1,n)());for(const r of e)if(r===void 0){n=n||XT(t,e);debugger}}const E0=1;class qX extends OU{type="webgl";constructor(){super(),$h.defaultProps={...$h.defaultProps,...Ux}}enforceWebGL2(t){kX(t)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext&&Xe.warn("WebGL1 is not supported",t)(),!1)}async attach(t,e={}){const{WebGLDevice:n}=await Promise.resolve().then(()=>lS);if(t instanceof n)return t;if(t?.device instanceof n)return t.device;if(!KX(t))throw new Error("Invalid WebGL2RenderingContext");const r=e.createCanvasContext===!0?{}:e.createCanvasContext;return new n({...e,_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1,...r}})}async create(t={}){const{WebGLDevice:e}=await Promise.resolve().then(()=>lS);Xe.groupCollapsed(E0,"WebGLDevice created")();try{const n=[];(t.debugWebGL||t.debug)&&n.push(VX()),t.debugSpectorJS&&n.push(NX(t));const r=await Promise.allSettled(n);for(const l of r)l.status==="rejected"&&Xe.error(`Failed to initialize debug libraries ${l.reason}`)();const o=new e(t),s=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.props.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Xe.probe(E0,s)(),Xe.table(E0,o.info)(),o}finally{Xe.groupEnd(E0)()}}}function KX(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}const O_=new qX,Vx={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},hs=(i,t,e)=>t?i.enable(e):i.disable(e),qT=(i,t,e)=>i.hint(e,t),aa=(i,t,e)=>i.pixelStorei(e,t),KT=(i,t,e)=>{const n=e===36006?36009:36008;return i.bindFramebuffer(n,t)},yA=(i,t,e)=>{const n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[e];i.bindBuffer(n,t)};function F_(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}const ZX={3042:hs,32773:(i,t)=>i.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,t)=>i.clearColor(...t),3107:(i,t)=>i.colorMask(...t),2884:hs,2885:(i,t)=>i.cullFace(t),2929:hs,2931:(i,t)=>i.clearDepth(t),2932:(i,t)=>i.depthFunc(t),2928:(i,t)=>i.depthRange(...t),2930:(i,t)=>i.depthMask(t),3024:hs,35723:qT,35725:(i,t)=>i.useProgram(t),36007:(i,t)=>i.bindRenderbuffer(36161,t),36389:(i,t)=>i.bindTransformFeedback?.(36386,t),34229:(i,t)=>i.bindVertexArray(t),36006:KT,36010:KT,34964:yA,36662:yA,36663:yA,35053:yA,35055:yA,2886:(i,t)=>i.frontFace(t),33170:qT,2849:(i,t)=>i.lineWidth(t),32823:hs,32824:"polygonOffset",10752:"polygonOffset",35977:hs,32926:hs,32928:hs,32938:"sampleCoverage",32939:"sampleCoverage",3089:hs,3088:(i,t)=>i.scissor(...t),2960:hs,2961:(i,t)=>i.clearStencil(t),2968:(i,t)=>i.stencilMaskSeparate(1028,t),36005:(i,t)=>i.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,t)=>i.viewport(...t),34383:hs,10754:hs,12288:hs,12289:hs,12290:hs,12291:hs,12292:hs,12293:hs,12294:hs,12295:hs,3333:aa,3317:aa,37440:aa,37441:aa,37443:aa,3330:aa,3332:aa,3331:aa,3314:aa,32878:aa,3316:aa,3315:aa,32877:aa,framebuffer:(i,t)=>{const e=t&&"handle"in t?t.handle:t;return i.bindFramebuffer(36160,e)},blend:(i,t)=>t?i.enable(3042):i.disable(3042),blendColor:(i,t)=>i.blendColor(...t),blendEquation:(i,t)=>{const e=typeof t=="number"?[t,t]:t;i.blendEquationSeparate(...e)},blendFunc:(i,t)=>{const e=t?.length===2?[...t,...t]:t;i.blendFuncSeparate(...e)},clearColor:(i,t)=>i.clearColor(...t),clearDepth:(i,t)=>i.clearDepth(t),clearStencil:(i,t)=>i.clearStencil(t),colorMask:(i,t)=>i.colorMask(...t),cull:(i,t)=>t?i.enable(2884):i.disable(2884),cullFace:(i,t)=>i.cullFace(t),depthTest:(i,t)=>t?i.enable(2929):i.disable(2929),depthFunc:(i,t)=>i.depthFunc(t),depthMask:(i,t)=>i.depthMask(t),depthRange:(i,t)=>i.depthRange(...t),dither:(i,t)=>t?i.enable(3024):i.disable(3024),derivativeHint:(i,t)=>{i.hint(35723,t)},frontFace:(i,t)=>i.frontFace(t),mipmapHint:(i,t)=>i.hint(33170,t),lineWidth:(i,t)=>i.lineWidth(t),polygonOffsetFill:(i,t)=>t?i.enable(32823):i.disable(32823),polygonOffset:(i,t)=>i.polygonOffset(...t),sampleCoverage:(i,t)=>i.sampleCoverage(t[0],t[1]||!1),scissorTest:(i,t)=>t?i.enable(3089):i.disable(3089),scissor:(i,t)=>i.scissor(...t),stencilTest:(i,t)=>t?i.enable(2960):i.disable(2960),stencilMask:(i,t)=>{t=F_(t)?t:[t,t];const[e,n]=t;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,n)},stencilFunc:(i,t)=>{t=F_(t)&&t.length===3?[...t,...t]:t;const[e,n,r,o,s,l]=t;i.stencilFuncSeparate(1028,e,n,r),i.stencilFuncSeparate(1029,o,s,l)},stencilOp:(i,t)=>{t=F_(t)&&t.length===3?[...t,...t]:t;const[e,n,r,o,s,l]=t;i.stencilOpSeparate(1028,e,n,r),i.stencilOpSeparate(1029,o,s,l)},viewport:(i,t)=>i.viewport(...t)};function Jr(i,t,e){return t[i]!==void 0?t[i]:e[i]}const YX={blendEquation:(i,t,e)=>i.blendEquationSeparate(Jr(32777,t,e),Jr(34877,t,e)),blendFunc:(i,t,e)=>i.blendFuncSeparate(Jr(32969,t,e),Jr(32968,t,e),Jr(32971,t,e),Jr(32970,t,e)),polygonOffset:(i,t,e)=>i.polygonOffset(Jr(32824,t,e),Jr(10752,t,e)),sampleCoverage:(i,t,e)=>i.sampleCoverage(Jr(32938,t,e),Jr(32939,t,e)),stencilFuncFront:(i,t,e)=>i.stencilFuncSeparate(1028,Jr(2962,t,e),Jr(2967,t,e),Jr(2963,t,e)),stencilFuncBack:(i,t,e)=>i.stencilFuncSeparate(1029,Jr(34816,t,e),Jr(36003,t,e),Jr(36004,t,e)),stencilOpFront:(i,t,e)=>i.stencilOpSeparate(1028,Jr(2964,t,e),Jr(2965,t,e),Jr(2966,t,e)),stencilOpBack:(i,t,e)=>i.stencilOpSeparate(1029,Jr(34817,t,e),Jr(34818,t,e),Jr(34819,t,e))},ZT={enable:(i,t)=>i({[t]:!0}),disable:(i,t)=>i({[t]:!1}),pixelStorei:(i,t,e)=>i({[t]:e}),hint:(i,t,e)=>i({[t]:e}),useProgram:(i,t)=>i({35725:t}),bindRenderbuffer:(i,t,e)=>i({36007:e}),bindTransformFeedback:(i,t,e)=>i({36389:e}),bindVertexArray:(i,t)=>i({34229:t}),bindFramebuffer:(i,t,e)=>{switch(t){case 36160:return i({36006:e,36010:e});case 36009:return i({36006:e});case 36008:return i({36010:e});default:return null}},bindBuffer:(i,t,e)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return n?i({[n]:e}):{valueChanged:!0}},blendColor:(i,t,e,n,r)=>i({32773:new Float32Array([t,e,n,r])}),blendEquation:(i,t)=>i({32777:t,34877:t}),blendEquationSeparate:(i,t,e)=>i({32777:t,34877:e}),blendFunc:(i,t,e)=>i({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(i,t,e,n,r)=>i({32969:t,32968:e,32971:n,32970:r}),clearColor:(i,t,e,n,r)=>i({3106:new Float32Array([t,e,n,r])}),clearDepth:(i,t)=>i({2931:t}),clearStencil:(i,t)=>i({2961:t}),colorMask:(i,t,e,n,r)=>i({3107:[t,e,n,r]}),cullFace:(i,t)=>i({2885:t}),depthFunc:(i,t)=>i({2932:t}),depthRange:(i,t,e)=>i({2928:new Float32Array([t,e])}),depthMask:(i,t)=>i({2930:t}),frontFace:(i,t)=>i({2886:t}),lineWidth:(i,t)=>i({2849:t}),polygonOffset:(i,t,e)=>i({32824:t,10752:e}),sampleCoverage:(i,t,e)=>i({32938:t,32939:e}),scissor:(i,t,e,n,r)=>i({3088:new Int32Array([t,e,n,r])}),stencilMask:(i,t)=>i({2968:t,36005:t}),stencilMaskSeparate:(i,t,e)=>i({[t===1028?2968:36005]:e}),stencilFunc:(i,t,e,n)=>i({2962:t,2967:e,2963:n,34816:t,36003:e,36004:n}),stencilFuncSeparate:(i,t,e,n,r)=>i({[t===1028?2962:34816]:e,[t===1028?2967:36003]:n,[t===1028?2963:36004]:r}),stencilOp:(i,t,e,n)=>i({2964:t,2965:e,2966:n,34817:t,34818:e,34819:n}),stencilOpSeparate:(i,t,e,n,r)=>i({[t===1028?2964:34817]:e,[t===1028?2965:34818]:n,[t===1028?2966:34819]:r}),viewport:(i,t,e,n,r)=>i({2978:[t,e,n,r]})},Yl=(i,t)=>i.isEnabled(t),YT={3042:Yl,2884:Yl,2929:Yl,3024:Yl,32823:Yl,32926:Yl,32928:Yl,3089:Yl,2960:Yl,35977:Yl},QX=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function kp(i,t){if($X(t))return;const e={};for(const r in t){const o=Number(r),s=ZX[r];s&&(typeof s=="string"?e[s]=!0:s(i,t[r],o))}const n=i.state&&i.state.cache;if(n)for(const r in e){const o=YX[r];o(i,t,n)}}function fL(i,t=Vx){if(typeof t=="number"){const r=t,o=YT[r];return o?o(i,r):i.getParameter(r)}const e=Array.isArray(t)?t:Object.keys(t),n={};for(const r of e){const o=YT[r];n[r]=o?o(i,Number(r)):i.getParameter(Number(r))}return n}function JX(i){kp(i,Vx)}function $X(i){for(const t in i)return!1;return!0}function tq(i,t){if(i===t)return!0;if(QT(i)&&QT(t)&&i.length===t.length){for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}return!1}function QT(i){return Array.isArray(i)||ArrayBuffer.isView(i)}class Yh{static get(t){return t.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(t,e){this.gl=t,this.log=e?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){const t=this.stateStack[this.stateStack.length-1];kp(this.gl,t),this.stateStack.pop()}trackState(t,e){if(this.cache=e?.copyState?fL(t):Object.assign({},Vx),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,iq(t);for(const n in ZT){const r=ZT[n];eq(t,n,r)}JT(t,"getParameter"),JT(t,"isEnabled")}_updateCache(t){let e=!1,n;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in t){const s=t[o],l=this.cache[o];tq(s,l)||(e=!0,n=l,r&&!(o in r)&&(r[o]=l),this.cache[o]=s)}return{valueChanged:e,oldValue:n}}}function JT(i,t){const e=i[t].bind(i);i[t]=function(n){if(n===void 0||QX.has(n))return e(n);const r=Yh.get(i);return n in r.cache||(r.cache[n]=e(n)),r.enable?r.cache[n]:e(n)},Object.defineProperty(i[t],"name",{value:`${t}-from-cache`,configurable:!1})}function eq(i,t,e){if(!i[t])return;const n=i[t].bind(i);i[t]=function(...r){const o=Yh.get(i),{valueChanged:s,oldValue:l}=e(o._updateCache,...r);return s&&n(...r),l},Object.defineProperty(i[t],"name",{value:`${t}-to-cache`,configurable:!1})}function iq(i){const t=i.useProgram.bind(i);i.useProgram=function(e){const n=Yh.get(i);n.program!==e&&(t(e),n.program=e)}}function nq(i,t,e){let n="";const r={preserveDrawingBuffer:!0,...e};let o=null;if(o||=i.getContext("webgl2",r),r.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!o&&!e.failIfMajorPerformanceCaveat&&(r.failIfMajorPerformanceCaveat=!1,o=i.getContext("webgl2",r),o.luma||={},o.luma.softwareRenderer=!0),o||(o=i.getContext("webgl",{}),o&&(o=null,n||="Your browser only supports WebGL1")),!o)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:s,onContextRestored:l}=t;return i.addEventListener("webglcontextlost",c=>s(c),!1),i.addEventListener("webglcontextrestored",c=>l(c),!1),o.luma||={},o}function _p(i,t,e){return e[t]===void 0&&(e[t]=i.getExtension(t)||null),e[t]}function rq(i,t){const e=i.getParameter(7936),n=i.getParameter(7937);_p(i,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,o=i.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),s=i.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),l=o||e,c=s||n,y=i.getParameter(7938),_=dL(l,c),C=sq(l,c),I=oq(l,c);return{type:"webgl",gpu:_,gpuType:I,gpuBackend:C,vendor:l,renderer:c,version:y,shadingLanguage:"glsl",shadingLanguageVersion:300}}function dL(i,t){return/NVIDIA/i.exec(i)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(i)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(i)||/Apple/i.exec(t)?"apple":/AMD/i.exec(i)||/AMD/i.exec(t)||/ATI/i.exec(i)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(i)||/SwiftShader/i.exec(t)?"software":"unknown"}function sq(i,t){return/Metal/i.exec(i)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(i)||/ANGLE/i.exec(t)?"opengl":"unknown"}function oq(i,t){if(/SwiftShader/i.exec(i)||/SwiftShader/i.exec(t))return"cpu";switch(dL(i,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function pL(i){switch(i){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(i))}const BA="WEBGL_compressed_texture_s3tc",RA="WEBGL_compressed_texture_s3tc_srgb",qd="EXT_texture_compression_rgtc",Kd="EXT_texture_compression_bptc",aq="WEBGL_compressed_texture_etc",lq="WEBGL_compressed_texture_astc",uq="WEBGL_compressed_texture_etc1",cq="WEBGL_compressed_texture_pvrtc",hq="WEBGL_compressed_texture_atc",$T="EXT_texture_norm16",tS="EXT_render_snorm",fq="EXT_color_buffer_float",Gx={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[tS],"norm16-renderable-webgl":[$T],"snorm16-renderable-webgl":[$T,tS],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[BA,RA,qd,Kd],"texture-compression-bc5-webgl":[qd],"texture-compression-bc7-webgl":[Kd],"texture-compression-etc2":[aq],"texture-compression-astc":[lq],"texture-compression-etc1-webgl":[uq],"texture-compression-pvrtc-webgl":[cq],"texture-compression-atc-webgl":[hq]};function dq(i){return i in Gx}function pq(i,t,e){return(Gx[t]||[]).every(n=>_p(i,n,e))}const jx={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:fq,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:BA},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:RA},"bc1-rgba-unorm":{gl:33777,x:BA},"bc1-rgba-unorm-srgb":{gl:35916,x:RA},"bc2-rgba-unorm":{gl:33778,x:BA},"bc2-rgba-unorm-srgb":{gl:35918,x:RA},"bc3-rgba-unorm":{gl:33779,x:BA},"bc3-rgba-unorm-srgb":{gl:35919,x:RA},"bc4-r-unorm":{gl:36283,x:qd},"bc4-r-snorm":{gl:36284,x:qd},"bc5-rg-unorm":{gl:36285,x:qd},"bc5-rg-snorm":{gl:36286,x:qd},"bc6h-rgb-ufloat":{gl:36495,x:Kd},"bc6h-rgb-float":{gl:36494,x:Kd},"bc7-rgba-unorm":{gl:36492,x:Kd},"bc7-rgba-unorm-srgb":{gl:36493,x:Kd},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Aq(i,t,e){let n=t.create;const r=jx[t.format];return r?.gl===void 0&&(n=!1),r?.x&&(n=n&&!!_p(i,r.x,e)),{format:t.format,create:n&&t.create,render:n&&t.render,filter:n&&t.filter,blend:n&&t.blend,store:n&&t.store}}function AL(i){const t=jx[i],e=yq(i),n=np.getInfo(i);return n.compressed&&(t.dataFormat=e),{internalFormat:e,format:t?.dataFormat||gq(n.channels,n.integer,n.normalized,e),type:n.dataType?pL(n.dataType):t?.types?.[0]||5121,compressed:n.compressed||!1}}function mq(i){switch(np.getInfo(i).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${i}`)}}function gq(i,t,e,n){if(n===6408||n===6407)return n;switch(i){case"r":return t&&!e?36244:6403;case"rg":return t&&!e?33320:33319;case"rgb":return t&&!e?36248:6407;case"rgba":return t&&!e?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function yq(i){const t=jx[i]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${i}`);return t}const eS={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class vq extends DU{gl;extensions;testedFeatures=new Set;constructor(t,e,n){super([],n),this.gl=t,this.extensions=e,_p(t,"EXT_color_buffer_float",e)}*[Symbol.iterator](){const t=this.getFeatures();for(const e of t)this.has(e)&&(yield e);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),dq(t)&&pq(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(e=>e!=="polygon-mode-webgl");for(const e of t)this.has(e)}getFeatures(){return[...Object.keys(eS),...Object.keys(Gx)]}getWebGLFeature(t){const e=eS[t];return typeof e=="string"?!!_p(this.gl,e,this.extensions):!!e}}class _q extends LU{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class jA extends My{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(t,e){super(t,e);const n=e.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let e=0;e<this.colorAttachments.length;++e){const n=this.colorAttachments[e];if(n){const r=36064+e;this._attachTextureView(r,n)}}if(this.depthStencilAttachment){const e=mq(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(e!==36053)throw new Error(`Framebuffer ${xq(e)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,e){const{gl:n}=this.device,{texture:r}=e,o=e.props.baseMipLevel,s=e.props.baseArrayLayer;switch(n.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,t,r.handle,o,s);break;case 34067:const l=bq(s);n.framebufferTexture2D(36160,t,l,r.handle,o);break;case 3553:n.framebufferTexture2D(36160,t,3553,r.handle,o);break;default:throw new Error("Illegal texture type")}n.bindTexture(r.glTarget,null)}}function bq(i){return i<34069?i+34069:i}function xq(i){switch(i){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${i}`}}class wq extends jh{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(t,e){super(e),this.device=t,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new jA(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const N_={};function Eq(i="id"){N_[i]=N_[i]||1;const t=N_[i]++;return`${i}-${t}`}class WA extends br{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(t,e={}){super(t,e),this.device=t,this.gl=this.device.gl;const n=typeof e=="object"?e.handle:void 0;this.handle=n||this.gl.createBuffer(),t._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=Cq(this.props.usage),this.glUsage=Tq(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,e.data?this._initWithData(e.data,e.byteOffset,e.byteLength):this._initWithByteLength(e.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(t,e=0,n=t.byteLength+e){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,this.glUsage),this.gl.bufferSubData(r,e,t),this.gl.bindBuffer(r,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,e,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){let e=t;t===0&&(e=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,e,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}write(t,e=0){const n=ArrayBuffer.isView(t)?t:new Uint8Array(t),r=36663;this.gl.bindBuffer(r,this.handle),this.gl.bufferSubData(r,e,n),this.gl.bindBuffer(r,null),this._setDebugData(t,e,t.byteLength)}async mapAndWriteAsync(t,e=0,n=this.byteLength-e){const r=new ArrayBuffer(n);await t(r,"copied"),this.write(r,e)}async readAsync(t=0,e){return this.readSyncWebGL(t,e)}async mapAndReadAsync(t,e=0,n){const r=await this.readAsync(e,n);return await t(r.buffer,"copied")}readSyncWebGL(t=0,e){e=e??this.byteLength-t;const n=new Uint8Array(e);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,0,e),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,e),n}}function Cq(i){return i&br.INDEX?34963:i&br.VERTEX?34962:i&br.UNIFORM?35345:34962}function Tq(i){return i&br.INDEX||i&br.VERTEX?35044:i&br.UNIFORM?35048:35044}function Sq(i){const t=i.split(/\r?\n/),e=[];for(const n of t){if(n.length<=1)continue;const r=n.split(":");if(r.length===2){const[C,I]=r;e.push({message:I.trim(),type:iS(C),lineNum:0,linePos:0});continue}const[o,s,l,...c]=r;let y=parseInt(l,10);isNaN(y)&&(y=0);let _=parseInt(s,10);isNaN(_)&&(_=0),e.push({message:c.join(":").trim(),type:iS(o),lineNum:y,linePos:_})}return e}function iS(i){const t=["warning","error","info"],e=i.toLowerCase();return t.includes(e)?e:"info"}class Pq extends Iy{device;handle;constructor(t,e){switch(super(t,e),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?Sq(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:e}=this.device;if(e.shaderSource(this.handle,t),e.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Xe.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Xe.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async n=>await new Promise(r=>setTimeout(r,n));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:e}=this.device;for(;;){if(e.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Iq(i,t,e,n){if(Lq(t))return n(i);const r=i;r.pushState();try{return Mq(i,t),kp(r.gl,e),n(i)}finally{r.popState()}}function Mq(i,t){const e=i,{gl:n}=e;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(Qh("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&i.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&i.features.has("provoking-vertex-webgl")){const r=e.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Qh("provokingVertex",t.provokingVertex,{first:36429,last:36430});r?.provokingVertexWEBGL(o)}if((t.polygonMode||t.polygonOffsetLine)&&i.features.has("polygon-mode-webgl")){if(t.polygonMode){const r=e.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Qh("polygonMode",t.polygonMode,{fill:6914,line:6913});r?.polygonModeWEBGL(1028,o),r?.polygonModeWEBGL(1029,o)}t.polygonOffsetLine&&n.enable(10754)}if(i.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(Rq("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Nb("depthCompare",t.depthCompare))),t.stencilWriteMask){const r=t.stencilWriteMask;n.stencilMaskSeparate(1028,r),n.stencilMaskSeparate(1029,r)}if(t.stencilReadMask&&Xe.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const r=t.stencilReadMask||4294967295,o=Nb("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,r),n.stencilFuncSeparate(1029,o,0,r)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const r=z_("stencilPassOperation",t.stencilPassOperation),o=z_("stencilFailOperation",t.stencilFailOperation),s=z_("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,s,r),n.stencilOpSeparate(1029,o,s,r)}switch(t.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(t.blendColorOperation||t.blendAlphaOperation){const r=nS("blendColorOperation",t.blendColorOperation||"add"),o=nS("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(r,o);const s=C0("blendColorSrcFactor",t.blendColorSrcFactor||"one"),l=C0("blendColorDstFactor",t.blendColorDstFactor||"zero"),c=C0("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),y=C0("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(s,l,c,y)}}function Nb(i,t){return Qh(i,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function z_(i,t){return Qh(i,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function nS(i,t){return Qh(i,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function C0(i,t,e="color"){return Qh(i,t,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:e==="color"?32769:32771,"one-minus-constant":e==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function Bq(i,t){return`Illegal parameter ${t} for ${i}`}function Qh(i,t,e){if(!(t in e))throw new Error(Bq(i,t));return e[t]}function Rq(i,t){return t}function Lq(i){let t=!0;for(const e in i){t=!1;break}return t}function mL(i){const t={};return i.addressModeU&&(t[10242]=U_(i.addressModeU)),i.addressModeV&&(t[10243]=U_(i.addressModeV)),i.addressModeW&&(t[32882]=U_(i.addressModeW)),i.magFilter&&(t[10240]=zb(i.magFilter)),(i.minFilter||i.mipmapFilter)&&(t[10241]=Dq(i.minFilter||"linear",i.mipmapFilter)),i.lodMinClamp!==void 0&&(t[33082]=i.lodMinClamp),i.lodMaxClamp!==void 0&&(t[33083]=i.lodMaxClamp),i.type==="comparison-sampler"&&(t[34892]=34894),i.compare&&(t[34893]=Nb("compare",i.compare)),i.maxAnisotropy&&(t[34046]=i.maxAnisotropy),t}function U_(i){switch(i){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function zb(i){switch(i){case"nearest":return 9728;case"linear":return 9729}}function Dq(i,t="none"){if(!t)return zb(i);switch(t){case"none":return zb(i);case"nearest":switch(i){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(i){case"nearest":return 9986;case"linear":return 9987}}}class kq extends tf{device;handle;parameters;constructor(t,e){super(t,e),this.device=t,this.parameters=mL(e),this.handle=e.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[e,n]of Object.entries(t)){const r=Number(e);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,n);break;default:this.device.gl.samplerParameteri(this.handle,r,n);break}}}}function sm(i,t,e){if(Oq(t))return e(i);const{nocatch:n=!0}=t,r=Yh.get(i);r.push(),kp(i,t);let o;if(n)o=e(i),r.pop();else try{o=e(i)}finally{r.pop()}return o}function Oq(i){for(const t in i)return!1;return!0}class Zd extends Py{device;gl;handle;texture;constructor(t,e){super(t,{...ps.defaultProps,...e}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=e.texture}}class HA extends ps{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(t,e){super(t,e),this.device=t,this.gl=this.device.gl;const n=AL(this.props.format);this.glTarget=Fq(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:r,width:o,height:s,depth:l,mipLevels:c,glTarget:y,glInternalFormat:_}=this;switch(r){case"2d":case"cube":this.gl.texStorage2D(y,c,_,o,s);break;case"2d-array":case"3d":this.gl.texStorage3D(y,c,_,o,s,l);break;default:throw new Error(r)}this.gl.bindTexture(this.glTarget,null),this._initializeData(e.data),this.setSampler(this.props.sampler),this.view=new Zd(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Zd(this.device,{...t,texture:this})}setSampler(t={}){super.setSampler(t);const e=mL(this.sampler.props);this._setSamplerParameters(e)}copyImageData(t){const e=this._normalizeCopyImageDataOptions(t),n=e.data,{width:r,height:o,depth:s}=this,{mipLevel:l=0,byteOffset:c=0,x:y=0,y:_=0,z:C=0}=e,{glFormat:I,glType:k,compressed:z}=this,V=rS(this.glTarget,this.dimension,C);let X;if(!this.compressed){const{bytesPerPixel:$}=this.device.getTextureFormatInfo(this.format);if($){if(e.bytesPerRow%$!==0)throw new Error(`bytesPerRow (${e.bytesPerRow}) must be a multiple of bytesPerPixel (${$}) for ${this.format}`);X=e.bytesPerRow/$}}const H=this.compressed?{}:{...X!==void 0?{3314:X}:{},32878:e.rowsPerImage};this.gl.bindTexture(V,this.handle),sm(this.gl,H,()=>{switch(this.dimension){case"2d":case"cube":z?this.gl.compressedTexSubImage2D(V,l,y,_,r,o,I,n,c):this.gl.texSubImage2D(V,l,y,_,r,o,I,k,n,c);break;case"2d-array":case"3d":z?this.gl.compressedTexSubImage3D(V,l,y,_,C,r,o,s,I,n,c):this.gl.texSubImage3D(V,l,y,_,C,r,o,s,I,k,n,c);break;default:}}),this.gl.bindTexture(V,null)}copyExternalImage(t){const e=this._normalizeCopyExternalImageOptions(t);if(e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:r}=this,{image:o,depth:s,mipLevel:l,x:c,y,z:_,width:C,height:I}=e,k=rS(this.glTarget,this.dimension,s),z=e.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),sm(this.gl,z,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(k,l,c,y,C,I,n,r,o);break;case"2d-array":case"3d":this.gl.texSubImage3D(k,l,c,y,_,C,I,s,n,r,o);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:e.width,height:e.height}}generateMipmapsWebGL(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Xe.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(e){Xe.warn(`Error generating mipmap for ${this}: ${e.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(t){Xe.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[e,n]of Object.entries(t)){const r=Number(e),o=n;switch(r){case 33082:case 33083:this.gl.texParameterf(this.glTarget,r,o);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,r,o);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,r,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,r,o);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,r,o);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(t){const{gl:e}=this;return t!==void 0&&(this._textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.glTarget,this.handle),t}_unbind(t){const{gl:e}=this;return t!==void 0&&(this._textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.glTarget,null),t}}function Fq(i){switch(i){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(i)}function rS(i,t,e){return t==="cube"?34069+e:i}function Nq(i){return Gq[i]}function Wx(i){return Vq[i]}function zq(i){return!!gL[i]}function Uq(i){return gL[i]}const Vq={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},gL={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},Gq={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function jq(i,t){const e={attributes:[],bindings:[]};e.attributes=Wq(i,t);const n=qq(i,t);for(const l of n){const c=l.uniforms.map(y=>({name:y.name,format:y.format,byteOffset:y.byteOffset,byteStride:y.byteStride,arrayLength:y.arrayLength}));e.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:c})}const r=Xq(i,t);let o=0;for(const l of r)if(zq(l.type)){const{viewDimension:c,sampleType:y}=Uq(l.type);e.bindings.push({type:"texture",name:l.name,group:0,location:o,viewDimension:c,sampleType:y}),l.textureUnit=o,o+=1}r.length&&(e.uniforms=r);const s=Hq(i,t);return s?.length&&(e.varyings=s),e}function Wq(i,t){const e=[],n=i.getProgramParameter(t,35721);for(let r=0;r<n;r++){const o=i.getActiveAttrib(t,r);if(!o)throw new Error("activeInfo");const{name:s,type:l}=o,c=i.getAttribLocation(t,s);if(c>=0){const y=Wx(l),_=/instance/i.test(s)?"instance":"vertex";e.push({name:s,location:c,stepMode:_,type:y})}}return e.sort((r,o)=>r.location-o.location),e}function Hq(i,t){const e=[],n=i.getProgramParameter(t,35971);for(let r=0;r<n;r++){const o=i.getTransformFeedbackVarying(t,r);if(!o)throw new Error("activeInfo");const{name:s,type:l,size:c}=o,y=Wx(l),{type:_,components:C}=G6(y);e.push({location:r,name:s,type:_,size:c*C})}return e.sort((r,o)=>r.location-o.location),e}function Xq(i,t){const e=[],n=i.getProgramParameter(t,35718);for(let r=0;r<n;r++){const o=i.getActiveUniform(t,r);if(!o)throw new Error("activeInfo");const{name:s,size:l,type:c}=o,{name:y,isArray:_}=Kq(s);let C=i.getUniformLocation(t,y);const I={location:C,name:y,size:l,type:c,isArray:_};if(e.push(I),I.size>1)for(let k=0;k<I.size;k++){const z=`${y}[${k}]`;C=i.getUniformLocation(t,z);const V={...I,name:z,location:C};e.push(V)}}return e}function qq(i,t){const e=(o,s)=>i.getActiveUniformBlockParameter(t,o,s),n=[],r=i.getProgramParameter(t,35382);for(let o=0;o<r;o++){const s={name:i.getActiveUniformBlockName(t,o)||"",location:e(o,35391),byteLength:e(o,35392),vertex:e(o,35396),fragment:e(o,35398),uniformCount:e(o,35394),uniforms:[]},l=e(o,35395)||[],c=i.getActiveUniforms(t,l,35383),y=i.getActiveUniforms(t,l,35384),_=i.getActiveUniforms(t,l,35387),C=i.getActiveUniforms(t,l,35388);for(let I=0;I<s.uniformCount;++I){const k=i.getActiveUniform(t,l[I]);if(!k)throw new Error("activeInfo");const z=Wx(c[I]);s.uniforms.push({name:k.name,format:z,type:c[I],arrayLength:y[I],byteOffset:_[I],byteStride:C[I]})}n.push(s)}return n.sort((o,s)=>o.location-s.location),n}function Kq(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(i);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${i}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function Zq(i,t,e,n){const r=i;let o=n;o===!0&&(o=1),o===!1&&(o=0);const s=typeof o=="number"?[o]:o;switch(e){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return i.uniform1i(t,n);case 5126:return i.uniform1fv(t,s);case 35664:return i.uniform2fv(t,s);case 35665:return i.uniform3fv(t,s);case 35666:return i.uniform4fv(t,s);case 5124:return i.uniform1iv(t,s);case 35667:return i.uniform2iv(t,s);case 35668:return i.uniform3iv(t,s);case 35669:return i.uniform4iv(t,s);case 35670:return i.uniform1iv(t,s);case 35671:return i.uniform2iv(t,s);case 35672:return i.uniform3iv(t,s);case 35673:return i.uniform4iv(t,s);case 5125:return r.uniform1uiv(t,s,1);case 36294:return r.uniform2uiv(t,s,2);case 36295:return r.uniform3uiv(t,s,3);case 36296:return r.uniform4uiv(t,s,4);case 35674:return i.uniformMatrix2fv(t,!1,s);case 35675:return i.uniformMatrix3fv(t,!1,s);case 35676:return i.uniformMatrix4fv(t,!1,s);case 35685:return r.uniformMatrix2x3fv(t,!1,s);case 35686:return r.uniformMatrix2x4fv(t,!1,s);case 35687:return r.uniformMatrix3x2fv(t,!1,s);case 35688:return r.uniformMatrix3x4fv(t,!1,s);case 35689:return r.uniformMatrix4x2fv(t,!1,s);case 35690:return r.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}function Yq(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(i)}}function Qq(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(i)}}const sS=4;class Jq extends Kh{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(t,e){super(t,e),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=e.vs,this.fs=e.fs;const{varyings:n,bufferMode:r=35981}=e;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,r)),this._linkShaders(),Xe.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=jq(this.device.gl,this.handle),Xe.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=e.shaderLayout?$q(this.introspectedLayout,e.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(t,e){for(const[n,r]of Object.entries(t)){const o=this.shaderLayout.bindings.find(s=>s.name===n)||this.shaderLayout.bindings.find(s=>s.name===`${n}Uniforms`);if(!o){const s=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");e?.disableWarnings||Xe.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${s}`,r)();continue}switch(r||Xe.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(r instanceof WA)&&!(r.buffer instanceof WA))throw new Error("buffer value");break;case"texture":if(!(r instanceof Zd||r instanceof HA||r instanceof jA))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":Xe.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(o.type)}this.bindings[n]=r}}draw(t){const{renderPass:e,parameters:n=this.props.parameters,topology:r=this.props.topology,vertexArray:o,vertexCount:s,instanceCount:l,isInstanced:c=!1,firstVertex:y=0,transformFeedback:_}=t,C=Yq(r),I=!!o.indexBuffer,k=o.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Xe.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Xe.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(e),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const z=e;return Iq(this.device,n,z.glParameters,()=>{I&&c?this.device.gl.drawElementsInstanced(C,s||0,k,y,l||0):I?this.device.gl.drawElements(C,s||0,k,y):c?this.device.gl.drawArraysInstanced(C,y,s||0,l||0):this.device.gl.drawArrays(C,y,s||0),_&&_.end()}),o.unbindAfterRender(e),!0}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Xe.time(sS,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),Xe.timeEnd(sS,`linkProgram for ${this.id}`)(),Xe.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Xe.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Xe.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const e=this._getLinkStatus();this._reportLinkStatus(e)}async _reportLinkStatus(t){switch(t){case"success":return;default:const e=t==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${e} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${e} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const n=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${e} during ${t}: ${n}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const t=async n=>await new Promise(r=>setTimeout(r,n));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:e}=this.device;for(;;){if(e.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const e of this.shaderLayout.bindings)!this.bindings[e.name]&&!this.bindings[e.name.replace(/Uniforms$/,"")]&&(Xe.warn(`Binding ${e.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let e=0,n=0;for(const r of this.shaderLayout.bindings){const o=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:s}=r,l=t.getUniformBlockIndex(this.handle,s);if(l===4294967295)throw new Error(`Invalid uniform block name ${s}`);t.uniformBlockBinding(this.handle,n,l),o instanceof WA?t.bindBufferBase(35345,n,o.handle):t.bindBufferRange(35345,n,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),n+=1;break;case"texture":if(!(o instanceof Zd||o instanceof HA||o instanceof jA))throw new Error("texture");let c;if(o instanceof Zd)c=o.texture;else if(o instanceof HA)c=o;else if(o instanceof jA&&o.colorAttachments[0]instanceof Zd)Xe.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=o.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+e),t.bindTexture(c.glTarget,c.handle),e+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:e,location:n,type:r,textureUnit:o}=t,s=this.uniforms[e]??o;s!==void 0&&Zq(this.device.gl,n,r,s)}}}function $q(i,t){const e={...i,attributes:i.attributes.map(n=>({...n}))};for(const n of t?.attributes||[]){const r=e.attributes.find(o=>o.name===n.name);r?(r.type=n.type||r.type,r.stepMode=n.stepMode||r.stepMode):Xe.warn(`shader layout attribute ${n.name} not present in shader`)}return e}class tK extends lx{device;handle=null;commands=[];constructor(t){super(t,{}),this.device=t}_executeCommands(t=this.commands){for(const e of t)switch(e.name){case"copy-buffer-to-buffer":eK(this.device,e.options);break;case"copy-buffer-to-texture":iK(this.device,e.options);break;case"copy-texture-to-buffer":nK(this.device,e.options);break;case"copy-texture-to-texture":rK(this.device,e.options);break;default:throw new Error(e.name)}}}function eK(i,t){const e=t.sourceBuffer,n=t.destinationBuffer;i.gl.bindBuffer(36662,e.handle),i.gl.bindBuffer(36663,n.handle),i.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),i.gl.bindBuffer(36662,null),i.gl.bindBuffer(36663,null)}function iK(i,t){throw new Error("Not implemented")}function nK(i,t){const{sourceTexture:e,mipLevel:n=0,aspect:r="all",width:o=t.sourceTexture.width,height:s=t.sourceTexture.height,depthOrArrayLayers:l=0,origin:c=[0,0],destinationBuffer:y,byteOffset:_=0,bytesPerRow:C,rowsPerImage:I}=t;if(r!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||l!==0||C||I)throw new Error("not implemented");const{framebuffer:k,destroyFramebuffer:z}=yL(e);let V;try{const X=y,H=o||k.width,$=s||k.height,Y=AL(k.colorAttachments[0].texture.props.format),ct=Y.format,rt=Y.type;i.gl.bindBuffer(35051,X.handle),V=i.gl.bindFramebuffer(36160,k.handle),i.gl.readPixels(c[0],c[1],H,$,ct,rt,_)}finally{i.gl.bindBuffer(35051,null),V!==void 0&&i.gl.bindFramebuffer(36160,V),z&&k.destroy()}}function rK(i,t){const{sourceTexture:e,destinationMipLevel:n=0,origin:r=[0,0],destinationOrigin:o=[0,0],destinationTexture:s}=t;let{width:l=t.destinationTexture.width,height:c=t.destinationTexture.height}=t;const{framebuffer:y,destroyFramebuffer:_}=yL(e),[C,I]=r,[k,z,V]=o,X=i.gl.bindFramebuffer(36160,y.handle);let H,$;if(s instanceof HA)H=s,l=Number.isFinite(l)?l:H.width,c=Number.isFinite(c)?c:H.height,H._bind(0),$=H.glTarget;else throw new Error("invalid destination");switch($){case 3553:case 34067:i.gl.copyTexSubImage2D($,n,k,z,C,I,l,c);break;case 35866:case 32879:i.gl.copyTexSubImage3D($,n,k,z,V,C,I,l,c);break}H&&H._unbind(),i.gl.bindFramebuffer(36160,X),_&&y.destroy()}function yL(i){if(i instanceof ps){const{width:t,height:e,id:n}=i;return{framebuffer:i.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:e,colorAttachments:[i]}),destroyFramebuffer:!0}}return{framebuffer:i,destroyFramebuffer:!1}}const sK=[1,2,4,8];class oK extends Uh{device;handle=null;glParameters={};constructor(t,e){super(t,e),this.device=t;let n;if(!e?.parameters?.viewport)if(e?.framebuffer){const{width:o,height:s}=e.framebuffer;n=[0,0,o,s]}else{const[o,s]=t.getDefaultCanvasContext().getDrawingBufferSize();n=[0,0,o,s]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});const r=this.props.framebuffer;if(this.props.framebuffer&&r?.handle){const o=this.props.framebuffer.colorAttachments.map((s,l)=>36064+l);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const e={...this.glParameters};e.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(e.depthMask=!this.props.depthReadOnly),e.stencilMask=this.props.stencilReadOnly?0:1,e[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(e.viewport=t.viewport.slice(0,4),e.depthRange=[t.viewport[4],t.viewport[5]]):e.viewport=t.viewport),t.scissorRect&&(e.scissorTest=!0,e.scissor=t.scissorRect),t.blendConstant&&(e.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=t.stencilReference),"colorMask"in t&&(e.colorMask=sK.map(n=>!!(n&t.colorMask))),this.glParameters=e,kp(this.device.gl,e)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const t={...this.glParameters};let e=0;this.props.clearColors&&this.props.clearColors.forEach((n,r)=>{n&&this.clearColorBuffer(r,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(e|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(e|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(e|=1024,t.clearStencil=this.props.clearStencil),e!==0&&sm(this.device.gl,t,()=>{this.device.gl.clear(e)})}clearColorBuffer(t=0,e=[0,0,0,0]){sm(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,e);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,e);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,e);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class oS extends ax{device;handle=null;commandBuffer;constructor(t,e){super(t,e),this.device=t,this.commandBuffer=new tK(t)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(t){return new oK(this.device,t)}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,e,n){}}function aK(i){const{target:t,source:e,start:n=0,count:r=1}=i,o=e.length,s=r*o;let l=0;for(let c=n;l<o;l++)t[c++]=e[l];for(;l<s;)l<s-l?(t.copyWithin(n+l,n,n+l),l*=2):(t.copyWithin(n+l,n,n+s-l),l=s);return i.target}class Hx extends ux{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return GF()==="Chrome"}constructor(t,e){super(t,e),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const e=t;if(e&&e.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,e?e.handle:null),this.indexBuffer=e,this.device.gl.bindVertexArray(null)}setBuffer(t,e){const n=e;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:o,stride:s,offset:l,normalized:c,integer:y,divisor:_}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),y?this.device.gl.vertexAttribIPointer(t,r,o,s,l):this.device.gl.vertexAttribPointer(t,r,o,c,s,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,_||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,e){this._enable(t,!1),this.attributes[t]=e}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const e=this.attributes[t];ArrayBuffer.isView(e)&&this.device.setConstantAttributeWebGL(t,e)}}_getAccessor(t){const e=this.attributeInfos[t];if(!e)throw new Error(`Unknown attribute location ${t}`);const n=pL(e.bufferDataType);return{size:e.bufferComponents,type:n,stride:e.byteStride,offset:e.byteOffset,normalized:e.normalized,integer:e.integer,divisor:e.stepMode==="instance"?1:0}}_enable(t,e=!0){const n=Hx.isConstantAttributeZeroSupported(this.device)||t!==0;(e||n)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),e?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,e){const n=lK(e),r=n.byteLength*t,o=n.length*t;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),s||=!uK(n,this.bufferValue),s){const l=u7(e.constructor,o);aK({target:l,source:n,start:0,count:o}),this.buffer.write(l),this.bufferValue=e}return this.buffer}}function lK(i){return Array.isArray(i)?new Float32Array(i):i}function uK(i,t){if(!i||!t||i.length!==t.length||i.constructor!==t.constructor)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}class cK extends cx{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,e){super(t,e),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,e.buffers&&this.setBuffers(e.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Qq(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])})}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:r,byteLength:o,byteOffset:s}=this._getBufferRange(e);if(n<0){this.unusedBuffers[t]=r,Xe.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:r,byteLength:o,byteOffset:s},this.bindOnUse||this._bindBuffer(n,r,s,o)}getBuffer(t){if(aS(t))return this.buffers[t]||null;const e=this._getVaryingIndex(t);return e>=0?this.buffers[e]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let e;return this._bound?e=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,e=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),e}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof WA)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:e,byteOffset:n=0,byteLength:r=t.buffer.byteLength}=t;return{buffer:e,byteOffset:n,byteLength:r}}_getVaryingIndex(t){if(aS(t))return Number(t);for(const e of this.layout.varyings||[])if(t===e.name)return e.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:e,byteLength:n,byteOffset:r}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),e,r,n)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,e,n=0,r){const o=e&&e.handle;!o||r===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,n,r)}}function aS(i){return typeof i=="number"?Number.isInteger(i):/^\d+$/.test(i)}class hK extends hx{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,e){if(super(t,e),this.device=t,e.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((n,r)=>{const o=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function vL(i){switch(i){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function fK(i){switch(i){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function dK(i){return pK[i]}const pK={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function AK(i,t){const{sourceX:e=0,sourceY:n=0,sourceAttachment:r=0}=t||{};let{target:o=null,sourceWidth:s,sourceHeight:l,sourceDepth:c,sourceFormat:y,sourceType:_}=t||{};const{framebuffer:C,deleteFramebuffer:I}=_L(i),{gl:k,handle:z}=C;s||=C.width,l||=C.height;const V=C.colorAttachments[r]?.texture;if(!V)throw new Error(`Invalid framebuffer attachment ${r}`);c=V?.depth||1,y||=V?.glFormat||6408,_||=V?.glType||5121,o=yK(o,_,y,s,l);const X=nx(o);_=_||Nq(X);const H=k.bindFramebuffer(36160,z);return k.readBuffer(36064+r),k.readPixels(e,n,s,l,y,_,o),k.readBuffer(36064),k.bindFramebuffer(36160,H||null),I&&C.destroy(),o}function mK(i,t){const{target:e,sourceX:n=0,sourceY:r=0,sourceFormat:o=6408,targetByteOffset:s=0}=t||{};let{sourceWidth:l,sourceHeight:c,sourceType:y}=t||{};const{framebuffer:_,deleteFramebuffer:C}=_L(i);l=l||_.width,c=c||_.height;const I=_;y=y||5121;let k=e;if(!k){const V=vL(o),X=fK(y),H=s+l*c*V*X;k=I.device.createBuffer({byteLength:H})}const z=i.device.createCommandEncoder();return z.copyTextureToBuffer({sourceTexture:i,width:l,height:c,origin:[n,r],destinationBuffer:k,byteOffset:s}),z.destroy(),C&&_.destroy(),k}function _L(i){return i instanceof My?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:gK(i),deleteFramebuffer:!0}}function gK(i,t){const{device:e,width:n,height:r,id:o}=i;return e.createFramebuffer({...t,id:`framebuffer-for-${o}`,width:n,height:r,colorAttachments:[i]})}function yK(i,t,e,n,r,o){if(i)return i;t||=5121;const s=dK(t),l=rx(s),c=vL(e);return new l(n*r*c)}class Ub extends $h{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(t){switch(t){case"unorm8x4-bgra":return!1;default:return!0}}constructor(t){super({...t,id:t.id||Eq("webgl-device")});const e=$h._getCanvasContextProps(t);if(!e)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=e.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new wq(this,e),this.lost=new Promise(c=>{this._resolveContextLost=c});const r={...t.webgl};e.alphaMode==="premultiplied"&&(r.premultipliedAlpha=!0),t.powerPreference!==void 0&&(r.powerPreference=t.powerPreference);const o=this.props._handle||nq(this.canvasContext.canvas,{onContextLost:c=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:c=>console.log("WebGL context restored")},r);if(!o)throw new Error("WebGL context creation failed");if(n=o.device,n){if(t._reuseDevices)return Xe.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=o,this.gl=o,this.spectorJS=zX({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=rq(this.gl,this._extensions),this.limits=new _q(this.gl),this.features=new vq(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new Yh(this.gl,{log:(...c)=>Xe.log(1,...c)()}).trackState(this.gl,{copyState:!1});const s=t.debugWebGL||t.debug,l=t.debugWebGL;s&&(this.gl=GX(this.gl,{debugWebGL:s,traceWebGL:l}),Xe.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(Xe.level=Math.max(Xe.level,1))),this.commandEncoder=new oS(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const e=this._normalizeBufferProps(t);return new WA(this,e)}createTexture(t){return new HA(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new kq(this,t)}createShader(t){return new Pq(this,t)}createFramebuffer(t){return new jA(this,t)}createVertexArray(t){return new Hx(this,t)}createTransformFeedback(t){return new cK(this,t)}createQuerySet(t){return new hK(this,t)}createRenderPipeline(t){return new Jq(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(t={}){return new oS(this,t)}submit(t){t||(t=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),t._executeCommands()}readPixelsToArrayWebGL(t,e){return AK(t,e)}readPixelsToBufferWebGL(t,e){return mK(t,e)}setParametersWebGL(t){kp(this.gl,t)}getParametersWebGL(t){return fL(this.gl,t)}withParametersWebGL(t,e){return sm(this.gl,t,e)}resetWebGL(){Xe.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),JX(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return Aq(this.gl,t,this._extensions)}loseDevice(){let t=!1;const e=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return e&&(t=!0,e.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Yh.get(this.gl).push()}popState(){Yh.get(this.gl).pop()}getGLKey(t,e){const n=Number(t);for(const r in this.gl)if(this.gl[r]===n)return`GL.${r}`;return e?.emptyIfUnknown?"":String(t)}getGLKeys(t){const e={emptyIfUnknown:!0};return Object.entries(t).reduce((n,[r,o])=>(n[`${r}:${this.getGLKey(r,e)}`]=`${o}:${this.getGLKey(o,e)}`,n),{})}setConstantAttributeWebGL(t,e){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const r=this._constants[t];switch(r&&xK(r,e)&&Xe.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=e,e.constructor){case Float32Array:vK(this,t,e);break;case Int32Array:_K(this,t,e);break;case Uint32Array:bK(this,t,e);break;default:throw new Error("constant")}}getExtension(t){return _p(this.gl,t,this._extensions),this._extensions}_setWebGLDebugMetadata(t,e,n){t.luma=e;const r={props:n.spector,id:n.spector.id};t.__SPECTOR_Metadata=r}}function vK(i,t,e){switch(e.length){case 1:i.gl.vertexAttrib1fv(t,e);break;case 2:i.gl.vertexAttrib2fv(t,e);break;case 3:i.gl.vertexAttrib3fv(t,e);break;case 4:i.gl.vertexAttrib4fv(t,e);break}}function _K(i,t,e){i.gl.vertexAttribI4iv(t,e)}function bK(i,t,e){i.gl.vertexAttribI4uiv(t,e)}function xK(i,t){if(!i||!t||i.length!==t.length||i.constructor!==t.constructor)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}const lS=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:Ub},Symbol.toStringTag,{value:"Module"}));function Oc(){}const wK=({isDragging:i})=>i?"grabbing":"grab",bL={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Oc,onWebGLInitialized:Oc,onResize:Oc,onViewStateChange:Oc,onInteractionStateChange:Oc,onBeforeRender:Oc,onAfterRender:Oc,onLoad:Oc,onError:i=>$i.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:wK,getTooltip:null,debug:!1,drawPickingColors:!1};class Xx{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Bp({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;r.x=o.x,r.y=o.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n},this._onEvent=n=>{const r=Pb[n.type],o=n.offsetCenter;if(!r||!o||!this.layerManager)return;const s=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:s,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:c}=l,y=c&&(c[r]||c.props[r]),_=this.props[r];let C=!1;y&&(C=y.call(c,l,n)),C||(_?.(l,n),this.widgetManager.onEvent(l,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const r=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...bL,...t},t=this.props,t.viewState&&t.initialViewState&&$i.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let e=this.device;!e&&t.gl&&(t.gl instanceof WebGLRenderingContext&&$i.error("WebGL1 context not supported.")(),e=O_.attach(t.gl,this.props.deviceProps)),e||(e=this._createDevice(t)),this.animationLoop=this._createAnimationLoop(e,t),this.setProps(t),t._typedArrayManagerProps&&yp.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&$i.removed("onLayerHover","onHover")(),"onLayerClick"in t&&$i.removed("onLayerClick","onClick")(),t.initialViewState&&!Or(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);if(Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),t.device&&t.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==t.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),$i.log(`recreating animation loop for new device! id=${t.device.id}`)(),this.animationLoop=this._createAnimationLoop(t.device,t),this.animationLoop.start()),this.animationLoop?.setProps(e),t.useDevicePixels!==void 0&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=t.useDevicePixels;const n=this.device.canvasContext.canvas,r={target:n,contentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],devicePixelContentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],borderBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}]};this.device.canvasContext._handleResize([r])}this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e),this.widgetManager.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),r=this.layerManager.needsRedraw(t),o=this.effectManager.needsRedraw(t),s=this.deckRenderer.needsRedraw(t);return e=e||n||r||o||s,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return eo(this.viewManager),this.viewManager.views}getViewports(t){return eo(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,e,n){eo(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(e).timeStart();const o=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return r.get(e).timeEnd(),o}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),eo(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",t.width&&typeof t.width=="number"&&(e.width=t.width),t.height&&typeof t.height=="number"&&(e.height=t.height),(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:n}=t;if(e||e===0){const r=Number.isFinite(e)?`${e}px`:e;this.canvas.style.width=r}if(n||n===0){const r=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=r}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const e=t.clientWidth??t.width,n=t.clientHeight??t.height;(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.viewManager?.setProps({width:e,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:e,height:n}))}_createAnimationLoop(t,e){const{gl:n,onError:r}=e;return new Ox({device:t,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:r})}_createDevice(t){const e=this.props.deviceProps?.createCanvasContext,n=typeof e=="object"?e:void 0,r={adapters:[],...t.deviceProps};r.adapters.includes(O_)||r.adapters.push(O_);const o={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return gb.createDevice({_reuseDevices:!0,type:"webgl",...r,createCanvasContext:{...o,...n,canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,e=Array.isArray(t)?t:t?[t]:[new lL({id:"default-view"})];return e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:t}=this;if(t.event){const{result:e,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=e.length>0;let r=n,o=!1;for(const s of e)r=s,o=s.layer?.onHover(s,t.event)||o;o||(this.props.onHover?.(r,t.event),this.widgetManager.onHover(r,t.event)),t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const e=new eL;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new zj(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(xT).map(r=>{const[o,s,l,c]=xT[r],y=this.props.eventRecognizerOptions?.[r],_={...s,...y,event:r};return{recognizer:new o(_),recognizeWith:l,requestFailure:c}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in Pb)this.eventManager.on(r,this._onEvent);this.viewManager=new nX({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new iX(this.device,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new vX({deck:this,device:this.device}),this.deckRenderer=new xX(this.device),this.deckPicker=new CX(this.device),this.widgetManager=new PX({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new uL),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{device:n,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:r});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),$i.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=gb.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}Xx.defaultProps=bL;Xx.VERSION=Uz;function EK(i){switch(i){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return rx(i)}}const CK=nx;function T0(i,t,e){const n=e==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:i,format:t.size>1?`${n}x${t.size}`:t.type,byteOffset:t.offset||0}}function Wh(i){return i.stride||i.size*i.bytesPerElement}function TK(i,t){return i.type===t.type&&i.size===t.size&&Wh(i)===Wh(t)&&(i.offset||0)===(t.offset||0)}function Vb(i,t){t.offset&&$i.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=Wh(i),n=t.vertexOffset!==void 0?t.vertexOffset:i.vertexOffset||0,r=t.elementOffset||0,o=n*e+r*i.bytesPerElement+(i.offset||0);return{...t,offset:o,stride:e}}function SK(i,t){const e=Vb(i,t);return{high:e,low:{...e,offset:e.offset+i.size*4}}}class PK{constructor(t,e,n){this._buffer=null,this.device=t,this.id=e.id||"",this.size=e.size||1;const r=e.logicalType||e.type,o=r==="float64";let{defaultValue:s}=e;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let l;o?l="float32":!r&&e.isIndexed?l="uint32":l=r||"float32";let c=EK(r||l);this.doublePrecision=o,o&&e.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...e,defaultType:c,defaultValue:s,logicalType:r,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Wh(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),yp.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,e=null){const n={};if(this.state.constant){const r=this.value;if(e){const o=Vb(this.getAccessor(),e),s=o.offset/r.BYTES_PER_ELEMENT,l=o.size||this.size;n[t]=r.subarray(s,s+l)}else n[t]=r}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,e=null){const n=this.getAccessor(),r=[],o={name:this.id,byteStride:Wh(n),attributes:r};if(this.doublePrecision){const s=SK(n,e||{});r.push(T0(t,{...n,...s.high},this.device.type),T0(`${t}64Low`,{...n,...s.low},this.device.type))}else if(e){const s=Vb(n,e);r.push(T0(t,{...n,...s},this.device.type))}else r.push(T0(t,n,this.device.type));return o}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:r}=this,o=n*r;if(e&&o&&e.length>=o){const s=new Array(r).fill(1/0),l=new Array(r).fill(-1/0);for(let c=0;c<o;)for(let y=0;y<r;y++){const _=e[c++];_<s[y]&&(s[y]=_),_>l[y]&&(l[y]=_)}t=[s,l]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof br?n={buffer:t}:n=t;const r={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)r.type="float32";else{const o=CK(n.value);r.type=r.normalized?o.replace("int","norm"):o}r.bytesPerElement=n.value.BYTES_PER_ELEMENT,r.stride=Wh(r)}if(e.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!e.constant||!this._areValuesEqual(o,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){const o=n.buffer;e.externalBuffer=o,e.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;e.externalBuffer=null,e.constant=!1,this.value=o;let{buffer:s}=this;const l=Wh(r),c=(r.vertexOffset||0)*l;if(this.doublePrecision&&o instanceof Float64Array&&(o=M_(o,r)),this.settings.isIndexed){const _=this.settings.defaultType;o.constructor!==_&&(o=new _(o))}const y=o.byteLength+c+l*2;(!s||s.byteLength<y)&&(s=this._createBuffer(y)),s.write(o,c)}return this.setAccessor(r),!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:r}=t;this.buffer.write(this.doublePrecision&&e instanceof Float64Array?M_(e,{size:this.size,startIndex:n,endIndex:r}):e.subarray(n,r),n*e.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,e=!1){const{state:n}=this,r=n.allocatedValue,o=yp.allocate(r,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=o;const{byteOffset:s}=this;let{buffer:l}=this;return(!l||l.byteLength<o.byteLength+s)&&(l=this._createBuffer(o.byteLength+s),e&&r&&l.write(r instanceof Float64Array?M_(r,this):r,s)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=e.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${e.constructor.name}`);!(e instanceof n)&&this.settings.normalized&&!("normalized"in t)&&$i.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(e=>e/255);case"unorm16":return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,n){const{defaultValue:r,size:o}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t){let s=o;for(;--s>=0;)e[n+s]=r[s];return e}switch(o){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:r[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:r[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:r[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:r[0];break;default:let s=o;for(;--s>=0;)e[n+s]=Number.isFinite(t[s])?t[s]:r[s]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();const{isIndexed:e,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(e?br.INDEX:br.VERTEX)|br.COPY_DST,indexType:e?n:void 0,byteLength:t}),this._buffer}}const uS=[],cS=[];function fu(i,t=0,e=1/0){let n=uS;const r={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?n=i:i.length>0&&(cS.length=i.length,n=cS):n=uS,(t>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,e),r.index=t-1),{iterable:n,objectInfo:r}}function xL(i){return i&&i[Symbol.asyncIterator]}function wL(i,t){const{size:e,stride:n,offset:r,startIndices:o,nested:s}=t,l=i.BYTES_PER_ELEMENT,c=n?n/l:e,y=r?r/l:0,_=Math.floor((i.length-y)/c);return(C,{index:I,target:k})=>{if(!o){const H=I*c+y;for(let $=0;$<e;$++)k[$]=i[H+$];return k}const z=o[I],V=o[I+1]||_;let X;if(s){X=new Array(V-z);for(let H=z;H<V;H++){const $=H*c+y;k=new Array(e);for(let Y=0;Y<e;Y++)k[Y]=i[$+Y];X[H-z]=k}}else if(c===e)X=i.subarray(z*e+y,V*e+y);else{X=new i.constructor((V-z)*e);let H=0;for(let $=z;$<V;$++){const Y=$*c+y;for(let ct=0;ct<e;ct++)X[H++]=i[Y+ct]}}return X}}const IK=[],_g=[[0,1/0]];function MK(i,t){if(i===_g||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return i;const e=[],n=i.length;let r=0;for(let o=0;o<n;o++){const s=i[o];s[1]<t[0]?(e.push(s),r=o+1):s[0]>t[1]?e.push(s):t=[Math.min(s[0],t[0]),Math.max(s[1],t[1])]}return e.splice(r,0,t),e}const BK={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function EL(i,t){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const e=i.type||"interpolation";return{...BK[e],...t,...i,type:e}}class CL extends PK{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:_g}),this.constant=!1,this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var e;(e=this.state).layoutChanged||(e.layoutChanged=!TK(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,r=Array.isArray(e)?t[e.find(o=>t[o])]:t[e];return EL(r,n)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:n=0,endRow:r=1/0}=e;this.state.updateRanges=MK(this.state.updateRanges,[n,r])}else this.state.updateRanges=_g}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=IK}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,e.updateRanges!==_g),!0):!1}updateBuffer({numInstances:t,data:e,props:n,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:s,noAlloc:l}}=this;let c=!0;if(s){for(const[y,_]of o)s.call(r,this,{data:e,startRow:y,endRow:_,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[y,_]of o){const C=Number.isFinite(y)?this.getVertexOffset(y):0,I=Number.isFinite(_)?this.getVertexOffset(_):l||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:C,endOffset:I})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(t,e){const n=this.device.type==="webgpu";if(n||e===void 0||typeof e=="function"){if(n&&typeof e!="function"){const o=this._normalizeValue(e,[],0);this._areValuesEqual(o,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const r=this.settings.transform&&t?this.settings.transform.call(t,e):e;return this.setData({constant:!0,value:r})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:n,settings:r}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),r.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const o=t;eo(ArrayBuffer.isView(o.value),`invalid ${r.accessor}`);const s=!!o.size&&o.size!==this.size;return n.binaryAccessor=wL(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:e,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,e=super.getValue();if(!t)return e;for(const n in t)Object.assign(e,super.getValue(n,t[n]));return e}getBufferLayout(t){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:r}=this.settings;if(r==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=r??"vertex",!e)return n;for(const o in e){const s=super._getBufferLayout(o,e[o]);n.attributes.push(...s.attributes)}return n}_autoUpdater(t,{data:e,startRow:n,endRow:r,props:o,numInstances:s}){if(t.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:c,value:y,size:_,startIndices:C}=t,{accessor:I,transform:k}=l;let z=c.binaryAccessor||(typeof I=="function"?I:o[I]);typeof z!="function"&&typeof I=="string"&&(z=()=>o[I]),eo(typeof z=="function",`accessor "${I}" is not a function`);let V=t.getVertexOffset(n);const{iterable:X,objectInfo:H}=fu(e,n,r);for(const $ of X){H.index++;let Y=z($,H);if(k&&(Y=k.call(this,Y)),C){const ct=(H.index<C.length-1?C[H.index+1]:s)-C[H.index];if(Y&&Array.isArray(Y[0])){let rt=V;for(const nt of Y)t._normalizeValue(nt,y,rt),rt+=_}else Y&&Y.length>_?y.set(Y,V):(t._normalizeValue(Y,H.target,0),QH({target:y,source:H.target,start:V,count:ct}));V+=ct*_}else t._normalizeValue(Y,y,V),V+=_}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function V_(i){const{source:t,target:e,start:n=0,size:r,getData:o}=i,s=i.end||e.length,l=t.length,c=s-n;if(l>c){e.set(t.subarray(0,c),n);return}if(e.set(t,n),!o)return;let y=l;for(;y<c;){const _=o(y,t);for(let C=0;C<r;C++)e[n+y]=_[C]||0,y++}}function RK({source:i,target:t,size:e,getData:n,sourceStartIndices:r,targetStartIndices:o}){if(!r||!o)return V_({source:i,target:t,size:e,getData:n}),t;let s=0,l=0;const c=n&&((_,C)=>n(_+l,C)),y=Math.min(r.length,o.length);for(let _=1;_<y;_++){const C=r[_]*e,I=o[_]*e;V_({source:i.subarray(s,C),target:t,start:l,end:I,size:e,getData:c}),s=C,l=I}return l<t.length&&V_({source:[],target:t,start:l,size:e,getData:c}),t}function LK(i){const{device:t,settings:e,value:n}=i,r=new CL(t,e);return r.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:e.normalized}),r}function TL(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${i}"`)}}function SL(i){switch(i){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function PL(i){i.push(i.shift())}function DK(i,t){const{doublePrecision:e,settings:n,value:r,size:o}=i,s=e&&r instanceof Float64Array?2:1;let l=0;const{shaderAttributes:c}=i.settings;if(c)for(const y of Object.values(c))l=Math.max(l,y.vertexOffset??0);return(n.noAlloc?r.length:(t+l)*o)*s}function IL({device:i,source:t,target:e}){return(!e||e.byteLength<t.byteLength)&&(e?.destroy(),e=i.createBuffer({byteLength:t.byteLength,usage:t.usage})),e}function ML({device:i,buffer:t,attribute:e,fromLength:n,toLength:r,fromStartIndices:o,getData:s=l=>l}){const l=e.doublePrecision&&e.value instanceof Float64Array?2:1,c=e.size*l,y=e.byteOffset,_=e.settings.bytesPerElement<4?y/e.settings.bytesPerElement*4:y,C=e.startIndices,I=o&&C,k=e.isConstant;if(!I&&t&&n>=r)return t;const z=e.value instanceof Float64Array?Float32Array:e.value.constructor,V=k?e.value:new z(e.getBuffer().readSyncWebGL(y,r*z.BYTES_PER_ELEMENT).buffer);if(e.settings.normalized&&!k){const Y=s;s=(ct,rt)=>e.normalizeConstant(Y(ct,rt))}const X=k?(Y,ct)=>s(V,ct):(Y,ct)=>s(V.subarray(Y+y,Y+y+c),ct),H=t?new Float32Array(t.readSyncWebGL(_,n*4).buffer):new Float32Array(0),$=new Float32Array(r);return RK({source:H,target:$,sourceStartIndices:o,targetStartIndices:C,size:c,getData:X}),(!t||t.byteLength<$.byteLength+_)&&(t?.destroy(),t=i.createBuffer({byteLength:$.byteLength+_,usage:35050})),t.write($,_),t}class BL{constructor({device:t,attribute:e,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Oy(n),this.attribute=e,this.attributeInTransition=LK(e),this.currentStartIndices=e.startIndices}get inProgress(){return this.transition.inProgress}start(t,e,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=DK(this.attribute,e),this.transition.start({...t,duration:n})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class kK extends BL{constructor({device:t,attribute:e,timeline:n}){super({device:t,attribute:e,timeline:n}),this.type="interpolation",this.transform=zK(t,e)}start(t,e){const n=this.currentLength,r=this.currentStartIndices;if(super.start(t,e,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:s}=this;PL(o),o[0]=ML({device:this.device,buffer:o[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:t.enter}),o[1]=IL({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:l}=this,c=l.model;let y=Math.floor(this.currentLength/s.size);RL(s)&&(y/=2),c.setVertexCount(y),s.isConstant?(c.setAttributes({aFrom:o[0]}),c.setConstantAttributes({aTo:s.value})):c.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:t,easing:e}=this.settings,{time:n}=this.transition;let r=n/t;e&&(r=e(r));const{model:o}=this.transform,s={time:r};o.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const OK=`uniform interpolationUniforms {
  float time;
} interpolation;
`,hS={name:"interpolation",vs:OK,uniformTypes:{time:"f32"}},FK=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,NK=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function RL(i){return i.doublePrecision&&i.value instanceof Float64Array}function zK(i,t){const e=t.size,n=TL(e),r=SL(e),o=t.getBufferLayout();return RL(t)?new rf(i,{vs:NK,bufferLayout:[{name:"aFrom",byteStride:8*e,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*e}]},{name:"aTo",byteStride:8*e,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*e}]}],modules:[TG,hS],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:e},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new rf(i,{vs:FK,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:o.attributes[0].format}],modules:[hS],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class UK extends BL{constructor({device:t,attribute:e,timeline:n}){super({device:t,attribute:e,timeline:n}),this.type="spring",this.texture=XK(t),this.framebuffer=qK(t,this.texture),this.transform=HK(t,e)}start(t,e){const n=this.currentLength,r=this.currentStartIndices;super.start(t,e);const{buffers:o,attribute:s}=this;for(let c=0;c<2;c++)o[c]=ML({device:this.device,buffer:o[c],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:t.enter});o[2]=IL({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?l.setConstantAttributes({aTo:s.value}):l.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:t,transform:e,framebuffer:n,transition:r}=this,o=this.settings;e.model.setAttributes({aPrev:t[0],aCur:t[1]}),e.transformFeedback.setBuffers({vNext:t[2]});const s={stiffness:o.stiffness,damping:o.damping};e.model.shaderInputs.setProps({spring:s}),e.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),PL(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const VK=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,GK={name:"spring",vs:VK,uniformTypes:{damping:"f32",stiffness:"f32"}},jK=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,WK=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function HK(i,t){const e=TL(t.size),n=SL(t.size);return new rf(i,{vs:jK,fs:WK,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[GK],defines:{ATTRIBUTE_TYPE:e},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function XK(i){return i.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function qK(i,t){return i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const KK={interpolation:kK,spring:UK};class ZK{constructor(t,{id:e,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=e,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:n}){this.numInstances=n||1;for(const r in t){const o=t[r],s=o.getTransitionSetting(e);s&&this._updateAttribute(r,o,s)}for(const r in this.transitions){const o=t[r];(!o||!o.getTransitionSetting(e))&&this._removeTransition(r)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,e,n){const r=this.transitions[t];let o=!r||r.type!==n.type;if(o){r&&this._removeTransition(t);const s=KK[n.type];s?this.transitions[t]=new s({attribute:e,timeline:this.timeline,device:this.device}):($i.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const fS="attributeManager.invalidate",YK="attributeManager.updateStart",QK="attributeManager.updateEnd",JK="attribute.updateStart",$K="attribute.allocate",tZ="attribute.updateEnd";class Fy{constructor(t,{id:e="attribute-manager",stats:n,timeline:r}={}){this.mergeBoundsMemoized=vm(ZW),this.id=e,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new ZK(t,{id:`${e}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);mo(fS,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);mo(fS,this,"all")}update({data:t,numInstances:e,startIndices:n=null,transitions:r,props:o={},buffers:s={},context:l={}}){let c=!1;mo(YK,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const y in this.attributes){const _=this.attributes[y],C=_.settings.accessor;_.startIndices=n,_.numInstances=e,o[y]&&$i.removed(`props.${y}`,`data.attributes.${y}`)(),_.setExternalBuffer(s[y])||_.setBinaryValue(typeof C=="string"?s[C]:void 0,t.startIndices)||typeof C=="string"&&!s[C]&&_.setConstantValue(l,o[C])||_.needsUpdate()&&(c=!0,this._updateAttribute({attribute:_,numInstances:e,data:t,props:o,context:l})),this.needsRedraw=this.needsRedraw||_.needsRedraw()}c&&mo(QK,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:r})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const e=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(e)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:n}=this,r={...n.getAttributes()};for(const o in e){const s=e[o];s.needsRedraw(t)&&!n.hasAttribute(o)&&(r[o]=s)}return r}getBufferLayouts(t){return Object.values(this.getAttributes()).map(e=>e.getBufferLayout(t))}_add(t,e){for(const n in t){const r=t[n],o={...r,id:n,size:r.isIndexed&&1||r.size||1,...e};this.attributes[n]=new CL(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(n=>{t[n]||(t[n]=[]),t[n].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:r}=this,o=r[t];return o&&o.forEach(s=>{const l=n[s];l&&l.setNeedsUpdate(l.id,e)}),o}_updateAttribute(t){const{attribute:e,numInstances:n}=t;if(mo(JK,e),e.constant){e.setConstantValue(t.context,e.value);return}e.allocate(n)&&mo($K,e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,mo(tZ,e,n))}}class eZ extends Oy{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:r,easing:o}}=this,s=o(t/r);this._value=gl(e,n,s)}}const dS=1e-5;function pS(i,t,e,n,r){const o=t-i,s=(e-t)*r,l=-o*n;return s+l+o+t}function iZ(i,t,e,n,r){if(Array.isArray(e)){const o=[];for(let s=0;s<e.length;s++)o[s]=pS(i[s],t[s],e[s],n,r);return o}return pS(i,t,e,n,r)}function AS(i,t){if(Array.isArray(i)){let e=0;for(let n=0;n<i.length;n++){const r=i[n]-t[n];e+=r*r}return Math.sqrt(e)}return Math.abs(i-t)}class nZ extends Oy{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:r}=this.settings,{_prevValue:o=t,_currValue:s=t}=this;let l=iZ(o,s,e,n,r);const c=AS(l,e),y=AS(l,s);c<dS&&y<dS&&(l=e,this.end()),this._prevValue=s,this._currValue=l}}const rZ={interpolation:eZ,spring:nZ};class sZ{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,r){const{transitions:o}=this;if(o.has(t)){const c=o.get(t),{value:y=c.settings.fromValue}=c;e=y,this.remove(t)}if(r=EL(r),!r)return;const s=rZ[r.type];if(!s){$i.error(`unsupported transition type '${r.type}'`)();return}const l=new s(this.timeline);l.start({...r,fromValue:e,toValue:n}),o.set(t,l)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function oZ(i){const t=i[qc];for(const e in t){const n=t[e],{validate:r}=n;if(r&&!r(i[e],n))throw new Error(`Invalid prop ${e}: ${i[e]}`)}}function aZ(i,t){const e=qx({newProps:i,oldProps:t,propTypes:i[qc],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=uZ(i,t);let r=!1;return n||(r=cZ(i,t)),{dataChanged:n,propsChanged:e,updateTriggersChanged:r,extensionsChanged:hZ(i,t),transitionsChanged:lZ(i,t)}}function lZ(i,t){if(!i.transitions)return!1;const e={},n=i[qc];let r=!1;for(const o in i.transitions){const s=n[o],l=s&&s.type;(l==="number"||l==="color"||l==="array")&&Gb(i[o],t[o],s)&&(e[o]=!0,r=!0)}return r?e:!1}function qx({newProps:i,oldProps:t,ignoreProps:e={},propTypes:n={},triggerName:r="props"}){if(t===i)return!1;if(typeof i!="object"||i===null)return`${r} changed shallowly`;if(typeof t!="object"||t===null)return`${r} changed shallowly`;for(const o of Object.keys(i))if(!(o in e)){if(!(o in t))return`${r}.${o} added`;const s=Gb(i[o],t[o],n[o]);if(s)return`${r}.${o} ${s}`}for(const o of Object.keys(t))if(!(o in e)){if(!(o in i))return`${r}.${o} dropped`;if(!Object.hasOwnProperty.call(i,o)){const s=Gb(i[o],t[o],n[o]);if(s)return`${r}.${o} ${s}`}}return!1}function Gb(i,t,e){let n=e&&e.equal;return n&&!n(i,t,e)||!n&&(n=i&&t&&i.equals,n&&!n.call(i,t))?"changed deeply":!n&&t!==i?"changed shallowly":null}function uZ(i,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:n,_dataDiff:r}=i;return n?n(i.data,t.data)||(e="Data comparator detected a change"):i.data!==t.data&&(e="A new data container was supplied"),e&&r&&(e=r(i.data,t.data)||e),e}function cZ(i,t){if(t===null)return{all:!0};if("all"in i.updateTriggers&&mS(i,t,"all"))return{all:!0};const e={};let n=!1;for(const r in i.updateTriggers)r!=="all"&&mS(i,t,r)&&(e[r]=!0,n=!0);return n?e:!1}function hZ(i,t){if(t===null)return!0;const e=t.extensions,{extensions:n}=i;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(let r=0;r<n.length;r++)if(!n[r].equals(e[r]))return!0;return!1}function mS(i,t,e){let n=i.updateTriggers[e];n=n??{};let r=t.updateTriggers[e];return r=r??{},qx({oldProps:r,newProps:n,triggerName:e})}const fZ="count(): argument not an object",dZ="count(): argument not a container";function pZ(i){if(!mZ(i))throw new Error(fZ);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(AZ(i))return Object.keys(i).length;throw new Error(dZ)}function AZ(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function mZ(i){return i!==null&&typeof i=="object"}function gS(i,t){if(!t)return i;const e={...i,...t};if("defines"in t&&(e.defines={...i.defines,...t.defines}),"modules"in t&&(e.modules=(i.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=e.modules.findIndex(r=>r.name==="project32");n>=0&&e.modules.splice(n,1)}if("inject"in t)if(!i.inject)e.inject=t.inject;else{const n={...i.inject};for(const r in t.inject)n[r]=(n[r]||"")+t.inject[r];e.inject=n}return e}const gZ={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},jb={};function yZ(i,t,e,n){if(e instanceof ps)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let r=null;e.compressed&&(r={minFilter:"linear",mipmapFilter:e.data.length>1?"nearest":"linear"});const{width:o,height:s}=e.data,l=t.createTexture({...e,sampler:{...gZ,...r,...n},mipLevels:t.getMipLevelCount(o,s)});return l.generateMipmapsWebGL(),jb[l.id]=i,l}function vZ(i,t){!t||!(t instanceof ps)||jb[t.id]===i&&(t.delete(),delete jb[t.id])}const _Z={boolean:{validate(i,t){return!0},equal(i,t,e){return!!i==!!t}},number:{validate(i,t){return Number.isFinite(i)&&(!("max"in t)||i<=t.max)&&(!("min"in t)||i>=t.min)}},color:{validate(i,t){return t.optional&&!i||Wb(i)&&(i.length===3||i.length===4)},equal(i,t,e){return Or(i,t,1)}},accessor:{validate(i,t){const e=ey(i);return e==="function"||e===ey(t.value)},equal(i,t,e){return typeof t=="function"?!0:Or(i,t,1)}},array:{validate(i,t){return t.optional&&!i||Wb(i)},equal(i,t,e){const{compare:n}=e,r=Number.isInteger(n)?n:n?1:0;return n?Or(i,t,r):i===t}},object:{equal(i,t,e){if(e.ignore)return!0;const{compare:n}=e,r=Number.isInteger(n)?n:n?1:0;return n?Or(i,t,r):i===t}},function:{validate(i,t){return t.optional&&!i||typeof i=="function"},equal(i,t,e){return!e.compare&&e.ignore!==!1||i===t}},data:{transform:(i,t,e)=>{if(!i)return i;const{dataTransform:n}=e.props;return n?n(i):typeof i.shape=="string"&&i.shape.endsWith("-table")&&Array.isArray(i.data)?i.data:i}},image:{transform:(i,t,e)=>{const n=e.context;return!n||!n.device?null:yZ(e.id,n.device,i,{...t.parameters,...e.props.textureParameters})},release:(i,t,e)=>{vZ(e.id,i)}}};function bZ(i){const t={},e={},n={};for(const[r,o]of Object.entries(i)){const s=o?.deprecatedFor;if(s)n[r]=Array.isArray(s)?s:[s];else{const l=xZ(r,o);t[r]=l,e[r]=l.value}}return{propTypes:t,defaultProps:e,deprecatedProps:n}}function xZ(i,t){switch(ey(t)){case"object":return vA(i,t);case"array":return vA(i,{type:"array",value:t,compare:!1});case"boolean":return vA(i,{type:"boolean",value:t});case"number":return vA(i,{type:"number",value:t});case"function":return vA(i,{type:"function",value:t,compare:!0});default:return{name:i,type:"unknown",value:t}}}function vA(i,t){return"type"in t?{name:i,..._Z[t.type],...t}:"value"in t?{name:i,type:ey(t.value),...t}:{name:i,type:"object",value:t}}function Wb(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function ey(i){return Wb(i)?"array":i===null?"null":typeof i}function wZ(i,t){let e;for(let o=t.length-1;o>=0;o--){const s=t[o];"extensions"in s&&(e=s.extensions)}const n=Hb(i.constructor,e),r=Object.create(n);r[ty]=i,r[sf]={},r[jc]={};for(let o=0;o<t.length;++o){const s=t[o];for(const l in s)r[l]=s[l]}return Object.freeze(r),r}const EZ="_mergedDefaultProps";function Hb(i,t){if(!(i instanceof Ny.constructor))return{};let e=EZ;if(t)for(const r of t){const o=r.constructor;o&&(e+=`:${o.extensionName||o.name}`)}return LL(i,e)||(i[e]=CZ(i,t||[]))}function CZ(i,t){if(!i.prototype)return null;const e=Object.getPrototypeOf(i),n=Hb(e),r=LL(i,"defaultProps")||{},o=bZ(r),s=Object.assign(Object.create(null),n,o.defaultProps),l=Object.assign(Object.create(null),n?.[qc],o.propTypes),c=Object.assign(Object.create(null),n?.[k_],o.deprecatedProps);for(const y of t){const _=Hb(y.constructor);_&&(Object.assign(s,_),Object.assign(l,_[qc]),Object.assign(c,_[k_]))}return TZ(s,i),PZ(s,l),SZ(s,c),s[qc]=l,s[k_]=c,t.length===0&&!Kx(i,"_propTypes")&&(i._propTypes=l),s}function TZ(i,t){const e=MZ(t);Object.defineProperties(i,{id:{writable:!0,value:e}})}function SZ(i,t){for(const e in t)Object.defineProperty(i,e,{enumerable:!1,set(n){const r=`${this.id}: ${e}`;for(const o of t[e])Kx(this,o)||(this[o]=n);$i.deprecated(r,t[e].join("/"))()}})}function PZ(i,t){const e={},n={};for(const r in t){const o=t[r],{name:s,value:l}=o;o.async&&(e[s]=l,n[s]=IZ(s))}i[op]=e,i[sf]={},Object.defineProperties(i,n)}function IZ(i){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||xL(t)?this[sf][i]=t:this[jc][i]=t},get(){if(this[jc]){if(i in this[jc])return this[jc][i]||this[op][i];if(i in this[sf]){const t=this[ty]&&this[ty].internalState;if(t&&t.hasAsyncProp(i))return t.getAsyncProp(i)||this[op][i]}}return this[op][i]}}}function Kx(i,t){return Object.prototype.hasOwnProperty.call(i,t)}function LL(i,t){return Kx(i,t)&&i[t]}function MZ(i){const t=i.componentName;return t||$i.warn(`${i.name}.componentName not specified`)(),t||i.name}let BZ=0;class Ny{constructor(...t){this.props=wZ(this,t),this.id=this.props.id,this.count=BZ++}clone(t){const{props:e}=this,n={};for(const r in e[op])r in e[jc]?n[r]=e[jc][r]:r in e[sf]&&(n[r]=e[sf][r]);return new this.constructor({...e,...n,...t})}}Ny.componentName="Component";Ny.defaultProps={};const RZ=Object.freeze({});class LZ{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||RZ}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[ty]||this.component;const e=t[jc]||{},n=t[sf]||t,r=t[op]||{};for(const o in e){const s=e[o];this._createAsyncPropData(o,r[o]),this._updateAsyncProp(o,s),e[o]=this.getAsyncProp(o)}for(const o in n){const s=n[o];this._createAsyncPropData(o,r[o]),this._updateAsyncProp(o,s)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(xL(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e===n.resolvedValue||e===n.lastValue?!1:(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const r=this.asyncProps[t];r&&n>=r.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=e,r.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const r=n.pendingLoadCount;e.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(t,o,r),this._onResolve(t,o))}).catch(o=>{this._onError(t,o)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const r=n.pendingLoadCount;let o=[],s=0;for await(const l of e){if(!this.component)return;const{dataTransform:c}=this.component.props;c?o=c(l,o):o=o.concat(l),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(t,o,r)}this._onResolve(t,o)}_postProcessValue(t,e){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const n=this.component&&this.component.props[qc];this.asyncProps[t]={type:n&&n[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class DZ extends LZ{constructor({attributeManager:t,layer:e}){super(e),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const n=this.layer,r=n?.props.fetch;return r?r(e,{propName:t,layer:n}):super._fetch(t,e)}_onResolve(t,e){const n=this.layer;if(n){const r=n.props.onDataLoad;t==="data"&&r&&r(e,{propName:t,layer:n})}}_onError(t,e){const n=this.layer;n&&n.raiseError(e,`loading ${t} of ${this.layer}`)}}const kZ="layer.changeFlag",OZ="layer.initialize",FZ="layer.update",NZ="layer.finalize",zZ="layer.matched",yS=2**24-1,UZ=Object.freeze([]),VZ=vm(({oldViewport:i,viewport:t})=>i.equals(t));let nl=new Uint8ClampedArray(0);const GZ={data:{type:"data",value:UZ,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,{propName:t,layer:e,loaders:n,loadOptions:r,signal:o})=>{const{resourceManager:s}=e.context;r=r||e.getLoadOptions(),n=n||e.props.loaders,o&&(r={...r,fetch:{...r?.fetch,signal:o}});let l=s.contains(i);return!l&&!r&&(s.add({resourceId:i,data:Qu(i,n),persistent:!1}),l=!0),l?s.subscribe({resourceId:i,onChange:c=>e.internalState?.reloadAsyncProp(t,c),consumerId:e.id,requestId:t}):Qu(i,n,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:nn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:i})=>[0,-i*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ps extends Ny{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Gd.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){eo(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=tL(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,o,s]=ZR(n,e.pixelProjectionMatrix);return t.length===2?[r,o]:[r,o,s]}unproject(t){return eo(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){eo(this.internalState);const n=this.internalState.viewport||this.context.viewport;return eH(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(const e of this.getModels())e.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===nn.DEFAULT||t===nn.LNGLAT||t===nn.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){eo(t instanceof Uint8Array);const[e,n,r]=t;return e+n*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:pZ(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=gS(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const e of this.props.extensions)t=gS(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const r of n)e.invalidateAll(r);else e.invalidateAll();if(e){const{props:r}=t,o=this.internalState.hasPickingBuffer,s=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(o!==s){this.internalState.hasPickingBuffer=s;const{pickingColors:l,instancePickingColors:c}=e.attributes,y=l||c;y&&(s&&y.constant&&(y.constant=!1,e.invalidate(y.id)),!y.value&&!s&&(y.constant=!0,y.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.destroy();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t.renderPass)}getPickingInfo({info:t,mode:e,sourceLayer:n}){const{index:r}=t;return r>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[r]),t}raiseError(t,e){e&&(t=new Error(`${e}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!VZ({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){let e=!1;for(const n in t)t[n].layoutChanged()&&(e=!0);for(const n of this.getModels())this._setModelAttributes(n,t,e)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),r=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:r,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const o=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const r in e)Object.defineProperty(n,r,{value:e[r]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const n=Math.floor(nl.length/4);if(this.internalState.usesPickingColorCache=!0,n<e){e>yS&&$i.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),nl=yp.allocate(nl,e,{size:4,copy:!0,maxCount:Math.max(e,yS)});const r=Math.floor(nl.length/4),o=[0,0,0];for(let s=n;s<r;s++)this.encodePickingColor(s,o),nl[s*4+0]=o[0],nl[s*4+1]=o[1],nl[s*4+2]=o[2],nl[s*4+3]=0}t.value=nl.subarray(0,e*4)}_setModelAttributes(t,e,n=!1){if(!Object.keys(e).length)return;if(n){const l=this.getAttributeManager();t.setBufferLayout(l.getBufferLayouts(t)),e=l.getAttributes()}const r=t.userData?.excludeAttributes||{},o={},s={};for(const l in e){if(r[l])continue;const c=e[l].getValue();for(const y in c){const _=c[y];_ instanceof br?e[l].settings.isIndexed?t.setIndexBuffer(_):o[y]=_:_&&(s[y]=_)}}t.setAttributes(o),t.setConstantAttributes(s)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,o=n||r,s=o&&e.attributes&&e.attributes[o.id];if(s&&s.value){const l=s.value,c=this.encodePickingColor(t);for(let y=0;y<e.length;y++){const _=o.getVertexOffset(y);l[_]===c[0]&&l[_+1]===c[1]&&l[_+2]===c[2]&&this._disablePickingIndex(y)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;if(!r)return;const o=r.getVertexOffset(t),s=r.getVertexOffset(t+1);r.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==nl.buffer&&(n.value=nl.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){eo(!this.internalState),eo(Number.isFinite(this.props.coordinateSystem)),mo(OZ,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new DZ({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>($i.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new sZ(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){mo(zZ,this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(mo(FZ,this,t),!t)return;const e=this.props,n=this.context,r=this.internalState,o=n.viewport,s=this._updateUniformTransition();r.propsInTransition=s,n.viewport=r.viewport||o,this.props=s;try{const l=this._getUpdateParams(),c=this.getModels();if(n.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const _ of this.props.extensions)_.updateState.call(this,l,_);this.setNeedsRedraw(),this._updateAttributes();const y=this.getModels()[0]!==c[0];this._postUpdate(l,y)}finally{n.viewport=o,this.props=e,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){mo(NZ,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:e=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;try{e&&this.setShaderModuleProps(e);const{getPolygonOffset:l}=this.props,c=l&&l(n)||[0,0];s.device instanceof Ub&&s.device.setParametersWebGL({polygonOffset:c});for(const y of this.getModels())y.device.type==="webgpu"?y.setParameters({...y.parameters,...r}):y.setParameters(r);if(s.device instanceof Ub)s.device.withParametersWebGL(r,()=>{const y={renderPass:t,shaderModuleProps:e,uniforms:n,parameters:r,context:s};for(const _ of this.props.extensions)_.draw.call(this,y,_);this.draw(y)});else{const y={renderPass:t,shaderModuleProps:e,uniforms:n,parameters:r,context:s};for(const _ of this.props.extensions)_.draw.call(this,y,_);this.draw(y)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const r in t)if(t[r]){let o=!1;switch(r){case"dataChanged":const s=t[r],l=e[r];s&&Array.isArray(l)&&(e.dataChanged=Array.isArray(s)?l.concat(s):s,o=!0);default:e[r]||(e[r]=t[r],o=!0)}o&&mo(kZ,this,r,t)}const n=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=aZ(t,e);if(n.updateTriggersChanged)for(const r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(n.transitionsChanged)for(const r in n.transitionsChanged)this.internalState.uniformTransitions.add(r,e[r],t[r],t.transitions?.[r]);return this.setChangeFlags(n)}validateProps(){oZ(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(e.highlightColor=n(t)),this.setShaderModuleProps({picking:e}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new Fy(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:r}=t,o=this.state.model;o?.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:l,highlightColor:c}=n;if(e||r.autoHighlight!==s||r.highlightedObjectIndex!==l||r.highlightColor!==c){const y={};Array.isArray(c)&&(y.highlightColor=c),(e||r.autoHighlight!==s||l!==r.highlightedObjectIndex)&&(y.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:y})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),r=n?n.getNeedsRedraw(t):!1;if(e=e||r,e)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ps.defaultProps=GZ;Ps.layerName="Layer";const jZ="compositeLayer.renderLayers";class Is extends Ps{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id&&(t.object=e.__source.object,t.index=e.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(n,r)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,r)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:n,visible:r,parameters:o,getPolygonOffset:s,highlightedObjectIndex:l,autoHighlight:c,highlightColor:y,coordinateSystem:_,coordinateOrigin:C,wrapLongitude:I,positionFormat:k,modelMatrix:z,extensions:V,fetch:X,operation:H,_subLayerProps:$}=this.props,Y={id:"",updateTriggers:{},opacity:e,pickable:n,visible:r,parameters:o,getPolygonOffset:s,highlightedObjectIndex:l,autoHighlight:c,highlightColor:y,coordinateSystem:_,coordinateOrigin:C,wrapLongitude:I,positionFormat:k,modelMatrix:z,extensions:V,fetch:X,operation:H},ct=$&&t.id&&$[t.id],rt=ct&&ct.updateTriggers,nt=t.id||"sublayer";if(ct){const Ot=this.props[qc],Kt=t.type?t.type._propTypes:{};for(const ft in ct){const st=Kt[ft]||Ot[ft];st&&st.type==="accessor"&&(ct[ft]=this.getSubLayerAccessor(ct[ft]))}}Object.assign(Y,t,ct),Y.id=`${this.props.id}-${nt}`,Y.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...rt};for(const Ot of V){const Kt=Ot.getSubLayerProps.call(this,Ot);Kt&&Object.assign(Y,Kt,{updateTriggers:Object.assign(Y.updateTriggers,Kt.updateTriggers)})}return Y}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let n=this.internalState.subLayers;const r=!n||this.needsUpdate();if(r){const o=this.renderLayers();n=ky(o,Boolean),this.internalState.subLayers=n}mo(jZ,this,r,n);for(const o of n)o.parent=this}}Is.layerName="CompositeLayer";const S0=Math.PI/180,vS=180/Math.PI,bg=6370972,Yd=256;function WZ(){const i=Yd/bg,t=Math.PI/180*Yd;return{unitsPerMeter:[i,i,i],unitsPerMeter2:[0,0,0],metersPerUnit:[1/i,1/i,1/i],unitsPerDegree:[t,t,i],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/i]}}class HZ extends ec{constructor(t={}){const{longitude:e=0,zoom:n=0,nearZMultiplier:r=.5,farZMultiplier:o=1,resolution:s=10}=t;let{latitude:l=0,height:c,altitude:y=1.5,fovy:_}=t;l=Math.max(Math.min(l,Hd),-Hd),c=c||1,_?y=Dx(_):_=nm(y);const C=1/Math.PI/Math.cos(l*Math.PI/180),I=Math.pow(2,n)*C,k=t.nearZ??r,z=t.farZ??(y+Yd*2*I/c)*o,V=new bn().lookAt({eye:[0,-y,0],up:[0,0,1]});V.rotateX(l*S0),V.rotateZ(-e*S0),V.scale(I/c),super({...t,height:c,viewMatrix:V,longitude:e,latitude:l,zoom:n,distanceScales:WZ(),fovy:_,focalDistance:y,near:k,far:z}),this.scale=I,this.latitude=l,this.longitude=e,this.resolution=s}get projectionMode(){return fa.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const e={targetZ:t.z||0},n=this.unproject([0,this.height/2],e),r=this.unproject([this.width/2,0],e),o=this.unproject([this.width,this.height/2],e),s=this.unproject([this.width/2,this.height],e);return o[0]<this.longitude&&(o[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],o[0],r[0],s[0]),Math.min(n[1],o[1],r[1],s[1]),Math.max(n[0],o[0],r[0],s[0]),Math.max(n[1],o[1],r[1],s[1])]}unproject(t,{topLeft:e=!0,targetZ:n}={}){const[r,o,s]=t,l=e?o:this.height-o,{pixelUnprojectionMatrix:c}=this;let y;if(Number.isFinite(s))y=G_(c,[r,l,s,1]);else{const k=G_(c,[r,l,-1,1]),z=G_(c,[r,l,1,1]),V=((n||0)/bg+1)*Yd,X=x_(wR([],k,z)),H=x_(k),$=x_(z),Y=4*((4*H*$-(X-H-$)**2)/16)/X,ct=Math.sqrt(H-Y),rt=Math.sqrt(Math.max(0,V*V-Y)),nt=(ct-rt)/Math.sqrt(X);y=pV([],k,z,nt)}const[_,C,I]=this.unprojectPosition(y);return Number.isFinite(s)?[_,C,I]:Number.isFinite(n)?[_,C,n]:[_,C]}projectPosition(t){const[e,n,r=0]=t,o=e*S0,s=n*S0,l=Math.cos(s),c=(r/bg+1)*Yd;return[Math.sin(o)*l*c,-Math.cos(o)*l*c,Math.sin(s)*c]}unprojectPosition(t){const[e,n,r]=t,o=ER(t),s=Math.asin(r/o),l=Math.atan2(e,-n)*vS,c=s*vS,y=(o/Yd-1)*bg;return[l,c,y]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,e){const n=this.unproject(e);return{longitude:t[0]-n[0]+this.longitude,latitude:t[1]-n[1]+this.latitude}}}function G_(i,t){const e=Lp([],t,i);return Ix(e,e,1/e[3]),e}class zy{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&Or(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:e}=t.constructor,n={updateTriggers:{}};for(const r in e)if(r in this.props){const o=e[r],s=this.props[r];n[r]=s,o&&o.type==="accessor"&&(n.updateTriggers[r]=this.props.updateTriggers[r],typeof s=="function"&&(n[r]=this.getSubLayerAccessor(s)))}return n}initializeState(t,e){}updateState(t,e){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,e){}finalizeState(t,e){}}zy.defaultProps={};zy.extensionName="LayerExtension";class DL{constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:e={}}=t;this.typedArrayManager=yp,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:n={},getGeometry:r,geometryBuffer:o,positionFormat:s,dataChanged:l,normalize:c=!0}=this.opts;if(this.data=e,this.getGeometry=r,this.positionSize=o&&o.size||(s==="XY"?2:3),this.buffers=n,this.normalize=c,o&&(eo(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),c||(n.vertexPositions=o)),this.geometryBuffer=n.vertexPositions,Array.isArray(l))for(const y of l)this._rebuildGeometry(y);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:e}){this._rebuildGeometry({startRow:t,endRow:e})}getGeometryFromBuffer(t){const e=t.value||t;return ArrayBuffer.isView(e)?wL(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,e){const{attributes:n,buffers:r,_attributeDefs:o,typedArrayManager:s}=this;for(const l in o)if(l in r)s.release(n[l]),n[l]=null;else{const c=o[l];c.copy=e,n[l]=s.allocate(n[l],t,c)}}_forEachGeometry(t,e,n){const{data:r,getGeometry:o}=this,{iterable:s,objectInfo:l}=fu(r,e,n);for(const c of s){l.index++;const y=o?o(c,l):null;t(y,l.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:e,vertexStarts:n,instanceCount:r}=this;const{data:o,geometryBuffer:s}=this,{startRow:l=0,endRow:c=1/0}=t||{},y={};if(t||(e=[0],n=[0]),this.normalize||!s)this._forEachGeometry((C,I)=>{const k=C&&this.normalizeGeometry(C);y[I]=k,n[I+1]=n[I]+(k?this.getGeometrySize(k):0)},l,c),r=n[n.length-1];else if(n=o.startIndices,r=n[o.length]||0,ArrayBuffer.isView(s))r=r||s.length/this.positionSize;else if(s instanceof br){const C=this.positionSize*4;r=r||s.byteLength/C}else if(s.buffer){const C=s.stride||this.positionSize*4;r=r||s.buffer.byteLength/C}else if(s.value){const C=s.value,I=s.stride/C.BYTES_PER_ELEMENT||this.positionSize;r=r||C.length/I}this._allocate(r,!!t),this.indexStarts=e,this.vertexStarts=n,this.instanceCount=r;const _={};this._forEachGeometry((C,I)=>{const k=y[I]||C;_.vertexStart=n[I],_.indexStart=e[I];const z=I<n.length-1?n[I+1]:r;_.geometrySize=z-n[I],_.geometryIndex=I,this.updateGeometryAttributes(k,_)},l,c),this.vertexCount=e[e.length-1]}}const XZ=typeof window<"u"?Re.useLayoutEffect:Re.useEffect;function iy(i,t){for(;i;){if(i===t)return!0;i=Object.getPrototypeOf(i)}return!1}const qZ={position:"absolute",zIndex:-1};function kL(i,t){if(typeof i=="function")return i(t);if(Array.isArray(i))return i.map(e=>kL(e,t));if(Uy(i)){if(KZ(i))return t.style=qZ,Re.cloneElement(i,t);if(ZZ(i))return Re.cloneElement(i,t)}return i}function Uy(i){return i&&typeof i=="object"&&"type"in i||!1}function KZ(i){return i.props?.mapStyle}function ZZ(i){const t=i.type;return t&&t.deckGLViewProps}function Xb(i){if(typeof i=="function")return Re.createElement(vp,{},i);if(Array.isArray(i))return i.map(Xb);if(Uy(i)){if(i.type===Re.Fragment)return Xb(i.props.children);if(iy(i.type,vp))return i}return i}function YZ({children:i,layers:t=[],views:e=null}){const n=[],r=[],o={};return Re.Children.forEach(Xb(i),s=>{if(Uy(s)){const l=s.type;if(iy(l,Ps)){const c=QZ(l,s.props);r.push(c)}else n.push(s);if(iy(l,vp)&&l!==vp&&s.props.id){const c=new l(s.props);o[c.id]=c}}else s&&n.push(s)}),Object.keys(o).length>0&&(Array.isArray(e)?e.forEach(s=>{o[s.id]=s}):e&&(o[e.id]=e),e=Object.values(o)),t=r.length>0?[...r,...t]:t,{layers:t,children:n,views:e}}function QZ(i,t){const e={},n=i.defaultProps||{};for(const r in t)n[r]!==t[r]&&(e[r]=t[r]);return new i(e)}const JZ=Re.createContext();function $Z({children:i,deck:t,ContextProvider:e=JZ.Provider}){const{viewManager:n}=t||{};if(!n||!n.views.length)return[];const r={},o=n.views[0].id;for(const s of i){let l=o,c=s;Uy(s)&&iy(s.type,vp)&&(l=s.props.id||o,c=s.props.children);const y=n.getViewport(l),_=n.getViewState(l);if(y){_.padding=y.padding;const{x:C,y:I,width:k,height:z}=y;c=kL(c,{x:C,y:I,width:k,height:z,viewport:y,viewState:_}),r[l]||(r[l]={viewport:y,children:[]}),r[l].children.push(c)}}return Object.keys(r).map(s=>{const{viewport:l,children:c}=r[s],{x:y,y:_,width:C,height:I}=l,k={position:"absolute",left:y,top:_,width:C,height:I},z=`view-${s}`,V=Re.createElement("div",{key:z,id:z,style:k},...c),X={deck:t,viewport:l,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:$=>{$.viewId=s,t._onViewStateChange($)},widgets:[]},H=`view-${s}-context`;return Re.createElement(e,{key:H,value:X},V)})}const tY={mixBlendMode:null};function eY({width:i,height:t,style:e}){const n={position:"absolute",zIndex:0,left:0,top:0,width:i,height:t},r={left:0,top:0};if(e)for(const o in e)o in tY?r[o]=e[o]:n[o]=e[o];return{containerStyle:n,canvasStyle:r}}function iY(i){return{get deck(){return i.deck},pickObject:t=>i.deck.pickObject(t),pickMultipleObjects:t=>i.deck.pickMultipleObjects(t),pickObjects:t=>i.deck.pickObjects(t)}}function OL(i){i.redrawReason&&(i.deck._drawLayers(i.redrawReason),i.redrawReason=null)}function nY(i,t,e){const n=new t({...e,_customRender:e.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:r=>{i.redrawReason=r;const o=n.getViewports();i.lastRenderedViewports!==o?i.forceUpdate():OL(i)}});return n}function rY(i,t){const[e,n]=Re.useState(0),r=Re.useRef({control:null,version:e,forceUpdate:()=>n(ct=>ct+1)}).current,o=Re.useRef(null),s=Re.useRef(null),l=Re.useMemo(()=>YZ(i),[i.layers,i.views,i.children]);let c=!0;const y=ct=>c&&i.viewState?(r.viewStateUpdateRequested=ct,null):(r.viewStateUpdateRequested=null,i.onViewStateChange?.(ct)),_=ct=>{c?r.interactionStateUpdateRequested=ct:(r.interactionStateUpdateRequested=null,i.onInteractionStateChange?.(ct))},C=Re.useMemo(()=>{const ct={widgets:[],...i,style:null,width:"100%",height:"100%",parent:o.current,canvas:s.current,layers:l.layers,views:l.views,onViewStateChange:y,onInteractionStateChange:_};return delete ct._customRender,r.deck&&r.deck.setProps(ct),ct},[i]);Re.useEffect(()=>{const ct=i.Deck||Xx;return r.deck=nY(r,ct,{...C,parent:o.current,canvas:s.current}),()=>r.deck?.finalize()},[]),XZ(()=>{OL(r);const{viewStateUpdateRequested:ct,interactionStateUpdateRequested:rt}=r;ct&&y(ct),rt&&_(rt),r.deck?.isInitialized&&r.deck.redraw("Initial render")}),Re.useImperativeHandle(t,()=>iY(r),[]);const I=r.deck&&r.deck.isInitialized?r.deck.getViewports():void 0,{ContextProvider:k,width:z="100%",height:V="100%",id:X,style:H}=i,{containerStyle:$,canvasStyle:Y}=Re.useMemo(()=>eY({width:z,height:V,style:H}),[z,V,H]);if(!r.viewStateUpdateRequested&&r.lastRenderedViewports===I||r.version!==e){r.lastRenderedViewports=I,r.version=e;const ct=$Z({children:l.children,deck:r.deck,ContextProvider:k}),rt=Re.createElement("canvas",{key:"canvas",id:X||"deckgl-overlay",ref:s,style:Y});r.control=Re.createElement("div",{id:`${X||"deckgl"}-wrapper`,ref:o,style:$},[rt,ct])}return c=!1,r.control}const sY=Re.forwardRef(rY),_S="\uFEFF";function oY(i,t={},e=lY){t=t||{};var n=t.dynamicTyping||!1;dl(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=dl(t.transform)?t.transform:!1;var r=new e(t);return r.stream(i)}function aY(i,t){var e=!1,n=!0,r=",",o=`\r
`,s='"',l=s+s,c=!1,y=null;C();var _=new RegExp(om(s),"g");if(typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(i)){if(!i.length||Array.isArray(i[0]))return I(null,i,c);if(typeof i[0]=="object")return I(y||Object.keys(i[0]),i,c)}else if(typeof i=="object")return typeof i.data=="string"&&(i.data=JSON.parse(i.data)),Array.isArray(i.data)&&(i.fields||(i.fields=i.meta&&i.meta.fields),i.fields||(i.fields=Array.isArray(i.data[0])?i.fields:Object.keys(i.data[0])),!Array.isArray(i.data[0])&&typeof i.data[0]!="object"&&(i.data=[i.data])),I(i.fields||[],i.data||[],c);throw new Error("Unable to serialize unrecognized input");function C(){if(typeof t=="object"){if(typeof t.delimiter=="string"&&!Ra.BAD_DELIMITERS.filter(function(V){return t.delimiter.indexOf(V)!==-1}).length&&(r=t.delimiter),(typeof t.quotes=="boolean"||Array.isArray(t.quotes))&&(e=t.quotes),(typeof t.skipEmptyLines=="boolean"||typeof t.skipEmptyLines=="string")&&(c=t.skipEmptyLines),typeof t.newline=="string"&&(o=t.newline),typeof t.quoteChar=="string"&&(s=t.quoteChar),typeof t.header=="boolean"&&(n=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");y=t.columns}t.escapeChar!==void 0&&(l=t.escapeChar+s)}}function I(V,X,H){var $="";typeof V=="string"&&(V=JSON.parse(V)),typeof X=="string"&&(X=JSON.parse(X));var Y=Array.isArray(V)&&V.length>0,ct=!Array.isArray(X[0]);if(Y&&n){for(var rt=0;rt<V.length;rt++)rt>0&&($+=r),$+=k(V[rt],rt);X.length>0&&($+=o)}for(var nt=0;nt<X.length;nt++){var Ot=Y?V.length:X[nt].length,Kt=!1,ft=Y?Object.keys(X[nt]).length===0:X[nt].length===0;if(H&&!Y&&(Kt=H==="greedy"?X[nt].join("").trim()==="":X[nt].length===1&&X[nt][0].length===0),H==="greedy"&&Y){for(var st=[],Ut=0;Ut<Ot;Ut++){var K=ct?V[Ut]:Ut;st.push(X[nt][K])}Kt=st.join("").trim()===""}if(!Kt){for(var dt=0;dt<Ot;dt++){dt>0&&!ft&&($+=r);var Tt=Y&&ct?V[dt]:dt;$+=k(X[nt][Tt],dt)}nt<X.length-1&&(!H||Ot>0&&!ft)&&($+=o)}}return $}function k(V,X){if(typeof V>"u"||V===null)return"";if(V.constructor===Date)return JSON.stringify(V).slice(1,25);V=V.toString().replace(_,l);var H=typeof e=="boolean"&&e||Array.isArray(e)&&e[X]||z(V,Ra.BAD_DELIMITERS)||V.indexOf(r)>-1||V.charAt(0)===" "||V.charAt(V.length-1)===" ";return H?s+V+s:V}function z(V,X){for(var H=0;H<X.length;H++)if(V.indexOf(X[H])>-1)return!0;return!1}}let FL=class{_handle;_config;_finished=!1;_completed=!1;_input=null;_baseIndex=0;_partialLine="";_rowCount=0;_start=0;isFirstChunk=!0;_completeResults={data:[],errors:[],meta:{}};constructor(i){var t={...i};t.chunkSize=parseInt(t.chunkSize),!i.step&&!i.chunk&&(t.chunkSize=null),this._handle=new NL(t),this._handle.streamer=this,this._config=t}parseChunk(i,t){if(this.isFirstChunk&&dl(this._config.beforeFirstChunk)){var e=this._config.beforeFirstChunk(i);e!==void 0&&(i=e)}this.isFirstChunk=!1;var n=this._partialLine+i;this._partialLine="";var r=this._handle.parse(n,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var o=r.meta.cursor;this._finished||(this._partialLine=n.substring(o-this._baseIndex),this._baseIndex=o),r&&r.data&&(this._rowCount+=r.data.length);var s=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(dl(this._config.chunk)&&!t){if(this._config.chunk(r,this._handle),this._handle.paused()||this._handle.aborted())return;r=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(r.data),this._completeResults.errors=this._completeResults.errors.concat(r.errors),this._completeResults.meta=r.meta),!this._completed&&s&&dl(this._config.complete)&&(!r||!r.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),r}}_sendError(i){dl(this._config.error)&&this._config.error(i)}};class lY extends FL{remaining;constructor(t={}){super(t)}stream(t){return this.remaining=t,this._nextChunk()}_nextChunk(){if(!this._finished){var t=this._config.chunkSize,e=t?this.remaining.substr(0,t):this.remaining;return this.remaining=t?this.remaining.substr(t):"",this._finished=!this.remaining,this.parseChunk(e)}}}const uY=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,cY=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;class NL{_config;_stepCounter=0;_rowCounter=0;_input;_parser;_paused=!1;_aborted=!1;_delimiterError=!1;_fields=[];_results={data:[],errors:[],meta:{}};constructor(t){if(dl(t.step)){var e=t.step;t.step=n=>{if(this._results=n,this.needsHeaderRow())this.processResults();else{if(this.processResults(),!this._results.data||this._results.data.length===0)return;this._stepCounter+=n.data.length,t.preview&&this._stepCounter>t.preview?this._parser.abort():e(this._results,this)}}}this._config=t}parse(t,e,n){var r=this._config.quoteChar||'"';if(this._config.newline||(this._config.newline=hY(t,r)),this._delimiterError=!1,this._config.delimiter)dl(this._config.delimiter)&&(this._config.delimiter=this._config.delimiter(t),this._results.meta.delimiter=this._config.delimiter);else{var o=this.guessDelimiter(t,this._config.newline,this._config.skipEmptyLines,this._config.comments,this._config.delimitersToGuess);o.successful?this._config.delimiter=o.bestDelimiter:(this._delimiterError=!0,this._config.delimiter=Ra.DefaultDelimiter),this._results.meta.delimiter=this._config.delimiter}var s=zL(this._config);return this._config.preview&&this._config.header&&s.preview++,this._input=t,this._parser=new qb(s),this._results=this._parser.parse(this._input,e,n),this.processResults(),this._paused?{meta:{paused:!0}}:this._results||{meta:{paused:!1}}}paused(){return this._paused}pause(){this._paused=!0,this._parser.abort(),this._input=this._input.substr(this._parser.getCharIndex())}resume(){this._paused=!1,this.streamer.parseChunk(this._input,!0)}aborted(){return this._aborted}abort(){this._aborted=!0,this._parser.abort(),this._results.meta.aborted=!0,dl(this._config.complete)&&this._config.complete(this._results),this._input=""}testEmptyLine(t){return this._config.skipEmptyLines==="greedy"?t.join("").trim()==="":t.length===1&&t[0].length===0}processResults(){if(this._results&&this._delimiterError&&(this.addError("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+Ra.DefaultDelimiter+"'"),this._delimiterError=!1),this._config.skipEmptyLines)for(var t=0;t<this._results.data.length;t++)this.testEmptyLine(this._results.data[t])&&this._results.data.splice(t--,1);return this.needsHeaderRow()&&this.fillHeaderFields(),this.applyHeaderAndDynamicTypingAndTransformation()}needsHeaderRow(){return this._config.header&&this._fields.length===0}fillHeaderFields(){if(!this._results)return;const t=n=>{dl(this._config.transformHeader)&&(n=this._config.transformHeader(n)),this._fields.push(n)};if(Array.isArray(this._results.data[0])){for(var e=0;this.needsHeaderRow()&&e<this._results.data.length;e++)this._results.data[e].forEach(t);this._results.data.splice(0,1)}else this._results.data.forEach(t)}shouldApplyDynamicTyping(t){return this._config.dynamicTypingFunction&&this._config.dynamicTyping[t]===void 0&&(this._config.dynamicTyping[t]=this._config.dynamicTypingFunction(t)),(this._config.dynamicTyping[t]||this._config.dynamicTyping)===!0}parseDynamic(t,e){return this.shouldApplyDynamicTyping(t)?e==="true"||e==="TRUE"?!0:e==="false"||e==="FALSE"?!1:uY.test(e)?parseFloat(e):cY.test(e)?new Date(e):e===""?null:e:e}applyHeaderAndDynamicTypingAndTransformation(){if(!this._results||!this._results.data||!this._config.header&&!this._config.dynamicTyping&&!this._config.transform)return this._results;var t=1;return!this._results.data[0]||Array.isArray(this._results.data[0])?(this._results.data=this._results.data.map(this.processRow.bind(this)),t=this._results.data.length):this._results.data=this.processRow(this._results.data,0),this._config.header&&this._results.meta&&(this._results.meta.fields=this._fields),this._rowCounter+=t,this._results}processRow(t,e){var n=this._config.header?{}:[],r;for(r=0;r<t.length;r++){var o=r,s=t[r];this._config.header&&(o=r>=this._fields.length?"__parsed_extra":this._fields[r]),this._config.transform&&(s=this._config.transform(s,o)),s=this.parseDynamic(o,s),o==="__parsed_extra"?(n[o]=n[o]||[],n[o].push(s)):n[o]=s}return this._config.header&&(r>this._fields.length?this.addError("FieldMismatch","TooManyFields","Too many fields: expected "+this._fields.length+" fields but parsed "+r,this._rowCounter+e):r<this._fields.length&&this.addError("FieldMismatch","TooFewFields","Too few fields: expected "+this._fields.length+" fields but parsed "+r,this._rowCounter+e)),n}guessDelimiter(t,e,n,r,o){var s,l,c;o=o||[",","	","|",";",Ra.RECORD_SEP,Ra.UNIT_SEP];for(var y=0;y<o.length;y++){var _=o[y],C=0,I=0,k=0;c=void 0;for(var z=new qb({comments:r,delimiter:_,newline:e,preview:10}).parse(t),V=0;V<z.data.length;V++){if(n&&this.testEmptyLine(z.data[V])){k++;continue}var X=z.data[V].length;if(I+=X,typeof c>"u"){c=0;continue}else X>1&&(C+=Math.abs(X-c),c=X)}z.data.length>0&&(I/=z.data.length-k),(typeof l>"u"||C>l)&&I>1.99&&(l=C,s=_)}return this._config.delimiter=s,{successful:!!s,bestDelimiter:s}}addError(t,e,n,r){this._results.errors.push({type:t,code:e,message:n,row:r})}}function hY(i,t){i=i.substr(0,1024*1024);var e=new RegExp(om(t)+"([^]*?)"+om(t),"gm");i=i.replace(e,"");var n=i.split("\r"),r=i.split(`
`),o=r.length>1&&r[0].length<n[0].length;if(n.length===1||o)return`
`;for(var s=0,l=0;l<n.length;l++)n[l][0]===`
`&&s++;return s>=n.length/2?`\r
`:"\r"}function om(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function qb(i){i=i||{};var t=i.delimiter,e=i.newline,n=i.comments,r=i.step,o=i.preview,s=i.fastMode,l;i.quoteChar===void 0?l='"':l=i.quoteChar;var c=l;if(i.escapeChar!==void 0&&(c=i.escapeChar),(typeof t!="string"||Ra.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),n===t)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||Ra.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),e!==`
`&&e!=="\r"&&e!==`\r
`&&(e=`
`);var y=0,_=!1;this.parse=function(C,I,k){if(typeof C!="string")throw new Error("Input must be a string");var z=C.length,V=t.length,X=e.length,H=n.length,$=dl(r);y=0;var Y=[],ct=[],rt=[],nt=0;if(!C)return de();if(s||s!==!1&&C.indexOf(l)===-1){for(var Ot=C.split(e),Kt=0;Kt<Ot.length;Kt++){const Oe=Ot[Kt];if(y+=Oe.length,Kt!==Ot.length-1)y+=e.length;else if(k)return de();if(!(n&&Oe.substr(0,H)===n)){if($){if(Y=[],Ft(Oe.split(t)),ye(),_)return de()}else Ft(Oe.split(t));if(o&&Kt>=o)return Y=Y.slice(0,o),de(!0)}}return de()}for(var ft=C.indexOf(t,y),st=C.indexOf(e,y),Ut=new RegExp(om(c)+om(l),"g"),K;;){if(C[y]===l){for(K=y,y++;;){if(K=C.indexOf(l,K+1),K===-1)return k||ct.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Y.length,index:y}),se();if(K===z-1){var dt=C.substring(y,K).replace(Ut,l);return se(dt)}if(l===c&&C[K+1]===c){K++;continue}if(!(l!==c&&K!==0&&C[K-1]===c)){var Tt=st===-1?ft:Math.min(ft,st),ue=Gt(Tt);if(C[K+1+ue]===t){if(rt.push(C.substring(y,K).replace(Ut,l)),y=K+1+ue+V,ft=C.indexOf(t,y),st=C.indexOf(e,y),$&&(ye(),_))return de();if(o&&Y.length>=o)return de(!0);break}var Rt=Gt(st);if(C.substr(K+1+Rt,X)===e){if(rt.push(C.substring(y,K).replace(Ut,l)),le(K+1+Rt+X),ft=C.indexOf(t,y),$&&(ye(),_))return de();if(o&&Y.length>=o)return de(!0);break}ct.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Y.length,index:y}),K++}}if($&&(ye(),_))return de();if(o&&Y.length>=o)return de(!0);continue}if(n&&rt.length===0&&C.substr(y,H)===n){if(st===-1)return de();y=st+X,st=C.indexOf(e,y),ft=C.indexOf(t,y);continue}if(ft!==-1&&(ft<st||st===-1)){rt.push(C.substring(y,ft)),y=ft+V,ft=C.indexOf(t,y);continue}if(st!==-1){if(rt.push(C.substring(y,st)),le(st+X),$&&(ye(),_))return de();if(o&&Y.length>=o)return de(!0);continue}break}return se();function Ft(Oe){Y.push(Oe),nt=y}function Gt(Oe){var Le=0;if(Oe!==-1){var fe=C.substring(K+1,Oe);fe&&fe.trim()===""&&(Le=fe.length)}return Le}function se(Oe){return k||(typeof Oe>"u"&&(Oe=C.substr(y)),rt.push(Oe),y=z,Ft(rt),$&&ye()),de()}function le(Oe){y=Oe,Ft(rt),rt=[],st=C.indexOf(e,y)}function de(Oe,Le){var fe=Le||!1;return{data:fe?Y[0]:Y,errors:ct,meta:{delimiter:t,linebreak:e,aborted:_,truncated:!!Oe,cursor:nt+(I||0)}}}function ye(){r(de(void 0,!0)),Y=[],ct=[]}},this.abort=function(){_=!0},this.getCharIndex=function(){return y}}function zL(i){if(typeof i!="object"||i===null)return i;var t=Array.isArray(i)?[]:{};for(var e in i)t[e]=zL(i[e]);return t}function dl(i){return typeof i=="function"}const Ra={parse:oY,unparse:aY,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:_S,BAD_DELIMITERS:["\r",`
`,'"',_S],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:qb,ParserHandle:NL,ChunkStreamer:FL},{ChunkStreamer:fY}=Ra;class dY extends fY{textDecoder=new TextDecoder(this._config.encoding);constructor(t={}){super(t)}async stream(t){this._input=t;try{for await(const e of t)this.parseChunk(this.getStringChunk(e));this._finished=!0,this.parseChunk("")}catch(e){this._sendError(e)}}_nextChunk(){}getStringChunk(t){return typeof t=="string"?t:this.textDecoder.decode(t,{stream:!0})}}const pY="4.3.3",Zx="object-row-table",Yx={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:pY,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(i,t)=>bS(new TextDecoder().decode(i),t),parseText:(i,t)=>bS(i,t),parseInBatches:AY,options:{csv:{shape:Zx,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function bS(i,t){const e={...Yx.options.csv,...t?.csv},n=mY(i),r=e.header==="auto"?UL(n):!!e.header,o={...e,header:r,download:!1,transformHeader:r?VL():void 0,error:_=>{throw new Error(_)}},s=Ra.parse(i,o),l=s.data,c=s.meta.fields||jL(e.columnPrefix,n.length),y=e.shape||Zx;switch(y){case"object-row-table":return{shape:"object-row-table",data:l.map(_=>Array.isArray(_)?x6(_,c):_)};case"array-row-table":return{shape:"array-row-table",data:l.map(_=>Array.isArray(_)?_:w6(_,c))};default:throw new Error(y)}}function AY(i,t){t={...t},t.batchSize==="auto"&&(t.batchSize=4e3);const e={...Yx.options.csv,...t?.csv},n=new $9;let r=!0,o=null,s=null,l=null;const c={...e,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(y){let _=y.data;if(e.skipEmptyLines&&_.flat().join("").trim()==="")return;const C=y.meta.cursor;if(r&&!o&&(e.header==="auto"?UL(_):e.header)){o=_.map(VL());return}r&&(r=!1,o||(o=jL(e.columnPrefix,_.length)),l=gY(_,o)),e.optimizeMemoryUsage&&(_=JSON.parse(JSON.stringify(_)));const I=e.shape||Zx;s=s||new Ng(l,{shape:I,...t});try{s.addRow(_);const k=s&&s.getFullBatch({bytesUsed:C});k&&n.enqueue(k)}catch(k){n.enqueue(k)}},complete(y){try{const _=y.meta.cursor,C=s&&s.getFinalBatch({bytesUsed:_});C&&n.enqueue(C)}catch(_){n.enqueue(_)}n.close()}};return Ra.parse(i,c,dY),n}function UL(i){return i&&i.every(t=>typeof t=="string")}function mY(i){return Ra.parse(i,{dynamicTyping:!0,preview:1}).data[0]}function VL(){const i=new Set;return t=>{let e=t,n=1;for(;i.has(e);)e=`${t}.${n}`,n++;return i.add(e),e}}function jL(i,t=0){const e=[];for(let n=0;n<t;n++)e.push(`${i}${n+1}`);return e}function gY(i,t){const e=t?{}:[];for(let n=0;n<i.length;n++){const r=t&&t[n]||n;switch(typeof i[n]){case"number":case"boolean":e[r]={name:String(r),index:n,type:Float32Array};break;case"string":default:e[r]={name:String(r),index:n,type:Array}}}return e}function da(i,t){if(!i)throw new Error(t||"assert failed: gltf")}const WL={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},HL={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},yY=1.33,xS=["SCALAR","VEC2","VEC3","VEC4"],vY=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],_Y=new Map(vY),bY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},wY={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function XL(i){return xS[i-1]||xS[0]}function Vy(i){const t=_Y.get(i.constructor);if(!t)throw new Error("Illegal typed array");return t}function Qx(i,t){const e=wY[i.componentType],n=bY[i.type],r=xY[i.componentType],o=i.count*n,s=i.count*n*r;da(s>=0&&s<=t.byteLength);const l=HL[i.componentType],c=WL[i.type];return{ArrayType:e,length:o,byteLength:s,componentByteSize:l,numberOfComponentsInElement:c}}function qL(i){let{images:t,bufferViews:e}=i;t=t||[],e=e||[];const n=t.map(s=>s.bufferView);e=e.filter(s=>!n.includes(s));const r=e.reduce((s,l)=>s+l.byteLength,0),o=t.reduce((s,l)=>{const{width:c,height:y}=l.image;return s+c*y},0);return r+Math.ceil(4*o*yY)}function EY(i,t,e){const n=i.bufferViews[e];da(n);const r=n.buffer,o=t[r];da(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function CY(i,t,e){const n=typeof e=="number"?i.accessors?.[e]:e;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(e)}`);const r=i.bufferViews?.[n.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:o,byteOffset:s}=t[r.buffer],l=(s||0)+(n.byteOffset||0)+(r.byteOffset||0),{ArrayType:c,length:y,componentByteSize:_,numberOfComponentsInElement:C}=Qx(n,r),I=_*C,k=r.byteStride||I;if(typeof r.byteStride>"u"||r.byteStride===I)return new c(o,l,y);const z=new c(y);for(let V=0;V<n.count;V++){const X=new c(o,l+V*k,C);z.set(X,V*C)}return z}function TY(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Xs{gltf;sourceBuffers;byteLength;constructor(t){this.gltf={json:t?.json||TY(),buffers:t?.buffers||[],images:t?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const e=this.getUsedExtensions().find(r=>r===t),n=this.getRequiredExtensions().find(r=>r===t);return typeof e=="string"||typeof n=="string"}getExtension(t){const e=this.getUsedExtensions().find(r=>r===t),n=this.json.extensions||{};return e?n[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const n=this.json[t]&&this.json[t][e];if(!n)throw new Error(`glTF file error: Could not find ${t}[${e}]`);return n}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,n=this.gltf.buffers[e];da(n);const r=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,r,t.byteLength)}getTypedArrayForAccessor(t){const e=this.getAccessor(t);return CY(this.gltf.json,this.gltf.buffers,e)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),n=this.getBuffer(e.buffer).data,r=e.byteOffset||0;return new Uint8Array(n,r,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,n){return t.extensions=t.extensions||{},t.extensions[e]=n,this.registerUsedExtension(e),this}setObjectExtension(t,e,n){const r=t.extensions||{};r[e]=n}removeObjectExtension(t,e){const n=t?.extensions||{};if(n[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}delete n[e]}addExtension(t,e={}){return da(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t,e={}){return da(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(this.json.extensions?.[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:n}=t;this.json.nodes=this.json.nodes||[];const r={mesh:e};return n&&(r.matrix=n),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:n,material:r,mode:o=4}=t,s={primitives:[{attributes:this._addAttributes(e),mode:o}]};if(n){const l=this._addIndices(n);s.primitives[0].indices=l}return Number.isFinite(r)&&(s.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const n=tx(t),r=e||n?.mimeType,o={bufferView:this.addBufferView(t),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(t,e=0,n=this.byteLength){const r=t.byteLength;da(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const o={buffer:e,byteOffset:n,byteLength:r};return this.byteLength+=mm(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(t,e){const n={bufferView:t,type:XL(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const n=this.addBufferView(t);let r={min:e.min,max:e.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(t,e.size));const o={size:e.size,componentType:Vy(t),count:Math.round(t.length/e.size),min:r.min,max:r.max};return this.addAccessor(n,Object.assign(o,e))}addTexture(t){const{imageIndex:e}=t,n={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){const t=this.byteLength,e=new ArrayBuffer(t),n=new Uint8Array(e);let r=0;for(const o of this.sourceBuffers||[])r=PN(o,n,r);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=t:this.json.buffers=[{byteLength:t}],this.gltf.binary=e,this.sourceBuffers=[e],this.gltf.buffers=[{arrayBuffer:e,byteOffset:0,byteLength:e.byteLength}]}_removeStringFromArray(t,e){let n=!0;for(;n;){const r=t.indexOf(e);r>-1?t.splice(r,1):n=!1}}_addAttributes(t={}){const e={};for(const n in t){const r=t[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(r.value,r);e[o]=s}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const n={min:null,max:null};if(t.length<e)return n;n.min=[],n.max=[];const r=t.subarray(0,e);for(const o of r)n.min.push(o),n.max.push(o);for(let o=e;o<t.length;o+=e)for(let s=0;s<e;s++)n.min[0+s]=Math.min(n.min[0+s],t[o+s]),n.max[0+s]=Math.max(n.max[0+s],t[o+s]);return n}}function wS(i){return(i%1+1)%1}const KL={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},SY={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},ZL={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Jx(i,t){return ZL[t]*KL[i]}function Gy(i,t,e,n){if(e!=="UINT8"&&e!=="UINT16"&&e!=="UINT32"&&e!=="UINT64")return null;const r=i.getTypedArrayForBufferView(t),o=jy(r,"SCALAR",e,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function jy(i,t,e,n=1){const r=KL[t],o=SY[e],s=ZL[e],l=n*r,c=l*s;let y=i.buffer,_=i.byteOffset;return _%s!==0&&(y=new Uint8Array(y).slice(_,_+c).buffer,_=0),new o(y,_,l)}function $x(i,t,e){const n=`TEXCOORD_${t.texCoord||0}`,r=e.attributes[n],o=i.getTypedArrayForAccessor(r),s=i.gltf.json,l=t.index,c=s.textures?.[l]?.source;if(typeof c<"u"){const y=s.images?.[c]?.mimeType,_=i.gltf.images?.[c];if(_&&typeof _.width<"u"){const C=[];for(let I=0;I<o.length;I+=2){const k=PY(_,y,o,I,t.channels);C.push(k)}return C}}return[]}function YL(i,t,e,n,r){if(!e?.length)return;const o=[];for(const _ of e){let C=n.findIndex(I=>I===_);C===-1&&(C=n.push(_)-1),o.push(C)}const s=new Uint32Array(o),l=i.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,c=i.addBufferView(s,l,0),y=i.addAccessor(c,{size:1,componentType:Vy(s),count:s.length});r.attributes[t]=y}function PY(i,t,e,n,r=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=e[n],l=e[n+1];let c=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(c=4);const y=IY(s,l,i,c);let _=0;for(const C of r){const I=typeof C=="number"?Object.values(o)[C]:o[C],k=y+I.offset,z=C6(i);if(z.data.length<=k)throw new Error(`${z.data.length} <= ${k}`);const V=z.data[k];_|=V<<I.shift}return _}function IY(i,t,e,n=1){const r=e.width,o=wS(i)*(r-1),s=Math.round(o),l=e.height,c=wS(t)*(l-1),y=Math.round(c),_=e.components?e.components:n;return(y*r+s)*_}function QL(i,t,e,n,r){const o=[];for(let s=0;s<t;s++){const l=e[s],c=e[s+1]-e[s];if(c+l>n)break;const y=l/r,_=c/r;o.push(i.slice(y,y+_))}return o}function JL(i,t,e){const n=[];for(let r=0;r<t;r++){const o=r*e;n.push(i.slice(o,o+e))}return n}function $L(i,t,e,n){if(e)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const r=[],o=new TextDecoder("utf8");let s=0;for(let l=0;l<i;l++){const c=n[l+1]-n[l];if(c+s<=t.length){const y=t.subarray(s,c+s),_=o.decode(y);r.push(_),s+=c}}return r}return[]}const ap="EXT_mesh_features",MY=ap;async function BY(i,t){const e=new Xs(i);LY(e,t)}function RY(i,t){const e=new Xs(i);return kY(e),e.createBinaryChunk(),e.gltf}function LY(i,t){const e=i.gltf.json;if(e.meshes)for(const n of e.meshes)for(const r of n.primitives)DY(i,r,t)}function DY(i,t,e){if(!e?.gltf?.loadBuffers)return;const n=t.extensions?.[ap]?.featureIds;if(n)for(const r of n){let o;if(typeof r.attribute<"u"){const s=`_FEATURE_ID_${r.attribute}`,l=t.attributes[s];o=i.getTypedArrayForAccessor(l)}else typeof r.texture<"u"&&e?.gltf?.loadImages?o=$x(i,r.texture,t):o=[];r.data=o}}function kY(i,t){const e=i.gltf.json.meshes;if(e)for(const n of e)for(const r of n.primitives)FY(i,r)}function OY(i,t,e,n){t.extensions||(t.extensions={});let r=t.extensions[ap];r||(r={featureIds:[]},t.extensions[ap]=r);const{featureIds:o}=r,s={featureCount:e.length,propertyTable:n,data:e};o.push(s),i.addObjectExtension(t,ap,r)}function FY(i,t){const e=t.extensions?.[ap];if(!e)return;const n=e.featureIds;n.forEach((r,o)=>{if(r.data){const{accessorKey:s,index:l}=NY(t.attributes),c=new Uint32Array(r.data);n[o]={featureCount:c.length,propertyTable:r.propertyTable,attribute:l},i.gltf.buffers.push({arrayBuffer:c.buffer,byteOffset:c.byteOffset,byteLength:c.byteLength});const y=i.addBufferView(c),_=i.addAccessor(y,{size:1,componentType:Vy(c),count:c.length});t.attributes[s]=_}})}function NY(i){const t="_FEATURE_ID_",e=Object.keys(i).filter(r=>r.indexOf(t)===0);let n=-1;for(const r of e){const o=Number(r.substring(t.length));o>n&&(n=o)}return n++,{accessorKey:`${t}${n}`,index:n}}const zY=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:OY,decode:BY,encode:RY,name:MY},Symbol.toStringTag,{value:"Module"})),bp="EXT_structural_metadata",UY=bp;async function VY(i,t){const e=new Xs(i);jY(e,t)}function GY(i,t){const e=new Xs(i);return sQ(e),e.createBinaryChunk(),e.gltf}function jY(i,t){if(!t.gltf?.loadBuffers)return;const e=i.getExtension(bp);e&&(t.gltf?.loadImages&&WY(i,e),HY(i,e))}function WY(i,t){const e=t.propertyTextures,n=i.gltf.json;if(e&&n.meshes)for(const r of n.meshes)for(const o of r.primitives)qY(i,e,o,t)}function HY(i,t){const e=t.schema;if(!e)return;const n=e.classes,r=t.propertyTables;if(n&&r)for(const o in n){const s=XY(r,o);s&&ZY(i,e,s)}}function XY(i,t){for(const e of i)if(e.class===t)return e;return null}function qY(i,t,e,n){if(!t)return;const r=e.extensions?.[bp]?.propertyTextures;if(r)for(const o of r){const s=t[o];KY(i,s,e,n)}}function KY(i,t,e,n){if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const r=t.class;for(const o in t.properties){const s=`${r}_${o}`,l=t.properties?.[o];if(!l)continue;l.data||(l.data=[]);const c=l.data,y=$x(i,l,e);y!==null&&(YL(i,s,y,c,e),l.data=c,n.dataAttributeNames.push(s))}}function ZY(i,t,e){const n=t.classes?.[e.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${e.class}`);const r=e.count;for(const o in n.properties){const s=n.properties[o],l=e.properties?.[o];if(l){const c=YY(i,t,s,r,l);l.data=c}}}function YY(i,t,e,n,r){let o=[];const s=r.values,l=i.getTypedArrayForBufferView(s),c=QY(i,e,r,n),y=JY(i,r,n);switch(e.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=$Y(e,n,l,c);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${e.type}`);case"STRING":{o=$L(n,l,c,y);break}case"ENUM":{o=tQ(t,e,n,l,c);break}default:throw new Error(`Unknown classProperty type ${e.type}`)}return o}function QY(i,t,e,n){return t.array&&typeof t.count>"u"&&typeof e.arrayOffsets<"u"?Gy(i,e.arrayOffsets,e.arrayOffsetType||"UINT32",n):null}function JY(i,t,e){return typeof t.stringOffsets<"u"?Gy(i,t.stringOffsets,t.stringOffsetType||"UINT32",e):null}function $Y(i,t,e,n){const r=i.array,o=i.count,s=Jx(i.type,i.componentType),l=e.byteLength/s;let c;return i.componentType?c=jy(e,i.type,i.componentType,l):c=e,r?n?QL(c,t,n,e.length,s):o?JL(c,t,o):[]:c}function tQ(i,t,e,n,r){const o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=i.enums?.[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const l=s.valueType||"UINT16",c=Jx(t.type,l),y=n.byteLength/c;let _=jy(n,t.type,l,y);if(_||(_=n),t.array){if(r)return eQ({valuesData:_,numberOfElements:e,arrayOffsets:r,valuesDataBytesLength:n.length,elementSize:c,enumEntry:s});const C=t.count;return C?iQ(_,e,C,s):[]}return tw(_,0,e,s)}function eQ(i){const{valuesData:t,numberOfElements:e,arrayOffsets:n,valuesDataBytesLength:r,elementSize:o,enumEntry:s}=i,l=[];for(let c=0;c<e;c++){const y=n[c],_=n[c+1]-n[c];if(_+y>r)break;const C=y/o,I=_/o,k=tw(t,C,I,s);l.push(k)}return l}function iQ(i,t,e,n){const r=[];for(let o=0;o<t;o++){const s=e*o,l=tw(i,s,e,n);r.push(l)}return r}function tw(i,t,e,n){const r=[];for(let o=0;o<e;o++)if(i instanceof BigInt64Array||i instanceof BigUint64Array)r.push("");else{const s=i[t+o],l=nQ(n,s);l?r.push(l.name):r.push("")}return r}function nQ(i,t){for(const e of i.values)if(e.value===t)return e;return null}const rQ="schemaClassId";function sQ(i,t){const e=i.getExtension(bp);if(e&&e.propertyTables)for(const n of e.propertyTables){const r=n.class,o=e.schema?.classes?.[r];n.properties&&o&&oQ(n,o,i)}}function oQ(i,t,e){for(const n in i.properties){const r=i.properties[n].data;if(r){const o=t.properties[n];if(o){const s=cQ(r,o,e);i.properties[n]=s}}}}function aQ(i,t,e=rQ){let n=i.getExtension(bp);n||(n=i.addExtension(bp)),n.schema=lQ(t,e,n.schema);const r=uQ(t,e,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(r)-1}function lQ(i,t,e){const n=e??{id:"schema_id"},r={properties:{}};for(const o of i){const s={type:o.elementType,componentType:o.componentType};r.properties[o.name]=s}return n.classes={},n.classes[t]=r,n}function uQ(i,t,e){const n={class:t,count:0};let r=0;const o=e.classes?.[t];for(const s of i){if(r===0&&(r=s.values.length),r!==s.values.length&&s.values.length)throw new Error("Illegal values in attributes");o?.properties[s.name]&&(n.properties||(n.properties={}),n.properties[s.name]={values:0,data:s.values})}return n.count=r,n}function cQ(i,t,e){const n={values:0};if(t.type==="STRING"){const{stringData:r,stringOffsets:o}=dQ(i);n.stringOffsets=j_(o,e),n.values=j_(r,e)}else if(t.type==="SCALAR"&&t.componentType){const r=fQ(i,t.componentType);n.values=j_(r,e)}return n}const hQ={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function fQ(i,t){const e=[];for(const r of i)e.push(Number(r));const n=hQ[t];if(!n)throw new Error("Illegal component type");return new n(e)}function dQ(i){const t=new TextEncoder,e=[];let n=0;for(const c of i){const y=t.encode(c);n+=y.length,e.push(y)}const r=new Uint8Array(n),o=[];let s=0;for(const c of e)r.set(c,s),o.push(s),s+=c.length;o.push(s);const l=new Uint32Array(o);return{stringData:r,stringOffsets:l}}function j_(i,t){return t.gltf.buffers.push({arrayBuffer:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}),t.addBufferView(i)}const pQ=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:aQ,decode:VY,encode:GY,name:UY},Symbol.toStringTag,{value:"Module"})),t8="EXT_feature_metadata",AQ=t8;async function mQ(i,t){const e=new Xs(i);gQ(e,t)}function gQ(i,t){if(!t.gltf?.loadBuffers)return;const e=i.getExtension(t8);e&&(t.gltf?.loadImages&&yQ(i,e),vQ(i,e))}function yQ(i,t){const e=t.schema;if(!e)return;const n=e.classes,{featureTextures:r}=t;if(n&&r)for(const o in n){const s=n[o],l=bQ(r,o);l&&wQ(i,l,s)}}function vQ(i,t){const e=t.schema;if(!e)return;const n=e.classes,r=t.featureTables;if(n&&r)for(const o in n){const s=_Q(r,o);s&&xQ(i,e,s)}}function _Q(i,t){for(const e in i){const n=i[e];if(n.class===t)return n}return null}function bQ(i,t){for(const e in i){const n=i[e];if(n.class===t)return n}return null}function xQ(i,t,e){if(!e.class)return;const n=t.classes?.[e.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${e.class}`);const r=e.count;for(const o in n.properties){const s=n.properties[o],l=e.properties?.[o];if(l){const c=EQ(i,t,s,r,l);l.data=c}}}function wQ(i,t,e){const n=t.class;for(const r in e.properties){const o=t?.properties?.[r];if(o){const s=IQ(i,o,n);o.data=s}}}function EQ(i,t,e,n,r){let o=[];const s=r.bufferView,l=i.getTypedArrayForBufferView(s),c=CQ(i,e,r,n),y=TQ(i,e,r,n);return e.type==="STRING"||e.componentType==="STRING"?o=$L(n,l,c,y):SQ(e)&&(o=PQ(e,n,l,c)),o}function CQ(i,t,e,n){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof e.arrayOffsetBufferView<"u"?Gy(i,e.arrayOffsetBufferView,e.offsetType||"UINT32",n):null}function TQ(i,t,e,n){return typeof e.stringOffsetBufferView<"u"?Gy(i,e.stringOffsetBufferView,e.offsetType||"UINT32",n):null}function SQ(i){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(i.type)||typeof i.componentType<"u"&&t.includes(i.componentType)}function PQ(i,t,e,n){const r=i.type==="ARRAY",o=i.componentCount,s="SCALAR",l=i.componentType||i.type,c=Jx(s,l),y=e.byteLength/c,_=jy(e,s,l,y);return r?n?QL(_,t,n,e.length,c):o?JL(_,t,o):[]:_}function IQ(i,t,e){const n=i.gltf.json;if(!n.meshes)return[];const r=[];for(const o of n.meshes)for(const s of o.primitives)MQ(i,e,t,r,s);return r}function MQ(i,t,e,n,r){const o={channels:e.channels,...e.texture},s=$x(i,o,r);s&&YL(i,t,s,n,r)}const BQ=Object.freeze(Object.defineProperty({__proto__:null,decode:mQ,name:AQ},Symbol.toStringTag,{value:"Module"})),RQ="4.3.3",LQ="4.3.3",ny={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let ES;async function CS(i){return iN(i.modules),nN("basis")||(ES||=DQ(i),await ES)}async function DQ(i){let t=null,e=null;return[t,e]=await Promise.all([await qh(ny.TRANSCODER,"textures",i),await qh(ny.TRANSCODER_WASM,"textures",i)]),t=t||globalThis.BASIS,await kQ(t,e)}function kQ(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{i(e).then(r=>{const{BasisFile:o,initializeBasis:s}=r;s(),n({BasisFile:o})})})}let W_;async function TS(i){const t=i.modules||{};return t.basisEncoder?t.basisEncoder:(W_=W_||OQ(i),await W_)}async function OQ(i){let t=null,e=null;return[t,e]=await Promise.all([await qh(ny.ENCODER,"textures",i),await qh(ny.ENCODER_WASM,"textures",i)]),t=t||globalThis.BASIS,await FQ(t,e)}function FQ(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{i(e).then(r=>{const{BasisFile:o,KTX2File:s,initializeBasis:l,BasisEncoder:c}=r;l(),n({BasisFile:o,KTX2File:s,BasisEncoder:c})})})}const bd={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},NQ=["","WEBKIT_","MOZ_"],SS={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let P0=null;function zQ(i){if(!P0){i=i||UQ()||void 0,P0=new Set;for(const t of NQ)for(const e in SS)if(i&&i.getExtension(`${t}${e}`)){const n=SS[e];P0.add(n)}}return P0}function UQ(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const la=[171,75,84,88,32,50,48,187,13,10,26,10];function VQ(i){const t=new Uint8Array(i);return!(t.byteLength<la.length||t[0]!==la[0]||t[1]!==la[1]||t[2]!==la[2]||t[3]!==la[3]||t[4]!==la[4]||t[5]!==la[5]||t[6]!==la[6]||t[7]!==la[7]||t[8]!==la[8]||t[9]!==la[9]||t[10]!==la[10]||t[11]!==la[11])}const GQ={etc1:{basisFormat:0,compressed:!0,format:bd.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:bd.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:bd.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:bd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:bd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:bd.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function jQ(i,t){if(t.basis.containerFormat==="auto"){if(VQ(i)){const n=await TS(t);return PS(n.KTX2File,i,t)}const{BasisFile:e}=await CS(t);return H_(e,i,t)}switch(t.basis.module){case"encoder":const e=await TS(t);switch(t.basis.containerFormat){case"ktx2":return PS(e.KTX2File,i,t);case"basis":default:return H_(e.BasisFile,i,t)}case"transcoder":default:const{BasisFile:n}=await CS(t);return H_(n,i,t)}}function H_(i,t,e){const n=new i(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const r=n.getNumImages(),o=[];for(let s=0;s<r;s++){const l=n.getNumLevels(s),c=[];for(let y=0;y<l;y++)c.push(WQ(n,s,y,e));o.push(c)}return o}finally{n.close(),n.delete()}}function WQ(i,t,e,n){const r=i.getImageWidth(t,e),o=i.getImageHeight(t,e),s=i.getHasAlpha(),{compressed:l,format:c,basisFormat:y}=e8(n,s),_=i.getImageTranscodedSizeInBytes(t,e,y),C=new Uint8Array(_);if(!i.transcodeImage(C,t,e,y,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:o,data:C,compressed:l,format:c,hasAlpha:s}}function PS(i,t,e){const n=new i(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=n.getLevels(),o=[];for(let s=0;s<r;s++)o.push(HQ(n,s,e));return[o]}finally{n.close(),n.delete()}}function HQ(i,t,e){const{alphaFlag:n,height:r,width:o}=i.getImageLevelInfo(t,0,0),{compressed:s,format:l,basisFormat:c}=e8(e,n),y=i.getImageTranscodedSizeInBytes(t,0,0,c),_=new Uint8Array(y);if(!i.transcodeImage(_,t,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:r,data:_,compressed:s,levelSize:y,hasAlpha:n,format:l}}function e8(i,t){let e=i&&i.basis&&i.basis.format;return e==="auto"&&(e=i8()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),GQ[e]}function i8(){const i=zQ();return i.has("astc")?"astc-4x4":i.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:i.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:i.has("etc1")?"etc1":i.has("etc2")?"etc2":"rgb565"}const XQ={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:LQ,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},qQ={...XQ,parse:jQ},xp=!0,IS=1735152710,ew=12,ry=8,KQ=1313821514,ZQ=5130562,YQ=0,QQ=0,JQ=1;function $Q(i,t=0){return`${String.fromCharCode(i.getUint8(t+0))}${String.fromCharCode(i.getUint8(t+1))}${String.fromCharCode(i.getUint8(t+2))}${String.fromCharCode(i.getUint8(t+3))}`}function tJ(i,t=0,e={}){const n=new DataView(i),{magic:r=IS}=e,o=n.getUint32(t,!1);return o===r||o===IS}function eJ(i,t,e=0,n={}){const r=new DataView(t),o=$Q(r,e+0),s=r.getUint32(e+4,xp),l=r.getUint32(e+8,xp);switch(Object.assign(i,{header:{byteOffset:e,byteLength:l,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),e+=ew,i.version){case 1:return iJ(i,r,e);case 2:return nJ(i,r,e,n={});default:throw new Error(`Invalid GLB version ${i.version}. Only supports version 1 and 2.`)}}function iJ(i,t,e){vr(i.header.byteLength>ew+ry);const n=t.getUint32(e+0,xp),r=t.getUint32(e+4,xp);return e+=ry,vr(r===YQ),Kb(i,t,e,n),e+=n,e+=Zb(i,t,e,i.header.byteLength),e}function nJ(i,t,e,n){return vr(i.header.byteLength>ew+ry),rJ(i,t,e,n),e+i.header.byteLength}function rJ(i,t,e,n){for(;e+8<=i.header.byteLength;){const r=t.getUint32(e+0,xp),o=t.getUint32(e+4,xp);switch(e+=ry,o){case KQ:Kb(i,t,e,r);break;case ZQ:Zb(i,t,e,r);break;case QQ:n.strict||Kb(i,t,e,r);break;case JQ:n.strict||Zb(i,t,e,r);break}e+=mm(r,4)}return e}function Kb(i,t,e,n){const r=new Uint8Array(t.buffer,e,n),o=new TextDecoder("utf8").decode(r);return i.json=JSON.parse(o),mm(n,4)}function Zb(i,t,e,n){return i.header.hasBinChunk=!0,i.binChunks.push({byteOffset:e,byteLength:n,arrayBuffer:t.buffer}),mm(n,4)}function n8(i,t){if(i.startsWith("data:")||i.startsWith("http:")||i.startsWith("https:"))return i;const e=t.baseUri||t.uri;if(!e)throw new Error(`'baseUri' must be provided to resolve relative url ${i}`);return e.substr(0,e.lastIndexOf("/")+1)+i}const sJ="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",oJ="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",aJ=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),lJ=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),uJ={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},cJ={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function hJ(i,t,e,n,r,o="NONE"){const s=await fJ();AJ(s,s.exports[cJ[r]],i,t,e,n,s.exports[uJ[o||"NONE"]])}let X_;async function fJ(){return X_||(X_=dJ()),X_}async function dJ(){let i=sJ;WebAssembly.validate(aJ)&&(i=oJ,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(pJ(i),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function pJ(i){const t=new Uint8Array(i.length);for(let n=0;n<i.length;++n){const r=i.charCodeAt(n);t[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let e=0;for(let n=0;n<i.length;++n)t[e++]=t[n]<60?lJ[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,e)}function AJ(i,t,e,n,r,o,s){const l=i.exports.sbrk,c=n+3&-4,y=l(c*r),_=l(o.length),C=new Uint8Array(i.exports.memory.buffer);C.set(o,_);const I=t(y,n,r,_,o.length);if(I===0&&s&&s(y,c,r),e.set(C.subarray(y,y+n*r)),l(y-l(0)),I!==0)throw new Error(`Malformed buffer data: ${I}`)}const sy="EXT_meshopt_compression",mJ=sy;async function gJ(i,t){const e=new Xs(i);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;const n=[];for(const r of i.json.bufferViews||[])n.push(yJ(e,r));await Promise.all(n),e.removeExtension(sy)}async function yJ(i,t){const e=i.getObjectExtension(t,sy);if(e){const{byteOffset:n=0,byteLength:r=0,byteStride:o,count:s,mode:l,filter:c="NONE",buffer:y}=e,_=i.gltf.buffers[y],C=new Uint8Array(_.arrayBuffer,_.byteOffset+n,r),I=new Uint8Array(i.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await hJ(I,s,o,C,l,c),i.removeObjectExtension(t,sy)}}const vJ=Object.freeze(Object.defineProperty({__proto__:null,decode:gJ,name:mJ},Symbol.toStringTag,{value:"Module"})),jd="EXT_texture_webp",_J=jd;function bJ(i,t){const e=new Xs(i);if(!Rz("image/webp")){if(e.getRequiredExtensions().includes(jd))throw new Error(`gltf: Required extension ${jd} not supported by browser`);return}const{json:n}=e;for(const r of n.textures||[]){const o=e.getObjectExtension(r,jd);o&&(r.source=o.source),e.removeObjectExtension(r,jd)}e.removeExtension(jd)}const xJ=Object.freeze(Object.defineProperty({__proto__:null,name:_J,preprocess:bJ},Symbol.toStringTag,{value:"Module"})),xg="KHR_texture_basisu",wJ=xg;function EJ(i,t){const e=new Xs(i),{json:n}=e;for(const r of n.textures||[]){const o=e.getObjectExtension(r,xg);o&&(r.source=o.source,e.removeObjectExtension(r,xg))}e.removeExtension(xg)}const CJ=Object.freeze(Object.defineProperty({__proto__:null,name:wJ,preprocess:EJ},Symbol.toStringTag,{value:"Module"})),TJ="4.3.3",SJ={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:TJ,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function PJ(i,t,e){const n=r8(t.metadata),r=[],o=IJ(t.attributes);for(const s in i){const l=i[s],c=MS(s,l,o[s]);r.push(c)}if(e){const s=MS("indices",e);r.push(s)}return{fields:r,metadata:n}}function IJ(i){const t={};for(const e in i){const n=i[e];t[n.name||"undefined"]=n}return t}function MS(i,t,e){const n=e?r8(e.metadata):void 0;return Q9(i,t,n)}function r8(i){Object.entries(i);const t={};for(const e in i)t[`${e}.string`]=JSON.stringify(i[e]);return t}const BS={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},MJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},BJ=4;class RJ{draco;decoder;metadataQuerier;constructor(t){this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,e={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const r=this.decoder.GetEncodedGeometryType(n),o=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(r){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(n,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(n,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){const C=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(C)}const l=this._getDracoLoaderData(o,r,e),c=this._getMeshData(o,l,e),y=E6(c.attributes),_=PJ(c.attributes,l,c.indices);return{loader:"draco",loaderData:l,header:{vertexCount:o.num_points(),boundingBox:y},...c,schema:_}}finally{this.draco.destroy(n),o&&this.draco.destroy(o)}}_getDracoLoaderData(t,e,n){const r=this._getTopLevelMetadata(t),o=this._getDracoAttributes(t,n);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:r,attributes:o}}_getDracoAttributes(t,e){const n={};for(let r=0;r<t.num_attributes();r++){const o=this.decoder.GetAttribute(t,r),s=this._getAttributeMetadata(t,r);n[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:r,metadata:s};const l=this._getQuantizationTransform(o,e);l&&(n[o.unique_id()].quantization_transform=l);const c=this._getOctahedronTransform(o,e);c&&(n[o.unique_id()].octahedron_transform=c)}return n}_getMeshData(t,e,n){const r=this._getMeshAttributes(e,t,n);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(t,e,n){const r={};for(const o of Object.values(t.attributes)){const s=this._deduceAttributeName(o,n);o.name=s;const l=this._getAttributeValues(e,o);if(l){const{value:c,size:y}=l;r[s]={value:c,size:y,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return r}_getTriangleListIndices(t){const e=t.num_faces()*3,n=e*BJ,r=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(t,n,r),new Uint32Array(this.draco.HEAPF32.buffer,r,e).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),kJ(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const n=MJ[e.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${e.data_type}`),null;const r=e.num_components,o=t.num_points()*r,s=o*n.BYTES_PER_ELEMENT,l=LJ(this.draco,n);let c;const y=this.draco._malloc(s);try{const _=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,_,l,s,y),c=new n(this.draco.HEAPF32.buffer,y,o).slice()}finally{this.draco._free(y)}return{value:c,size:r}}_deduceAttributeName(t,e){const n=t.unique_id;for(const[s,l]of Object.entries(e.extraAttributes||{}))if(l===n)return s;const r=t.attribute_type;for(const s in BS)if(this.draco[s]===r)return BS[s];const o=e.attributeNameEntry||"name";return t.metadata[o]?t.metadata[o].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const n=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},n=this.metadataQuerier.NumEntries(t);for(let r=0;r<n;r++){const o=this.metadataQuerier.GetEntryName(t,r);e[o]=this._getDracoMetadataField(t,o)}return e}_getDracoMetadataField(t,e){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,n);const r=DJ(n);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:r}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:n=[]}=t,r=[...e,...n];for(const o of r)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(t,e){const{quantizedAttributes:n=[]}=e,r=t.attribute_type();if(n.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(s=>o.min_value(s))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:n=[]}=e,r=t.attribute_type();if(n.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function LJ(i,t){switch(t){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32;default:return i.DT_INVALID}}function DJ(i){const t=i.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=i.GetValue(n);return e}function kJ(i){const t=i.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=i.GetValue(n);return e}const OJ="1.5.6",FJ="1.4.1",q_=`https://www.gstatic.com/draco/versioned/decoders/${OJ}`,Zo={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},K_={[Zo.DECODER]:`${q_}/${Zo.DECODER}`,[Zo.DECODER_WASM]:`${q_}/${Zo.DECODER_WASM}`,[Zo.FALLBACK_DECODER]:`${q_}/${Zo.FALLBACK_DECODER}`,[Zo.ENCODER]:`https://raw.githubusercontent.com/google/draco/${FJ}/javascript/${Zo.ENCODER}`};let Z_;async function NJ(i){const t=i.modules||{};return t.draco3d?Z_||=t.draco3d.createDecoderModule({}).then(e=>({draco:e})):Z_||=zJ(i),await Z_}async function zJ(i){let t,e;switch(i.draco&&i.draco.decoderType){case"js":t=await qh(K_[Zo.FALLBACK_DECODER],"draco",i,Zo.FALLBACK_DECODER);break;case"wasm":default:[t,e]=await Promise.all([await qh(K_[Zo.DECODER],"draco",i,Zo.DECODER),await qh(K_[Zo.DECODER_WASM],"draco",i,Zo.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await UJ(t,e)}function UJ(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{i({...e,onModuleLoaded:r=>n({draco:r})})})}const s8={...SJ,parse:VJ};async function VJ(i,t){const{draco:e}=await NJ(t),n=new RJ(e);try{return n.parseSync(i,t?.draco)}finally{n.destroy()}}function GJ(i){const t={};for(const e in i){const n=i[e];if(e!=="indices"){const r=o8(n);t[e]=r}}return t}function o8(i){const{buffer:t,size:e,count:n}=jJ(i);return{value:t,size:e,byteOffset:0,count:n,type:XL(e),componentType:Vy(t)}}function jJ(i){let t=i,e=1,n=0;return i&&i.value&&(t=i.value,e=i.size||1),t&&(ArrayBuffer.isView(t)||(t=WJ(t,Float32Array)),n=t.length/e),{buffer:t,size:e,count:n}}function WJ(i,t,e=!1){return i?Array.isArray(i)?new t(i):e&&!(i instanceof t)?new t(i):i:null}const Yc="KHR_draco_mesh_compression",HJ=Yc;function XJ(i,t,e){const n=new Xs(i);for(const r of a8(n))n.getObjectExtension(r,Yc)}async function qJ(i,t,e){if(!t?.gltf?.decompressMeshes)return;const n=new Xs(i),r=[];for(const o of a8(n))n.getObjectExtension(o,Yc)&&r.push(ZJ(n,o,t,e));await Promise.all(r),n.removeExtension(Yc)}function KJ(i,t={}){const e=new Xs(i);for(const n of e.json.meshes||[])YJ(n),e.addRequiredExtension(Yc)}async function ZJ(i,t,e,n){const r=i.getObjectExtension(t,Yc);if(!r)return;const o=i.getTypedArrayForBufferView(r.bufferView),s=X2(o.buffer,o.byteOffset),l={...e};delete l["3d-tiles"];const c=await Am(s,s8,l,n),y=GJ(c.attributes);for(const[_,C]of Object.entries(y))if(_ in t.attributes){const I=t.attributes[_],k=i.getAccessor(I);k?.min&&k?.max&&(C.min=k.min,C.max=k.max)}t.attributes=y,c.indices&&(t.indices=o8(c.indices)),i.removeObjectExtension(t,Yc),QJ(t)}function YJ(i,t,e=4,n,r){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:i}),s=r?.parseSync?.({attributes:i}),l=n._addFauxAttributes(s.attributes),c=n.addBufferView(o);return{primitives:[{attributes:l,mode:e,extensions:{[Yc]:{bufferView:c,attributes:l}}}]}}function QJ(i){if(!i.attributes&&Object.keys(i.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*a8(i){for(const t of i.json.meshes||[])for(const e of t.primitives)yield e}const JJ=Object.freeze(Object.defineProperty({__proto__:null,decode:qJ,encode:KJ,name:HJ,preprocess:XJ},Symbol.toStringTag,{value:"Module"})),Wy="KHR_texture_transform",$J=Wy,I0=new ve,t$=new ts,e$=new ts;async function i$(i,t){if(!new Xs(i).hasExtension(Wy)||!t.gltf?.loadBuffers)return;const e=i.json.materials||[];for(let n=0;n<e.length;n++)n$(n,i)}function n$(i,t){const e=t.json.materials?.[i],n=[e?.pbrMetallicRoughness?.baseColorTexture,e?.emissiveTexture,e?.normalTexture,e?.occlusionTexture,e?.pbrMetallicRoughness?.metallicRoughnessTexture],r=[];for(const o of n)o&&o?.extensions?.[Wy]&&r$(t,i,o,r)}function r$(i,t,e,n){const r=s$(e,n);if(!r)return;const o=i.json.meshes||[];for(const s of o)for(const l of s.primitives){const c=l.material;Number.isFinite(c)&&t===c&&o$(i,l,r)}}function s$(i,t){const e=i.extensions?.[Wy],{texCoord:n=0}=i,{texCoord:r=n}=e;if(t.findIndex(([o,s])=>o===n&&s===r)===-1){const o=u$(e);return n!==r&&(i.texCoord=r),t.push([n,r]),{originalTexCoord:n,texCoord:r,matrix:o}}return null}function o$(i,t,e){const{originalTexCoord:n,texCoord:r,matrix:o}=e,s=t.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const l=i.json.accessors?.[s];if(l&&l.bufferView){const c=i.json.bufferViews?.[l.bufferView];if(c){const{arrayBuffer:y,byteOffset:_}=i.buffers[c.buffer],C=(_||0)+(l.byteOffset||0)+(c.byteOffset||0),{ArrayType:I,length:k}=Qx(l,c),z=HL[l.componentType],V=WL[l.type],X=c.byteStride||z*V,H=new Float32Array(k);for(let $=0;$<l.count;$++){const Y=new I(y,C+$*X,2);I0.set(Y[0],Y[1],1),I0.transformByMatrix3(o),H.set([I0[0],I0[1]],$*V)}n===r?a$(l,c,i.buffers,H):l$(r,l,t,i,H)}}}}function a$(i,t,e,n){i.componentType=5126,e.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function l$(i,t,e,n,r){n.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes[`TEXCOORD_${i}`]=s.length-1)}function u$(i){const{offset:t=[0,0],rotation:e=0,scale:n=[1,1]}=i,r=new ts().set(1,0,0,0,1,0,t[0],t[1],1),o=t$.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),s=e$.set(n[0],0,0,0,n[1],0,0,0,1);return r.multiplyRight(o).multiplyRight(s)}const c$=Object.freeze(Object.defineProperty({__proto__:null,decode:i$,name:$J},Symbol.toStringTag,{value:"Module"})),Hh="KHR_lights_punctual",h$=Hh;async function f$(i){const t=new Xs(i),{json:e}=t,n=t.getExtension(Hh);n&&(t.json.lights=n.lights,t.removeExtension(Hh));for(const r of e.nodes||[]){const o=t.getObjectExtension(r,Hh);o&&(r.light=o.light),t.removeObjectExtension(r,Hh)}}async function d$(i){const t=new Xs(i),{json:e}=t;if(e.lights){const n=t.addExtension(Hh);da(!n.lights),n.lights=e.lights,delete e.lights}if(t.json.lights){for(const n of t.json.lights){const r=n.node;t.addObjectExtension(r,Hh,n)}delete t.json.lights}}const p$=Object.freeze(Object.defineProperty({__proto__:null,decode:f$,encode:d$,name:h$},Symbol.toStringTag,{value:"Module"})),am="KHR_materials_unlit",A$=am;async function m$(i){const t=new Xs(i),{json:e}=t;for(const n of e.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,am);t.removeExtension(am)}function g$(i){const t=new Xs(i),{json:e}=t;if(t.materials)for(const n of e.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,am,{}),t.addExtension(am))}const y$=Object.freeze(Object.defineProperty({__proto__:null,decode:m$,encode:g$,name:A$},Symbol.toStringTag,{value:"Module"})),LA="KHR_techniques_webgl",v$=LA;async function _$(i){const t=new Xs(i),{json:e}=t,n=t.getExtension(LA);if(n){const r=x$(n,t);for(const o of e.materials||[]){const s=t.getObjectExtension(o,LA);s&&(o.technique=Object.assign({},s,r[s.technique]),o.technique.values=w$(o.technique,t)),t.removeObjectExtension(o,LA)}t.removeExtension(LA)}}async function b$(i,t){}function x$(i,t){const{programs:e=[],shaders:n=[],techniques:r=[]}=i,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(t.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),r.forEach(s=>{s.program=e[s.program]}),r}function w$(i,t){const e=Object.assign({},i.values);return Object.keys(i.uniforms||{}).forEach(n=>{i.uniforms[n].value&&!(n in e)&&(e[n]=i.uniforms[n].value)}),Object.keys(e).forEach(n=>{typeof e[n]=="object"&&e[n].index!==void 0&&(e[n].texture=t.getTexture(e[n].index))}),e}const E$=Object.freeze(Object.defineProperty({__proto__:null,decode:_$,encode:b$,name:v$},Symbol.toStringTag,{value:"Module"})),l8=[pQ,zY,vJ,xJ,CJ,JJ,p$,y$,E$,c$,BQ];function C$(i,t={},e){const n=l8.filter(r=>u8(r.name,t));for(const r of n)r.preprocess?.(i,t,e)}async function T$(i,t={},e){const n=l8.filter(r=>u8(r.name,t));for(const r of n)await r.decode?.(i,t,e)}function u8(i,t){const e=t?.gltf?.excludeExtensions||{};return!(i in e&&!e[i])}const Y_="KHR_binary_glTF";function S$(i){const t=new Xs(i),{json:e}=t;for(const n of e.images||[]){const r=t.getObjectExtension(n,Y_);r&&Object.assign(n,r),t.removeObjectExtension(n,Y_)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(Y_)}const RS={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},P$={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class I${idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(t,e){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),S$(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in RS)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const n=t[e];if(!(!n||Array.isArray(n))){t[e]=[];for(const r in n){const o=n[r];o.id=o.id||r;const s=t[e].length;t[e].push(o),this.idToIndexMap[e][r]=s}}}_convertObjectIdsToArrayIndices(t){for(const e in RS)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:n,indices:r,material:o}=e;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");r&&(e.indices=this._convertIdToIndex(r,"accessor")),o&&(e.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn(`gltf v1: json doesn't contain attribute ${e}`),t[e]=[]);for(const n of t[e])for(const r in n){const o=n[r],s=this._convertIdToIndex(o,r);n[r]=s}}_convertIdToIndex(t,e){const n=P$[e];if(n in this.idToIndexMap){const r=this.idToIndexMap[n][t];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${e} with id ${t}`);return r}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const e of t.materials){e.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=e.values?.tex||e.values?.texture2d_0||e.values?.diffuseTex,r=t.textures.findIndex(o=>o.id===n);r!==-1&&(e.pbrMetallicRoughness.baseColorTexture={index:r})}}}function M$(i,t={}){return new I$().normalize(i,t)}async function B$(i,t,e=0,n,r){return R$(i,t,e,n),M$(i,{normalize:n?.gltf?.normalize}),C$(i,n,r),n?.gltf?.loadBuffers&&i.json.buffers&&await L$(i,n,r),n?.gltf?.loadImages&&await D$(i,n,r),await T$(i,n,r),i}function R$(i,t,e,n){if(n.uri&&(i.baseUri=n.uri),t instanceof ArrayBuffer&&!tJ(t,e,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")i.json=EN(t);else if(t instanceof ArrayBuffer){const s={};e=eJ(s,t,e,n.glb),da(s.type==="glTF",`Invalid GLB magic string ${s.type}`),i._glb=s,i.json=s.json}else da(!1,"GLTF: must be ArrayBuffer or string");const r=i.json.buffers||[];if(i.buffers=new Array(r.length).fill(null),i._glb&&i._glb.header.hasBinChunk){const{binChunks:s}=i._glb;i.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=i.json.images||[];i.images=new Array(o.length).fill({})}async function L$(i,t,e){const n=i.json.buffers||[];for(let r=0;r<n.length;++r){const o=n[r];if(o.uri){const{fetch:s}=e;da(s);const l=n8(o.uri,t),c=await(await e?.fetch?.(l))?.arrayBuffer?.();i.buffers[r]={arrayBuffer:c,byteOffset:0,byteLength:c.byteLength},delete o.uri}else i.buffers[r]===null&&(i.buffers[r]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function D$(i,t,e){const n=k$(i),r=i.json.images||[],o=[];for(const s of n)o.push(O$(i,r[s],s,t,e));return await Promise.all(o)}function k$(i){const t=new Set,e=i.json.textures||[];for(const n of e)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function O$(i,t,e,n,r){let o;if(t.uri&&!t.hasOwnProperty("bufferView")){const l=n8(t.uri,n),{fetch:c}=r;o=await(await c(l)).arrayBuffer(),t.bufferView={data:o}}if(Number.isFinite(t.bufferView)){const l=EY(i.json,i.buffers,t.bufferView);o=X2(l.buffer,l.byteOffset,l.byteLength)}da(o,"glTF image has no data");let s=await Am(o,[zg,qQ],{...n,mimeType:t.mimeType,basis:n.basis||{format:i8()}},r);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),i.images=i.images||[],i.images[e]=s}const wp={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:RQ,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:F$,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function F$(i,t={},e){t={...wp.options,...t},t.gltf={...wp.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await B$({},i,n,t,e)}const N$={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},z$={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ma={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},U$={magFilter:Ma.TEXTURE_MAG_FILTER,minFilter:Ma.TEXTURE_MIN_FILTER,wrapS:Ma.TEXTURE_WRAP_S,wrapT:Ma.TEXTURE_WRAP_T},V$={[Ma.TEXTURE_MAG_FILTER]:Ma.LINEAR,[Ma.TEXTURE_MIN_FILTER]:Ma.NEAREST_MIPMAP_LINEAR,[Ma.TEXTURE_WRAP_S]:Ma.REPEAT,[Ma.TEXTURE_WRAP_T]:Ma.REPEAT};function G$(){return{id:"default-sampler",parameters:V$}}function j$(i){return z$[i]}function W$(i){return N$[i]}class H${baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(t,e={}){const{json:n,buffers:r=[],images:o=[]}=t,{baseUri:s=""}=t;return da(n),this.baseUri=s,this.buffers=r,this.images=o,this.jsonUnprocessed=n,this.json=this._resolveTree(t.json,e),this.json}_resolveTree(t,e={}){const n={...t};return this.json=n,t.bufferViews&&(n.bufferViews=t.bufferViews.map((r,o)=>this._resolveBufferView(r,o))),t.images&&(n.images=t.images.map((r,o)=>this._resolveImage(r,o))),t.samplers&&(n.samplers=t.samplers.map((r,o)=>this._resolveSampler(r,o))),t.textures&&(n.textures=t.textures.map((r,o)=>this._resolveTexture(r,o))),t.accessors&&(n.accessors=t.accessors.map((r,o)=>this._resolveAccessor(r,o))),t.materials&&(n.materials=t.materials.map((r,o)=>this._resolveMaterial(r,o))),t.meshes&&(n.meshes=t.meshes.map((r,o)=>this._resolveMesh(r,o))),t.nodes&&(n.nodes=t.nodes.map((r,o)=>this._resolveNode(r,o)),n.nodes=n.nodes.map((r,o)=>this._resolveNodeChildren(r))),t.skins&&(n.skins=t.skins.map((r,o)=>this._resolveSkin(r,o))),t.scenes&&(n.scenes=t.scenes.map((r,o)=>this._resolveScene(r,o))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,e){if(typeof e=="object")return e;const n=t&&t[e];return n||console.warn(`glTF file error: Could not find ${t}[${e}]`),n}_resolveScene(t,e){return{...t,id:t.id||`scene-${e}`,nodes:(t.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(t,e){const n={...t,id:t?.id||`node-${e}`};return t.mesh!==void 0&&(n.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(n.camera=this.getCamera(t.camera)),t.skin!==void 0&&(n.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(n.mesh=t.meshes.reduce((r,o)=>{const s=this.getMesh(o);return r.id=s.id,r.primitives=r.primitives.concat(s.primitives),r},{primitives:[]})),n}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(e=>this.getNode(e))),t}_resolveSkin(t,e){const n=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${e}`,inverseBindMatrices:n}}_resolveMesh(t,e){const n={...t,id:t.id||`mesh-${e}`,primitives:[]};return t.primitives&&(n.primitives=t.primitives.map(r=>{const o={...r,attributes:{},indices:void 0,material:void 0},s=r.attributes;for(const l in s)o.attributes[l]=this.getAccessor(s[l]);return r.indices!==void 0&&(o.indices=this.getAccessor(r.indices)),r.material!==void 0&&(o.material=this.getMaterial(r.material)),o})),n}_resolveMaterial(t,e){const n={...t,id:t.id||`material-${e}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const r=n.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return n}_resolveAccessor(t,e){const n=j$(t.componentType),r=W$(t.type),o=n*r,s={...t,id:t.id||`accessor-${e}`,bytesPerComponent:n,components:r,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(s.bufferView=this.getBufferView(t.bufferView)),s.bufferView){const l=s.bufferView.buffer,{ArrayType:c,byteLength:y}=Qx(s,s.bufferView),_=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+l.byteOffset;let C=l.arrayBuffer.slice(_,_+y);s.bufferView.byteStride&&(C=this._getValueFromInterleavedBuffer(l,_,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new c(C)}return s}_getValueFromInterleavedBuffer(t,e,n,r,o){const s=new Uint8Array(o*r);for(let l=0;l<o;l++){const c=e+l*n;s.set(new Uint8Array(t.arrayBuffer.slice(c,c+r)),l*r)}return s.buffer}_resolveTexture(t,e){return{...t,id:t.id||`texture-${e}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):G$(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,e){const n={id:t.id||`sampler-${e}`,...t,parameters:{}};for(const r in n){const o=this._enumSamplerParameter(r);o!==void 0&&(n.parameters[o]=n[r])}return n}_enumSamplerParameter(t){return U$[t]}_resolveImage(t,e){const n={...t,id:t.id||`image-${e}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},r=this.images[e];return r&&(n.image=r),n}_resolveBufferView(t,e){const n=t.buffer,r=this.buffers[n].arrayBuffer;let o=this.buffers[n].byteOffset||0;return t.byteOffset&&(o+=t.byteOffset),{id:`bufferView-${e}`,...t,buffer:this.buffers[n],data:new Uint8Array(r,o,t.byteLength)}}_resolveCamera(t,e){const n={...t,id:t.id||`camera-${e}`};return n.perspective,n.orthographic,n}}function iw(i,t){return new H$().postProcess(i,t)}var po=1e-6,Ep=typeof Float32Array<"u"?Float32Array:Array;function X$(){var i=new Ep(4);return Ep!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function q$(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function K$(i,t,e){var n=t[0],r=t[1],o=t[2],s=t[3];return i[0]=e[0]*n+e[4]*r+e[8]*o+e[12]*s,i[1]=e[1]*n+e[5]*r+e[9]*o+e[13]*s,i[2]=e[2]*n+e[6]*r+e[10]*o+e[14]*s,i[3]=e[3]*n+e[7]*r+e[11]*o+e[15]*s,i}(function(){var i=X$();return function(t,e,n,r,o,s){var l,c;for(e||(e=4),n||(n=0),r?c=Math.min(r*e+n,t.length):c=t.length,l=n;l<c;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],i[3]=t[l+3],o(i,i,s),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2],t[l+3]=i[3];return t}})();function wg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function lp(i,t){const e=K$([],t,i);return q$(e,e,1/e[3]),e}function LS(i,t){const e=i%t;return e<0?t+e:e}function Z$(i,t,e){return e*t+(1-e)*i}function Yb(i,t,e){return i<t?t:i>e?e:i}function Y$(i){return Math.log(i)*Math.LOG2E}const nw=Math.log2||Y$;function Q$(i,t){var e=t[0],n=t[1],r=t[2],o=t[3],s=t[4],l=t[5],c=t[6],y=t[7],_=t[8],C=t[9],I=t[10],k=t[11],z=t[12],V=t[13],X=t[14],H=t[15],$=e*l-n*s,Y=e*c-r*s,ct=e*y-o*s,rt=n*c-r*l,nt=n*y-o*l,Ot=r*y-o*c,Kt=_*V-C*z,ft=_*X-I*z,st=_*H-k*z,Ut=C*X-I*V,K=C*H-k*V,dt=I*H-k*X,Tt=$*dt-Y*K+ct*Ut+rt*st-nt*ft+Ot*Kt;return Tt?(Tt=1/Tt,i[0]=(l*dt-c*K+y*Ut)*Tt,i[1]=(r*K-n*dt-o*Ut)*Tt,i[2]=(V*Ot-X*nt+H*rt)*Tt,i[3]=(I*nt-C*Ot-k*rt)*Tt,i[4]=(c*st-s*dt-y*ft)*Tt,i[5]=(e*dt-r*st+o*ft)*Tt,i[6]=(X*ct-z*Ot-H*Y)*Tt,i[7]=(_*Ot-I*ct+k*Y)*Tt,i[8]=(s*K-l*st+y*Kt)*Tt,i[9]=(n*st-e*K-o*Kt)*Tt,i[10]=(z*nt-V*ct+H*$)*Tt,i[11]=(C*ct-_*nt-k*$)*Tt,i[12]=(l*ft-s*Ut-c*Kt)*Tt,i[13]=(e*Ut-n*ft+r*Kt)*Tt,i[14]=(V*Y-z*rt-X*$)*Tt,i[15]=(_*rt-C*Y+I*$)*Tt,i):null}function Q_(i,t,e){var n=t[0],r=t[1],o=t[2],s=t[3],l=t[4],c=t[5],y=t[6],_=t[7],C=t[8],I=t[9],k=t[10],z=t[11],V=t[12],X=t[13],H=t[14],$=t[15],Y=e[0],ct=e[1],rt=e[2],nt=e[3];return i[0]=Y*n+ct*l+rt*C+nt*V,i[1]=Y*r+ct*c+rt*I+nt*X,i[2]=Y*o+ct*y+rt*k+nt*H,i[3]=Y*s+ct*_+rt*z+nt*$,Y=e[4],ct=e[5],rt=e[6],nt=e[7],i[4]=Y*n+ct*l+rt*C+nt*V,i[5]=Y*r+ct*c+rt*I+nt*X,i[6]=Y*o+ct*y+rt*k+nt*H,i[7]=Y*s+ct*_+rt*z+nt*$,Y=e[8],ct=e[9],rt=e[10],nt=e[11],i[8]=Y*n+ct*l+rt*C+nt*V,i[9]=Y*r+ct*c+rt*I+nt*X,i[10]=Y*o+ct*y+rt*k+nt*H,i[11]=Y*s+ct*_+rt*z+nt*$,Y=e[12],ct=e[13],rt=e[14],nt=e[15],i[12]=Y*n+ct*l+rt*C+nt*V,i[13]=Y*r+ct*c+rt*I+nt*X,i[14]=Y*o+ct*y+rt*k+nt*H,i[15]=Y*s+ct*_+rt*z+nt*$,i}function Qb(i,t,e){var n=e[0],r=e[1],o=e[2],s,l,c,y,_,C,I,k,z,V,X,H;return t===i?(i[12]=t[0]*n+t[4]*r+t[8]*o+t[12],i[13]=t[1]*n+t[5]*r+t[9]*o+t[13],i[14]=t[2]*n+t[6]*r+t[10]*o+t[14],i[15]=t[3]*n+t[7]*r+t[11]*o+t[15]):(s=t[0],l=t[1],c=t[2],y=t[3],_=t[4],C=t[5],I=t[6],k=t[7],z=t[8],V=t[9],X=t[10],H=t[11],i[0]=s,i[1]=l,i[2]=c,i[3]=y,i[4]=_,i[5]=C,i[6]=I,i[7]=k,i[8]=z,i[9]=V,i[10]=X,i[11]=H,i[12]=s*n+_*r+z*o+t[12],i[13]=l*n+C*r+V*o+t[13],i[14]=c*n+I*r+X*o+t[14],i[15]=y*n+k*r+H*o+t[15]),i}function c8(i,t,e){var n=e[0],r=e[1],o=e[2];return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=t[7]*r,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=t[11]*o,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function J$(i,t,e){var n=Math.sin(e),r=Math.cos(e),o=t[4],s=t[5],l=t[6],c=t[7],y=t[8],_=t[9],C=t[10],I=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=o*r+y*n,i[5]=s*r+_*n,i[6]=l*r+C*n,i[7]=c*r+I*n,i[8]=y*r-o*n,i[9]=_*r-s*n,i[10]=C*r-l*n,i[11]=I*r-c*n,i}function $$(i,t,e){var n=Math.sin(e),r=Math.cos(e),o=t[0],s=t[1],l=t[2],c=t[3],y=t[4],_=t[5],C=t[6],I=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=o*r+y*n,i[1]=s*r+_*n,i[2]=l*r+C*n,i[3]=c*r+I*n,i[4]=y*r-o*n,i[5]=_*r-s*n,i[6]=C*r-l*n,i[7]=I*r-c*n,i}function ttt(i,t,e,n,r){var o=1/Math.tan(t/2);if(i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,r!=null&&r!==1/0){var s=1/(n-r);i[10]=(r+n)*s,i[14]=2*r*n*s}else i[10]=-1,i[14]=-2*n;return i}var ett=ttt;function DS(i,t){var e=i[0],n=i[1],r=i[2],o=i[3],s=i[4],l=i[5],c=i[6],y=i[7],_=i[8],C=i[9],I=i[10],k=i[11],z=i[12],V=i[13],X=i[14],H=i[15],$=t[0],Y=t[1],ct=t[2],rt=t[3],nt=t[4],Ot=t[5],Kt=t[6],ft=t[7],st=t[8],Ut=t[9],K=t[10],dt=t[11],Tt=t[12],ue=t[13],Rt=t[14],Ft=t[15];return Math.abs(e-$)<=po*Math.max(1,Math.abs(e),Math.abs($))&&Math.abs(n-Y)<=po*Math.max(1,Math.abs(n),Math.abs(Y))&&Math.abs(r-ct)<=po*Math.max(1,Math.abs(r),Math.abs(ct))&&Math.abs(o-rt)<=po*Math.max(1,Math.abs(o),Math.abs(rt))&&Math.abs(s-nt)<=po*Math.max(1,Math.abs(s),Math.abs(nt))&&Math.abs(l-Ot)<=po*Math.max(1,Math.abs(l),Math.abs(Ot))&&Math.abs(c-Kt)<=po*Math.max(1,Math.abs(c),Math.abs(Kt))&&Math.abs(y-ft)<=po*Math.max(1,Math.abs(y),Math.abs(ft))&&Math.abs(_-st)<=po*Math.max(1,Math.abs(_),Math.abs(st))&&Math.abs(C-Ut)<=po*Math.max(1,Math.abs(C),Math.abs(Ut))&&Math.abs(I-K)<=po*Math.max(1,Math.abs(I),Math.abs(K))&&Math.abs(k-dt)<=po*Math.max(1,Math.abs(k),Math.abs(dt))&&Math.abs(z-Tt)<=po*Math.max(1,Math.abs(z),Math.abs(Tt))&&Math.abs(V-ue)<=po*Math.max(1,Math.abs(V),Math.abs(ue))&&Math.abs(X-Rt)<=po*Math.max(1,Math.abs(X),Math.abs(Rt))&&Math.abs(H-Ft)<=po*Math.max(1,Math.abs(H),Math.abs(Ft))}function itt(){var i=new Ep(2);return Ep!=Float32Array&&(i[0]=0,i[1]=0),i}function Jb(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function ntt(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i}function rtt(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i}function stt(i){var t=i[0],e=i[1];return Math.sqrt(t*t+e*e)}function ott(i,t){return i[0]=-t[0],i[1]=-t[1],i}function h8(i,t,e,n){var r=t[0],o=t[1];return i[0]=r+n*(e[0]-r),i[1]=o+n*(e[1]-o),i}var att=ntt;(function(){var i=itt();return function(t,e,n,r,o,s){var l,c;for(e||(e=2),n||(n=0),r?c=Math.min(r*e+n,t.length):c=t.length,l=n;l<c;l+=e)i[0]=t[l],i[1]=t[l+1],o(i,i,s),t[l]=i[0],t[l+1]=i[1];return t}})();function ltt(){var i=new Ep(3);return Ep!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function utt(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function ctt(i,t,e){return i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i}function htt(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}var ftt=ctt;(function(){var i=ltt();return function(t,e,n,r,o,s){var l,c;for(e||(e=3),n||(n=0),r?c=Math.min(r*e+n,t.length):c=t.length,l=n;l<c;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],o(i,i,s),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2];return t}})();function Qc(i,t){if(!i)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const pl=Math.PI,f8=pl/4,su=pl/180,$b=180/pl,lm=512,kS=4003e4,M0=85.051129,d8=1.5;function t2(i){return Math.pow(2,i)}function dtt(i){return nw(i)}function Wc(i){const[t,e]=i;Qc(Number.isFinite(t)),Qc(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*su,r=e*su,o=lm*(n+pl)/(2*pl),s=lm*(pl+Math.log(Math.tan(f8+r*.5)))/(2*pl);return[o,s]}function Kc(i){const[t,e]=i,n=t/lm*(2*pl)-pl,r=2*(Math.atan(Math.exp(e/lm*(2*pl)-pl))-f8);return[n*$b,r*$b]}function ptt(i){const{latitude:t,longitude:e,highPrecision:n=!1}=i;Qc(Number.isFinite(t)&&Number.isFinite(e));const r=lm,o=Math.cos(t*su),s=r/360,l=s/o,c=r/kS/o,y={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[s,l,c],degreesPerUnit:[1/s,1/l,1/c]};if(n){const _=su*Math.tan(t*su)/o,C=s*_/2,I=r/kS*_,k=I/l*c;y.unitsPerDegree2=[0,C,I],y.unitsPerMeter2=[k,0,k]}return y}function Att(i){const{height:t,pitch:e,bearing:n,altitude:r,scale:o,center:s}=i,l=wg();Qb(l,l,[0,0,-r]),J$(l,l,-e*su),$$(l,l,n*su);const c=o/t;return c8(l,l,[c,c,c]),s&&Qb(l,l,htt([],s)),l}function mtt(i){const{width:t,height:e,altitude:n,pitch:r=0,offset:o,center:s,scale:l,nearZMultiplier:c=1,farZMultiplier:y=1}=i;let{fovy:_=oy(d8)}=i;n!==void 0&&(_=oy(n));const C=_*su,I=r*su,k=p8(_);let z=k;s&&(z+=s[2]*l/Math.cos(I)/e);const V=C*(.5+(o?o[1]:0)/e),X=Math.sin(V)*z/Math.sin(Yb(Math.PI/2-I-V,.01,Math.PI-.01)),H=Math.sin(I)*X+z,$=z*10,Y=Math.min(H*y,$);return{fov:C,aspect:t/e,focalDistance:k,near:c,far:Y}}function gtt(i){const{fov:t,aspect:e,near:n,far:r}=mtt(i);return ett([],t,e,n,r)}function oy(i){return 2*Math.atan(.5/i)*$b}function p8(i){return .5/Math.tan(.5*i*su)}function ytt(i,t){const[e,n,r=0]=i;return Qc(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(r)),lp(t,[e,n,r,1])}function OS(i,t,e=0){const[n,r,o]=i;if(Qc(Number.isFinite(n)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(o))return lp(t,[n,r,o,1]);const s=lp(t,[n,r,0,1]),l=lp(t,[n,r,1,1]),c=s[2],y=l[2],_=c===y?0:((e||0)-c)/(y-c);return h8([],s,l,_)}function vtt(i){const{width:t,height:e,bounds:n,minExtent:r=0,maxZoom:o=24,offset:s=[0,0]}=i,[[l,c],[y,_]]=n,C=_tt(i.padding),I=Wc([l,Yb(_,-M0,M0)]),k=Wc([y,Yb(c,-M0,M0)]),z=[Math.max(Math.abs(k[0]-I[0]),r),Math.max(Math.abs(k[1]-I[1]),r)],V=[t-C.left-C.right-Math.abs(s[0])*2,e-C.top-C.bottom-Math.abs(s[1])*2];Qc(V[0]>0&&V[1]>0);const X=V[0]/z[0],H=V[1]/z[1],$=(C.right-C.left)/2/X,Y=(C.top-C.bottom)/2/H,ct=[(k[0]+I[0])/2+$,(k[1]+I[1])/2+Y],rt=Kc(ct),nt=Math.min(o,nw(Math.abs(Math.min(X,H))));return Qc(Number.isFinite(nt)),{longitude:rt[0],latitude:rt[1],zoom:nt}}function _tt(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(Qc(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const FS=Math.PI/180;function btt(i,t=0){const{width:e,height:n,unproject:r}=i,o={targetZ:t},s=r([0,n],o),l=r([e,n],o);let c,y;const _=i.fovy?.5*i.fovy*FS:Math.atan(.5/i.altitude),C=(90-i.pitch)*FS;return _>C-.01?(c=NS(i,0,t),y=NS(i,e,t)):(c=r([0,0],o),y=r([e,0],o)),[s,l,y,c]}function NS(i,t,e){const{pixelUnprojectionMatrix:n}=i,r=lp(n,[t,0,1,1]),o=lp(n,[t,i.height,1,1]),s=(e*i.distanceScales.unitsPerMeter[2]-r[2])/(o[2]-r[2]),l=h8([],r,o,s),c=Kc(l);return c.push(e),c}class ou{constructor(t={width:1,height:1}){Bi(this,"latitude",void 0),Bi(this,"longitude",void 0),Bi(this,"zoom",void 0),Bi(this,"pitch",void 0),Bi(this,"bearing",void 0),Bi(this,"altitude",void 0),Bi(this,"fovy",void 0),Bi(this,"meterOffset",void 0),Bi(this,"center",void 0),Bi(this,"width",void 0),Bi(this,"height",void 0),Bi(this,"scale",void 0),Bi(this,"distanceScales",void 0),Bi(this,"viewMatrix",void 0),Bi(this,"projectionMatrix",void 0),Bi(this,"viewProjectionMatrix",void 0),Bi(this,"pixelProjectionMatrix",void 0),Bi(this,"pixelUnprojectionMatrix",void 0),Bi(this,"equals",H=>H instanceof ou?H.width===this.width&&H.height===this.height&&DS(H.projectionMatrix,this.projectionMatrix)&&DS(H.viewMatrix,this.viewMatrix):!1),Bi(this,"project",(H,$={})=>{const{topLeft:Y=!0}=$,ct=this.projectPosition(H),rt=ytt(ct,this.pixelProjectionMatrix),[nt,Ot]=rt,Kt=Y?Ot:this.height-Ot;return H.length===2?[nt,Kt]:[nt,Kt,rt[2]]}),Bi(this,"unproject",(H,$={})=>{const{topLeft:Y=!0,targetZ:ct=void 0}=$,[rt,nt,Ot]=H,Kt=Y?nt:this.height-nt,ft=ct&&ct*this.distanceScales.unitsPerMeter[2],st=OS([rt,Kt,Ot],this.pixelUnprojectionMatrix,ft),[Ut,K,dt]=this.unprojectPosition(st);return Number.isFinite(Ot)?[Ut,K,dt]:Number.isFinite(ct)?[Ut,K,ct]:[Ut,K]}),Bi(this,"projectPosition",H=>{const[$,Y]=Wc(H),ct=(H[2]||0)*this.distanceScales.unitsPerMeter[2];return[$,Y,ct]}),Bi(this,"unprojectPosition",H=>{const[$,Y]=Kc(H),ct=(H[2]||0)*this.distanceScales.metersPerUnit[2];return[$,Y,ct]});let{width:e,height:n,altitude:r=null,fovy:o=null}=t;const{latitude:s=0,longitude:l=0,zoom:c=0,pitch:y=0,bearing:_=0,position:C=null,nearZMultiplier:I=.02,farZMultiplier:k=1.01}=t;e=e||1,n=n||1,o===null&&r===null?(r=d8,o=oy(r)):o===null?o=oy(r):r===null&&(r=p8(o));const z=t2(c);r=Math.max(.75,r);const V=ptt({longitude:l,latitude:s}),X=Wc([l,s]);X.push(0),C&&utt(X,X,ftt([],C,V.unitsPerMeter)),this.projectionMatrix=gtt({width:e,height:n,scale:z,center:X,pitch:y,fovy:o,nearZMultiplier:I,farZMultiplier:k}),this.viewMatrix=Att({height:n,scale:z,center:X,pitch:y,bearing:_,altitude:r}),this.width=e,this.height=n,this.scale=z,this.latitude=s,this.longitude=l,this.zoom=c,this.pitch=y,this.bearing=_,this.altitude=r,this.fovy=o,this.center=X,this.meterOffset=C||[0,0,0],this.distanceScales=V,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:t,height:e,projectionMatrix:n,viewMatrix:r}=this,o=wg();Q_(o,o,n),Q_(o,o,r),this.viewProjectionMatrix=o;const s=wg();c8(s,s,[t/2,-e/2,1]),Qb(s,s,[1,-1,0]),Q_(s,s,o);const l=Q$(wg(),s);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=l}projectFlat(t){return Wc(t)}unprojectFlat(t){return Kc(t)}getMapCenterByLngLatPosition({lngLat:t,pos:e}){const n=OS(e,this.pixelUnprojectionMatrix),r=Wc(t),o=Jb([],r,ott([],n)),s=Jb([],this.center,o);return Kc(s)}fitBounds(t,e={}){const{width:n,height:r}=this,{longitude:o,latitude:s,zoom:l}=vtt(Object.assign({width:n,height:r,bounds:t},e));return new ou({width:n,height:r,longitude:o,latitude:s,zoom:l})}getBounds(t){const e=this.getBoundingRegion(t),n=Math.min(...e.map(l=>l[0])),r=Math.max(...e.map(l=>l[0])),o=Math.min(...e.map(l=>l[1])),s=Math.max(...e.map(l=>l[1]));return[[n,o],[r,s]]}getBoundingRegion(t={}){return btt(this,t.z||0)}getLocationAtPoint({lngLat:t,pos:e}){return this.getMapCenterByLngLatPosition({lngLat:t,pos:e})}}const zS=512;function xtt(i){const{width:t,height:e,pitch:n=0}=i;let{longitude:r,latitude:o,zoom:s,bearing:l=0}=i;(r<-180||r>180)&&(r=LS(r+180,360)-180),(l<-180||l>180)&&(l=LS(l+180,360)-180);const c=nw(e/zS);if(s<=c)s=c,o=0;else{const y=e/2/Math.pow(2,s),_=Kc([0,y])[1];if(o<_)o=_;else{const C=Kc([0,zS-y])[1];o>C&&(o=C)}}return{width:t,height:e,longitude:r,latitude:o,zoom:s,pitch:n,bearing:l}}const A8=.01,wtt=["longitude","latitude","zoom"],m8={curve:1.414,speed:1.2};function Ett(i,t,e,n){const{startZoom:r,startCenterXY:o,uDelta:s,w0:l,u1:c,S:y,rho:_,rho2:C,r0:I}=g8(i,t,n);if(c<A8){const ct={};for(const rt of wtt){const nt=i[rt],Ot=t[rt];ct[rt]=Z$(nt,Ot,e)}return ct}const k=e*y,z=Math.cosh(I)/Math.cosh(I+_*k),V=l*((Math.cosh(I)*Math.tanh(I+_*k)-Math.sinh(I))/C)/c,X=1/z,H=r+dtt(X),$=rtt([],s,V);Jb($,$,o);const Y=Kc($);return{longitude:Y[0],latitude:Y[1],zoom:H}}function Ctt(i,t,e){const n={...m8,...e},{screenSpeed:r,speed:o,maxDuration:s}=n,{S:l,rho:c}=g8(i,t,n),y=1e3*l;let _;return Number.isFinite(r)?_=y/(r/c):_=y/o,Number.isFinite(s)&&_>s?0:_}function g8(i,t,e){e=Object.assign({},m8,e);const n=e.curve,r=i.zoom,o=[i.longitude,i.latitude],s=t2(r),l=t.zoom,c=[t.longitude,t.latitude],y=t2(l-r),_=Wc(o),C=Wc(c),I=att([],C,_),k=Math.max(i.width,i.height),z=k/y,V=stt(I)*s,X=Math.max(V,A8),H=n*n,$=(z*z-k*k+H*H*X*X)/(2*k*H*X),Y=(z*z-k*k-H*H*X*X)/(2*z*H*X),ct=Math.log(Math.sqrt($*$+1)-$),rt=Math.log(Math.sqrt(Y*Y+1)-Y),nt=(rt-ct)/n;return{startZoom:r,startCenterXY:_,uDelta:I,w0:k,u1:V,S:nt,rho:n,rho2:H,r0:ct,r1:rt}}var Hu=typeof document<"u"?document:{};function US(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function B0(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?US(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):US(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}function VS(i,t){var e;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(e=Ttt(i))||t){e&&(i=e);var n=0,r=function(){};return{s:r,n:function(){return n>=i.length?{done:!0}:{done:!1,value:i[n++]}},e:function(c){throw c},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){e=i[Symbol.iterator]()},n:function(){var c=e.next();return o=c.done,c},e:function(c){s=!0,l=c},f:function(){try{!o&&e.return!=null&&e.return()}finally{if(s)throw l}}}}function Ttt(i,t){if(i){if(typeof i=="string")return GS(i,t);var e=Object.prototype.toString.call(i).slice(8,-1);if(e==="Object"&&i.constructor&&(e=i.constructor.name),e==="Map"||e==="Set")return Array.from(i);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return GS(i,t)}}function GS(i,t){(t==null||t>i.length)&&(t=i.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=i[e];return n}var Stt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function J_(i){if(!i)return null;if(typeof i=="string")return i;i.toJS&&(i=i.toJS());var t={},e=VS(i.layers),n;try{for(e.s();!(n=e.n()).done;){var r=n.value;t[r.id]=r}}catch(s){e.e(s)}finally{e.f()}var o=i.layers.map(function(s){var l=t[s.ref],c=null;if("interactive"in s&&(c=B0({},s),delete c.interactive),l){c=c||B0({},s),delete c.ref;var y=VS(Stt),_;try{for(y.s();!(_=y.n()).done;){var C=_.value;C in l&&(c[C]=l[C])}}catch(I){y.e(I)}finally{y.f()}}return c||s});return B0(B0({},i),{},{layers:o})}function Ptt(){}function Itt(i){i&&console.error(i.error)}var y8={container:_e.object,gl:_e.object,mapboxApiAccessToken:_e.string,mapboxApiUrl:_e.string,attributionControl:_e.bool,preserveDrawingBuffer:_e.bool,reuseMaps:_e.bool,transformRequest:_e.func,mapOptions:_e.object,mapStyle:_e.oneOfType([_e.string,_e.object]),preventStyleDiffing:_e.bool,visible:_e.bool,asyncRender:_e.bool,onLoad:_e.func,onError:_e.func,width:_e.number,height:_e.number,viewState:_e.object,longitude:_e.number,latitude:_e.number,zoom:_e.number,bearing:_e.number,pitch:_e.number,altitude:_e.number},Eg={container:Hu.body,mapboxApiAccessToken:Mtt(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:Ptt,onError:Itt,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function Mtt(){var i=null;if(typeof window<"u"&&window.location){var t=window.location.search.match(/access_token=([^&\/]*)/);i=t&&t[1]}return!i&&typeof process<"u"&&(i=i||rC.MapboxAccessToken||rC.REACT_APP_MAPBOX_ACCESS_TOKEN),i||"no-token"}function jS(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";i.debug&&_e.checkPropTypes(y8,i,"prop",t)}var gf=(function(){function i(t){var e=this;if(th(this,i),Bi(this,"props",Eg),Bi(this,"width",0),Bi(this,"height",0),Bi(this,"_fireLoadEvent",function(){e.props.onLoad({type:"load",target:e._map})}),Bi(this,"_handleError",function(n){e.props.onError(n)}),!t.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=t.mapboxgl,i.initialized||(i.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(t)}return $c(i,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(t){this._map=i.savedMap;var e=this._map.getContainer(),n=t.container;for(n.classList.add("mapboxgl-map");e.childNodes.length>0;)n.appendChild(e.childNodes[0]);this._map._container=n,i.savedMap=null,t.mapStyle&&this._map.setStyle(J_(t.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(t){if(t.reuseMaps&&i.savedMap)this._reuse(t);else{if(t.gl){var e=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=e,t.gl}}var n={container:t.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:J_(t.mapStyle),interactive:!1,trackResize:!1,attributionControl:t.attributionControl,preserveDrawingBuffer:t.preserveDrawingBuffer};t.transformRequest&&(n.transformRequest=t.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},n,t.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!i.savedMap?(i.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(t){var e=this;t=Object.assign({},Eg,t),jS(t,"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||Eg.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var n=t,r=n.container;Object.defineProperty(r,"offsetWidth",{configurable:!0,get:function(){return e.width}}),Object.defineProperty(r,"clientWidth",{configurable:!0,get:function(){return e.width}}),Object.defineProperty(r,"offsetHeight",{configurable:!0,get:function(){return e.height}}),Object.defineProperty(r,"clientHeight",{configurable:!0,get:function(){return e.height}});var o=this._map.getCanvas();o&&(o.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,e){if(this._map){e=Object.assign({},this.props,e),jS(e,"Mapbox");var n=this._updateMapViewport(t,e),r=this._updateMapSize(t,e);this._updateMapStyle(t,e),!e.asyncRender&&(n||r)&&this.redraw(),this.props=e}}},{key:"_updateMapStyle",value:function(t,e){var n=t.mapStyle!==e.mapStyle;n&&this._map.setStyle(J_(e.mapStyle),{diff:!e.preventStyleDiffing})}},{key:"_updateMapSize",value:function(t,e){var n=t.width!==e.width||t.height!==e.height;return n&&(this.width=e.width,this.height=e.height,this._map.resize()),n}},{key:"_updateMapViewport",value:function(t,e){var n=this._getViewState(t),r=this._getViewState(e),o=r.latitude!==n.latitude||r.longitude!==n.longitude||r.zoom!==n.zoom||r.pitch!==n.pitch||r.bearing!==n.bearing||r.altitude!==n.altitude;return o&&(this._map.jumpTo(this._viewStateToMapboxProps(r)),r.altitude!==n.altitude&&(this._map.transform.altitude=r.altitude)),o}},{key:"_getViewState",value:function(t){var e=t.viewState||t,n=e.longitude,r=e.latitude,o=e.zoom,s=e.pitch,l=s===void 0?0:s,c=e.bearing,y=c===void 0?0:c,_=e.altitude,C=_===void 0?1.5:_;return{longitude:n,latitude:r,zoom:o,pitch:l,bearing:y,altitude:C}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Hu>"u"))try{var e=Hu.createElement("div");e.className="mapboxgl-map",e.style.display="none",Hu.body.appendChild(e);var n=window.getComputedStyle(e).position!=="static";if(!n){var r=Hu.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),Hu.head.appendChild(r)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),i})();Bi(gf,"initialized",!1);Bi(gf,"propTypes",y8);Bi(gf,"defaultProps",Eg);Bi(gf,"savedMap",null);var e2={exports:{}},Btt=e2.exports,WS;function Rtt(){return WS||(WS=1,(function(i,t){(function(e,n){i.exports=n()})(Btt,function(){var e,n,r;function o(s,l){if(!e)e=l;else if(!n)n=l;else{var c="var sharedChunk = {}; ("+e+")(sharedChunk); ("+n+")(sharedChunk);",y={};e(y),r=l(y),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([c],{type:"text/javascript"})))}}return o(["exports"],function(s){function l(a,u){return a(u={exports:{}},u.exports),u.exports}var c=y;function y(a,u,p,x){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(x-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=x,this.p2x=p,this.p2y=x}y.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},y.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},y.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},y.prototype.solveCurveX=function(a,u){var p,x,T,M,L;for(u===void 0&&(u=1e-6),T=a,L=0;L<8;L++){if(M=this.sampleCurveX(T)-a,Math.abs(M)<u)return T;var N=this.sampleCurveDerivativeX(T);if(Math.abs(N)<1e-6)break;T-=M/N}if((T=a)<(p=0))return p;if(T>(x=1))return x;for(;p<x;){if(M=this.sampleCurveX(T),Math.abs(M-a)<u)return T;a>M?p=T:x=T,T=.5*(x-p)+p}return T},y.prototype.solve=function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))};var _=C;function C(a,u){this.x=a,this.y=u}C.prototype={clone:function(){return new C(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,u){return this.clone()._rotateAround(a,u)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var u=a.x-this.x,p=a.y-this.y;return u*u+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,u){return Math.atan2(this.x*u-this.y*a,this.x*a+this.y*u)},_matMult:function(a){var u=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=u,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var u=Math.cos(a),p=Math.sin(a),x=p*this.x+u*this.y;return this.x=u*this.x-p*this.y,this.y=x,this},_rotateAround:function(a,u){var p=Math.cos(a),x=Math.sin(a),T=u.y+x*(this.x-u.x)+p*(this.y-u.y);return this.x=u.x+p*(this.x-u.x)-x*(this.y-u.y),this.y=T,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},C.convert=function(a){return a instanceof C?a:Array.isArray(a)?new C(a[0],a[1]):a};var I=typeof self<"u"?self:{},k=Math.pow(2,53)-1;function z(a,u,p,x){var T=new c(a,u,p,x);return function(M){return T.solve(M)}}var V=z(.25,.1,.25,1);function X(a,u,p){return Math.min(p,Math.max(u,a))}function H(a,u,p){var x=p-u,T=((a-u)%x+x)%x+u;return T===u?p:T}function $(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];for(var x=0,T=u;x<T.length;x+=1){var M=T[x];for(var L in M)a[L]=M[L]}return a}var Y=1;function ct(){return Y++}function rt(){return(function a(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()}function nt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Ot(a,u){a.forEach(function(p){u[p]&&(u[p]=u[p].bind(u))})}function Kt(a,u){return a.indexOf(u,a.length-u.length)!==-1}function ft(a,u,p){var x={};for(var T in a)x[T]=u.call(p||this,a[T],T,a);return x}function st(a,u,p){var x={};for(var T in a)u.call(p||this,a[T],T,a)&&(x[T]=a[T]);return x}function Ut(a){return Array.isArray(a)?a.map(Ut):typeof a=="object"&&a?ft(a,Ut):a}var K={};function dt(a){K[a]||(typeof console<"u"&&console.warn(a),K[a]=!0)}function Tt(a,u,p){return(p.y-a.y)*(u.x-a.x)>(u.y-a.y)*(p.x-a.x)}function ue(a){for(var u=0,p=0,x=a.length,T=x-1,M=void 0,L=void 0;p<x;T=p++)u+=((L=a[T]).x-(M=a[p]).x)*(M.y+L.y);return u}function Rt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ft(a){var u={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(x,T,M,L){var N=M||L;return u[T]=!N||N.toLowerCase(),""}),u["max-age"]){var p=parseInt(u["max-age"],10);isNaN(p)?delete u["max-age"]:u["max-age"]=p}return u}var Gt=null;function se(a){if(Gt==null){var u=a.navigator?a.navigator.userAgent:null;Gt=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Gt}function le(a){try{var u=I[a];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch{return!1}}var de,ye,Oe,Le,fe=I.performance&&I.performance.now?I.performance.now.bind(I.performance):Date.now.bind(Date),_i=I.requestAnimationFrame||I.mozRequestAnimationFrame||I.webkitRequestAnimationFrame||I.msRequestAnimationFrame,ei=I.cancelAnimationFrame||I.mozCancelAnimationFrame||I.webkitCancelAnimationFrame||I.msCancelAnimationFrame,ii={now:fe,frame:function(a){var u=_i(a);return{cancel:function(){return ei(u)}}},getImageData:function(a,u){u===void 0&&(u=0);var p=I.document.createElement("canvas"),x=p.getContext("2d");if(!x)throw new Error("failed to create canvas 2d context");return p.width=a.width,p.height=a.height,x.drawImage(a,0,0,a.width,a.height),x.getImageData(-u,-u,a.width+2*u,a.height+2*u)},resolveURL:function(a){return de||(de=I.document.createElement("a")),de.href=a,de.href},hardwareConcurrency:I.navigator&&I.navigator.hardwareConcurrency||4,get devicePixelRatio(){return I.devicePixelRatio},get prefersReducedMotion(){return!!I.matchMedia&&(ye==null&&(ye=I.matchMedia("(prefers-reduced-motion: reduce)")),ye.matches)}},Qe={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},yi={supported:!1,testSupport:function(a){!cn&&Le&&(Ni?Pi(a):Oe=a)}},cn=!1,Ni=!1;function Pi(a){var u=a.createTexture();a.bindTexture(a.TEXTURE_2D,u);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Le),a.isContextLost())return;yi.supported=!0}catch{}a.deleteTexture(u),cn=!0}I.document&&((Le=I.document.createElement("img")).onload=function(){Oe&&Pi(Oe),Oe=null,Ni=!0},Le.onerror=function(){cn=!0,Oe=null},Le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Xn="01",xi=function(a,u){this._transformRequestFn=a,this._customAccessToken=u,this._createSkuToken()};function wi(a){return a.indexOf("mapbox:")===0}xi.prototype._createSkuToken=function(){var a=(function(){for(var u="",p=0;p<10;p++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Xn,u].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},xi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},xi.prototype.transformRequest=function(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}},xi.prototype.normalizeStyleURL=function(a,u){if(!wi(a))return a;var p=tr(a);return p.path="/styles/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||u)},xi.prototype.normalizeGlyphsURL=function(a,u){if(!wi(a))return a;var p=tr(a);return p.path="/fonts/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||u)},xi.prototype.normalizeSourceURL=function(a,u){if(!wi(a))return a;var p=tr(a);return p.path="/v4/"+p.authority+".json",p.params.push("secure"),this._makeAPIURL(p,this._customAccessToken||u)},xi.prototype.normalizeSpriteURL=function(a,u,p,x){var T=tr(a);return wi(a)?(T.path="/styles/v1"+T.path+"/sprite"+u+p,this._makeAPIURL(T,this._customAccessToken||x)):(T.path+=""+u+p,xn(T))},xi.prototype.normalizeTileURL=function(a,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!wi(a))return a;var p=tr(a);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,(ii.devicePixelRatio>=2||u===512?"@2x":"")+(yi.supported?".webp":"$1")),p.path=p.path.replace(/^.+\/v4\//,"/"),p.path="/v4"+p.path;var x=this._customAccessToken||(function(T){for(var M=0,L=T;M<L.length;M+=1){var N=L[M].match(/^access_token=(.*)$/);if(N)return N[1]}return null})(p.params)||Qe.ACCESS_TOKEN;return Qe.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&p.params.push("sku="+this._skuToken),this._makeAPIURL(p,x)},xi.prototype.canonicalizeTileURL=function(a,u){var p=tr(a);if(!p.path.match(/(^\/v4\/)/)||!p.path.match(/\.[\w]+$/))return a;var x="mapbox://tiles/";x+=p.path.replace("/v4/","");var T=p.params;return u&&(T=T.filter(function(M){return!M.match(/^access_token=/)})),T.length&&(x+="?"+T.join("&")),x},xi.prototype.canonicalizeTileset=function(a,u){for(var p=!!u&&wi(u),x=[],T=0,M=a.tiles||[];T<M.length;T+=1){var L=M[T];zi(L)?x.push(this.canonicalizeTileURL(L,p)):x.push(L)}return x},xi.prototype._makeAPIURL=function(a,u){var p="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",x=tr(Qe.API_URL);if(a.protocol=x.protocol,a.authority=x.authority,a.protocol==="http"){var T=a.params.indexOf("secure");T>=0&&a.params.splice(T,1)}if(x.path!=="/"&&(a.path=""+x.path+a.path),!Qe.REQUIRE_ACCESS_TOKEN)return xn(a);if(!(u=u||Qe.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+p);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+p);return a.params=a.params.filter(function(M){return M.indexOf("access_token")===-1}),a.params.push("access_token="+u),xn(a)};var mn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function zi(a){return mn.test(a)}var cr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function tr(a){var u=a.match(cr);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function xn(a){var u=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+u}function sr(a){if(!a)return null;var u=a.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(I.atob(u[1]).split("").map(function(p){return"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var qn=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};qn.prototype.getStorageKey=function(a){var u,p=sr(Qe.ACCESS_TOKEN);return u=p&&p.u?I.btoa(encodeURIComponent(p.u).replace(/%([0-9A-F]{2})/g,function(x,T){return String.fromCharCode(+("0x"+T))})):Qe.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+u:"mapbox.eventData:"+u},qn.prototype.fetchEventData=function(){var a=le("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{var x=I.localStorage.getItem(u);x&&(this.eventData=JSON.parse(x));var T=I.localStorage.getItem(p);T&&(this.anonId=T)}catch{dt("Unable to read from LocalStorage")}},qn.prototype.saveEventData=function(){var a=le("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{I.localStorage.setItem(p,this.anonId),Object.keys(this.eventData).length>=1&&I.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{dt("Unable to write to LocalStorage")}},qn.prototype.processRequests=function(a){},qn.prototype.postEvent=function(a,u,p,x){var T=this;if(Qe.EVENTS_URL){var M=tr(Qe.EVENTS_URL);M.params.push("access_token="+(x||Qe.ACCESS_TOKEN||""));var L={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Xn,userId:this.anonId},N=u?$(L,u):L,j={url:xn(M),headers:{"Content-Type":"text/plain"},body:JSON.stringify([N])};this.pendingRequest=Ae(j,function(Z){T.pendingRequest=null,p(Z),T.saveEventData(),T.processRequests(x)})}},qn.prototype.queueRequest=function(a,u){this.queue.push(a),this.processRequests(u)};var Bn,er,Ke=(function(a){function u(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(p,x,T,M){this.skuToken=T;var L=!(!M&&!Qe.ACCESS_TOKEN),N=Array.isArray(p)&&p.some(function(j){return wi(j)||zi(j)});Qe.EVENTS_URL&&L&&N&&this.queueRequest({id:x,timestamp:Date.now()},M)},u.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){var T=this.queue.shift(),M=T.id,L=T.timestamp;M&&this.success[M]||(this.anonId||this.fetchEventData(),nt(this.anonId)||(this.anonId=rt()),this.postEvent(L,{skuToken:this.skuToken},function(N){N||M&&(x.success[M]=!0)},p))}},u})(qn),bi=new((function(a){function u(p){a.call(this,"appUserTurnstile"),this._customAccessToken=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(p,x){Qe.EVENTS_URL&&Qe.ACCESS_TOKEN&&Array.isArray(p)&&p.some(function(T){return wi(T)||zi(T)})&&this.queueRequest(Date.now(),x)},u.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var T=sr(Qe.ACCESS_TOKEN),M=T?T.u:Qe.ACCESS_TOKEN,L=M!==this.eventData.tokenU;nt(this.anonId)||(this.anonId=rt(),L=!0);var N=this.queue.shift();if(this.eventData.lastSuccess){var j=new Date(this.eventData.lastSuccess),Z=new Date(N),et=(N-this.eventData.lastSuccess)/864e5;L=L||et>=1||et<-1||j.getDate()!==Z.getDate()}else L=!0;if(!L)return this.processRequests();this.postEvent(N,{"enabled.telemetry":!1},function(ot){ot||(x.eventData.lastSuccess=N,x.eventData.tokenU=M)},p)}},u})(qn)),Oi=bi.postTurnstileEvent.bind(bi),on=new Ke,Ar=on.postMapLoadEvent.bind(on),Lt=500,je=50;function $e(){I.caches&&!Bn&&(Bn=I.caches.open("mapbox-tiles"))}function di(a){var u=a.indexOf("?");return u<0?a:a.slice(0,u)}var oe,Fe=1/0;function vt(){return oe==null&&(oe=I.OffscreenCanvas&&new I.OffscreenCanvas(1,1).getContext("2d")&&typeof I.createImageBitmap=="function"),oe}var qe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(qe);var Ce=(function(a){function u(p,x,T){x===401&&zi(T)&&(p+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,p),this.status=x,this.url=T,this.name=this.constructor.name,this.message=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u})(Error),q=Rt()?function(){return self.worker&&self.worker.referrer}:function(){return(I.location.protocol==="blob:"?I.parent:I).location.href},Ee,Me,St=function(a,u){if(!(/^file:/.test(p=a.url)||/^file:/.test(q())&&!/^\w+:/.test(p))){if(I.fetch&&I.Request&&I.AbortController&&I.Request.prototype.hasOwnProperty("signal"))return(function(x,T){var M,L=new I.AbortController,N=new I.Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:q(),signal:L.signal}),j=!1,Z=!1,et=(M=N.url).indexOf("sku=")>0&&zi(M);x.type==="json"&&N.headers.set("Accept","application/json");var ot=function(bt,Vt,jt){if(!Z){if(bt&&bt.message!=="SecurityError"&&dt(bt),Vt&&jt)return At(Vt);var Qt=Date.now();I.fetch(N).then(function(Zt){if(Zt.ok){var re=et?Zt.clone():null;return At(Zt,re,Qt)}return T(new Ce(Zt.statusText,Zt.status,x.url))}).catch(function(Zt){Zt.code!==20&&T(new Error(Zt.message))})}},At=function(bt,Vt,jt){(x.type==="arrayBuffer"?bt.arrayBuffer():x.type==="json"?bt.json():bt.text()).then(function(Qt){Z||(Vt&&jt&&(function(Zt,re,pe){if($e(),Bn){var be={status:re.status,statusText:re.statusText,headers:new I.Headers};re.headers.forEach(function(Ne,Je){return be.headers.set(Je,Ne)});var we=Ft(re.headers.get("Cache-Control")||"");we["no-store"]||(we["max-age"]&&be.headers.set("Expires",new Date(pe+1e3*we["max-age"]).toUTCString()),new Date(be.headers.get("Expires")).getTime()-pe<42e4||(function(Ne,Je){if(er===void 0)try{new Response(new ReadableStream),er=!0}catch{er=!1}er?Je(Ne.body):Ne.blob().then(Je)})(re,function(Ne){var Je=new I.Response(Ne,be);$e(),Bn&&Bn.then(function(ri){return ri.put(di(Zt.url),Je)}).catch(function(ri){return dt(ri.message)})}))}})(N,Vt,jt),j=!0,T(null,Qt,bt.headers.get("Cache-Control"),bt.headers.get("Expires")))}).catch(function(Qt){Z||T(new Error(Qt.message))})};return et?(function(bt,Vt){if($e(),!Bn)return Vt(null);var jt=di(bt.url);Bn.then(function(Qt){Qt.match(jt).then(function(Zt){var re=(function(pe){if(!pe)return!1;var be=new Date(pe.headers.get("Expires")||0),we=Ft(pe.headers.get("Cache-Control")||"");return be>Date.now()&&!we["no-cache"]})(Zt);Qt.delete(jt),re&&Qt.put(jt,Zt.clone()),Vt(null,Zt,re)}).catch(Vt)}).catch(Vt)})(N,ot):ot(null,null),{cancel:function(){Z=!0,j||L.abort()}}})(a,u);if(Rt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,u,void 0,!0)}var p;return(function(x,T){var M=new I.XMLHttpRequest;for(var L in M.open(x.method||"GET",x.url,!0),x.type==="arrayBuffer"&&(M.responseType="arraybuffer"),x.headers)M.setRequestHeader(L,x.headers[L]);return x.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=x.credentials==="include",M.onerror=function(){T(new Error(M.statusText))},M.onload=function(){if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){var N=M.response;if(x.type==="json")try{N=JSON.parse(M.response)}catch(j){return T(j)}T(null,N,M.getResponseHeader("Cache-Control"),M.getResponseHeader("Expires"))}else T(new Ce(M.statusText,M.status,x.url))},M.send(x.body),{cancel:function(){return M.abort()}}})(a,u)},ee=function(a,u){return St($(a,{type:"arrayBuffer"}),u)},Ae=function(a,u){return St($(a,{method:"POST"}),u)},Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ee=[],Me=0;var it=function(a,u){if(yi.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Me>=Qe.MAX_PARALLEL_IMAGE_REQUESTS){var p={requestParameters:a,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ee.push(p),p}Me++;var x=!1,T=function(){if(!x)for(x=!0,Me--;Ee.length&&Me<Qe.MAX_PARALLEL_IMAGE_REQUESTS;){var L=Ee.shift();L.cancelled||(L.cancel=it(L.requestParameters,L.callback).cancel)}},M=ee(a,function(L,N,j,Z){T(),L?u(L):N&&(vt()?(function(et,ot){var At=new I.Blob([new Uint8Array(et)],{type:"image/png"});I.createImageBitmap(At).then(function(bt){ot(null,bt)}).catch(function(bt){ot(new Error("Could not load image because of "+bt.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})})(N,u):(function(et,ot,At,bt){var Vt=new I.Image,jt=I.URL;Vt.onload=function(){ot(null,Vt),jt.revokeObjectURL(Vt.src),Vt.onload=null,I.requestAnimationFrame(function(){Vt.src=Q})},Vt.onerror=function(){return ot(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Qt=new I.Blob([new Uint8Array(et)],{type:"image/png"});Vt.cacheControl=At,Vt.expires=bt,Vt.src=et.byteLength?jt.createObjectURL(Qt):Q})(N,u,j,Z))});return{cancel:function(){M.cancel(),T()}}};function ut(a,u,p){p[a]&&p[a].indexOf(u)!==-1||(p[a]=p[a]||[],p[a].push(u))}function xt(a,u,p){if(p&&p[a]){var x=p[a].indexOf(u);x!==-1&&p[a].splice(x,1)}}var Nt=function(a,u){u===void 0&&(u={}),$(this,u),this.type=a},mt=(function(a){function u(p,x){x===void 0&&(x={}),a.call(this,"error",$({error:p},x))}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(Nt),wt=function(){};wt.prototype.on=function(a,u){return this._listeners=this._listeners||{},ut(a,u,this._listeners),this},wt.prototype.off=function(a,u){return xt(a,u,this._listeners),xt(a,u,this._oneTimeListeners),this},wt.prototype.once=function(a,u){return this._oneTimeListeners=this._oneTimeListeners||{},ut(a,u,this._oneTimeListeners),this},wt.prototype.fire=function(a,u){typeof a=="string"&&(a=new Nt(a,u||{}));var p=a.type;if(this.listens(p)){a.target=this;for(var x=0,T=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];x<T.length;x+=1)T[x].call(this,a);for(var M=0,L=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];M<L.length;M+=1){var N=L[M];xt(p,N,this._oneTimeListeners),N.call(this,a)}var j=this._eventedParent;j&&($(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),j.fire(a))}else a instanceof mt&&console.error(a.error);return this},wt.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},wt.prototype.setEventedParent=function(a,u){return this._eventedParent=a,this._eventedParentData=u,this};var lt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},pt=function(a,u,p,x){this.message=(a?a+": ":"")+p,x&&(this.identifier=x),u!=null&&u.__line__&&(this.line=u.__line__)};function d(a){var u=a.value;return u?[new pt(a.key,u,"constants have been deprecated as of v8")]:[]}function tt(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];for(var x=0,T=u;x<T.length;x+=1){var M=T[x];for(var L in M)a[L]=M[L]}return a}function Pe(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function ne(a){if(Array.isArray(a))return a.map(ne);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var u={};for(var p in a)u[p]=ne(a[p]);return u}return Pe(a)}var Ie=(function(a){function u(p,x){a.call(this,x),this.message=x,this.key=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(Error),ke=function(a,u){u===void 0&&(u=[]),this.parent=a,this.bindings={};for(var p=0,x=u;p<x.length;p+=1){var T=x[p];this.bindings[T[0]]=T[1]}};ke.prototype.concat=function(a){return new ke(this,a)},ke.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},ke.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Ue={kind:"null"},ge={kind:"number"},Ve={kind:"string"},De={kind:"boolean"},Ze={kind:"color"},Gi={kind:"object"},si={kind:"value"},rn={kind:"collator"},hn={kind:"formatted"},Yi={kind:"resolvedImage"};function Ji(a,u){return{kind:"array",itemType:a,N:u}}function Hi(a){if(a.kind==="array"){var u=Hi(a.itemType);return typeof a.N=="number"?"array<"+u+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+u+">"}return a.kind}var mr=[Ue,ge,Ve,De,Ze,hn,Gi,Ji(si),Yi];function Qi(a,u){if(u.kind==="error")return null;if(a.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Qi(a.itemType,u.itemType))&&(typeof a.N!="number"||a.N===u.N))return null}else{if(a.kind===u.kind)return null;if(a.kind==="value"){for(var p=0,x=mr;p<x.length;p+=1)if(!Qi(x[p],u))return null}}return"Expected "+Hi(a)+" but found "+Hi(u)+" instead."}function mi(a,u){return u.some(function(p){return p.kind===a.kind})}function _t(a,u){return u.some(function(p){return p==="null"?a===null:p==="array"?Array.isArray(a):p==="object"?a&&!Array.isArray(a)&&typeof a=="object":p===typeof a})}var ti=l(function(a,u){var p={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function x(N){return(N=Math.round(N))<0?0:N>255?255:N}function T(N){return x(N[N.length-1]==="%"?parseFloat(N)/100*255:parseInt(N))}function M(N){return(j=N[N.length-1]==="%"?parseFloat(N)/100:parseFloat(N))<0?0:j>1?1:j;var j}function L(N,j,Z){return Z<0?Z+=1:Z>1&&(Z-=1),6*Z<1?N+(j-N)*Z*6:2*Z<1?j:3*Z<2?N+(j-N)*(2/3-Z)*6:N}try{u.parseCSSColor=function(N){var j,Z=N.replace(/ /g,"").toLowerCase();if(Z in p)return p[Z].slice();if(Z[0]==="#")return Z.length===4?(j=parseInt(Z.substr(1),16))>=0&&j<=4095?[(3840&j)>>4|(3840&j)>>8,240&j|(240&j)>>4,15&j|(15&j)<<4,1]:null:Z.length===7&&(j=parseInt(Z.substr(1),16))>=0&&j<=16777215?[(16711680&j)>>16,(65280&j)>>8,255&j,1]:null;var et=Z.indexOf("("),ot=Z.indexOf(")");if(et!==-1&&ot+1===Z.length){var At=Z.substr(0,et),bt=Z.substr(et+1,ot-(et+1)).split(","),Vt=1;switch(At){case"rgba":if(bt.length!==4)return null;Vt=M(bt.pop());case"rgb":return bt.length!==3?null:[T(bt[0]),T(bt[1]),T(bt[2]),Vt];case"hsla":if(bt.length!==4)return null;Vt=M(bt.pop());case"hsl":if(bt.length!==3)return null;var jt=(parseFloat(bt[0])%360+360)%360/360,Qt=M(bt[1]),Zt=M(bt[2]),re=Zt<=.5?Zt*(Qt+1):Zt+Qt-Zt*Qt,pe=2*Zt-re;return[x(255*L(pe,re,jt+1/3)),x(255*L(pe,re,jt)),x(255*L(pe,re,jt-1/3)),Vt];default:return null}}return null}}catch{}}).parseCSSColor,sn=function(a,u,p,x){x===void 0&&(x=1),this.r=a,this.g=u,this.b=p,this.a=x};sn.parse=function(a){if(a){if(a instanceof sn)return a;if(typeof a=="string"){var u=ti(a);if(u)return new sn(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},sn.prototype.toString=function(){var a=this.toArray(),u=a[1],p=a[2],x=a[3];return"rgba("+Math.round(a[0])+","+Math.round(u)+","+Math.round(p)+","+x+")"},sn.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},sn.black=new sn(0,0,0,1),sn.white=new sn(1,1,1,1),sn.transparent=new sn(0,0,0,0),sn.red=new sn(1,0,0,1);var Wr=function(a,u,p){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Wr.prototype.compare=function(a,u){return this.collator.compare(a,u)},Wr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ga=function(a,u,p,x,T){this.text=a,this.image=u,this.scale=p,this.fontStack=x,this.textColor=T},hr=function(a){this.sections=a};hr.fromString=function(a){return new hr([new ga(a,null,null,null,null)])},hr.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},hr.factory=function(a){return a instanceof hr?a:hr.fromString(a)},hr.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},hr.prototype.serialize=function(){for(var a=["format"],u=0,p=this.sections;u<p.length;u+=1){var x=p[u];if(x.image)a.push(["image",x.image.name]);else{a.push(x.text);var T={};x.fontStack&&(T["text-font"]=["literal",x.fontStack.split(",")]),x.scale&&(T["font-scale"]=x.scale),x.textColor&&(T["text-color"]=["rgba"].concat(x.textColor.toArray())),a.push(T)}}return a};var Kn=function(a){this.name=a.name,this.available=a.available};function gt(a,u,p,x){return typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof p=="number"&&p>=0&&p<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:"Invalid rgba value ["+[a,u,p,x].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof x=="number"?[a,u,p,x]:[a,u,p]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Qo(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof sn||a instanceof Wr||a instanceof hr||a instanceof Kn)return!0;if(Array.isArray(a)){for(var u=0,p=a;u<p.length;u+=1)if(!Qo(p[u]))return!1;return!0}if(typeof a=="object"){for(var x in a)if(!Qo(a[x]))return!1;return!0}return!1}function Zn(a){if(a===null)return Ue;if(typeof a=="string")return Ve;if(typeof a=="boolean")return De;if(typeof a=="number")return ge;if(a instanceof sn)return Ze;if(a instanceof Wr)return rn;if(a instanceof hr)return hn;if(a instanceof Kn)return Yi;if(Array.isArray(a)){for(var u,p=a.length,x=0,T=a;x<T.length;x+=1){var M=Zn(T[x]);if(u){if(u===M)continue;u=si;break}u=M}return Ji(u||si,p)}return Gi}function Jo(a){var u=typeof a;return a===null?"":u==="string"||u==="number"||u==="boolean"?String(a):a instanceof sn||a instanceof hr||a instanceof Kn?a.toString():JSON.stringify(a)}Kn.prototype.toString=function(){return this.name},Kn.fromString=function(a){return a?new Kn({name:a,available:!1}):null},Kn.prototype.serialize=function(){return["image",this.name]};var Lr=function(a,u){this.type=a,this.value=u};Lr.parse=function(a,u){if(a.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Qo(a[1]))return u.error("invalid value");var p=a[1],x=Zn(p),T=u.expectedType;return x.kind!=="array"||x.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(x=T),new Lr(x,p)},Lr.prototype.evaluate=function(){return this.value},Lr.prototype.eachChild=function(){},Lr.prototype.outputDefined=function(){return!0},Lr.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof sn?["rgba"].concat(this.value.toArray()):this.value instanceof hr?this.value.serialize():this.value};var fr=function(a){this.name="ExpressionEvaluationError",this.message=a};fr.prototype.toJSON=function(){return this.message};var Tr={string:Ve,number:ge,boolean:De,object:Gi},Fn=function(a,u){this.type=a,this.args=u};Fn.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p,x=1,T=a[0];if(T==="array"){var M,L;if(a.length>2){var N=a[1];if(typeof N!="string"||!(N in Tr)||N==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);M=Tr[N],x++}else M=si;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);L=a[2],x++}p=Ji(M,L)}else p=Tr[T];for(var j=[];x<a.length;x++){var Z=u.parse(a[x],x,si);if(!Z)return null;j.push(Z)}return new Fn(p,j)},Fn.prototype.evaluate=function(a){for(var u=0;u<this.args.length;u++){var p=this.args[u].evaluate(a);if(!Qi(this.type,Zn(p)))return p;if(u===this.args.length-1)throw new fr("Expected value to be of type "+Hi(this.type)+", but found "+Hi(Zn(p))+" instead.")}return null},Fn.prototype.eachChild=function(a){this.args.forEach(a)},Fn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Fn.prototype.serialize=function(){var a=this.type,u=[a.kind];if(a.kind==="array"){var p=a.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){u.push(p.kind);var x=a.N;(typeof x=="number"||this.args.length>1)&&u.push(x)}}return u.concat(this.args.map(function(T){return T.serialize()}))};var gs=function(a){this.type=hn,this.sections=a};gs.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p=a[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");for(var x=[],T=!1,M=1;M<=a.length-1;++M){var L=a[M];if(T&&typeof L=="object"&&!Array.isArray(L)){T=!1;var N=null;if(L["font-scale"]&&!(N=u.parse(L["font-scale"],1,ge)))return null;var j=null;if(L["text-font"]&&!(j=u.parse(L["text-font"],1,Ji(Ve))))return null;var Z=null;if(L["text-color"]&&!(Z=u.parse(L["text-color"],1,Ze)))return null;var et=x[x.length-1];et.scale=N,et.font=j,et.textColor=Z}else{var ot=u.parse(a[M],1,si);if(!ot)return null;var At=ot.type.kind;if(At!=="string"&&At!=="value"&&At!=="null"&&At!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,x.push({content:ot,scale:null,font:null,textColor:null})}}return new gs(x)},gs.prototype.evaluate=function(a){return new hr(this.sections.map(function(u){var p=u.content.evaluate(a);return Zn(p)===Yi?new ga("",p,null,null,null):new ga(Jo(p),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))},gs.prototype.eachChild=function(a){for(var u=0,p=this.sections;u<p.length;u+=1){var x=p[u];a(x.content),x.scale&&a(x.scale),x.font&&a(x.font),x.textColor&&a(x.textColor)}},gs.prototype.outputDefined=function(){return!1},gs.prototype.serialize=function(){for(var a=["format"],u=0,p=this.sections;u<p.length;u+=1){var x=p[u];a.push(x.content.serialize());var T={};x.scale&&(T["font-scale"]=x.scale.serialize()),x.font&&(T["text-font"]=x.font.serialize()),x.textColor&&(T["text-color"]=x.textColor.serialize()),a.push(T)}return a};var Hr=function(a){this.type=Yi,this.input=a};Hr.parse=function(a,u){if(a.length!==2)return u.error("Expected two arguments.");var p=u.parse(a[1],1,Ve);return p?new Hr(p):u.error("No image name provided.")},Hr.prototype.evaluate=function(a){var u=this.input.evaluate(a),p=Kn.fromString(u);return p&&a.availableImages&&(p.available=a.availableImages.indexOf(u)>-1),p},Hr.prototype.eachChild=function(a){a(this.input)},Hr.prototype.outputDefined=function(){return!1},Hr.prototype.serialize=function(){return["image",this.input.serialize()]};var Ms={"to-boolean":De,"to-color":Ze,"to-number":ge,"to-string":Ve},Ln=function(a,u){this.type=a,this.args=u};Ln.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p=a[0];if((p==="to-boolean"||p==="to-string")&&a.length!==2)return u.error("Expected one argument.");for(var x=Ms[p],T=[],M=1;M<a.length;M++){var L=u.parse(a[M],M,si);if(!L)return null;T.push(L)}return new Ln(x,T)},Ln.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var u,p,x=0,T=this.args;x<T.length;x+=1){if(p=null,(u=T[x].evaluate(a))instanceof sn)return u;if(typeof u=="string"){var M=a.parseColor(u);if(M)return M}else if(Array.isArray(u)&&!(p=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":gt(u[0],u[1],u[2],u[3])))return new sn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new fr(p||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var L=null,N=0,j=this.args;N<j.length;N+=1){if((L=j[N].evaluate(a))===null)return 0;var Z=Number(L);if(!isNaN(Z))return Z}throw new fr("Could not convert "+JSON.stringify(L)+" to number.")}return this.type.kind==="formatted"?hr.fromString(Jo(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Kn.fromString(Jo(this.args[0].evaluate(a))):Jo(this.args[0].evaluate(a))},Ln.prototype.eachChild=function(a){this.args.forEach(a)},Ln.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Ln.prototype.serialize=function(){if(this.type.kind==="formatted")return new gs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Hr(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(u){a.push(u.serialize())}),a};var ah=["Unknown","Point","LineString","Polygon"],yt=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};yt.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},yt.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ah[this.feature.type]:this.feature.type:null},yt.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},yt.prototype.canonicalID=function(){return this.canonical},yt.prototype.properties=function(){return this.feature&&this.feature.properties||{}},yt.prototype.parseColor=function(a){var u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=sn.parse(a)),u};var Dt=function(a,u,p,x){this.name=a,this.type=u,this._evaluate=p,this.args=x};Dt.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Dt.prototype.eachChild=function(a){this.args.forEach(a)},Dt.prototype.outputDefined=function(){return!1},Dt.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Dt.parse=function(a,u){var p,x=a[0],T=Dt.definitions[x];if(!T)return u.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0);for(var M=Array.isArray(T)?T[0]:T.type,L=Array.isArray(T)?[[T[1],T[2]]]:T.overloads,N=L.filter(function(Li){var ui=Li[0];return!Array.isArray(ui)||ui.length===a.length-1}),j=null,Z=0,et=N;Z<et.length;Z+=1){var ot=et[Z],At=ot[0],bt=ot[1];j=new zo(u.registry,u.path,null,u.scope);for(var Vt=[],jt=!1,Qt=1;Qt<a.length;Qt++){var Zt=a[Qt],re=Array.isArray(At)?At[Qt-1]:At.type,pe=j.parse(Zt,1+Vt.length,re);if(!pe){jt=!0;break}Vt.push(pe)}if(!jt)if(Array.isArray(At)&&At.length!==Vt.length)j.error("Expected "+At.length+" arguments, but found "+Vt.length+" instead.");else{for(var be=0;be<Vt.length;be++){var we=Array.isArray(At)?At[be]:At.type,Ne=Vt[be];j.concat(be+1).checkSubtype(we,Ne.type)}if(j.errors.length===0)return new Dt(x,M,bt,Vt)}}if(N.length===1)(p=u.errors).push.apply(p,j.errors);else{for(var Je=(N.length?N:L).map(function(Li){var ui;return ui=Li[0],Array.isArray(ui)?"("+ui.map(Hi).join(", ")+")":"("+Hi(ui.type)+"...)"}).join(" | "),ri=[],Si=1;Si<a.length;Si++){var li=u.parse(a[Si],1+ri.length);if(!li)return null;ri.push(Hi(li.type))}u.error("Expected arguments of type "+Je+", but found ("+ri.join(", ")+") instead.")}return null},Dt.register=function(a,u){for(var p in Dt.definitions=u,u)a[p]=Dt};var $t=function(a,u,p){this.type=rn,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=u};function Se(a,u){a[0]=Math.min(a[0],u[0]),a[1]=Math.min(a[1],u[1]),a[2]=Math.max(a[2],u[0]),a[3]=Math.max(a[3],u[1])}function Ye(a,u){return!(a[0]<=u[0]||a[2]>=u[2]||a[1]<=u[1]||a[3]>=u[3])}function Xi(a,u){var p=(180+a[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,T=Math.pow(2,u.z);return[Math.round(p*T*8192),Math.round(x*T*8192)]}function En(a,u,p){return u[1]>a[1]!=p[1]>a[1]&&a[0]<(p[0]-u[0])*(a[1]-u[1])/(p[1]-u[1])+u[0]}function Yn(a,u){for(var p,x,T,M,L,N,j,Z=!1,et=0,ot=u.length;et<ot;et++)for(var At=u[et],bt=0,Vt=At.length;bt<Vt-1;bt++){if((M=(p=a)[0]-(x=At[bt])[0])*(j=p[1]-(T=At[bt+1])[1])-(N=p[0]-T[0])*(L=p[1]-x[1])==0&&M*N<=0&&L*j<=0)return!1;En(a,At[bt],At[bt+1])&&(Z=!Z)}return Z}function Tn(a,u){for(var p=0;p<u.length;p++)if(Yn(a,u[p]))return!0;return!1}function Xr(a,u,p,x){var T=x[0]-p[0],M=x[1]-p[1],L=(a[0]-p[0])*M-T*(a[1]-p[1]),N=(u[0]-p[0])*M-T*(u[1]-p[1]);return L>0&&N<0||L<0&&N>0}function qs(a,u,p){for(var x=0,T=p;x<T.length;x+=1)for(var M=T[x],L=0;L<M.length-1;++L)if((ot=[(et=M[L+1])[0]-(Z=M[L])[0],et[1]-Z[1]])[0]*(At=[(j=u)[0]-(N=a)[0],j[1]-N[1]])[1]-ot[1]*At[0]!=0&&Xr(N,j,Z,et)&&Xr(Z,et,N,j))return!0;var N,j,Z,et,ot,At;return!1}function wf(a,u){for(var p=0;p<a.length;++p)if(!Yn(a[p],u))return!1;for(var x=0;x<a.length-1;++x)if(qs(a[x],a[x+1],u))return!1;return!0}function Ef(a,u){for(var p=0;p<u.length;p++)if(wf(a,u[p]))return!0;return!1}function El(a,u,p){for(var x=[],T=0;T<a.length;T++){for(var M=[],L=0;L<a[T].length;L++){var N=Xi(a[T][L],p);Se(u,N),M.push(N)}x.push(M)}return x}function ac(a,u,p){for(var x=[],T=0;T<a.length;T++){var M=El(a[T],u,p);x.push(M)}return x}function Va(a,u,p,x){if(a[0]<p[0]||a[0]>p[2]){var T=.5*x,M=a[0]-p[0]>T?-x:p[0]-a[0]>T?x:0;M===0&&(M=a[0]-p[2]>T?-x:p[2]-a[0]>T?x:0),a[0]+=M}Se(u,a)}function lc(a,u,p,x){for(var T=8192*Math.pow(2,x.z),M=[8192*x.x,8192*x.y],L=[],N=0,j=a;N<j.length;N+=1)for(var Z=0,et=j[N];Z<et.length;Z+=1){var ot=et[Z],At=[ot.x+M[0],ot.y+M[1]];Va(At,u,p,T),L.push(At)}return L}function uc(a,u,p,x){for(var T,M=8192*Math.pow(2,x.z),L=[8192*x.x,8192*x.y],N=[],j=0,Z=a;j<Z.length;j+=1){for(var et=[],ot=0,At=Z[j];ot<At.length;ot+=1){var bt=At[ot],Vt=[bt.x+L[0],bt.y+L[1]];Se(u,Vt),et.push(Vt)}N.push(et)}if(u[2]-u[0]<=M/2){(T=u)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(var jt=0,Qt=N;jt<Qt.length;jt+=1)for(var Zt=0,re=Qt[jt];Zt<re.length;Zt+=1)Va(re[Zt],u,p,M)}return N}$t.parse=function(a,u){if(a.length!==2)return u.error("Expected one argument.");var p=a[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");var x=u.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,De);if(!x)return null;var T=u.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,De);if(!T)return null;var M=null;return p.locale&&!(M=u.parse(p.locale,1,Ve))?null:new $t(x,T,M)},$t.prototype.evaluate=function(a){return new Wr(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},$t.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},$t.prototype.outputDefined=function(){return!1},$t.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var oo=function(a,u){this.type=De,this.geojson=a,this.geometries=u};function ya(a){if(a instanceof Dt&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof oo)return!1;var u=!0;return a.eachChild(function(p){u&&!ya(p)&&(u=!1)}),u}function $o(a){if(a instanceof Dt&&a.name==="feature-state")return!1;var u=!0;return a.eachChild(function(p){u&&!$o(p)&&(u=!1)}),u}function Ga(a,u){if(a instanceof Dt&&u.indexOf(a.name)>=0)return!1;var p=!0;return a.eachChild(function(x){p&&!Ga(x,u)&&(p=!1)}),p}oo.parse=function(a,u){if(a.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Qo(a[1])){var p=a[1];if(p.type==="FeatureCollection")for(var x=0;x<p.features.length;++x){var T=p.features[x].geometry.type;if(T==="Polygon"||T==="MultiPolygon")return new oo(p,p.features[x].geometry)}else if(p.type==="Feature"){var M=p.geometry.type;if(M==="Polygon"||M==="MultiPolygon")return new oo(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new oo(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},oo.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,p){var x=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],M=u.canonicalID();if(p.type==="Polygon"){var L=El(p.coordinates,T,M),N=lc(u.geometry(),x,T,M);if(!Ye(x,T))return!1;for(var j=0,Z=N;j<Z.length;j+=1)if(!Yn(Z[j],L))return!1}if(p.type==="MultiPolygon"){var et=ac(p.coordinates,T,M),ot=lc(u.geometry(),x,T,M);if(!Ye(x,T))return!1;for(var At=0,bt=ot;At<bt.length;At+=1)if(!Tn(bt[At],et))return!1}return!0})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,p){var x=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],M=u.canonicalID();if(p.type==="Polygon"){var L=El(p.coordinates,T,M),N=uc(u.geometry(),x,T,M);if(!Ye(x,T))return!1;for(var j=0,Z=N;j<Z.length;j+=1)if(!wf(Z[j],L))return!1}if(p.type==="MultiPolygon"){var et=ac(p.coordinates,T,M),ot=uc(u.geometry(),x,T,M);if(!Ye(x,T))return!1;for(var At=0,bt=ot;At<bt.length;At+=1)if(!Ef(bt[At],et))return!1}return!0})(a,this.geometries)}return!1},oo.prototype.eachChild=function(){},oo.prototype.outputDefined=function(){return!0},oo.prototype.serialize=function(){return["within",this.geojson]};var No=function(a,u){this.type=u.type,this.name=a,this.boundExpression=u};No.parse=function(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var p=a[1];return u.scope.has(p)?new No(p,u.scope.get(p)):u.error('Unknown variable "'+p+'". Make sure "'+p+'" has been bound in an enclosing "let" expression before using it.',1)},No.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},No.prototype.eachChild=function(){},No.prototype.outputDefined=function(){return!1},No.prototype.serialize=function(){return["var",this.name]};var zo=function(a,u,p,x,T){u===void 0&&(u=[]),x===void 0&&(x=new ke),T===void 0&&(T=[]),this.registry=a,this.path=u,this.key=u.map(function(M){return"["+M+"]"}).join(""),this.scope=x,this.errors=T,this.expectedType=p};function cc(a,u){for(var p,x=a.length-1,T=0,M=x,L=0;T<=M;)if((p=a[L=Math.floor((T+M)/2)])<=u){if(L===x||u<a[L+1])return L;T=L+1}else{if(!(p>u))throw new fr("Input is not a number.");M=L-1}return 0}zo.prototype.parse=function(a,u,p,x,T){return T===void 0&&(T={}),u?this.concat(u,p,x)._parse(a,T):this._parse(a,T)},zo.prototype._parse=function(a,u){function p(Z,et,ot){return ot==="assert"?new Fn(et,[Z]):ot==="coerce"?new Ln(et,[Z]):Z}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var x=a[0];if(typeof x!="string")return this.error("Expression name must be a string, but found "+typeof x+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var T=this.registry[x];if(T){var M=T.parse(a,this);if(!M)return null;if(this.expectedType){var L=this.expectedType,N=M.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||N.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||N.kind!=="value"&&N.kind!=="string"){if(this.checkSubtype(L,N))return null}else M=p(M,L,u.typeAnnotation||"coerce");else M=p(M,L,u.typeAnnotation||"assert")}if(!(M instanceof Lr)&&M.type.kind!=="resolvedImage"&&(function Z(et){if(et instanceof No)return Z(et.boundExpression);if(et instanceof Dt&&et.name==="error"||et instanceof $t||et instanceof oo)return!1;var ot=et instanceof Ln||et instanceof Fn,At=!0;return et.eachChild(function(bt){At=ot?At&&Z(bt):At&&bt instanceof Lr}),!!At&&ya(et)&&Ga(et,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])})(M)){var j=new yt;try{M=new Lr(M.type,M.evaluate(j))}catch(Z){return this.error(Z.message),null}}return M}return this.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},zo.prototype.concat=function(a,u,p){var x=typeof a=="number"?this.path.concat(a):this.path,T=p?this.scope.concat(p):this.scope;return new zo(this.registry,x,u||null,T,this.errors)},zo.prototype.error=function(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];var x=""+this.key+u.map(function(T){return"["+T+"]"}).join("");this.errors.push(new Ie(x,a))},zo.prototype.checkSubtype=function(a,u){var p=Qi(a,u);return p&&this.error(p),p};var ys=function(a,u,p){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(var x=0,T=p;x<T.length;x+=1){var M=T[x],L=M[1];this.labels.push(M[0]),this.outputs.push(L)}};function gr(a,u,p){return a*(1-p)+u*p}ys.parse=function(a,u){if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");var p=u.parse(a[1],1,ge);if(!p)return null;var x=[],T=null;u.expectedType&&u.expectedType.kind!=="value"&&(T=u.expectedType);for(var M=1;M<a.length;M+=2){var L=M===1?-1/0:a[M],N=a[M+1],j=M,Z=M+1;if(typeof L!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(x.length&&x[x.length-1][0]>=L)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);var et=u.parse(N,Z,T);if(!et)return null;T=T||et.type,x.push([L,et])}return new ys(T,p,x)},ys.prototype.evaluate=function(a){var u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return p[0].evaluate(a);var T=u.length;return x>=u[T-1]?p[T-1].evaluate(a):p[cc(u,x)].evaluate(a)},ys.prototype.eachChild=function(a){a(this.input);for(var u=0,p=this.outputs;u<p.length;u+=1)a(p[u])},ys.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},ys.prototype.serialize=function(){for(var a=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&a.push(this.labels[u]),a.push(this.outputs[u].serialize());return a};var ja=Object.freeze({__proto__:null,number:gr,color:function(a,u,p){return new sn(gr(a.r,u.r,p),gr(a.g,u.g,p),gr(a.b,u.b,p),gr(a.a,u.a,p))},array:function(a,u,p){return a.map(function(x,T){return gr(x,u[T],p)})}}),Cf=6/29*3*(6/29),Gp=Math.PI/180,jp=180/Math.PI;function lh(a){return a>.008856451679035631?Math.pow(a,1/3):a/Cf+4/29}function qr(a){return a>6/29?a*a*a:Cf*(a-4/29)}function ta(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function is(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function hc(a){var u=is(a.r),p=is(a.g),x=is(a.b),T=lh((.4124564*u+.3575761*p+.1804375*x)/.95047),M=lh((.2126729*u+.7151522*p+.072175*x)/1);return{l:116*M-16,a:500*(T-M),b:200*(M-lh((.0193339*u+.119192*p+.9503041*x)/1.08883)),alpha:a.a}}function uh(a){var u=(a.l+16)/116,p=isNaN(a.a)?u:u+a.a/500,x=isNaN(a.b)?u:u-a.b/200;return u=1*qr(u),p=.95047*qr(p),x=1.08883*qr(x),new sn(ta(3.2404542*p-1.5371385*u-.4985314*x),ta(-.969266*p+1.8760108*u+.041556*x),ta(.0556434*p-.2040259*u+1.0572252*x),a.alpha)}function fc(a,u,p){var x=u-a;return a+p*(x>180||x<-180?x-360*Math.round(x/360):x)}var Au={forward:hc,reverse:uh,interpolate:function(a,u,p){return{l:gr(a.l,u.l,p),a:gr(a.a,u.a,p),b:gr(a.b,u.b,p),alpha:gr(a.alpha,u.alpha,p)}}},mu={forward:function(a){var u=hc(a),p=u.l,x=u.a,T=u.b,M=Math.atan2(T,x)*jp;return{h:M<0?M+360:M,c:Math.sqrt(x*x+T*T),l:p,alpha:a.a}},reverse:function(a){var u=a.h*Gp,p=a.c;return uh({l:a.l,a:Math.cos(u)*p,b:Math.sin(u)*p,alpha:a.alpha})},interpolate:function(a,u,p){return{h:fc(a.h,u.h,p),c:gr(a.c,u.c,p),l:gr(a.l,u.l,p),alpha:gr(a.alpha,u.alpha,p)}}},Tf=Object.freeze({__proto__:null,lab:Au,hcl:mu}),Nr=function(a,u,p,x,T){this.type=a,this.operator=u,this.interpolation=p,this.input=x,this.labels=[],this.outputs=[];for(var M=0,L=T;M<L.length;M+=1){var N=L[M],j=N[1];this.labels.push(N[0]),this.outputs.push(j)}};function Cl(a,u,p,x){var T=x-p,M=a-p;return T===0?0:u===1?M/T:(Math.pow(u,M)-1)/(Math.pow(u,T)-1)}Nr.interpolationFactor=function(a,u,p,x){var T=0;if(a.name==="exponential")T=Cl(u,a.base,p,x);else if(a.name==="linear")T=Cl(u,1,p,x);else if(a.name==="cubic-bezier"){var M=a.controlPoints;T=new c(M[0],M[1],M[2],M[3]).solve(Cl(u,1,p,x))}return T},Nr.parse=function(a,u){var p=a[0],x=a[1],T=a[2],M=a.slice(3);if(!Array.isArray(x)||x.length===0)return u.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){var L=x[1];if(typeof L!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:L}}else{if(x[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(x[0]),1,0);var N=x.slice(1);if(N.length!==4||N.some(function(Qt){return typeof Qt!="number"||Qt<0||Qt>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:N}}if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(T=u.parse(T,2,ge)))return null;var j=[],Z=null;p==="interpolate-hcl"||p==="interpolate-lab"?Z=Ze:u.expectedType&&u.expectedType.kind!=="value"&&(Z=u.expectedType);for(var et=0;et<M.length;et+=2){var ot=M[et],At=M[et+1],bt=et+3,Vt=et+4;if(typeof ot!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',bt);if(j.length&&j[j.length-1][0]>=ot)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',bt);var jt=u.parse(At,Vt,Z);if(!jt)return null;Z=Z||jt.type,j.push([ot,jt])}return Z.kind==="number"||Z.kind==="color"||Z.kind==="array"&&Z.itemType.kind==="number"&&typeof Z.N=="number"?new Nr(Z,p,x,T,j):u.error("Type "+Hi(Z)+" is not interpolatable.")},Nr.prototype.evaluate=function(a){var u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return p[0].evaluate(a);var T=u.length;if(x>=u[T-1])return p[T-1].evaluate(a);var M=cc(u,x),L=Nr.interpolationFactor(this.interpolation,x,u[M],u[M+1]),N=p[M].evaluate(a),j=p[M+1].evaluate(a);return this.operator==="interpolate"?ja[this.type.kind.toLowerCase()](N,j,L):this.operator==="interpolate-hcl"?mu.reverse(mu.interpolate(mu.forward(N),mu.forward(j),L)):Au.reverse(Au.interpolate(Au.forward(N),Au.forward(j),L))},Nr.prototype.eachChild=function(a){a(this.input);for(var u=0,p=this.outputs;u<p.length;u+=1)a(p[u])},Nr.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Nr.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,a,this.input.serialize()],p=0;p<this.labels.length;p++)u.push(this.labels[p],this.outputs[p].serialize());return u};var Bs=function(a,u){this.type=a,this.args=u};Bs.parse=function(a,u){if(a.length<2)return u.error("Expectected at least one argument.");var p=null,x=u.expectedType;x&&x.kind!=="value"&&(p=x);for(var T=[],M=0,L=a.slice(1);M<L.length;M+=1){var N=u.parse(L[M],1+T.length,p,void 0,{typeAnnotation:"omit"});if(!N)return null;p=p||N.type,T.push(N)}var j=x&&T.some(function(Z){return Qi(x,Z.type)});return new Bs(j?si:p,T)},Bs.prototype.evaluate=function(a){for(var u,p=null,x=0,T=0,M=this.args;T<M.length&&(x++,(p=M[T].evaluate(a))&&p instanceof Kn&&!p.available&&(u||(u=p.name),p=null,x===this.args.length&&(p=u)),p===null);T+=1);return p},Bs.prototype.eachChild=function(a){this.args.forEach(a)},Bs.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Bs.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(u){a.push(u.serialize())}),a};var ea=function(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u};ea.prototype.evaluate=function(a){return this.result.evaluate(a)},ea.prototype.eachChild=function(a){for(var u=0,p=this.bindings;u<p.length;u+=1)a(p[u][1]);a(this.result)},ea.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var p=[],x=1;x<a.length-1;x+=2){var T=a[x];if(typeof T!="string")return u.error("Expected string, but found "+typeof T+" instead.",x);if(/[^a-zA-Z0-9_]/.test(T))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);var M=u.parse(a[x+1],x+1);if(!M)return null;p.push([T,M])}var L=u.parse(a[a.length-1],a.length-1,u.expectedType,p);return L?new ea(p,L):null},ea.prototype.outputDefined=function(){return this.result.outputDefined()},ea.prototype.serialize=function(){for(var a=["let"],u=0,p=this.bindings;u<p.length;u+=1){var x=p[u];a.push(x[0],x[1].serialize())}return a.push(this.result.serialize()),a};var va=function(a,u,p){this.type=a,this.index=u,this.input=p};va.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,ge),x=u.parse(a[2],2,Ji(u.expectedType||si));return p&&x?new va(x.type.itemType,p,x):null},va.prototype.evaluate=function(a){var u=this.index.evaluate(a),p=this.input.evaluate(a);if(u<0)throw new fr("Array index out of bounds: "+u+" < 0.");if(u>=p.length)throw new fr("Array index out of bounds: "+u+" > "+(p.length-1)+".");if(u!==Math.floor(u))throw new fr("Array index must be an integer, but found "+u+" instead.");return p[u]},va.prototype.eachChild=function(a){a(this.index),a(this.input)},va.prototype.outputDefined=function(){return!1},va.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Uo=function(a,u){this.type=De,this.needle=a,this.haystack=u};Uo.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,si),x=u.parse(a[2],2,si);return p&&x?mi(p.type,[De,Ve,ge,Ue,si])?new Uo(p,x):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Hi(p.type)+" instead"):null},Uo.prototype.evaluate=function(a){var u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!p)return!1;if(!_t(u,["boolean","string","number","null"]))throw new fr("Expected first argument to be of type boolean, string, number or null, but found "+Hi(Zn(u))+" instead.");if(!_t(p,["string","array"]))throw new fr("Expected second argument to be of type array or string, but found "+Hi(Zn(p))+" instead.");return p.indexOf(u)>=0},Uo.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Uo.prototype.outputDefined=function(){return!0},Uo.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Rs=function(a,u,p){this.type=ge,this.needle=a,this.haystack=u,this.fromIndex=p};Rs.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,si),x=u.parse(a[2],2,si);if(!p||!x)return null;if(!mi(p.type,[De,Ve,ge,Ue,si]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Hi(p.type)+" instead");if(a.length===4){var T=u.parse(a[3],3,ge);return T?new Rs(p,x,T):null}return new Rs(p,x)},Rs.prototype.evaluate=function(a){var u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!_t(u,["boolean","string","number","null"]))throw new fr("Expected first argument to be of type boolean, string, number or null, but found "+Hi(Zn(u))+" instead.");if(!_t(p,["string","array"]))throw new fr("Expected second argument to be of type array or string, but found "+Hi(Zn(p))+" instead.");if(this.fromIndex){var x=this.fromIndex.evaluate(a);return p.indexOf(u,x)}return p.indexOf(u)},Rs.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Rs.prototype.outputDefined=function(){return!1},Rs.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ls=function(a,u,p,x,T,M){this.inputType=a,this.type=u,this.input=p,this.cases=x,this.outputs=T,this.otherwise=M};Ls.parse=function(a,u){if(a.length<5)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return u.error("Expected an even number of arguments.");var p,x;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var T={},M=[],L=2;L<a.length-1;L+=2){var N=a[L],j=a[L+1];Array.isArray(N)||(N=[N]);var Z=u.concat(L);if(N.length===0)return Z.error("Expected at least one branch label.");for(var et=0,ot=N;et<ot.length;et+=1){var At=ot[et];if(typeof At!="number"&&typeof At!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof At=="number"&&Math.abs(At)>Number.MAX_SAFE_INTEGER)return Z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof At=="number"&&Math.floor(At)!==At)return Z.error("Numeric branch labels must be integer values.");if(p){if(Z.checkSubtype(p,Zn(At)))return null}else p=Zn(At);if(T[String(At)]!==void 0)return Z.error("Branch labels must be unique.");T[String(At)]=M.length}var bt=u.parse(j,L,x);if(!bt)return null;x=x||bt.type,M.push(bt)}var Vt=u.parse(a[1],1,si);if(!Vt)return null;var jt=u.parse(a[a.length-1],a.length-1,x);return jt?Vt.type.kind!=="value"&&u.concat(1).checkSubtype(p,Vt.type)?null:new Ls(p,x,Vt,T,M,jt):null},Ls.prototype.evaluate=function(a){var u=this.input.evaluate(a);return(Zn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)},Ls.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Ls.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Ls.prototype.serialize=function(){for(var a=this,u=["match",this.input.serialize()],p=[],x={},T=0,M=Object.keys(this.cases).sort();T<M.length;T+=1){var L=M[T];(ot=x[this.cases[L]])===void 0?(x[this.cases[L]]=p.length,p.push([this.cases[L],[L]])):p[ot][1].push(L)}for(var N=function(bt){return a.inputType.kind==="number"?Number(bt):bt},j=0,Z=p;j<Z.length;j+=1){var et=Z[j],ot=et[0],At=et[1];u.push(At.length===1?N(At[0]):At.map(N)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var _a=function(a,u,p){this.type=a,this.branches=u,this.otherwise=p};_a.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return u.error("Expected an odd number of arguments.");var p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);for(var x=[],T=1;T<a.length-1;T+=2){var M=u.parse(a[T],T,De);if(!M)return null;var L=u.parse(a[T+1],T+1,p);if(!L)return null;x.push([M,L]),p=p||L.type}var N=u.parse(a[a.length-1],a.length-1,p);return N?new _a(p,x,N):null},_a.prototype.evaluate=function(a){for(var u=0,p=this.branches;u<p.length;u+=1){var x=p[u],T=x[1];if(x[0].evaluate(a))return T.evaluate(a)}return this.otherwise.evaluate(a)},_a.prototype.eachChild=function(a){for(var u=0,p=this.branches;u<p.length;u+=1){var x=p[u],T=x[1];a(x[0]),a(T)}a(this.otherwise)},_a.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},_a.prototype.serialize=function(){var a=["case"];return this.eachChild(function(u){a.push(u.serialize())}),a};var ia=function(a,u,p,x){this.type=a,this.input=u,this.beginIndex=p,this.endIndex=x};function dc(a,u){return a==="=="||a==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Sf(a,u,p,x){return x.compare(u,p)===0}function Dn(a,u,p){var x=a!=="=="&&a!=="!=";return(function(){function T(M,L,N){this.type=De,this.lhs=M,this.rhs=L,this.collator=N,this.hasUntypedArgument=M.type.kind==="value"||L.type.kind==="value"}return T.parse=function(M,L){if(M.length!==3&&M.length!==4)return L.error("Expected two or three arguments.");var N=M[0],j=L.parse(M[1],1,si);if(!j)return null;if(!dc(N,j.type))return L.concat(1).error('"'+N+`" comparisons are not supported for type '`+Hi(j.type)+"'.");var Z=L.parse(M[2],2,si);if(!Z)return null;if(!dc(N,Z.type))return L.concat(2).error('"'+N+`" comparisons are not supported for type '`+Hi(Z.type)+"'.");if(j.type.kind!==Z.type.kind&&j.type.kind!=="value"&&Z.type.kind!=="value")return L.error("Cannot compare types '"+Hi(j.type)+"' and '"+Hi(Z.type)+"'.");x&&(j.type.kind==="value"&&Z.type.kind!=="value"?j=new Fn(Z.type,[j]):j.type.kind!=="value"&&Z.type.kind==="value"&&(Z=new Fn(j.type,[Z])));var et=null;if(M.length===4){if(j.type.kind!=="string"&&Z.type.kind!=="string"&&j.type.kind!=="value"&&Z.type.kind!=="value")return L.error("Cannot use collator to compare non-string types.");if(!(et=L.parse(M[3],3,rn)))return null}return new T(j,Z,et)},T.prototype.evaluate=function(M){var L=this.lhs.evaluate(M),N=this.rhs.evaluate(M);if(x&&this.hasUntypedArgument){var j=Zn(L),Z=Zn(N);if(j.kind!==Z.kind||j.kind!=="string"&&j.kind!=="number")throw new fr('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+j.kind+", "+Z.kind+") instead.")}if(this.collator&&!x&&this.hasUntypedArgument){var et=Zn(L),ot=Zn(N);if(et.kind!=="string"||ot.kind!=="string")return u(M,L,N)}return this.collator?p(M,L,N,this.collator.evaluate(M)):u(M,L,N)},T.prototype.eachChild=function(M){M(this.lhs),M(this.rhs),this.collator&&M(this.collator)},T.prototype.outputDefined=function(){return!0},T.prototype.serialize=function(){var M=[a];return this.eachChild(function(L){M.push(L.serialize())}),M},T})()}ia.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,si),x=u.parse(a[2],2,ge);if(!p||!x)return null;if(!mi(p.type,[Ji(si),Ve,si]))return u.error("Expected first argument to be of type array or string, but found "+Hi(p.type)+" instead");if(a.length===4){var T=u.parse(a[3],3,ge);return T?new ia(p.type,p,x,T):null}return new ia(p.type,p,x)},ia.prototype.evaluate=function(a){var u=this.input.evaluate(a),p=this.beginIndex.evaluate(a);if(!_t(u,["string","array"]))throw new fr("Expected first argument to be of type array or string, but found "+Hi(Zn(u))+" instead.");if(this.endIndex){var x=this.endIndex.evaluate(a);return u.slice(p,x)}return u.slice(p)},ia.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},ia.prototype.outputDefined=function(){return!1},ia.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Pf=Dn("==",function(a,u,p){return u===p},Sf),pc=Dn("!=",function(a,u,p){return u!==p},function(a,u,p,x){return!Sf(0,u,p,x)}),If=Dn("<",function(a,u,p){return u<p},function(a,u,p,x){return x.compare(u,p)<0}),Mf=Dn(">",function(a,u,p){return u>p},function(a,u,p,x){return x.compare(u,p)>0}),Bf=Dn("<=",function(a,u,p){return u<=p},function(a,u,p,x){return x.compare(u,p)<=0}),Rf=Dn(">=",function(a,u,p){return u>=p},function(a,u,p,x){return x.compare(u,p)>=0}),Wa=function(a,u,p,x,T){this.type=Ve,this.number=a,this.locale=u,this.currency=p,this.minFractionDigits=x,this.maxFractionDigits=T};Wa.parse=function(a,u){if(a.length!==3)return u.error("Expected two arguments.");var p=u.parse(a[1],1,ge);if(!p)return null;var x=a[2];if(typeof x!="object"||Array.isArray(x))return u.error("NumberFormat options argument must be an object.");var T=null;if(x.locale&&!(T=u.parse(x.locale,1,Ve)))return null;var M=null;if(x.currency&&!(M=u.parse(x.currency,1,Ve)))return null;var L=null;if(x["min-fraction-digits"]&&!(L=u.parse(x["min-fraction-digits"],1,ge)))return null;var N=null;return x["max-fraction-digits"]&&!(N=u.parse(x["max-fraction-digits"],1,ge))?null:new Wa(p,T,M,L,N)},Wa.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Wa.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Wa.prototype.outputDefined=function(){return!1},Wa.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var ba=function(a){this.type=ge,this.input=a};ba.parse=function(a,u){if(a.length!==2)return u.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Hi(p.type)+" instead."):new ba(p):null},ba.prototype.evaluate=function(a){var u=this.input.evaluate(a);if(typeof u=="string"||Array.isArray(u))return u.length;throw new fr("Expected value to be of type string or array, but found "+Hi(Zn(u))+" instead.")},ba.prototype.eachChild=function(a){a(this.input)},ba.prototype.outputDefined=function(){return!1},ba.prototype.serialize=function(){var a=["length"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Ha={"==":Pf,"!=":pc,">":Mf,"<":If,">=":Rf,"<=":Bf,array:Fn,at:va,boolean:Fn,case:_a,coalesce:Bs,collator:$t,format:gs,image:Hr,in:Uo,"index-of":Rs,interpolate:Nr,"interpolate-hcl":Nr,"interpolate-lab":Nr,length:ba,let:ea,literal:Lr,match:Ls,number:Fn,"number-format":Wa,object:Fn,slice:ia,step:ys,string:Fn,"to-boolean":Ln,"to-color":Ln,"to-number":Ln,"to-string":Ln,var:No,within:oo};function gu(a,u){var p=u[0],x=u[1],T=u[2],M=u[3];p=p.evaluate(a),x=x.evaluate(a),T=T.evaluate(a);var L=M?M.evaluate(a):1,N=gt(p,x,T,L);if(N)throw new fr(N);return new sn(p/255*L,x/255*L,T/255*L,L)}function Lf(a,u){return a in u}function ch(a,u){var p=u[a];return p===void 0?null:p}function Xa(a){return{type:a}}function Tl(a){return{result:"success",value:a}}function qa(a){return{result:"error",value:a}}function na(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function hh(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Vo(a){return!!a.expression&&a.expression.interpolated}function zn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Sl(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Df(a){return a}function Pl(a,u,p){return a!==void 0?a:u!==void 0?u:p!==void 0?p:void 0}function fh(a,u,p,x,T){return Pl(typeof p===T?x[p]:void 0,a.default,u.default)}function dh(a,u,p){if(zn(p)!=="number")return Pl(a.default,u.default);var x=a.stops.length;if(x===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[x-1][0])return a.stops[x-1][1];var T=cc(a.stops.map(function(M){return M[0]}),p);return a.stops[T][1]}function Ac(a,u,p){var x=a.base!==void 0?a.base:1;if(zn(p)!=="number")return Pl(a.default,u.default);var T=a.stops.length;if(T===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[T-1][0])return a.stops[T-1][1];var M=cc(a.stops.map(function(ot){return ot[0]}),p),L=(function(ot,At,bt,Vt){var jt=Vt-bt,Qt=ot-bt;return jt===0?0:At===1?Qt/jt:(Math.pow(At,Qt)-1)/(Math.pow(At,jt)-1)})(p,x,a.stops[M][0],a.stops[M+1][0]),N=a.stops[M][1],j=a.stops[M+1][1],Z=ja[u.type]||Df;if(a.colorSpace&&a.colorSpace!=="rgb"){var et=Tf[a.colorSpace];Z=function(ot,At){return et.reverse(et.interpolate(et.forward(ot),et.forward(At),L))}}return typeof N.evaluate=="function"?{evaluate:function(){for(var ot=[],At=arguments.length;At--;)ot[At]=arguments[At];var bt=N.evaluate.apply(void 0,ot),Vt=j.evaluate.apply(void 0,ot);if(bt!==void 0&&Vt!==void 0)return Z(bt,Vt,L)}}:Z(N,j,L)}function Il(a,u,p){return u.type==="color"?p=sn.parse(p):u.type==="formatted"?p=hr.fromString(p.toString()):u.type==="resolvedImage"?p=Kn.fromString(p.toString()):zn(p)===u.type||u.type==="enum"&&u.values[p]||(p=void 0),Pl(p,a.default,u.default)}Dt.register(Ha,{error:[{kind:"error"},[Ve],function(a,u){throw new fr(u[0].evaluate(a))}],typeof:[Ve,[si],function(a,u){return Hi(Zn(u[0].evaluate(a)))}],"to-rgba":[Ji(ge,4),[Ze],function(a,u){return u[0].evaluate(a).toArray()}],rgb:[Ze,[ge,ge,ge],gu],rgba:[Ze,[ge,ge,ge,ge],gu],has:{type:De,overloads:[[[Ve],function(a,u){return Lf(u[0].evaluate(a),a.properties())}],[[Ve,Gi],function(a,u){var p=u[1];return Lf(u[0].evaluate(a),p.evaluate(a))}]]},get:{type:si,overloads:[[[Ve],function(a,u){return ch(u[0].evaluate(a),a.properties())}],[[Ve,Gi],function(a,u){var p=u[1];return ch(u[0].evaluate(a),p.evaluate(a))}]]},"feature-state":[si,[Ve],function(a,u){return ch(u[0].evaluate(a),a.featureState||{})}],properties:[Gi,[],function(a){return a.properties()}],"geometry-type":[Ve,[],function(a){return a.geometryType()}],id:[si,[],function(a){return a.id()}],zoom:[ge,[],function(a){return a.globals.zoom}],"heatmap-density":[ge,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[ge,[],function(a){return a.globals.lineProgress||0}],accumulated:[si,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[ge,Xa(ge),function(a,u){for(var p=0,x=0,T=u;x<T.length;x+=1)p+=T[x].evaluate(a);return p}],"*":[ge,Xa(ge),function(a,u){for(var p=1,x=0,T=u;x<T.length;x+=1)p*=T[x].evaluate(a);return p}],"-":{type:ge,overloads:[[[ge,ge],function(a,u){var p=u[1];return u[0].evaluate(a)-p.evaluate(a)}],[[ge],function(a,u){return-u[0].evaluate(a)}]]},"/":[ge,[ge,ge],function(a,u){var p=u[1];return u[0].evaluate(a)/p.evaluate(a)}],"%":[ge,[ge,ge],function(a,u){var p=u[1];return u[0].evaluate(a)%p.evaluate(a)}],ln2:[ge,[],function(){return Math.LN2}],pi:[ge,[],function(){return Math.PI}],e:[ge,[],function(){return Math.E}],"^":[ge,[ge,ge],function(a,u){var p=u[1];return Math.pow(u[0].evaluate(a),p.evaluate(a))}],sqrt:[ge,[ge],function(a,u){return Math.sqrt(u[0].evaluate(a))}],log10:[ge,[ge],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN10}],ln:[ge,[ge],function(a,u){return Math.log(u[0].evaluate(a))}],log2:[ge,[ge],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN2}],sin:[ge,[ge],function(a,u){return Math.sin(u[0].evaluate(a))}],cos:[ge,[ge],function(a,u){return Math.cos(u[0].evaluate(a))}],tan:[ge,[ge],function(a,u){return Math.tan(u[0].evaluate(a))}],asin:[ge,[ge],function(a,u){return Math.asin(u[0].evaluate(a))}],acos:[ge,[ge],function(a,u){return Math.acos(u[0].evaluate(a))}],atan:[ge,[ge],function(a,u){return Math.atan(u[0].evaluate(a))}],min:[ge,Xa(ge),function(a,u){return Math.min.apply(Math,u.map(function(p){return p.evaluate(a)}))}],max:[ge,Xa(ge),function(a,u){return Math.max.apply(Math,u.map(function(p){return p.evaluate(a)}))}],abs:[ge,[ge],function(a,u){return Math.abs(u[0].evaluate(a))}],round:[ge,[ge],function(a,u){var p=u[0].evaluate(a);return p<0?-Math.round(-p):Math.round(p)}],floor:[ge,[ge],function(a,u){return Math.floor(u[0].evaluate(a))}],ceil:[ge,[ge],function(a,u){return Math.ceil(u[0].evaluate(a))}],"filter-==":[De,[Ve,si],function(a,u){var p=u[0],x=u[1];return a.properties()[p.value]===x.value}],"filter-id-==":[De,[si],function(a,u){var p=u[0];return a.id()===p.value}],"filter-type-==":[De,[Ve],function(a,u){var p=u[0];return a.geometryType()===p.value}],"filter-<":[De,[Ve,si],function(a,u){var p=u[0],x=u[1],T=a.properties()[p.value],M=x.value;return typeof T==typeof M&&T<M}],"filter-id-<":[De,[si],function(a,u){var p=u[0],x=a.id(),T=p.value;return typeof x==typeof T&&x<T}],"filter->":[De,[Ve,si],function(a,u){var p=u[0],x=u[1],T=a.properties()[p.value],M=x.value;return typeof T==typeof M&&T>M}],"filter-id->":[De,[si],function(a,u){var p=u[0],x=a.id(),T=p.value;return typeof x==typeof T&&x>T}],"filter-<=":[De,[Ve,si],function(a,u){var p=u[0],x=u[1],T=a.properties()[p.value],M=x.value;return typeof T==typeof M&&T<=M}],"filter-id-<=":[De,[si],function(a,u){var p=u[0],x=a.id(),T=p.value;return typeof x==typeof T&&x<=T}],"filter->=":[De,[Ve,si],function(a,u){var p=u[0],x=u[1],T=a.properties()[p.value],M=x.value;return typeof T==typeof M&&T>=M}],"filter-id->=":[De,[si],function(a,u){var p=u[0],x=a.id(),T=p.value;return typeof x==typeof T&&x>=T}],"filter-has":[De,[si],function(a,u){return u[0].value in a.properties()}],"filter-has-id":[De,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[De,[Ji(Ve)],function(a,u){return u[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[De,[Ji(si)],function(a,u){return u[0].value.indexOf(a.id())>=0}],"filter-in-small":[De,[Ve,Ji(si)],function(a,u){var p=u[0];return u[1].value.indexOf(a.properties()[p.value])>=0}],"filter-in-large":[De,[Ve,Ji(si)],function(a,u){var p=u[0],x=u[1];return(function(T,M,L,N){for(;L<=N;){var j=L+N>>1;if(M[j]===T)return!0;M[j]>T?N=j-1:L=j+1}return!1})(a.properties()[p.value],x.value,0,x.value.length-1)}],all:{type:De,overloads:[[[De,De],function(a,u){var p=u[1];return u[0].evaluate(a)&&p.evaluate(a)}],[Xa(De),function(a,u){for(var p=0,x=u;p<x.length;p+=1)if(!x[p].evaluate(a))return!1;return!0}]]},any:{type:De,overloads:[[[De,De],function(a,u){var p=u[1];return u[0].evaluate(a)||p.evaluate(a)}],[Xa(De),function(a,u){for(var p=0,x=u;p<x.length;p+=1)if(x[p].evaluate(a))return!0;return!1}]]},"!":[De,[De],function(a,u){return!u[0].evaluate(a)}],"is-supported-script":[De,[Ve],function(a,u){var p=a.globals&&a.globals.isSupportedScript;return!p||p(u[0].evaluate(a))}],upcase:[Ve,[Ve],function(a,u){return u[0].evaluate(a).toUpperCase()}],downcase:[Ve,[Ve],function(a,u){return u[0].evaluate(a).toLowerCase()}],concat:[Ve,Xa(si),function(a,u){return u.map(function(p){return Jo(p.evaluate(a))}).join("")}],"resolved-locale":[Ve,[rn],function(a,u){return u[0].evaluate(a).resolvedLocale()}]});var Go=function(a,u){this.expression=a,this._warningHistory={},this._evaluator=new yt,this._defaultValue=u?(function(p){return p.type==="color"&&Sl(p.default)?new sn(0,0,0,0):p.type==="color"?sn.parse(p.default)||null:p.default===void 0?null:p.default})(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function Rn(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ha}function mc(a,u){var p=new zo(Ha,[],u?(function(T){var M={color:Ze,string:Ve,number:ge,enum:Ve,boolean:De,formatted:hn,resolvedImage:Yi};return T.type==="array"?Ji(M[T.value]||si,T.length):M[T.type]})(u):void 0),x=p.parse(a,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?Tl(new Go(x,u)):qa(p.errors)}Go.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,T,M){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=x,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=M,this.expression.evaluate(this._evaluator)},Go.prototype.evaluate=function(a,u,p,x,T,M){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=x,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=M||null;try{var L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new fr("Expected value to be one of "+Object.keys(this._enumValues).map(function(N){return JSON.stringify(N)}).join(", ")+", but found "+JSON.stringify(L)+" instead.");return L}catch(N){return this._warningHistory[N.message]||(this._warningHistory[N.message]=!0,typeof console<"u"&&console.warn(N.message)),this._defaultValue}};var Ml=function(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!$o(u.expression)};Ml.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,T,M){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,x,T,M)},Ml.prototype.evaluate=function(a,u,p,x,T,M){return this._styleExpression.evaluate(a,u,p,x,T,M)};var Ka=function(a,u,p,x){this.kind=a,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!$o(u.expression),this.interpolationType=x};function kf(a,u){if((a=mc(a,u)).result==="error")return a;var p=a.value.expression,x=ya(p);if(!x&&!na(u))return qa([new Ie("","data expressions not supported")]);var T=Ga(p,["zoom"]);if(!T&&!hh(u))return qa([new Ie("","zoom expressions not supported")]);var M=(function L(N){var j=null;if(N instanceof ea)j=L(N.result);else if(N instanceof Bs)for(var Z=0,et=N.args;Z<et.length&&!(j=L(et[Z]));Z+=1);else(N instanceof ys||N instanceof Nr)&&N.input instanceof Dt&&N.input.name==="zoom"&&(j=N);return j instanceof Ie||N.eachChild(function(ot){var At=L(ot);At instanceof Ie?j=At:!j&&At?j=new Ie("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):j&&At&&j!==At&&(j=new Ie("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),j})(p);return M||T?M instanceof Ie?qa([M]):M instanceof Nr&&!Vo(u)?qa([new Ie("",'"interpolate" expressions cannot be used with this property')]):Tl(M?new Ka(x?"camera":"composite",a.value,M.labels,M instanceof Nr?M.interpolation:void 0):new Ml(x?"constant":"source",a.value)):qa([new Ie("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Ka.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,T,M){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,x,T,M)},Ka.prototype.evaluate=function(a,u,p,x,T,M){return this._styleExpression.evaluate(a,u,p,x,T,M)},Ka.prototype.interpolationFactor=function(a,u,p){return this.interpolationType?Nr.interpolationFactor(this.interpolationType,a,u,p):0};var Bl=function(a,u){this._parameters=a,this._specification=u,tt(this,(function p(x,T){var M,L,N,j=T.type==="color",Z=x.stops&&typeof x.stops[0][0]=="object",et=Z||!(Z||x.property!==void 0),ot=x.type||(Vo(T)?"exponential":"interval");if(j&&((x=tt({},x)).stops&&(x.stops=x.stops.map(function(li){return[li[0],sn.parse(li[1])]})),x.default=sn.parse(x.default?x.default:T.default)),x.colorSpace&&x.colorSpace!=="rgb"&&!Tf[x.colorSpace])throw new Error("Unknown color space: "+x.colorSpace);if(ot==="exponential")M=Ac;else if(ot==="interval")M=dh;else if(ot==="categorical"){M=fh,L=Object.create(null);for(var At=0,bt=x.stops;At<bt.length;At+=1){var Vt=bt[At];L[Vt[0]]=Vt[1]}N=typeof x.stops[0][0]}else{if(ot!=="identity")throw new Error('Unknown function type "'+ot+'"');M=Il}if(Z){for(var jt={},Qt=[],Zt=0;Zt<x.stops.length;Zt++){var re=x.stops[Zt],pe=re[0].zoom;jt[pe]===void 0&&(jt[pe]={zoom:pe,type:x.type,property:x.property,default:x.default,stops:[]},Qt.push(pe)),jt[pe].stops.push([re[0].value,re[1]])}for(var be=[],we=0,Ne=Qt;we<Ne.length;we+=1){var Je=Ne[we];be.push([jt[Je].zoom,p(jt[Je],T)])}var ri={name:"linear"};return{kind:"composite",interpolationType:ri,interpolationFactor:Nr.interpolationFactor.bind(void 0,ri),zoomStops:be.map(function(li){return li[0]}),evaluate:function(li,Li){var ui=li.zoom;return Ac({stops:be,base:x.base},T,ui).evaluate(ui,Li)}}}if(et){var Si=ot==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:Si,interpolationFactor:Nr.interpolationFactor.bind(void 0,Si),zoomStops:x.stops.map(function(li){return li[0]}),evaluate:function(li){return M(x,T,li.zoom,L,N)}}}return{kind:"source",evaluate:function(li,Li){var ui=Li&&Li.properties?Li.properties[x.property]:void 0;return ui===void 0?Pl(x.default,T.default):M(x,T,ui,L,N)}}})(this._parameters,this._specification))};function _o(a){var u=a.key,p=a.value,x=a.valueSpec||{},T=a.objectElementValidators||{},M=a.style,L=a.styleSpec,N=[],j=zn(p);if(j!=="object")return[new pt(u,p,"object expected, "+j+" found")];for(var Z in p){var et=Z.split(".")[0],ot=x[et]||x["*"],At=void 0;if(T[et])At=T[et];else if(x[et])At=qi;else if(T["*"])At=T["*"];else{if(!x["*"]){N.push(new pt(u,p[Z],'unknown property "'+Z+'"'));continue}At=qi}N=N.concat(At({key:(u&&u+".")+Z,value:p[Z],valueSpec:ot,style:M,styleSpec:L,object:p,objectKey:Z},p))}for(var bt in x)T[bt]||x[bt].required&&x[bt].default===void 0&&p[bt]===void 0&&N.push(new pt(u,p,'missing required property "'+bt+'"'));return N}function Of(a){var u=a.value,p=a.valueSpec,x=a.style,T=a.styleSpec,M=a.key,L=a.arrayElementValidator||qi;if(zn(u)!=="array")return[new pt(M,u,"array expected, "+zn(u)+" found")];if(p.length&&u.length!==p.length)return[new pt(M,u,"array length "+p.length+" expected, length "+u.length+" found")];if(p["min-length"]&&u.length<p["min-length"])return[new pt(M,u,"array length at least "+p["min-length"]+" expected, length "+u.length+" found")];var N={type:p.value,values:p.values};T.$version<7&&(N.function=p.function),zn(p.value)==="object"&&(N=p.value);for(var j=[],Z=0;Z<u.length;Z++)j=j.concat(L({array:u,arrayIndex:Z,value:u[Z],valueSpec:N,style:x,styleSpec:T,key:M+"["+Z+"]"}));return j}function vs(a){var u=a.key,p=a.value,x=a.valueSpec,T=zn(p);return T==="number"&&p!=p&&(T="NaN"),T!=="number"?[new pt(u,p,"number expected, "+T+" found")]:"minimum"in x&&p<x.minimum?[new pt(u,p,p+" is less than the minimum value "+x.minimum)]:"maximum"in x&&p>x.maximum?[new pt(u,p,p+" is greater than the maximum value "+x.maximum)]:[]}function gc(a){var u,p,x,T=a.valueSpec,M=Pe(a.value.type),L={},N=M!=="categorical"&&a.value.property===void 0,j=!N,Z=zn(a.value.stops)==="array"&&zn(a.value.stops[0])==="array"&&zn(a.value.stops[0][0])==="object",et=_o({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(bt){if(M==="identity")return[new pt(bt.key,bt.value,'identity function may not have a "stops" property')];var Vt=[],jt=bt.value;return Vt=Vt.concat(Of({key:bt.key,value:jt,valueSpec:bt.valueSpec,style:bt.style,styleSpec:bt.styleSpec,arrayElementValidator:ot})),zn(jt)==="array"&&jt.length===0&&Vt.push(new pt(bt.key,jt,"array must have at least one stop")),Vt},default:function(bt){return qi({key:bt.key,value:bt.value,valueSpec:T,style:bt.style,styleSpec:bt.styleSpec})}}});return M==="identity"&&N&&et.push(new pt(a.key,a.value,'missing required property "property"')),M==="identity"||a.value.stops||et.push(new pt(a.key,a.value,'missing required property "stops"')),M==="exponential"&&a.valueSpec.expression&&!Vo(a.valueSpec)&&et.push(new pt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(j&&!na(a.valueSpec)?et.push(new pt(a.key,a.value,"property functions not supported")):N&&!hh(a.valueSpec)&&et.push(new pt(a.key,a.value,"zoom functions not supported"))),M!=="categorical"&&!Z||a.value.property!==void 0||et.push(new pt(a.key,a.value,'"property" property is required')),et;function ot(bt){var Vt=[],jt=bt.value,Qt=bt.key;if(zn(jt)!=="array")return[new pt(Qt,jt,"array expected, "+zn(jt)+" found")];if(jt.length!==2)return[new pt(Qt,jt,"array length 2 expected, length "+jt.length+" found")];if(Z){if(zn(jt[0])!=="object")return[new pt(Qt,jt,"object expected, "+zn(jt[0])+" found")];if(jt[0].zoom===void 0)return[new pt(Qt,jt,"object stop key must have zoom")];if(jt[0].value===void 0)return[new pt(Qt,jt,"object stop key must have value")];if(x&&x>Pe(jt[0].zoom))return[new pt(Qt,jt[0].zoom,"stop zoom values must appear in ascending order")];Pe(jt[0].zoom)!==x&&(x=Pe(jt[0].zoom),p=void 0,L={}),Vt=Vt.concat(_o({key:Qt+"[0]",value:jt[0],valueSpec:{zoom:{}},style:bt.style,styleSpec:bt.styleSpec,objectElementValidators:{zoom:vs,value:At}}))}else Vt=Vt.concat(At({key:Qt+"[0]",value:jt[0],style:bt.style,styleSpec:bt.styleSpec},jt));return Rn(ne(jt[1]))?Vt.concat([new pt(Qt+"[1]",jt[1],"expressions are not allowed in function stops.")]):Vt.concat(qi({key:Qt+"[1]",value:jt[1],valueSpec:T,style:bt.style,styleSpec:bt.styleSpec}))}function At(bt,Vt){var jt=zn(bt.value),Qt=Pe(bt.value),Zt=bt.value!==null?bt.value:Vt;if(u){if(jt!==u)return[new pt(bt.key,Zt,jt+" stop domain type must match previous stop domain type "+u)]}else u=jt;if(jt!=="number"&&jt!=="string"&&jt!=="boolean")return[new pt(bt.key,Zt,"stop domain value must be a number, string, or boolean")];if(jt!=="number"&&M!=="categorical"){var re="number expected, "+jt+" found";return na(T)&&M===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pt(bt.key,Zt,re)]}return M!=="categorical"||jt!=="number"||isFinite(Qt)&&Math.floor(Qt)===Qt?M!=="categorical"&&jt==="number"&&p!==void 0&&Qt<p?[new pt(bt.key,Zt,"stop domain values must appear in ascending order")]:(p=Qt,M==="categorical"&&Qt in L?[new pt(bt.key,Zt,"stop domain values must be unique")]:(L[Qt]=!0,[])):[new pt(bt.key,Zt,"integer expected, found "+Qt)]}}function Ks(a){var u=(a.expressionContext==="property"?kf:mc)(ne(a.value),a.valueSpec);if(u.result==="error")return u.value.map(function(x){return new pt(""+a.key+x.key,a.value,x.message)});var p=u.value.expression||u.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!p.outputDefined())return[new pt(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!$o(p))return[new pt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!$o(p))return[new pt(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Ga(p,["zoom","feature-state"]))return[new pt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!ya(p))return[new pt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yu(a){var u=a.key,p=a.value,x=a.valueSpec,T=[];return Array.isArray(x.values)?x.values.indexOf(Pe(p))===-1&&T.push(new pt(u,p,"expected one of ["+x.values.join(", ")+"], "+JSON.stringify(p)+" found")):Object.keys(x.values).indexOf(Pe(p))===-1&&T.push(new pt(u,p,"expected one of ["+Object.keys(x.values).join(", ")+"], "+JSON.stringify(p)+" found")),T}function Rl(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var u=0,p=a.slice(1);u<p.length;u+=1){var x=p[u];if(!Rl(x)&&typeof x!="boolean")return!1}return!0;default:return!0}}Bl.deserialize=function(a){return new Bl(a._parameters,a._specification)},Bl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var ph={type:"boolean",default:!1};function _s(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};Rl(a)||(a=Ll(a));var u=mc(a,ph);if(u.result==="error")throw new Error(u.value.map(function(p){return p.key+": "+p.message}).join(", "));return{filter:function(p,x,T){return u.value.evaluate(p,x,{},T)},needGeometry:(function p(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(var T=1;T<x.length;T++)if(p(x[T]))return!0;return!1})(a)}}function Ah(a,u){return a<u?-1:a>u?1:0}function Ll(a){if(!a)return!0;var u,p=a[0];return a.length<=1?p!=="any":p==="=="?xa(a[1],a[2],"=="):p==="!="?yc(xa(a[1],a[2],"==")):p==="<"||p===">"||p==="<="||p===">="?xa(a[1],a[2],p):p==="any"?(u=a.slice(1),["any"].concat(u.map(Ll))):p==="all"?["all"].concat(a.slice(1).map(Ll)):p==="none"?["all"].concat(a.slice(1).map(Ll).map(yc)):p==="in"?wa(a[1],a.slice(2)):p==="!in"?yc(wa(a[1],a.slice(2))):p==="has"?Za(a[1]):p==="!has"?yc(Za(a[1])):p!=="within"||a}function xa(a,u,p){switch(a){case"$type":return["filter-type-"+p,u];case"$id":return["filter-id-"+p,u];default:return["filter-"+p,a,u]}}function wa(a,u){if(u.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(p){return typeof p!=typeof u[0]})?["filter-in-large",a,["literal",u.sort(Ah)]]:["filter-in-small",a,["literal",u]]}}function Za(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function yc(a){return["!",a]}function vc(a){return Rl(ne(a.value))?Ks(tt({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):(function u(p){var x=p.value,T=p.key;if(zn(x)!=="array")return[new pt(T,x,"array expected, "+zn(x)+" found")];var M,L=p.styleSpec,N=[];if(x.length<1)return[new pt(T,x,"filter array must have at least 1 element")];switch(N=N.concat(yu({key:T+"[0]",value:x[0],valueSpec:L.filter_operator,style:p.style,styleSpec:p.styleSpec})),Pe(x[0])){case"<":case"<=":case">":case">=":x.length>=2&&Pe(x[1])==="$type"&&N.push(new pt(T,x,'"$type" cannot be use with operator "'+x[0]+'"'));case"==":case"!=":x.length!==3&&N.push(new pt(T,x,'filter array for operator "'+x[0]+'" must have 3 elements'));case"in":case"!in":x.length>=2&&(M=zn(x[1]))!=="string"&&N.push(new pt(T+"[1]",x[1],"string expected, "+M+" found"));for(var j=2;j<x.length;j++)M=zn(x[j]),Pe(x[1])==="$type"?N=N.concat(yu({key:T+"["+j+"]",value:x[j],valueSpec:L.geometry_type,style:p.style,styleSpec:p.styleSpec})):M!=="string"&&M!=="number"&&M!=="boolean"&&N.push(new pt(T+"["+j+"]",x[j],"string, number, or boolean expected, "+M+" found"));break;case"any":case"all":case"none":for(var Z=1;Z<x.length;Z++)N=N.concat(u({key:T+"["+Z+"]",value:x[Z],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":M=zn(x[1]),x.length!==2?N.push(new pt(T,x,'filter array for "'+x[0]+'" operator must have 2 elements')):M!=="string"&&N.push(new pt(T+"[1]",x[1],"string expected, "+M+" found"));break;case"within":M=zn(x[1]),x.length!==2?N.push(new pt(T,x,'filter array for "'+x[0]+'" operator must have 2 elements')):M!=="object"&&N.push(new pt(T+"[1]",x[1],"object expected, "+M+" found"))}return N})(a)}function mh(a,u){var p=a.key,x=a.style,T=a.styleSpec,M=a.value,L=a.objectKey,N=T[u+"_"+a.layerType];if(!N)return[];var j=L.match(/^(.*)-transition$/);if(u==="paint"&&j&&N[j[1]]&&N[j[1]].transition)return qi({key:p,value:M,valueSpec:T.transition,style:x,styleSpec:T});var Z,et=a.valueSpec||N[L];if(!et)return[new pt(p,M,'unknown property "'+L+'"')];if(zn(M)==="string"&&na(et)&&!et.tokens&&(Z=/^{([^}]+)}$/.exec(M)))return[new pt(p,M,'"'+L+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Z[1])+" }`.")];var ot=[];return a.layerType==="symbol"&&(L==="text-field"&&x&&!x.glyphs&&ot.push(new pt(p,M,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&Sl(ne(M))&&Pe(M.type)==="identity"&&ot.push(new pt(p,M,'"text-font" does not support identity functions'))),ot.concat(qi({key:a.key,value:M,valueSpec:et,style:x,styleSpec:T,expressionContext:"property",propertyType:u,propertyKey:L}))}function vu(a){return mh(a,"paint")}function _u(a){return mh(a,"layout")}function Ff(a){var u=[],p=a.value,x=a.key,T=a.style,M=a.styleSpec;p.type||p.ref||u.push(new pt(x,p,'either "type" or "ref" is required'));var L,N=Pe(p.type),j=Pe(p.ref);if(p.id)for(var Z=Pe(p.id),et=0;et<a.arrayIndex;et++){var ot=T.layers[et];Pe(ot.id)===Z&&u.push(new pt(x,p.id,'duplicate layer id "'+p.id+'", previously used at line '+ot.id.__line__))}if("ref"in p)["type","source","source-layer","filter","layout"].forEach(function(Vt){Vt in p&&u.push(new pt(x,p[Vt],'"'+Vt+'" is prohibited for ref layers'))}),T.layers.forEach(function(Vt){Pe(Vt.id)===j&&(L=Vt)}),L?L.ref?u.push(new pt(x,p.ref,"ref cannot reference another ref layer")):N=Pe(L.type):u.push(new pt(x,p.ref,'ref layer "'+j+'" not found'));else if(N!=="background")if(p.source){var At=T.sources&&T.sources[p.source],bt=At&&Pe(At.type);At?bt==="vector"&&N==="raster"?u.push(new pt(x,p.source,'layer "'+p.id+'" requires a raster source')):bt==="raster"&&N!=="raster"?u.push(new pt(x,p.source,'layer "'+p.id+'" requires a vector source')):bt!=="vector"||p["source-layer"]?bt==="raster-dem"&&N!=="hillshade"?u.push(new pt(x,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="line"||!p.paint||!p.paint["line-gradient"]||bt==="geojson"&&At.lineMetrics||u.push(new pt(x,p,'layer "'+p.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new pt(x,p,'layer "'+p.id+'" must specify a "source-layer"')):u.push(new pt(x,p.source,'source "'+p.source+'" not found'))}else u.push(new pt(x,p,'missing required property "source"'));return u=u.concat(_o({key:x,value:p,valueSpec:M.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return qi({key:x+".type",value:p.type,valueSpec:M.layer.type,style:a.style,styleSpec:a.styleSpec,object:p,objectKey:"type"})},filter:vc,layout:function(Vt){return _o({layer:p,key:Vt.key,value:Vt.value,style:Vt.style,styleSpec:Vt.styleSpec,objectElementValidators:{"*":function(jt){return _u(tt({layerType:N},jt))}}})},paint:function(Vt){return _o({layer:p,key:Vt.key,value:Vt.value,style:Vt.style,styleSpec:Vt.styleSpec,objectElementValidators:{"*":function(jt){return vu(tt({layerType:N},jt))}}})}}}))}function ra(a){var u=a.value,p=a.key,x=zn(u);return x!=="string"?[new pt(p,u,"string expected, "+x+" found")]:[]}var Wn={promoteId:function(a){var u=a.key,p=a.value;if(zn(p)==="string")return ra({key:u,value:p});var x=[];for(var T in p)x.push.apply(x,ra({key:u+"."+T,value:p[T]}));return x}};function Dl(a){var u=a.value,p=a.key,x=a.styleSpec,T=a.style;if(!u.type)return[new pt(p,u,'"type" is required')];var M,L=Pe(u.type);switch(L){case"vector":case"raster":case"raster-dem":return _o({key:p,value:u,valueSpec:x["source_"+L.replace("-","_")],style:a.style,styleSpec:x,objectElementValidators:Wn});case"geojson":if(M=_o({key:p,value:u,valueSpec:x.source_geojson,style:T,styleSpec:x,objectElementValidators:Wn}),u.cluster)for(var N in u.clusterProperties){var j=u.clusterProperties[N],Z=j[0],et=typeof Z=="string"?[Z,["accumulated"],["get",N]]:Z;M.push.apply(M,Ks({key:p+"."+N+".map",value:j[1],expressionContext:"cluster-map"})),M.push.apply(M,Ks({key:p+"."+N+".reduce",value:et,expressionContext:"cluster-reduce"}))}return M;case"video":return _o({key:p,value:u,valueSpec:x.source_video,style:T,styleSpec:x});case"image":return _o({key:p,value:u,valueSpec:x.source_image,style:T,styleSpec:x});case"canvas":return[new pt(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yu({key:p+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function bo(a){var u=a.value,p=a.styleSpec,x=p.light,T=a.style,M=[],L=zn(u);if(u===void 0)return M;if(L!=="object")return M.concat([new pt("light",u,"object expected, "+L+" found")]);for(var N in u){var j=N.match(/^(.*)-transition$/);M=M.concat(j&&x[j[1]]&&x[j[1]].transition?qi({key:N,value:u[N],valueSpec:p.transition,style:T,styleSpec:p}):x[N]?qi({key:N,value:u[N],valueSpec:x[N],style:T,styleSpec:p}):[new pt(N,u[N],'unknown property "'+N+'"')])}return M}var Zs={"*":function(){return[]},array:Of,boolean:function(a){var u=a.value,p=a.key,x=zn(u);return x!=="boolean"?[new pt(p,u,"boolean expected, "+x+" found")]:[]},number:vs,color:function(a){var u=a.key,p=a.value,x=zn(p);return x!=="string"?[new pt(u,p,"color expected, "+x+" found")]:ti(p)===null?[new pt(u,p,'color expected, "'+p+'" found')]:[]},constants:d,enum:yu,filter:vc,function:gc,layer:Ff,object:_o,source:Dl,light:bo,string:ra,formatted:function(a){return ra(a).length===0?[]:Ks(a)},resolvedImage:function(a){return ra(a).length===0?[]:Ks(a)}};function qi(a){var u=a.value,p=a.valueSpec,x=a.styleSpec;return p.expression&&Sl(Pe(u))?gc(a):p.expression&&Rn(ne(u))?Ks(a):p.type&&Zs[p.type]?Zs[p.type](a):_o(tt({},a,{valueSpec:p.type?x[p.type]:p}))}function Un(a){var u=a.value,p=a.key,x=ra(a);return x.length||(u.indexOf("{fontstack}")===-1&&x.push(new pt(p,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&x.push(new pt(p,u,'"glyphs" url must include a "{range}" token'))),x}function ns(a,u){u===void 0&&(u=lt);var p=[];return p=p.concat(qi({key:"",value:a,valueSpec:u.$root,styleSpec:u,style:a,objectElementValidators:{glyphs:Un,"*":function(){return[]}}})),a.constants&&(p=p.concat(d({key:"constants",value:a.constants}))),bu(p)}function bu(a){return[].concat(a).sort(function(u,p){return u.line-p.line})}function kl(a){return function(){for(var u=[],p=arguments.length;p--;)u[p]=arguments[p];return bu(a.apply(this,u))}}ns.source=kl(Dl),ns.light=kl(bo),ns.layer=kl(Ff),ns.filter=kl(vc),ns.paintProperty=kl(vu),ns.layoutProperty=kl(_u);var xu=ns,Nf=xu.light,Wp=xu.paintProperty,wu=xu.layoutProperty;function Eu(a,u){var p=!1;if(u&&u.length)for(var x=0,T=u;x<T.length;x+=1)a.fire(new mt(new Error(T[x].message))),p=!0;return p}var ao=xr;function xr(a,u,p){var x=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var T=new Int32Array(this.arrayBuffer);a=T[0],this.d=(u=T[1])+2*(p=T[2]);for(var M=0;M<this.d*this.d;M++){var L=T[3+M],N=T[3+M+1];x.push(L===N?null:T.subarray(L,N))}var j=T[3+x.length+1];this.keys=T.subarray(T[3+x.length],j),this.bboxes=T.subarray(j),this.insert=this._insertReadonly}else{this.d=u+2*p;for(var Z=0;Z<this.d*this.d;Z++)x.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=p,this.scale=u/a,this.uid=0;var et=p/u*a;this.min=-et,this.max=a+et}xr.prototype.insert=function(a,u,p,x,T){this._forEachCell(u,p,x,T,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(T)},xr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xr.prototype._insertCell=function(a,u,p,x,T,M){this.cells[T].push(M)},xr.prototype.query=function(a,u,p,x,T){var M=this.min,L=this.max;if(a<=M&&u<=M&&L<=p&&L<=x&&!T)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(a,u,p,x,this._queryCell,N,{},T),N},xr.prototype._queryCell=function(a,u,p,x,T,M,L,N){var j=this.cells[T];if(j!==null)for(var Z=this.keys,et=this.bboxes,ot=0;ot<j.length;ot++){var At=j[ot];if(L[At]===void 0){var bt=4*At;(N?N(et[bt+0],et[bt+1],et[bt+2],et[bt+3]):a<=et[bt+2]&&u<=et[bt+3]&&p>=et[bt+0]&&x>=et[bt+1])?(L[At]=!0,M.push(Z[At])):L[At]=!1}}},xr.prototype._forEachCell=function(a,u,p,x,T,M,L,N){for(var j=this._convertToCellCoord(a),Z=this._convertToCellCoord(u),et=this._convertToCellCoord(p),ot=this._convertToCellCoord(x),At=j;At<=et;At++)for(var bt=Z;bt<=ot;bt++){var Vt=this.d*bt+At;if((!N||N(this._convertFromCellCoord(At),this._convertFromCellCoord(bt),this._convertFromCellCoord(At+1),this._convertFromCellCoord(bt+1)))&&T.call(this,a,u,p,x,Vt,M,L,N))return}},xr.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},xr.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},xr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=3+this.cells.length+1+1,p=0,x=0;x<this.cells.length;x++)p+=this.cells[x].length;var T=new Int32Array(u+p+this.keys.length+this.bboxes.length);T[0]=this.extent,T[1]=this.n,T[2]=this.padding;for(var M=u,L=0;L<a.length;L++){var N=a[L];T[3+L]=M,T.set(N,M),M+=N.length}return T[3+a.length]=M,T.set(this.keys,M),T[3+a.length+1]=M+=this.keys.length,T.set(this.bboxes,M),M+=this.bboxes.length,T.buffer};var Ya=I.ImageData,zf=I.ImageBitmap,wr={};function ci(a,u,p){p===void 0&&(p={}),Object.defineProperty(u,"_classRegistryKey",{value:a,writeable:!1}),wr[a]={klass:u,omit:p.omit||[],shallow:p.shallow||[]}}for(var Ds in ci("Object",Object),ao.serialize=function(a,u){var p=a.toArrayBuffer();return u&&u.push(p),{buffer:p}},ao.deserialize=function(a){return new ao(a.buffer)},ci("Grid",ao),ci("Color",sn),ci("Error",Error),ci("ResolvedImage",Kn),ci("StylePropertyFunction",Bl),ci("StyleExpression",Go,{omit:["_evaluator"]}),ci("ZoomDependentExpression",Ka),ci("ZoomConstantExpression",Ml),ci("CompoundExpression",Dt,{omit:["_evaluate"]}),Ha)Ha[Ds]._classRegistryKey||ci("Expression_"+Ds,Ha[Ds]);function _c(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ol(a){return zf&&a instanceof zf}function xo(a,u){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(_c(a)||Ol(a))return u&&u.push(a),a;if(ArrayBuffer.isView(a)){var p=a;return u&&u.push(p.buffer),p}if(a instanceof Ya)return u&&u.push(a.data.buffer),a;if(Array.isArray(a)){for(var x=[],T=0,M=a;T<M.length;T+=1)x.push(xo(M[T],u));return x}if(typeof a=="object"){var L=a.constructor,N=L._classRegistryKey;if(!N)throw new Error("can't serialize object of unregistered class");var j=L.serialize?L.serialize(a,u):{};if(!L.serialize){for(var Z in a)if(a.hasOwnProperty(Z)&&!(wr[N].omit.indexOf(Z)>=0)){var et=a[Z];j[Z]=wr[N].shallow.indexOf(Z)>=0?et:xo(et,u)}a instanceof Error&&(j.message=a.message)}if(j.$name)throw new Error("$name property is reserved for worker serialization logic.");return N!=="Object"&&(j.$name=N),j}throw new Error("can't serialize object of type "+typeof a)}function bs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||_c(a)||Ol(a)||ArrayBuffer.isView(a)||a instanceof Ya)return a;if(Array.isArray(a))return a.map(bs);if(typeof a=="object"){var u=a.$name||"Object",p=wr[u].klass;if(!p)throw new Error("can't deserialize unregistered class "+u);if(p.deserialize)return p.deserialize(a);for(var x=Object.create(p.prototype),T=0,M=Object.keys(a);T<M.length;T+=1){var L=M[T];if(L!=="$name"){var N=a[L];x[L]=wr[u].shallow.indexOf(L)>=0?N:bs(N)}}return x}throw new Error("can't deserialize object of type "+typeof a)}var gh=function(){this.first=!0};gh.prototype.update=function(a,u){var p=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=p,!0))};var ni={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function wo(a){for(var u=0,p=a;u<p.length;u+=1)if(Cu(p[u].charCodeAt(0)))return!0;return!1}function Cu(a){return!(a!==746&&a!==747&&(a<4352||!(ni["Bopomofo Extended"](a)||ni.Bopomofo(a)||ni["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||ni["CJK Compatibility Ideographs"](a)||ni["CJK Compatibility"](a)||ni["CJK Radicals Supplement"](a)||ni["CJK Strokes"](a)||!(!ni["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||ni["CJK Unified Ideographs Extension A"](a)||ni["CJK Unified Ideographs"](a)||ni["Enclosed CJK Letters and Months"](a)||ni["Hangul Compatibility Jamo"](a)||ni["Hangul Jamo Extended-A"](a)||ni["Hangul Jamo Extended-B"](a)||ni["Hangul Jamo"](a)||ni["Hangul Syllables"](a)||ni.Hiragana(a)||ni["Ideographic Description Characters"](a)||ni.Kanbun(a)||ni["Kangxi Radicals"](a)||ni["Katakana Phonetic Extensions"](a)||ni.Katakana(a)&&a!==12540||!(!ni["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!ni["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||ni["Unified Canadian Aboriginal Syllabics"](a)||ni["Unified Canadian Aboriginal Syllabics Extended"](a)||ni["Vertical Forms"](a)||ni["Yijing Hexagram Symbols"](a)||ni["Yi Syllables"](a)||ni["Yi Radicals"](a))))}function yh(a){return!(Cu(a)||(function(u){return!!(ni["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||ni["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||ni["Letterlike Symbols"](u)||ni["Number Forms"](u)||ni["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||ni["Control Pictures"](u)&&u!==9251||ni["Optical Character Recognition"](u)||ni["Enclosed Alphanumerics"](u)||ni["Geometric Shapes"](u)||ni["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||ni["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||ni["CJK Symbols and Punctuation"](u)||ni.Katakana(u)||ni["Private Use Area"](u)||ni["CJK Compatibility Forms"](u)||ni["Small Form Variants"](u)||ni["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)})(a))}function lo(a){return a>=1424&&a<=2303||ni["Arabic Presentation Forms-A"](a)||ni["Arabic Presentation Forms-B"](a)}function ks(a,u){return!(!u&&lo(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||ni.Khmer(a))}function bc(a){for(var u=0,p=a;u<p.length;u+=1)if(lo(p[u].charCodeAt(0)))return!0;return!1}var xc=null,Sr="unavailable",Eo=null,Uf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Sr="error"),xc&&xc(a)};function Ea(){wc.fire(new Nt("pluginStateChange",{pluginStatus:Sr,pluginURL:Eo}))}var wc=new wt,vh=function(){return Sr},Co=function(){if(Sr!=="deferred"||!Eo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Sr="loading",Ea(),Eo&&ee({url:Eo},function(a){a?Uf(a):(Sr="loaded",Ea())})},rs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Sr==="loaded"||rs.applyArabicShaping!=null},isLoading:function(){return Sr==="loading"},setState:function(a){Sr=a.pluginStatus,Eo=a.pluginURL},isParsed:function(){return rs.applyArabicShaping!=null&&rs.processBidirectionalText!=null&&rs.processStyledBidirectionalText!=null},getPluginURL:function(){return Eo}},un=function(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new gh,this.transition={})};un.prototype.isSupportedScript=function(a){return(function(u,p){for(var x=0,T=u;x<T.length;x+=1)if(!ks(T[x].charCodeAt(0),p))return!1;return!0})(a,rs.isLoaded())},un.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},un.prototype.getCrossfadeParameters=function(){var a=this.zoom,u=a-Math.floor(a),p=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*u}};var Os=function(a,u){this.property=a,this.value=u,this.expression=(function(p,x){if(Sl(p))return new Bl(p,x);if(Rn(p)){var T=kf(p,x);if(T.result==="error")throw new Error(T.value.map(function(L){return L.key+": "+L.message}).join(", "));return T.value}var M=p;return typeof p=="string"&&x.type==="color"&&(M=sn.parse(p)),{kind:"constant",evaluate:function(){return M}}})(u===void 0?a.specification.default:u,a.specification)};Os.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Os.prototype.possiblyEvaluate=function(a,u,p){return this.property.possiblyEvaluate(this,a,u,p)};var Fs=function(a){this.property=a,this.value=new Os(a,void 0)};Fs.prototype.transitioned=function(a,u){return new Ca(this.property,this.value,u,$({},a.transition,this.transition),a.now)},Fs.prototype.untransitioned=function(){return new Ca(this.property,this.value,null,{},0)};var Dr=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Dr.prototype.getValue=function(a){return Ut(this._values[a].value.value)},Dr.prototype.setValue=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new Fs(this._values[a].property)),this._values[a].value=new Os(this._values[a].property,u===null?void 0:Ut(u))},Dr.prototype.getTransition=function(a){return Ut(this._values[a].transition)},Dr.prototype.setTransition=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new Fs(this._values[a].property)),this._values[a].transition=Ut(u)||void 0},Dr.prototype.serialize=function(){for(var a={},u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u],T=this.getValue(x);T!==void 0&&(a[x]=T);var M=this.getTransition(x);M!==void 0&&(a[x+"-transition"]=M)}return a},Dr.prototype.transitioned=function(a,u){for(var p=new To(this._properties),x=0,T=Object.keys(this._values);x<T.length;x+=1){var M=T[x];p._values[M]=this._values[M].transitioned(a,u._values[M])}return p},Dr.prototype.untransitioned=function(){for(var a=new To(this._properties),u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u];a._values[x]=this._values[x].untransitioned()}return a};var Ca=function(a,u,p,x,T){this.property=a,this.value=u,this.begin=T+x.delay||0,this.end=this.begin+x.duration||0,a.specification.transition&&(x.delay||x.duration)&&(this.prior=p)};Ca.prototype.possiblyEvaluate=function(a,u,p){var x=a.now||0,T=this.value.possiblyEvaluate(a,u,p),M=this.prior;if(M){if(x>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(x<this.begin)return M.possiblyEvaluate(a,u,p);var L=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(M.possiblyEvaluate(a,u,p),T,(function(N){if(N<=0)return 0;if(N>=1)return 1;var j=N*N,Z=j*N;return 4*(N<.5?Z:3*(N-j)+Z-.75)})(L))}return T};var To=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};To.prototype.possiblyEvaluate=function(a,u,p){for(var x=new Tu(this._properties),T=0,M=Object.keys(this._values);T<M.length;T+=1){var L=M[T];x._values[L]=this._values[L].possiblyEvaluate(a,u,p)}return x},To.prototype.hasTransition=function(){for(var a=0,u=Object.keys(this._values);a<u.length;a+=1)if(this._values[u[a]].prior)return!0;return!1};var uo=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};uo.prototype.getValue=function(a){return Ut(this._values[a].value)},uo.prototype.setValue=function(a,u){this._values[a]=new Os(this._values[a].property,u===null?void 0:Ut(u))},uo.prototype.serialize=function(){for(var a={},u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u],T=this.getValue(x);T!==void 0&&(a[x]=T)}return a},uo.prototype.possiblyEvaluate=function(a,u,p){for(var x=new Tu(this._properties),T=0,M=Object.keys(this._values);T<M.length;T+=1){var L=M[T];x._values[L]=this._values[L].possiblyEvaluate(a,u,p)}return x};var us=function(a,u,p){this.property=a,this.value=u,this.parameters=p};us.prototype.isConstant=function(){return this.value.kind==="constant"},us.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},us.prototype.evaluate=function(a,u,p,x){return this.property.evaluate(this.value,this.parameters,a,u,p,x)};var Tu=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};Tu.prototype.get=function(a){return this._values[a]};var Ii=function(a){this.specification=a};Ii.prototype.possiblyEvaluate=function(a,u){return a.expression.evaluate(u)},Ii.prototype.interpolate=function(a,u,p){var x=ja[this.specification.type];return x?x(a,u,p):a};var pi=function(a,u){this.specification=a,this.overrides=u};pi.prototype.possiblyEvaluate=function(a,u,p,x){return new us(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},p,x)}:a.expression,u)},pi.prototype.interpolate=function(a,u,p){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new us(this,{kind:"constant",value:void 0},a.parameters);var x=ja[this.specification.type];return x?new us(this,{kind:"constant",value:x(a.value.value,u.value.value,p)},a.parameters):a},pi.prototype.evaluate=function(a,u,p,x,T,M){return a.kind==="constant"?a.value:a.evaluate(u,p,x,T,M)};var Ec=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(p,x,T,M){if(p.value===void 0)return new us(this,{kind:"constant",value:void 0},x);if(p.expression.kind==="constant"){var L=p.expression.evaluate(x,null,{},T,M),N=p.property.specification.type==="resolvedImage"&&typeof L!="string"?L.name:L,j=this._calculate(N,N,N,x);return new us(this,{kind:"constant",value:j},x)}if(p.expression.kind==="camera"){var Z=this._calculate(p.expression.evaluate({zoom:x.zoom-1}),p.expression.evaluate({zoom:x.zoom}),p.expression.evaluate({zoom:x.zoom+1}),x);return new us(this,{kind:"constant",value:Z},x)}return new us(this,p.expression,x)},u.prototype.evaluate=function(p,x,T,M,L,N){if(p.kind==="source"){var j=p.evaluate(x,T,M,L,N);return this._calculate(j,j,j,x)}return p.kind==="composite"?this._calculate(p.evaluate({zoom:Math.floor(x.zoom)-1},T,M),p.evaluate({zoom:Math.floor(x.zoom)},T,M),p.evaluate({zoom:Math.floor(x.zoom)+1},T,M),x):p.value},u.prototype._calculate=function(p,x,T,M){return M.zoom>M.zoomHistory.lastIntegerZoom?{from:p,to:x}:{from:T,to:x}},u.prototype.interpolate=function(p){return p},u})(pi),cs=function(a){this.specification=a};cs.prototype.possiblyEvaluate=function(a,u,p,x){if(a.value!==void 0){if(a.expression.kind==="constant"){var T=a.expression.evaluate(u,null,{},p,x);return this._calculate(T,T,T,u)}return this._calculate(a.expression.evaluate(new un(Math.floor(u.zoom-1),u)),a.expression.evaluate(new un(Math.floor(u.zoom),u)),a.expression.evaluate(new un(Math.floor(u.zoom+1),u)),u)}},cs.prototype._calculate=function(a,u,p,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:p,to:u}},cs.prototype.interpolate=function(a){return a};var So=function(a){this.specification=a};So.prototype.possiblyEvaluate=function(a,u,p,x){return!!a.expression.evaluate(u,null,{},p,x)},So.prototype.interpolate=function(){return!1};var Kr=function(a){for(var u in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var p=a[u];p.specification.overridable&&this.overridableProperties.push(u);var x=this.defaultPropertyValues[u]=new Os(p,void 0),T=this.defaultTransitionablePropertyValues[u]=new Fs(p);this.defaultTransitioningPropertyValues[u]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=x.possiblyEvaluate({})}};ci("DataDrivenProperty",pi),ci("DataConstantProperty",Ii),ci("CrossFadedDataDrivenProperty",Ec),ci("CrossFadedProperty",cs),ci("ColorRampProperty",So);var jo=(function(a){function u(p,x){if(a.call(this),this.id=p.id,this.type=p.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},p.type!=="custom"&&(this.metadata=(p=p).metadata,this.minzoom=p.minzoom,this.maxzoom=p.maxzoom,p.type!=="background"&&(this.source=p.source,this.sourceLayer=p["source-layer"],this.filter=p.filter),x.layout&&(this._unevaluatedLayout=new uo(x.layout)),x.paint)){for(var T in this._transitionablePaint=new Dr(x.paint),p.paint)this.setPaintProperty(T,p.paint[T],{validate:!1});for(var M in p.layout)this.setLayoutProperty(M,p.layout[M],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Tu(x.paint)}}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(p){return p==="visibility"?this.visibility:this._unevaluatedLayout.getValue(p)},u.prototype.setLayoutProperty=function(p,x,T){T===void 0&&(T={}),x!=null&&this._validate(wu,"layers."+this.id+".layout."+p,p,x,T)||(p!=="visibility"?this._unevaluatedLayout.setValue(p,x):this.visibility=x)},u.prototype.getPaintProperty=function(p){return Kt(p,"-transition")?this._transitionablePaint.getTransition(p.slice(0,-11)):this._transitionablePaint.getValue(p)},u.prototype.setPaintProperty=function(p,x,T){if(T===void 0&&(T={}),x!=null&&this._validate(Wp,"layers."+this.id+".paint."+p,p,x,T))return!1;if(Kt(p,"-transition"))return this._transitionablePaint.setTransition(p.slice(0,-11),x||void 0),!1;var M=this._transitionablePaint._values[p],L=M.property.specification["property-type"]==="cross-faded-data-driven",N=M.value.isDataDriven(),j=M.value;this._transitionablePaint.setValue(p,x),this._handleSpecialPaintPropertyUpdate(p);var Z=this._transitionablePaint._values[p].value;return Z.isDataDriven()||N||L||this._handleOverridablePaintPropertyUpdate(p,j,Z)},u.prototype._handleSpecialPaintPropertyUpdate=function(p){},u.prototype._handleOverridablePaintPropertyUpdate=function(p,x,T){return!1},u.prototype.isHidden=function(p){return!!(this.minzoom&&p<this.minzoom)||!!(this.maxzoom&&p>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(p){this._transitioningPaint=this._transitionablePaint.transitioned(p,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(p,x){p.getCrossfadeParameters&&(this._crossfadeParameters=p.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(p,void 0,x)),this.paint=this._transitioningPaint.possiblyEvaluate(p,void 0,x)},u.prototype.serialize=function(){var p={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(p.layout=p.layout||{},p.layout.visibility=this.visibility),st(p,function(x,T){return!(x===void 0||T==="layout"&&!Object.keys(x).length||T==="paint"&&!Object.keys(x).length)})},u.prototype._validate=function(p,x,T,M,L){return L===void 0&&(L={}),(!L||L.validate!==!1)&&Eu(this,p.call(xu,{key:x,layerType:this.type,objectKey:T,value:M,styleSpec:lt,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var p in this.paint._values){var x=this.paint.get(p);if(x instanceof us&&na(x.property.specification)&&(x.value.kind==="source"||x.value.kind==="composite")&&x.value.isStateDependent)return!0}return!1},u})(wt),Cc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Su=function(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ki=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function zr(a,u){u===void 0&&(u=1);var p=0,x=0;return{members:a.map(function(T){var M=Cc[T.type].BYTES_PER_ELEMENT,L=p=Vf(p,Math.max(u,M)),N=T.components||1;return x=Math.max(x,M),p+=M*N,{name:T.name,type:T.type,components:N,offset:L}}),size:Vf(p,Math.max(x,u)),alignment:u}}function Vf(a,u){return Math.ceil(a/u)*u}Ki.serialize=function(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Ki.deserialize=function(a){var u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},Ki.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ki.prototype.clear=function(){this.length=0},Ki.prototype.resize=function(a){this.reserve(a),this.length=a},Ki.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},Ki.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Po=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var T=this.length;return this.resize(T+1),this.emplace(T,p,x)},u.prototype.emplace=function(p,x,T){var M=2*p;return this.int16[M+0]=x,this.int16[M+1]=T,p},u})(Ki);Po.prototype.bytesPerElement=4,ci("StructArrayLayout2i4",Po);var Ns=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M){var L=this.length;return this.resize(L+1),this.emplace(L,p,x,T,M)},u.prototype.emplace=function(p,x,T,M,L){var N=4*p;return this.int16[N+0]=x,this.int16[N+1]=T,this.int16[N+2]=M,this.int16[N+3]=L,p},u})(Ki);Ns.prototype.bytesPerElement=8,ci("StructArrayLayout4i8",Ns);var sa=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M,L,N){var j=this.length;return this.resize(j+1),this.emplace(j,p,x,T,M,L,N)},u.prototype.emplace=function(p,x,T,M,L,N,j){var Z=6*p;return this.int16[Z+0]=x,this.int16[Z+1]=T,this.int16[Z+2]=M,this.int16[Z+3]=L,this.int16[Z+4]=N,this.int16[Z+5]=j,p},u})(Ki);sa.prototype.bytesPerElement=12,ci("StructArrayLayout2i4i12",sa);var zs=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M,L,N){var j=this.length;return this.resize(j+1),this.emplace(j,p,x,T,M,L,N)},u.prototype.emplace=function(p,x,T,M,L,N,j){var Z=4*p,et=8*p;return this.int16[Z+0]=x,this.int16[Z+1]=T,this.uint8[et+4]=M,this.uint8[et+5]=L,this.uint8[et+6]=N,this.uint8[et+7]=j,p},u})(Ki);zs.prototype.bytesPerElement=8,ci("StructArrayLayout2i4ub8",zs);var Fl=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var T=this.length;return this.resize(T+1),this.emplace(T,p,x)},u.prototype.emplace=function(p,x,T){var M=2*p;return this.float32[M+0]=x,this.float32[M+1]=T,p},u})(Ki);Fl.prototype.bytesPerElement=8,ci("StructArrayLayout2f8",Fl);var Io=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M,L,N,j,Z,et,ot){var At=this.length;return this.resize(At+1),this.emplace(At,p,x,T,M,L,N,j,Z,et,ot)},u.prototype.emplace=function(p,x,T,M,L,N,j,Z,et,ot,At){var bt=10*p;return this.uint16[bt+0]=x,this.uint16[bt+1]=T,this.uint16[bt+2]=M,this.uint16[bt+3]=L,this.uint16[bt+4]=N,this.uint16[bt+5]=j,this.uint16[bt+6]=Z,this.uint16[bt+7]=et,this.uint16[bt+8]=ot,this.uint16[bt+9]=At,p},u})(Ki);Io.prototype.bytesPerElement=20,ci("StructArrayLayout10ui20",Io);var Pu=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M,L,N,j,Z,et,ot,At,bt){var Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,p,x,T,M,L,N,j,Z,et,ot,At,bt)},u.prototype.emplace=function(p,x,T,M,L,N,j,Z,et,ot,At,bt,Vt){var jt=12*p;return this.int16[jt+0]=x,this.int16[jt+1]=T,this.int16[jt+2]=M,this.int16[jt+3]=L,this.uint16[jt+4]=N,this.uint16[jt+5]=j,this.uint16[jt+6]=Z,this.uint16[jt+7]=et,this.int16[jt+8]=ot,this.int16[jt+9]=At,this.int16[jt+10]=bt,this.int16[jt+11]=Vt,p},u})(Ki);Pu.prototype.bytesPerElement=24,ci("StructArrayLayout4i4ui4i24",Pu);var Qa=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T){var M=this.length;return this.resize(M+1),this.emplace(M,p,x,T)},u.prototype.emplace=function(p,x,T,M){var L=3*p;return this.float32[L+0]=x,this.float32[L+1]=T,this.float32[L+2]=M,p},u})(Ki);Qa.prototype.bytesPerElement=12,ci("StructArrayLayout3f12",Qa);var Nl=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.uint32[1*p+0]=x,p},u})(Ki);Nl.prototype.bytesPerElement=4,ci("StructArrayLayout1ul4",Nl);var _h=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M,L,N,j,Z,et){var ot=this.length;return this.resize(ot+1),this.emplace(ot,p,x,T,M,L,N,j,Z,et)},u.prototype.emplace=function(p,x,T,M,L,N,j,Z,et,ot){var At=10*p,bt=5*p;return this.int16[At+0]=x,this.int16[At+1]=T,this.int16[At+2]=M,this.int16[At+3]=L,this.int16[At+4]=N,this.int16[At+5]=j,this.uint32[bt+3]=Z,this.uint16[At+8]=et,this.uint16[At+9]=ot,p},u})(Ki);_h.prototype.bytesPerElement=20,ci("StructArrayLayout6i1ul2ui20",_h);var zl=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M,L,N){var j=this.length;return this.resize(j+1),this.emplace(j,p,x,T,M,L,N)},u.prototype.emplace=function(p,x,T,M,L,N,j){var Z=6*p;return this.int16[Z+0]=x,this.int16[Z+1]=T,this.int16[Z+2]=M,this.int16[Z+3]=L,this.int16[Z+4]=N,this.int16[Z+5]=j,p},u})(Ki);zl.prototype.bytesPerElement=12,ci("StructArrayLayout2i2i2i12",zl);var Ja=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M,L){var N=this.length;return this.resize(N+1),this.emplace(N,p,x,T,M,L)},u.prototype.emplace=function(p,x,T,M,L,N){var j=4*p,Z=8*p;return this.float32[j+0]=x,this.float32[j+1]=T,this.float32[j+2]=M,this.int16[Z+6]=L,this.int16[Z+7]=N,p},u})(Ki);Ja.prototype.bytesPerElement=16,ci("StructArrayLayout2f1f2i16",Ja);var bh=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M){var L=this.length;return this.resize(L+1),this.emplace(L,p,x,T,M)},u.prototype.emplace=function(p,x,T,M,L){var N=12*p,j=3*p;return this.uint8[N+0]=x,this.uint8[N+1]=T,this.float32[j+1]=M,this.float32[j+2]=L,p},u})(Ki);bh.prototype.bytesPerElement=12,ci("StructArrayLayout2ub2f12",bh);var xs=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T){var M=this.length;return this.resize(M+1),this.emplace(M,p,x,T)},u.prototype.emplace=function(p,x,T,M){var L=3*p;return this.uint16[L+0]=x,this.uint16[L+1]=T,this.uint16[L+2]=M,p},u})(Ki);xs.prototype.bytesPerElement=6,ci("StructArrayLayout3ui6",xs);var ss=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M,L,N,j,Z,et,ot,At,bt,Vt,jt,Qt,Zt,re){var pe=this.length;return this.resize(pe+1),this.emplace(pe,p,x,T,M,L,N,j,Z,et,ot,At,bt,Vt,jt,Qt,Zt,re)},u.prototype.emplace=function(p,x,T,M,L,N,j,Z,et,ot,At,bt,Vt,jt,Qt,Zt,re,pe){var be=24*p,we=12*p,Ne=48*p;return this.int16[be+0]=x,this.int16[be+1]=T,this.uint16[be+2]=M,this.uint16[be+3]=L,this.uint32[we+2]=N,this.uint32[we+3]=j,this.uint32[we+4]=Z,this.uint16[be+10]=et,this.uint16[be+11]=ot,this.uint16[be+12]=At,this.float32[we+7]=bt,this.float32[we+8]=Vt,this.uint8[Ne+36]=jt,this.uint8[Ne+37]=Qt,this.uint8[Ne+38]=Zt,this.uint32[we+10]=re,this.int16[be+22]=pe,p},u})(Ki);ss.prototype.bytesPerElement=48,ci("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ss);var Fi=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M,L,N,j,Z,et,ot,At,bt,Vt,jt,Qt,Zt,re,pe,be,we,Ne,Je,ri,Si,li,Li,ui,an){var Vi=this.length;return this.resize(Vi+1),this.emplace(Vi,p,x,T,M,L,N,j,Z,et,ot,At,bt,Vt,jt,Qt,Zt,re,pe,be,we,Ne,Je,ri,Si,li,Li,ui,an)},u.prototype.emplace=function(p,x,T,M,L,N,j,Z,et,ot,At,bt,Vt,jt,Qt,Zt,re,pe,be,we,Ne,Je,ri,Si,li,Li,ui,an,Vi){var gi=34*p,yn=17*p;return this.int16[gi+0]=x,this.int16[gi+1]=T,this.int16[gi+2]=M,this.int16[gi+3]=L,this.int16[gi+4]=N,this.int16[gi+5]=j,this.int16[gi+6]=Z,this.int16[gi+7]=et,this.uint16[gi+8]=ot,this.uint16[gi+9]=At,this.uint16[gi+10]=bt,this.uint16[gi+11]=Vt,this.uint16[gi+12]=jt,this.uint16[gi+13]=Qt,this.uint16[gi+14]=Zt,this.uint16[gi+15]=re,this.uint16[gi+16]=pe,this.uint16[gi+17]=be,this.uint16[gi+18]=we,this.uint16[gi+19]=Ne,this.uint16[gi+20]=Je,this.uint16[gi+21]=ri,this.uint16[gi+22]=Si,this.uint32[yn+12]=li,this.float32[yn+13]=Li,this.float32[yn+14]=ui,this.float32[yn+15]=an,this.float32[yn+16]=Vi,p},u})(Ki);Fi.prototype.bytesPerElement=68,ci("StructArrayLayout8i15ui1ul4f68",Fi);var Pr=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.float32[1*p+0]=x,p},u})(Ki);Pr.prototype.bytesPerElement=4,ci("StructArrayLayout1f4",Pr);var Ei=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T){var M=this.length;return this.resize(M+1),this.emplace(M,p,x,T)},u.prototype.emplace=function(p,x,T,M){var L=3*p;return this.int16[L+0]=x,this.int16[L+1]=T,this.int16[L+2]=M,p},u})(Ki);Ei.prototype.bytesPerElement=6,ci("StructArrayLayout3i6",Ei);var Ur=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T){var M=this.length;return this.resize(M+1),this.emplace(M,p,x,T)},u.prototype.emplace=function(p,x,T,M){var L=4*p;return this.uint32[2*p+0]=x,this.uint16[L+2]=T,this.uint16[L+3]=M,p},u})(Ki);Ur.prototype.bytesPerElement=8,ci("StructArrayLayout1ul2ui8",Ur);var Ul=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var T=this.length;return this.resize(T+1),this.emplace(T,p,x)},u.prototype.emplace=function(p,x,T){var M=2*p;return this.uint16[M+0]=x,this.uint16[M+1]=T,p},u})(Ki);Ul.prototype.bytesPerElement=4,ci("StructArrayLayout2ui4",Ul);var Iu=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.uint16[1*p+0]=x,p},u})(Ki);Iu.prototype.bytesPerElement=2,ci("StructArrayLayout1ui2",Iu);var Mo=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,T,M){var L=this.length;return this.resize(L+1),this.emplace(L,p,x,T,M)},u.prototype.emplace=function(p,x,T,M,L){var N=4*p;return this.float32[N+0]=x,this.float32[N+1]=T,this.float32[N+2]=M,this.float32[N+3]=L,p},u})(Ki);Mo.prototype.bytesPerElement=16,ci("StructArrayLayout4f16",Mo);var m=(function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return p.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},p.x1.get=function(){return this._structArray.int16[this._pos2+2]},p.y1.get=function(){return this._structArray.int16[this._pos2+3]},p.x2.get=function(){return this._structArray.int16[this._pos2+4]},p.y2.get=function(){return this._structArray.int16[this._pos2+5]},p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.anchorPoint.get=function(){return new _(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,p),u})(Su);m.prototype.size=20;var v=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new m(this,p)},u})(_h);ci("CollisionBoxArray",v);var g=(function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},p.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},p.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},p.segment.get=function(){return this._structArray.uint16[this._pos2+10]},p.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},p.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},p.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},p.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},p.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},p.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},p.placedOrientation.set=function(x){this._structArray.uint8[this._pos1+37]=x},p.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},p.hidden.set=function(x){this._structArray.uint8[this._pos1+38]=x},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+10]=x},p.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,p),u})(Su);g.prototype.size=48;var w=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new g(this,p)},u})(ss);ci("PlacedSymbolArray",w);var B=(function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},p.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},p.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},p.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},p.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},p.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},p.key.get=function(){return this._structArray.uint16[this._pos2+8]},p.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},p.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},p.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},p.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},p.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},p.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},p.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},p.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},p.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},p.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},p.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},p.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},p.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+12]=x},p.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},p.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},p.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},p.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,p),u})(Su);B.prototype.size=68;var D=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new B(this,p)},u})(Fi);ci("SymbolInstanceArray",D);var O=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getoffsetX=function(p){return this.float32[1*p+0]},u})(Pr);ci("GlyphOffsetArray",O);var G=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getx=function(p){return this.int16[3*p+0]},u.prototype.gety=function(p){return this.int16[3*p+1]},u.prototype.gettileUnitDistanceFromAnchor=function(p){return this.int16[3*p+2]},u})(Ei);ci("SymbolLineVertexArray",G);var J=(function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,p),u})(Su);J.prototype.size=8;var at=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new J(this,p)},u})(Ur);ci("FeatureIndexArray",at);var Et=zr([{name:"a_pos",components:2,type:"Int16"}],4).members,Ct=function(a){a===void 0&&(a=[]),this.segments=a};function Bt(a,u){return 256*(a=X(Math.floor(a),0,255))+X(Math.floor(u),0,255)}Ct.prototype.prepareSegment=function(a,u,p,x){var T=this.segments[this.segments.length-1];return a>Ct.MAX_VERTEX_ARRAY_LENGTH&&dt("Max vertices per segment is "+Ct.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!T||T.vertexLength+a>Ct.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==x)&&(T={vertexOffset:u.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},x!==void 0&&(T.sortKey=x),this.segments.push(T)),T},Ct.prototype.get=function(){return this.segments},Ct.prototype.destroy=function(){for(var a=0,u=this.segments;a<u.length;a+=1){var p=u[a];for(var x in p.vaos)p.vaos[x].destroy()}},Ct.simpleSegment=function(a,u,p,x){return new Ct([{vertexOffset:a,primitiveOffset:u,vertexLength:p,primitiveLength:x,vaos:{},sortKey:0}])},Ct.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ci("SegmentVector",Ct);var Wt=zr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),zt=l(function(a){a.exports=function(u,p){var x,T,M,L,N,j,Z,et;for(T=u.length-(x=3&u.length),M=p,N=3432918353,j=461845907,et=0;et<T;)Z=255&u.charCodeAt(et)|(255&u.charCodeAt(++et))<<8|(255&u.charCodeAt(++et))<<16|(255&u.charCodeAt(++et))<<24,++et,M=27492+(65535&(L=5*(65535&(M=(M^=Z=(65535&(Z=(Z=(65535&Z)*N+(((Z>>>16)*N&65535)<<16)&4294967295)<<15|Z>>>17))*j+(((Z>>>16)*j&65535)<<16)&4294967295)<<13|M>>>19))+((5*(M>>>16)&65535)<<16)&4294967295))+((58964+(L>>>16)&65535)<<16);switch(Z=0,x){case 3:Z^=(255&u.charCodeAt(et+2))<<16;case 2:Z^=(255&u.charCodeAt(et+1))<<8;case 1:M^=Z=(65535&(Z=(Z=(65535&(Z^=255&u.charCodeAt(et)))*N+(((Z>>>16)*N&65535)<<16)&4294967295)<<15|Z>>>17))*j+(((Z>>>16)*j&65535)<<16)&4294967295}return M^=u.length,M=2246822507*(65535&(M^=M>>>16))+((2246822507*(M>>>16)&65535)<<16)&4294967295,M=3266489909*(65535&(M^=M>>>13))+((3266489909*(M>>>16)&65535)<<16)&4294967295,(M^=M>>>16)>>>0}}),f=l(function(a){a.exports=function(u,p){for(var x,T=u.length,M=p^T,L=0;T>=4;)x=1540483477*(65535&(x=255&u.charCodeAt(L)|(255&u.charCodeAt(++L))<<8|(255&u.charCodeAt(++L))<<16|(255&u.charCodeAt(++L))<<24))+((1540483477*(x>>>16)&65535)<<16),M=1540483477*(65535&M)+((1540483477*(M>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),T-=4,++L;switch(T){case 3:M^=(255&u.charCodeAt(L+2))<<16;case 2:M^=(255&u.charCodeAt(L+1))<<8;case 1:M=1540483477*(65535&(M^=255&u.charCodeAt(L)))+((1540483477*(M>>>16)&65535)<<16)}return M=1540483477*(65535&(M^=M>>>13))+((1540483477*(M>>>16)&65535)<<16),(M^=M>>>15)>>>0}}),h=zt,A=f;h.murmur3=zt,h.murmur2=A;var b=function(){this.ids=[],this.positions=[],this.indexed=!1};b.prototype.add=function(a,u,p,x){this.ids.push(S(a)),this.positions.push(u,p,x)},b.prototype.getPositions=function(a){for(var u=S(a),p=0,x=this.ids.length-1;p<x;){var T=p+x>>1;this.ids[T]>=u?x=T:p=T+1}for(var M=[];this.ids[p]===u;)M.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return M},b.serialize=function(a,u){var p=new Float64Array(a.ids),x=new Uint32Array(a.positions);return(function T(M,L,N,j){for(;N<j;){for(var Z=M[N+j>>1],et=N-1,ot=j+1;;){do et++;while(M[et]<Z);do ot--;while(M[ot]>Z);if(et>=ot)break;P(M,et,ot),P(L,3*et,3*ot),P(L,3*et+1,3*ot+1),P(L,3*et+2,3*ot+2)}ot-N<j-ot?(T(M,L,N,ot),N=ot+1):(T(M,L,ot+1,j),j=ot)}})(p,x,0,p.length-1),u&&u.push(p.buffer,x.buffer),{ids:p,positions:x}},b.deserialize=function(a){var u=new b;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u};var E=Math.pow(2,53)-1;function S(a){var u=+a;return!isNaN(u)&&u<=E?u:h(String(a))}function P(a,u,p){var x=a[u];a[u]=a[p],a[p]=x}ci("FeaturePositionMap",b);var R=function(a,u){this.gl=a.gl,this.location=u},F=(function(a){function u(p,x){a.call(this,p,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))},u})(R),U=(function(a){function u(p,x){a.call(this,p,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))},u})(R),W=(function(a){function u(p,x){a.call(this,p,x),this.current=[0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))},u})(R),ht=(function(a){function u(p,x){a.call(this,p,x),this.current=[0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))},u})(R),Pt=(function(a){function u(p,x){a.call(this,p,x),this.current=[0,0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3]))},u})(R),It=(function(a){function u(p,x){a.call(this,p,x),this.current=sn.transparent}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a))},u})(R),Mt=new Float32Array(16),Yt=(function(a){function u(p,x){a.call(this,p,x),this.current=Mt}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(var x=1;x<16;x++)if(p[x]!==this.current[x]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}},u})(R);function Ht(a){return[Bt(255*a.r,255*a.g),Bt(255*a.b,255*a.a)]}var ie=function(a,u,p){this.value=a,this.uniformNames=u.map(function(x){return"u_"+x}),this.type=p};ie.prototype.setUniform=function(a,u,p){a.set(p.constantOr(this.value))},ie.prototype.getBinding=function(a,u,p){return this.type==="color"?new It(a,u):new U(a,u)};var te=function(a,u){this.uniformNames=u.map(function(p){return"u_"+p}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};te.prototype.setConstantPatternPositions=function(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr},te.prototype.setUniform=function(a,u,p,x){var T=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;T&&a.set(T)},te.prototype.getBinding=function(a,u,p){return p.substr(0,9)==="u_pattern"?new Pt(a,u):new U(a,u)};var Jt=function(a,u,p,x){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(function(T){return{name:"a_"+T,type:"Float32",components:p==="color"?2:1,offset:0}}),this.paintVertexArray=new x};Jt.prototype.populatePaintArray=function(a,u,p,x,T){var M=this.paintVertexArray.length,L=this.expression.evaluate(new un(0),u,{},x,[],T);this.paintVertexArray.resize(a),this._setPaintValue(M,a,L)},Jt.prototype.updatePaintArray=function(a,u,p,x){var T=this.expression.evaluate({zoom:0},p,x);this._setPaintValue(a,u,T)},Jt.prototype._setPaintValue=function(a,u,p){if(this.type==="color")for(var x=Ht(p),T=a;T<u;T++)this.paintVertexArray.emplace(T,x[0],x[1]);else{for(var M=a;M<u;M++)this.paintVertexArray.emplace(M,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}},Jt.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Jt.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var qt=function(a,u,p,x,T,M){this.expression=a,this.uniformNames=u.map(function(L){return"u_"+L+"_t"}),this.type=p,this.useIntegerZoom=x,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=u.map(function(L){return{name:"a_"+L,type:"Float32",components:p==="color"?4:2,offset:0}}),this.paintVertexArray=new M};qt.prototype.populatePaintArray=function(a,u,p,x,T){var M=this.expression.evaluate(new un(this.zoom),u,{},x,[],T),L=this.expression.evaluate(new un(this.zoom+1),u,{},x,[],T),N=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(N,a,M,L)},qt.prototype.updatePaintArray=function(a,u,p,x){var T=this.expression.evaluate({zoom:this.zoom},p,x),M=this.expression.evaluate({zoom:this.zoom+1},p,x);this._setPaintValue(a,u,T,M)},qt.prototype._setPaintValue=function(a,u,p,x){if(this.type==="color")for(var T=Ht(p),M=Ht(x),L=a;L<u;L++)this.paintVertexArray.emplace(L,T[0],T[1],M[0],M[1]);else{for(var N=a;N<u;N++)this.paintVertexArray.emplace(N,p,x);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(x))}},qt.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},qt.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},qt.prototype.setUniform=function(a,u){var p=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,x=X(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);a.set(x)},qt.prototype.getBinding=function(a,u,p){return new U(a,u)};var Be=function(a,u,p,x,T,M){this.expression=a,this.type=u,this.useIntegerZoom=p,this.zoom=x,this.layerId=M,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T};Be.prototype.populatePaintArray=function(a,u,p){var x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(x,a,u.patterns&&u.patterns[this.layerId],p)},Be.prototype.updatePaintArray=function(a,u,p,x,T){this._setPaintValues(a,u,p.patterns&&p.patterns[this.layerId],T)},Be.prototype._setPaintValues=function(a,u,p,x){if(x&&p){var T=x[p.min],M=x[p.mid],L=x[p.max];if(T&&M&&L)for(var N=a;N<u;N++)this.zoomInPaintVertexArray.emplace(N,M.tl[0],M.tl[1],M.br[0],M.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],M.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,M.tl[0],M.tl[1],M.br[0],M.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],M.pixelRatio,L.pixelRatio)}},Be.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Wt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Wt.members,this.expression.isStateDependent))},Be.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Ge=function(a,u,p){this.binders={},this._buffers=[];var x=[];for(var T in a.paint._values)if(p(T)){var M=a.paint.get(T);if(M instanceof us&&na(M.property.specification)){var L=Ri(T,a.type),N=M.value,j=M.property.specification.type,Z=M.property.useIntegerZoom,et=M.property.specification["property-type"],ot=et==="cross-faded"||et==="cross-faded-data-driven";if(N.kind==="constant")this.binders[T]=ot?new te(N.value,L):new ie(N.value,L,j),x.push("/u_"+T);else if(N.kind==="source"||ot){var At=Ci(T,j,"source");this.binders[T]=ot?new Be(N,j,Z,u,At,a.id):new Jt(N,L,j,At),x.push("/a_"+T)}else{var bt=Ci(T,j,"composite");this.binders[T]=new qt(N,L,j,Z,u,bt),x.push("/z_"+T)}}}this.cacheKey=x.sort().join("")};Ge.prototype.getMaxValue=function(a){var u=this.binders[a];return u instanceof Jt||u instanceof qt?u.maxValue:0},Ge.prototype.populatePaintArrays=function(a,u,p,x,T){for(var M in this.binders){var L=this.binders[M];(L instanceof Jt||L instanceof qt||L instanceof Be)&&L.populatePaintArray(a,u,p,x,T)}},Ge.prototype.setConstantPatternPositions=function(a,u){for(var p in this.binders){var x=this.binders[p];x instanceof te&&x.setConstantPatternPositions(a,u)}},Ge.prototype.updatePaintArrays=function(a,u,p,x,T){var M=!1;for(var L in a)for(var N=0,j=u.getPositions(L);N<j.length;N+=1){var Z=j[N],et=p.feature(Z.index);for(var ot in this.binders){var At=this.binders[ot];if((At instanceof Jt||At instanceof qt||At instanceof Be)&&At.expression.isStateDependent===!0){var bt=x.paint.get(ot);At.expression=bt.value,At.updatePaintArray(Z.start,Z.end,et,a[L],T),M=!0}}}return M},Ge.prototype.defines=function(){var a=[];for(var u in this.binders){var p=this.binders[u];(p instanceof ie||p instanceof te)&&a.push.apply(a,p.uniformNames.map(function(x){return"#define HAS_UNIFORM_"+x}))}return a},Ge.prototype.getBinderAttributes=function(){var a=[];for(var u in this.binders){var p=this.binders[u];if(p instanceof Jt||p instanceof qt)for(var x=0;x<p.paintVertexAttributes.length;x++)a.push(p.paintVertexAttributes[x].name);else if(p instanceof Be)for(var T=0;T<Wt.members.length;T++)a.push(Wt.members[T].name)}return a},Ge.prototype.getBinderUniforms=function(){var a=[];for(var u in this.binders){var p=this.binders[u];if(p instanceof ie||p instanceof te||p instanceof qt)for(var x=0,T=p.uniformNames;x<T.length;x+=1)a.push(T[x])}return a},Ge.prototype.getPaintVertexBuffers=function(){return this._buffers},Ge.prototype.getUniforms=function(a,u){var p=[];for(var x in this.binders){var T=this.binders[x];if(T instanceof ie||T instanceof te||T instanceof qt)for(var M=0,L=T.uniformNames;M<L.length;M+=1){var N=L[M];if(u[N]){var j=T.getBinding(a,u[N],N);p.push({name:N,property:x,binding:j})}}}return p},Ge.prototype.setUniforms=function(a,u,p,x){for(var T=0,M=u;T<M.length;T+=1){var L=M[T],N=L.name,j=L.property;this.binders[j].setUniform(L.binding,x,p.get(j),N)}},Ge.prototype.updatePaintBuffers=function(a){for(var u in this._buffers=[],this.binders){var p=this.binders[u];if(a&&p instanceof Be){var x=a.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(p instanceof Jt||p instanceof qt)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}},Ge.prototype.upload=function(a){for(var u in this.binders){var p=this.binders[u];(p instanceof Jt||p instanceof qt||p instanceof Be)&&p.upload(a)}this.updatePaintBuffers()},Ge.prototype.destroy=function(){for(var a in this.binders){var u=this.binders[a];(u instanceof Jt||u instanceof qt||u instanceof Be)&&u.destroy()}};var ze=function(a,u,p){p===void 0&&(p=function(){return!0}),this.programConfigurations={};for(var x=0,T=a;x<T.length;x+=1){var M=T[x];this.programConfigurations[M.id]=new Ge(M,u,p)}this.needsUpload=!1,this._featureMap=new b,this._bufferOffset=0};function Ri(a,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(u+"-","").replace(/-/g,"_")]}function Ci(a,u,p){var x={color:{source:Fl,composite:Mo},number:{source:Pr,composite:Fl}},T=(function(M){return{"line-pattern":{source:Io,composite:Io},"fill-pattern":{source:Io,composite:Io},"fill-extrusion-pattern":{source:Io,composite:Io}}[M]})(a);return T&&T[p]||x[u][p]}ze.prototype.populatePaintArrays=function(a,u,p,x,T,M){for(var L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(a,u,x,T,M);u.id!==void 0&&this._featureMap.add(u.id,p,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},ze.prototype.updatePaintArrays=function(a,u,p,x){for(var T=0,M=p;T<M.length;T+=1){var L=M[T];this.needsUpload=this.programConfigurations[L.id].updatePaintArrays(a,this._featureMap,u,L,x)||this.needsUpload}},ze.prototype.get=function(a){return this.programConfigurations[a]},ze.prototype.upload=function(a){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}},ze.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},ci("ConstantBinder",ie),ci("CrossFadedConstantBinder",te),ci("SourceExpressionBinder",Jt),ci("CrossFadedCompositeBinder",Be),ci("CompositeExpressionBinder",qt),ci("ProgramConfiguration",Ge,{omit:["_buffers"]}),ci("ProgramConfigurationSet",ze);var ji=Math.pow(2,14)-1,Ti=-ji-1;function ai(a){for(var u=8192/a.extent,p=a.loadGeometry(),x=0;x<p.length;x++)for(var T=p[x],M=0;M<T.length;M++){var L=T[M],N=Math.round(L.x*u),j=Math.round(L.y*u);L.x=X(N,Ti,ji),L.y=X(j,Ti,ji),(N<L.x||N>L.x+1||j<L.y||j>L.y+1)&&dt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return p}function We(a,u){return{type:a.type,id:a.id,properties:a.properties,geometry:u?ai(a):[]}}function Wi(a,u,p,x,T){a.emplaceBack(2*u+(x+1)/2,2*p+(T+1)/2)}var fn=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Po,this.indexArray=new xs,this.segments=new Ct,this.programConfigurations=new ze(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Zi(a,u){for(var p=0;p<a.length;p++)if(Ta(u,a[p]))return!0;for(var x=0;x<u.length;x++)if(Ta(a,u[x]))return!0;return!!xh(a,u)}function gn(a,u,p){return!!Ta(a,u)||!!Vl(u,a,p)}function or(a,u){if(a.length===1)return wh(u,a[0]);for(var p=0;p<u.length;p++)for(var x=u[p],T=0;T<x.length;T++)if(Ta(a,x[T]))return!0;for(var M=0;M<a.length;M++)if(wh(u,a[M]))return!0;for(var L=0;L<u.length;L++)if(xh(a,u[L]))return!0;return!1}function Ys(a,u,p){if(a.length>1){if(xh(a,u))return!0;for(var x=0;x<u.length;x++)if(Vl(u[x],a,p))return!0}for(var T=0;T<a.length;T++)if(Vl(a[T],u,p))return!0;return!1}function xh(a,u){if(a.length===0||u.length===0)return!1;for(var p=0;p<a.length-1;p++)for(var x=a[p],T=a[p+1],M=0;M<u.length-1;M++)if(Tc(x,T,u[M],u[M+1]))return!0;return!1}function Tc(a,u,p,x){return Tt(a,p,x)!==Tt(u,p,x)&&Tt(a,u,p)!==Tt(a,u,x)}function Vl(a,u,p){var x=p*p;if(u.length===1)return a.distSqr(u[0])<x;for(var T=1;T<u.length;T++)if(Sc(a,u[T-1],u[T])<x)return!0;return!1}function Sc(a,u,p){var x=u.distSqr(p);if(x===0)return a.distSqr(u);var T=((a.x-u.x)*(p.x-u.x)+(a.y-u.y)*(p.y-u.y))/x;return a.distSqr(T<0?u:T>1?p:p.sub(u)._mult(T)._add(u))}function wh(a,u){for(var p,x,T,M=!1,L=0;L<a.length;L++)for(var N=0,j=(p=a[L]).length-1;N<p.length;j=N++)(x=p[N]).y>u.y!=(T=p[j]).y>u.y&&u.x<(T.x-x.x)*(u.y-x.y)/(T.y-x.y)+x.x&&(M=!M);return M}function Ta(a,u){for(var p=!1,x=0,T=a.length-1;x<a.length;T=x++){var M=a[x],L=a[T];M.y>u.y!=L.y>u.y&&u.x<(L.x-M.x)*(u.y-M.y)/(L.y-M.y)+M.x&&(p=!p)}return p}function Eh(a,u,p){var x=p[0],T=p[2];if(a.x<x.x&&u.x<x.x||a.x>T.x&&u.x>T.x||a.y<x.y&&u.y<x.y||a.y>T.y&&u.y>T.y)return!1;var M=Tt(a,u,p[0]);return M!==Tt(a,u,p[1])||M!==Tt(a,u,p[2])||M!==Tt(a,u,p[3])}function Sa(a,u,p){var x=u.paint.get(a).value;return x.kind==="constant"?x.value:p.programConfigurations.get(u.id).getMaxValue(a)}function Zr(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function $a(a,u,p,x,T){if(!u[0]&&!u[1])return a;var M=_.convert(u)._mult(T);p==="viewport"&&M._rotate(-x);for(var L=[],N=0;N<a.length;N++)L.push(a[N].sub(M));return L}fn.prototype.populate=function(a,u,p){var x=this.layers[0],T=[],M=null;x.type==="circle"&&(M=x.layout.get("circle-sort-key"));for(var L=0,N=a;L<N.length;L+=1){var j=N[L],Z=j.feature,et=j.id,ot=j.index,At=j.sourceLayerIndex,bt=this.layers[0]._featureFilter.needGeometry,Vt=We(Z,bt);if(this.layers[0]._featureFilter.filter(new un(this.zoom),Vt,p)){var jt=M?M.evaluate(Vt,{},p):void 0,Qt={id:et,properties:Z.properties,type:Z.type,sourceLayerIndex:At,index:ot,geometry:bt?Vt.geometry:ai(Z),patterns:{},sortKey:jt};T.push(Qt)}}M&&T.sort(function(ri,Si){return ri.sortKey-Si.sortKey});for(var Zt=0,re=T;Zt<re.length;Zt+=1){var pe=re[Zt],be=pe.geometry,we=pe.index,Ne=pe.sourceLayerIndex,Je=a[we].feature;this.addFeature(pe,be,we,p),u.featureIndex.insert(Je,be,we,Ne,this.index)}},fn.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},fn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fn.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Et),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},fn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fn.prototype.addFeature=function(a,u,p,x){for(var T=0,M=u;T<M.length;T+=1)for(var L=0,N=M[T];L<N.length;L+=1){var j=N[L],Z=j.x,et=j.y;if(!(Z<0||Z>=8192||et<0||et>=8192)){var ot=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),At=ot.vertexLength;Wi(this.layoutVertexArray,Z,et,-1,-1),Wi(this.layoutVertexArray,Z,et,1,-1),Wi(this.layoutVertexArray,Z,et,1,1),Wi(this.layoutVertexArray,Z,et,-1,1),this.indexArray.emplaceBack(At,At+1,At+2),this.indexArray.emplaceBack(At,At+3,At+2),ot.vertexLength+=4,ot.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},x)},ci("CircleBucket",fn,{omit:["layers"]});var Gl=new Kr({"circle-sort-key":new pi(lt.layout_circle["circle-sort-key"])}),Mu={paint:new Kr({"circle-radius":new pi(lt.paint_circle["circle-radius"]),"circle-color":new pi(lt.paint_circle["circle-color"]),"circle-blur":new pi(lt.paint_circle["circle-blur"]),"circle-opacity":new pi(lt.paint_circle["circle-opacity"]),"circle-translate":new Ii(lt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ii(lt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ii(lt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ii(lt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pi(lt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pi(lt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pi(lt.paint_circle["circle-stroke-opacity"])}),layout:Gl},Mn=typeof Float32Array<"u"?Float32Array:Array;function Bo(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Qs(a,u,p){var x=u[0],T=u[1],M=u[2],L=u[3],N=u[4],j=u[5],Z=u[6],et=u[7],ot=u[8],At=u[9],bt=u[10],Vt=u[11],jt=u[12],Qt=u[13],Zt=u[14],re=u[15],pe=p[0],be=p[1],we=p[2],Ne=p[3];return a[0]=pe*x+be*N+we*ot+Ne*jt,a[1]=pe*T+be*j+we*At+Ne*Qt,a[2]=pe*M+be*Z+we*bt+Ne*Zt,a[3]=pe*L+be*et+we*Vt+Ne*re,a[4]=(pe=p[4])*x+(be=p[5])*N+(we=p[6])*ot+(Ne=p[7])*jt,a[5]=pe*T+be*j+we*At+Ne*Qt,a[6]=pe*M+be*Z+we*bt+Ne*Zt,a[7]=pe*L+be*et+we*Vt+Ne*re,a[8]=(pe=p[8])*x+(be=p[9])*N+(we=p[10])*ot+(Ne=p[11])*jt,a[9]=pe*T+be*j+we*At+Ne*Qt,a[10]=pe*M+be*Z+we*bt+Ne*Zt,a[11]=pe*L+be*et+we*Vt+Ne*re,a[12]=(pe=p[12])*x+(be=p[13])*N+(we=p[14])*ot+(Ne=p[15])*jt,a[13]=pe*T+be*j+we*At+Ne*Qt,a[14]=pe*M+be*Z+we*bt+Ne*Zt,a[15]=pe*L+be*et+we*Vt+Ne*re,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,u=0,p=arguments.length;p--;)u+=a[p]*a[p];return Math.sqrt(u)});var Bu,Tv=Qs;function Gf(a,u,p){var x=u[0],T=u[1],M=u[2],L=u[3];return a[0]=p[0]*x+p[4]*T+p[8]*M+p[12]*L,a[1]=p[1]*x+p[5]*T+p[9]*M+p[13]*L,a[2]=p[2]*x+p[6]*T+p[10]*M+p[14]*L,a[3]=p[3]*x+p[7]*T+p[11]*M+p[15]*L,a}Bu=new Mn(3),Mn!=Float32Array&&(Bu[0]=0,Bu[1]=0,Bu[2]=0),(function(){var a=new Mn(4);Mn!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)})();var Sv=((function(){var a=new Mn(2);Mn!=Float32Array&&(a[0]=0,a[1]=0)})(),(function(a){function u(p){a.call(this,p,Mu)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new fn(p)},u.prototype.queryRadius=function(p){var x=p;return Sa("circle-radius",this,x)+Sa("circle-stroke-width",this,x)+Zr(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(p,x,T,M,L,N,j,Z){for(var et=$a(p,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,j),ot=this.paint.get("circle-radius").evaluate(x,T)+this.paint.get("circle-stroke-width").evaluate(x,T),At=this.paint.get("circle-pitch-alignment")==="map",bt=At?et:(function(Je,ri){return Je.map(function(Si){return Ch(Si,ri)})})(et,Z),Vt=At?ot*j:ot,jt=0,Qt=M;jt<Qt.length;jt+=1)for(var Zt=0,re=Qt[jt];Zt<re.length;Zt+=1){var pe=re[Zt],be=At?pe:Ch(pe,Z),we=Vt,Ne=Gf([],[pe.x,pe.y,0,1],Z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?we*=Ne[3]/N.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(we*=N.cameraToCenterDistance/Ne[3]),gn(bt,be,we))return!0}return!1},u})(jo));function Ch(a,u){var p=Gf([],[a.x,a.y,0,1],u);return new _(p[0]/p[3],p[1]/p[3])}var Bm=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(fn);function Pc(a,u,p,x){var T=u.width,M=u.height;if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==T*M*p)throw new RangeError("mismatched image size")}else x=new Uint8Array(T*M*p);return a.width=T,a.height=M,a.data=x,a}function jf(a,u,p){var x=u.width,T=u.height;if(x!==a.width||T!==a.height){var M=Pc({},{width:x,height:T},p);Pv(a,M,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,x),height:Math.min(a.height,T)},p),a.width=x,a.height=T,a.data=M.data}}function Pv(a,u,p,x,T,M){if(T.width===0||T.height===0)return u;if(T.width>a.width||T.height>a.height||p.x>a.width-T.width||p.y>a.height-T.height)throw new RangeError("out of range source coordinates for image copy");if(T.width>u.width||T.height>u.height||x.x>u.width-T.width||x.y>u.height-T.height)throw new RangeError("out of range destination coordinates for image copy");for(var L=a.data,N=u.data,j=0;j<T.height;j++)for(var Z=((p.y+j)*a.width+p.x)*M,et=((x.y+j)*u.width+x.x)*M,ot=0;ot<T.width*M;ot++)N[et+ot]=L[Z+ot];return u}ci("HeatmapBucket",Bm,{omit:["layers"]});var Th=function(a,u){Pc(this,a,1,u)};Th.prototype.resize=function(a){jf(this,a,1)},Th.prototype.clone=function(){return new Th({width:this.width,height:this.height},new Uint8Array(this.data))},Th.copy=function(a,u,p,x,T){Pv(a,u,p,x,T,1)};var co=function(a,u){Pc(this,a,4,u)};co.prototype.resize=function(a){jf(this,a,4)},co.prototype.replace=function(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},co.prototype.clone=function(){return new co({width:this.width,height:this.height},new Uint8Array(this.data))},co.copy=function(a,u,p,x,T){Pv(a,u,p,x,T,4)},ci("AlphaImage",Th),ci("RGBAImage",co);var Kk={paint:new Kr({"heatmap-radius":new pi(lt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pi(lt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ii(lt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new So(lt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ii(lt.paint_heatmap["heatmap-opacity"])})};function O3(a){var u={},p=a.resolution||256,x=a.clips?a.clips.length:1,T=a.image||new co({width:p,height:x}),M=function(Vt,jt,Qt){u[a.evaluationKey]=Qt;var Zt=a.expression.evaluate(u);T.data[Vt+jt+0]=Math.floor(255*Zt.r/Zt.a),T.data[Vt+jt+1]=Math.floor(255*Zt.g/Zt.a),T.data[Vt+jt+2]=Math.floor(255*Zt.b/Zt.a),T.data[Vt+jt+3]=Math.floor(255*Zt.a)};if(a.clips)for(var L=0,N=0;L<x;++L,N+=4*p)for(var j=0,Z=0;j<p;j++,Z+=4){var et=j/(p-1),ot=a.clips[L];M(N,Z,ot.start*(1-et)+ot.end*et)}else for(var At=0,bt=0;At<p;At++,bt+=4)M(0,bt,At/(p-1));return T}var Zk=(function(a){function u(p){a.call(this,p,Kk),this._updateColorRamp()}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new Bm(p)},u.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=O3({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u})(jo),Yk={paint:new Kr({"hillshade-illumination-direction":new Ii(lt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ii(lt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ii(lt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ii(lt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ii(lt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ii(lt.paint_hillshade["hillshade-accent-color"])})},Qk=(function(a){function u(p){a.call(this,p,Yk)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u})(jo),Jk=zr([{name:"a_pos",components:2,type:"Int16"}],4).members,Iv=Rm,$k=Rm;function Rm(a,u,p){p=p||2;var x,T,M,L,N,j,Z,et=u&&u.length,ot=et?u[0]*p:a.length,At=F3(a,0,ot,p,!0),bt=[];if(!At||At.next===At.prev)return bt;if(et&&(At=(function(jt,Qt,Zt,re){var pe,be,we,Ne=[];for(pe=0,be=Qt.length;pe<be;pe++)(we=F3(jt,Qt[pe]*re,pe<be-1?Qt[pe+1]*re:jt.length,re,!1))===we.next&&(we.steiner=!0),Ne.push(aO(we));for(Ne.sort(rO),pe=0;pe<Ne.length;pe++)sO(Ne[pe],Zt),Zt=Ic(Zt,Zt.next);return Zt})(a,u,At,p)),a.length>80*p){x=M=a[0],T=L=a[1];for(var Vt=p;Vt<ot;Vt+=p)(N=a[Vt])<x&&(x=N),(j=a[Vt+1])<T&&(T=j),N>M&&(M=N),j>L&&(L=j);Z=(Z=Math.max(M-x,L-T))!==0?1/Z:0}return Hp(At,bt,p,x,T,Z),bt}function F3(a,u,p,x,T){var M,L;if(T===Rv(a,u,p,x)>0)for(M=u;M<p;M+=x)L=U3(M,a[M],a[M+1],L);else for(M=p-x;M>=u;M-=x)L=U3(M,a[M],a[M+1],L);return L&&Lm(L,L.next)&&(qp(L),L=L.next),L}function Ic(a,u){if(!a)return a;u||(u=a);var p,x=a;do if(p=!1,x.steiner||!Lm(x,x.next)&&Vr(x.prev,x,x.next)!==0)x=x.next;else{if(qp(x),(x=u=x.prev)===x.next)break;p=!0}while(p||x!==u);return u}function Hp(a,u,p,x,T,M,L){if(a){!L&&M&&(function(et,ot,At,bt){var Vt=et;do Vt.z===null&&(Vt.z=Mv(Vt.x,Vt.y,ot,At,bt)),Vt.prevZ=Vt.prev,Vt.nextZ=Vt.next,Vt=Vt.next;while(Vt!==et);Vt.prevZ.nextZ=null,Vt.prevZ=null,(function(jt){var Qt,Zt,re,pe,be,we,Ne,Je,ri=1;do{for(Zt=jt,jt=null,be=null,we=0;Zt;){for(we++,re=Zt,Ne=0,Qt=0;Qt<ri&&(Ne++,re=re.nextZ);Qt++);for(Je=ri;Ne>0||Je>0&&re;)Ne!==0&&(Je===0||!re||Zt.z<=re.z)?(pe=Zt,Zt=Zt.nextZ,Ne--):(pe=re,re=re.nextZ,Je--),be?be.nextZ=pe:jt=pe,pe.prevZ=be,be=pe;Zt=re}be.nextZ=null,ri*=2}while(we>1)})(Vt)})(a,x,T,M);for(var N,j,Z=a;a.prev!==a.next;)if(N=a.prev,j=a.next,M?eO(a,x,T,M):tO(a))u.push(N.i/p),u.push(a.i/p),u.push(j.i/p),qp(a),a=j.next,Z=j.next;else if((a=j)===Z){L?L===1?Hp(a=iO(Ic(a),u,p),u,p,x,T,M,2):L===2&&nO(a,u,p,x,T,M):Hp(Ic(a),u,p,x,T,M,1);break}}}function tO(a){var u=a.prev,p=a,x=a.next;if(Vr(u,p,x)>=0)return!1;for(var T=a.next.next;T!==a.prev;){if(Wf(u.x,u.y,p.x,p.y,x.x,x.y,T.x,T.y)&&Vr(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function eO(a,u,p,x){var T=a.prev,M=a,L=a.next;if(Vr(T,M,L)>=0)return!1;for(var N=T.x>M.x?T.x>L.x?T.x:L.x:M.x>L.x?M.x:L.x,j=T.y>M.y?T.y>L.y?T.y:L.y:M.y>L.y?M.y:L.y,Z=Mv(T.x<M.x?T.x<L.x?T.x:L.x:M.x<L.x?M.x:L.x,T.y<M.y?T.y<L.y?T.y:L.y:M.y<L.y?M.y:L.y,u,p,x),et=Mv(N,j,u,p,x),ot=a.prevZ,At=a.nextZ;ot&&ot.z>=Z&&At&&At.z<=et;){if(ot!==a.prev&&ot!==a.next&&Wf(T.x,T.y,M.x,M.y,L.x,L.y,ot.x,ot.y)&&Vr(ot.prev,ot,ot.next)>=0||(ot=ot.prevZ,At!==a.prev&&At!==a.next&&Wf(T.x,T.y,M.x,M.y,L.x,L.y,At.x,At.y)&&Vr(At.prev,At,At.next)>=0))return!1;At=At.nextZ}for(;ot&&ot.z>=Z;){if(ot!==a.prev&&ot!==a.next&&Wf(T.x,T.y,M.x,M.y,L.x,L.y,ot.x,ot.y)&&Vr(ot.prev,ot,ot.next)>=0)return!1;ot=ot.prevZ}for(;At&&At.z<=et;){if(At!==a.prev&&At!==a.next&&Wf(T.x,T.y,M.x,M.y,L.x,L.y,At.x,At.y)&&Vr(At.prev,At,At.next)>=0)return!1;At=At.nextZ}return!0}function iO(a,u,p){var x=a;do{var T=x.prev,M=x.next.next;!Lm(T,M)&&N3(T,x,x.next,M)&&Xp(T,M)&&Xp(M,T)&&(u.push(T.i/p),u.push(x.i/p),u.push(M.i/p),qp(x),qp(x.next),x=a=M),x=x.next}while(x!==a);return Ic(x)}function nO(a,u,p,x,T,M){var L=a;do{for(var N=L.next.next;N!==L.prev;){if(L.i!==N.i&&lO(L,N)){var j=z3(L,N);return L=Ic(L,L.next),j=Ic(j,j.next),Hp(L,u,p,x,T,M),void Hp(j,u,p,x,T,M)}N=N.next}L=L.next}while(L!==a)}function rO(a,u){return a.x-u.x}function sO(a,u){if(u=(function(x,T){var M,L=T,N=x.x,j=x.y,Z=-1/0;do{if(j<=L.y&&j>=L.next.y&&L.next.y!==L.y){var et=L.x+(j-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if(et<=N&&et>Z){if(Z=et,et===N){if(j===L.y)return L;if(j===L.next.y)return L.next}M=L.x<L.next.x?L:L.next}}L=L.next}while(L!==T);if(!M)return null;if(N===Z)return M;var ot,At=M,bt=M.x,Vt=M.y,jt=1/0;L=M;do N>=L.x&&L.x>=bt&&N!==L.x&&Wf(j<Vt?N:Z,j,bt,Vt,j<Vt?Z:N,j,L.x,L.y)&&(ot=Math.abs(j-L.y)/(N-L.x),Xp(L,x)&&(ot<jt||ot===jt&&(L.x>M.x||L.x===M.x&&oO(M,L)))&&(M=L,jt=ot)),L=L.next;while(L!==At);return M})(a,u)){var p=z3(u,a);Ic(u,u.next),Ic(p,p.next)}}function oO(a,u){return Vr(a.prev,a,u.prev)<0&&Vr(u.next,a,a.next)<0}function Mv(a,u,p,x,T){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-p)*T)|a<<8))|a<<4))|a<<2))|a<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-x)*T)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function aO(a){var u=a,p=a;do(u.x<p.x||u.x===p.x&&u.y<p.y)&&(p=u),u=u.next;while(u!==a);return p}function Wf(a,u,p,x,T,M,L,N){return(T-L)*(u-N)-(a-L)*(M-N)>=0&&(a-L)*(x-N)-(p-L)*(u-N)>=0&&(p-L)*(M-N)-(T-L)*(x-N)>=0}function lO(a,u){return a.next.i!==u.i&&a.prev.i!==u.i&&!(function(p,x){var T=p;do{if(T.i!==p.i&&T.next.i!==p.i&&T.i!==x.i&&T.next.i!==x.i&&N3(T,T.next,p,x))return!0;T=T.next}while(T!==p);return!1})(a,u)&&(Xp(a,u)&&Xp(u,a)&&(function(p,x){var T=p,M=!1,L=(p.x+x.x)/2,N=(p.y+x.y)/2;do T.y>N!=T.next.y>N&&T.next.y!==T.y&&L<(T.next.x-T.x)*(N-T.y)/(T.next.y-T.y)+T.x&&(M=!M),T=T.next;while(T!==p);return M})(a,u)&&(Vr(a.prev,a,u.prev)||Vr(a,u.prev,u))||Lm(a,u)&&Vr(a.prev,a,a.next)>0&&Vr(u.prev,u,u.next)>0)}function Vr(a,u,p){return(u.y-a.y)*(p.x-u.x)-(u.x-a.x)*(p.y-u.y)}function Lm(a,u){return a.x===u.x&&a.y===u.y}function N3(a,u,p,x){var T=km(Vr(a,u,p)),M=km(Vr(a,u,x)),L=km(Vr(p,x,a)),N=km(Vr(p,x,u));return T!==M&&L!==N||!(T!==0||!Dm(a,p,u))||!(M!==0||!Dm(a,x,u))||!(L!==0||!Dm(p,a,x))||!(N!==0||!Dm(p,u,x))}function Dm(a,u,p){return u.x<=Math.max(a.x,p.x)&&u.x>=Math.min(a.x,p.x)&&u.y<=Math.max(a.y,p.y)&&u.y>=Math.min(a.y,p.y)}function km(a){return a>0?1:a<0?-1:0}function Xp(a,u){return Vr(a.prev,a,a.next)<0?Vr(a,u,a.next)>=0&&Vr(a,a.prev,u)>=0:Vr(a,u,a.prev)<0||Vr(a,a.next,u)<0}function z3(a,u){var p=new Bv(a.i,a.x,a.y),x=new Bv(u.i,u.x,u.y),T=a.next,M=u.prev;return a.next=u,u.prev=a,p.next=T,T.prev=p,x.next=p,p.prev=x,M.next=x,x.prev=M,x}function U3(a,u,p,x){var T=new Bv(a,u,p);return x?(T.next=x.next,T.prev=x,x.next.prev=T,x.next=T):(T.prev=T,T.next=T),T}function qp(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Bv(a,u,p){this.i=a,this.x=u,this.y=p,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rv(a,u,p,x){for(var T=0,M=u,L=p-x;M<p;M+=x)T+=(a[L]-a[M])*(a[M+1]+a[L+1]),L=M;return T}function uO(a,u,p,x,T){(function M(L,N,j,Z,et){for(;Z>j;){if(Z-j>600){var ot=Z-j+1,At=N-j+1,bt=Math.log(ot),Vt=.5*Math.exp(2*bt/3),jt=.5*Math.sqrt(bt*Vt*(ot-Vt)/ot)*(At-ot/2<0?-1:1);M(L,N,Math.max(j,Math.floor(N-At*Vt/ot+jt)),Math.min(Z,Math.floor(N+(ot-At)*Vt/ot+jt)),et)}var Qt=L[N],Zt=j,re=Z;for(Kp(L,j,N),et(L[Z],Qt)>0&&Kp(L,j,Z);Zt<re;){for(Kp(L,Zt,re),Zt++,re--;et(L[Zt],Qt)<0;)Zt++;for(;et(L[re],Qt)>0;)re--}et(L[j],Qt)===0?Kp(L,j,re):Kp(L,++re,Z),re<=N&&(j=re+1),N<=re&&(Z=re-1)}})(a,u,p,x||a.length-1,T||cO)}function Kp(a,u,p){var x=a[u];a[u]=a[p],a[p]=x}function cO(a,u){return a<u?-1:a>u?1:0}function Lv(a,u){var p=a.length;if(p<=1)return[a];for(var x,T,M=[],L=0;L<p;L++){var N=ue(a[L]);N!==0&&(a[L].area=Math.abs(N),T===void 0&&(T=N<0),T===N<0?(x&&M.push(x),x=[a[L]]):x.push(a[L]))}if(x&&M.push(x),u>1)for(var j=0;j<M.length;j++)M[j].length<=u||(uO(M[j],u,1,M[j].length-1,hO),M[j]=M[j].slice(0,u));return M}function hO(a,u){return u.area-a.area}function Dv(a,u,p){for(var x=p.patternDependencies,T=!1,M=0,L=u;M<L.length;M+=1){var N=L[M].paint.get(a+"-pattern");N.isConstant()||(T=!0);var j=N.constantOr(null);j&&(T=!0,x[j.to]=!0,x[j.from]=!0)}return T}function kv(a,u,p,x,T){for(var M=T.patternDependencies,L=0,N=u;L<N.length;L+=1){var j=N[L],Z=j.paint.get(a+"-pattern").value;if(Z.kind!=="constant"){var et=Z.evaluate({zoom:x-1},p,{},T.availableImages),ot=Z.evaluate({zoom:x},p,{},T.availableImages),At=Z.evaluate({zoom:x+1},p,{},T.availableImages);ot=ot&&ot.name?ot.name:ot,At=At&&At.name?At.name:At,M[et=et&&et.name?et.name:et]=!0,M[ot]=!0,M[At]=!0,p.patterns[j.id]={min:et,mid:ot,max:At}}}return p}Rm.deviation=function(a,u,p,x){var T=u&&u.length,M=Math.abs(Rv(a,0,T?u[0]*p:a.length,p));if(T)for(var L=0,N=u.length;L<N;L++)M-=Math.abs(Rv(a,u[L]*p,L<N-1?u[L+1]*p:a.length,p));var j=0;for(L=0;L<x.length;L+=3){var Z=x[L]*p,et=x[L+1]*p,ot=x[L+2]*p;j+=Math.abs((a[Z]-a[ot])*(a[et+1]-a[Z+1])-(a[Z]-a[et])*(a[ot+1]-a[Z+1]))}return M===0&&j===0?0:Math.abs((j-M)/M)},Rm.flatten=function(a){for(var u=a[0][0].length,p={vertices:[],holes:[],dimensions:u},x=0,T=0;T<a.length;T++){for(var M=0;M<a[T].length;M++)for(var L=0;L<u;L++)p.vertices.push(a[T][M][L]);T>0&&p.holes.push(x+=a[T-1].length)}return p},Iv.default=$k;var tl=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Po,this.indexArray=new xs,this.indexArray2=new Ul,this.programConfigurations=new ze(a.layers,a.zoom),this.segments=new Ct,this.segments2=new Ct,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};tl.prototype.populate=function(a,u,p){this.hasPattern=Dv("fill",this.layers,u);for(var x=this.layers[0].layout.get("fill-sort-key"),T=[],M=0,L=a;M<L.length;M+=1){var N=L[M],j=N.feature,Z=N.id,et=N.index,ot=N.sourceLayerIndex,At=this.layers[0]._featureFilter.needGeometry,bt=We(j,At);if(this.layers[0]._featureFilter.filter(new un(this.zoom),bt,p)){var Vt=x?x.evaluate(bt,{},p,u.availableImages):void 0,jt={id:Z,properties:j.properties,type:j.type,sourceLayerIndex:ot,index:et,geometry:At?bt.geometry:ai(j),patterns:{},sortKey:Vt};T.push(jt)}}x&&T.sort(function(Je,ri){return Je.sortKey-ri.sortKey});for(var Qt=0,Zt=T;Qt<Zt.length;Qt+=1){var re=Zt[Qt],pe=re.geometry,be=re.index,we=re.sourceLayerIndex;if(this.hasPattern){var Ne=kv("fill",this.layers,re,this.zoom,u);this.patternFeatures.push(Ne)}else this.addFeature(re,pe,be,p,{});u.featureIndex.insert(a[be].feature,pe,be,we,this.index)}},tl.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},tl.prototype.addFeatures=function(a,u,p){for(var x=0,T=this.patternFeatures;x<T.length;x+=1){var M=T[x];this.addFeature(M,M.geometry,M.index,u,p)}},tl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},tl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},tl.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Jk),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},tl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},tl.prototype.addFeature=function(a,u,p,x,T){for(var M=0,L=Lv(u,500);M<L.length;M+=1){for(var N=L[M],j=0,Z=0,et=N;Z<et.length;Z+=1)j+=et[Z].length;for(var ot=this.segments.prepareSegment(j,this.layoutVertexArray,this.indexArray),At=ot.vertexLength,bt=[],Vt=[],jt=0,Qt=N;jt<Qt.length;jt+=1){var Zt=Qt[jt];if(Zt.length!==0){Zt!==N[0]&&Vt.push(bt.length/2);var re=this.segments2.prepareSegment(Zt.length,this.layoutVertexArray,this.indexArray2),pe=re.vertexLength;this.layoutVertexArray.emplaceBack(Zt[0].x,Zt[0].y),this.indexArray2.emplaceBack(pe+Zt.length-1,pe),bt.push(Zt[0].x),bt.push(Zt[0].y);for(var be=1;be<Zt.length;be++)this.layoutVertexArray.emplaceBack(Zt[be].x,Zt[be].y),this.indexArray2.emplaceBack(pe+be-1,pe+be),bt.push(Zt[be].x),bt.push(Zt[be].y);re.vertexLength+=Zt.length,re.primitiveLength+=Zt.length}}for(var we=Iv(bt,Vt),Ne=0;Ne<we.length;Ne+=3)this.indexArray.emplaceBack(At+we[Ne],At+we[Ne+1],At+we[Ne+2]);ot.vertexLength+=j,ot.primitiveLength+=we.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,T,x)},ci("FillBucket",tl,{omit:["layers","patternFeatures"]});var fO=new Kr({"fill-sort-key":new pi(lt.layout_fill["fill-sort-key"])}),dO={paint:new Kr({"fill-antialias":new Ii(lt.paint_fill["fill-antialias"]),"fill-opacity":new pi(lt.paint_fill["fill-opacity"]),"fill-color":new pi(lt.paint_fill["fill-color"]),"fill-outline-color":new pi(lt.paint_fill["fill-outline-color"]),"fill-translate":new Ii(lt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ii(lt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ec(lt.paint_fill["fill-pattern"])}),layout:fO},pO=(function(a){function u(p){a.call(this,p,dO)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x);var T=this.paint._values["fill-outline-color"];T.value.kind==="constant"&&T.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(p){return new tl(p)},u.prototype.queryRadius=function(){return Zr(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(p,x,T,M,L,N,j){return or($a(p,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,j),M)},u.prototype.isTileClipped=function(){return!0},u})(jo),AO=zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,V3=Hf;function Hf(a,u,p,x,T){this.properties={},this.extent=p,this.type=0,this._pbf=a,this._geometry=-1,this._keys=x,this._values=T,a.readFields(mO,this,u)}function mO(a,u,p){a==1?u.id=p.readVarint():a==2?(function(x,T){for(var M=x.readVarint()+x.pos;x.pos<M;){var L=T._keys[x.readVarint()],N=T._values[x.readVarint()];T.properties[L]=N}})(p,u):a==3?u.type=p.readVarint():a==4&&(u._geometry=p.pos)}function gO(a){for(var u,p,x=0,T=0,M=a.length,L=M-1;T<M;L=T++)x+=((p=a[L]).x-(u=a[T]).x)*(u.y+p.y);return x}Hf.types=["Unknown","Point","LineString","Polygon"],Hf.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var u,p=a.readVarint()+a.pos,x=1,T=0,M=0,L=0,N=[];a.pos<p;){if(T<=0){var j=a.readVarint();x=7&j,T=j>>3}if(T--,x===1||x===2)M+=a.readSVarint(),L+=a.readSVarint(),x===1&&(u&&N.push(u),u=[]),u.push(new _(M,L));else{if(x!==7)throw new Error("unknown command "+x);u&&u.push(u[0].clone())}}return u&&N.push(u),N},Hf.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var u=a.readVarint()+a.pos,p=1,x=0,T=0,M=0,L=1/0,N=-1/0,j=1/0,Z=-1/0;a.pos<u;){if(x<=0){var et=a.readVarint();p=7&et,x=et>>3}if(x--,p===1||p===2)(T+=a.readSVarint())<L&&(L=T),T>N&&(N=T),(M+=a.readSVarint())<j&&(j=M),M>Z&&(Z=M);else if(p!==7)throw new Error("unknown command "+p)}return[L,j,N,Z]},Hf.prototype.toGeoJSON=function(a,u,p){var x,T,M=this.extent*Math.pow(2,p),L=this.extent*a,N=this.extent*u,j=this.loadGeometry(),Z=Hf.types[this.type];function et(bt){for(var Vt=0;Vt<bt.length;Vt++){var jt=bt[Vt];bt[Vt]=[360*(jt.x+L)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(jt.y+N)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var ot=[];for(x=0;x<j.length;x++)ot[x]=j[x][0];et(j=ot);break;case 2:for(x=0;x<j.length;x++)et(j[x]);break;case 3:for(j=(function(bt){var Vt=bt.length;if(Vt<=1)return[bt];for(var jt,Qt,Zt=[],re=0;re<Vt;re++){var pe=gO(bt[re]);pe!==0&&(Qt===void 0&&(Qt=pe<0),Qt===pe<0?(jt&&Zt.push(jt),jt=[bt[re]]):jt.push(bt[re]))}return jt&&Zt.push(jt),Zt})(j),x=0;x<j.length;x++)for(T=0;T<j[x].length;T++)et(j[x][T])}j.length===1?j=j[0]:Z="Multi"+Z;var At={type:"Feature",geometry:{type:Z,coordinates:j},properties:this.properties};return"id"in this&&(At.id=this.id),At};var G3=j3;function j3(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(yO,this,u),this.length=this._features.length}function yO(a,u,p){a===15?u.version=p.readVarint():a===1?u.name=p.readString():a===5?u.extent=p.readVarint():a===2?u._features.push(p.pos):a===3?u._keys.push(p.readString()):a===4&&u._values.push((function(x){for(var T=null,M=x.readVarint()+x.pos;x.pos<M;){var L=x.readVarint()>>3;T=L===1?x.readString():L===2?x.readFloat():L===3?x.readDouble():L===4?x.readVarint64():L===5?x.readVarint():L===6?x.readSVarint():L===7?x.readBoolean():null}return T})(p))}function vO(a,u,p){if(a===3){var x=new G3(p,p.readVarint()+p.pos);x.length&&(u[x.name]=x)}}j3.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new V3(this._pbf,u,this.extent,this._keys,this._values)};var Xf={VectorTile:function(a,u){this.layers=a.readFields(vO,{},u)},VectorTileFeature:V3,VectorTileLayer:G3},_O=Xf.VectorTileFeature.types,Ov=Math.pow(2,13);function Zp(a,u,p,x,T,M,L,N){a.emplaceBack(u,p,2*Math.floor(x*Ov)+L,T*Ov*2,M*Ov*2,Math.round(N))}var el=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new sa,this.indexArray=new xs,this.programConfigurations=new ze(a.layers,a.zoom),this.segments=new Ct,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function bO(a,u){return a.x===u.x&&(a.x<0||a.x>8192)||a.y===u.y&&(a.y<0||a.y>8192)}el.prototype.populate=function(a,u,p){this.features=[],this.hasPattern=Dv("fill-extrusion",this.layers,u);for(var x=0,T=a;x<T.length;x+=1){var M=T[x],L=M.feature,N=M.id,j=M.index,Z=M.sourceLayerIndex,et=this.layers[0]._featureFilter.needGeometry,ot=We(L,et);if(this.layers[0]._featureFilter.filter(new un(this.zoom),ot,p)){var At={id:N,sourceLayerIndex:Z,index:j,geometry:et?ot.geometry:ai(L),properties:L.properties,type:L.type,patterns:{}};this.hasPattern?this.features.push(kv("fill-extrusion",this.layers,At,this.zoom,u)):this.addFeature(At,At.geometry,j,p,{}),u.featureIndex.insert(L,At.geometry,j,Z,this.index,!0)}}},el.prototype.addFeatures=function(a,u,p){for(var x=0,T=this.features;x<T.length;x+=1){var M=T[x];this.addFeature(M,M.geometry,M.index,u,p)}},el.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},el.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},el.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},el.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,AO),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},el.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},el.prototype.addFeature=function(a,u,p,x,T){for(var M=0,L=Lv(u,500);M<L.length;M+=1){for(var N=L[M],j=0,Z=0,et=N;Z<et.length;Z+=1)j+=et[Z].length;for(var ot=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),At=0,bt=N;At<bt.length;At+=1){var Vt=bt[At];if(Vt.length!==0&&!((yn=Vt).every(function(tn){return tn.x<0})||yn.every(function(tn){return tn.x>8192})||yn.every(function(tn){return tn.y<0})||yn.every(function(tn){return tn.y>8192})))for(var jt=0,Qt=0;Qt<Vt.length;Qt++){var Zt=Vt[Qt];if(Qt>=1){var re=Vt[Qt-1];if(!bO(Zt,re)){ot.vertexLength+4>Ct.MAX_VERTEX_ARRAY_LENGTH&&(ot=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var pe=Zt.sub(re)._perp()._unit(),be=re.dist(Zt);jt+be>32768&&(jt=0),Zp(this.layoutVertexArray,Zt.x,Zt.y,pe.x,pe.y,0,0,jt),Zp(this.layoutVertexArray,Zt.x,Zt.y,pe.x,pe.y,0,1,jt),Zp(this.layoutVertexArray,re.x,re.y,pe.x,pe.y,0,0,jt+=be),Zp(this.layoutVertexArray,re.x,re.y,pe.x,pe.y,0,1,jt);var we=ot.vertexLength;this.indexArray.emplaceBack(we,we+2,we+1),this.indexArray.emplaceBack(we+1,we+2,we+3),ot.vertexLength+=4,ot.primitiveLength+=2}}}}if(ot.vertexLength+j>Ct.MAX_VERTEX_ARRAY_LENGTH&&(ot=this.segments.prepareSegment(j,this.layoutVertexArray,this.indexArray)),_O[a.type]==="Polygon"){for(var Ne=[],Je=[],ri=ot.vertexLength,Si=0,li=N;Si<li.length;Si+=1){var Li=li[Si];if(Li.length!==0){Li!==N[0]&&Je.push(Ne.length/2);for(var ui=0;ui<Li.length;ui++){var an=Li[ui];Zp(this.layoutVertexArray,an.x,an.y,0,0,1,1,0),Ne.push(an.x),Ne.push(an.y)}}}for(var Vi=Iv(Ne,Je),gi=0;gi<Vi.length;gi+=3)this.indexArray.emplaceBack(ri+Vi[gi],ri+Vi[gi+2],ri+Vi[gi+1]);ot.primitiveLength+=Vi.length/3,ot.vertexLength+=j}}var yn;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,T,x)},ci("FillExtrusionBucket",el,{omit:["layers","features"]});var xO={paint:new Kr({"fill-extrusion-opacity":new Ii(lt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pi(lt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ii(lt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ii(lt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ec(lt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pi(lt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pi(lt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ii(lt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},wO=(function(a){function u(p){a.call(this,p,xO)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new el(p)},u.prototype.queryRadius=function(){return Zr(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(p,x,T,M,L,N,j,Z){var et=$a(p,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,j),ot=this.paint.get("fill-extrusion-height").evaluate(x,T),At=this.paint.get("fill-extrusion-base").evaluate(x,T),bt=(function(jt,Qt,Zt,re){for(var pe=[],be=0,we=jt;be<we.length;be+=1){var Ne=we[be],Je=[Ne.x,Ne.y,0,1];Gf(Je,Je,Qt),pe.push(new _(Je[0]/Je[3],Je[1]/Je[3]))}return pe})(et,Z),Vt=(function(jt,Qt,Zt,re){for(var pe=[],be=[],we=re[8]*Qt,Ne=re[9]*Qt,Je=re[10]*Qt,ri=re[11]*Qt,Si=re[8]*Zt,li=re[9]*Zt,Li=re[10]*Zt,ui=re[11]*Zt,an=0,Vi=jt;an<Vi.length;an+=1){for(var gi=[],yn=[],tn=0,Cn=Vi[an];tn<Cn.length;tn+=1){var Di=Cn[tn],Pn=Di.x,lr=Di.y,Er=re[0]*Pn+re[4]*lr+re[12],yr=re[1]*Pn+re[5]*lr+re[13],ur=re[2]*Pn+re[6]*lr+re[14],Cr=re[3]*Pn+re[7]*lr+re[15],Yr=ur+Je,Qr=Cr+ri,Vs=Er+Si,as=yr+li,Gs=ur+Li,Ir=Cr+ui,ls=new _((Er+we)/Qr,(yr+Ne)/Qr);ls.z=Yr/Qr,gi.push(ls);var _n=new _(Vs/Ir,as/Ir);_n.z=Gs/Ir,yn.push(_n)}pe.push(gi),be.push(yn)}return[pe,be]})(M,At,ot,Z);return(function(jt,Qt,Zt){var re=1/0;or(Zt,Qt)&&(re=W3(Zt,Qt[0]));for(var pe=0;pe<Qt.length;pe++)for(var be=Qt[pe],we=jt[pe],Ne=0;Ne<be.length-1;Ne++){var Je=be[Ne],ri=[Je,be[Ne+1],we[Ne+1],we[Ne],Je];Zi(Zt,ri)&&(re=Math.min(re,W3(Zt,ri)))}return re!==1/0&&re})(Vt[0],Vt[1],bt)},u})(jo);function Yp(a,u){return a.x*u.x+a.y*u.y}function W3(a,u){if(a.length===1){for(var p,x=0,T=u[x++];!p||T.equals(p);)if(!(p=u[x++]))return 1/0;for(;x<u.length;x++){var M=u[x],L=a[0],N=p.sub(T),j=M.sub(T),Z=L.sub(T),et=Yp(N,N),ot=Yp(N,j),At=Yp(j,j),bt=Yp(Z,N),Vt=Yp(Z,j),jt=et*At-ot*ot,Qt=(At*bt-ot*Vt)/jt,Zt=(et*Vt-ot*bt)/jt,re=T.z*(1-Qt-Zt)+p.z*Qt+M.z*Zt;if(isFinite(re))return re}return 1/0}for(var pe=1/0,be=0,we=u;be<we.length;be+=1)pe=Math.min(pe,we[be].z);return pe}var EO=zr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,CO=zr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,TO=Xf.VectorTileFeature.types,SO=Math.cos(Math.PI/180*37.5),H3=Math.pow(2,14)/.5,Js=function(a){var u=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(p){return p.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(p){u.gradients[p.id]={}}),this.layoutVertexArray=new zs,this.layoutVertexArray2=new Fl,this.indexArray=new xs,this.programConfigurations=new ze(a.layers,a.zoom),this.segments=new Ct,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(p){return p.isStateDependent()}).map(function(p){return p.id})};Js.prototype.populate=function(a,u,p){this.hasPattern=Dv("line",this.layers,u);for(var x=this.layers[0].layout.get("line-sort-key"),T=[],M=0,L=a;M<L.length;M+=1){var N=L[M],j=N.feature,Z=N.id,et=N.index,ot=N.sourceLayerIndex,At=this.layers[0]._featureFilter.needGeometry,bt=We(j,At);if(this.layers[0]._featureFilter.filter(new un(this.zoom),bt,p)){var Vt=x?x.evaluate(bt,{},p):void 0,jt={id:Z,properties:j.properties,type:j.type,sourceLayerIndex:ot,index:et,geometry:At?bt.geometry:ai(j),patterns:{},sortKey:Vt};T.push(jt)}}x&&T.sort(function(Je,ri){return Je.sortKey-ri.sortKey});for(var Qt=0,Zt=T;Qt<Zt.length;Qt+=1){var re=Zt[Qt],pe=re.geometry,be=re.index,we=re.sourceLayerIndex;if(this.hasPattern){var Ne=kv("line",this.layers,re,this.zoom,u);this.patternFeatures.push(Ne)}else this.addFeature(re,pe,be,p,{});u.featureIndex.insert(a[be].feature,pe,be,we,this.index)}},Js.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},Js.prototype.addFeatures=function(a,u,p){for(var x=0,T=this.patternFeatures;x<T.length;x+=1){var M=T[x];this.addFeature(M,M.geometry,M.index,u,p)}},Js.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Js.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Js.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,CO)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,EO),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Js.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Js.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Js.prototype.addFeature=function(a,u,p,x,T){var M=this.layers[0].layout,L=M.get("line-join").evaluate(a,{}),N=M.get("line-cap"),j=M.get("line-miter-limit"),Z=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var et=0,ot=u;et<ot.length;et+=1)this.addLine(ot[et],a,L,N,j,Z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,T,x)},Js.prototype.addLine=function(a,u,p,x,T,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var L=0;L<a.length-1;L++)this.totalDistance+=a[L].dist(a[L+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var N=TO[u.type]==="Polygon",j=a.length;j>=2&&a[j-1].equals(a[j-2]);)j--;for(var Z=0;Z<j-1&&a[Z].equals(a[Z+1]);)Z++;if(!(j<(N?3:2))){p==="bevel"&&(T=1.05);var et,ot=this.overscaling<=16?122880/(512*this.overscaling):0,At=this.segments.prepareSegment(10*j,this.layoutVertexArray,this.indexArray),bt=void 0,Vt=void 0,jt=void 0,Qt=void 0;this.e1=this.e2=-1,N&&(Qt=a[Z].sub(et=a[j-2])._unit()._perp());for(var Zt=Z;Zt<j;Zt++)if(!(Vt=Zt===j-1?N?a[Z+1]:void 0:a[Zt+1])||!a[Zt].equals(Vt)){Qt&&(jt=Qt),et&&(bt=et),et=a[Zt],Qt=Vt?Vt.sub(et)._unit()._perp():jt;var re=(jt=jt||Qt).add(Qt);re.x===0&&re.y===0||re._unit();var pe=jt.x*Qt.x+jt.y*Qt.y,be=re.x*Qt.x+re.y*Qt.y,we=be!==0?1/be:1/0,Ne=2*Math.sqrt(2-2*be),Je=be<SO&&bt&&Vt,ri=jt.x*Qt.y-jt.y*Qt.x>0;if(Je&&Zt>Z){var Si=et.dist(bt);if(Si>2*ot){var li=et.sub(et.sub(bt)._mult(ot/Si)._round());this.updateDistance(bt,li),this.addCurrentVertex(li,jt,0,0,At),bt=li}}var Li=bt&&Vt,ui=Li?p:N?"butt":x;if(Li&&ui==="round"&&(we<M?ui="miter":we<=2&&(ui="fakeround")),ui==="miter"&&we>T&&(ui="bevel"),ui==="bevel"&&(we>2&&(ui="flipbevel"),we<T&&(ui="miter")),bt&&this.updateDistance(bt,et),ui==="miter")re._mult(we),this.addCurrentVertex(et,re,0,0,At);else if(ui==="flipbevel"){if(we>100)re=Qt.mult(-1);else{var an=we*jt.add(Qt).mag()/jt.sub(Qt).mag();re._perp()._mult(an*(ri?-1:1))}this.addCurrentVertex(et,re,0,0,At),this.addCurrentVertex(et,re.mult(-1),0,0,At)}else if(ui==="bevel"||ui==="fakeround"){var Vi=-Math.sqrt(we*we-1),gi=ri?Vi:0,yn=ri?0:Vi;if(bt&&this.addCurrentVertex(et,jt,gi,yn,At),ui==="fakeround")for(var tn=Math.round(180*Ne/Math.PI/20),Cn=1;Cn<tn;Cn++){var Di=Cn/tn;if(Di!==.5){var Pn=Di-.5;Di+=Di*Pn*(Di-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Pn*Pn+(.848013+pe*(.215638*pe-1.06021)))}var lr=Qt.sub(jt)._mult(Di)._add(jt)._unit()._mult(ri?-1:1);this.addHalfVertex(et,lr.x,lr.y,!1,ri,0,At)}Vt&&this.addCurrentVertex(et,Qt,-gi,-yn,At)}else if(ui==="butt")this.addCurrentVertex(et,re,0,0,At);else if(ui==="square"){var Er=bt?1:-1;this.addCurrentVertex(et,re,Er,Er,At)}else ui==="round"&&(bt&&(this.addCurrentVertex(et,jt,0,0,At),this.addCurrentVertex(et,jt,1,1,At,!0)),Vt&&(this.addCurrentVertex(et,Qt,-1,-1,At,!0),this.addCurrentVertex(et,Qt,0,0,At)));if(Je&&Zt<j-1){var yr=et.dist(Vt);if(yr>2*ot){var ur=et.add(Vt.sub(et)._mult(ot/yr)._round());this.updateDistance(et,ur),this.addCurrentVertex(ur,Qt,0,0,At),et=ur}}}}},Js.prototype.addCurrentVertex=function(a,u,p,x,T,M){M===void 0&&(M=!1);var L=u.y*x-u.x,N=-u.y-u.x*x;this.addHalfVertex(a,u.x+u.y*p,u.y-u.x*p,M,!1,p,T),this.addHalfVertex(a,L,N,M,!0,-x,T),this.distance>H3/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,u,p,x,T,M))},Js.prototype.addHalfVertex=function(a,u,p,x,T,M,L){var N=.5*(this.lineClips?this.scaledDistance*(H3-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(x?1:0),(a.y<<1)+(T?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(M===0?0:M<0?-1:1)|(63&N)<<2,N>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var j=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),L.primitiveLength++),T?this.e2=j:this.e1=j},Js.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Js.prototype.updateDistance=function(a,u){this.distance+=a.dist(u),this.updateScaledDistance()},ci("LineBucket",Js,{omit:["layers","patternFeatures"]});var PO=new Kr({"line-cap":new Ii(lt.layout_line["line-cap"]),"line-join":new pi(lt.layout_line["line-join"]),"line-miter-limit":new Ii(lt.layout_line["line-miter-limit"]),"line-round-limit":new Ii(lt.layout_line["line-round-limit"]),"line-sort-key":new pi(lt.layout_line["line-sort-key"])}),X3={paint:new Kr({"line-opacity":new pi(lt.paint_line["line-opacity"]),"line-color":new pi(lt.paint_line["line-color"]),"line-translate":new Ii(lt.paint_line["line-translate"]),"line-translate-anchor":new Ii(lt.paint_line["line-translate-anchor"]),"line-width":new pi(lt.paint_line["line-width"]),"line-gap-width":new pi(lt.paint_line["line-gap-width"]),"line-offset":new pi(lt.paint_line["line-offset"]),"line-blur":new pi(lt.paint_line["line-blur"]),"line-dasharray":new cs(lt.paint_line["line-dasharray"]),"line-pattern":new Ec(lt.paint_line["line-pattern"]),"line-gradient":new So(lt.paint_line["line-gradient"])}),layout:PO},q3=new((function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(p,x){return x=new un(Math.floor(x.zoom),{now:x.now,fadeDuration:x.fadeDuration,zoomHistory:x.zoomHistory,transition:x.transition}),a.prototype.possiblyEvaluate.call(this,p,x)},u.prototype.evaluate=function(p,x,T,M){return x=$({},x,{zoom:Math.floor(x.zoom)}),a.prototype.evaluate.call(this,p,x,T,M)},u})(pi))(X3.paint.properties["line-width"].specification);q3.useIntegerZoom=!0;var IO=(function(a){function u(p){a.call(this,p,X3),this.gradientVersion=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ys,this.gradientVersion=(this.gradientVersion+1)%k)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x),this.paint._values["line-floorwidth"]=q3.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,p)},u.prototype.createBucket=function(p){return new Js(p)},u.prototype.queryRadius=function(p){var x=p,T=K3(Sa("line-width",this,x),Sa("line-gap-width",this,x)),M=Sa("line-offset",this,x);return T/2+Math.abs(M)+Zr(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(p,x,T,M,L,N,j){var Z=$a(p,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,j),et=j/2*K3(this.paint.get("line-width").evaluate(x,T),this.paint.get("line-gap-width").evaluate(x,T)),ot=this.paint.get("line-offset").evaluate(x,T);return ot&&(M=(function(At,bt){for(var Vt=[],jt=new _(0,0),Qt=0;Qt<At.length;Qt++){for(var Zt=At[Qt],re=[],pe=0;pe<Zt.length;pe++){var be=Zt[pe],we=Zt[pe+1],Ne=pe===0?jt:be.sub(Zt[pe-1])._unit()._perp(),Je=pe===Zt.length-1?jt:we.sub(be)._unit()._perp(),ri=Ne._add(Je)._unit();ri._mult(1/(ri.x*Je.x+ri.y*Je.y)),re.push(ri._mult(bt)._add(be))}Vt.push(re)}return Vt})(M,ot*j)),(function(At,bt,Vt){for(var jt=0;jt<bt.length;jt++){var Qt=bt[jt];if(At.length>=3){for(var Zt=0;Zt<Qt.length;Zt++)if(Ta(At,Qt[Zt]))return!0}if(Ys(At,Qt,Vt))return!0}return!1})(Z,M,et)},u.prototype.isTileClipped=function(){return!0},u})(jo);function K3(a,u){return u>0?u+2*a:a}var MO=zr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),BO=zr([{name:"a_projected_pos",components:3,type:"Float32"}],4),RO=(zr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),zr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Z3=(zr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),LO=zr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function DO(a,u,p){return a.sections.forEach(function(x){x.text=(function(T,M,L){var N=M.layout.get("text-transform").evaluate(L,{});return N==="uppercase"?T=T.toLocaleUpperCase():N==="lowercase"&&(T=T.toLocaleLowerCase()),rs.applyArabicShaping&&(T=rs.applyArabicShaping(T)),T})(x.text,u,p)}),a}zr([{name:"triangle",components:3,type:"Uint16"}]),zr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),zr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),zr([{type:"Float32",name:"offsetX"}]),zr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Qp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Y3=function(a,u,p,x,T){var M,L,N=8*T-x-1,j=(1<<N)-1,Z=j>>1,et=-7,ot=T-1,At=-1,bt=a[u+ot];for(ot+=At,M=bt&(1<<-et)-1,bt>>=-et,et+=N;et>0;M=256*M+a[u+ot],ot+=At,et-=8);for(L=M&(1<<-et)-1,M>>=-et,et+=x;et>0;L=256*L+a[u+ot],ot+=At,et-=8);if(M===0)M=1-Z;else{if(M===j)return L?NaN:1/0*(bt?-1:1);L+=Math.pow(2,x),M-=Z}return(bt?-1:1)*L*Math.pow(2,M-x)},Q3=function(a,u,p,x,T,M){var L,N,j,Z=8*M-T-1,et=(1<<Z)-1,ot=et>>1,At=T===23?Math.pow(2,-24)-Math.pow(2,-77):0,bt=0,Vt=1,jt=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(N=isNaN(u)?1:0,L=et):(L=Math.floor(Math.log(u)/Math.LN2),u*(j=Math.pow(2,-L))<1&&(L--,j*=2),(u+=L+ot>=1?At/j:At*Math.pow(2,1-ot))*j>=2&&(L++,j/=2),L+ot>=et?(N=0,L=et):L+ot>=1?(N=(u*j-1)*Math.pow(2,T),L+=ot):(N=u*Math.pow(2,ot-1)*Math.pow(2,T),L=0));T>=8;a[p+bt]=255&N,bt+=Vt,N/=256,T-=8);for(L=L<<T|N,Z+=T;Z>0;a[p+bt]=255&L,bt+=Vt,L/=256,Z-=8);a[p+bt-Vt]|=128*jt},Om=Qn;function Qn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Qn.Varint=0,Qn.Fixed64=1,Qn.Bytes=2,Qn.Fixed32=5;var J3=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ru(a){return a.type===Qn.Bytes?a.readVarint()+a.pos:a.pos+1}function kO(a,u,p){return p?4294967296*u+(a>>>0):4294967296*(u>>>0)+(a>>>0)}function $3(a,u,p){var x=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));p.realloc(x);for(var T=p.pos-1;T>=a;T--)p.buf[T+x]=p.buf[T]}function OO(a,u){for(var p=0;p<a.length;p++)u.writeVarint(a[p])}function FO(a,u){for(var p=0;p<a.length;p++)u.writeSVarint(a[p])}function NO(a,u){for(var p=0;p<a.length;p++)u.writeFloat(a[p])}function zO(a,u){for(var p=0;p<a.length;p++)u.writeDouble(a[p])}function UO(a,u){for(var p=0;p<a.length;p++)u.writeBoolean(a[p])}function VO(a,u){for(var p=0;p<a.length;p++)u.writeFixed32(a[p])}function GO(a,u){for(var p=0;p<a.length;p++)u.writeSFixed32(a[p])}function jO(a,u){for(var p=0;p<a.length;p++)u.writeFixed64(a[p])}function WO(a,u){for(var p=0;p<a.length;p++)u.writeSFixed64(a[p])}function Fm(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+16777216*a[u+3]}function qf(a,u,p){a[p]=u,a[p+1]=u>>>8,a[p+2]=u>>>16,a[p+3]=u>>>24}function tE(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+(a[u+3]<<24)}function HO(a,u,p){a===1&&p.readMessage(XO,u)}function XO(a,u,p){if(a===3){var x=p.readMessage(qO,{}),T=x.width,M=x.height,L=x.left,N=x.top,j=x.advance;u.push({id:x.id,bitmap:new Th({width:T+6,height:M+6},x.bitmap),metrics:{width:T,height:M,left:L,top:N,advance:j}})}}function qO(a,u,p){a===1?u.id=p.readVarint():a===2?u.bitmap=p.readBytes():a===3?u.width=p.readVarint():a===4?u.height=p.readVarint():a===5?u.left=p.readSVarint():a===6?u.top=p.readSVarint():a===7&&(u.advance=p.readVarint())}function eE(a){for(var u=0,p=0,x=0,T=a;x<T.length;x+=1){var M=T[x];u+=M.w*M.h,p=Math.max(p,M.w)}a.sort(function(jt,Qt){return Qt.h-jt.h});for(var L=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),p),h:1/0}],N=0,j=0,Z=0,et=a;Z<et.length;Z+=1)for(var ot=et[Z],At=L.length-1;At>=0;At--){var bt=L[At];if(!(ot.w>bt.w||ot.h>bt.h)){if(ot.x=bt.x,ot.y=bt.y,j=Math.max(j,ot.y+ot.h),N=Math.max(N,ot.x+ot.w),ot.w===bt.w&&ot.h===bt.h){var Vt=L.pop();At<L.length&&(L[At]=Vt)}else ot.h===bt.h?(bt.x+=ot.w,bt.w-=ot.w):ot.w===bt.w?(bt.y+=ot.h,bt.h-=ot.h):(L.push({x:bt.x+ot.w,y:bt.y,w:bt.w-ot.w,h:ot.h}),bt.y+=ot.h,bt.h-=ot.h);break}}return{w:N,h:j,fill:u/(N*j)||0}}Qn.prototype={destroy:function(){this.buf=null},readFields:function(a,u,p){for(p=p||this.length;this.pos<p;){var x=this.readVarint(),T=x>>3,M=this.pos;this.type=7&x,a(T,u,this),this.pos===M&&this.skip(x)}return u},readMessage:function(a,u){return this.readFields(a,u,this.readVarint()+this.pos)},readFixed32:function(){var a=Fm(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=tE(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Fm(this.buf,this.pos)+4294967296*Fm(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Fm(this.buf,this.pos)+4294967296*tE(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=Y3(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Y3(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var u,p,x=this.buf;return u=127&(p=x[this.pos++]),p<128?u:(u|=(127&(p=x[this.pos++]))<<7,p<128?u:(u|=(127&(p=x[this.pos++]))<<14,p<128?u:(u|=(127&(p=x[this.pos++]))<<21,p<128?u:(function(T,M,L){var N,j,Z=L.buf;if(N=(112&(j=Z[L.pos++]))>>4,j<128||(N|=(127&(j=Z[L.pos++]))<<3,j<128)||(N|=(127&(j=Z[L.pos++]))<<10,j<128)||(N|=(127&(j=Z[L.pos++]))<<17,j<128)||(N|=(127&(j=Z[L.pos++]))<<24,j<128)||(N|=(1&(j=Z[L.pos++]))<<31,j<128))return kO(T,N,M);throw new Error("Expected varint not more than 10 bytes")})(u|=(15&(p=x[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&J3?(function(p,x,T){return J3.decode(p.subarray(x,T))})(this.buf,u,a):(function(p,x,T){for(var M="",L=x;L<T;){var N,j,Z,et=p[L],ot=null,At=et>239?4:et>223?3:et>191?2:1;if(L+At>T)break;At===1?et<128&&(ot=et):At===2?(192&(N=p[L+1]))==128&&(ot=(31&et)<<6|63&N)<=127&&(ot=null):At===3?(j=p[L+2],(192&(N=p[L+1]))==128&&(192&j)==128&&((ot=(15&et)<<12|(63&N)<<6|63&j)<=2047||ot>=55296&&ot<=57343)&&(ot=null)):At===4&&(j=p[L+2],Z=p[L+3],(192&(N=p[L+1]))==128&&(192&j)==128&&(192&Z)==128&&((ot=(15&et)<<18|(63&N)<<12|(63&j)<<6|63&Z)<=65535||ot>=1114112)&&(ot=null)),ot===null?(ot=65533,At=1):ot>65535&&(ot-=65536,M+=String.fromCharCode(ot>>>10&1023|55296),ot=56320|1023&ot),M+=String.fromCharCode(ot),L+=At}return M})(this.buf,u,a)},readBytes:function(){var a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u},readPackedVarint:function(a,u){if(this.type!==Qn.Bytes)return a.push(this.readVarint(u));var p=Ru(this);for(a=a||[];this.pos<p;)a.push(this.readVarint(u));return a},readPackedSVarint:function(a){if(this.type!==Qn.Bytes)return a.push(this.readSVarint());var u=Ru(this);for(a=a||[];this.pos<u;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Qn.Bytes)return a.push(this.readBoolean());var u=Ru(this);for(a=a||[];this.pos<u;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Qn.Bytes)return a.push(this.readFloat());var u=Ru(this);for(a=a||[];this.pos<u;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Qn.Bytes)return a.push(this.readDouble());var u=Ru(this);for(a=a||[];this.pos<u;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Qn.Bytes)return a.push(this.readFixed32());var u=Ru(this);for(a=a||[];this.pos<u;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Qn.Bytes)return a.push(this.readSFixed32());var u=Ru(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Qn.Bytes)return a.push(this.readFixed64());var u=Ru(this);for(a=a||[];this.pos<u;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Qn.Bytes)return a.push(this.readSFixed64());var u=Ru(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed64());return a},skip:function(a){var u=7&a;if(u===Qn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Qn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Qn.Fixed32)this.pos+=4;else{if(u!==Qn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(a,u){this.writeVarint(a<<3|u)},realloc:function(a){for(var u=this.length||16;u<this.pos+a;)u*=2;if(u!==this.length){var p=new Uint8Array(u);p.set(this.buf),this.buf=p,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),qf(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),qf(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),qf(this.buf,-1&a,this.pos),qf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),qf(this.buf,-1&a,this.pos),qf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?(function(u,p){var x,T;if(u>=0?(x=u%4294967296|0,T=u/4294967296|0):(T=~(-u/4294967296),4294967295^(x=~(-u%4294967296))?x=x+1|0:(x=0,T=T+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(M,L,N){N.buf[N.pos++]=127&M|128,M>>>=7,N.buf[N.pos++]=127&M|128,M>>>=7,N.buf[N.pos++]=127&M|128,M>>>=7,N.buf[N.pos++]=127&M|128,N.buf[N.pos]=127&(M>>>=7)})(x,0,p),(function(M,L){var N=(7&M)<<4;L.buf[L.pos++]|=N|((M>>>=3)?128:0),M&&(L.buf[L.pos++]=127&M|((M>>>=7)?128:0),M&&(L.buf[L.pos++]=127&M|((M>>>=7)?128:0),M&&(L.buf[L.pos++]=127&M|((M>>>=7)?128:0),M&&(L.buf[L.pos++]=127&M|((M>>>=7)?128:0),M&&(L.buf[L.pos++]=127&M)))))})(T,p)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var u=this.pos;this.pos=(function(x,T,M){for(var L,N,j=0;j<T.length;j++){if((L=T.charCodeAt(j))>55295&&L<57344){if(!N){L>56319||j+1===T.length?(x[M++]=239,x[M++]=191,x[M++]=189):N=L;continue}if(L<56320){x[M++]=239,x[M++]=191,x[M++]=189,N=L;continue}L=N-55296<<10|L-56320|65536,N=null}else N&&(x[M++]=239,x[M++]=191,x[M++]=189,N=null);L<128?x[M++]=L:(L<2048?x[M++]=L>>6|192:(L<65536?x[M++]=L>>12|224:(x[M++]=L>>18|240,x[M++]=L>>12&63|128),x[M++]=L>>6&63|128),x[M++]=63&L|128)}return M})(this.buf,a,this.pos);var p=this.pos-u;p>=128&&$3(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeFloat:function(a){this.realloc(4),Q3(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Q3(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var u=a.length;this.writeVarint(u),this.realloc(u);for(var p=0;p<u;p++)this.buf[this.pos++]=a[p]},writeRawMessage:function(a,u){this.pos++;var p=this.pos;a(u,this);var x=this.pos-p;x>=128&&$3(p,x,this),this.pos=p-1,this.writeVarint(x),this.pos+=x},writeMessage:function(a,u,p){this.writeTag(a,Qn.Bytes),this.writeRawMessage(u,p)},writePackedVarint:function(a,u){u.length&&this.writeMessage(a,OO,u)},writePackedSVarint:function(a,u){u.length&&this.writeMessage(a,FO,u)},writePackedBoolean:function(a,u){u.length&&this.writeMessage(a,UO,u)},writePackedFloat:function(a,u){u.length&&this.writeMessage(a,NO,u)},writePackedDouble:function(a,u){u.length&&this.writeMessage(a,zO,u)},writePackedFixed32:function(a,u){u.length&&this.writeMessage(a,VO,u)},writePackedSFixed32:function(a,u){u.length&&this.writeMessage(a,GO,u)},writePackedFixed64:function(a,u){u.length&&this.writeMessage(a,jO,u)},writePackedSFixed64:function(a,u){u.length&&this.writeMessage(a,WO,u)},writeBytesField:function(a,u){this.writeTag(a,Qn.Bytes),this.writeBytes(u)},writeFixed32Field:function(a,u){this.writeTag(a,Qn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(a,u){this.writeTag(a,Qn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(a,u){this.writeTag(a,Qn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(a,u){this.writeTag(a,Qn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(a,u){this.writeTag(a,Qn.Varint),this.writeVarint(u)},writeSVarintField:function(a,u){this.writeTag(a,Qn.Varint),this.writeSVarint(u)},writeStringField:function(a,u){this.writeTag(a,Qn.Bytes),this.writeString(u)},writeFloatField:function(a,u){this.writeTag(a,Qn.Fixed32),this.writeFloat(u)},writeDoubleField:function(a,u){this.writeTag(a,Qn.Fixed64),this.writeDouble(u)},writeBooleanField:function(a,u){this.writeVarintField(a,!!u)}};var Nm=function(a,u){var p=u.pixelRatio,x=u.version,T=u.stretchX,M=u.stretchY,L=u.content;this.paddedRect=a,this.pixelRatio=p,this.stretchX=T,this.stretchY=M,this.content=L,this.version=x},Jp={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Jp.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Jp.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Jp.tlbr.get=function(){return this.tl.concat(this.br)},Jp.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Nm.prototype,Jp);var $p=function(a,u){var p={},x={};this.haveRenderCallbacks=[];var T=[];this.addImages(a,p,T),this.addImages(u,x,T);var M=eE(T),L=new co({width:M.w||1,height:M.h||1});for(var N in a){var j=a[N],Z=p[N].paddedRect;co.copy(j.data,L,{x:0,y:0},{x:Z.x+1,y:Z.y+1},j.data)}for(var et in u){var ot=u[et],At=x[et].paddedRect,bt=At.x+1,Vt=At.y+1,jt=ot.data.width,Qt=ot.data.height;co.copy(ot.data,L,{x:0,y:0},{x:bt,y:Vt},ot.data),co.copy(ot.data,L,{x:0,y:Qt-1},{x:bt,y:Vt-1},{width:jt,height:1}),co.copy(ot.data,L,{x:0,y:0},{x:bt,y:Vt+Qt},{width:jt,height:1}),co.copy(ot.data,L,{x:jt-1,y:0},{x:bt-1,y:Vt},{width:1,height:Qt}),co.copy(ot.data,L,{x:0,y:0},{x:bt+jt,y:Vt},{width:1,height:Qt})}this.image=L,this.iconPositions=p,this.patternPositions=x};$p.prototype.addImages=function(a,u,p){for(var x in a){var T=a[x],M={x:0,y:0,w:T.data.width+2,h:T.data.height+2};p.push(M),u[x]=new Nm(M,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(x)}},$p.prototype.patchUpdatedImages=function(a,u){for(var p in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[p],a.getImage(p),u),this.patchUpdatedImage(this.patternPositions[p],a.getImage(p),u)},$p.prototype.patchUpdatedImage=function(a,u,p){if(a&&u&&a.version!==u.version){a.version=u.version;var x=a.tl;p.update(u.data,void 0,{x:x[0],y:x[1]})}},ci("ImagePosition",Nm),ci("ImageAtlas",$p);var Wo={horizontal:1,vertical:2,horizontalOnly:3},Kf=function(){this.scale=1,this.fontStack="",this.imageName=null};Kf.forText=function(a,u){var p=new Kf;return p.scale=a||1,p.fontStack=u,p},Kf.forImage=function(a){var u=new Kf;return u.imageName=a,u};var Us=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function zm(a,u,p,x,T,M,L,N,j,Z,et,ot,At,bt,Vt,jt){var Qt,Zt=Us.fromFeature(a,T);ot===Wo.vertical&&Zt.verticalizePunctuation();var re=rs.processBidirectionalText,pe=rs.processStyledBidirectionalText;if(re&&Zt.sections.length===1){Qt=[];for(var be=0,we=re(Zt.toString(),Fv(Zt,Z,M,u,x,bt,Vt));be<we.length;be+=1){var Ne=we[be],Je=new Us;Je.text=Ne,Je.sections=Zt.sections;for(var ri=0;ri<Ne.length;ri++)Je.sectionIndex.push(0);Qt.push(Je)}}else if(pe){Qt=[];for(var Si=0,li=pe(Zt.text,Zt.sectionIndex,Fv(Zt,Z,M,u,x,bt,Vt));Si<li.length;Si+=1){var Li=li[Si],ui=new Us;ui.text=Li[0],ui.sectionIndex=Li[1],ui.sections=Zt.sections,Qt.push(ui)}}else Qt=(function(gi,yn){for(var tn=[],Cn=gi.text,Di=0,Pn=0,lr=yn;Pn<lr.length;Pn+=1){var Er=lr[Pn];tn.push(gi.substring(Di,Er)),Di=Er}return Di<Cn.length&&tn.push(gi.substring(Di,Cn.length)),tn})(Zt,Fv(Zt,Z,M,u,x,bt,Vt));var an=[],Vi={positionedLines:an,text:Zt.toString(),top:et[1],bottom:et[1],left:et[0],right:et[0],writingMode:ot,iconsInText:!1,verticalizable:!1};return(function(gi,yn,tn,Cn,Di,Pn,lr,Er,yr,ur,Cr,Yr){for(var Qr=0,Vs=-17,as=0,Gs=0,Ir=Er==="right"?1:Er==="left"?0:.5,ls=0,_n=0,Vn=Di;_n<Vn.length;_n+=1){var kn=Vn[_n];kn.trim();var Sn=kn.getMaxScale(),$s=24*(Sn-1),ws={positionedGlyphs:[],lineOffset:0};gi.positionedLines[ls]=ws;var ir=ws.positionedGlyphs,kr=0;if(kn.length()){for(var Es=0;Es<kn.length();Es++){var In=kn.getSection(Es),jl=kn.getSectionIndex(Es),Ho=kn.getCharCode(Es),Wl=0,Mr=null,Hl=null,Pa=null,id=24,Mh=!(yr===Wo.horizontal||!Cr&&!Cu(Ho)||Cr&&(Um[Ho]||(Ou=Ho,ni.Arabic(Ou)||ni["Arabic Supplement"](Ou)||ni["Arabic Extended-A"](Ou)||ni["Arabic Presentation Forms-A"](Ou)||ni["Arabic Presentation Forms-B"](Ou))));if(In.imageName){var nd=Cn[In.imageName];if(!nd)continue;Pa=In.imageName,gi.iconsInText=gi.iconsInText||!0,Hl=nd.paddedRect;var ku=nd.displaySize;In.scale=24*In.scale/Yr,Wl=$s+(24-ku[1]*In.scale),id=(Mr={width:ku[0],height:ku[1],left:1,top:-3,advance:Mh?ku[1]:ku[0]}).advance;var rd=Mh?ku[0]*In.scale-24*Sn:ku[1]*In.scale-24*Sn;rd>0&&rd>kr&&(kr=rd)}else{var Zm=tn[In.fontStack],sd=Zm&&Zm[Ho];if(sd&&sd.rect)Hl=sd.rect,Mr=sd.metrics;else{var iA=yn[In.fontStack],Ym=iA&&iA[Ho];if(!Ym)continue;Mr=Ym.metrics}Wl=24*(Sn-In.scale)}Mh?(gi.verticalizable=!0,ir.push({glyph:Ho,imageName:Pa,x:Qr,y:Vs+Wl,vertical:Mh,scale:In.scale,fontStack:In.fontStack,sectionIndex:jl,metrics:Mr,rect:Hl}),Qr+=id*In.scale+ur):(ir.push({glyph:Ho,imageName:Pa,x:Qr,y:Vs+Wl,vertical:Mh,scale:In.scale,fontStack:In.fontStack,sectionIndex:jl,metrics:Mr,rect:Hl}),Qr+=Mr.advance*In.scale+ur)}ir.length!==0&&(as=Math.max(Qr-ur,as),ZO(ir,0,ir.length-1,Ir,kr)),Qr=0;var Qm=Pn*Sn+kr;ws.lineOffset=Math.max(kr,$s),Vs+=Qm,Gs=Math.max(Qm,Gs),++ls}else Vs+=Pn,++ls}var Ou,nA=Vs- -17,od=Nv(lr),Bc=od.horizontalAlign,ad=od.verticalAlign;(function(Jm,$m,rA,sA,t0,oA,aA,lA,e0){var ld,i0=($m-rA)*t0;ld=oA!==aA?-lA*sA- -17:(-sA*e0+.5)*aA;for(var ud=0,uA=Jm;ud<uA.length;ud+=1)for(var Bh=0,cA=uA[ud].positionedGlyphs;Bh<cA.length;Bh+=1){var cd=cA[Bh];cd.x+=i0,cd.y+=ld}})(gi.positionedLines,Ir,Bc,ad,as,Gs,Pn,nA,Di.length),gi.top+=-ad*nA,gi.bottom=gi.top+nA,gi.left+=-Bc*as,gi.right=gi.left+as})(Vi,u,p,x,Qt,L,N,j,ot,Z,At,jt),!(function(gi){for(var yn=0,tn=gi;yn<tn.length;yn+=1)if(tn[yn].positionedGlyphs.length!==0)return!1;return!0})(an)&&Vi}Us.fromFeature=function(a,u){for(var p=new Us,x=0;x<a.sections.length;x++){var T=a.sections[x];T.image?p.addImageSection(T):p.addTextSection(T,u)}return p},Us.prototype.length=function(){return this.text.length},Us.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Us.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Us.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Us.prototype.verticalizePunctuation=function(){this.text=(function(a){for(var u="",p=0;p<a.length;p++){var x=a.charCodeAt(p+1)||null,T=a.charCodeAt(p-1)||null;u+=x&&yh(x)&&!Qp[a[p+1]]||T&&yh(T)&&!Qp[a[p-1]]||!Qp[a[p]]?a[p]:Qp[a[p]]}return u})(this.text)},Us.prototype.trim=function(){for(var a=0,u=0;u<this.text.length&&Um[this.text.charCodeAt(u)];u++)a++;for(var p=this.text.length,x=this.text.length-1;x>=0&&x>=a&&Um[this.text.charCodeAt(x)];x--)p--;this.text=this.text.substring(a,p),this.sectionIndex=this.sectionIndex.slice(a,p)},Us.prototype.substring=function(a,u){var p=new Us;return p.text=this.text.substring(a,u),p.sectionIndex=this.sectionIndex.slice(a,u),p.sections=this.sections,p},Us.prototype.toString=function(){return this.text},Us.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(u,p){return Math.max(u,a.sections[p].scale)},0)},Us.prototype.addTextSection=function(a,u){this.text+=a.text,this.sections.push(Kf.forText(a.scale,a.fontStack||u));for(var p=this.sections.length-1,x=0;x<a.text.length;++x)this.sectionIndex.push(p)},Us.prototype.addImageSection=function(a){var u=a.image?a.image.name:"";if(u.length!==0){var p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Kf.forImage(u)),this.sectionIndex.push(this.sections.length-1)):dt("Reached maximum number of images 6401")}else dt("Can't add FormattedSection with an empty image.")},Us.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Um={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ro={};function iE(a,u,p,x,T,M){if(u.imageName){var L=x[u.imageName];return L?L.displaySize[0]*u.scale*24/M+T:0}var N=p[u.fontStack],j=N&&N[a];return j?j.metrics.advance*u.scale+T:0}function nE(a,u,p,x){var T=Math.pow(a-u,2);return x?a<u?T/2:2*T:T+Math.abs(p)*p}function KO(a,u,p){var x=0;return a===10&&(x-=1e4),p&&(x+=150),a!==40&&a!==65288||(x+=50),u!==41&&u!==65289||(x+=50),x}function rE(a,u,p,x,T,M){for(var L=null,N=nE(u,p,T,M),j=0,Z=x;j<Z.length;j+=1){var et=Z[j],ot=nE(u-et.x,p,T,M)+et.badness;ot<=N&&(L=et,N=ot)}return{index:a,x:u,priorBreak:L,badness:N}}function Fv(a,u,p,x,T,M,L){if(M!=="point")return[];if(!a)return[];for(var N,j=[],Z=(function(Qt,Zt,re,pe,be,we){for(var Ne=0,Je=0;Je<Qt.length();Je++){var ri=Qt.getSection(Je);Ne+=iE(Qt.getCharCode(Je),ri,pe,be,Zt,we)}return Ne/Math.max(1,Math.ceil(Ne/re))})(a,u,p,x,T,L),et=a.text.indexOf("")>=0,ot=0,At=0;At<a.length();At++){var bt=a.getSection(At),Vt=a.getCharCode(At);if(Um[Vt]||(ot+=iE(Vt,bt,x,T,u,L)),At<a.length()-1){var jt=!((N=Vt)<11904||!(ni["Bopomofo Extended"](N)||ni.Bopomofo(N)||ni["CJK Compatibility Forms"](N)||ni["CJK Compatibility Ideographs"](N)||ni["CJK Compatibility"](N)||ni["CJK Radicals Supplement"](N)||ni["CJK Strokes"](N)||ni["CJK Symbols and Punctuation"](N)||ni["CJK Unified Ideographs Extension A"](N)||ni["CJK Unified Ideographs"](N)||ni["Enclosed CJK Letters and Months"](N)||ni["Halfwidth and Fullwidth Forms"](N)||ni.Hiragana(N)||ni["Ideographic Description Characters"](N)||ni["Kangxi Radicals"](N)||ni["Katakana Phonetic Extensions"](N)||ni.Katakana(N)||ni["Vertical Forms"](N)||ni["Yi Radicals"](N)||ni["Yi Syllables"](N)));(Ro[Vt]||jt||bt.imageName)&&j.push(rE(At+1,ot,Z,j,KO(Vt,a.getCharCode(At+1),jt&&et),!1))}}return(function Qt(Zt){return Zt?Qt(Zt.priorBreak).concat(Zt.index):[]})(rE(a.length(),ot,Z,j,0,!0))}function Nv(a){var u=.5,p=.5;switch(a){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":p=1;break;case"top":case"top-right":case"top-left":p=0}return{horizontalAlign:u,verticalAlign:p}}function ZO(a,u,p,x,T){if(x||T)for(var M=a[p],L=(a[p].x+M.metrics.advance*M.scale)*x,N=u;N<=p;N++)a[N].x-=L,a[N].y+=T}function sE(a,u,p,x,T,M){var L,N=a.image;if(N.content){var j=N.content,Z=N.pixelRatio||1;L=[j[0]/Z,j[1]/Z,N.displaySize[0]-j[2]/Z,N.displaySize[1]-j[3]/Z]}var et,ot,At,bt,Vt=u.left*M,jt=u.right*M;p==="width"||p==="both"?(bt=T[0]+Vt-x[3],ot=T[0]+jt+x[1]):ot=(bt=T[0]+(Vt+jt-N.displaySize[0])/2)+N.displaySize[0];var Qt=u.top*M,Zt=u.bottom*M;return p==="height"||p==="both"?(et=T[1]+Qt-x[0],At=T[1]+Zt+x[2]):At=(et=T[1]+(Qt+Zt-N.displaySize[1])/2)+N.displaySize[1],{image:N,top:et,right:ot,bottom:At,left:bt,collisionPadding:L}}Ro[10]=!0,Ro[32]=!0,Ro[38]=!0,Ro[40]=!0,Ro[41]=!0,Ro[43]=!0,Ro[45]=!0,Ro[47]=!0,Ro[173]=!0,Ro[183]=!0,Ro[8203]=!0,Ro[8208]=!0,Ro[8211]=!0,Ro[8231]=!0;var Zf=(function(a){function u(p,x,T,M){a.call(this,p,x),this.angle=T,M!==void 0&&(this.segment=M)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u})(_);function zv(a,u){var p=u.expression;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new un(a+1))};if(p.kind==="source")return{kind:"source"};for(var x=p.zoomStops,T=p.interpolationType,M=0;M<x.length&&x[M]<=a;)M++;for(var L=M=Math.max(0,M-1);L<x.length&&x[L]<a+1;)L++;L=Math.min(x.length-1,L);var N=x[M],j=x[L];return p.kind==="composite"?{kind:"composite",minZoom:N,maxZoom:j,interpolationType:T}:{kind:"camera",minZoom:N,maxZoom:j,minSize:p.evaluate(new un(N)),maxSize:p.evaluate(new un(j)),interpolationType:T}}function oE(a,u,p){var x=u.uSize,T=p.lowerSize;return a.kind==="source"?T/128:a.kind==="composite"?gr(T/128,p.upperSize/128,u.uSizeT):x}function aE(a,u){var p=0,x=0;if(a.kind==="constant")x=a.layoutSize;else if(a.kind!=="source"){var T=a.interpolationType,M=T?X(Nr.interpolationFactor(T,u,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?x=gr(a.minSize,a.maxSize,M):p=M}return{uSizeT:p,uSize:x}}ci("Anchor",Zf);var YO=Object.freeze({__proto__:null,getSizeData:zv,evaluateSizeForFeature:oE,evaluateSizeForZoom:aE,SIZE_PACK_FACTOR:128});function lE(a,u,p,x,T){if(u.segment===void 0)return!0;for(var M=u,L=u.segment+1,N=0;N>-p/2;){if(--L<0)return!1;N-=a[L].dist(M),M=a[L]}N+=a[L].dist(a[L+1]),L++;for(var j=[],Z=0;N<p/2;){var et=a[L],ot=a[L+1];if(!ot)return!1;var At=a[L-1].angleTo(et)-et.angleTo(ot);for(At=Math.abs((At+3*Math.PI)%(2*Math.PI)-Math.PI),j.push({distance:N,angleDelta:At}),Z+=At;N-j[0].distance>x;)Z-=j.shift().angleDelta;if(Z>T)return!1;L++,N+=et.dist(ot)}return!0}function uE(a){for(var u=0,p=0;p<a.length-1;p++)u+=a[p].dist(a[p+1]);return u}function cE(a,u,p){return a?.6*u*p:0}function hE(a,u){return Math.max(a?a.right-a.left:0,u?u.right-u.left:0)}function QO(a,u,p,x,T,M){for(var L=cE(p,T,M),N=hE(p,x)*M,j=0,Z=uE(a)/2,et=0;et<a.length-1;et++){var ot=a[et],At=a[et+1],bt=ot.dist(At);if(j+bt>Z){var Vt=(Z-j)/bt,jt=gr(ot.x,At.x,Vt),Qt=gr(ot.y,At.y,Vt),Zt=new Zf(jt,Qt,At.angleTo(ot),et);return Zt._round(),!L||lE(a,Zt,N,L,u)?Zt:void 0}j+=bt}}function JO(a,u,p,x,T,M,L,N,j){var Z=cE(x,M,L),et=hE(x,T),ot=et*L,At=a[0].x===0||a[0].x===j||a[0].y===0||a[0].y===j;return u-ot<u/4&&(u=ot+u/4),(function bt(Vt,jt,Qt,Zt,re,pe,be,we,Ne){for(var Je=pe/2,ri=uE(Vt),Si=0,li=jt-Qt,Li=[],ui=0;ui<Vt.length-1;ui++){for(var an=Vt[ui],Vi=Vt[ui+1],gi=an.dist(Vi),yn=Vi.angleTo(an);li+Qt<Si+gi;){var tn=((li+=Qt)-Si)/gi,Cn=gr(an.x,Vi.x,tn),Di=gr(an.y,Vi.y,tn);if(Cn>=0&&Cn<Ne&&Di>=0&&Di<Ne&&li-Je>=0&&li+Je<=ri){var Pn=new Zf(Cn,Di,yn,ui);Pn._round(),Zt&&!lE(Vt,Pn,pe,Zt,re)||Li.push(Pn)}}Si+=gi}return we||Li.length||be||(Li=bt(Vt,Si/2,Qt,Zt,re,pe,be,!0,Ne)),Li})(a,At?u/2*N%u:(et/2+2*M)*L*N%u,u,Z,p,ot,At,!1,j)}function fE(a,u,p,x,T){for(var M=[],L=0;L<a.length;L++)for(var N=a[L],j=void 0,Z=0;Z<N.length-1;Z++){var et=N[Z],ot=N[Z+1];et.x<u&&ot.x<u||(et.x<u?et=new _(u,et.y+(u-et.x)/(ot.x-et.x)*(ot.y-et.y))._round():ot.x<u&&(ot=new _(u,et.y+(u-et.x)/(ot.x-et.x)*(ot.y-et.y))._round()),et.y<p&&ot.y<p||(et.y<p?et=new _(et.x+(p-et.y)/(ot.y-et.y)*(ot.x-et.x),p)._round():ot.y<p&&(ot=new _(et.x+(p-et.y)/(ot.y-et.y)*(ot.x-et.x),p)._round()),et.x>=x&&ot.x>=x||(et.x>=x?et=new _(x,et.y+(x-et.x)/(ot.x-et.x)*(ot.y-et.y))._round():ot.x>=x&&(ot=new _(x,et.y+(x-et.x)/(ot.x-et.x)*(ot.y-et.y))._round()),et.y>=T&&ot.y>=T||(et.y>=T?et=new _(et.x+(T-et.y)/(ot.y-et.y)*(ot.x-et.x),T)._round():ot.y>=T&&(ot=new _(et.x+(T-et.y)/(ot.y-et.y)*(ot.x-et.x),T)._round()),j&&et.equals(j[j.length-1])||M.push(j=[et]),j.push(ot)))))}return M}function dE(a,u,p,x){var T=[],M=a.image,L=M.pixelRatio,N=M.paddedRect.w-2,j=M.paddedRect.h-2,Z=a.right-a.left,et=a.bottom-a.top,ot=M.stretchX||[[0,N]],At=M.stretchY||[[0,j]],bt=function(Cn,Di){return Cn+Di[1]-Di[0]},Vt=ot.reduce(bt,0),jt=At.reduce(bt,0),Qt=N-Vt,Zt=j-jt,re=0,pe=Vt,be=0,we=jt,Ne=0,Je=Qt,ri=0,Si=Zt;if(M.content&&x){var li=M.content;re=Vm(ot,0,li[0]),be=Vm(At,0,li[1]),pe=Vm(ot,li[0],li[2]),we=Vm(At,li[1],li[3]),Ne=li[0]-re,ri=li[1]-be,Je=li[2]-li[0]-pe,Si=li[3]-li[1]-we}var Li=function(Cn,Di,Pn,lr){var Er=Gm(Cn.stretch-re,pe,Z,a.left),yr=jm(Cn.fixed-Ne,Je,Cn.stretch,Vt),ur=Gm(Di.stretch-be,we,et,a.top),Cr=jm(Di.fixed-ri,Si,Di.stretch,jt),Yr=Gm(Pn.stretch-re,pe,Z,a.left),Qr=jm(Pn.fixed-Ne,Je,Pn.stretch,Vt),Vs=Gm(lr.stretch-be,we,et,a.top),as=jm(lr.fixed-ri,Si,lr.stretch,jt),Gs=new _(Er,ur),Ir=new _(Yr,ur),ls=new _(Yr,Vs),_n=new _(Er,Vs),Vn=new _(yr/L,Cr/L),kn=new _(Qr/L,as/L),Sn=u*Math.PI/180;if(Sn){var $s=Math.sin(Sn),ws=Math.cos(Sn),ir=[ws,-$s,$s,ws];Gs._matMult(ir),Ir._matMult(ir),_n._matMult(ir),ls._matMult(ir)}var kr=Cn.stretch+Cn.fixed,Es=Di.stretch+Di.fixed;return{tl:Gs,tr:Ir,bl:_n,br:ls,tex:{x:M.paddedRect.x+1+kr,y:M.paddedRect.y+1+Es,w:Pn.stretch+Pn.fixed-kr,h:lr.stretch+lr.fixed-Es},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vn,pixelOffsetBR:kn,minFontScaleX:Je/L/Z,minFontScaleY:Si/L/et,isSDF:p}};if(x&&(M.stretchX||M.stretchY))for(var ui=pE(ot,Qt,Vt),an=pE(At,Zt,jt),Vi=0;Vi<ui.length-1;Vi++)for(var gi=ui[Vi],yn=ui[Vi+1],tn=0;tn<an.length-1;tn++)T.push(Li(gi,an[tn],yn,an[tn+1]));else T.push(Li({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:N+1},{fixed:0,stretch:j+1}));return T}function Vm(a,u,p){for(var x=0,T=0,M=a;T<M.length;T+=1){var L=M[T];x+=Math.max(u,Math.min(p,L[1]))-Math.max(u,Math.min(p,L[0]))}return x}function pE(a,u,p){for(var x=[{fixed:-1,stretch:0}],T=0,M=a;T<M.length;T+=1){var L=M[T],N=L[0],j=L[1],Z=x[x.length-1];x.push({fixed:N-Z.stretch,stretch:Z.stretch}),x.push({fixed:N-Z.stretch,stretch:Z.stretch+(j-N)})}return x.push({fixed:u+1,stretch:p}),x}function Gm(a,u,p,x){return a/u*p+x}function jm(a,u,p,x){return a-u*p/x}var Wm=function(a,u,p,x,T,M,L,N,j,Z){if(this.boxStartIndex=a.length,j){var et=M.top,ot=M.bottom,At=M.collisionPadding;At&&(et-=At[1],ot+=At[3]);var bt=ot-et;bt>0&&(bt=Math.max(10,bt),this.circleDiameter=bt)}else{var Vt=M.top*L-N,jt=M.bottom*L+N,Qt=M.left*L-N,Zt=M.right*L+N,re=M.collisionPadding;if(re&&(Qt-=re[0]*L,Vt-=re[1]*L,Zt+=re[2]*L,jt+=re[3]*L),Z){var pe=new _(Qt,Vt),be=new _(Zt,Vt),we=new _(Qt,jt),Ne=new _(Zt,jt),Je=Z*Math.PI/180;pe._rotate(Je),be._rotate(Je),we._rotate(Je),Ne._rotate(Je),Qt=Math.min(pe.x,be.x,we.x,Ne.x),Zt=Math.max(pe.x,be.x,we.x,Ne.x),Vt=Math.min(pe.y,be.y,we.y,Ne.y),jt=Math.max(pe.y,be.y,we.y,Ne.y)}a.emplaceBack(u.x,u.y,Qt,Vt,Zt,jt,p,x,T)}this.boxEndIndex=a.length},Yf=function(a,u){if(a===void 0&&(a=[]),u===void 0&&(u=$O),this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function $O(a,u){return a<u?-1:a>u?1:0}function tF(a,u,p){p===void 0&&(p=!1);for(var x=1/0,T=1/0,M=-1/0,L=-1/0,N=a[0],j=0;j<N.length;j++){var Z=N[j];(!j||Z.x<x)&&(x=Z.x),(!j||Z.y<T)&&(T=Z.y),(!j||Z.x>M)&&(M=Z.x),(!j||Z.y>L)&&(L=Z.y)}var et=Math.min(M-x,L-T),ot=et/2,At=new Yf([],eF);if(et===0)return new _(x,T);for(var bt=x;bt<M;bt+=et)for(var Vt=T;Vt<L;Vt+=et)At.push(new Qf(bt+ot,Vt+ot,ot,a));for(var jt=(function(re){for(var pe=0,be=0,we=0,Ne=re[0],Je=0,ri=Ne.length,Si=ri-1;Je<ri;Si=Je++){var li=Ne[Je],Li=Ne[Si],ui=li.x*Li.y-Li.x*li.y;be+=(li.x+Li.x)*ui,we+=(li.y+Li.y)*ui,pe+=3*ui}return new Qf(be/pe,we/pe,0,re)})(a),Qt=At.length;At.length;){var Zt=At.pop();(Zt.d>jt.d||!jt.d)&&(jt=Zt,p&&console.log("found best %d after %d probes",Math.round(1e4*Zt.d)/1e4,Qt)),Zt.max-jt.d<=u||(At.push(new Qf(Zt.p.x-(ot=Zt.h/2),Zt.p.y-ot,ot,a)),At.push(new Qf(Zt.p.x+ot,Zt.p.y-ot,ot,a)),At.push(new Qf(Zt.p.x-ot,Zt.p.y+ot,ot,a)),At.push(new Qf(Zt.p.x+ot,Zt.p.y+ot,ot,a)),Qt+=4)}return p&&(console.log("num probes: "+Qt),console.log("best distance: "+jt.d)),jt.p}function eF(a,u){return u.max-a.max}function Qf(a,u,p,x){this.p=new _(a,u),this.h=p,this.d=(function(T,M){for(var L=!1,N=1/0,j=0;j<M.length;j++)for(var Z=M[j],et=0,ot=Z.length,At=ot-1;et<ot;At=et++){var bt=Z[et],Vt=Z[At];bt.y>T.y!=Vt.y>T.y&&T.x<(Vt.x-bt.x)*(T.y-bt.y)/(Vt.y-bt.y)+bt.x&&(L=!L),N=Math.min(N,Sc(T,bt,Vt))}return(L?1:-1)*Math.sqrt(N)})(this.p,x),this.max=this.d+this.h*Math.SQRT2}Yf.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Yf.prototype.pop=function(){if(this.length!==0){var a=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),a}},Yf.prototype.peek=function(){return this.data[0]},Yf.prototype._up=function(a){for(var u=this.data,p=this.compare,x=u[a];a>0;){var T=a-1>>1,M=u[T];if(p(x,M)>=0)break;u[a]=M,a=T}u[a]=x},Yf.prototype._down=function(a){for(var u=this.data,p=this.compare,x=this.length>>1,T=u[a];a<x;){var M=1+(a<<1),L=u[M],N=M+1;if(N<this.length&&p(u[N],L)<0&&(M=N,L=u[N]),p(L,T)>=0)break;u[a]=L,a=M}u[a]=T};var Uv=Number.POSITIVE_INFINITY;function AE(a,u){return u[1]!==Uv?(function(p,x,T){var M=0,L=0;switch(x=Math.abs(x),T=Math.abs(T),p){case"top-right":case"top-left":case"top":L=T-7;break;case"bottom-right":case"bottom-left":case"bottom":L=7-T}switch(p){case"top-right":case"bottom-right":case"right":M=-x;break;case"top-left":case"bottom-left":case"left":M=x}return[M,L]})(a,u[0],u[1]):(function(p,x){var T=0,M=0;x<0&&(x=0);var L=x/Math.sqrt(2);switch(p){case"top-right":case"top-left":M=L-7;break;case"bottom-right":case"bottom-left":M=7-L;break;case"bottom":M=7-x;break;case"top":M=x-7}switch(p){case"top-right":case"bottom-right":T=-L;break;case"top-left":case"bottom-left":T=L;break;case"left":T=x;break;case"right":T=-x}return[T,M]})(a,u[0])}function Vv(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mE(a,u,p,x,T,M,L,N,j,Z,et,ot,At,bt,Vt){var jt=(function(be,we,Ne,Je,ri,Si,li,Li){for(var ui=Je.layout.get("text-rotate").evaluate(Si,{})*Math.PI/180,an=[],Vi=0,gi=we.positionedLines;Vi<gi.length;Vi+=1)for(var yn=gi[Vi],tn=0,Cn=yn.positionedGlyphs;tn<Cn.length;tn+=1){var Di=Cn[tn];if(Di.rect){var Pn=Di.rect||{},lr=4,Er=!0,yr=1,ur=0,Cr=(ri||Li)&&Di.vertical,Yr=Di.metrics.advance*Di.scale/2;if(Li&&we.verticalizable&&(ur=yn.lineOffset/2-(Di.imageName?-(24-Di.metrics.width*Di.scale)/2:24*(Di.scale-1))),Di.imageName){var Qr=li[Di.imageName];Er=Qr.sdf,lr=1/(yr=Qr.pixelRatio)}var Vs=ri?[Di.x+Yr,Di.y]:[0,0],as=ri?[0,0]:[Di.x+Yr+Ne[0],Di.y+Ne[1]-ur],Gs=[0,0];Cr&&(Gs=as,as=[0,0]);var Ir=(Di.metrics.left-lr)*Di.scale-Yr+as[0],ls=(-Di.metrics.top-lr)*Di.scale+as[1],_n=Ir+Pn.w*Di.scale/yr,Vn=ls+Pn.h*Di.scale/yr,kn=new _(Ir,ls),Sn=new _(_n,ls),$s=new _(Ir,Vn),ws=new _(_n,Vn);if(Cr){var ir=new _(-Yr,Yr- -17),kr=-Math.PI/2,Es=12-Yr,In=new _(22-Es,-(Di.imageName?Es:0)),jl=new(Function.prototype.bind.apply(_,[null].concat(Gs)));kn._rotateAround(kr,ir)._add(In)._add(jl),Sn._rotateAround(kr,ir)._add(In)._add(jl),$s._rotateAround(kr,ir)._add(In)._add(jl),ws._rotateAround(kr,ir)._add(In)._add(jl)}if(ui){var Ho=Math.sin(ui),Wl=Math.cos(ui),Mr=[Wl,-Ho,Ho,Wl];kn._matMult(Mr),Sn._matMult(Mr),$s._matMult(Mr),ws._matMult(Mr)}var Hl=new _(0,0),Pa=new _(0,0);an.push({tl:kn,tr:Sn,bl:$s,br:ws,tex:Pn,writingMode:we.writingMode,glyphOffset:Vs,sectionIndex:Di.sectionIndex,isSDF:Er,pixelOffsetTL:Hl,pixelOffsetBR:Pa,minFontScaleX:0,minFontScaleY:0})}}return an})(0,p,N,T,M,L,x,a.allowVerticalPlacement),Qt=a.textSizeData,Zt=null;Qt.kind==="source"?(Zt=[128*T.layout.get("text-size").evaluate(L,{})])[0]>32640&&dt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Qt.kind==="composite"&&((Zt=[128*bt.compositeTextSizes[0].evaluate(L,{},Vt),128*bt.compositeTextSizes[1].evaluate(L,{},Vt)])[0]>32640||Zt[1]>32640)&&dt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,jt,Zt,N,M,L,Z,u,j.lineStartIndex,j.lineLength,At,Vt);for(var re=0,pe=et;re<pe.length;re+=1)ot[pe[re]]=a.text.placedSymbolArray.length-1;return 4*jt.length}function gE(a){for(var u in a)return a[u];return null}function iF(a,u,p,x){var T=a.compareText;if(u in T){for(var M=T[u],L=M.length-1;L>=0;L--)if(x.dist(M[L])<p)return!0}else T[u]=[];return T[u].push(x),!1}var nF=Xf.VectorTileFeature.types,rF=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hm(a,u,p,x,T,M,L,N,j,Z,et,ot,At){var bt=N?Math.min(32640,Math.round(N[0])):0,Vt=N?Math.min(32640,Math.round(N[1])):0;a.emplaceBack(u,p,Math.round(32*x),Math.round(32*T),M,L,(bt<<1)+(j?1:0),Vt,16*Z,16*et,256*ot,256*At)}function Gv(a,u,p){a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p)}function sF(a){for(var u=0,p=a.sections;u<p.length;u+=1)if(bc(p[u].text))return!0;return!1}var Jf=function(a){this.layoutVertexArray=new Pu,this.indexArray=new xs,this.programConfigurations=a,this.segments=new Ct,this.dynamicLayoutVertexArray=new Qa,this.opacityVertexArray=new Nl,this.placedSymbolArray=new w};Jf.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Jf.prototype.upload=function(a,u,p,x){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,MO.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,BO.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,rF,!0),this.opacityVertexBuffer.itemSize=1),(p||x)&&this.programConfigurations.upload(a))},Jf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},ci("SymbolBuffers",Jf);var tA=function(a,u,p){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new p,this.segments=new Ct,this.collisionVertexArray=new bh};tA.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,RO.members,!0)},tA.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},ci("CollisionBuffers",tA);var Nn=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(M){return M.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bo([]),this.placementViewportMatrix=Bo([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zv(this.zoom,u["text-size"]),this.iconSizeData=zv(this.zoom,u["icon-size"]);var p=this.layers[0].layout,x=p.get("symbol-sort-key"),T=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&x.constantOr(1)!==void 0,this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(function(M){return Wo[M]})),this.stateDependentLayerIds=this.layers.filter(function(M){return M.isStateDependent()}).map(function(M){return M.id}),this.sourceID=a.sourceID};Nn.prototype.createArrays=function(){this.text=new Jf(new ze(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Jf(new ze(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new O,this.lineVertexArray=new G,this.symbolInstances=new D},Nn.prototype.calculateGlyphDependencies=function(a,u,p,x,T){for(var M=0;M<a.length;M++)if(u[a.charCodeAt(M)]=!0,(p||x)&&T){var L=Qp[a.charAt(M)];L&&(u[L.charCodeAt(0)]=!0)}},Nn.prototype.populate=function(a,u,p){var x=this.layers[0],T=x.layout,M=T.get("text-font"),L=T.get("text-field"),N=T.get("icon-image"),j=(L.value.kind!=="constant"||L.value.value instanceof hr&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),Z=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,et=T.get("symbol-sort-key");if(this.features=[],j||Z){for(var ot=u.iconDependencies,At=u.glyphDependencies,bt=u.availableImages,Vt=new un(this.zoom),jt=0,Qt=a;jt<Qt.length;jt+=1){var Zt=Qt[jt],re=Zt.feature,pe=Zt.id,be=Zt.index,we=Zt.sourceLayerIndex,Ne=x._featureFilter.needGeometry,Je=We(re,Ne);if(x._featureFilter.filter(Vt,Je,p)){Ne||(Je.geometry=ai(re));var ri=void 0;if(j){var Si=x.getValueAndResolveTokens("text-field",Je,p,bt),li=hr.factory(Si);sF(li)&&(this.hasRTLText=!0),(!this.hasRTLText||vh()==="unavailable"||this.hasRTLText&&rs.isParsed())&&(ri=DO(li,x,Je))}var Li=void 0;if(Z){var ui=x.getValueAndResolveTokens("icon-image",Je,p,bt);Li=ui instanceof Kn?ui:Kn.fromString(ui)}if(ri||Li){var an=this.sortFeaturesByKey?et.evaluate(Je,{},p):void 0;if(this.features.push({id:pe,text:ri,icon:Li,index:be,sourceLayerIndex:we,geometry:Je.geometry,properties:re.properties,type:nF[re.type],sortKey:an}),Li&&(ot[Li.name]=!0),ri){var Vi=M.evaluate(Je,{},p).join(","),gi=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Wo.vertical)>=0;for(var yn=0,tn=ri.sections;yn<tn.length;yn+=1){var Cn=tn[yn];if(Cn.image)ot[Cn.image.name]=!0;else{var Di=wo(ri.toString()),Pn=Cn.fontStack||Vi,lr=At[Pn]=At[Pn]||{};this.calculateGlyphDependencies(Cn.text,lr,gi,this.allowVerticalPlacement,Di)}}}}}}T.get("symbol-placement")==="line"&&(this.features=(function(Er){var yr={},ur={},Cr=[],Yr=0;function Qr(ir){Cr.push(Er[ir]),Yr++}function Vs(ir,kr,Es){var In=ur[ir];return delete ur[ir],ur[kr]=In,Cr[In].geometry[0].pop(),Cr[In].geometry[0]=Cr[In].geometry[0].concat(Es[0]),In}function as(ir,kr,Es){var In=yr[kr];return delete yr[kr],yr[ir]=In,Cr[In].geometry[0].shift(),Cr[In].geometry[0]=Es[0].concat(Cr[In].geometry[0]),In}function Gs(ir,kr,Es){var In=Es?kr[0][kr[0].length-1]:kr[0][0];return ir+":"+In.x+":"+In.y}for(var Ir=0;Ir<Er.length;Ir++){var ls=Er[Ir],_n=ls.geometry,Vn=ls.text?ls.text.toString():null;if(Vn){var kn=Gs(Vn,_n),Sn=Gs(Vn,_n,!0);if(kn in ur&&Sn in yr&&ur[kn]!==yr[Sn]){var $s=as(kn,Sn,_n),ws=Vs(kn,Sn,Cr[$s].geometry);delete yr[kn],delete ur[Sn],ur[Gs(Vn,Cr[ws].geometry,!0)]=ws,Cr[$s].geometry=null}else kn in ur?Vs(kn,Sn,_n):Sn in yr?as(kn,Sn,_n):(Qr(Ir),yr[kn]=Yr-1,ur[Sn]=Yr-1)}else Qr(Ir)}return Cr.filter(function(ir){return ir.geometry})})(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Er,yr){return Er.sortKey-yr.sortKey})}},Nn.prototype.update=function(a,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,p),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,p))},Nn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Nn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Nn.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Nn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Nn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Nn.prototype.addToLineVertexArray=function(a,u){var p=this.lineVertexArray.length;if(a.segment!==void 0){for(var x=a.dist(u[a.segment+1]),T=a.dist(u[a.segment]),M={},L=a.segment+1;L<u.length;L++)M[L]={x:u[L].x,y:u[L].y,tileUnitDistanceFromAnchor:x},L<u.length-1&&(x+=u[L+1].dist(u[L]));for(var N=a.segment||0;N>=0;N--)M[N]={x:u[N].x,y:u[N].y,tileUnitDistanceFromAnchor:T},N>0&&(T+=u[N-1].dist(u[N]));for(var j=0;j<u.length;j++){var Z=M[j];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}},Nn.prototype.addSymbols=function(a,u,p,x,T,M,L,N,j,Z,et,ot){for(var At=a.indexArray,bt=a.layoutVertexArray,Vt=a.segments.prepareSegment(4*u.length,bt,At,this.canOverlap?M.sortKey:void 0),jt=this.glyphOffsetArray.length,Qt=Vt.vertexLength,Zt=this.allowVerticalPlacement&&L===Wo.vertical?Math.PI/2:0,re=M.text&&M.text.sections,pe=0;pe<u.length;pe++){var be=u[pe],we=be.tl,Ne=be.tr,Je=be.bl,ri=be.br,Si=be.tex,li=be.pixelOffsetTL,Li=be.pixelOffsetBR,ui=be.minFontScaleX,an=be.minFontScaleY,Vi=be.glyphOffset,gi=be.isSDF,yn=be.sectionIndex,tn=Vt.vertexLength,Cn=Vi[1];Hm(bt,N.x,N.y,we.x,Cn+we.y,Si.x,Si.y,p,gi,li.x,li.y,ui,an),Hm(bt,N.x,N.y,Ne.x,Cn+Ne.y,Si.x+Si.w,Si.y,p,gi,Li.x,li.y,ui,an),Hm(bt,N.x,N.y,Je.x,Cn+Je.y,Si.x,Si.y+Si.h,p,gi,li.x,Li.y,ui,an),Hm(bt,N.x,N.y,ri.x,Cn+ri.y,Si.x+Si.w,Si.y+Si.h,p,gi,Li.x,Li.y,ui,an),Gv(a.dynamicLayoutVertexArray,N,Zt),At.emplaceBack(tn,tn+1,tn+2),At.emplaceBack(tn+1,tn+2,tn+3),Vt.vertexLength+=4,Vt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vi[0]),pe!==u.length-1&&yn===u[pe+1].sectionIndex||a.programConfigurations.populatePaintArrays(bt.length,M,M.index,{},ot,re&&re[yn])}a.placedSymbolArray.emplaceBack(N.x,N.y,jt,this.glyphOffsetArray.length-jt,Qt,j,Z,N.segment,p?p[0]:0,p?p[1]:0,x[0],x[1],L,0,!1,0,et)},Nn.prototype._addCollisionDebugVertex=function(a,u,p,x,T,M){return u.emplaceBack(0,0),a.emplaceBack(p.x,p.y,x,T,Math.round(M.x),Math.round(M.y))},Nn.prototype.addCollisionDebugVertices=function(a,u,p,x,T,M,L){var N=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),j=N.vertexLength,Z=T.layoutVertexArray,et=T.collisionVertexArray,ot=L.anchorX,At=L.anchorY;this._addCollisionDebugVertex(Z,et,M,ot,At,new _(a,u)),this._addCollisionDebugVertex(Z,et,M,ot,At,new _(p,u)),this._addCollisionDebugVertex(Z,et,M,ot,At,new _(p,x)),this._addCollisionDebugVertex(Z,et,M,ot,At,new _(a,x)),N.vertexLength+=4;var bt=T.indexArray;bt.emplaceBack(j,j+1),bt.emplaceBack(j+1,j+2),bt.emplaceBack(j+2,j+3),bt.emplaceBack(j+3,j),N.primitiveLength+=4},Nn.prototype.addDebugCollisionBoxes=function(a,u,p,x){for(var T=a;T<u;T++){var M=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(M.x1,M.y1,M.x2,M.y2,x?this.textCollisionBox:this.iconCollisionBox,M.anchorPoint,p)}},Nn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new tA(zl,Z3.members,Ul),this.iconCollisionBox=new tA(zl,Z3.members,Ul);for(var a=0;a<this.symbolInstances.length;a++){var u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},Nn.prototype._deserializeCollisionBoxesForSymbol=function(a,u,p,x,T,M,L,N,j){for(var Z={},et=u;et<p;et++){var ot=a.get(et);Z.textBox={x1:ot.x1,y1:ot.y1,x2:ot.x2,y2:ot.y2,anchorPointX:ot.anchorPointX,anchorPointY:ot.anchorPointY},Z.textFeatureIndex=ot.featureIndex;break}for(var At=x;At<T;At++){var bt=a.get(At);Z.verticalTextBox={x1:bt.x1,y1:bt.y1,x2:bt.x2,y2:bt.y2,anchorPointX:bt.anchorPointX,anchorPointY:bt.anchorPointY},Z.verticalTextFeatureIndex=bt.featureIndex;break}for(var Vt=M;Vt<L;Vt++){var jt=a.get(Vt);Z.iconBox={x1:jt.x1,y1:jt.y1,x2:jt.x2,y2:jt.y2,anchorPointX:jt.anchorPointX,anchorPointY:jt.anchorPointY},Z.iconFeatureIndex=jt.featureIndex;break}for(var Qt=N;Qt<j;Qt++){var Zt=a.get(Qt);Z.verticalIconBox={x1:Zt.x1,y1:Zt.y1,x2:Zt.x2,y2:Zt.y2,anchorPointX:Zt.anchorPointX,anchorPointY:Zt.anchorPointY},Z.verticalIconFeatureIndex=Zt.featureIndex;break}return Z},Nn.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}},Nn.prototype.hasTextData=function(){return this.text.segments.get().length>0},Nn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Nn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Nn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Nn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Nn.prototype.addIndicesForPlacedSymbol=function(a,u){for(var p=a.placedSymbolArray.get(u),x=p.vertexStartIndex+4*p.numGlyphs,T=p.vertexStartIndex;T<x;T+=4)a.indexArray.emplaceBack(T,T+1,T+2),a.indexArray.emplaceBack(T+1,T+2,T+3)},Nn.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(a),p=Math.cos(a),x=[],T=[],M=[],L=0;L<this.symbolInstances.length;++L){M.push(L);var N=this.symbolInstances.get(L);x.push(0|Math.round(u*N.anchorX+p*N.anchorY)),T.push(N.featureIndex)}return M.sort(function(j,Z){return x[j]-x[Z]||T[Z]-T[j]}),M},Nn.prototype.addToSortKeyRanges=function(a,u){var p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Nn.prototype.sortFeatures=function(a){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var p=0,x=this.symbolInstanceIndexes;p<x.length;p+=1){var T=this.symbolInstances.get(x[p]);this.featureSortOrder.push(T.featureIndex),[T.rightJustifiedTextSymbolIndex,T.centerJustifiedTextSymbolIndex,T.leftJustifiedTextSymbolIndex].forEach(function(M,L,N){M>=0&&N.indexOf(M)===L&&u.addIndicesForPlacedSymbol(u.text,M)}),T.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,T.verticalPlacedTextSymbolIndex),T.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.placedIconSymbolIndex),T.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},ci("SymbolBucket",Nn,{omit:["layers","collisionBoxArray","features","compareText"]}),Nn.MAX_GLYPHS=65535,Nn.addDynamicAttributes=Gv;var oF=new Kr({"symbol-placement":new Ii(lt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ii(lt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ii(lt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pi(lt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ii(lt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ii(lt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ii(lt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ii(lt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ii(lt.layout_symbol["icon-rotation-alignment"]),"icon-size":new pi(lt.layout_symbol["icon-size"]),"icon-text-fit":new Ii(lt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ii(lt.layout_symbol["icon-text-fit-padding"]),"icon-image":new pi(lt.layout_symbol["icon-image"]),"icon-rotate":new pi(lt.layout_symbol["icon-rotate"]),"icon-padding":new Ii(lt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ii(lt.layout_symbol["icon-keep-upright"]),"icon-offset":new pi(lt.layout_symbol["icon-offset"]),"icon-anchor":new pi(lt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ii(lt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ii(lt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ii(lt.layout_symbol["text-rotation-alignment"]),"text-field":new pi(lt.layout_symbol["text-field"]),"text-font":new pi(lt.layout_symbol["text-font"]),"text-size":new pi(lt.layout_symbol["text-size"]),"text-max-width":new pi(lt.layout_symbol["text-max-width"]),"text-line-height":new Ii(lt.layout_symbol["text-line-height"]),"text-letter-spacing":new pi(lt.layout_symbol["text-letter-spacing"]),"text-justify":new pi(lt.layout_symbol["text-justify"]),"text-radial-offset":new pi(lt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ii(lt.layout_symbol["text-variable-anchor"]),"text-anchor":new pi(lt.layout_symbol["text-anchor"]),"text-max-angle":new Ii(lt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ii(lt.layout_symbol["text-writing-mode"]),"text-rotate":new pi(lt.layout_symbol["text-rotate"]),"text-padding":new Ii(lt.layout_symbol["text-padding"]),"text-keep-upright":new Ii(lt.layout_symbol["text-keep-upright"]),"text-transform":new pi(lt.layout_symbol["text-transform"]),"text-offset":new pi(lt.layout_symbol["text-offset"]),"text-allow-overlap":new Ii(lt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ii(lt.layout_symbol["text-ignore-placement"]),"text-optional":new Ii(lt.layout_symbol["text-optional"])}),jv={paint:new Kr({"icon-opacity":new pi(lt.paint_symbol["icon-opacity"]),"icon-color":new pi(lt.paint_symbol["icon-color"]),"icon-halo-color":new pi(lt.paint_symbol["icon-halo-color"]),"icon-halo-width":new pi(lt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pi(lt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ii(lt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ii(lt.paint_symbol["icon-translate-anchor"]),"text-opacity":new pi(lt.paint_symbol["text-opacity"]),"text-color":new pi(lt.paint_symbol["text-color"],{runtimeType:Ze,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new pi(lt.paint_symbol["text-halo-color"]),"text-halo-width":new pi(lt.paint_symbol["text-halo-width"]),"text-halo-blur":new pi(lt.paint_symbol["text-halo-blur"]),"text-translate":new Ii(lt.paint_symbol["text-translate"]),"text-translate-anchor":new Ii(lt.paint_symbol["text-translate-anchor"])}),layout:oF},$f=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Ue,this.defaultValue=a};$f.prototype.evaluate=function(a){if(a.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},$f.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},$f.prototype.outputDefined=function(){return!1},$f.prototype.serialize=function(){return null},ci("FormatSectionOverride",$f,{omit:["defaultValue"]});var aF=(function(a){function u(p){a.call(this,p,jv)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(p,x){if(a.prototype.recalculate.call(this,p,x),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var T=this.layout.get("text-writing-mode");if(T){for(var M=[],L=0,N=T;L<N.length;L+=1){var j=N[L];M.indexOf(j)<0&&M.push(j)}this.layout._values["text-writing-mode"]=M}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(p,x,T,M){var L=this.layout.get(p).evaluate(x,{},T,M),N=this._unevaluatedLayout._values[p];return N.isDataDriven()||Rn(N.value)||!L?L:(function(j,Z){return Z.replace(/{([^{}]+)}/g,function(et,ot){return ot in j?String(j[ot]):""})})(x.properties,L)},u.prototype.createBucket=function(p){return new Nn(p)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var p=0,x=jv.paint.overridableProperties;p<x.length;p+=1){var T=x[p];if(u.hasPaintOverride(this.layout,T)){var M,L=this.paint.get(T),N=new $f(L),j=new Go(N,L.property.specification);M=L.value.kind==="constant"||L.value.kind==="source"?new Ml("source",j):new Ka("composite",j,L.value.zoomStops,L.value._interpolationType),this.paint._values[T]=new us(L.property,M,L.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(p,x,T){return!(!this.layout||x.isDataDriven()||T.isDataDriven())&&u.hasPaintOverride(this.layout,p)},u.hasPaintOverride=function(p,x){var T=p.get("text-field"),M=jv.paint.properties[x],L=!1,N=function(et){for(var ot=0,At=et;ot<At.length;ot+=1)if(M.overrides&&M.overrides.hasOverride(At[ot]))return void(L=!0)};if(T.value.kind==="constant"&&T.value.value instanceof hr)N(T.value.value.sections);else if(T.value.kind==="source"){var j=function(et){L||(et instanceof Lr&&Zn(et.value)===hn?N(et.value.sections):et instanceof gs?N(et.sections):et.eachChild(j))},Z=T.value;Z._styleExpression&&j(Z._styleExpression.expression)}return L},u})(jo),lF={paint:new Kr({"background-color":new Ii(lt.paint_background["background-color"]),"background-pattern":new cs(lt.paint_background["background-pattern"]),"background-opacity":new Ii(lt.paint_background["background-opacity"])})},uF=(function(a){function u(p){a.call(this,p,lF)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(jo),cF={paint:new Kr({"raster-opacity":new Ii(lt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ii(lt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ii(lt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ii(lt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ii(lt.paint_raster["raster-saturation"]),"raster-contrast":new Ii(lt.paint_raster["raster-contrast"]),"raster-resampling":new Ii(lt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ii(lt.paint_raster["raster-fade-duration"])})},hF=(function(a){function u(p){a.call(this,p,cF)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(jo),fF=(function(a){function u(p){a.call(this,p,{}),this.implementation=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(p){this.implementation.onAdd&&this.implementation.onAdd(p,p.painter.context.gl)},u.prototype.onRemove=function(p){this.implementation.onRemove&&this.implementation.onRemove(p,p.painter.context.gl)},u})(jo),dF={circle:Sv,heatmap:Zk,hillshade:Qk,fill:pO,"fill-extrusion":wO,line:IO,symbol:aF,background:uF,raster:hF},yE=I.HTMLImageElement,vE=I.HTMLCanvasElement,_E=I.HTMLVideoElement,bE=I.ImageData,Xm=I.ImageBitmap,Sh=function(a,u,p,x){this.context=a,this.format=p,this.texture=a.gl.createTexture(),this.update(u,x)};Sh.prototype.update=function(a,u,p){var x=a.width,T=a.height,M=!(this.size&&this.size[0]===x&&this.size[1]===T||p),L=this.context,N=L.gl;if(this.useMipmap=!!(u&&u.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),L.pixelStoreUnpackFlipY.set(!1),L.pixelStoreUnpack.set(1),L.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!u||u.premultiply!==!1)),M)this.size=[x,T],a instanceof yE||a instanceof vE||a instanceof _E||a instanceof bE||Xm&&a instanceof Xm?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,a):N.texImage2D(N.TEXTURE_2D,0,this.format,x,T,0,this.format,N.UNSIGNED_BYTE,a.data);else{var j=p||{x:0,y:0},Z=j.x,et=j.y;a instanceof yE||a instanceof vE||a instanceof _E||a instanceof bE||Xm&&a instanceof Xm?N.texSubImage2D(N.TEXTURE_2D,0,Z,et,N.RGBA,N.UNSIGNED_BYTE,a):N.texSubImage2D(N.TEXTURE_2D,0,Z,et,x,T,N.RGBA,N.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)},Sh.prototype.bind=function(a,u,p){var x=this.context.gl;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||a),this.filter=a),u!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,u),this.wrap=u)},Sh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Sh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Wv=function(a){var u=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};Wv.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Wv.prototype.remove=function(){delete this._channel,this._callback=function(){}};var td=function(a,u,p){this.target=a,this.parent=u,this.mapId=p,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ot(["receive","process"],this),this.invoker=new Wv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Rt()?a:I};function xE(a,u,p){var x=2*Math.PI*6378137/256/Math.pow(2,p);return[a*x-2*Math.PI*6378137/2,u*x-2*Math.PI*6378137/2]}td.prototype.send=function(a,u,p,x,T){var M=this;T===void 0&&(T=!1);var L=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(this.callbacks[L]=p);var N=se(this.globalScope)?void 0:[];return this.target.postMessage({id:L,type:a,hasCallback:!!p,targetMapId:x,mustQueue:T,sourceMapId:this.mapId,data:xo(u,N)},N),{cancel:function(){p&&delete M.callbacks[L],M.target.postMessage({id:L,type:"<cancel>",targetMapId:x,sourceMapId:M.mapId})}}},td.prototype.receive=function(a){var u=a.data,p=u.id;if(p&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[p];var x=this.cancelCallbacks[p];delete this.cancelCallbacks[p],x&&x()}else Rt()||u.mustQueue?(this.tasks[p]=u,this.taskQueue.push(p),this.invoker.trigger()):this.processTask(p,u)},td.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),u=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(a,u)}},td.prototype.processTask=function(a,u){var p=this;if(u.type==="<response>"){var x=this.callbacks[a];delete this.callbacks[a],x&&(u.error?x(bs(u.error)):x(null,bs(u.data)))}else{var T=!1,M=se(this.globalScope)?void 0:[],L=u.hasCallback?function(et,ot){T=!0,delete p.cancelCallbacks[a],p.target.postMessage({id:a,type:"<response>",sourceMapId:p.mapId,error:et?xo(et):null,data:xo(ot,M)},M)}:function(et){T=!0},N=null,j=bs(u.data);if(this.parent[u.type])N=this.parent[u.type](u.sourceMapId,j,L);else if(this.parent.getWorkerSource){var Z=u.type.split(".");N=this.parent.getWorkerSource(u.sourceMapId,Z[0],j.source)[Z[1]](j,L)}else L(new Error("Could not find function "+u.type));!T&&N&&N.cancel&&(this.cancelCallbacks[a]=N.cancel)}},td.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Gr=function(a,u){a&&(u?this.setSouthWest(a).setNorthEast(u):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Gr.prototype.setNorthEast=function(a){return this._ne=a instanceof ar?new ar(a.lng,a.lat):ar.convert(a),this},Gr.prototype.setSouthWest=function(a){return this._sw=a instanceof ar?new ar(a.lng,a.lat):ar.convert(a),this},Gr.prototype.extend=function(a){var u,p,x=this._sw,T=this._ne;if(a instanceof ar)u=a,p=a;else{if(!(a instanceof Gr))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Gr.convert(a)):this.extend(ar.convert(a)):this;if(p=a._ne,!(u=a._sw)||!p)return this}return x||T?(x.lng=Math.min(u.lng,x.lng),x.lat=Math.min(u.lat,x.lat),T.lng=Math.max(p.lng,T.lng),T.lat=Math.max(p.lat,T.lat)):(this._sw=new ar(u.lng,u.lat),this._ne=new ar(p.lng,p.lat)),this},Gr.prototype.getCenter=function(){return new ar((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Gr.prototype.getSouthWest=function(){return this._sw},Gr.prototype.getNorthEast=function(){return this._ne},Gr.prototype.getNorthWest=function(){return new ar(this.getWest(),this.getNorth())},Gr.prototype.getSouthEast=function(){return new ar(this.getEast(),this.getSouth())},Gr.prototype.getWest=function(){return this._sw.lng},Gr.prototype.getSouth=function(){return this._sw.lat},Gr.prototype.getEast=function(){return this._ne.lng},Gr.prototype.getNorth=function(){return this._ne.lat},Gr.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Gr.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Gr.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Gr.prototype.contains=function(a){var u=ar.convert(a),p=u.lng,x=u.lat,T=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(T=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&T},Gr.convert=function(a){return!a||a instanceof Gr?a:new Gr(a)};var ar=function(a,u){if(isNaN(a)||isNaN(u))throw new Error("Invalid LngLat object: ("+a+", "+u+")");if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ar.prototype.wrap=function(){return new ar(H(this.lng,-180,180),this.lat)},ar.prototype.toArray=function(){return[this.lng,this.lat]},ar.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ar.prototype.distanceTo=function(a){var u=Math.PI/180,p=this.lat*u,x=a.lat*u,T=Math.sin(p)*Math.sin(x)+Math.cos(p)*Math.cos(x)*Math.cos((a.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(T,1))},ar.prototype.toBounds=function(a){a===void 0&&(a=0);var u=360*a/40075017,p=u/Math.cos(Math.PI/180*this.lat);return new Gr(new ar(this.lng-p,this.lat-u),new ar(this.lng+p,this.lat+u))},ar.convert=function(a){if(a instanceof ar)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new ar(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new ar(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var wE=2*Math.PI*63710088e-1;function EE(a){return wE*Math.cos(a*Math.PI/180)}function CE(a){return(180+a)/360}function TE(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function SE(a,u){return a/EE(u)}function Hv(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var Ph=function(a,u,p){p===void 0&&(p=0),this.x=+a,this.y=+u,this.z=+p};Ph.fromLngLat=function(a,u){u===void 0&&(u=0);var p=ar.convert(a);return new Ph(CE(p.lng),TE(p.lat),SE(u,p.lat))},Ph.prototype.toLngLat=function(){return new ar(360*this.x-180,Hv(this.y))},Ph.prototype.toAltitude=function(){return this.z*EE(Hv(this.y))},Ph.prototype.meterInMercatorCoordinateUnits=function(){return 1/wE*(a=Hv(this.y),1/Math.cos(a*Math.PI/180));var a};var Ih=function(a,u,p){this.z=a,this.x=u,this.y=p,this.key=eA(0,a,a,u,p)};Ih.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},Ih.prototype.url=function(a,u){var p,x,T,M,L,N=(x=this.y,T=this.z,M=xE(256*(p=this.x),256*(x=Math.pow(2,T)-x-1),T),L=xE(256*(p+1),256*(x+1),T),M[0]+","+M[1]+","+L[0]+","+L[1]),j=(function(Z,et,ot){for(var At,bt="",Vt=Z;Vt>0;Vt--)bt+=(et&(At=1<<Vt-1)?1:0)+(ot&At?2:0);return bt})(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",j).replace("{bbox-epsg-3857}",N)},Ih.prototype.getTilePoint=function(a){var u=Math.pow(2,this.z);return new _(8192*(a.x*u-this.x),8192*(a.y*u-this.y))},Ih.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var PE=function(a,u){this.wrap=a,this.canonical=u,this.key=eA(a,u.z,u.z,u.x,u.y)},jr=function(a,u,p,x,T){this.overscaledZ=a,this.wrap=u,this.canonical=new Ih(p,+x,+T),this.key=eA(u,a,p,x,T)};function eA(a,u,p,x,T){(a*=2)<0&&(a=-1*a-1);var M=1<<p;return(M*M*a+M*T+x).toString(36)+p.toString(36)+u.toString(36)}jr.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},jr.prototype.scaledTo=function(a){var u=this.canonical.z-a;return a>this.canonical.z?new jr(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jr(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)},jr.prototype.calculateScaledKey=function(a,u){var p=this.canonical.z-a;return a>this.canonical.z?eA(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):eA(this.wrap*+u,a,a,this.canonical.x>>p,this.canonical.y>>p)},jr.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u},jr.prototype.children=function(a){if(this.overscaledZ>=a)return[new jr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,p=2*this.canonical.x,x=2*this.canonical.y;return[new jr(u,this.wrap,u,p,x),new jr(u,this.wrap,u,p+1,x),new jr(u,this.wrap,u,p,x+1),new jr(u,this.wrap,u,p+1,x+1)]},jr.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},jr.prototype.wrapped=function(){return new jr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},jr.prototype.unwrapTo=function(a){return new jr(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},jr.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},jr.prototype.toUnwrapped=function(){return new PE(this.wrap,this.canonical)},jr.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},jr.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new Ph(a.x-this.wrap,a.y))},ci("CanonicalTileID",Ih),ci("OverscaledTileID",jr,{omit:["posMatrix"]});var Lu=function(a,u,p){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return dt('"'+p+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var x=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=p||"mapbox";for(var T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)]};Lu.prototype.get=function(a,u){var p=new Uint8Array(this.data.buffer),x=4*this._idx(a,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(p[x],p[x+1],p[x+2])},Lu.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Lu.prototype._idx=function(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)},Lu.prototype._unpackMapbox=function(a,u,p){return(256*a*256+256*u+p)/10-1e4},Lu.prototype._unpackTerrarium=function(a,u,p){return 256*a+u+p/256-32768},Lu.prototype.getPixels=function(){return new co({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Lu.prototype.backfillBorder=function(a,u,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var x=u*this.dim,T=u*this.dim+this.dim,M=p*this.dim,L=p*this.dim+this.dim;switch(u){case-1:x=T-1;break;case 1:T=x+1}switch(p){case-1:M=L-1;break;case 1:L=M+1}for(var N=-u*this.dim,j=-p*this.dim,Z=M;Z<L;Z++)for(var et=x;et<T;et++)this.data[this._idx(et,Z)]=a.data[this._idx(et+N,Z+j)]},ci("DEMData",Lu);var qm=function(a){this._stringToNumber={},this._numberToString=[];for(var u=0;u<a.length;u++){var p=a[u];this._stringToNumber[p]=u,this._numberToString[u]=p}};qm.prototype.encode=function(a){return this._stringToNumber[a]},qm.prototype.decode=function(a){return this._numberToString[a]};var Km=function(a,u,p,x,T){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=p,a._y=x,this.properties=a.properties,this.id=T},Xv={geometry:{configurable:!0}};Xv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Xv.geometry.set=function(a){this._geometry=a},Km.prototype.toJSON=function(){var a={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a},Object.defineProperties(Km.prototype,Xv);var ed=function(){this.state={},this.stateChanges={},this.deletedStates={}};ed.prototype.updateState=function(a,u,p){var x=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][x]=this.stateChanges[a][x]||{},$(this.stateChanges[a][x],p),this.deletedStates[a]===null)for(var T in this.deletedStates[a]={},this.state[a])T!==x&&(this.deletedStates[a][T]=null);else if(this.deletedStates[a]&&this.deletedStates[a][x]===null)for(var M in this.deletedStates[a][x]={},this.state[a][x])p[M]||(this.deletedStates[a][x][M]=null);else for(var L in p)this.deletedStates[a]&&this.deletedStates[a][x]&&this.deletedStates[a][x][L]===null&&delete this.deletedStates[a][x][L]},ed.prototype.removeFeatureState=function(a,u,p){if(this.deletedStates[a]!==null){var x=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},p&&u!==void 0)this.deletedStates[a][x]!==null&&(this.deletedStates[a][x]=this.deletedStates[a][x]||{},this.deletedStates[a][x][p]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][x])for(p in this.deletedStates[a][x]={},this.stateChanges[a][x])this.deletedStates[a][x][p]=null;else this.deletedStates[a][x]=null;else this.deletedStates[a]=null}},ed.prototype.getState=function(a,u){var p=String(u),x=$({},(this.state[a]||{})[p],(this.stateChanges[a]||{})[p]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var T=this.deletedStates[a][u];if(T===null)return{};for(var M in T)delete x[M]}return x},ed.prototype.initializeTileState=function(a,u){a.setFeatureState(this.state,u)},ed.prototype.coalesceChanges=function(a,u){var p={};for(var x in this.stateChanges){this.state[x]=this.state[x]||{};var T={};for(var M in this.stateChanges[x])this.state[x][M]||(this.state[x][M]={}),$(this.state[x][M],this.stateChanges[x][M]),T[M]=this.state[x][M];p[x]=T}for(var L in this.deletedStates){this.state[L]=this.state[L]||{};var N={};if(this.deletedStates[L]===null)for(var j in this.state[L])N[j]={},this.state[L][j]={};else for(var Z in this.deletedStates[L]){if(this.deletedStates[L][Z]===null)this.state[L][Z]={};else for(var et=0,ot=Object.keys(this.deletedStates[L][Z]);et<ot.length;et+=1)delete this.state[L][Z][ot[et]];N[Z]=this.state[L][Z]}p[L]=p[L]||{},$(p[L],N)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(var At in a)a[At].setFeatureState(p,u)};var Du=function(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new ao(8192,16,0),this.grid3D=new ao(8192,16,0),this.featureIndexArray=new at,this.promoteId=u};function IE(a,u,p,x,T){return ft(a,function(M,L){var N=u instanceof Tu?u.get(L):null;return N&&N.evaluate?N.evaluate(p,x,T):N})}function ME(a){for(var u=1/0,p=1/0,x=-1/0,T=-1/0,M=0,L=a;M<L.length;M+=1){var N=L[M];u=Math.min(u,N.x),p=Math.min(p,N.y),x=Math.max(x,N.x),T=Math.max(T,N.y)}return{minX:u,minY:p,maxX:x,maxY:T}}function pF(a,u){return u-a}Du.prototype.insert=function(a,u,p,x,T,M){var L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,x,T);for(var N=M?this.grid3D:this.grid,j=0;j<u.length;j++){for(var Z=u[j],et=[1/0,1/0,-1/0,-1/0],ot=0;ot<Z.length;ot++){var At=Z[ot];et[0]=Math.min(et[0],At.x),et[1]=Math.min(et[1],At.y),et[2]=Math.max(et[2],At.x),et[3]=Math.max(et[3],At.y)}et[0]<8192&&et[1]<8192&&et[2]>=0&&et[3]>=0&&N.insert(L,et[0],et[1],et[2],et[3])}},Du.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Xf.VectorTile(new Om(this.rawTileData)).layers,this.sourceLayerCoder=new qm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Du.prototype.query=function(a,u,p,x){var T=this;this.loadVTLayers();for(var M=a.params||{},L=8192/a.tileSize/a.scale,N=_s(M.filter),j=a.queryGeometry,Z=a.queryPadding*L,et=ME(j),ot=this.grid.query(et.minX-Z,et.minY-Z,et.maxX+Z,et.maxY+Z),At=ME(a.cameraQueryGeometry),bt=this.grid3D.query(At.minX-Z,At.minY-Z,At.maxX+Z,At.maxY+Z,function(be,we,Ne,Je){return(function(ri,Si,li,Li,ui){for(var an=0,Vi=ri;an<Vi.length;an+=1){var gi=Vi[an];if(Si<=gi.x&&li<=gi.y&&Li>=gi.x&&ui>=gi.y)return!0}var yn=[new _(Si,li),new _(Si,ui),new _(Li,ui),new _(Li,li)];if(ri.length>2){for(var tn=0,Cn=yn;tn<Cn.length;tn+=1)if(Ta(ri,Cn[tn]))return!0}for(var Di=0;Di<ri.length-1;Di++)if(Eh(ri[Di],ri[Di+1],yn))return!0;return!1})(a.cameraQueryGeometry,be-Z,we-Z,Ne+Z,Je+Z)}),Vt=0,jt=bt;Vt<jt.length;Vt+=1)ot.push(jt[Vt]);ot.sort(pF);for(var Qt,Zt={},re=function(be){var we=ot[be];if(we!==Qt){Qt=we;var Ne=T.featureIndexArray.get(we),Je=null;T.loadMatchingFeature(Zt,Ne.bucketIndex,Ne.sourceLayerIndex,Ne.featureIndex,N,M.layers,M.availableImages,u,p,x,function(ri,Si,li){return Je||(Je=ai(ri)),Si.queryIntersectsFeature(j,ri,li,Je,T.z,a.transform,L,a.pixelPosMatrix)})}},pe=0;pe<ot.length;pe++)re(pe);return Zt},Du.prototype.loadMatchingFeature=function(a,u,p,x,T,M,L,N,j,Z,et){var ot=this.bucketLayerIDs[u];if(!M||(function(ri,Si){for(var li=0;li<ri.length;li++)if(Si.indexOf(ri[li])>=0)return!0;return!1})(M,ot)){var At=this.sourceLayerCoder.decode(p),bt=this.vtLayers[At].feature(x);if(T.needGeometry){var Vt=We(bt,!0);if(!T.filter(new un(this.tileID.overscaledZ),Vt,this.tileID.canonical))return}else if(!T.filter(new un(this.tileID.overscaledZ),bt))return;for(var jt=this.getId(bt,At),Qt=0;Qt<ot.length;Qt++){var Zt=ot[Qt];if(!(M&&M.indexOf(Zt)<0)){var re=N[Zt];if(re){var pe={};jt!==void 0&&Z&&(pe=Z.getState(re.sourceLayer||"_geojsonTileLayer",jt));var be=$({},j[Zt]);be.paint=IE(be.paint,re.paint,bt,pe,L),be.layout=IE(be.layout,re.layout,bt,pe,L);var we=!et||et(bt,re,pe);if(we){var Ne=new Km(bt,this.z,this.x,this.y,jt);Ne.layer=be;var Je=a[Zt];Je===void 0&&(Je=a[Zt]=[]),Je.push({featureIndex:x,feature:Ne,intersectionZ:we})}}}}}},Du.prototype.lookupSymbolFeatures=function(a,u,p,x,T,M,L,N){var j={};this.loadVTLayers();for(var Z=_s(T),et=0,ot=a;et<ot.length;et+=1)this.loadMatchingFeature(j,p,x,ot[et],Z,M,L,N,u);return j},Du.prototype.hasLayer=function(a){for(var u=0,p=this.bucketLayerIDs;u<p.length;u+=1)for(var x=0,T=p[u];x<T.length;x+=1)if(a===T[x])return!0;return!1},Du.prototype.getId=function(a,u){var p=a.id;return this.promoteId&&typeof(p=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(p=Number(p)),p},ci("FeatureIndex",Du,{omit:["rawTileData","sourceLayerCoder"]});var os=function(a,u){this.tileID=a,this.uid=ct(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};os.prototype.registerFadeDuration=function(a){var u=a+this.timeAdded;u<ii.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},os.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},os.prototype.loadVectorData=function(a,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var x in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=(function(Z,et){var ot={};if(!et)return ot;for(var At=function(){var jt=Vt[bt],Qt=jt.layerIds.map(function(pe){return et.getLayer(pe)}).filter(Boolean);if(Qt.length!==0){jt.layers=Qt,jt.stateDependentLayerIds&&(jt.stateDependentLayers=jt.stateDependentLayerIds.map(function(pe){return Qt.filter(function(be){return be.id===pe})[0]}));for(var Zt=0,re=Qt;Zt<re.length;Zt+=1)ot[re[Zt].id]=jt}},bt=0,Vt=Z;bt<Vt.length;bt+=1)At();return ot})(a.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var T=this.buckets[x];if(T instanceof Nn){if(this.hasSymbolBuckets=!0,!p)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var M in this.buckets){var L=this.buckets[M];if(L instanceof Nn&&L.hasRTLText){this.hasRTLText=!0,rs.isLoading()||rs.isLoaded()||vh()!=="deferred"||Co();break}}for(var N in this.queryPadding=0,this.buckets){var j=this.buckets[N];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(N).queryRadius(j))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new v},os.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},os.prototype.getBucket=function(a){return this.buckets[a.id]},os.prototype.upload=function(a){for(var u in this.buckets){var p=this.buckets[u];p.uploadPending()&&p.upload(a)}var x=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Sh(a,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Sh(a,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)},os.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},os.prototype.queryRenderedFeatures=function(a,u,p,x,T,M,L,N,j,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:T,scale:M,tileSize:this.tileSize,pixelPosMatrix:Z,transform:N,params:L,queryPadding:this.queryPadding*j},a,u,p):{}},os.prototype.querySourceFeatures=function(a,u){var p=this.latestFeatureIndex;if(p&&p.rawTileData){var x=p.loadVTLayers(),T=u?u.sourceLayer:"",M=x._geojsonTileLayer||x[T];if(M)for(var L=_s(u&&u.filter),N=this.tileID.canonical,j=N.z,Z=N.x,et=N.y,ot={z:j,x:Z,y:et},At=0;At<M.length;At++){var bt=M.feature(At);if(L.needGeometry){var Vt=We(bt,!0);if(!L.filter(new un(this.tileID.overscaledZ),Vt,this.tileID.canonical))continue}else if(!L.filter(new un(this.tileID.overscaledZ),bt))continue;var jt=p.getId(bt,T),Qt=new Km(bt,j,Z,et,jt);Qt.tile=ot,a.push(Qt)}}},os.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},os.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},os.prototype.setExpiryData=function(a){var u=this.expirationTime;if(a.cacheControl){var p=Ft(a.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var x=Date.now(),T=!1;if(this.expirationTime>x)T=!1;else if(u)if(this.expirationTime<u)T=!0;else{var M=this.expirationTime-u;M?this.expirationTime=x+Math.max(M,3e4):T=!0}else T=!0;T?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},os.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},os.prototype.setFeatureState=function(a,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var p=this.latestFeatureIndex.loadVTLayers();for(var x in this.buckets)if(u.style.hasLayer(x)){var T=this.buckets[x],M=T.layers[0].sourceLayer||"_geojsonTileLayer",L=p[M],N=a[M];if(L&&N&&Object.keys(N).length!==0){T.update(N,L,this.imageAtlas&&this.imageAtlas.patternPositions||{});var j=u&&u.style&&u.style.getLayer(x);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(T)))}}}},os.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},os.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ii.now()},os.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},os.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=ii.now()+a},os.prototype.setDependencies=function(a,u){for(var p={},x=0,T=u;x<T.length;x+=1)p[T[x]]=!0;this.dependencies[a]=p},os.prototype.hasDependency=function(a,u){for(var p=0,x=a;p<x.length;p+=1){var T=this.dependencies[x[p]];if(T){for(var M=0,L=u;M<L.length;M+=1)if(T[L[M]])return!0}}return!1};var Mc=I.performance,BE=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Mc.mark(this._marks.start)};BE.prototype.finish=function(){Mc.mark(this._marks.end);var a=Mc.getEntriesByName(this._marks.measure);return a.length===0&&(Mc.measure(this._marks.measure,this._marks.start,this._marks.end),a=Mc.getEntriesByName(this._marks.measure),Mc.clearMarks(this._marks.start),Mc.clearMarks(this._marks.end),Mc.clearMeasures(this._marks.measure)),a},s.Actor=td,s.AlphaImage=Th,s.CanonicalTileID=Ih,s.CollisionBoxArray=v,s.Color=sn,s.DEMData=Lu,s.DataConstantProperty=Ii,s.DictionaryCoder=qm,s.EXTENT=8192,s.ErrorEvent=mt,s.EvaluationParameters=un,s.Event=Nt,s.Evented=wt,s.FeatureIndex=Du,s.FillBucket=tl,s.FillExtrusionBucket=el,s.ImageAtlas=$p,s.ImagePosition=Nm,s.LineBucket=Js,s.LngLat=ar,s.LngLatBounds=Gr,s.MercatorCoordinate=Ph,s.ONE_EM=24,s.OverscaledTileID=jr,s.Point=_,s.Point$1=_,s.Properties=Kr,s.Protobuf=Om,s.RGBAImage=co,s.RequestManager=xi,s.RequestPerformance=BE,s.ResourceType=qe,s.SegmentVector=Ct,s.SourceFeatureState=ed,s.StructArrayLayout1ui2=Iu,s.StructArrayLayout2f1f2i16=Ja,s.StructArrayLayout2i4=Po,s.StructArrayLayout3ui6=xs,s.StructArrayLayout4i8=Ns,s.SymbolBucket=Nn,s.Texture=Sh,s.Tile=os,s.Transitionable=Dr,s.Uniform1f=U,s.Uniform1i=F,s.Uniform2f=W,s.Uniform3f=ht,s.Uniform4f=Pt,s.UniformColor=It,s.UniformMatrix4f=Yt,s.UnwrappedTileID=PE,s.ValidationError=pt,s.WritingMode=Wo,s.ZoomHistory=gh,s.add=function(a,u,p){return a[0]=u[0]+p[0],a[1]=u[1]+p[1],a[2]=u[2]+p[2],a},s.addDynamicAttributes=Gv,s.asyncAll=function(a,u,p){if(!a.length)return p(null,[]);var x=a.length,T=new Array(a.length),M=null;a.forEach(function(L,N){u(L,function(j,Z){j&&(M=j),T[N]=Z,--x==0&&p(M,T)})})},s.bezier=z,s.bindAll=Ot,s.browser=ii,s.cacheEntryPossiblyAdded=function(a){++Fe>je&&(a.getActor().send("enforceCacheSizeLimit",Lt),Fe=0)},s.clamp=X,s.clearTileCache=function(a){var u=I.caches.delete("mapbox-tiles");a&&u.catch(a).then(function(){return a()})},s.clipLine=fE,s.clone=function(a){var u=new Mn(16);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u},s.clone$1=Ut,s.clone$2=function(a){var u=new Mn(3);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u},s.collisionCircleLayout=LO,s.config=Qe,s.create=function(){var a=new Mn(16);return Mn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},s.create$1=function(){var a=new Mn(9);return Mn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},s.create$2=function(){var a=new Mn(4);return Mn!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.createCommonjsModule=l,s.createExpression=mc,s.createLayout=zr,s.createStyleLayer=function(a){return a.type==="custom"?new fF(a):new dF[a.type](a)},s.cross=function(a,u,p){var x=u[0],T=u[1],M=u[2],L=p[0],N=p[1],j=p[2];return a[0]=T*j-M*N,a[1]=M*L-x*j,a[2]=x*N-T*L,a},s.deepEqual=function a(u,p){if(Array.isArray(u)){if(!Array.isArray(p)||u.length!==p.length)return!1;for(var x=0;x<u.length;x++)if(!a(u[x],p[x]))return!1;return!0}if(typeof u=="object"&&u!==null&&p!==null){if(typeof p!="object"||Object.keys(u).length!==Object.keys(p).length)return!1;for(var T in u)if(!a(u[T],p[T]))return!1;return!0}return u===p},s.dot=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]},s.dot$1=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]},s.ease=V,s.emitValidationErrors=Eu,s.endsWith=Kt,s.enforceCacheSizeLimit=function(a){$e(),Bn&&Bn.then(function(u){u.keys().then(function(p){for(var x=0;x<p.length-a;x++)u.delete(p[x])})})},s.evaluateSizeForFeature=oE,s.evaluateSizeForZoom=aE,s.evaluateVariableOffset=AE,s.evented=wc,s.extend=$,s.featureFilter=_s,s.filterObject=st,s.fromRotation=function(a,u){var p=Math.sin(u),x=Math.cos(u);return a[0]=x,a[1]=p,a[2]=0,a[3]=-p,a[4]=x,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.getAnchorAlignment=Nv,s.getAnchorJustification=Vv,s.getArrayBuffer=ee,s.getImage=it,s.getJSON=function(a,u){return St($(a,{type:"json"}),u)},s.getRTLTextPluginStatus=vh,s.getReferrer=q,s.getVideo=function(a,u){var p,x,T=I.document.createElement("video");T.muted=!0,T.onloadstart=function(){u(null,T)};for(var M=0;M<a.length;M++){var L=I.document.createElement("source");p=a[M],x=void 0,(x=I.document.createElement("a")).href=p,(x.protocol!==I.document.location.protocol||x.host!==I.document.location.host)&&(T.crossOrigin="Anonymous"),L.src=a[M],T.appendChild(L)}return{cancel:function(){}}},s.identity=Bo,s.invert=function(a,u){var p=u[0],x=u[1],T=u[2],M=u[3],L=u[4],N=u[5],j=u[6],Z=u[7],et=u[8],ot=u[9],At=u[10],bt=u[11],Vt=u[12],jt=u[13],Qt=u[14],Zt=u[15],re=p*N-x*L,pe=p*j-T*L,be=p*Z-M*L,we=x*j-T*N,Ne=x*Z-M*N,Je=T*Z-M*j,ri=et*jt-ot*Vt,Si=et*Qt-At*Vt,li=et*Zt-bt*Vt,Li=ot*Qt-At*jt,ui=ot*Zt-bt*jt,an=At*Zt-bt*Qt,Vi=re*an-pe*ui+be*Li+we*li-Ne*Si+Je*ri;return Vi?(a[0]=(N*an-j*ui+Z*Li)*(Vi=1/Vi),a[1]=(T*ui-x*an-M*Li)*Vi,a[2]=(jt*Je-Qt*Ne+Zt*we)*Vi,a[3]=(At*Ne-ot*Je-bt*we)*Vi,a[4]=(j*li-L*an-Z*Si)*Vi,a[5]=(p*an-T*li+M*Si)*Vi,a[6]=(Qt*be-Vt*Je-Zt*pe)*Vi,a[7]=(et*Je-At*be+bt*pe)*Vi,a[8]=(L*ui-N*li+Z*ri)*Vi,a[9]=(x*li-p*ui-M*ri)*Vi,a[10]=(Vt*Ne-jt*be+Zt*re)*Vi,a[11]=(ot*be-et*Ne-bt*re)*Vi,a[12]=(N*Si-L*Li-j*ri)*Vi,a[13]=(p*Li-x*Si+T*ri)*Vi,a[14]=(jt*pe-Vt*we-Qt*re)*Vi,a[15]=(et*we-ot*pe+At*re)*Vi,a):null},s.isChar=ni,s.isMapboxURL=wi,s.keysDifference=function(a,u){var p=[];for(var x in a)x in u||p.push(x);return p},s.makeRequest=St,s.mapObject=ft,s.mercatorXfromLng=CE,s.mercatorYfromLat=TE,s.mercatorZfromAltitude=SE,s.mul=Tv,s.multiply=Qs,s.mvt=Xf,s.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},s.normalize=function(a,u){var p=u[0],x=u[1],T=u[2],M=p*p+x*x+T*T;return M>0&&(M=1/Math.sqrt(M)),a[0]=u[0]*M,a[1]=u[1]*M,a[2]=u[2]*M,a},s.number=gr,s.offscreenCanvasSupported=vt,s.ortho=function(a,u,p,x,T,M,L){var N=1/(u-p),j=1/(x-T),Z=1/(M-L);return a[0]=-2*N,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*j,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*Z,a[11]=0,a[12]=(u+p)*N,a[13]=(T+x)*j,a[14]=(L+M)*Z,a[15]=1,a},s.parseGlyphPBF=function(a){return new Om(a).readFields(HO,[])},s.pbf=Om,s.performSymbolLayout=function(a,u,p,x,T,M,L){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var N=a.layers[0].layout,j=a.layers[0]._unevaluatedLayout._values,Z={};if(a.textSizeData.kind==="composite"){var et=a.textSizeData,ot=et.maxZoom;Z.compositeTextSizes=[j["text-size"].possiblyEvaluate(new un(et.minZoom),L),j["text-size"].possiblyEvaluate(new un(ot),L)]}if(a.iconSizeData.kind==="composite"){var At=a.iconSizeData,bt=At.maxZoom;Z.compositeIconSizes=[j["icon-size"].possiblyEvaluate(new un(At.minZoom),L),j["icon-size"].possiblyEvaluate(new un(bt),L)]}Z.layoutTextSize=j["text-size"].possiblyEvaluate(new un(a.zoom+1),L),Z.layoutIconSize=j["icon-size"].possiblyEvaluate(new un(a.zoom+1),L),Z.textMaxSize=j["text-size"].possiblyEvaluate(new un(18));for(var Vt=24*N.get("text-line-height"),jt=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Qt=N.get("text-keep-upright"),Zt=N.get("text-size"),re=function(){var we=be[pe],Ne=N.get("text-font").evaluate(we,{},L).join(","),Je=Zt.evaluate(we,{},L),ri=Z.layoutTextSize.evaluate(we,{},L),Si=Z.layoutIconSize.evaluate(we,{},L),li={horizontal:{},vertical:void 0},Li=we.text,ui=[0,0];if(Li){var an=Li.toString(),Vi=24*N.get("text-letter-spacing").evaluate(we,{},L),gi=(function(_n){for(var Vn=0,kn=_n;Vn<kn.length;Vn+=1)if(Sn=kn[Vn].charCodeAt(0),ni.Arabic(Sn)||ni["Arabic Supplement"](Sn)||ni["Arabic Extended-A"](Sn)||ni["Arabic Presentation Forms-A"](Sn)||ni["Arabic Presentation Forms-B"](Sn))return!1;var Sn;return!0})(an)?Vi:0,yn=N.get("text-anchor").evaluate(we,{},L),tn=N.get("text-variable-anchor");if(!tn){var Cn=N.get("text-radial-offset").evaluate(we,{},L);ui=Cn?AE(yn,[24*Cn,Uv]):N.get("text-offset").evaluate(we,{},L).map(function(_n){return 24*_n})}var Di=jt?"center":N.get("text-justify").evaluate(we,{},L),Pn=N.get("symbol-placement"),lr=Pn==="point"?24*N.get("text-max-width").evaluate(we,{},L):0,Er=function(){a.allowVerticalPlacement&&wo(an)&&(li.vertical=zm(Li,u,p,T,Ne,lr,Vt,yn,"left",gi,ui,Wo.vertical,!0,Pn,ri,Je))};if(!jt&&tn){for(var yr=Di==="auto"?tn.map(function(_n){return Vv(_n)}):[Di],ur=!1,Cr=0;Cr<yr.length;Cr++){var Yr=yr[Cr];if(!li.horizontal[Yr])if(ur)li.horizontal[Yr]=li.horizontal[0];else{var Qr=zm(Li,u,p,T,Ne,lr,Vt,"center",Yr,gi,ui,Wo.horizontal,!1,Pn,ri,Je);Qr&&(li.horizontal[Yr]=Qr,ur=Qr.positionedLines.length===1)}}Er()}else{Di==="auto"&&(Di=Vv(yn));var Vs=zm(Li,u,p,T,Ne,lr,Vt,yn,Di,gi,ui,Wo.horizontal,!1,Pn,ri,Je);Vs&&(li.horizontal[Di]=Vs),Er(),wo(an)&&jt&&Qt&&(li.vertical=zm(Li,u,p,T,Ne,lr,Vt,yn,Di,gi,ui,Wo.vertical,!1,Pn,ri,Je))}}var as=void 0,Gs=!1;if(we.icon&&we.icon.name){var Ir=x[we.icon.name];Ir&&(as=(function(_n,Vn,kn){var Sn=Nv(kn),$s=Vn[0]-_n.displaySize[0]*Sn.horizontalAlign,ws=Vn[1]-_n.displaySize[1]*Sn.verticalAlign;return{image:_n,top:ws,bottom:ws+_n.displaySize[1],left:$s,right:$s+_n.displaySize[0]}})(T[we.icon.name],N.get("icon-offset").evaluate(we,{},L),N.get("icon-anchor").evaluate(we,{},L)),Gs=Ir.sdf,a.sdfIcons===void 0?a.sdfIcons=Ir.sdf:a.sdfIcons!==Ir.sdf&&dt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ir.pixelRatio!==a.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var ls=gE(li.horizontal)||li.vertical;a.iconsInText=!!ls&&ls.iconsInText,(ls||as)&&(function(_n,Vn,kn,Sn,$s,ws,ir,kr,Es,In,jl){var Ho=ws.textMaxSize.evaluate(Vn,{});Ho===void 0&&(Ho=ir);var Wl,Mr=_n.layers[0].layout,Hl=Mr.get("icon-offset").evaluate(Vn,{},jl),Pa=gE(kn.horizontal),id=ir/24,Mh=_n.tilePixelRatio*id,nd=_n.tilePixelRatio*Ho/24,ku=_n.tilePixelRatio*kr,rd=_n.tilePixelRatio*Mr.get("symbol-spacing"),Zm=Mr.get("text-padding")*_n.tilePixelRatio,sd=Mr.get("icon-padding")*_n.tilePixelRatio,iA=Mr.get("text-max-angle")/180*Math.PI,Ym=Mr.get("text-rotation-alignment")==="map"&&Mr.get("symbol-placement")!=="point",Qm=Mr.get("icon-rotation-alignment")==="map"&&Mr.get("symbol-placement")!=="point",Ou=Mr.get("symbol-placement"),nA=rd/2,od=Mr.get("icon-text-fit");Sn&&od!=="none"&&(_n.allowVerticalPlacement&&kn.vertical&&(Wl=sE(Sn,kn.vertical,od,Mr.get("icon-text-fit-padding"),Hl,id)),Pa&&(Sn=sE(Sn,Pa,od,Mr.get("icon-text-fit-padding"),Hl,id)));var Bc=function(AF,hA){hA.x<0||hA.x>=8192||hA.y<0||hA.y>=8192||(function(Br,il,mF,Rc,Yv,DE,n0,Xl,r0,fA,s0,o0,Qv,kE,dA,OE,FE,NE,zE,UE,Xo,a0,VE,ql,gF){var GE,Rh,hd,fd,dd,pd=Br.addToLineVertexArray(il,mF),jE=0,WE=0,HE=0,XE=0,Jv=-1,$v=-1,Fu={},qE=h(""),t_=0,e_=0;if(Xl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(t_=(GE=Xl.layout.get("text-offset").evaluate(Xo,{},ql).map(function(AA){return 24*AA}))[0],e_=GE[1]):(t_=24*Xl.layout.get("text-radial-offset").evaluate(Xo,{},ql),e_=Uv),Br.allowVerticalPlacement&&Rc.vertical){var KE=Xl.layout.get("text-rotate").evaluate(Xo,{},ql)+90;fd=new Wm(r0,il,fA,s0,o0,Rc.vertical,Qv,kE,dA,KE),n0&&(dd=new Wm(r0,il,fA,s0,o0,n0,FE,NE,dA,KE))}if(Yv){var i_=Xl.layout.get("icon-rotate").evaluate(Xo,{}),ZE=Xl.layout.get("icon-text-fit")!=="none",YE=dE(Yv,i_,VE,ZE),n_=n0?dE(n0,i_,VE,ZE):void 0;hd=new Wm(r0,il,fA,s0,o0,Yv,FE,NE,!1,i_),jE=4*YE.length;var QE=Br.iconSizeData,pA=null;QE.kind==="source"?(pA=[128*Xl.layout.get("icon-size").evaluate(Xo,{})])[0]>32640&&dt(Br.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):QE.kind==="composite"&&((pA=[128*a0.compositeIconSizes[0].evaluate(Xo,{},ql),128*a0.compositeIconSizes[1].evaluate(Xo,{},ql)])[0]>32640||pA[1]>32640)&&dt(Br.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Br.addSymbols(Br.icon,YE,pA,UE,zE,Xo,!1,il,pd.lineStartIndex,pd.lineLength,-1,ql),Jv=Br.icon.placedSymbolArray.length-1,n_&&(WE=4*n_.length,Br.addSymbols(Br.icon,n_,pA,UE,zE,Xo,Wo.vertical,il,pd.lineStartIndex,pd.lineLength,-1,ql),$v=Br.icon.placedSymbolArray.length-1)}for(var JE in Rc.horizontal){var l0=Rc.horizontal[JE];if(!Rh){qE=h(l0.text);var yF=Xl.layout.get("text-rotate").evaluate(Xo,{},ql);Rh=new Wm(r0,il,fA,s0,o0,l0,Qv,kE,dA,yF)}var $E=l0.positionedLines.length===1;if(HE+=mE(Br,il,l0,DE,Xl,dA,Xo,OE,pd,Rc.vertical?Wo.horizontal:Wo.horizontalOnly,$E?Object.keys(Rc.horizontal):[JE],Fu,Jv,a0,ql),$E)break}Rc.vertical&&(XE+=mE(Br,il,Rc.vertical,DE,Xl,dA,Xo,OE,pd,Wo.vertical,["vertical"],Fu,$v,a0,ql));var vF=Rh?Rh.boxStartIndex:Br.collisionBoxArray.length,_F=Rh?Rh.boxEndIndex:Br.collisionBoxArray.length,bF=fd?fd.boxStartIndex:Br.collisionBoxArray.length,xF=fd?fd.boxEndIndex:Br.collisionBoxArray.length,wF=hd?hd.boxStartIndex:Br.collisionBoxArray.length,EF=hd?hd.boxEndIndex:Br.collisionBoxArray.length,CF=dd?dd.boxStartIndex:Br.collisionBoxArray.length,TF=dd?dd.boxEndIndex:Br.collisionBoxArray.length,Kl=-1,u0=function(AA,eC){return AA&&AA.circleDiameter?Math.max(AA.circleDiameter,eC):eC};Kl=u0(Rh,Kl),Kl=u0(fd,Kl),Kl=u0(hd,Kl);var tC=(Kl=u0(dd,Kl))>-1?1:0;tC&&(Kl*=gF/24),Br.glyphOffsetArray.length>=Nn.MAX_GLYPHS&&dt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xo.sortKey!==void 0&&Br.addToSortKeyRanges(Br.symbolInstances.length,Xo.sortKey),Br.symbolInstances.emplaceBack(il.x,il.y,Fu.right>=0?Fu.right:-1,Fu.center>=0?Fu.center:-1,Fu.left>=0?Fu.left:-1,Fu.vertical||-1,Jv,$v,qE,vF,_F,bF,xF,wF,EF,CF,TF,fA,HE,XE,jE,WE,tC,0,Qv,t_,e_,Kl)})(_n,hA,AF,kn,Sn,$s,Wl,_n.layers[0],_n.collisionBoxArray,Vn.index,Vn.sourceLayerIndex,_n.index,Mh,Zm,Ym,Es,ku,sd,Qm,Hl,Vn,ws,In,jl,ir)};if(Ou==="line")for(var ad=0,Jm=fE(Vn.geometry,0,0,8192,8192);ad<Jm.length;ad+=1)for(var $m=Jm[ad],rA=0,sA=JO($m,rd,iA,kn.vertical||Pa,Sn,24,nd,_n.overscaling,8192);rA<sA.length;rA+=1){var t0=sA[rA];Pa&&iF(_n,Pa.text,nA,t0)||Bc($m,t0)}else if(Ou==="line-center")for(var oA=0,aA=Vn.geometry;oA<aA.length;oA+=1){var lA=aA[oA];if(lA.length>1){var e0=QO(lA,iA,kn.vertical||Pa,Sn,24,nd);e0&&Bc(lA,e0)}}else if(Vn.type==="Polygon")for(var ld=0,i0=Lv(Vn.geometry,0);ld<i0.length;ld+=1){var ud=i0[ld],uA=tF(ud,16);Bc(ud[0],new Zf(uA.x,uA.y,0))}else if(Vn.type==="LineString")for(var Bh=0,cA=Vn.geometry;Bh<cA.length;Bh+=1){var cd=cA[Bh];Bc(cd,new Zf(cd[0].x,cd[0].y,0))}else if(Vn.type==="Point")for(var qv=0,RE=Vn.geometry;qv<RE.length;qv+=1)for(var Kv=0,LE=RE[qv];Kv<LE.length;Kv+=1){var Zv=LE[Kv];Bc([Zv],new Zf(Zv.x,Zv.y,0))}})(a,we,li,as,x,Z,ri,Si,ui,Gs,L)},pe=0,be=a.features;pe<be.length;pe+=1)re();M&&a.generateCollisionDebugBuffers()},s.perspective=function(a,u,p,x,T){var M,L=1/Math.tan(u/2);return a[0]=L/p,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=L,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,T!=null&&T!==1/0?(a[10]=(T+x)*(M=1/(x-T)),a[14]=2*T*x*M):(a[10]=-1,a[14]=-2*x),a},s.pick=function(a,u){for(var p={},x=0;x<u.length;x++){var T=u[x];T in a&&(p[T]=a[T])}return p},s.plugin=rs,s.polygonIntersectsPolygon=Zi,s.postMapLoadEvent=Ar,s.postTurnstileEvent=Oi,s.potpack=eE,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=ci,s.registerForPluginStateChange=function(a){return a({pluginStatus:Sr,pluginURL:Eo}),wc.on("pluginStateChange",a),a},s.renderColorRamp=O3,s.rotate=function(a,u,p){var x=u[0],T=u[1],M=u[2],L=u[3],N=Math.sin(p),j=Math.cos(p);return a[0]=x*j+M*N,a[1]=T*j+L*N,a[2]=x*-N+M*j,a[3]=T*-N+L*j,a},s.rotateX=function(a,u,p){var x=Math.sin(p),T=Math.cos(p),M=u[4],L=u[5],N=u[6],j=u[7],Z=u[8],et=u[9],ot=u[10],At=u[11];return u!==a&&(a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[4]=M*T+Z*x,a[5]=L*T+et*x,a[6]=N*T+ot*x,a[7]=j*T+At*x,a[8]=Z*T-M*x,a[9]=et*T-L*x,a[10]=ot*T-N*x,a[11]=At*T-j*x,a},s.rotateZ=function(a,u,p){var x=Math.sin(p),T=Math.cos(p),M=u[0],L=u[1],N=u[2],j=u[3],Z=u[4],et=u[5],ot=u[6],At=u[7];return u!==a&&(a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[0]=M*T+Z*x,a[1]=L*T+et*x,a[2]=N*T+ot*x,a[3]=j*T+At*x,a[4]=Z*T-M*x,a[5]=et*T-L*x,a[6]=ot*T-N*x,a[7]=At*T-j*x,a},s.scale=function(a,u,p){var x=p[0],T=p[1],M=p[2];return a[0]=u[0]*x,a[1]=u[1]*x,a[2]=u[2]*x,a[3]=u[3]*x,a[4]=u[4]*T,a[5]=u[5]*T,a[6]=u[6]*T,a[7]=u[7]*T,a[8]=u[8]*M,a[9]=u[9]*M,a[10]=u[10]*M,a[11]=u[11]*M,a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a},s.scale$1=function(a,u,p){return a[0]=u[0]*p,a[1]=u[1]*p,a[2]=u[2]*p,a[3]=u[3]*p,a},s.scale$2=function(a,u,p){return a[0]=u[0]*p,a[1]=u[1]*p,a[2]=u[2]*p,a},s.setCacheLimits=function(a,u){Lt=a,je=u},s.setRTLTextPlugin=function(a,u,p){if(p===void 0&&(p=!1),Sr==="deferred"||Sr==="loading"||Sr==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Eo=ii.resolveURL(a),Sr="deferred",xc=u,Ea(),p||Co()},s.sphericalToCartesian=function(a){var u=a[0],p=a[1],x=a[2];return p+=90,p*=Math.PI/180,x*=Math.PI/180,{x:u*Math.cos(p)*Math.sin(x),y:u*Math.sin(p)*Math.sin(x),z:u*Math.cos(x)}},s.sqrLen=function(a){var u=a[0],p=a[1];return u*u+p*p},s.styleSpec=lt,s.sub=function(a,u,p){return a[0]=u[0]-p[0],a[1]=u[1]-p[1],a[2]=u[2]-p[2],a},s.symbolSize=YO,s.transformMat3=function(a,u,p){var x=u[0],T=u[1],M=u[2];return a[0]=x*p[0]+T*p[3]+M*p[6],a[1]=x*p[1]+T*p[4]+M*p[7],a[2]=x*p[2]+T*p[5]+M*p[8],a},s.transformMat4=Gf,s.translate=function(a,u,p){var x,T,M,L,N,j,Z,et,ot,At,bt,Vt,jt=p[0],Qt=p[1],Zt=p[2];return u===a?(a[12]=u[0]*jt+u[4]*Qt+u[8]*Zt+u[12],a[13]=u[1]*jt+u[5]*Qt+u[9]*Zt+u[13],a[14]=u[2]*jt+u[6]*Qt+u[10]*Zt+u[14],a[15]=u[3]*jt+u[7]*Qt+u[11]*Zt+u[15]):(T=u[1],M=u[2],L=u[3],N=u[4],j=u[5],Z=u[6],et=u[7],ot=u[8],At=u[9],bt=u[10],Vt=u[11],a[0]=x=u[0],a[1]=T,a[2]=M,a[3]=L,a[4]=N,a[5]=j,a[6]=Z,a[7]=et,a[8]=ot,a[9]=At,a[10]=bt,a[11]=Vt,a[12]=x*jt+N*Qt+ot*Zt+u[12],a[13]=T*jt+j*Qt+At*Zt+u[13],a[14]=M*jt+Z*Qt+bt*Zt+u[14],a[15]=L*jt+et*Qt+Vt*Zt+u[15]),a},s.triggerPluginCompletionEvent=Uf,s.uniqueId=ct,s.validateCustomStyleLayer=function(a){var u=[],p=a.id;return p===void 0&&u.push({message:"layers."+p+': missing required property "id"'}),a.render===void 0&&u.push({message:"layers."+p+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&u.push({message:"layers."+p+': property "renderingMode" must be either "2d" or "3d"'}),u},s.validateLight=Nf,s.validateStyle=xu,s.values=function(a){var u=[];for(var p in a)u.push(a[p]);return u},s.vectorTile=Xf,s.version="1.13.3",s.warnOnce=dt,s.webpSupported=yi,s.window=I,s.wrap=H}),o(["./shared"],function(s){function l(Q){var it=typeof Q;if(it==="number"||it==="boolean"||it==="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){for(var ut="[",xt=0,Nt=Q;xt<Nt.length;xt+=1)ut+=l(Nt[xt])+",";return ut+"]"}for(var mt=Object.keys(Q).sort(),wt="{",lt=0;lt<mt.length;lt++)wt+=JSON.stringify(mt[lt])+":"+l(Q[mt[lt]])+",";return wt+"}"}function c(Q){for(var it="",ut=0,xt=s.refProperties;ut<xt.length;ut+=1)it+="/"+l(Q[xt[ut]]);return it}var y=function(Q){this.keyCache={},Q&&this.replace(Q)};y.prototype.replace=function(Q){this._layerConfigs={},this._layers={},this.update(Q,[])},y.prototype.update=function(Q,it){for(var ut=this,xt=0,Nt=Q;xt<Nt.length;xt+=1){var mt=Nt[xt];this._layerConfigs[mt.id]=mt;var wt=this._layers[mt.id]=s.createStyleLayer(mt);wt._featureFilter=s.featureFilter(wt.filter),this.keyCache[mt.id]&&delete this.keyCache[mt.id]}for(var lt=0,pt=it;lt<pt.length;lt+=1){var d=pt[lt];delete this.keyCache[d],delete this._layerConfigs[d],delete this._layers[d]}this.familiesBySource={};for(var tt=0,Pe=(function(De,Ze){for(var Gi={},si=0;si<De.length;si++){var rn=Ze&&Ze[De[si].id]||c(De[si]);Ze&&(Ze[De[si].id]=rn);var hn=Gi[rn];hn||(hn=Gi[rn]=[]),hn.push(De[si])}var Yi=[];for(var Ji in Gi)Yi.push(Gi[Ji]);return Yi})(s.values(this._layerConfigs),this.keyCache);tt<Pe.length;tt+=1){var ne=Pe[tt].map(function(De){return ut._layers[De.id]}),Ie=ne[0];if(Ie.visibility!=="none"){var ke=Ie.source||"",Ue=this.familiesBySource[ke];Ue||(Ue=this.familiesBySource[ke]={});var ge=Ie.sourceLayer||"_geojsonTileLayer",Ve=Ue[ge];Ve||(Ve=Ue[ge]=[]),Ve.push(ne)}}};var _=function(Q){var it={},ut=[];for(var xt in Q){var Nt=Q[xt],mt=it[xt]={};for(var wt in Nt){var lt=Nt[+wt];if(lt&&lt.bitmap.width!==0&&lt.bitmap.height!==0){var pt={x:0,y:0,w:lt.bitmap.width+2,h:lt.bitmap.height+2};ut.push(pt),mt[wt]={rect:pt,metrics:lt.metrics}}}}var d=s.potpack(ut),tt=new s.AlphaImage({width:d.w||1,height:d.h||1});for(var Pe in Q){var ne=Q[Pe];for(var Ie in ne){var ke=ne[+Ie];if(ke&&ke.bitmap.width!==0&&ke.bitmap.height!==0){var Ue=it[Pe][Ie].rect;s.AlphaImage.copy(ke.bitmap,tt,{x:0,y:0},{x:Ue.x+1,y:Ue.y+1},ke.bitmap)}}}this.image=tt,this.positions=it};s.register("GlyphAtlas",_);var C=function(Q){this.tileID=new s.OverscaledTileID(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId};function I(Q,it,ut){for(var xt=new s.EvaluationParameters(it),Nt=0,mt=Q;Nt<mt.length;Nt+=1)mt[Nt].recalculate(xt,ut)}function k(Q,it){var ut=s.getArrayBuffer(Q.request,function(xt,Nt,mt,wt){xt?it(xt):Nt&&it(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(Nt)),rawData:Nt,cacheControl:mt,expires:wt})});return function(){ut.cancel(),it()}}C.prototype.parse=function(Q,it,ut,xt,Nt){var mt=this;this.status="parsing",this.data=Q,this.collisionBoxArray=new s.CollisionBoxArray;var wt=new s.DictionaryCoder(Object.keys(Q.layers).sort()),lt=new s.FeatureIndex(this.tileID,this.promoteId);lt.bucketLayerIDs=[];var pt,d,tt,Pe,ne={},Ie={featureIndex:lt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ut},ke=it.familiesBySource[this.source];for(var Ue in ke){var ge=Q.layers[Ue];if(ge){ge.version===1&&s.warnOnce('Vector tile source "'+this.source+'" layer "'+Ue+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Ve=wt.encode(Ue),De=[],Ze=0;Ze<ge.length;Ze++){var Gi=ge.feature(Ze),si=lt.getId(Gi,Ue);De.push({feature:Gi,id:si,index:Ze,sourceLayerIndex:Ve})}for(var rn=0,hn=ke[Ue];rn<hn.length;rn+=1){var Yi=hn[rn],Ji=Yi[0];Ji.minzoom&&this.zoom<Math.floor(Ji.minzoom)||Ji.maxzoom&&this.zoom>=Ji.maxzoom||Ji.visibility!=="none"&&(I(Yi,this.zoom,ut),(ne[Ji.id]=Ji.createBucket({index:lt.bucketLayerIDs.length,layers:Yi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ve,sourceID:this.source})).populate(De,Ie,this.tileID.canonical),lt.bucketLayerIDs.push(Yi.map(function(_t){return _t.id})))}}}var Hi=s.mapObject(Ie.glyphDependencies,function(_t){return Object.keys(_t).map(Number)});Object.keys(Hi).length?xt.send("getGlyphs",{uid:this.uid,stacks:Hi},function(_t,ti){pt||(pt=_t,d=ti,mi.call(mt))}):d={};var mr=Object.keys(Ie.iconDependencies);mr.length?xt.send("getImages",{icons:mr,source:this.source,tileID:this.tileID,type:"icons"},function(_t,ti){pt||(pt=_t,tt=ti,mi.call(mt))}):tt={};var Qi=Object.keys(Ie.patternDependencies);function mi(){if(pt)return Nt(pt);if(d&&tt&&Pe){var _t=new _(d),ti=new s.ImageAtlas(tt,Pe);for(var sn in ne){var Wr=ne[sn];Wr instanceof s.SymbolBucket?(I(Wr.layers,this.zoom,ut),s.performSymbolLayout(Wr,d,_t.positions,tt,ti.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Wr.hasPattern&&(Wr instanceof s.LineBucket||Wr instanceof s.FillBucket||Wr instanceof s.FillExtrusionBucket)&&(I(Wr.layers,this.zoom,ut),Wr.addFeatures(Ie,this.tileID.canonical,ti.patternPositions))}this.status="done",Nt(null,{buckets:s.values(ne).filter(function(ga){return!ga.isEmpty()}),featureIndex:lt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_t.image,imageAtlas:ti,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?tt:null,glyphPositions:this.returnDependencies?_t.positions:null})}}Qi.length?xt.send("getImages",{icons:Qi,source:this.source,tileID:this.tileID,type:"patterns"},function(_t,ti){pt||(pt=_t,Pe=ti,mi.call(mt))}):Pe={},mi.call(this)};var z=function(Q,it,ut,xt){this.actor=Q,this.layerIndex=it,this.availableImages=ut,this.loadVectorData=xt||k,this.loading={},this.loaded={}};z.prototype.loadTile=function(Q,it){var ut=this,xt=Q.uid;this.loading||(this.loading={});var Nt=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new s.RequestPerformance(Q.request),mt=this.loading[xt]=new C(Q);mt.abort=this.loadVectorData(Q,function(wt,lt){if(delete ut.loading[xt],wt||!lt)return mt.status="done",ut.loaded[xt]=mt,it(wt);var pt=lt.rawData,d={};lt.expires&&(d.expires=lt.expires),lt.cacheControl&&(d.cacheControl=lt.cacheControl);var tt={};if(Nt){var Pe=Nt.finish();Pe&&(tt.resourceTiming=JSON.parse(JSON.stringify(Pe)))}mt.vectorTile=lt.vectorTile,mt.parse(lt.vectorTile,ut.layerIndex,ut.availableImages,ut.actor,function(ne,Ie){if(ne||!Ie)return it(ne);it(null,s.extend({rawTileData:pt.slice(0)},Ie,d,tt))}),ut.loaded=ut.loaded||{},ut.loaded[xt]=mt})},z.prototype.reloadTile=function(Q,it){var ut=this,xt=this.loaded,Nt=Q.uid,mt=this;if(xt&&xt[Nt]){var wt=xt[Nt];wt.showCollisionBoxes=Q.showCollisionBoxes;var lt=function(pt,d){var tt=wt.reloadCallback;tt&&(delete wt.reloadCallback,wt.parse(wt.vectorTile,mt.layerIndex,ut.availableImages,mt.actor,tt)),it(pt,d)};wt.status==="parsing"?wt.reloadCallback=lt:wt.status==="done"&&(wt.vectorTile?wt.parse(wt.vectorTile,this.layerIndex,this.availableImages,this.actor,lt):lt())}},z.prototype.abortTile=function(Q,it){var ut=this.loading,xt=Q.uid;ut&&ut[xt]&&ut[xt].abort&&(ut[xt].abort(),delete ut[xt]),it()},z.prototype.removeTile=function(Q,it){var ut=this.loaded,xt=Q.uid;ut&&ut[xt]&&delete ut[xt],it()};var V=s.window.ImageBitmap,X=function(){this.loaded={}};function H(Q,it){if(Q.length!==0){$(Q[0],it);for(var ut=1;ut<Q.length;ut++)$(Q[ut],!it)}}function $(Q,it){for(var ut=0,xt=0,Nt=0,mt=Q.length,wt=mt-1;Nt<mt;wt=Nt++){var lt=(Q[Nt][0]-Q[wt][0])*(Q[wt][1]+Q[Nt][1]),pt=ut+lt;xt+=Math.abs(ut)>=Math.abs(lt)?ut-pt+lt:lt-pt+ut,ut=pt}ut+xt>=0!=!!it&&Q.reverse()}X.prototype.loadTile=function(Q,it){var ut=Q.uid,xt=Q.encoding,Nt=Q.rawImageData,mt=V&&Nt instanceof V?this.getImageData(Nt):Nt,wt=new s.DEMData(ut,mt,xt);this.loaded=this.loaded||{},this.loaded[ut]=wt,it(null,wt)},X.prototype.getImageData=function(Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);var it=this.offscreenCanvasContext.getImageData(-1,-1,Q.width+2,Q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:it.width,height:it.height},it.data)},X.prototype.removeTile=function(Q){var it=this.loaded,ut=Q.uid;it&&it[ut]&&delete it[ut]};var Y=s.vectorTile.VectorTileFeature.prototype.toGeoJSON,ct=function(Q){this._feature=Q,this.extent=s.EXTENT,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))};ct.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Q=[],it=0,ut=this._feature.geometry;it<ut.length;it+=1){var xt=ut[it];Q.push([new s.Point$1(xt[0],xt[1])])}return Q}for(var Nt=[],mt=0,wt=this._feature.geometry;mt<wt.length;mt+=1){for(var lt=[],pt=0,d=wt[mt];pt<d.length;pt+=1){var tt=d[pt];lt.push(new s.Point$1(tt[0],tt[1]))}Nt.push(lt)}return Nt},ct.prototype.toGeoJSON=function(Q,it,ut){return Y.call(this,Q,it,ut)};var rt=function(Q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=Q.length,this._features=Q};rt.prototype.feature=function(Q){return new ct(this._features[Q])};var nt=s.vectorTile.VectorTileFeature,Ot=Kt;function Kt(Q,it){this.options=it||{},this.features=Q,this.length=Q.length}function ft(Q,it){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=it||4096}Kt.prototype.feature=function(Q){return new ft(this.features[Q],this.options.extent)},ft.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var it=0;it<Q.length;it++){for(var ut=Q[it],xt=[],Nt=0;Nt<ut.length;Nt++)xt.push(new s.Point$1(ut[Nt][0],ut[Nt][1]));this.geometry.push(xt)}return this.geometry},ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,it=1/0,ut=-1/0,xt=1/0,Nt=-1/0,mt=0;mt<Q.length;mt++)for(var wt=Q[mt],lt=0;lt<wt.length;lt++){var pt=wt[lt];it=Math.min(it,pt.x),ut=Math.max(ut,pt.x),xt=Math.min(xt,pt.y),Nt=Math.max(Nt,pt.y)}return[it,xt,ut,Nt]},ft.prototype.toGeoJSON=nt.prototype.toGeoJSON;var st=K,Ut=Ot;function K(Q){var it=new s.pbf;return(function(ut,xt){for(var Nt in ut.layers)xt.writeMessage(3,dt,ut.layers[Nt])})(Q,it),it.finish()}function dt(Q,it){var ut;it.writeVarintField(15,Q.version||1),it.writeStringField(1,Q.name||""),it.writeVarintField(5,Q.extent||4096);var xt={keys:[],values:[],keycache:{},valuecache:{}};for(ut=0;ut<Q.length;ut++)xt.feature=Q.feature(ut),it.writeMessage(2,Tt,xt);var Nt=xt.keys;for(ut=0;ut<Nt.length;ut++)it.writeStringField(3,Nt[ut]);var mt=xt.values;for(ut=0;ut<mt.length;ut++)it.writeMessage(4,se,mt[ut])}function Tt(Q,it){var ut=Q.feature;ut.id!==void 0&&it.writeVarintField(1,ut.id),it.writeMessage(2,ue,Q),it.writeVarintField(3,ut.type),it.writeMessage(4,Gt,ut)}function ue(Q,it){var ut=Q.feature,xt=Q.keys,Nt=Q.values,mt=Q.keycache,wt=Q.valuecache;for(var lt in ut.properties){var pt=mt[lt];pt===void 0&&(xt.push(lt),mt[lt]=pt=xt.length-1),it.writeVarint(pt);var d=ut.properties[lt],tt=typeof d;tt!=="string"&&tt!=="boolean"&&tt!=="number"&&(d=JSON.stringify(d));var Pe=tt+":"+d,ne=wt[Pe];ne===void 0&&(Nt.push(d),wt[Pe]=ne=Nt.length-1),it.writeVarint(ne)}}function Rt(Q,it){return(it<<3)+(7&Q)}function Ft(Q){return Q<<1^Q>>31}function Gt(Q,it){for(var ut=Q.loadGeometry(),xt=Q.type,Nt=0,mt=0,wt=ut.length,lt=0;lt<wt;lt++){var pt=ut[lt],d=1;xt===1&&(d=pt.length),it.writeVarint(Rt(1,d));for(var tt=xt===3?pt.length-1:pt.length,Pe=0;Pe<tt;Pe++){Pe===1&&xt!==1&&it.writeVarint(Rt(2,tt-1));var ne=pt[Pe].x-Nt,Ie=pt[Pe].y-mt;it.writeVarint(Ft(ne)),it.writeVarint(Ft(Ie)),Nt+=ne,mt+=Ie}xt===3&&it.writeVarint(Rt(7,1))}}function se(Q,it){var ut=typeof Q;ut==="string"?it.writeStringField(1,Q):ut==="boolean"?it.writeBooleanField(7,Q):ut==="number"&&(Q%1!=0?it.writeDoubleField(3,Q):Q<0?it.writeSVarintField(6,Q):it.writeVarintField(5,Q))}function le(Q,it,ut,xt){de(Q,ut,xt),de(it,2*ut,2*xt),de(it,2*ut+1,2*xt+1)}function de(Q,it,ut){var xt=Q[it];Q[it]=Q[ut],Q[ut]=xt}function ye(Q,it,ut,xt){var Nt=Q-ut,mt=it-xt;return Nt*Nt+mt*mt}st.fromVectorTileJs=K,st.fromGeojsonVt=function(Q,it){it=it||{};var ut={};for(var xt in Q)ut[xt]=new Ot(Q[xt].features,it),ut[xt].name=xt,ut[xt].version=it.version,ut[xt].extent=it.extent;return K({layers:ut})},st.GeoJSONWrapper=Ut;var Oe=function(Q){return Q[0]},Le=function(Q){return Q[1]},fe=function(Q,it,ut,xt,Nt){it===void 0&&(it=Oe),ut===void 0&&(ut=Le),xt===void 0&&(xt=64),Nt===void 0&&(Nt=Float64Array),this.nodeSize=xt,this.points=Q;for(var mt=Q.length<65536?Uint16Array:Uint32Array,wt=this.ids=new mt(Q.length),lt=this.coords=new Nt(2*Q.length),pt=0;pt<Q.length;pt++)wt[pt]=pt,lt[2*pt]=it(Q[pt]),lt[2*pt+1]=ut(Q[pt]);(function d(tt,Pe,ne,Ie,ke,Ue){if(!(ke-Ie<=ne)){var ge=Ie+ke>>1;(function Ve(De,Ze,Gi,si,rn,hn){for(;rn>si;){if(rn-si>600){var Yi=rn-si+1,Ji=Gi-si+1,Hi=Math.log(Yi),mr=.5*Math.exp(2*Hi/3),Qi=.5*Math.sqrt(Hi*mr*(Yi-mr)/Yi)*(Ji-Yi/2<0?-1:1);Ve(De,Ze,Gi,Math.max(si,Math.floor(Gi-Ji*mr/Yi+Qi)),Math.min(rn,Math.floor(Gi+(Yi-Ji)*mr/Yi+Qi)),hn)}var mi=Ze[2*Gi+hn],_t=si,ti=rn;for(le(De,Ze,si,Gi),Ze[2*rn+hn]>mi&&le(De,Ze,si,rn);_t<ti;){for(le(De,Ze,_t,ti),_t++,ti--;Ze[2*_t+hn]<mi;)_t++;for(;Ze[2*ti+hn]>mi;)ti--}Ze[2*si+hn]===mi?le(De,Ze,si,ti):le(De,Ze,++ti,rn),ti<=Gi&&(si=ti+1),Gi<=ti&&(rn=ti-1)}})(tt,Pe,ge,Ie,ke,Ue%2),d(tt,Pe,ne,Ie,ge-1,Ue+1),d(tt,Pe,ne,ge+1,ke,Ue+1)}})(wt,lt,xt,0,wt.length-1,0)};fe.prototype.range=function(Q,it,ut,xt){return(function(Nt,mt,wt,lt,pt,d,tt){for(var Pe,ne,Ie=[0,Nt.length-1,0],ke=[];Ie.length;){var Ue=Ie.pop(),ge=Ie.pop(),Ve=Ie.pop();if(ge-Ve<=tt)for(var De=Ve;De<=ge;De++)ne=mt[2*De+1],(Pe=mt[2*De])>=wt&&Pe<=pt&&ne>=lt&&ne<=d&&ke.push(Nt[De]);else{var Ze=Math.floor((Ve+ge)/2);ne=mt[2*Ze+1],(Pe=mt[2*Ze])>=wt&&Pe<=pt&&ne>=lt&&ne<=d&&ke.push(Nt[Ze]);var Gi=(Ue+1)%2;(Ue===0?wt<=Pe:lt<=ne)&&(Ie.push(Ve),Ie.push(Ze-1),Ie.push(Gi)),(Ue===0?pt>=Pe:d>=ne)&&(Ie.push(Ze+1),Ie.push(ge),Ie.push(Gi))}}return ke})(this.ids,this.coords,Q,it,ut,xt,this.nodeSize)},fe.prototype.within=function(Q,it,ut){return(function(xt,Nt,mt,wt,lt,pt){for(var d=[0,xt.length-1,0],tt=[],Pe=lt*lt;d.length;){var ne=d.pop(),Ie=d.pop(),ke=d.pop();if(Ie-ke<=pt)for(var Ue=ke;Ue<=Ie;Ue++)ye(Nt[2*Ue],Nt[2*Ue+1],mt,wt)<=Pe&&tt.push(xt[Ue]);else{var ge=Math.floor((ke+Ie)/2),Ve=Nt[2*ge],De=Nt[2*ge+1];ye(Ve,De,mt,wt)<=Pe&&tt.push(xt[ge]);var Ze=(ne+1)%2;(ne===0?mt-lt<=Ve:wt-lt<=De)&&(d.push(ke),d.push(ge-1),d.push(Ze)),(ne===0?mt+lt>=Ve:wt+lt>=De)&&(d.push(ge+1),d.push(Ie),d.push(Ze))}}return tt})(this.ids,this.coords,Q,it,ut,this.nodeSize)};var _i={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Q){return Q}},ei=function(Q){this.options=Xn(Object.create(_i),Q),this.trees=new Array(this.options.maxZoom+1)};function ii(Q,it,ut,xt,Nt){return{x:Q,y:it,zoom:1/0,id:ut,parentId:-1,numPoints:xt,properties:Nt}}function Qe(Q,it){var ut=Q.geometry.coordinates,xt=ut[1];return{x:Ni(ut[0]),y:Pi(xt),zoom:1/0,index:it,parentId:-1}}function yi(Q){return{type:"Feature",id:Q.id,properties:cn(Q),geometry:{type:"Point",coordinates:[(xt=Q.x,360*(xt-.5)),(it=Q.y,ut=(180-360*it)*Math.PI/180,360*Math.atan(Math.exp(ut))/Math.PI-90)]}};var it,ut,xt}function cn(Q){var it=Q.numPoints,ut=it>=1e4?Math.round(it/1e3)+"k":it>=1e3?Math.round(it/100)/10+"k":it;return Xn(Xn({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:it,point_count_abbreviated:ut})}function Ni(Q){return Q/360+.5}function Pi(Q){var it=Math.sin(Q*Math.PI/180),ut=.5-.25*Math.log((1+it)/(1-it))/Math.PI;return ut<0?0:ut>1?1:ut}function Xn(Q,it){for(var ut in it)Q[ut]=it[ut];return Q}function xi(Q){return Q.x}function wi(Q){return Q.y}function mn(Q,it,ut,xt,Nt,mt){var wt=Nt-ut,lt=mt-xt;if(wt!==0||lt!==0){var pt=((Q-ut)*wt+(it-xt)*lt)/(wt*wt+lt*lt);pt>1?(ut=Nt,xt=mt):pt>0&&(ut+=wt*pt,xt+=lt*pt)}return(wt=Q-ut)*wt+(lt=it-xt)*lt}function zi(Q,it,ut,xt){var Nt={id:Q===void 0?null:Q,type:it,geometry:ut,tags:xt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(mt){var wt=mt.geometry,lt=mt.type;if(lt==="Point"||lt==="MultiPoint"||lt==="LineString")cr(mt,wt);else if(lt==="Polygon"||lt==="MultiLineString")for(var pt=0;pt<wt.length;pt++)cr(mt,wt[pt]);else if(lt==="MultiPolygon")for(pt=0;pt<wt.length;pt++)for(var d=0;d<wt[pt].length;d++)cr(mt,wt[pt][d])})(Nt),Nt}function cr(Q,it){for(var ut=0;ut<it.length;ut+=3)Q.minX=Math.min(Q.minX,it[ut]),Q.minY=Math.min(Q.minY,it[ut+1]),Q.maxX=Math.max(Q.maxX,it[ut]),Q.maxY=Math.max(Q.maxY,it[ut+1])}function tr(Q,it,ut,xt){if(it.geometry){var Nt=it.geometry.coordinates,mt=it.geometry.type,wt=Math.pow(ut.tolerance/((1<<ut.maxZoom)*ut.extent),2),lt=[],pt=it.id;if(ut.promoteId?pt=it.properties[ut.promoteId]:ut.generateId&&(pt=xt||0),mt==="Point")xn(Nt,lt);else if(mt==="MultiPoint")for(var d=0;d<Nt.length;d++)xn(Nt[d],lt);else if(mt==="LineString")sr(Nt,lt,wt,!1);else if(mt==="MultiLineString"){if(ut.lineMetrics){for(d=0;d<Nt.length;d++)sr(Nt[d],lt=[],wt,!1),Q.push(zi(pt,"LineString",lt,it.properties));return}qn(Nt,lt,wt,!1)}else if(mt==="Polygon")qn(Nt,lt,wt,!0);else{if(mt!=="MultiPolygon"){if(mt==="GeometryCollection"){for(d=0;d<it.geometry.geometries.length;d++)tr(Q,{id:pt,geometry:it.geometry.geometries[d],properties:it.properties},ut,xt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(d=0;d<Nt.length;d++){var tt=[];qn(Nt[d],tt,wt,!0),lt.push(tt)}}Q.push(zi(pt,mt,lt,it.properties))}}function xn(Q,it){it.push(Bn(Q[0])),it.push(er(Q[1])),it.push(0)}function sr(Q,it,ut,xt){for(var Nt,mt,wt=0,lt=0;lt<Q.length;lt++){var pt=Bn(Q[lt][0]),d=er(Q[lt][1]);it.push(pt),it.push(d),it.push(0),lt>0&&(wt+=xt?(Nt*d-pt*mt)/2:Math.sqrt(Math.pow(pt-Nt,2)+Math.pow(d-mt,2))),Nt=pt,mt=d}var tt=it.length-3;it[2]=1,(function Pe(ne,Ie,ke,Ue){for(var ge,Ve=Ue,De=ke-Ie>>1,Ze=ke-Ie,Gi=ne[Ie],si=ne[Ie+1],rn=ne[ke],hn=ne[ke+1],Yi=Ie+3;Yi<ke;Yi+=3){var Ji=mn(ne[Yi],ne[Yi+1],Gi,si,rn,hn);if(Ji>Ve)ge=Yi,Ve=Ji;else if(Ji===Ve){var Hi=Math.abs(Yi-De);Hi<Ze&&(ge=Yi,Ze=Hi)}}Ve>Ue&&(ge-Ie>3&&Pe(ne,Ie,ge,Ue),ne[ge+2]=Ve,ke-ge>3&&Pe(ne,ge,ke,Ue))})(it,0,tt,ut),it[tt+2]=1,it.size=Math.abs(wt),it.start=0,it.end=it.size}function qn(Q,it,ut,xt){for(var Nt=0;Nt<Q.length;Nt++){var mt=[];sr(Q[Nt],mt,ut,xt),it.push(mt)}}function Bn(Q){return Q/360+.5}function er(Q){var it=Math.sin(Q*Math.PI/180),ut=.5-.25*Math.log((1+it)/(1-it))/Math.PI;return ut<0?0:ut>1?1:ut}function Ke(Q,it,ut,xt,Nt,mt,wt,lt){if(xt/=it,mt>=(ut/=it)&&wt<xt)return Q;if(wt<ut||mt>=xt)return null;for(var pt=[],d=0;d<Q.length;d++){var tt=Q[d],Pe=tt.geometry,ne=tt.type,Ie=Nt===0?tt.minX:tt.minY,ke=Nt===0?tt.maxX:tt.maxY;if(Ie>=ut&&ke<xt)pt.push(tt);else if(!(ke<ut||Ie>=xt)){var Ue=[];if(ne==="Point"||ne==="MultiPoint")bi(Pe,Ue,ut,xt,Nt);else if(ne==="LineString")Oi(Pe,Ue,ut,xt,Nt,!1,lt.lineMetrics);else if(ne==="MultiLineString")Ar(Pe,Ue,ut,xt,Nt,!1);else if(ne==="Polygon")Ar(Pe,Ue,ut,xt,Nt,!0);else if(ne==="MultiPolygon")for(var ge=0;ge<Pe.length;ge++){var Ve=[];Ar(Pe[ge],Ve,ut,xt,Nt,!0),Ve.length&&Ue.push(Ve)}if(Ue.length){if(lt.lineMetrics&&ne==="LineString"){for(ge=0;ge<Ue.length;ge++)pt.push(zi(tt.id,ne,Ue[ge],tt.tags));continue}ne!=="LineString"&&ne!=="MultiLineString"||(Ue.length===1?(ne="LineString",Ue=Ue[0]):ne="MultiLineString"),ne!=="Point"&&ne!=="MultiPoint"||(ne=Ue.length===3?"Point":"MultiPoint"),pt.push(zi(tt.id,ne,Ue,tt.tags))}}}return pt.length?pt:null}function bi(Q,it,ut,xt,Nt){for(var mt=0;mt<Q.length;mt+=3){var wt=Q[mt+Nt];wt>=ut&&wt<=xt&&(it.push(Q[mt]),it.push(Q[mt+1]),it.push(Q[mt+2]))}}function Oi(Q,it,ut,xt,Nt,mt,wt){for(var lt,pt,d=on(Q),tt=Nt===0?je:$e,Pe=Q.start,ne=0;ne<Q.length-3;ne+=3){var Ie=Q[ne],ke=Q[ne+1],Ue=Q[ne+2],ge=Q[ne+3],Ve=Q[ne+4],De=Nt===0?Ie:ke,Ze=Nt===0?ge:Ve,Gi=!1;wt&&(lt=Math.sqrt(Math.pow(Ie-ge,2)+Math.pow(ke-Ve,2))),De<ut?Ze>ut&&(pt=tt(d,Ie,ke,ge,Ve,ut),wt&&(d.start=Pe+lt*pt)):De>xt?Ze<xt&&(pt=tt(d,Ie,ke,ge,Ve,xt),wt&&(d.start=Pe+lt*pt)):Lt(d,Ie,ke,Ue),Ze<ut&&De>=ut&&(pt=tt(d,Ie,ke,ge,Ve,ut),Gi=!0),Ze>xt&&De<=xt&&(pt=tt(d,Ie,ke,ge,Ve,xt),Gi=!0),!mt&&Gi&&(wt&&(d.end=Pe+lt*pt),it.push(d),d=on(Q)),wt&&(Pe+=lt)}var si=Q.length-3;Ie=Q[si],ke=Q[si+1],Ue=Q[si+2],(De=Nt===0?Ie:ke)>=ut&&De<=xt&&Lt(d,Ie,ke,Ue),si=d.length-3,mt&&si>=3&&(d[si]!==d[0]||d[si+1]!==d[1])&&Lt(d,d[0],d[1],d[2]),d.length&&it.push(d)}function on(Q){var it=[];return it.size=Q.size,it.start=Q.start,it.end=Q.end,it}function Ar(Q,it,ut,xt,Nt,mt){for(var wt=0;wt<Q.length;wt++)Oi(Q[wt],it,ut,xt,Nt,mt,!1)}function Lt(Q,it,ut,xt){Q.push(it),Q.push(ut),Q.push(xt)}function je(Q,it,ut,xt,Nt,mt){var wt=(mt-it)/(xt-it);return Q.push(mt),Q.push(ut+(Nt-ut)*wt),Q.push(1),wt}function $e(Q,it,ut,xt,Nt,mt){var wt=(mt-ut)/(Nt-ut);return Q.push(it+(xt-it)*wt),Q.push(mt),Q.push(1),wt}function di(Q,it){for(var ut=[],xt=0;xt<Q.length;xt++){var Nt,mt=Q[xt],wt=mt.type;if(wt==="Point"||wt==="MultiPoint"||wt==="LineString")Nt=oe(mt.geometry,it);else if(wt==="MultiLineString"||wt==="Polygon"){Nt=[];for(var lt=0;lt<mt.geometry.length;lt++)Nt.push(oe(mt.geometry[lt],it))}else if(wt==="MultiPolygon")for(Nt=[],lt=0;lt<mt.geometry.length;lt++){for(var pt=[],d=0;d<mt.geometry[lt].length;d++)pt.push(oe(mt.geometry[lt][d],it));Nt.push(pt)}ut.push(zi(mt.id,wt,Nt,mt.tags))}return ut}function oe(Q,it){var ut=[];ut.size=Q.size,Q.start!==void 0&&(ut.start=Q.start,ut.end=Q.end);for(var xt=0;xt<Q.length;xt+=3)ut.push(Q[xt]+it,Q[xt+1],Q[xt+2]);return ut}function Fe(Q,it){if(Q.transformed)return Q;var ut,xt,Nt,mt=1<<Q.z,wt=Q.x,lt=Q.y;for(ut=0;ut<Q.features.length;ut++){var pt=Q.features[ut],d=pt.geometry,tt=pt.type;if(pt.geometry=[],tt===1)for(xt=0;xt<d.length;xt+=2)pt.geometry.push(vt(d[xt],d[xt+1],it,mt,wt,lt));else for(xt=0;xt<d.length;xt++){var Pe=[];for(Nt=0;Nt<d[xt].length;Nt+=2)Pe.push(vt(d[xt][Nt],d[xt][Nt+1],it,mt,wt,lt));pt.geometry.push(Pe)}}return Q.transformed=!0,Q}function vt(Q,it,ut,xt,Nt,mt){return[Math.round(ut*(Q*xt-Nt)),Math.round(ut*(it*xt-mt))]}function qe(Q,it,ut,xt,Nt){for(var mt=it===Nt.maxZoom?0:Nt.tolerance/((1<<it)*Nt.extent),wt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ut,y:xt,z:it,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},lt=0;lt<Q.length;lt++){wt.numFeatures++,Ce(wt,Q[lt],mt,Nt);var pt=Q[lt].minX,d=Q[lt].minY,tt=Q[lt].maxX,Pe=Q[lt].maxY;pt<wt.minX&&(wt.minX=pt),d<wt.minY&&(wt.minY=d),tt>wt.maxX&&(wt.maxX=tt),Pe>wt.maxY&&(wt.maxY=Pe)}return wt}function Ce(Q,it,ut,xt){var Nt=it.geometry,mt=it.type,wt=[];if(mt==="Point"||mt==="MultiPoint")for(var lt=0;lt<Nt.length;lt+=3)wt.push(Nt[lt]),wt.push(Nt[lt+1]),Q.numPoints++,Q.numSimplified++;else if(mt==="LineString")q(wt,Nt,Q,ut,!1,!1);else if(mt==="MultiLineString"||mt==="Polygon")for(lt=0;lt<Nt.length;lt++)q(wt,Nt[lt],Q,ut,mt==="Polygon",lt===0);else if(mt==="MultiPolygon")for(var pt=0;pt<Nt.length;pt++){var d=Nt[pt];for(lt=0;lt<d.length;lt++)q(wt,d[lt],Q,ut,!0,lt===0)}if(wt.length){var tt=it.tags||null;if(mt==="LineString"&&xt.lineMetrics){for(var Pe in tt={},it.tags)tt[Pe]=it.tags[Pe];tt.mapbox_clip_start=Nt.start/Nt.size,tt.mapbox_clip_end=Nt.end/Nt.size}var ne={geometry:wt,type:mt==="Polygon"||mt==="MultiPolygon"?3:mt==="LineString"||mt==="MultiLineString"?2:1,tags:tt};it.id!==null&&(ne.id=it.id),Q.features.push(ne)}}function q(Q,it,ut,xt,Nt,mt){var wt=xt*xt;if(xt>0&&it.size<(Nt?wt:xt))ut.numPoints+=it.length/3;else{for(var lt=[],pt=0;pt<it.length;pt+=3)(xt===0||it[pt+2]>wt)&&(ut.numSimplified++,lt.push(it[pt]),lt.push(it[pt+1])),ut.numPoints++;Nt&&(function(d,tt){for(var Pe=0,ne=0,Ie=d.length,ke=Ie-2;ne<Ie;ke=ne,ne+=2)Pe+=(d[ne]-d[ke])*(d[ne+1]+d[ke+1]);if(Pe>0===tt)for(ne=0,Ie=d.length;ne<Ie/2;ne+=2){var Ue=d[ne],ge=d[ne+1];d[ne]=d[Ie-2-ne],d[ne+1]=d[Ie-1-ne],d[Ie-2-ne]=Ue,d[Ie-1-ne]=ge}})(lt,mt),Q.push(lt)}}function Ee(Q,it){var ut=(it=this.options=(function(Nt,mt){for(var wt in mt)Nt[wt]=mt[wt];return Nt})(Object.create(this.options),it)).debug;if(ut&&console.time("preprocess data"),it.maxZoom<0||it.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(it.promoteId&&it.generateId)throw new Error("promoteId and generateId cannot be used together.");var xt=(function(Nt,mt){var wt=[];if(Nt.type==="FeatureCollection")for(var lt=0;lt<Nt.features.length;lt++)tr(wt,Nt.features[lt],mt,lt);else tr(wt,Nt.type==="Feature"?Nt:{geometry:Nt},mt);return wt})(Q,it);this.tiles={},this.tileCoords=[],ut&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",it.indexMaxZoom,it.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(xt=(function(Nt,mt){var wt=mt.buffer/mt.extent,lt=Nt,pt=Ke(Nt,1,-1-wt,wt,0,-1,2,mt),d=Ke(Nt,1,1-wt,2+wt,0,-1,2,mt);return(pt||d)&&(lt=Ke(Nt,1,-wt,1+wt,0,-1,2,mt)||[],pt&&(lt=di(pt,1).concat(lt)),d&&(lt=lt.concat(di(d,-1)))),lt})(xt,it)).length&&this.splitTile(xt,0,0,0),ut&&(xt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Me(Q,it,ut){return 32*((1<<Q)*ut+it)+Q}function St(Q,it){var ut=Q.tileID.canonical;if(!this._geoJSONIndex)return it(null,null);var xt=this._geoJSONIndex.getTile(ut.z,ut.x,ut.y);if(!xt)return it(null,null);var Nt=new rt(xt.features),mt=st(Nt);mt.byteOffset===0&&mt.byteLength===mt.buffer.byteLength||(mt=new Uint8Array(mt)),it(null,{vectorTile:Nt,rawData:mt.buffer})}ei.prototype.load=function(Q){var it=this.options,ut=it.log,xt=it.minZoom,Nt=it.maxZoom,mt=it.nodeSize;ut&&console.time("total time");var wt="prepare "+Q.length+" points";ut&&console.time(wt),this.points=Q;for(var lt=[],pt=0;pt<Q.length;pt++)Q[pt].geometry&&lt.push(Qe(Q[pt],pt));this.trees[Nt+1]=new fe(lt,xi,wi,mt,Float32Array),ut&&console.timeEnd(wt);for(var d=Nt;d>=xt;d--){var tt=+Date.now();lt=this._cluster(lt,d),this.trees[d]=new fe(lt,xi,wi,mt,Float32Array),ut&&console.log("z%d: %d clusters in %dms",d,lt.length,+Date.now()-tt)}return ut&&console.timeEnd("total time"),this},ei.prototype.getClusters=function(Q,it){var ut=((Q[0]+180)%360+360)%360-180,xt=Math.max(-90,Math.min(90,Q[1])),Nt=Q[2]===180?180:((Q[2]+180)%360+360)%360-180,mt=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)ut=-180,Nt=180;else if(ut>Nt){var wt=this.getClusters([ut,xt,180,mt],it),lt=this.getClusters([-180,xt,Nt,mt],it);return wt.concat(lt)}for(var pt=this.trees[this._limitZoom(it)],d=[],tt=0,Pe=pt.range(Ni(ut),Pi(mt),Ni(Nt),Pi(xt));tt<Pe.length;tt+=1){var ne=pt.points[Pe[tt]];d.push(ne.numPoints?yi(ne):this.points[ne.index])}return d},ei.prototype.getChildren=function(Q){var it=this._getOriginId(Q),ut=this._getOriginZoom(Q),xt="No cluster with the specified id.",Nt=this.trees[ut];if(!Nt)throw new Error(xt);var mt=Nt.points[it];if(!mt)throw new Error(xt);for(var wt=this.options.radius/(this.options.extent*Math.pow(2,ut-1)),lt=[],pt=0,d=Nt.within(mt.x,mt.y,wt);pt<d.length;pt+=1){var tt=Nt.points[d[pt]];tt.parentId===Q&&lt.push(tt.numPoints?yi(tt):this.points[tt.index])}if(lt.length===0)throw new Error(xt);return lt},ei.prototype.getLeaves=function(Q,it,ut){var xt=[];return this._appendLeaves(xt,Q,it=it||10,ut=ut||0,0),xt},ei.prototype.getTile=function(Q,it,ut){var xt=this.trees[this._limitZoom(Q)],Nt=Math.pow(2,Q),mt=this.options,wt=mt.radius/mt.extent,lt=(ut-wt)/Nt,pt=(ut+1+wt)/Nt,d={features:[]};return this._addTileFeatures(xt.range((it-wt)/Nt,lt,(it+1+wt)/Nt,pt),xt.points,it,ut,Nt,d),it===0&&this._addTileFeatures(xt.range(1-wt/Nt,lt,1,pt),xt.points,Nt,ut,Nt,d),it===Nt-1&&this._addTileFeatures(xt.range(0,lt,wt/Nt,pt),xt.points,-1,ut,Nt,d),d.features.length?d:null},ei.prototype.getClusterExpansionZoom=function(Q){for(var it=this._getOriginZoom(Q)-1;it<=this.options.maxZoom;){var ut=this.getChildren(Q);if(it++,ut.length!==1)break;Q=ut[0].properties.cluster_id}return it},ei.prototype._appendLeaves=function(Q,it,ut,xt,Nt){for(var mt=0,wt=this.getChildren(it);mt<wt.length;mt+=1){var lt=wt[mt],pt=lt.properties;if(pt&&pt.cluster?Nt+pt.point_count<=xt?Nt+=pt.point_count:Nt=this._appendLeaves(Q,pt.cluster_id,ut,xt,Nt):Nt<xt?Nt++:Q.push(lt),Q.length===ut)break}return Nt},ei.prototype._addTileFeatures=function(Q,it,ut,xt,Nt,mt){for(var wt=0,lt=Q;wt<lt.length;wt+=1){var pt=it[lt[wt]],d=pt.numPoints,tt={type:1,geometry:[[Math.round(this.options.extent*(pt.x*Nt-ut)),Math.round(this.options.extent*(pt.y*Nt-xt))]],tags:d?cn(pt):this.points[pt.index].properties},Pe=void 0;d?Pe=pt.id:this.options.generateId?Pe=pt.index:this.points[pt.index].id&&(Pe=this.points[pt.index].id),Pe!==void 0&&(tt.id=Pe),mt.features.push(tt)}},ei.prototype._limitZoom=function(Q){return Math.max(this.options.minZoom,Math.min(+Q,this.options.maxZoom+1))},ei.prototype._cluster=function(Q,it){for(var ut=[],xt=this.options,Nt=xt.reduce,mt=xt.minPoints,wt=xt.radius/(xt.extent*Math.pow(2,it)),lt=0;lt<Q.length;lt++){var pt=Q[lt];if(!(pt.zoom<=it)){pt.zoom=it;for(var d=this.trees[it+1],tt=d.within(pt.x,pt.y,wt),Pe=pt.numPoints||1,ne=Pe,Ie=0,ke=tt;Ie<ke.length;Ie+=1){var Ue=d.points[ke[Ie]];Ue.zoom>it&&(ne+=Ue.numPoints||1)}if(ne>=mt){for(var ge=pt.x*Pe,Ve=pt.y*Pe,De=Nt&&Pe>1?this._map(pt,!0):null,Ze=(lt<<5)+(it+1)+this.points.length,Gi=0,si=tt;Gi<si.length;Gi+=1){var rn=d.points[si[Gi]];if(!(rn.zoom<=it)){rn.zoom=it;var hn=rn.numPoints||1;ge+=rn.x*hn,Ve+=rn.y*hn,rn.parentId=Ze,Nt&&(De||(De=this._map(pt,!0)),Nt(De,this._map(rn)))}}pt.parentId=Ze,ut.push(ii(ge/ne,Ve/ne,Ze,ne,De))}else if(ut.push(pt),ne>1)for(var Yi=0,Ji=tt;Yi<Ji.length;Yi+=1){var Hi=d.points[Ji[Yi]];Hi.zoom<=it||(Hi.zoom=it,ut.push(Hi))}}}return ut},ei.prototype._getOriginId=function(Q){return Q-this.points.length>>5},ei.prototype._getOriginZoom=function(Q){return(Q-this.points.length)%32},ei.prototype._map=function(Q,it){if(Q.numPoints)return it?Xn({},Q.properties):Q.properties;var ut=this.points[Q.index].properties,xt=this.options.map(ut);return it&&xt===ut?Xn({},xt):xt},Ee.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ee.prototype.splitTile=function(Q,it,ut,xt,Nt,mt,wt){for(var lt=[Q,it,ut,xt],pt=this.options,d=pt.debug;lt.length;){xt=lt.pop(),ut=lt.pop(),it=lt.pop(),Q=lt.pop();var tt=1<<it,Pe=Me(it,ut,xt),ne=this.tiles[Pe];if(!ne&&(d>1&&console.time("creation"),ne=this.tiles[Pe]=qe(Q,it,ut,xt,pt),this.tileCoords.push({z:it,x:ut,y:xt}),d)){d>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",it,ut,xt,ne.numFeatures,ne.numPoints,ne.numSimplified),console.timeEnd("creation"));var Ie="z"+it;this.stats[Ie]=(this.stats[Ie]||0)+1,this.total++}if(ne.source=Q,Nt){if(it===pt.maxZoom||it===Nt)continue;var ke=1<<Nt-it;if(ut!==Math.floor(mt/ke)||xt!==Math.floor(wt/ke))continue}else if(it===pt.indexMaxZoom||ne.numPoints<=pt.indexMaxPoints)continue;if(ne.source=null,Q.length!==0){d>1&&console.time("clipping");var Ue,ge,Ve,De,Ze,Gi,si=.5*pt.buffer/pt.extent,rn=.5-si,hn=.5+si,Yi=1+si;Ue=ge=Ve=De=null,Ze=Ke(Q,tt,ut-si,ut+hn,0,ne.minX,ne.maxX,pt),Gi=Ke(Q,tt,ut+rn,ut+Yi,0,ne.minX,ne.maxX,pt),Q=null,Ze&&(Ue=Ke(Ze,tt,xt-si,xt+hn,1,ne.minY,ne.maxY,pt),ge=Ke(Ze,tt,xt+rn,xt+Yi,1,ne.minY,ne.maxY,pt),Ze=null),Gi&&(Ve=Ke(Gi,tt,xt-si,xt+hn,1,ne.minY,ne.maxY,pt),De=Ke(Gi,tt,xt+rn,xt+Yi,1,ne.minY,ne.maxY,pt),Gi=null),d>1&&console.timeEnd("clipping"),lt.push(Ue||[],it+1,2*ut,2*xt),lt.push(ge||[],it+1,2*ut,2*xt+1),lt.push(Ve||[],it+1,2*ut+1,2*xt),lt.push(De||[],it+1,2*ut+1,2*xt+1)}}},Ee.prototype.getTile=function(Q,it,ut){var xt=this.options,Nt=xt.extent,mt=xt.debug;if(Q<0||Q>24)return null;var wt=1<<Q,lt=Me(Q,it=(it%wt+wt)%wt,ut);if(this.tiles[lt])return Fe(this.tiles[lt],Nt);mt>1&&console.log("drilling down to z%d-%d-%d",Q,it,ut);for(var pt,d=Q,tt=it,Pe=ut;!pt&&d>0;)d--,tt=Math.floor(tt/2),Pe=Math.floor(Pe/2),pt=this.tiles[Me(d,tt,Pe)];return pt&&pt.source?(mt>1&&console.log("found parent tile z%d-%d-%d",d,tt,Pe),mt>1&&console.time("drilling down"),this.splitTile(pt.source,d,tt,Pe,Q,it,ut),mt>1&&console.timeEnd("drilling down"),this.tiles[lt]?Fe(this.tiles[lt],Nt):null):null};var ee=(function(Q){function it(ut,xt,Nt,mt){Q.call(this,ut,xt,Nt,St),mt&&(this.loadGeoJSON=mt)}return Q&&(it.__proto__=Q),(it.prototype=Object.create(Q&&Q.prototype)).constructor=it,it.prototype.loadData=function(ut,xt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=xt,this._pendingLoadDataParams=ut,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},it.prototype._loadData=function(){var ut=this;if(this._pendingCallback&&this._pendingLoadDataParams){var xt=this._pendingCallback,Nt=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var mt=!!(Nt&&Nt.request&&Nt.request.collectResourceTiming)&&new s.RequestPerformance(Nt.request);this.loadGeoJSON(Nt,function(wt,lt){if(wt||!lt)return xt(wt);if(typeof lt!="object")return xt(new Error("Input data given to '"+Nt.source+"' is not a valid GeoJSON object."));(function ne(Ie,ke){var Ue,ge=Ie&&Ie.type;if(ge==="FeatureCollection")for(Ue=0;Ue<Ie.features.length;Ue++)ne(Ie.features[Ue],ke);else if(ge==="GeometryCollection")for(Ue=0;Ue<Ie.geometries.length;Ue++)ne(Ie.geometries[Ue],ke);else if(ge==="Feature")ne(Ie.geometry,ke);else if(ge==="Polygon")H(Ie.coordinates,ke);else if(ge==="MultiPolygon")for(Ue=0;Ue<Ie.coordinates.length;Ue++)H(Ie.coordinates[Ue],ke);return Ie})(lt,!0);try{if(Nt.filter){var pt=s.createExpression(Nt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pt.result==="error")throw new Error(pt.value.map(function(ne){return ne.key+": "+ne.message}).join(", "));var d=lt.features.filter(function(ne){return pt.value.evaluate({zoom:0},ne)});lt={type:"FeatureCollection",features:d}}ut._geoJSONIndex=Nt.cluster?new ei((function(ne){var Ie=ne.superclusterOptions,ke=ne.clusterProperties;if(!ke||!Ie)return Ie;for(var Ue={},ge={},Ve={accumulated:null,zoom:0},De={properties:null},Ze=Object.keys(ke),Gi=0,si=Ze;Gi<si.length;Gi+=1){var rn=si[Gi],hn=ke[rn],Yi=hn[0],Ji=s.createExpression(hn[1]),Hi=s.createExpression(typeof Yi=="string"?[Yi,["accumulated"],["get",rn]]:Yi);Ue[rn]=Ji.value,ge[rn]=Hi.value}return Ie.map=function(mr){De.properties=mr;for(var Qi={},mi=0,_t=Ze;mi<_t.length;mi+=1){var ti=_t[mi];Qi[ti]=Ue[ti].evaluate(Ve,De)}return Qi},Ie.reduce=function(mr,Qi){De.properties=Qi;for(var mi=0,_t=Ze;mi<_t.length;mi+=1){var ti=_t[mi];Ve.accumulated=mr[ti],mr[ti]=ge[ti].evaluate(Ve,De)}},Ie})(Nt)).load(lt.features):(function(ne,Ie){return new Ee(ne,Ie)})(lt,Nt.geojsonVtOptions)}catch(ne){return xt(ne)}ut.loaded={};var tt={};if(mt){var Pe=mt.finish();Pe&&(tt.resourceTiming={},tt.resourceTiming[Nt.source]=JSON.parse(JSON.stringify(Pe)))}xt(null,tt)})}},it.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},it.prototype.reloadTile=function(ut,xt){var Nt=this.loaded;return Nt&&Nt[ut.uid]?Q.prototype.reloadTile.call(this,ut,xt):this.loadTile(ut,xt)},it.prototype.loadGeoJSON=function(ut,xt){if(ut.request)s.getJSON(ut.request,xt);else{if(typeof ut.data!="string")return xt(new Error("Input data given to '"+ut.source+"' is not a valid GeoJSON object."));try{return xt(null,JSON.parse(ut.data))}catch{return xt(new Error("Input data given to '"+ut.source+"' is not a valid GeoJSON object."))}}},it.prototype.removeSource=function(ut,xt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),xt()},it.prototype.getClusterExpansionZoom=function(ut,xt){try{xt(null,this._geoJSONIndex.getClusterExpansionZoom(ut.clusterId))}catch(Nt){xt(Nt)}},it.prototype.getClusterChildren=function(ut,xt){try{xt(null,this._geoJSONIndex.getChildren(ut.clusterId))}catch(Nt){xt(Nt)}},it.prototype.getClusterLeaves=function(ut,xt){try{xt(null,this._geoJSONIndex.getLeaves(ut.clusterId,ut.limit,ut.offset))}catch(Nt){xt(Nt)}},it})(z),Ae=function(Q){var it=this;this.self=Q,this.actor=new s.Actor(Q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:z,geojson:ee},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ut,xt){if(it.workerSourceTypes[ut])throw new Error('Worker source with name "'+ut+'" already registered.');it.workerSourceTypes[ut]=xt},this.self.registerRTLTextPlugin=function(ut){if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=ut.applyArabicShaping,s.plugin.processBidirectionalText=ut.processBidirectionalText,s.plugin.processStyledBidirectionalText=ut.processStyledBidirectionalText}};return Ae.prototype.setReferrer=function(Q,it){this.referrer=it},Ae.prototype.setImages=function(Q,it,ut){for(var xt in this.availableImages[Q]=it,this.workerSources[Q]){var Nt=this.workerSources[Q][xt];for(var mt in Nt)Nt[mt].availableImages=it}ut()},Ae.prototype.setLayers=function(Q,it,ut){this.getLayerIndex(Q).replace(it),ut()},Ae.prototype.updateLayers=function(Q,it,ut){this.getLayerIndex(Q).update(it.layers,it.removedIds),ut()},Ae.prototype.loadTile=function(Q,it,ut){this.getWorkerSource(Q,it.type,it.source).loadTile(it,ut)},Ae.prototype.loadDEMTile=function(Q,it,ut){this.getDEMWorkerSource(Q,it.source).loadTile(it,ut)},Ae.prototype.reloadTile=function(Q,it,ut){this.getWorkerSource(Q,it.type,it.source).reloadTile(it,ut)},Ae.prototype.abortTile=function(Q,it,ut){this.getWorkerSource(Q,it.type,it.source).abortTile(it,ut)},Ae.prototype.removeTile=function(Q,it,ut){this.getWorkerSource(Q,it.type,it.source).removeTile(it,ut)},Ae.prototype.removeDEMTile=function(Q,it){this.getDEMWorkerSource(Q,it.source).removeTile(it)},Ae.prototype.removeSource=function(Q,it,ut){if(this.workerSources[Q]&&this.workerSources[Q][it.type]&&this.workerSources[Q][it.type][it.source]){var xt=this.workerSources[Q][it.type][it.source];delete this.workerSources[Q][it.type][it.source],xt.removeSource!==void 0?xt.removeSource(it,ut):ut()}},Ae.prototype.loadWorkerSource=function(Q,it,ut){try{this.self.importScripts(it.url),ut()}catch(xt){ut(xt.toString())}},Ae.prototype.syncRTLPluginState=function(Q,it,ut){try{s.plugin.setState(it);var xt=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&xt!=null){this.self.importScripts(xt);var Nt=s.plugin.isParsed();ut(Nt?void 0:new Error("RTL Text Plugin failed to import scripts from "+xt),Nt)}}catch(mt){ut(mt.toString())}},Ae.prototype.getAvailableImages=function(Q){var it=this.availableImages[Q];return it||(it=[]),it},Ae.prototype.getLayerIndex=function(Q){var it=this.layerIndexes[Q];return it||(it=this.layerIndexes[Q]=new y),it},Ae.prototype.getWorkerSource=function(Q,it,ut){var xt=this;return this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][it]||(this.workerSources[Q][it]={}),this.workerSources[Q][it][ut]||(this.workerSources[Q][it][ut]=new this.workerSourceTypes[it]({send:function(Nt,mt,wt){xt.actor.send(Nt,mt,wt,Q)}},this.getLayerIndex(Q),this.getAvailableImages(Q))),this.workerSources[Q][it][ut]},Ae.prototype.getDEMWorkerSource=function(Q,it){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][it]||(this.demWorkerSources[Q][it]=new X),this.demWorkerSources[Q][it]},Ae.prototype.enforceCacheSizeLimit=function(Q,it){s.enforceCacheSizeLimit(it)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ae(self)),Ae}),o(["./shared"],function(s){var l=s.createCommonjsModule(function(m){function v(B){return!g(B)}function g(B){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var O,G,J=new Blob([""],{type:"text/javascript"}),at=URL.createObjectURL(J);try{G=new Worker(at),O=!0}catch{O=!1}return G&&G.terminate(),URL.revokeObjectURL(at),O})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var O=document.createElement("canvas");O.width=O.height=1;var G=O.getContext("2d");if(!G)return!1;var J=G.getImageData(0,0,1,1);return J&&J.width===O.width})()?(w[D=B&&B.failIfMajorPerformanceCaveat]===void 0&&(w[D]=(function(O){var G=(function(at){var Et=document.createElement("canvas"),Ct=Object.create(v.webGLContextAttributes);return Ct.failIfMajorPerformanceCaveat=at,Et.probablySupportsContext?Et.probablySupportsContext("webgl",Ct)||Et.probablySupportsContext("experimental-webgl",Ct):Et.supportsContext?Et.supportsContext("webgl",Ct)||Et.supportsContext("experimental-webgl",Ct):Et.getContext("webgl",Ct)||Et.getContext("experimental-webgl",Ct)})(O);if(!G)return!1;var J=G.createShader(G.VERTEX_SHADER);return!(!J||G.isContextLost())&&(G.shaderSource(J,"void main() {}"),G.compileShader(J),G.getShaderParameter(J,G.COMPILE_STATUS)===!0)})(D)),w[D]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var D}m.exports?m.exports=v:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=v,window.mapboxgl.notSupportedReason=g);var w={};v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),c={create:function(m,v,g){var w=s.window.document.createElement(m);return v!==void 0&&(w.className=v),g&&g.appendChild(w),w},createNS:function(m,v){return s.window.document.createElementNS(m,v)}},y=s.window.document&&s.window.document.documentElement.style;function _(m){if(!y)return m[0];for(var v=0;v<m.length;v++)if(m[v]in y)return m[v];return m[0]}var C,I=_(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);c.disableDrag=function(){y&&I&&(C=y[I],y[I]="none")},c.enableDrag=function(){y&&I&&(y[I]=C)};var k=_(["transform","WebkitTransform"]);c.setTransform=function(m,v){m.style[k]=v};var z=!1;try{var V=Object.defineProperty({},"passive",{get:function(){z=!0}});s.window.addEventListener("test",V,V),s.window.removeEventListener("test",V,V)}catch{z=!1}c.addEventListener=function(m,v,g,w){w===void 0&&(w={}),m.addEventListener(v,g,"passive"in w&&z?w:w.capture)},c.removeEventListener=function(m,v,g,w){w===void 0&&(w={}),m.removeEventListener(v,g,"passive"in w&&z?w:w.capture)};var X=function(m){m.preventDefault(),m.stopPropagation(),s.window.removeEventListener("click",X,!0)};function H(m){var v=m.userImage;return!!(v&&v.render&&v.render())&&(m.data.replace(new Uint8Array(v.data.buffer)),!0)}c.suppressClick=function(){s.window.addEventListener("click",X,!0),s.window.setTimeout(function(){s.window.removeEventListener("click",X,!0)},0)},c.mousePos=function(m,v){var g=m.getBoundingClientRect();return new s.Point(v.clientX-g.left-m.clientLeft,v.clientY-g.top-m.clientTop)},c.touchPos=function(m,v){for(var g=m.getBoundingClientRect(),w=[],B=0;B<v.length;B++)w.push(new s.Point(v[B].clientX-g.left-m.clientLeft,v[B].clientY-g.top-m.clientTop));return w},c.mouseButton=function(m){return s.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button},c.remove=function(m){m.parentNode&&m.parentNode.removeChild(m)};var $=(function(m){function v(){m.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.isLoaded=function(){return this.loaded},v.prototype.setLoaded=function(g){if(this.loaded!==g&&(this.loaded=g,g)){for(var w=0,B=this.requestors;w<B.length;w+=1){var D=B[w];this._notify(D.ids,D.callback)}this.requestors=[]}},v.prototype.getImage=function(g){return this.images[g]},v.prototype.addImage=function(g,w){this._validate(g,w)&&(this.images[g]=w)},v.prototype._validate=function(g,w){var B=!0;return this._validateStretch(w.stretchX,w.data&&w.data.width)||(this.fire(new s.ErrorEvent(new Error('Image "'+g+'" has invalid "stretchX" value'))),B=!1),this._validateStretch(w.stretchY,w.data&&w.data.height)||(this.fire(new s.ErrorEvent(new Error('Image "'+g+'" has invalid "stretchY" value'))),B=!1),this._validateContent(w.content,w)||(this.fire(new s.ErrorEvent(new Error('Image "'+g+'" has invalid "content" value'))),B=!1),B},v.prototype._validateStretch=function(g,w){if(!g)return!0;for(var B=0,D=0,O=g;D<O.length;D+=1){var G=O[D];if(G[0]<B||G[1]<G[0]||w<G[1])return!1;B=G[1]}return!0},v.prototype._validateContent=function(g,w){return!(g&&(g.length!==4||g[0]<0||w.data.width<g[0]||g[1]<0||w.data.height<g[1]||g[2]<0||w.data.width<g[2]||g[3]<0||w.data.height<g[3]||g[2]<g[0]||g[3]<g[1]))},v.prototype.updateImage=function(g,w){w.version=this.images[g].version+1,this.images[g]=w,this.updatedImages[g]=!0},v.prototype.removeImage=function(g){var w=this.images[g];delete this.images[g],delete this.patterns[g],w.userImage&&w.userImage.onRemove&&w.userImage.onRemove()},v.prototype.listImages=function(){return Object.keys(this.images)},v.prototype.getImages=function(g,w){var B=!0;if(!this.isLoaded())for(var D=0,O=g;D<O.length;D+=1)this.images[O[D]]||(B=!1);this.isLoaded()||B?this._notify(g,w):this.requestors.push({ids:g,callback:w})},v.prototype._notify=function(g,w){for(var B={},D=0,O=g;D<O.length;D+=1){var G=O[D];this.images[G]||this.fire(new s.Event("styleimagemissing",{id:G}));var J=this.images[G];J?B[G]={data:J.data.clone(),pixelRatio:J.pixelRatio,sdf:J.sdf,version:J.version,stretchX:J.stretchX,stretchY:J.stretchY,content:J.content,hasRenderCallback:!!(J.userImage&&J.userImage.render)}:s.warnOnce('Image "'+G+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}w(null,B)},v.prototype.getPixelSize=function(){var g=this.atlasImage;return{width:g.width,height:g.height}},v.prototype.getPattern=function(g){var w=this.patterns[g],B=this.getImage(g);if(!B)return null;if(w&&w.position.version===B.version)return w.position;if(w)w.position.version=B.version;else{var D={w:B.data.width+2,h:B.data.height+2,x:0,y:0},O=new s.ImagePosition(D,B);this.patterns[g]={bin:D,position:O}}return this._updatePatternAtlas(),this.patterns[g].position},v.prototype.bind=function(g){var w=g.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(g,this.atlasImage,w.RGBA),this.atlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE)},v.prototype._updatePatternAtlas=function(){var g=[];for(var w in this.patterns)g.push(this.patterns[w].bin);var B=s.potpack(g),D=B.w,O=B.h,G=this.atlasImage;for(var J in G.resize({width:D||1,height:O||1}),this.patterns){var at=this.patterns[J].bin,Et=at.x+1,Ct=at.y+1,Bt=this.images[J].data,Wt=Bt.width,zt=Bt.height;s.RGBAImage.copy(Bt,G,{x:0,y:0},{x:Et,y:Ct},{width:Wt,height:zt}),s.RGBAImage.copy(Bt,G,{x:0,y:zt-1},{x:Et,y:Ct-1},{width:Wt,height:1}),s.RGBAImage.copy(Bt,G,{x:0,y:0},{x:Et,y:Ct+zt},{width:Wt,height:1}),s.RGBAImage.copy(Bt,G,{x:Wt-1,y:0},{x:Et-1,y:Ct},{width:1,height:zt}),s.RGBAImage.copy(Bt,G,{x:0,y:0},{x:Et+Wt,y:Ct},{width:1,height:zt})}this.dirty=!0},v.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},v.prototype.dispatchRenderCallbacks=function(g){for(var w=0,B=g;w<B.length;w+=1){var D=B[w];if(!this.callbackDispatchedThisFrame[D]){this.callbackDispatchedThisFrame[D]=!0;var O=this.images[D];H(O)&&this.updateImage(D,O)}}},v})(s.Evented),Y=nt,ct=nt,rt=1e20;function nt(m,v,g,w,B,D){this.fontSize=m||24,this.buffer=v===void 0?3:v,this.cutoff=w||.25,this.fontFamily=B||"sans-serif",this.fontWeight=D||"normal",this.radius=g||8;var O=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=O,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.d=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Int16Array(O),this.middle=Math.round(O/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ot(m,v,g,w,B,D,O){for(var G=0;G<v;G++){for(var J=0;J<g;J++)w[J]=m[J*v+G];for(Kt(w,B,D,O,g),J=0;J<g;J++)m[J*v+G]=B[J]}for(J=0;J<g;J++){for(G=0;G<v;G++)w[G]=m[J*v+G];for(Kt(w,B,D,O,v),G=0;G<v;G++)m[J*v+G]=Math.sqrt(B[G])}}function Kt(m,v,g,w,B){g[0]=0,w[0]=-rt,w[1]=+rt;for(var D=1,O=0;D<B;D++){for(var G=(m[D]+D*D-(m[g[O]]+g[O]*g[O]))/(2*D-2*g[O]);G<=w[O];)O--,G=(m[D]+D*D-(m[g[O]]+g[O]*g[O]))/(2*D-2*g[O]);g[++O]=D,w[O]=G,w[O+1]=+rt}for(D=0,O=0;D<B;D++){for(;w[O+1]<D;)O++;v[D]=(D-g[O])*(D-g[O])+m[g[O]]}}nt.prototype.draw=function(m){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(m,this.buffer,this.middle);for(var v=this.ctx.getImageData(0,0,this.size,this.size),g=new Uint8ClampedArray(this.size*this.size),w=0;w<this.size*this.size;w++){var B=v.data[4*w+3]/255;this.gridOuter[w]=B===1?0:B===0?rt:Math.pow(Math.max(0,.5-B),2),this.gridInner[w]=B===1?rt:B===0?0:Math.pow(Math.max(0,B-.5),2)}for(Ot(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ot(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),w=0;w<this.size*this.size;w++)g[w]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[w]-this.gridInner[w])/this.radius+this.cutoff))));return g},Y.default=ct;var ft=function(m,v){this.requestManager=m,this.localIdeographFontFamily=v,this.entries={}};ft.prototype.setURL=function(m){this.url=m},ft.prototype.getGlyphs=function(m,v){var g=this,w=[];for(var B in m)for(var D=0,O=m[B];D<O.length;D+=1)w.push({stack:B,id:O[D]});s.asyncAll(w,function(G,J){var at=G.stack,Et=G.id,Ct=g.entries[at];Ct||(Ct=g.entries[at]={glyphs:{},requests:{},ranges:{}});var Bt=Ct.glyphs[Et];if(Bt===void 0){if(Bt=g._tinySDF(Ct,at,Et))return Ct.glyphs[Et]=Bt,void J(null,{stack:at,id:Et,glyph:Bt});var Wt=Math.floor(Et/256);if(256*Wt>65535)J(new Error("glyphs > 65535 not supported"));else if(Ct.ranges[Wt])J(null,{stack:at,id:Et,glyph:Bt});else{var zt=Ct.requests[Wt];zt||(zt=Ct.requests[Wt]=[],ft.loadGlyphRange(at,Wt,g.url,g.requestManager,function(f,h){if(h){for(var A in h)g._doesCharSupportLocalGlyph(+A)||(Ct.glyphs[+A]=h[+A]);Ct.ranges[Wt]=!0}for(var b=0,E=zt;b<E.length;b+=1)(0,E[b])(f,h);delete Ct.requests[Wt]})),zt.push(function(f,h){f?J(f):h&&J(null,{stack:at,id:Et,glyph:h[Et]||null})})}}else J(null,{stack:at,id:Et,glyph:Bt})},function(G,J){if(G)v(G);else if(J){for(var at={},Et=0,Ct=J;Et<Ct.length;Et+=1){var Bt=Ct[Et],Wt=Bt.stack,zt=Bt.id,f=Bt.glyph;(at[Wt]||(at[Wt]={}))[zt]=f&&{id:f.id,bitmap:f.bitmap.clone(),metrics:f.metrics}}v(null,at)}})},ft.prototype._doesCharSupportLocalGlyph=function(m){return!!this.localIdeographFontFamily&&(s.isChar["CJK Unified Ideographs"](m)||s.isChar["Hangul Syllables"](m)||s.isChar.Hiragana(m)||s.isChar.Katakana(m))},ft.prototype._tinySDF=function(m,v,g){var w=this.localIdeographFontFamily;if(w&&this._doesCharSupportLocalGlyph(g)){var B=m.tinySDF;if(!B){var D="400";/bold/i.test(v)?D="900":/medium/i.test(v)?D="500":/light/i.test(v)&&(D="200"),B=m.tinySDF=new ft.TinySDF(24,3,8,.25,w,D)}return{id:g,bitmap:new s.AlphaImage({width:30,height:30},B.draw(String.fromCharCode(g))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},ft.loadGlyphRange=function(m,v,g,w,B){var D=256*v,O=D+255,G=w.transformRequest(w.normalizeGlyphsURL(g).replace("{fontstack}",m).replace("{range}",D+"-"+O),s.ResourceType.Glyphs);s.getArrayBuffer(G,function(J,at){if(J)B(J);else if(at){for(var Et={},Ct=0,Bt=s.parseGlyphPBF(at);Ct<Bt.length;Ct+=1){var Wt=Bt[Ct];Et[Wt.id]=Wt}B(null,Et)}})},ft.TinySDF=Y;var st=function(){this.specification=s.styleSpec.light.position};st.prototype.possiblyEvaluate=function(m,v){return s.sphericalToCartesian(m.expression.evaluate(v))},st.prototype.interpolate=function(m,v,g){return{x:s.number(m.x,v.x,g),y:s.number(m.y,v.y,g),z:s.number(m.z,v.z,g)}};var Ut=new s.Properties({anchor:new s.DataConstantProperty(s.styleSpec.light.anchor),position:new st,color:new s.DataConstantProperty(s.styleSpec.light.color),intensity:new s.DataConstantProperty(s.styleSpec.light.intensity)}),K=(function(m){function v(g){m.call(this),this._transitionable=new s.Transitionable(Ut),this.setLight(g),this._transitioning=this._transitionable.untransitioned()}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getLight=function(){return this._transitionable.serialize()},v.prototype.setLight=function(g,w){if(w===void 0&&(w={}),!this._validate(s.validateLight,g,w))for(var B in g){var D=g[B];s.endsWith(B,"-transition")?this._transitionable.setTransition(B.slice(0,-11),D):this._transitionable.setValue(B,D)}},v.prototype.updateTransitions=function(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)},v.prototype.hasTransition=function(){return this._transitioning.hasTransition()},v.prototype.recalculate=function(g){this.properties=this._transitioning.possiblyEvaluate(g)},v.prototype._validate=function(g,w,B){return(!B||B.validate!==!1)&&s.emitValidationErrors(this,g.call(s.validateStyle,s.extend({value:w,style:{glyphs:!0,sprite:!0},styleSpec:s.styleSpec})))},v})(s.Evented),dt=function(m,v){this.width=m,this.height=v,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};dt.prototype.getDash=function(m,v){var g=m.join(",")+String(v);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(m,v)),this.dashEntry[g]},dt.prototype.getDashRanges=function(m,v,g){var w=[],B=m.length%2==1?-m[m.length-1]*g:0,D=m[0]*g,O=!0;w.push({left:B,right:D,isDash:O,zeroLength:m[0]===0});for(var G=m[0],J=1;J<m.length;J++){var at=m[J];w.push({left:B=G*g,right:D=(G+=at)*g,isDash:O=!O,zeroLength:at===0})}return w},dt.prototype.addRoundDash=function(m,v,g){for(var w=v/2,B=-g;B<=g;B++)for(var D=this.width*(this.nextRow+g+B),O=0,G=m[O],J=0;J<this.width;J++){J/G.right>1&&(G=m[++O]);var at=Math.abs(J-G.left),Et=Math.abs(J-G.right),Ct=Math.min(at,Et),Bt=void 0,Wt=B/g*(w+1);if(G.isDash){var zt=w-Math.abs(Wt);Bt=Math.sqrt(Ct*Ct+zt*zt)}else Bt=w-Math.sqrt(Ct*Ct+Wt*Wt);this.data[D+J]=Math.max(0,Math.min(255,Bt+128))}},dt.prototype.addRegularDash=function(m){for(var v=m.length-1;v>=0;--v){var g=m[v],w=m[v+1];g.zeroLength?m.splice(v,1):w&&w.isDash===g.isDash&&(w.left=g.left,m.splice(v,1))}var B=m[0],D=m[m.length-1];B.isDash===D.isDash&&(B.left=D.left-this.width,D.right=B.right+this.width);for(var O=this.width*this.nextRow,G=0,J=m[G],at=0;at<this.width;at++){at/J.right>1&&(J=m[++G]);var Et=Math.abs(at-J.left),Ct=Math.abs(at-J.right),Bt=Math.min(Et,Ct);this.data[O+at]=Math.max(0,Math.min(255,(J.isDash?Bt:-Bt)+128))}},dt.prototype.addDash=function(m,v){var g=v?7:0,w=2*g+1;if(this.nextRow+w>this.height)return s.warnOnce("LineAtlas out of space"),null;for(var B=0,D=0;D<m.length;D++)B+=m[D];if(B!==0){var O=this.width/B,G=this.getDashRanges(m,this.width,O);v?this.addRoundDash(G,O,g):this.addRegularDash(G)}var J={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:B};return this.nextRow+=w,this.dirty=!0,J},dt.prototype.bind=function(m){var v=m.gl;this.texture?(v.bindTexture(v.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,v.texSubImage2D(v.TEXTURE_2D,0,0,0,this.width,this.height,v.ALPHA,v.UNSIGNED_BYTE,this.data))):(this.texture=v.createTexture(),v.bindTexture(v.TEXTURE_2D,this.texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texImage2D(v.TEXTURE_2D,0,v.ALPHA,this.width,this.height,0,v.ALPHA,v.UNSIGNED_BYTE,this.data))};var Tt=function m(v,g){this.workerPool=v,this.actors=[],this.currentActor=0,this.id=s.uniqueId();for(var w=this.workerPool.acquire(this.id),B=0;B<w.length;B++){var D=new m.Actor(w[B],g,this.id);D.name="Worker "+B,this.actors.push(D)}};function ue(m,v,g){var w=function(B,D){if(B)return g(B);if(D){var O=s.pick(s.extend(D,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(O.vectorLayers=D.vector_layers,O.vectorLayerIds=O.vectorLayers.map(function(G){return G.id})),O.tiles=v.canonicalizeTileset(O,m.url),g(null,O)}};return m.url?s.getJSON(v.transformRequest(v.normalizeSourceURL(m.url),s.ResourceType.Source),w):s.browser.frame(function(){return w(null,m)})}Tt.prototype.broadcast=function(m,v,g){s.asyncAll(this.actors,function(w,B){w.send(m,v,B)},g=g||function(){})},Tt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Tt.prototype.remove=function(){this.actors.forEach(function(m){m.remove()}),this.actors=[],this.workerPool.release(this.id)},Tt.Actor=s.Actor;var Rt=function(m,v,g){this.bounds=s.LngLatBounds.convert(this.validateBounds(m)),this.minzoom=v||0,this.maxzoom=g||24};Rt.prototype.validateBounds=function(m){return Array.isArray(m)&&m.length===4?[Math.max(-180,m[0]),Math.max(-90,m[1]),Math.min(180,m[2]),Math.min(90,m[3])]:[-180,-90,180,90]},Rt.prototype.contains=function(m){var v=Math.pow(2,m.z),g=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*v),w=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*v),B=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*v),D=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*v);return m.x>=g&&m.x<B&&m.y>=w&&m.y<D};var Ft=(function(m){function v(g,w,B,D){if(m.call(this),this.id=g,this.dispatcher=B,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(w,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},w),this._collectResourceTiming=w.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(D)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.load=function(){var g=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ue(this._options,this.map._requestManager,function(w,B){g._tileJSONRequest=null,g._loaded=!0,w?g.fire(new s.ErrorEvent(w)):B&&(s.extend(g,B),B.bounds&&(g.tileBounds=new Rt(B.bounds,g.minzoom,g.maxzoom)),s.postTurnstileEvent(B.tiles,g.map._requestManager._customAccessToken),s.postMapLoadEvent(B.tiles,g.map._getMapId(),g.map._requestManager._skuToken,g.map._requestManager._customAccessToken),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.hasTile=function(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)},v.prototype.onAdd=function(g){this.map=g,this.load()},v.prototype.setSourceProperty=function(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},v.prototype.setTiles=function(g){var w=this;return this.setSourceProperty(function(){w._options.tiles=g}),this},v.prototype.setUrl=function(g){var w=this;return this.setSourceProperty(function(){w.url=g,w._options.url=g}),this},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return s.extend({},this._options)},v.prototype.loadTile=function(g,w){var B=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),D={request:this.map._requestManager.transformRequest(B,s.ResourceType.Tile),uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function O(G,J){return delete g.request,g.aborted?w(null):G&&G.status!==404?w(G):(J&&J.resourceTiming&&(g.resourceTiming=J.resourceTiming),this.map._refreshExpiredTiles&&J&&g.setExpiryData(J),g.loadVectorData(J,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),w(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}D.request.collectResourceTiming=this._collectResourceTiming,g.actor&&g.state!=="expired"?g.state==="loading"?g.reloadCallback=w:g.request=g.actor.send("reloadTile",D,O.bind(this)):(g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",D,O.bind(this)))},v.prototype.abortTile=function(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id},void 0)},v.prototype.unloadTile=function(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id},void 0)},v.prototype.hasTransition=function(){return!1},v})(s.Evented),Gt=(function(m){function v(g,w,B,D){m.call(this),this.id=g,this.dispatcher=B,this.setEventedParent(D),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},w),s.extend(this,s.pick(w,["url","scheme","tileSize"]))}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.load=function(){var g=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ue(this._options,this.map._requestManager,function(w,B){g._tileJSONRequest=null,g._loaded=!0,w?g.fire(new s.ErrorEvent(w)):B&&(s.extend(g,B),B.bounds&&(g.tileBounds=new Rt(B.bounds,g.minzoom,g.maxzoom)),s.postTurnstileEvent(B.tiles),s.postMapLoadEvent(B.tiles,g.map._getMapId(),g.map._requestManager._skuToken),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.onAdd=function(g){this.map=g,this.load()},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return s.extend({},this._options)},v.prototype.hasTile=function(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)},v.prototype.loadTile=function(g,w){var B=this,D=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);g.request=s.getImage(this.map._requestManager.transformRequest(D,s.ResourceType.Tile),function(O,G){if(delete g.request,g.aborted)g.state="unloaded",w(null);else if(O)g.state="errored",w(O);else if(G){B.map._refreshExpiredTiles&&g.setExpiryData(G),delete G.cacheControl,delete G.expires;var J=B.map.painter.context,at=J.gl;g.texture=B.map.painter.getTileTexture(G.width),g.texture?g.texture.update(G,{useMipmap:!0}):(g.texture=new s.Texture(J,G,at.RGBA,{useMipmap:!0}),g.texture.bind(at.LINEAR,at.CLAMP_TO_EDGE,at.LINEAR_MIPMAP_NEAREST),J.extTextureFilterAnisotropic&&at.texParameterf(at.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax)),g.state="loaded",s.cacheEntryPossiblyAdded(B.dispatcher),w(null)}})},v.prototype.abortTile=function(g,w){g.request&&(g.request.cancel(),delete g.request),w()},v.prototype.unloadTile=function(g,w){g.texture&&this.map.painter.saveTileTexture(g.texture),w()},v.prototype.hasTransition=function(){return!1},v})(s.Evented),se=(function(m){function v(g,w,B,D){m.call(this,g,w,B,D),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},w),this.encoding=w.encoding||"mapbox"}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},v.prototype.loadTile=function(g,w){var B=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function D(O,G){O&&(g.state="errored",w(O)),G&&(g.dem=G,g.needsHillshadePrepare=!0,g.state="loaded",w(null))}g.request=s.getImage(this.map._requestManager.transformRequest(B,s.ResourceType.Tile),(function(O,G){if(delete g.request,g.aborted)g.state="unloaded",w(null);else if(O)g.state="errored",w(O);else if(G){this.map._refreshExpiredTiles&&g.setExpiryData(G),delete G.cacheControl,delete G.expires;var J=s.window.ImageBitmap&&G instanceof s.window.ImageBitmap&&s.offscreenCanvasSupported()?G:s.browser.getImageData(G,1),at={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:J,encoding:this.encoding};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",at,D.bind(this)))}}).bind(this)),g.neighboringTiles=this._getNeighboringTiles(g.tileID)},v.prototype._getNeighboringTiles=function(g){var w=g.canonical,B=Math.pow(2,w.z),D=(w.x-1+B)%B,O=w.x===0?g.wrap-1:g.wrap,G=(w.x+1+B)%B,J=w.x+1===B?g.wrap+1:g.wrap,at={};return at[new s.OverscaledTileID(g.overscaledZ,O,w.z,D,w.y).key]={backfilled:!1},at[new s.OverscaledTileID(g.overscaledZ,J,w.z,G,w.y).key]={backfilled:!1},w.y>0&&(at[new s.OverscaledTileID(g.overscaledZ,O,w.z,D,w.y-1).key]={backfilled:!1},at[new s.OverscaledTileID(g.overscaledZ,g.wrap,w.z,w.x,w.y-1).key]={backfilled:!1},at[new s.OverscaledTileID(g.overscaledZ,J,w.z,G,w.y-1).key]={backfilled:!1}),w.y+1<B&&(at[new s.OverscaledTileID(g.overscaledZ,O,w.z,D,w.y+1).key]={backfilled:!1},at[new s.OverscaledTileID(g.overscaledZ,g.wrap,w.z,w.x,w.y+1).key]={backfilled:!1},at[new s.OverscaledTileID(g.overscaledZ,J,w.z,G,w.y+1).key]={backfilled:!1}),at},v.prototype.unloadTile=function(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded",g.actor&&g.actor.send("removeDEMTile",{uid:g.uid,source:this.id})},v})(Gt),le=(function(m){function v(g,w,B,D){m.call(this),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=B.getActor(),this.setEventedParent(D),this._data=w.data,this._options=s.extend({},w),this._collectResourceTiming=w.collectResourceTiming,this._resourceTiming=[],w.maxzoom!==void 0&&(this.maxzoom=w.maxzoom),w.type&&(this.type=w.type),w.attribution&&(this.attribution=w.attribution),this.promoteId=w.promoteId;var O=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:w.cluster||!1,geojsonVtOptions:{buffer:(w.buffer!==void 0?w.buffer:128)*O,tolerance:(w.tolerance!==void 0?w.tolerance:.375)*O,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:w.lineMetrics||!1,generateId:w.generateId||!1},superclusterOptions:{maxZoom:w.clusterMaxZoom!==void 0?Math.min(w.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,w.clusterMinPoints||2),extent:s.EXTENT,radius:(w.clusterRadius||50)*O,log:!1,generateId:w.generateId||!1},clusterProperties:w.clusterProperties,filter:w.filter},w.workerOptions)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.load=function(){var g=this;this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(w){if(w)g.fire(new s.ErrorEvent(w));else{var B={dataType:"source",sourceDataType:"metadata"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(B.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new s.Event("data",B))}})},v.prototype.onAdd=function(g){this.map=g,this.load()},v.prototype.setData=function(g){var w=this;return this._data=g,this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(B){if(B)w.fire(new s.ErrorEvent(B));else{var D={dataType:"source",sourceDataType:"content"};w._collectResourceTiming&&w._resourceTiming&&w._resourceTiming.length>0&&(D.resourceTiming=w._resourceTiming,w._resourceTiming=[]),w.fire(new s.Event("data",D))}}),this},v.prototype.getClusterExpansionZoom=function(g,w){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},w),this},v.prototype.getClusterChildren=function(g,w){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},w),this},v.prototype.getClusterLeaves=function(g,w,B,D){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:w,offset:B},D),this},v.prototype._updateWorkerData=function(g){var w=this;this._loaded=!1;var B=s.extend({},this.workerOptions),D=this._data;typeof D=="string"?(B.request=this.map._requestManager.transformRequest(s.browser.resolveURL(D),s.ResourceType.Source),B.request.collectResourceTiming=this._collectResourceTiming):B.data=JSON.stringify(D),this.actor.send(this.type+".loadData",B,function(O,G){w._removed||G&&G.abandoned||(w._loaded=!0,G&&G.resourceTiming&&G.resourceTiming[w.id]&&(w._resourceTiming=G.resourceTiming[w.id].slice(0)),w.actor.send(w.type+".coalesce",{source:B.source},null),g(O))})},v.prototype.loaded=function(){return this._loaded},v.prototype.loadTile=function(g,w){var B=this,D=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(D,{type:this.type,uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(O,G){return delete g.request,g.unloadVectorData(),g.aborted?w(null):O?w(O):(g.loadVectorData(G,B.map.painter,D==="reloadTile"),w(null))})},v.prototype.abortTile=function(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0},v.prototype.unloadTile=function(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})},v.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},v.prototype.serialize=function(){return s.extend({},this._options,{type:this.type,data:this._data})},v.prototype.hasTransition=function(){return!1},v})(s.Evented),de=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ye=(function(m){function v(g,w,B,D){m.call(this),this.id=g,this.dispatcher=B,this.coordinates=w.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(D),this.options=w}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.load=function(g,w){var B=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),function(D,O){B._loaded=!0,D?B.fire(new s.ErrorEvent(D)):O&&(B.image=O,g&&(B.coordinates=g),w&&w(),B._finishLoading())})},v.prototype.loaded=function(){return this._loaded},v.prototype.updateImage=function(g){var w=this;return this.image&&g.url?(this.options.url=g.url,this.load(g.coordinates,function(){w.texture=null}),this):this},v.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))},v.prototype.onAdd=function(g){this.map=g,this.load()},v.prototype.setCoordinates=function(g){var w=this;this.coordinates=g;var B=g.map(s.MercatorCoordinate.fromLngLat);this.tileID=(function(O){for(var G=1/0,J=1/0,at=-1/0,Et=-1/0,Ct=0,Bt=O;Ct<Bt.length;Ct+=1){var Wt=Bt[Ct];G=Math.min(G,Wt.x),J=Math.min(J,Wt.y),at=Math.max(at,Wt.x),Et=Math.max(Et,Wt.y)}var zt=Math.max(at-G,Et-J),f=Math.max(0,Math.floor(-Math.log(zt)/Math.LN2)),h=Math.pow(2,f);return new s.CanonicalTileID(f,Math.floor((G+at)/2*h),Math.floor((J+Et)/2*h))})(B),this.minzoom=this.maxzoom=this.tileID.z;var D=B.map(function(O){return w.tileID.getTilePoint(O)._round()});return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(D[0].x,D[0].y,0,0),this._boundsArray.emplaceBack(D[1].x,D[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(D[3].x,D[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(D[2].x,D[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this},v.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var g=this.map.painter.context,w=g.gl;for(var B in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,de.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(g,this.image,w.RGBA),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE)),this.tiles){var D=this.tiles[B];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}}},v.prototype.loadTile=function(g,w){this.tileID&&this.tileID.equals(g.tileID.canonical)?(this.tiles[String(g.tileID.wrap)]=g,g.buckets={},w(null)):(g.state="errored",w(null))},v.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return!1},v})(s.Evented),Oe=(function(m){function v(g,w,B,D){m.call(this,g,w,B,D),this.roundZoom=!0,this.type="video",this.options=w}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.load=function(){var g=this;this._loaded=!1;var w=this.options;this.urls=[];for(var B=0,D=w.urls;B<D.length;B+=1)this.urls.push(this.map._requestManager.transformRequest(D[B],s.ResourceType.Source).url);s.getVideo(this.urls,function(O,G){g._loaded=!0,O?g.fire(new s.ErrorEvent(O)):G&&(g.video=G,g.video.loop=!0,g.video.setAttribute("playsinline",""),g.video.addEventListener("playing",function(){g.map.triggerRepaint()}),g.map&&g.video.play(),g._finishLoading())})},v.prototype.pause=function(){this.video&&this.video.pause()},v.prototype.play=function(){this.video&&this.video.play()},v.prototype.seek=function(g){if(this.video){var w=this.video.seekable;g<w.start(0)||g>w.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+w.start(0)+" and "+w.end(0)+"-second mark."))):this.video.currentTime=g}},v.prototype.getVideo=function(){return this.video},v.prototype.onAdd=function(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},v.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var g=this.map.painter.context,w=g.gl;for(var B in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,de.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.texSubImage2D(w.TEXTURE_2D,0,0,0,w.RGBA,w.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(g,this.video,w.RGBA),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE)),this.tiles){var D=this.tiles[B];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this.video&&!this.video.paused},v})(ye),Le=(function(m){function v(g,w,B,D){m.call(this,g,w,B,D),w.coordinates?Array.isArray(w.coordinates)&&w.coordinates.length===4&&!w.coordinates.some(function(O){return!Array.isArray(O)||O.length!==2||O.some(function(G){return typeof G!="number"})})||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'missing required property "coordinates"'))),w.animate&&typeof w.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'optional "animate" property must be a boolean value'))),w.canvas?typeof w.canvas=="string"||w.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'missing required property "canvas"'))),this.options=w,this.animate=w.animate===void 0||w.animate}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},v.prototype.getCanvas=function(){return this.canvas},v.prototype.onAdd=function(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()},v.prototype.onRemove=function(){this.pause()},v.prototype.prepare=function(){var g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var w=this.map.painter.context,B=w.gl;for(var D in this.boundsBuffer||(this.boundsBuffer=w.createVertexBuffer(this._boundsArray,de.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(w,this.canvas,B.RGBA,{premultiply:!0}),this.tiles){var O=this.tiles[D];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this._playing},v.prototype._hasInvalidDimensions=function(){for(var g=0,w=[this.canvas.width,this.canvas.height];g<w.length;g+=1){var B=w[g];if(isNaN(B)||B<=0)return!0}return!1},v})(ye),fe={vector:Ft,raster:Gt,"raster-dem":se,geojson:le,video:Oe,image:ye,canvas:Le};function _i(m,v){var g=s.identity([]);return s.translate(g,g,[1,1,0]),s.scale(g,g,[.5*m.width,.5*m.height,1]),s.multiply(g,g,m.calculatePosMatrix(v.toUnwrapped()))}function ei(m,v,g,w,B,D){var O=(function(f,h,A){if(f)for(var b=0,E=f;b<E.length;b+=1){var S=h[E[b]];if(S&&S.source===A&&S.type==="fill-extrusion")return!0}else for(var P in h){var R=h[P];if(R.source===A&&R.type==="fill-extrusion")return!0}return!1})(B&&B.layers,v,m.id),G=D.maxPitchScaleFactor(),J=m.tilesIn(w,G,O);J.sort(ii);for(var at=[],Et=0,Ct=J;Et<Ct.length;Et+=1){var Bt=Ct[Et];at.push({wrappedTileID:Bt.tileID.wrapped().key,queryResults:Bt.tile.queryRenderedFeatures(v,g,m._state,Bt.queryGeometry,Bt.cameraQueryGeometry,Bt.scale,B,D,G,_i(m.transform,Bt.tileID))})}var Wt=(function(f){for(var h={},A={},b=0,E=f;b<E.length;b+=1){var S=E[b],P=S.queryResults,R=S.wrappedTileID,F=A[R]=A[R]||{};for(var U in P)for(var W=P[U],ht=F[U]=F[U]||{},Pt=h[U]=h[U]||[],It=0,Mt=W;It<Mt.length;It+=1){var Yt=Mt[It];ht[Yt.featureIndex]||(ht[Yt.featureIndex]=!0,Pt.push(Yt))}}return h})(at);for(var zt in Wt)Wt[zt].forEach(function(f){var h=f.feature,A=m.getFeatureState(h.layer["source-layer"],h.id);h.source=h.layer.source,h.layer["source-layer"]&&(h.sourceLayer=h.layer["source-layer"]),h.state=A});return Wt}function ii(m,v){var g=m.tileID,w=v.tileID;return g.overscaledZ-w.overscaledZ||g.canonical.y-w.canonical.y||g.wrap-w.wrap||g.canonical.x-w.canonical.x}var Qe=function(m,v){this.max=m,this.onRemove=v,this.reset()};Qe.prototype.reset=function(){for(var m in this.data)for(var v=0,g=this.data[m];v<g.length;v+=1){var w=g[v];w.timeout&&clearTimeout(w.timeout),this.onRemove(w.value)}return this.data={},this.order=[],this},Qe.prototype.add=function(m,v,g){var w=this,B=m.wrapped().key;this.data[B]===void 0&&(this.data[B]=[]);var D={value:v,timeout:void 0};if(g!==void 0&&(D.timeout=setTimeout(function(){w.remove(m,D)},g)),this.data[B].push(D),this.order.push(B),this.order.length>this.max){var O=this._getAndRemoveByKey(this.order[0]);O&&this.onRemove(O)}return this},Qe.prototype.has=function(m){return m.wrapped().key in this.data},Qe.prototype.getAndRemove=function(m){return this.has(m)?this._getAndRemoveByKey(m.wrapped().key):null},Qe.prototype._getAndRemoveByKey=function(m){var v=this.data[m].shift();return v.timeout&&clearTimeout(v.timeout),this.data[m].length===0&&delete this.data[m],this.order.splice(this.order.indexOf(m),1),v.value},Qe.prototype.getByKey=function(m){var v=this.data[m];return v?v[0].value:null},Qe.prototype.get=function(m){return this.has(m)?this.data[m.wrapped().key][0].value:null},Qe.prototype.remove=function(m,v){if(!this.has(m))return this;var g=m.wrapped().key,w=v===void 0?0:this.data[g].indexOf(v),B=this.data[g][w];return this.data[g].splice(w,1),B.timeout&&clearTimeout(B.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(B.value),this.order.splice(this.order.indexOf(g),1),this},Qe.prototype.setMaxSize=function(m){for(this.max=m;this.order.length>this.max;){var v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this},Qe.prototype.filter=function(m){var v=[];for(var g in this.data)for(var w=0,B=this.data[g];w<B.length;w+=1){var D=B[w];m(D.value)||v.push(D)}for(var O=0,G=v;O<G.length;O+=1){var J=G[O];this.remove(J.value.tileID,J)}};var yi=function(m,v,g){this.context=m;var w=m.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),m.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};yi.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},yi.prototype.updateData=function(m){var v=this.context.gl;this.context.unbindVAO(),this.bind(),v.bufferSubData(v.ELEMENT_ARRAY_BUFFER,0,m.arrayBuffer)},yi.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var cn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ni=function(m,v,g,w){this.length=v.length,this.attributes=g,this.itemSize=v.bytesPerElement,this.dynamicDraw=w,this.context=m;var B=m.gl;this.buffer=B.createBuffer(),m.bindVertexBuffer.set(this.buffer),B.bufferData(B.ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?B.DYNAMIC_DRAW:B.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Ni.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ni.prototype.updateData=function(m){var v=this.context.gl;this.bind(),v.bufferSubData(v.ARRAY_BUFFER,0,m.arrayBuffer)},Ni.prototype.enableAttributes=function(m,v){for(var g=0;g<this.attributes.length;g++){var w=v.attributes[this.attributes[g].name];w!==void 0&&m.enableVertexAttribArray(w)}},Ni.prototype.setVertexAttribPointers=function(m,v,g){for(var w=0;w<this.attributes.length;w++){var B=this.attributes[w],D=v.attributes[B.name];D!==void 0&&m.vertexAttribPointer(D,B.components,m[cn[B.type]],!1,this.itemSize,B.offset+this.itemSize*(g||0))}},Ni.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Pi=function(m){this.gl=m.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Pi.prototype.get=function(){return this.current},Pi.prototype.set=function(m){},Pi.prototype.getDefault=function(){return this.default},Pi.prototype.setDefault=function(){this.set(this.default)};var Xn=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return s.Color.transparent},v.prototype.set=function(g){var w=this.current;(g.r!==w.r||g.g!==w.g||g.b!==w.b||g.a!==w.a||this.dirty)&&(this.gl.clearColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)},v})(Pi),xi=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return 1},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.clearDepth(g),this.current=g,this.dirty=!1)},v})(Pi),wi=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return 0},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.clearStencil(g),this.current=g,this.dirty=!1)},v})(Pi),mn=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return[!0,!0,!0,!0]},v.prototype.set=function(g){var w=this.current;(g[0]!==w[0]||g[1]!==w[1]||g[2]!==w[2]||g[3]!==w[3]||this.dirty)&&(this.gl.colorMask(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)},v})(Pi),zi=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return!0},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.depthMask(g),this.current=g,this.dirty=!1)},v})(Pi),cr=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return 255},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.stencilMask(g),this.current=g,this.dirty=!1)},v})(Pi),tr=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},v.prototype.set=function(g){var w=this.current;(g.func!==w.func||g.ref!==w.ref||g.mask!==w.mask||this.dirty)&&(this.gl.stencilFunc(g.func,g.ref,g.mask),this.current=g,this.dirty=!1)},v})(Pi),xn=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){var g=this.gl;return[g.KEEP,g.KEEP,g.KEEP]},v.prototype.set=function(g){var w=this.current;(g[0]!==w[0]||g[1]!==w[1]||g[2]!==w[2]||this.dirty)&&(this.gl.stencilOp(g[0],g[1],g[2]),this.current=g,this.dirty=!1)},v})(Pi),sr=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;g?w.enable(w.STENCIL_TEST):w.disable(w.STENCIL_TEST),this.current=g,this.dirty=!1}},v})(Pi),qn=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return[0,1]},v.prototype.set=function(g){var w=this.current;(g[0]!==w[0]||g[1]!==w[1]||this.dirty)&&(this.gl.depthRange(g[0],g[1]),this.current=g,this.dirty=!1)},v})(Pi),Bn=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;g?w.enable(w.DEPTH_TEST):w.disable(w.DEPTH_TEST),this.current=g,this.dirty=!1}},v})(Pi),er=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.LESS},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.depthFunc(g),this.current=g,this.dirty=!1)},v})(Pi),Ke=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;g?w.enable(w.BLEND):w.disable(w.BLEND),this.current=g,this.dirty=!1}},v})(Pi),bi=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){var g=this.gl;return[g.ONE,g.ZERO]},v.prototype.set=function(g){var w=this.current;(g[0]!==w[0]||g[1]!==w[1]||this.dirty)&&(this.gl.blendFunc(g[0],g[1]),this.current=g,this.dirty=!1)},v})(Pi),Oi=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return s.Color.transparent},v.prototype.set=function(g){var w=this.current;(g.r!==w.r||g.g!==w.g||g.b!==w.b||g.a!==w.a||this.dirty)&&(this.gl.blendColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)},v})(Pi),on=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.FUNC_ADD},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.blendEquation(g),this.current=g,this.dirty=!1)},v})(Pi),Ar=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;g?w.enable(w.CULL_FACE):w.disable(w.CULL_FACE),this.current=g,this.dirty=!1}},v})(Pi),Lt=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.BACK},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.cullFace(g),this.current=g,this.dirty=!1)},v})(Pi),je=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.CCW},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.frontFace(g),this.current=g,this.dirty=!1)},v})(Pi),$e=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)},v})(Pi),di=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.TEXTURE0},v.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.activeTexture(g),this.current=g,this.dirty=!1)},v})(Pi),oe=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){var g=this.gl;return[0,0,g.drawingBufferWidth,g.drawingBufferHeight]},v.prototype.set=function(g){var w=this.current;(g[0]!==w[0]||g[1]!==w[1]||g[2]!==w[2]||g[3]!==w[3]||this.dirty)&&(this.gl.viewport(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)},v})(Pi),Fe=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;w.bindFramebuffer(w.FRAMEBUFFER,g),this.current=g,this.dirty=!1}},v})(Pi),vt=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;w.bindRenderbuffer(w.RENDERBUFFER,g),this.current=g,this.dirty=!1}},v})(Pi),qe=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;w.bindTexture(w.TEXTURE_2D,g),this.current=g,this.dirty=!1}},v})(Pi),Ce=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;w.bindBuffer(w.ARRAY_BUFFER,g),this.current=g,this.dirty=!1}},v})(Pi),q=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(g){var w=this.gl;w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,g),this.current=g,this.dirty=!1},v})(Pi),Ee=(function(m){function v(g){m.call(this,g),this.vao=g.extVertexArrayObject}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(g){this.vao&&(g!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(g),this.current=g,this.dirty=!1)},v})(Pi),Me=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return 4},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;w.pixelStorei(w.UNPACK_ALIGNMENT,g),this.current=g,this.dirty=!1}},v})(Pi),St=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,g),this.current=g,this.dirty=!1}},v})(Pi),ee=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(g){if(g!==this.current||this.dirty){var w=this.gl;w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,g),this.current=g,this.dirty=!1}},v})(Pi),Ae=(function(m){function v(g,w){m.call(this,g),this.context=g,this.parent=w}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v})(Pi),Q=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.setDirty=function(){this.dirty=!0},v.prototype.set=function(g){if(g!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var w=this.gl;w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_2D,g,0),this.current=g,this.dirty=!1}},v})(Ae),it=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.set=function(g){if(g!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var w=this.gl;w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,g),this.current=g,this.dirty=!1}},v})(Ae),ut=function(m,v,g,w){this.context=m,this.width=v,this.height=g;var B=this.framebuffer=m.gl.createFramebuffer();this.colorAttachment=new Q(m,B),w&&(this.depthAttachment=new it(m,B))};ut.prototype.destroy=function(){var m=this.context.gl,v=this.colorAttachment.get();if(v&&m.deleteTexture(v),this.depthAttachment){var g=this.depthAttachment.get();g&&m.deleteRenderbuffer(g)}m.deleteFramebuffer(this.framebuffer)};var xt=function(m,v,g){this.func=m,this.mask=v,this.range=g};xt.ReadOnly=!1,xt.ReadWrite=!0,xt.disabled=new xt(519,xt.ReadOnly,[0,1]);var Nt=function(m,v,g,w,B,D){this.test=m,this.ref=v,this.mask=g,this.fail=w,this.depthFail=B,this.pass=D};Nt.disabled=new Nt({func:519,mask:0},0,0,7680,7680,7680);var mt=function(m,v,g){this.blendFunction=m,this.blendColor=v,this.mask=g};mt.disabled=new mt(mt.Replace=[1,0],s.Color.transparent,[!1,!1,!1,!1]),mt.unblended=new mt(mt.Replace,s.Color.transparent,[!0,!0,!0,!0]),mt.alphaBlended=new mt([1,771],s.Color.transparent,[!0,!0,!0,!0]);var wt=function(m,v,g){this.enable=m,this.mode=v,this.frontFace=g};wt.disabled=new wt(!1,1029,2305),wt.backCCW=new wt(!0,1029,2305);var lt=function(m){this.gl=m,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Xn(this),this.clearDepth=new xi(this),this.clearStencil=new wi(this),this.colorMask=new mn(this),this.depthMask=new zi(this),this.stencilMask=new cr(this),this.stencilFunc=new tr(this),this.stencilOp=new xn(this),this.stencilTest=new sr(this),this.depthRange=new qn(this),this.depthTest=new Bn(this),this.depthFunc=new er(this),this.blend=new Ke(this),this.blendFunc=new bi(this),this.blendColor=new Oi(this),this.blendEquation=new on(this),this.cullFace=new Ar(this),this.cullFaceSide=new Lt(this),this.frontFace=new je(this),this.program=new $e(this),this.activeTexture=new di(this),this.viewport=new oe(this),this.bindFramebuffer=new Fe(this),this.bindRenderbuffer=new vt(this),this.bindTexture=new qe(this),this.bindVertexBuffer=new Ce(this),this.bindElementBuffer=new q(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ee(this),this.pixelStoreUnpack=new Me(this),this.pixelStoreUnpackPremultiplyAlpha=new St(this),this.pixelStoreUnpackFlipY=new ee(this),this.extTextureFilterAnisotropic=m.getExtension("EXT_texture_filter_anisotropic")||m.getExtension("MOZ_EXT_texture_filter_anisotropic")||m.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=m.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=m.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(m.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=m.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=m.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=m.getParameter(m.MAX_TEXTURE_SIZE)};lt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},lt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},lt.prototype.createIndexBuffer=function(m,v){return new yi(this,m,v)},lt.prototype.createVertexBuffer=function(m,v,g){return new Ni(this,m,v,g)},lt.prototype.createRenderbuffer=function(m,v,g){var w=this.gl,B=w.createRenderbuffer();return this.bindRenderbuffer.set(B),w.renderbufferStorage(w.RENDERBUFFER,m,v,g),this.bindRenderbuffer.set(null),B},lt.prototype.createFramebuffer=function(m,v,g){return new ut(this,m,v,g)},lt.prototype.clear=function(m){var v=m.color,g=m.depth,w=this.gl,B=0;v&&(B|=w.COLOR_BUFFER_BIT,this.clearColor.set(v),this.colorMask.set([!0,!0,!0,!0])),g!==void 0&&(B|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),w.clear(B)},lt.prototype.setCullFace=function(m){m.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(m.mode),this.frontFace.set(m.frontFace))},lt.prototype.setDepthMode=function(m){m.func!==this.gl.ALWAYS||m.mask?(this.depthTest.set(!0),this.depthFunc.set(m.func),this.depthMask.set(m.mask),this.depthRange.set(m.range)):this.depthTest.set(!1)},lt.prototype.setStencilMode=function(m){m.test.func!==this.gl.ALWAYS||m.mask?(this.stencilTest.set(!0),this.stencilMask.set(m.mask),this.stencilOp.set([m.fail,m.depthFail,m.pass]),this.stencilFunc.set({func:m.test.func,ref:m.ref,mask:m.test.mask})):this.stencilTest.set(!1)},lt.prototype.setColorMode=function(m){s.deepEqual(m.blendFunction,mt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(m.blendFunction),this.blendColor.set(m.blendColor)),this.colorMask.set(m.mask)},lt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var pt=(function(m){function v(g,w,B){var D=this;m.call(this),this.id=g,this.dispatcher=B,this.on("data",function(O){O.dataType==="source"&&O.sourceDataType==="metadata"&&(D._sourceLoaded=!0),D._sourceLoaded&&!D._paused&&O.dataType==="source"&&O.sourceDataType==="content"&&(D.reload(),D.transform&&D.update(D.transform))}),this.on("error",function(){D._sourceErrored=!0}),this._source=(function(O,G,J,at){var Et=new fe[G.type](O,G,J,at);if(Et.id!==O)throw new Error("Expected Source id to be "+O+" instead of "+Et.id);return s.bindAll(["load","abort","unload","serialize","prepare"],Et),Et})(g,w,B,this),this._tiles={},this._cache=new Qe(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new s.SourceFeatureState}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.onAdd=function(g){this.map=g,this._maxTileCacheSize=g?g._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(g)},v.prototype.onRemove=function(g){this._source&&this._source.onRemove&&this._source.onRemove(g)},v.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var g in this._tiles){var w=this._tiles[g];if(w.state!=="loaded"&&w.state!=="errored")return!1}return!0},v.prototype.getSource=function(){return this._source},v.prototype.pause=function(){this._paused=!0},v.prototype.resume=function(){if(this._paused){var g=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,g&&this.reload(),this.transform&&this.update(this.transform)}},v.prototype._loadTile=function(g,w){return this._source.loadTile(g,w)},v.prototype._unloadTile=function(g){if(this._source.unloadTile)return this._source.unloadTile(g,function(){})},v.prototype._abortTile=function(g){if(this._source.abortTile)return this._source.abortTile(g,function(){})},v.prototype.serialize=function(){return this._source.serialize()},v.prototype.prepare=function(g){for(var w in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var B=this._tiles[w];B.upload(g),B.prepare(this.map.style.imageManager)}},v.prototype.getIds=function(){return s.values(this._tiles).map(function(g){return g.tileID}).sort(d).map(function(g){return g.key})},v.prototype.getRenderableIds=function(g){var w=this,B=[];for(var D in this._tiles)this._isIdRenderable(D,g)&&B.push(this._tiles[D]);return g?B.sort(function(O,G){var J=O.tileID,at=G.tileID,Et=new s.Point(J.canonical.x,J.canonical.y)._rotate(w.transform.angle),Ct=new s.Point(at.canonical.x,at.canonical.y)._rotate(w.transform.angle);return J.overscaledZ-at.overscaledZ||Ct.y-Et.y||Ct.x-Et.x}).map(function(O){return O.tileID.key}):B.map(function(O){return O.tileID}).sort(d).map(function(O){return O.key})},v.prototype.hasRenderableParent=function(g){var w=this.findLoadedParent(g,0);return!!w&&this._isIdRenderable(w.tileID.key)},v.prototype._isIdRenderable=function(g,w){return this._tiles[g]&&this._tiles[g].hasData()&&!this._coveredTiles[g]&&(w||!this._tiles[g].holdingForFade())},v.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var g in this._cache.reset(),this._tiles)this._tiles[g].state!=="errored"&&this._reloadTile(g,"reloading")},v.prototype._reloadTile=function(g,w){var B=this._tiles[g];B&&(B.state!=="loading"&&(B.state=w),this._loadTile(B,this._tileLoaded.bind(this,B,g,w)))},v.prototype._tileLoaded=function(g,w,B,D){if(D)return g.state="errored",void(D.status!==404?this._source.fire(new s.ErrorEvent(D,{tile:g})):this.update(this.transform));g.timeAdded=s.browser.now(),B==="expired"&&(g.refreshedUponExpiration=!0),this._setTileReloadTimer(w,g),this.getSource().type==="raster-dem"&&g.dem&&this._backfillDEM(g),this._state.initializeTileState(g,this.map?this.map.painter:null),this._source.fire(new s.Event("data",{dataType:"source",tile:g,coord:g.tileID}))},v.prototype._backfillDEM=function(g){for(var w=this.getRenderableIds(),B=0;B<w.length;B++){var D=w[B];if(g.neighboringTiles&&g.neighboringTiles[D]){var O=this.getTileByID(D);G(g,O),G(O,g)}}function G(J,at){J.needsHillshadePrepare=!0;var Et=at.tileID.canonical.x-J.tileID.canonical.x,Ct=at.tileID.canonical.y-J.tileID.canonical.y,Bt=Math.pow(2,J.tileID.canonical.z),Wt=at.tileID.key;Et===0&&Ct===0||Math.abs(Ct)>1||(Math.abs(Et)>1&&(Math.abs(Et+Bt)===1?Et+=Bt:Math.abs(Et-Bt)===1&&(Et-=Bt)),at.dem&&J.dem&&(J.dem.backfillBorder(at.dem,Et,Ct),J.neighboringTiles&&J.neighboringTiles[Wt]&&(J.neighboringTiles[Wt].backfilled=!0)))}},v.prototype.getTile=function(g){return this.getTileByID(g.key)},v.prototype.getTileByID=function(g){return this._tiles[g]},v.prototype._retainLoadedChildren=function(g,w,B,D){for(var O in this._tiles){var G=this._tiles[O];if(!(D[O]||!G.hasData()||G.tileID.overscaledZ<=w||G.tileID.overscaledZ>B)){for(var J=G.tileID;G&&G.tileID.overscaledZ>w+1;){var at=G.tileID.scaledTo(G.tileID.overscaledZ-1);(G=this._tiles[at.key])&&G.hasData()&&(J=at)}for(var Et=J;Et.overscaledZ>w;)if(g[(Et=Et.scaledTo(Et.overscaledZ-1)).key]){D[J.key]=J;break}}}},v.prototype.findLoadedParent=function(g,w){if(g.key in this._loadedParentTiles){var B=this._loadedParentTiles[g.key];return B&&B.tileID.overscaledZ>=w?B:null}for(var D=g.overscaledZ-1;D>=w;D--){var O=g.scaledTo(D),G=this._getLoadedTile(O);if(G)return G}},v.prototype._getLoadedTile=function(g){var w=this._tiles[g.key];return w&&w.hasData()?w:this._cache.getByKey(g.wrapped().key)},v.prototype.updateCacheSize=function(g){var w=Math.ceil(g.width/this._source.tileSize)+1,B=Math.ceil(g.height/this._source.tileSize)+1,D=Math.floor(w*B*5),O=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,D):D;this._cache.setMaxSize(O)},v.prototype.handleWrapJump=function(g){var w=Math.round((g-(this._prevLng===void 0?g:this._prevLng))/360);if(this._prevLng=g,w){var B={};for(var D in this._tiles){var O=this._tiles[D];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+w),B[O.tileID.key]=O}for(var G in this._tiles=B,this._timers)clearTimeout(this._timers[G]),delete this._timers[G];for(var J in this._tiles)this._setTileReloadTimer(J,this._tiles[J])}},v.prototype.update=function(g){var w=this;if(this.transform=g,this._sourceLoaded&&!this._paused){var B;this.updateCacheSize(g),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?B=g.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(F){return new s.OverscaledTileID(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)}):(B=g.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(B=B.filter(function(F){return w._source.hasTile(F)}))):B=[];var D=g.coveringZoomLevel(this._source),O=Math.max(D-v.maxOverzooming,this._source.minzoom),G=Math.max(D+v.maxUnderzooming,this._source.minzoom),J=this._updateRetainedTiles(B,D);if(tt(this._source.type)){for(var at={},Et={},Ct=0,Bt=Object.keys(J);Ct<Bt.length;Ct+=1){var Wt=Bt[Ct],zt=J[Wt],f=this._tiles[Wt];if(f&&!(f.fadeEndTime&&f.fadeEndTime<=s.browser.now())){var h=this.findLoadedParent(zt,O);h&&(this._addTile(h.tileID),at[h.tileID.key]=h.tileID),Et[Wt]=zt}}for(var A in this._retainLoadedChildren(Et,D,G,J),at)J[A]||(this._coveredTiles[A]=!0,J[A]=at[A])}for(var b in J)this._tiles[b].clearFadeHold();for(var E=0,S=s.keysDifference(this._tiles,J);E<S.length;E+=1){var P=S[E],R=this._tiles[P];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}},v.prototype.releaseSymbolFadeTiles=function(){for(var g in this._tiles)this._tiles[g].holdingForFade()&&this._removeTile(g)},v.prototype._updateRetainedTiles=function(g,w){for(var B={},D={},O=Math.max(w-v.maxOverzooming,this._source.minzoom),G=Math.max(w+v.maxUnderzooming,this._source.minzoom),J={},at=0,Et=g;at<Et.length;at+=1){var Ct=Et[at],Bt=this._addTile(Ct);B[Ct.key]=Ct,Bt.hasData()||w<this._source.maxzoom&&(J[Ct.key]=Ct)}this._retainLoadedChildren(J,w,G,B);for(var Wt=0,zt=g;Wt<zt.length;Wt+=1){var f=zt[Wt],h=this._tiles[f.key];if(!h.hasData()){if(w+1>this._source.maxzoom){var A=f.children(this._source.maxzoom)[0],b=this.getTile(A);if(b&&b.hasData()){B[A.key]=A;continue}}else{var E=f.children(this._source.maxzoom);if(B[E[0].key]&&B[E[1].key]&&B[E[2].key]&&B[E[3].key])continue}for(var S=h.wasRequested(),P=f.overscaledZ-1;P>=O;--P){var R=f.scaledTo(P);if(D[R.key]||(D[R.key]=!0,!(h=this.getTile(R))&&S&&(h=this._addTile(R)),h&&(B[R.key]=R,S=h.wasRequested(),h.hasData())))break}}}return B},v.prototype._updateLoadedParentTileCache=function(){for(var g in this._loadedParentTiles={},this._tiles){for(var w=[],B=void 0,D=this._tiles[g].tileID;D.overscaledZ>0;){if(D.key in this._loadedParentTiles){B=this._loadedParentTiles[D.key];break}w.push(D.key);var O=D.scaledTo(D.overscaledZ-1);if(B=this._getLoadedTile(O))break;D=O}for(var G=0,J=w;G<J.length;G+=1)this._loadedParentTiles[J[G]]=B}},v.prototype._addTile=function(g){var w=this._tiles[g.key];if(w)return w;(w=this._cache.getAndRemove(g))&&(this._setTileReloadTimer(g.key,w),w.tileID=g,this._state.initializeTileState(w,this.map?this.map.painter:null),this._cacheTimers[g.key]&&(clearTimeout(this._cacheTimers[g.key]),delete this._cacheTimers[g.key],this._setTileReloadTimer(g.key,w)));var B=!!w;return B||(w=new s.Tile(g,this._source.tileSize*g.overscaleFactor()),this._loadTile(w,this._tileLoaded.bind(this,w,g.key,w.state))),w?(w.uses++,this._tiles[g.key]=w,B||this._source.fire(new s.Event("dataloading",{tile:w,coord:w.tileID,dataType:"source"})),w):null},v.prototype._setTileReloadTimer=function(g,w){var B=this;g in this._timers&&(clearTimeout(this._timers[g]),delete this._timers[g]);var D=w.getExpiryTimeout();D&&(this._timers[g]=setTimeout(function(){B._reloadTile(g,"expired"),delete B._timers[g]},D))},v.prototype._removeTile=function(g){var w=this._tiles[g];w&&(w.uses--,delete this._tiles[g],this._timers[g]&&(clearTimeout(this._timers[g]),delete this._timers[g]),w.uses>0||(w.hasData()&&w.state!=="reloading"?this._cache.add(w.tileID,w,w.getExpiryTimeout()):(w.aborted=!0,this._abortTile(w),this._unloadTile(w))))},v.prototype.clearTiles=function(){for(var g in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(g);this._cache.reset()},v.prototype.tilesIn=function(g,w,B){var D=this,O=[],G=this.transform;if(!G)return O;for(var J=B?G.getCameraQueryGeometry(g):g,at=g.map(function(P){return G.pointCoordinate(P)}),Et=J.map(function(P){return G.pointCoordinate(P)}),Ct=this.getIds(),Bt=1/0,Wt=1/0,zt=-1/0,f=-1/0,h=0,A=Et;h<A.length;h+=1){var b=A[h];Bt=Math.min(Bt,b.x),Wt=Math.min(Wt,b.y),zt=Math.max(zt,b.x),f=Math.max(f,b.y)}for(var E=function(P){var R=D._tiles[Ct[P]];if(!R.holdingForFade()){var F=R.tileID,U=Math.pow(2,G.zoom-R.tileID.overscaledZ),W=w*R.queryPadding*s.EXTENT/R.tileSize/U,ht=[F.getTilePoint(new s.MercatorCoordinate(Bt,Wt)),F.getTilePoint(new s.MercatorCoordinate(zt,f))];if(ht[0].x-W<s.EXTENT&&ht[0].y-W<s.EXTENT&&ht[1].x+W>=0&&ht[1].y+W>=0){var Pt=at.map(function(Mt){return F.getTilePoint(Mt)}),It=Et.map(function(Mt){return F.getTilePoint(Mt)});O.push({tile:R,tileID:F,queryGeometry:Pt,cameraQueryGeometry:It,scale:U})}}},S=0;S<Ct.length;S++)E(S);return O},v.prototype.getVisibleCoordinates=function(g){for(var w=this,B=this.getRenderableIds(g).map(function(J){return w._tiles[J].tileID}),D=0,O=B;D<O.length;D+=1){var G=O[D];G.posMatrix=this.transform.calculatePosMatrix(G.toUnwrapped())}return B},v.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(tt(this._source.type))for(var g in this._tiles){var w=this._tiles[g];if(w.fadeEndTime!==void 0&&w.fadeEndTime>=s.browser.now())return!0}return!1},v.prototype.setFeatureState=function(g,w,B){this._state.updateState(g=g||"_geojsonTileLayer",w,B)},v.prototype.removeFeatureState=function(g,w,B){this._state.removeFeatureState(g=g||"_geojsonTileLayer",w,B)},v.prototype.getFeatureState=function(g,w){return this._state.getState(g=g||"_geojsonTileLayer",w)},v.prototype.setDependencies=function(g,w,B){var D=this._tiles[g];D&&D.setDependencies(w,B)},v.prototype.reloadTilesForDependencies=function(g,w){for(var B in this._tiles)this._tiles[B].hasDependency(g,w)&&this._reloadTile(B,"reloading");this._cache.filter(function(D){return!D.hasDependency(g,w)})},v})(s.Evented);function d(m,v){var g=Math.abs(2*m.wrap)-+(m.wrap<0),w=Math.abs(2*v.wrap)-+(v.wrap<0);return m.overscaledZ-v.overscaledZ||w-g||v.canonical.y-m.canonical.y||v.canonical.x-m.canonical.x}function tt(m){return m==="raster"||m==="image"||m==="video"}function Pe(){return new s.window.Worker(Mo.workerUrl)}pt.maxOverzooming=10,pt.maxUnderzooming=3;var ne="mapboxgl_preloaded_worker_pool",Ie=function(){this.active={}};Ie.prototype.acquire=function(m){if(!this.workers)for(this.workers=[];this.workers.length<Ie.workerCount;)this.workers.push(new Pe);return this.active[m]=!0,this.workers.slice()},Ie.prototype.release=function(m){delete this.active[m],this.numActive()===0&&(this.workers.forEach(function(v){v.terminate()}),this.workers=null)},Ie.prototype.isPreloaded=function(){return!!this.active[ne]},Ie.prototype.numActive=function(){return Object.keys(this.active).length};var ke,Ue=Math.floor(s.browser.hardwareConcurrency/2);function ge(){return ke||(ke=new Ie),ke}function Ve(m,v){var g={};for(var w in m)w!=="ref"&&(g[w]=m[w]);return s.refProperties.forEach(function(B){B in v&&(g[B]=v[B])}),g}function De(m){m=m.slice();for(var v=Object.create(null),g=0;g<m.length;g++)v[m[g].id]=m[g];for(var w=0;w<m.length;w++)"ref"in m[w]&&(m[w]=Ve(m[w],v[m[w].ref]));return m}Ie.workerCount=Math.max(Math.min(Ue,6),1);var Ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Gi(m,v,g){g.push({command:Ze.addSource,args:[m,v[m]]})}function si(m,v,g){v.push({command:Ze.removeSource,args:[m]}),g[m]=!0}function rn(m,v,g,w){si(m,g,w),Gi(m,v,g)}function hn(m,v,g){var w;for(w in m[g])if(m[g].hasOwnProperty(w)&&w!=="data"&&!s.deepEqual(m[g][w],v[g][w]))return!1;for(w in v[g])if(v[g].hasOwnProperty(w)&&w!=="data"&&!s.deepEqual(m[g][w],v[g][w]))return!1;return!0}function Yi(m,v,g,w,B,D){var O;for(O in v=v||{},m=m||{})m.hasOwnProperty(O)&&(s.deepEqual(m[O],v[O])||g.push({command:D,args:[w,O,v[O],B]}));for(O in v)v.hasOwnProperty(O)&&!m.hasOwnProperty(O)&&(s.deepEqual(m[O],v[O])||g.push({command:D,args:[w,O,v[O],B]}))}function Ji(m){return m.id}function Hi(m,v){return m[v.id]=v,m}var mr=function(m,v){this.reset(m,v)};mr.prototype.reset=function(m,v){this.points=m||[],this._distances=[0];for(var g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(v||0,.5*this.length),this.paddedLength=this.length-2*this.padding},mr.prototype.lerp=function(m){if(this.points.length===1)return this.points[0];m=s.clamp(m,0,1);for(var v=1,g=this._distances[v],w=m*this.paddedLength+this.padding;g<w&&v<this._distances.length;)g=this._distances[++v];var B=v-1,D=this._distances[B],O=g-D,G=O>0?(w-D)/O:0;return this.points[B].mult(1-G).add(this.points[v].mult(G))};var Qi=function(m,v,g){var w=this.boxCells=[],B=this.circleCells=[];this.xCellCount=Math.ceil(m/g),this.yCellCount=Math.ceil(v/g);for(var D=0;D<this.xCellCount*this.yCellCount;D++)w.push([]),B.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=m,this.height=v,this.xScale=this.xCellCount/m,this.yScale=this.yCellCount/v,this.boxUid=0,this.circleUid=0};function mi(m,v,g,w,B){var D=s.create();return v?(s.scale(D,D,[1/B,1/B,1]),g||s.rotateZ(D,D,w.angle)):s.multiply(D,w.labelPlaneMatrix,m),D}function _t(m,v,g,w,B){if(v){var D=s.clone(m);return s.scale(D,D,[B,B,1]),g||s.rotateZ(D,D,-w.angle),D}return w.glCoordMatrix}function ti(m,v){var g=[m.x,m.y,0,1];fr(g,g,v);var w=g[3];return{point:new s.Point(g[0]/w,g[1]/w),signedDistanceFromCamera:w}}function sn(m,v){return .5+m/v*.5}function Wr(m,v){var g=m[0]/m[3],w=m[1]/m[3];return g>=-v[0]&&g<=v[0]&&w>=-v[1]&&w<=v[1]}function ga(m,v,g,w,B,D,O,G){var J=w?m.textSizeData:m.iconSizeData,at=s.evaluateSizeForZoom(J,g.transform.zoom),Et=[256/g.width*2+1,256/g.height*2+1],Ct=w?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Ct.clear();for(var Bt=m.lineVertexArray,Wt=w?m.text.placedSymbolArray:m.icon.placedSymbolArray,zt=g.transform.width/g.transform.height,f=!1,h=0;h<Wt.length;h++){var A=Wt.get(h);if(A.hidden||A.writingMode===s.WritingMode.vertical&&!f)Lr(A.numGlyphs,Ct);else{f=!1;var b=[A.anchorX,A.anchorY,0,1];if(s.transformMat4(b,b,v),Wr(b,Et)){var E=sn(g.transform.cameraToCenterDistance,b[3]),S=s.evaluateSizeForFeature(J,at,A),P=O?S/E:S*E,R=new s.Point(A.anchorX,A.anchorY),F=ti(R,B).point,U={},W=gt(A,P,!1,G,v,B,D,m.glyphOffsetArray,Bt,Ct,F,R,U,zt);f=W.useVertical,(W.notEnoughRoom||f||W.needsFlipping&&gt(A,P,!0,G,v,B,D,m.glyphOffsetArray,Bt,Ct,F,R,U,zt).notEnoughRoom)&&Lr(A.numGlyphs,Ct)}else Lr(A.numGlyphs,Ct)}}w?m.text.dynamicLayoutVertexBuffer.updateData(Ct):m.icon.dynamicLayoutVertexBuffer.updateData(Ct)}function hr(m,v,g,w,B,D,O,G,J,at,Et){var Ct=G.glyphStartIndex+G.numGlyphs,Bt=G.lineStartIndex,Wt=G.lineStartIndex+G.lineLength,zt=v.getoffsetX(G.glyphStartIndex),f=v.getoffsetX(Ct-1),h=Zn(m*zt,g,w,B,D,O,G.segment,Bt,Wt,J,at,Et);if(!h)return null;var A=Zn(m*f,g,w,B,D,O,G.segment,Bt,Wt,J,at,Et);return A?{first:h,last:A}:null}function Kn(m,v,g,w){return m===s.WritingMode.horizontal&&Math.abs(g.y-v.y)>Math.abs(g.x-v.x)*w?{useVertical:!0}:(m===s.WritingMode.vertical?v.y<g.y:v.x>g.x)?{needsFlipping:!0}:null}function gt(m,v,g,w,B,D,O,G,J,at,Et,Ct,Bt,Wt){var zt,f=v/24,h=m.lineOffsetX*f,A=m.lineOffsetY*f;if(m.numGlyphs>1){var b=m.glyphStartIndex+m.numGlyphs,E=m.lineStartIndex,S=m.lineStartIndex+m.lineLength,P=hr(f,G,h,A,g,Et,Ct,m,J,D,Bt);if(!P)return{notEnoughRoom:!0};var R=ti(P.first.point,O).point,F=ti(P.last.point,O).point;if(w&&!g){var U=Kn(m.writingMode,R,F,Wt);if(U)return U}zt=[P.first];for(var W=m.glyphStartIndex+1;W<b-1;W++)zt.push(Zn(f*G.getoffsetX(W),h,A,g,Et,Ct,m.segment,E,S,J,D,Bt));zt.push(P.last)}else{if(w&&!g){var ht=ti(Ct,B).point,Pt=m.lineStartIndex+m.segment+1,It=new s.Point(J.getx(Pt),J.gety(Pt)),Mt=ti(It,B),Yt=Mt.signedDistanceFromCamera>0?Mt.point:Qo(Ct,It,ht,1,B),Ht=Kn(m.writingMode,ht,Yt,Wt);if(Ht)return Ht}var ie=Zn(f*G.getoffsetX(m.glyphStartIndex),h,A,g,Et,Ct,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,J,D,Bt);if(!ie)return{notEnoughRoom:!0};zt=[ie]}for(var te=0,Jt=zt;te<Jt.length;te+=1){var qt=Jt[te];s.addDynamicAttributes(at,qt.point,qt.angle)}return{}}function Qo(m,v,g,w,B){var D=ti(m.add(m.sub(v)._unit()),B).point,O=g.sub(D);return g.add(O._mult(w/O.mag()))}function Zn(m,v,g,w,B,D,O,G,J,at,Et,Ct){var Bt=w?m-v:m+v,Wt=Bt>0?1:-1,zt=0;w&&(Wt*=-1,zt=Math.PI),Wt<0&&(zt+=Math.PI);for(var f=Wt>0?G+O:G+O+1,h=B,A=B,b=0,E=0,S=Math.abs(Bt),P=[];b+E<=S;){if((f+=Wt)<G||f>=J)return null;if(A=h,P.push(h),(h=Ct[f])===void 0){var R=new s.Point(at.getx(f),at.gety(f)),F=ti(R,Et);if(F.signedDistanceFromCamera>0)h=Ct[f]=F.point;else{var U=f-Wt;h=Qo(b===0?D:new s.Point(at.getx(U),at.gety(U)),R,A,S-b+1,Et)}}b+=E,E=A.dist(h)}var W=(S-b)/E,ht=h.sub(A),Pt=ht.mult(W)._add(A);Pt._add(ht._unit()._perp()._mult(g*Wt));var It=zt+Math.atan2(h.y-A.y,h.x-A.x);return P.push(Pt),{point:Pt,angle:It,path:P}}Qi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qi.prototype.insert=function(m,v,g,w,B){this._forEachCell(v,g,w,B,this._insertBoxCell,this.boxUid++),this.boxKeys.push(m),this.bboxes.push(v),this.bboxes.push(g),this.bboxes.push(w),this.bboxes.push(B)},Qi.prototype.insertCircle=function(m,v,g,w){this._forEachCell(v-w,g-w,v+w,g+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(m),this.circles.push(v),this.circles.push(g),this.circles.push(w)},Qi.prototype._insertBoxCell=function(m,v,g,w,B,D){this.boxCells[B].push(D)},Qi.prototype._insertCircleCell=function(m,v,g,w,B,D){this.circleCells[B].push(D)},Qi.prototype._query=function(m,v,g,w,B,D){if(g<0||m>this.width||w<0||v>this.height)return!B&&[];var O=[];if(m<=0&&v<=0&&this.width<=g&&this.height<=w){if(B)return!0;for(var G=0;G<this.boxKeys.length;G++)O.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(var J=0;J<this.circleKeys.length;J++){var at=this.circles[3*J],Et=this.circles[3*J+1],Ct=this.circles[3*J+2];O.push({key:this.circleKeys[J],x1:at-Ct,y1:Et-Ct,x2:at+Ct,y2:Et+Ct})}return D?O.filter(D):O}return this._forEachCell(m,v,g,w,this._queryCell,O,{hitTest:B,seenUids:{box:{},circle:{}}},D),B?O.length>0:O},Qi.prototype._queryCircle=function(m,v,g,w,B){var D=m-g,O=m+g,G=v-g,J=v+g;if(O<0||D>this.width||J<0||G>this.height)return!w&&[];var at=[];return this._forEachCell(D,G,O,J,this._queryCellCircle,at,{hitTest:w,circle:{x:m,y:v,radius:g},seenUids:{box:{},circle:{}}},B),w?at.length>0:at},Qi.prototype.query=function(m,v,g,w,B){return this._query(m,v,g,w,!1,B)},Qi.prototype.hitTest=function(m,v,g,w,B){return this._query(m,v,g,w,!0,B)},Qi.prototype.hitTestCircle=function(m,v,g,w){return this._queryCircle(m,v,g,!0,w)},Qi.prototype._queryCell=function(m,v,g,w,B,D,O,G){var J=O.seenUids,at=this.boxCells[B];if(at!==null)for(var Et=this.bboxes,Ct=0,Bt=at;Ct<Bt.length;Ct+=1){var Wt=Bt[Ct];if(!J.box[Wt]){J.box[Wt]=!0;var zt=4*Wt;if(m<=Et[zt+2]&&v<=Et[zt+3]&&g>=Et[zt+0]&&w>=Et[zt+1]&&(!G||G(this.boxKeys[Wt]))){if(O.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[Wt],x1:Et[zt],y1:Et[zt+1],x2:Et[zt+2],y2:Et[zt+3]})}}}var f=this.circleCells[B];if(f!==null)for(var h=this.circles,A=0,b=f;A<b.length;A+=1){var E=b[A];if(!J.circle[E]){J.circle[E]=!0;var S=3*E;if(this._circleAndRectCollide(h[S],h[S+1],h[S+2],m,v,g,w)&&(!G||G(this.circleKeys[E]))){if(O.hitTest)return D.push(!0),!0;var P=h[S],R=h[S+1],F=h[S+2];D.push({key:this.circleKeys[E],x1:P-F,y1:R-F,x2:P+F,y2:R+F})}}}},Qi.prototype._queryCellCircle=function(m,v,g,w,B,D,O,G){var J=O.circle,at=O.seenUids,Et=this.boxCells[B];if(Et!==null)for(var Ct=this.bboxes,Bt=0,Wt=Et;Bt<Wt.length;Bt+=1){var zt=Wt[Bt];if(!at.box[zt]){at.box[zt]=!0;var f=4*zt;if(this._circleAndRectCollide(J.x,J.y,J.radius,Ct[f+0],Ct[f+1],Ct[f+2],Ct[f+3])&&(!G||G(this.boxKeys[zt])))return D.push(!0),!0}}var h=this.circleCells[B];if(h!==null)for(var A=this.circles,b=0,E=h;b<E.length;b+=1){var S=E[b];if(!at.circle[S]){at.circle[S]=!0;var P=3*S;if(this._circlesCollide(A[P],A[P+1],A[P+2],J.x,J.y,J.radius)&&(!G||G(this.circleKeys[S])))return D.push(!0),!0}}},Qi.prototype._forEachCell=function(m,v,g,w,B,D,O,G){for(var J=this._convertToXCellCoord(m),at=this._convertToYCellCoord(v),Et=this._convertToXCellCoord(g),Ct=this._convertToYCellCoord(w),Bt=J;Bt<=Et;Bt++)for(var Wt=at;Wt<=Ct;Wt++)if(B.call(this,m,v,g,w,this.xCellCount*Wt+Bt,D,O,G))return},Qi.prototype._convertToXCellCoord=function(m){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(m*this.xScale)))},Qi.prototype._convertToYCellCoord=function(m){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(m*this.yScale)))},Qi.prototype._circlesCollide=function(m,v,g,w,B,D){var O=w-m,G=B-v,J=g+D;return J*J>O*O+G*G},Qi.prototype._circleAndRectCollide=function(m,v,g,w,B,D,O){var G=(D-w)/2,J=Math.abs(m-(w+G));if(J>G+g)return!1;var at=(O-B)/2,Et=Math.abs(v-(B+at));if(Et>at+g)return!1;if(J<=G||Et<=at)return!0;var Ct=J-G,Bt=Et-at;return Ct*Ct+Bt*Bt<=g*g};var Jo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Lr(m,v){for(var g=0;g<m;g++){var w=v.length;v.resize(w+4),v.float32.set(Jo,3*w)}}function fr(m,v,g){var w=v[0],B=v[1];return m[0]=g[0]*w+g[4]*B+g[12],m[1]=g[1]*w+g[5]*B+g[13],m[3]=g[3]*w+g[7]*B+g[15],m}var Tr=function(m,v,g){v===void 0&&(v=new Qi(m.width+200,m.height+200,25)),g===void 0&&(g=new Qi(m.width+200,m.height+200,25)),this.transform=m,this.grid=v,this.ignoredGrid=g,this.pitchfactor=Math.cos(m._pitch)*m.cameraToCenterDistance,this.screenRightBoundary=m.width+100,this.screenBottomBoundary=m.height+100,this.gridRightBoundary=m.width+200,this.gridBottomBoundary=m.height+200};function Fn(m,v,g){return v*(s.EXTENT/(m.tileSize*Math.pow(2,g-m.tileID.overscaledZ)))}Tr.prototype.placeCollisionBox=function(m,v,g,w,B){var D=this.projectAndGetPerspectiveRatio(w,m.anchorPointX,m.anchorPointY),O=g*D.perspectiveRatio,G=m.x1*O+D.point.x,J=m.y1*O+D.point.y,at=m.x2*O+D.point.x,Et=m.y2*O+D.point.y;return!this.isInsideGrid(G,J,at,Et)||!v&&this.grid.hitTest(G,J,at,Et,B)?{box:[],offscreen:!1}:{box:[G,J,at,Et],offscreen:this.isOffscreen(G,J,at,Et)}},Tr.prototype.placeCollisionCircles=function(m,v,g,w,B,D,O,G,J,at,Et,Ct,Bt){var Wt=[],zt=new s.Point(v.anchorX,v.anchorY),f=ti(zt,D),h=sn(this.transform.cameraToCenterDistance,f.signedDistanceFromCamera),A=(at?B/h:B*h)/s.ONE_EM,b=ti(zt,O).point,E=hr(A,w,v.lineOffsetX*A,v.lineOffsetY*A,!1,b,zt,v,g,O,{}),S=!1,P=!1,R=!0;if(E){for(var F=.5*Ct*h+Bt,U=new s.Point(-100,-100),W=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),ht=new mr,Pt=E.first,It=E.last,Mt=[],Yt=Pt.path.length-1;Yt>=1;Yt--)Mt.push(Pt.path[Yt]);for(var Ht=1;Ht<It.path.length;Ht++)Mt.push(It.path[Ht]);var ie=2.5*F;if(G){var te=Mt.map(function(Ys){return ti(Ys,G)});Mt=te.some(function(Ys){return Ys.signedDistanceFromCamera<=0})?[]:te.map(function(Ys){return Ys.point})}var Jt=[];if(Mt.length>0){for(var qt=Mt[0].clone(),Be=Mt[0].clone(),Ge=1;Ge<Mt.length;Ge++)qt.x=Math.min(qt.x,Mt[Ge].x),qt.y=Math.min(qt.y,Mt[Ge].y),Be.x=Math.max(Be.x,Mt[Ge].x),Be.y=Math.max(Be.y,Mt[Ge].y);Jt=qt.x>=U.x&&Be.x<=W.x&&qt.y>=U.y&&Be.y<=W.y?[Mt]:Be.x<U.x||qt.x>W.x||Be.y<U.y||qt.y>W.y?[]:s.clipLine([Mt],U.x,U.y,W.x,W.y)}for(var ze=0,Ri=Jt;ze<Ri.length;ze+=1){var Ci;ht.reset(Ri[ze],.25*F),Ci=ht.length<=.5*F?1:Math.ceil(ht.paddedLength/ie)+1;for(var ji=0;ji<Ci;ji++){var Ti=ji/Math.max(Ci-1,1),ai=ht.lerp(Ti),We=ai.x+100,Wi=ai.y+100;Wt.push(We,Wi,F,0);var fn=We-F,Zi=Wi-F,gn=We+F,or=Wi+F;if(R=R&&this.isOffscreen(fn,Zi,gn,or),P=P||this.isInsideGrid(fn,Zi,gn,or),!m&&this.grid.hitTestCircle(We,Wi,F,Et)&&(S=!0,!J))return{circles:[],offscreen:!1,collisionDetected:S}}}}return{circles:!J&&S||!P?[]:Wt,offscreen:R,collisionDetected:S}},Tr.prototype.queryRenderedSymbols=function(m){if(m.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var v=[],g=1/0,w=1/0,B=-1/0,D=-1/0,O=0,G=m;O<G.length;O+=1){var J=G[O],at=new s.Point(J.x+100,J.y+100);g=Math.min(g,at.x),w=Math.min(w,at.y),B=Math.max(B,at.x),D=Math.max(D,at.y),v.push(at)}for(var Et={},Ct={},Bt=0,Wt=this.grid.query(g,w,B,D).concat(this.ignoredGrid.query(g,w,B,D));Bt<Wt.length;Bt+=1){var zt=Wt[Bt],f=zt.key;if(Et[f.bucketInstanceId]===void 0&&(Et[f.bucketInstanceId]={}),!Et[f.bucketInstanceId][f.featureIndex]){var h=[new s.Point(zt.x1,zt.y1),new s.Point(zt.x2,zt.y1),new s.Point(zt.x2,zt.y2),new s.Point(zt.x1,zt.y2)];s.polygonIntersectsPolygon(v,h)&&(Et[f.bucketInstanceId][f.featureIndex]=!0,Ct[f.bucketInstanceId]===void 0&&(Ct[f.bucketInstanceId]=[]),Ct[f.bucketInstanceId].push(f.featureIndex))}}return Ct},Tr.prototype.insertCollisionBox=function(m,v,g,w,B){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:w,collisionGroupID:B},m[0],m[1],m[2],m[3])},Tr.prototype.insertCollisionCircles=function(m,v,g,w,B){for(var D=v?this.ignoredGrid:this.grid,O={bucketInstanceId:g,featureIndex:w,collisionGroupID:B},G=0;G<m.length;G+=4)D.insertCircle(O,m[G],m[G+1],m[G+2])},Tr.prototype.projectAndGetPerspectiveRatio=function(m,v,g){var w=[v,g,0,1];return fr(w,w,m),{point:new s.Point((w[0]/w[3]+1)/2*this.transform.width+100,(-w[1]/w[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w[3]*.5}},Tr.prototype.isOffscreen=function(m,v,g,w){return g<100||m>=this.screenRightBoundary||w<100||v>this.screenBottomBoundary},Tr.prototype.isInsideGrid=function(m,v,g,w){return g>=0&&m<this.gridRightBoundary&&w>=0&&v<this.gridBottomBoundary},Tr.prototype.getViewportMatrix=function(){var m=s.identity([]);return s.translate(m,m,[-100,-100,0]),m};var gs=function(m,v,g,w){this.opacity=m?Math.max(0,Math.min(1,m.opacity+(m.placed?v:-v))):w&&g?1:0,this.placed=g};gs.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Hr=function(m,v,g,w,B){this.text=new gs(m?m.text:null,v,g,B),this.icon=new gs(m?m.icon:null,v,w,B)};Hr.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ms=function(m,v,g){this.text=m,this.icon=v,this.skipFade=g},Ln=function(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]},ah=function(m,v,g,w,B){this.bucketInstanceId=m,this.featureIndex=v,this.sourceLayerIndex=g,this.bucketIndex=w,this.tileID=B},yt=function(m){this.crossSourceCollisions=m,this.maxGroupID=0,this.collisionGroups={}};function Dt(m,v,g,w,B){var D=s.getAnchorAlignment(m),O=-(D.horizontalAlign-.5)*v,G=-(D.verticalAlign-.5)*g,J=s.evaluateVariableOffset(m,w);return new s.Point(O+J[0]*B,G+J[1]*B)}function $t(m,v,g,w,B,D){var O=m.x1,G=m.x2,J=m.y1,at=m.y2,Et=m.anchorPointX,Ct=m.anchorPointY,Bt=new s.Point(v,g);return w&&Bt._rotate(B?D:-D),{x1:O+Bt.x,y1:J+Bt.y,x2:G+Bt.x,y2:at+Bt.y,anchorPointX:Et,anchorPointY:Ct}}yt.prototype.get=function(m){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[m]){var v=++this.maxGroupID;this.collisionGroups[m]={ID:v,predicate:function(g){return g.collisionGroupID===v}}}return this.collisionGroups[m]};var Se=function(m,v,g,w){this.transform=m.clone(),this.collisionIndex=new Tr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new yt(g),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}};function Ye(m,v,g,w,B){m.emplaceBack(v?1:0,g?1:0,w||0,B||0),m.emplaceBack(v?1:0,g?1:0,w||0,B||0),m.emplaceBack(v?1:0,g?1:0,w||0,B||0),m.emplaceBack(v?1:0,g?1:0,w||0,B||0)}Se.prototype.getBucketParts=function(m,v,g,w){var B=g.getBucket(v),D=g.latestFeatureIndex;if(B&&D&&v.id===B.layerIds[0]){var O=g.collisionBoxArray,G=B.layers[0].layout,J=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),at=g.tileSize/s.EXTENT,Et=this.transform.calculatePosMatrix(g.tileID.toUnwrapped()),Ct=G.get("text-pitch-alignment")==="map",Bt=G.get("text-rotation-alignment")==="map",Wt=Fn(g,1,this.transform.zoom),zt=mi(Et,Ct,Bt,this.transform,Wt),f=null;if(Ct){var h=_t(Et,Ct,Bt,this.transform,Wt);f=s.multiply([],this.transform.labelPlaneMatrix,h)}this.retainedQueryData[B.bucketInstanceId]=new ah(B.bucketInstanceId,D,B.sourceLayerIndex,B.index,g.tileID);var A={bucket:B,layout:G,posMatrix:Et,textLabelPlaneMatrix:zt,labelToScreenMatrix:f,scale:J,textPixelRatio:at,holdingForFade:g.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(B.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(B.sourceID)};if(w)for(var b=0,E=B.sortKeyRanges;b<E.length;b+=1){var S=E[b];m.push({sortKey:S.sortKey,symbolInstanceStart:S.symbolInstanceStart,symbolInstanceEnd:S.symbolInstanceEnd,parameters:A})}else m.push({symbolInstanceStart:0,symbolInstanceEnd:B.symbolInstances.length,parameters:A})}},Se.prototype.attemptAnchorPlacement=function(m,v,g,w,B,D,O,G,J,at,Et,Ct,Bt,Wt,zt){var f,h=[Ct.textOffset0,Ct.textOffset1],A=Dt(m,g,w,h,B),b=this.collisionIndex.placeCollisionBox($t(v,A.x,A.y,D,O,this.transform.angle),Et,G,J,at.predicate);if(!zt||this.collisionIndex.placeCollisionBox($t(zt,A.x,A.y,D,O,this.transform.angle),Et,G,J,at.predicate).box.length!==0)return b.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Ct.crossTileID]&&this.prevPlacement.placements[Ct.crossTileID]&&this.prevPlacement.placements[Ct.crossTileID].text&&(f=this.prevPlacement.variableOffsets[Ct.crossTileID].anchor),this.variableOffsets[Ct.crossTileID]={textOffset:h,width:g,height:w,anchor:m,textBoxScale:B,prevAnchor:f},this.markUsedJustification(Bt,m,Ct,Wt),Bt.allowVerticalPlacement&&(this.markUsedOrientation(Bt,Wt,Ct),this.placedOrientations[Ct.crossTileID]=Wt),{shift:A,placedGlyphBoxes:b}):void 0},Se.prototype.placeLayerBucketPart=function(m,v,g){var w=this,B=m.parameters,D=B.bucket,O=B.layout,G=B.posMatrix,J=B.textLabelPlaneMatrix,at=B.labelToScreenMatrix,Et=B.textPixelRatio,Ct=B.holdingForFade,Bt=B.collisionBoxArray,Wt=B.partiallyEvaluatedTextSize,zt=B.collisionGroup,f=O.get("text-optional"),h=O.get("icon-optional"),A=O.get("text-allow-overlap"),b=O.get("icon-allow-overlap"),E=O.get("text-rotation-alignment")==="map",S=O.get("text-pitch-alignment")==="map",P=O.get("icon-text-fit")!=="none",R=O.get("symbol-z-order")==="viewport-y",F=A&&(b||!D.hasIconData()||h),U=b&&(A||!D.hasTextData()||f);!D.collisionArrays&&Bt&&D.deserializeCollisionBoxes(Bt);var W=function(Ht,ie){if(!v[Ht.crossTileID])if(Ct)w.placements[Ht.crossTileID]=new Ms(!1,!1,!1);else{var te,Jt=!1,qt=!1,Be=!0,Ge=null,ze={box:null,offscreen:null},Ri={box:null,offscreen:null},Ci=null,ji=null,Ti=0,ai=0,We=0;ie.textFeatureIndex?Ti=ie.textFeatureIndex:Ht.useRuntimeCollisionCircles&&(Ti=Ht.featureIndex),ie.verticalTextFeatureIndex&&(ai=ie.verticalTextFeatureIndex);var Wi=ie.textBox;if(Wi){var fn=function(Mn){var Bo=s.WritingMode.horizontal;if(D.allowVerticalPlacement&&!Mn&&w.prevPlacement){var Qs=w.prevPlacement.placedOrientations[Ht.crossTileID];Qs&&(w.placedOrientations[Ht.crossTileID]=Qs,w.markUsedOrientation(D,Bo=Qs,Ht))}return Bo},Zi=function(Mn,Bo){if(D.allowVerticalPlacement&&Ht.numVerticalGlyphVertices>0&&ie.verticalTextBox)for(var Qs=0,Bu=D.writingModes;Qs<Bu.length&&(Bu[Qs]===s.WritingMode.vertical?(ze=Bo(),Ri=ze):ze=Mn(),!(ze&&ze.box&&ze.box.length));Qs+=1);else ze=Mn()};if(O.get("text-variable-anchor")){var gn=O.get("text-variable-anchor");if(w.prevPlacement&&w.prevPlacement.variableOffsets[Ht.crossTileID]){var or=w.prevPlacement.variableOffsets[Ht.crossTileID];gn.indexOf(or.anchor)>0&&(gn=gn.filter(function(Mn){return Mn!==or.anchor})).unshift(or.anchor)}var Ys=function(Mn,Bo,Qs){for(var Bu=Mn.x2-Mn.x1,Tv=Mn.y2-Mn.y1,Gf=Ht.textBoxScale,Sv=P&&!b?Bo:null,Ch={box:[],offscreen:!1},Bm=A?2*gn.length:gn.length,Pc=0;Pc<Bm;++Pc){var jf=w.attemptAnchorPlacement(gn[Pc%gn.length],Mn,Bu,Tv,Gf,E,S,Et,G,zt,Pc>=gn.length,Ht,D,Qs,Sv);if(jf&&(Ch=jf.placedGlyphBoxes)&&Ch.box&&Ch.box.length){Jt=!0,Ge=jf.shift;break}}return Ch};Zi(function(){return Ys(Wi,ie.iconBox,s.WritingMode.horizontal)},function(){var Mn=ie.verticalTextBox;return D.allowVerticalPlacement&&!(ze&&ze.box&&ze.box.length)&&Ht.numVerticalGlyphVertices>0&&Mn?Ys(Mn,ie.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),ze&&(Jt=ze.box,Be=ze.offscreen);var xh=fn(ze&&ze.box);if(!Jt&&w.prevPlacement){var Tc=w.prevPlacement.variableOffsets[Ht.crossTileID];Tc&&(w.variableOffsets[Ht.crossTileID]=Tc,w.markUsedJustification(D,Tc.anchor,Ht,xh))}}else{var Vl=function(Mn,Bo){var Qs=w.collisionIndex.placeCollisionBox(Mn,A,Et,G,zt.predicate);return Qs&&Qs.box&&Qs.box.length&&(w.markUsedOrientation(D,Bo,Ht),w.placedOrientations[Ht.crossTileID]=Bo),Qs};Zi(function(){return Vl(Wi,s.WritingMode.horizontal)},function(){var Mn=ie.verticalTextBox;return D.allowVerticalPlacement&&Ht.numVerticalGlyphVertices>0&&Mn?Vl(Mn,s.WritingMode.vertical):{box:null,offscreen:null}}),fn(ze&&ze.box&&ze.box.length)}}if(Jt=(te=ze)&&te.box&&te.box.length>0,Be=te&&te.offscreen,Ht.useRuntimeCollisionCircles){var Sc=D.text.placedSymbolArray.get(Ht.centerJustifiedTextSymbolIndex),wh=s.evaluateSizeForFeature(D.textSizeData,Wt,Sc),Ta=O.get("text-padding");Ci=w.collisionIndex.placeCollisionCircles(A,Sc,D.lineVertexArray,D.glyphOffsetArray,wh,G,J,at,g,S,zt.predicate,Ht.collisionCircleDiameter,Ta),Jt=A||Ci.circles.length>0&&!Ci.collisionDetected,Be=Be&&Ci.offscreen}if(ie.iconFeatureIndex&&(We=ie.iconFeatureIndex),ie.iconBox){var Eh=function(Mn){var Bo=P&&Ge?$t(Mn,Ge.x,Ge.y,E,S,w.transform.angle):Mn;return w.collisionIndex.placeCollisionBox(Bo,b,Et,G,zt.predicate)};qt=Ri&&Ri.box&&Ri.box.length&&ie.verticalIconBox?(ji=Eh(ie.verticalIconBox)).box.length>0:(ji=Eh(ie.iconBox)).box.length>0,Be=Be&&ji.offscreen}var Sa=f||Ht.numHorizontalGlyphVertices===0&&Ht.numVerticalGlyphVertices===0,Zr=h||Ht.numIconVertices===0;if(Sa||Zr?Zr?Sa||(qt=qt&&Jt):Jt=qt&&Jt:qt=Jt=qt&&Jt,Jt&&te&&te.box&&w.collisionIndex.insertCollisionBox(te.box,O.get("text-ignore-placement"),D.bucketInstanceId,Ri&&Ri.box&&ai?ai:Ti,zt.ID),qt&&ji&&w.collisionIndex.insertCollisionBox(ji.box,O.get("icon-ignore-placement"),D.bucketInstanceId,We,zt.ID),Ci&&(Jt&&w.collisionIndex.insertCollisionCircles(Ci.circles,O.get("text-ignore-placement"),D.bucketInstanceId,Ti,zt.ID),g)){var $a=D.bucketInstanceId,Gl=w.collisionCircleArrays[$a];Gl===void 0&&(Gl=w.collisionCircleArrays[$a]=new Ln);for(var Mu=0;Mu<Ci.circles.length;Mu+=4)Gl.circles.push(Ci.circles[Mu+0]),Gl.circles.push(Ci.circles[Mu+1]),Gl.circles.push(Ci.circles[Mu+2]),Gl.circles.push(Ci.collisionDetected?1:0)}w.placements[Ht.crossTileID]=new Ms(Jt||F,qt||U,Be||D.justReloaded),v[Ht.crossTileID]=!0}};if(R)for(var ht=D.getSortedSymbolIndexes(this.transform.angle),Pt=ht.length-1;Pt>=0;--Pt){var It=ht[Pt];W(D.symbolInstances.get(It),D.collisionArrays[It])}else for(var Mt=m.symbolInstanceStart;Mt<m.symbolInstanceEnd;Mt++)W(D.symbolInstances.get(Mt),D.collisionArrays[Mt]);if(g&&D.bucketInstanceId in this.collisionCircleArrays){var Yt=this.collisionCircleArrays[D.bucketInstanceId];s.invert(Yt.invProjMatrix,G),Yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}D.justReloaded=!1},Se.prototype.markUsedJustification=function(m,v,g,w){var B;B=w===s.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(v)];for(var D=0,O=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];D<O.length;D+=1){var G=O[D];G>=0&&(m.text.placedSymbolArray.get(G).crossTileID=B>=0&&G!==B?0:g.crossTileID)}},Se.prototype.markUsedOrientation=function(m,v,g){for(var w=v===s.WritingMode.horizontal||v===s.WritingMode.horizontalOnly?v:0,B=v===s.WritingMode.vertical?v:0,D=0,O=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];D<O.length;D+=1)m.text.placedSymbolArray.get(O[D]).placedOrientation=w;g.verticalPlacedTextSymbolIndex&&(m.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=B)},Se.prototype.commit=function(m){this.commitTime=m,this.zoomAtLastRecencyCheck=this.transform.zoom;var v=this.prevPlacement,g=!1;this.prevZoomAdjustment=v?v.zoomAdjustment(this.transform.zoom):0;var w=v?v.symbolFadeChange(m):1,B=v?v.opacities:{},D=v?v.variableOffsets:{},O=v?v.placedOrientations:{};for(var G in this.placements){var J=this.placements[G],at=B[G];at?(this.opacities[G]=new Hr(at,w,J.text,J.icon),g=g||J.text!==at.text.placed||J.icon!==at.icon.placed):(this.opacities[G]=new Hr(null,w,J.text,J.icon,J.skipFade),g=g||J.text||J.icon)}for(var Et in B){var Ct=B[Et];if(!this.opacities[Et]){var Bt=new Hr(Ct,w,!1,!1);Bt.isHidden()||(this.opacities[Et]=Bt,g=g||Ct.text.placed||Ct.icon.placed)}}for(var Wt in D)this.variableOffsets[Wt]||!this.opacities[Wt]||this.opacities[Wt].isHidden()||(this.variableOffsets[Wt]=D[Wt]);for(var zt in O)this.placedOrientations[zt]||!this.opacities[zt]||this.opacities[zt].isHidden()||(this.placedOrientations[zt]=O[zt]);g?this.lastPlacementChangeTime=m:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=v?v.lastPlacementChangeTime:m)},Se.prototype.updateLayerOpacities=function(m,v){for(var g={},w=0,B=v;w<B.length;w+=1){var D=B[w],O=D.getBucket(m);O&&D.latestFeatureIndex&&m.id===O.layerIds[0]&&this.updateBucketOpacities(O,g,D.collisionBoxArray)}},Se.prototype.updateBucketOpacities=function(m,v,g){var w=this;m.hasTextData()&&m.text.opacityVertexArray.clear(),m.hasIconData()&&m.icon.opacityVertexArray.clear(),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexArray.clear(),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexArray.clear();var B=m.layers[0].layout,D=new Hr(null,0,!1,!1,!0),O=B.get("text-allow-overlap"),G=B.get("icon-allow-overlap"),J=B.get("text-variable-anchor"),at=B.get("text-rotation-alignment")==="map",Et=B.get("text-pitch-alignment")==="map",Ct=B.get("icon-text-fit")!=="none",Bt=new Hr(null,0,O&&(G||!m.hasIconData()||B.get("icon-optional")),G&&(O||!m.hasTextData()||B.get("text-optional")),!0);!m.collisionArrays&&g&&(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData())&&m.deserializeCollisionBoxes(g);for(var Wt=function(A,b,E){for(var S=0;S<b/4;S++)A.opacityVertexArray.emplaceBack(E)},zt=function(A){var b=m.symbolInstances.get(A),E=b.numHorizontalGlyphVertices,S=b.numVerticalGlyphVertices,P=b.crossTileID,R=w.opacities[P];v[P]?R=D:R||(w.opacities[P]=R=Bt),v[P]=!0;var F=b.numIconVertices>0,U=w.placedOrientations[b.crossTileID],W=U===s.WritingMode.vertical,ht=U===s.WritingMode.horizontal||U===s.WritingMode.horizontalOnly;if(E>0||S>0){var Pt=Ef(R.text);Wt(m.text,E,W?El:Pt),Wt(m.text,S,ht?El:Pt);var It=R.text.isHidden();[b.rightJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.leftJustifiedTextSymbolIndex].forEach(function(ze){ze>=0&&(m.text.placedSymbolArray.get(ze).hidden=It||W?1:0)}),b.verticalPlacedTextSymbolIndex>=0&&(m.text.placedSymbolArray.get(b.verticalPlacedTextSymbolIndex).hidden=It||ht?1:0);var Mt=w.variableOffsets[b.crossTileID];Mt&&w.markUsedJustification(m,Mt.anchor,b,U);var Yt=w.placedOrientations[b.crossTileID];Yt&&(w.markUsedJustification(m,"left",b,Yt),w.markUsedOrientation(m,Yt,b))}if(F){var Ht=Ef(R.icon),ie=!(Ct&&b.verticalPlacedIconSymbolIndex&&W);b.placedIconSymbolIndex>=0&&(Wt(m.icon,b.numIconVertices,ie?Ht:El),m.icon.placedSymbolArray.get(b.placedIconSymbolIndex).hidden=R.icon.isHidden()),b.verticalPlacedIconSymbolIndex>=0&&(Wt(m.icon,b.numVerticalIconVertices,ie?El:Ht),m.icon.placedSymbolArray.get(b.verticalPlacedIconSymbolIndex).hidden=R.icon.isHidden())}if(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData()){var te=m.collisionArrays[A];if(te){var Jt=new s.Point(0,0);if(te.textBox||te.verticalTextBox){var qt=!0;if(J){var Be=w.variableOffsets[P];Be?(Jt=Dt(Be.anchor,Be.width,Be.height,Be.textOffset,Be.textBoxScale),at&&Jt._rotate(Et?w.transform.angle:-w.transform.angle)):qt=!1}te.textBox&&Ye(m.textCollisionBox.collisionVertexArray,R.text.placed,!qt||W,Jt.x,Jt.y),te.verticalTextBox&&Ye(m.textCollisionBox.collisionVertexArray,R.text.placed,!qt||ht,Jt.x,Jt.y)}var Ge=!!(!ht&&te.verticalIconBox);te.iconBox&&Ye(m.iconCollisionBox.collisionVertexArray,R.icon.placed,Ge,Ct?Jt.x:0,Ct?Jt.y:0),te.verticalIconBox&&Ye(m.iconCollisionBox.collisionVertexArray,R.icon.placed,!Ge,Ct?Jt.x:0,Ct?Jt.y:0)}}},f=0;f<m.symbolInstances.length;f++)zt(f);if(m.sortFeatures(this.transform.angle),this.retainedQueryData[m.bucketInstanceId]&&(this.retainedQueryData[m.bucketInstanceId].featureSortOrder=m.featureSortOrder),m.hasTextData()&&m.text.opacityVertexBuffer&&m.text.opacityVertexBuffer.updateData(m.text.opacityVertexArray),m.hasIconData()&&m.icon.opacityVertexBuffer&&m.icon.opacityVertexBuffer.updateData(m.icon.opacityVertexArray),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexBuffer&&m.iconCollisionBox.collisionVertexBuffer.updateData(m.iconCollisionBox.collisionVertexArray),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexBuffer&&m.textCollisionBox.collisionVertexBuffer.updateData(m.textCollisionBox.collisionVertexArray),m.bucketInstanceId in this.collisionCircleArrays){var h=this.collisionCircleArrays[m.bucketInstanceId];m.placementInvProjMatrix=h.invProjMatrix,m.placementViewportMatrix=h.viewportMatrix,m.collisionCircleArray=h.circles,delete this.collisionCircleArrays[m.bucketInstanceId]}},Se.prototype.symbolFadeChange=function(m){return this.fadeDuration===0?1:(m-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Se.prototype.zoomAdjustment=function(m){return Math.max(0,(this.transform.zoom-m)/1.5)},Se.prototype.hasTransitions=function(m){return this.stale||m-this.lastPlacementChangeTime<this.fadeDuration},Se.prototype.stillRecent=function(m,v){var g=this.zoomAtLastRecencyCheck===v?1-this.zoomAdjustment(v):1;return this.zoomAtLastRecencyCheck=v,this.commitTime+this.fadeDuration*g>m},Se.prototype.setStale=function(){this.stale=!0};var Xi=Math.pow(2,25),En=Math.pow(2,24),Yn=Math.pow(2,17),Tn=Math.pow(2,16),Xr=Math.pow(2,9),qs=Math.pow(2,8),wf=Math.pow(2,1);function Ef(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;var v=m.placed?1:0,g=Math.floor(127*m.opacity);return g*Xi+v*En+g*Yn+v*Tn+g*Xr+v*qs+g*wf+v}var El=0,ac=function(m){this._sortAcrossTiles=m.layout.get("symbol-z-order")!=="viewport-y"&&m.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ac.prototype.continuePlacement=function(m,v,g,w,B){for(var D=this._bucketParts;this._currentTileIndex<m.length;)if(v.getBucketParts(D,w,m[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,B())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort(function(O,G){return O.sortKey-G.sortKey}));this._currentPartIndex<D.length;)if(v.placeLayerBucketPart(D[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,B())return!0;return!1};var Va=function(m,v,g,w,B,D,O){this.placement=new Se(m,B,D,O),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=w,this._done=!1};Va.prototype.isDone=function(){return this._done},Va.prototype.continuePlacement=function(m,v,g){for(var w=this,B=s.browser.now(),D=function(){var J=s.browser.now()-B;return!w._forceFullPlacement&&J>2};this._currentPlacementIndex>=0;){var O=v[m[this._currentPlacementIndex]],G=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=G)&&(!O.maxzoom||O.maxzoom>G)){if(this._inProgressLayer||(this._inProgressLayer=new ac(O)),this._inProgressLayer.continuePlacement(g[O.source],this.placement,this._showCollisionBoxes,O,D))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Va.prototype.commit=function(m){return this.placement.commit(m),this.placement};var lc=512/s.EXTENT/2,uc=function(m,v,g){this.tileID=m,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(var w=0;w<v.length;w++){var B=v.get(w),D=B.key;this.indexedSymbolInstances[D]||(this.indexedSymbolInstances[D]=[]),this.indexedSymbolInstances[D].push({crossTileID:B.crossTileID,coord:this.getScaledCoordinates(B,m)})}};uc.prototype.getScaledCoordinates=function(m,v){var g=lc/Math.pow(2,v.canonical.z-this.tileID.canonical.z);return{x:Math.floor((v.canonical.x*s.EXTENT+m.anchorX)*g),y:Math.floor((v.canonical.y*s.EXTENT+m.anchorY)*g)}},uc.prototype.findMatches=function(m,v,g){for(var w=this.tileID.canonical.z<v.canonical.z?1:Math.pow(2,this.tileID.canonical.z-v.canonical.z),B=0;B<m.length;B++){var D=m.get(B);if(!D.crossTileID){var O=this.indexedSymbolInstances[D.key];if(O)for(var G=this.getScaledCoordinates(D,v),J=0,at=O;J<at.length;J+=1){var Et=at[J];if(Math.abs(Et.coord.x-G.x)<=w&&Math.abs(Et.coord.y-G.y)<=w&&!g[Et.crossTileID]){g[Et.crossTileID]=!0,D.crossTileID=Et.crossTileID;break}}}}};var oo=function(){this.maxCrossTileID=0};oo.prototype.generate=function(){return++this.maxCrossTileID};var ya=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ya.prototype.handleWrapJump=function(m){var v=Math.round((m-this.lng)/360);if(v!==0)for(var g in this.indexes){var w=this.indexes[g],B={};for(var D in w){var O=w[D];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+v),B[O.tileID.key]=O}this.indexes[g]=B}this.lng=m},ya.prototype.addBucket=function(m,v,g){if(this.indexes[m.overscaledZ]&&this.indexes[m.overscaledZ][m.key]){if(this.indexes[m.overscaledZ][m.key].bucketInstanceId===v.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(m.overscaledZ,this.indexes[m.overscaledZ][m.key])}for(var w=0;w<v.symbolInstances.length;w++)v.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[m.overscaledZ]||(this.usedCrossTileIDs[m.overscaledZ]={});var B=this.usedCrossTileIDs[m.overscaledZ];for(var D in this.indexes){var O=this.indexes[D];if(Number(D)>m.overscaledZ)for(var G in O){var J=O[G];J.tileID.isChildOf(m)&&J.findMatches(v.symbolInstances,m,B)}else{var at=O[m.scaledTo(Number(D)).key];at&&at.findMatches(v.symbolInstances,m,B)}}for(var Et=0;Et<v.symbolInstances.length;Et++){var Ct=v.symbolInstances.get(Et);Ct.crossTileID||(Ct.crossTileID=g.generate(),B[Ct.crossTileID]=!0)}return this.indexes[m.overscaledZ]===void 0&&(this.indexes[m.overscaledZ]={}),this.indexes[m.overscaledZ][m.key]=new uc(m,v.symbolInstances,v.bucketInstanceId),!0},ya.prototype.removeBucketCrossTileIDs=function(m,v){for(var g in v.indexedSymbolInstances)for(var w=0,B=v.indexedSymbolInstances[g];w<B.length;w+=1)delete this.usedCrossTileIDs[m][B[w].crossTileID]},ya.prototype.removeStaleBuckets=function(m){var v=!1;for(var g in this.indexes){var w=this.indexes[g];for(var B in w)m[w[B].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,w[B]),delete w[B],v=!0)}return v};var $o=function(){this.layerIndexes={},this.crossTileIDs=new oo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};$o.prototype.addLayer=function(m,v,g){var w=this.layerIndexes[m.id];w===void 0&&(w=this.layerIndexes[m.id]=new ya);var B=!1,D={};w.handleWrapJump(g);for(var O=0,G=v;O<G.length;O+=1){var J=G[O],at=J.getBucket(m);at&&m.id===at.layerIds[0]&&(at.bucketInstanceId||(at.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(J.tileID,at,this.crossTileIDs)&&(B=!0),D[at.bucketInstanceId]=!0)}return w.removeStaleBuckets(D)&&(B=!0),B},$o.prototype.pruneUnusedLayers=function(m){var v={};for(var g in m.forEach(function(w){v[w]=!0}),this.layerIndexes)v[g]||delete this.layerIndexes[g]};var Ga=function(m,v){return s.emitValidationErrors(m,v&&v.filter(function(g){return g.identifier!=="source.canvas"}))},No=s.pick(Ze,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),zo=s.pick(Ze,["setCenter","setZoom","setBearing","setPitch"]),cc=(function(){var m={},v=s.styleSpec.$version;for(var g in s.styleSpec.$root){var w,B=s.styleSpec.$root[g];B.required&&(w=g==="version"?v:B.type==="array"?[]:{})!=null&&(m[g]=w)}return m})(),ys=(function(m){function v(g,w){var B=this;w===void 0&&(w={}),m.call(this),this.map=g,this.dispatcher=new Tt(ge(),this),this.imageManager=new $,this.imageManager.setEventedParent(this),this.glyphManager=new ft(g._requestManager,w.localIdeographFontFamily),this.lineAtlas=new dt(256,512),this.crossTileSymbolIndex=new $o,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());var D=this;this._rtlTextPluginCallback=v.registerForPluginStateChange(function(O){D.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:O.pluginStatus,pluginURL:O.pluginURL},function(G,J){if(s.triggerPluginCompletionEvent(G),J&&J.every(function(Et){return Et}))for(var at in D.sourceCaches)D.sourceCaches[at].reload()})}),this.on("data",function(O){if(O.dataType==="source"&&O.sourceDataType==="metadata"){var G=B.sourceCaches[O.sourceId];if(G){var J=G.getSource();if(J&&J.vectorLayerIds)for(var at in B._layers){var Et=B._layers[at];Et.source===J.id&&B._validateLayer(Et)}}}})}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.loadURL=function(g,w){var B=this;w===void 0&&(w={}),this.fire(new s.Event("dataloading",{dataType:"style"}));var D=typeof w.validate=="boolean"?w.validate:!s.isMapboxURL(g);g=this.map._requestManager.normalizeStyleURL(g,w.accessToken);var O=this.map._requestManager.transformRequest(g,s.ResourceType.Style);this._request=s.getJSON(O,function(G,J){B._request=null,G?B.fire(new s.ErrorEvent(G)):J&&B._load(J,D)})},v.prototype.loadJSON=function(g,w){var B=this;w===void 0&&(w={}),this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.browser.frame(function(){B._request=null,B._load(g,w.validate!==!1)})},v.prototype.loadEmpty=function(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(cc,!1)},v.prototype._load=function(g,w){if(!w||!Ga(this,s.validateStyle(g))){for(var B in this._loaded=!0,this.stylesheet=g,g.sources)this.addSource(B,g.sources[B],{validate:!1});g.sprite?this._loadSprite(g.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(g.glyphs);var D=De(this.stylesheet.layers);this._order=D.map(function(at){return at.id}),this._layers={},this._serializedLayers={};for(var O=0,G=D;O<G.length;O+=1){var J=G[O];(J=s.createStyleLayer(J)).setEventedParent(this,{layer:{id:J.id}}),this._layers[J.id]=J,this._serializedLayers[J.id]=J.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new K(this.stylesheet.light),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}},v.prototype._loadSprite=function(g){var w=this;this._spriteRequest=(function(B,D,O){var G,J,at,Et=s.browser.devicePixelRatio>1?"@2x":"",Ct=s.getJSON(D.transformRequest(D.normalizeSpriteURL(B,Et,".json"),s.ResourceType.SpriteJSON),function(zt,f){Ct=null,at||(at=zt,G=f,Wt())}),Bt=s.getImage(D.transformRequest(D.normalizeSpriteURL(B,Et,".png"),s.ResourceType.SpriteImage),function(zt,f){Bt=null,at||(at=zt,J=f,Wt())});function Wt(){if(at)O(at);else if(G&&J){var zt=s.browser.getImageData(J),f={};for(var h in G){var A=G[h],b=A.width,E=A.height,S=A.x,P=A.y,R=A.sdf,F=A.pixelRatio,U=A.stretchX,W=A.stretchY,ht=A.content,Pt=new s.RGBAImage({width:b,height:E});s.RGBAImage.copy(zt,Pt,{x:S,y:P},{x:0,y:0},{width:b,height:E}),f[h]={data:Pt,pixelRatio:F,sdf:R,stretchX:U,stretchY:W,content:ht}}O(null,f)}}return{cancel:function(){Ct&&(Ct.cancel(),Ct=null),Bt&&(Bt.cancel(),Bt=null)}}})(g,this.map._requestManager,function(B,D){if(w._spriteRequest=null,B)w.fire(new s.ErrorEvent(B));else if(D)for(var O in D)w.imageManager.addImage(O,D[O]);w.imageManager.setLoaded(!0),w._availableImages=w.imageManager.listImages(),w.dispatcher.broadcast("setImages",w._availableImages),w.fire(new s.Event("data",{dataType:"style"}))})},v.prototype._validateLayer=function(g){var w=this.sourceCaches[g.source];if(w){var B=g.sourceLayer;if(B){var D=w.getSource();(D.type==="geojson"||D.vectorLayerIds&&D.vectorLayerIds.indexOf(B)===-1)&&this.fire(new s.ErrorEvent(new Error('Source layer "'+B+'" does not exist on source "'+D.id+'" as specified by style layer "'+g.id+'"')))}}},v.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var g in this.sourceCaches)if(!this.sourceCaches[g].loaded())return!1;return!!this.imageManager.isLoaded()},v.prototype._serializeLayers=function(g){for(var w=[],B=0,D=g;B<D.length;B+=1){var O=this._layers[D[B]];O.type!=="custom"&&w.push(O.serialize())}return w},v.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(var w in this._layers)if(this._layers[w].hasTransition())return!0;return!1},v.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},v.prototype.update=function(g){if(this._loaded){var w=this._changed;if(this._changed){var B=Object.keys(this._updatedLayers),D=Object.keys(this._removedLayers);for(var O in(B.length||D.length)&&this._updateWorkerLayers(B,D),this._updatedSources){var G=this._updatedSources[O];G==="reload"?this._reloadSource(O):G==="clear"&&this._clearSource(O)}for(var J in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[J].updateTransitions(g);this.light.updateTransitions(g),this._resetUpdates()}var at={};for(var Et in this.sourceCaches){var Ct=this.sourceCaches[Et];at[Et]=Ct.used,Ct.used=!1}for(var Bt=0,Wt=this._order;Bt<Wt.length;Bt+=1){var zt=this._layers[Wt[Bt]];zt.recalculate(g,this._availableImages),!zt.isHidden(g.zoom)&&zt.source&&(this.sourceCaches[zt.source].used=!0)}for(var f in at){var h=this.sourceCaches[f];at[f]!==h.used&&h.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(g),this.z=g.zoom,w&&this.fire(new s.Event("data",{dataType:"style"}))}},v.prototype._updateTilesForChangedImages=function(){var g=Object.keys(this._changedImages);if(g.length){for(var w in this.sourceCaches)this.sourceCaches[w].reloadTilesForDependencies(["icons","patterns"],g);this._changedImages={}}},v.prototype._updateWorkerLayers=function(g,w){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(g),removedIds:w})},v.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},v.prototype.setState=function(g){var w=this;if(this._checkLoaded(),Ga(this,s.validateStyle(g)))return!1;(g=s.clone$1(g)).layers=De(g.layers);var B=(function(O,G){if(!O)return[{command:Ze.setStyle,args:[G]}];var J=[];try{if(!s.deepEqual(O.version,G.version))return[{command:Ze.setStyle,args:[G]}];s.deepEqual(O.center,G.center)||J.push({command:Ze.setCenter,args:[G.center]}),s.deepEqual(O.zoom,G.zoom)||J.push({command:Ze.setZoom,args:[G.zoom]}),s.deepEqual(O.bearing,G.bearing)||J.push({command:Ze.setBearing,args:[G.bearing]}),s.deepEqual(O.pitch,G.pitch)||J.push({command:Ze.setPitch,args:[G.pitch]}),s.deepEqual(O.sprite,G.sprite)||J.push({command:Ze.setSprite,args:[G.sprite]}),s.deepEqual(O.glyphs,G.glyphs)||J.push({command:Ze.setGlyphs,args:[G.glyphs]}),s.deepEqual(O.transition,G.transition)||J.push({command:Ze.setTransition,args:[G.transition]}),s.deepEqual(O.light,G.light)||J.push({command:Ze.setLight,args:[G.light]});var at={},Et=[];(function(Bt,Wt,zt,f){var h;for(h in Wt=Wt||{},Bt=Bt||{})Bt.hasOwnProperty(h)&&(Wt.hasOwnProperty(h)||si(h,zt,f));for(h in Wt)Wt.hasOwnProperty(h)&&(Bt.hasOwnProperty(h)?s.deepEqual(Bt[h],Wt[h])||(Bt[h].type==="geojson"&&Wt[h].type==="geojson"&&hn(Bt,Wt,h)?zt.push({command:Ze.setGeoJSONSourceData,args:[h,Wt[h].data]}):rn(h,Wt,zt,f)):Gi(h,Wt,zt))})(O.sources,G.sources,Et,at);var Ct=[];O.layers&&O.layers.forEach(function(Bt){at[Bt.source]?J.push({command:Ze.removeLayer,args:[Bt.id]}):Ct.push(Bt)}),J=J.concat(Et),(function(Bt,Wt,zt){Wt=Wt||[];var f,h,A,b,E,S,P,R=(Bt=Bt||[]).map(Ji),F=Wt.map(Ji),U=Bt.reduce(Hi,{}),W=Wt.reduce(Hi,{}),ht=R.slice(),Pt=Object.create(null);for(f=0,h=0;f<R.length;f++)W.hasOwnProperty(A=R[f])?h++:(zt.push({command:Ze.removeLayer,args:[A]}),ht.splice(ht.indexOf(A,h),1));for(f=0,h=0;f<F.length;f++)ht[ht.length-1-f]!==(A=F[F.length-1-f])&&(U.hasOwnProperty(A)?(zt.push({command:Ze.removeLayer,args:[A]}),ht.splice(ht.lastIndexOf(A,ht.length-h),1)):h++,zt.push({command:Ze.addLayer,args:[W[A],S=ht[ht.length-f]]}),ht.splice(ht.length-f,0,A),Pt[A]=!0);for(f=0;f<F.length;f++)if(b=U[A=F[f]],E=W[A],!Pt[A]&&!s.deepEqual(b,E))if(s.deepEqual(b.source,E.source)&&s.deepEqual(b["source-layer"],E["source-layer"])&&s.deepEqual(b.type,E.type)){for(P in Yi(b.layout,E.layout,zt,A,null,Ze.setLayoutProperty),Yi(b.paint,E.paint,zt,A,null,Ze.setPaintProperty),s.deepEqual(b.filter,E.filter)||zt.push({command:Ze.setFilter,args:[A,E.filter]}),s.deepEqual(b.minzoom,E.minzoom)&&s.deepEqual(b.maxzoom,E.maxzoom)||zt.push({command:Ze.setLayerZoomRange,args:[A,E.minzoom,E.maxzoom]}),b)b.hasOwnProperty(P)&&P!=="layout"&&P!=="paint"&&P!=="filter"&&P!=="metadata"&&P!=="minzoom"&&P!=="maxzoom"&&(P.indexOf("paint.")===0?Yi(b[P],E[P],zt,A,P.slice(6),Ze.setPaintProperty):s.deepEqual(b[P],E[P])||zt.push({command:Ze.setLayerProperty,args:[A,P,E[P]]}));for(P in E)E.hasOwnProperty(P)&&!b.hasOwnProperty(P)&&P!=="layout"&&P!=="paint"&&P!=="filter"&&P!=="metadata"&&P!=="minzoom"&&P!=="maxzoom"&&(P.indexOf("paint.")===0?Yi(b[P],E[P],zt,A,P.slice(6),Ze.setPaintProperty):s.deepEqual(b[P],E[P])||zt.push({command:Ze.setLayerProperty,args:[A,P,E[P]]}))}else zt.push({command:Ze.removeLayer,args:[A]}),S=ht[ht.lastIndexOf(A)+1],zt.push({command:Ze.addLayer,args:[E,S]})})(Ct,G.layers,J)}catch(Bt){console.warn("Unable to compute style diff:",Bt),J=[{command:Ze.setStyle,args:[G]}]}return J})(this.serialize(),g).filter(function(O){return!(O.command in zo)});if(B.length===0)return!1;var D=B.filter(function(O){return!(O.command in No)});if(D.length>0)throw new Error("Unimplemented: "+D.map(function(O){return O.command}).join(", ")+".");return B.forEach(function(O){O.command!=="setTransition"&&w[O.command].apply(w,O.args)}),this.stylesheet=g,!0},v.prototype.addImage=function(g,w){if(this.getImage(g))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(g,w),this._afterImageUpdated(g)},v.prototype.updateImage=function(g,w){this.imageManager.updateImage(g,w)},v.prototype.getImage=function(g){return this.imageManager.getImage(g)},v.prototype.removeImage=function(g){if(!this.getImage(g))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(g),this._afterImageUpdated(g)},v.prototype._afterImageUpdated=function(g){this._availableImages=this.imageManager.listImages(),this._changedImages[g]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))},v.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},v.prototype.addSource=function(g,w,B){var D=this;if(B===void 0&&(B={}),this._checkLoaded(),this.sourceCaches[g]!==void 0)throw new Error("There is already a source with this ID");if(!w.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(w).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(w.type)>=0&&this._validate(s.validateStyle.source,"sources."+g,w,null,B))){this.map&&this.map._collectResourceTiming&&(w.collectResourceTiming=!0);var O=this.sourceCaches[g]=new pt(g,w,this.dispatcher);O.style=this,O.setEventedParent(this,function(){return{isSourceLoaded:D.loaded(),source:O.serialize(),sourceId:g}}),O.onAdd(this.map),this._changed=!0}},v.prototype.removeSource=function(g){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error("There is no source with this ID");for(var w in this._layers)if(this._layers[w].source===g)return this.fire(new s.ErrorEvent(new Error('Source "'+g+'" cannot be removed while layer "'+w+'" is using it.')));var B=this.sourceCaches[g];delete this.sourceCaches[g],delete this._updatedSources[g],B.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g})),B.setEventedParent(null),B.clearTiles(),B.onRemove&&B.onRemove(this.map),this._changed=!0},v.prototype.setGeoJSONSourceData=function(g,w){this._checkLoaded(),this.sourceCaches[g].getSource().setData(w),this._changed=!0},v.prototype.getSource=function(g){return this.sourceCaches[g]&&this.sourceCaches[g].getSource()},v.prototype.addLayer=function(g,w,B){B===void 0&&(B={}),this._checkLoaded();var D=g.id;if(this.getLayer(D))this.fire(new s.ErrorEvent(new Error('Layer with id "'+D+'" already exists on this map')));else{var O;if(g.type==="custom"){if(Ga(this,s.validateCustomStyleLayer(g)))return;O=s.createStyleLayer(g)}else{if(typeof g.source=="object"&&(this.addSource(D,g.source),g=s.clone$1(g),g=s.extend(g,{source:D})),this._validate(s.validateStyle.layer,"layers."+D,g,{arrayIndex:-1},B))return;O=s.createStyleLayer(g),this._validateLayer(O),O.setEventedParent(this,{layer:{id:D}}),this._serializedLayers[O.id]=O.serialize()}var G=w?this._order.indexOf(w):this._order.length;if(w&&G===-1)this.fire(new s.ErrorEvent(new Error('Layer with id "'+w+'" does not exist on this map.')));else{if(this._order.splice(G,0,D),this._layerOrderChanged=!0,this._layers[D]=O,this._removedLayers[D]&&O.source&&O.type!=="custom"){var J=this._removedLayers[D];delete this._removedLayers[D],J.type!==O.type?this._updatedSources[O.source]="clear":(this._updatedSources[O.source]="reload",this.sourceCaches[O.source].pause())}this._updateLayer(O),O.onAdd&&O.onAdd(this.map)}}},v.prototype.moveLayer=function(g,w){if(this._checkLoaded(),this._changed=!0,this._layers[g]){if(g!==w){var B=this._order.indexOf(g);this._order.splice(B,1);var D=w?this._order.indexOf(w):this._order.length;w&&D===-1?this.fire(new s.ErrorEvent(new Error('Layer with id "'+w+'" does not exist on this map.'))):(this._order.splice(D,0,g),this._layerOrderChanged=!0)}}else this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be moved.")))},v.prototype.removeLayer=function(g){this._checkLoaded();var w=this._layers[g];if(w){w.setEventedParent(null);var B=this._order.indexOf(g);this._order.splice(B,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[g]=w,delete this._layers[g],delete this._serializedLayers[g],delete this._updatedLayers[g],delete this._updatedPaintProps[g],w.onRemove&&w.onRemove(this.map)}else this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be removed.")))},v.prototype.getLayer=function(g){return this._layers[g]},v.prototype.hasLayer=function(g){return g in this._layers},v.prototype.setLayerZoomRange=function(g,w,B){this._checkLoaded();var D=this.getLayer(g);D?D.minzoom===w&&D.maxzoom===B||(w!=null&&(D.minzoom=w),B!=null&&(D.maxzoom=B),this._updateLayer(D)):this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot have zoom extent.")))},v.prototype.setFilter=function(g,w,B){B===void 0&&(B={}),this._checkLoaded();var D=this.getLayer(g);if(D){if(!s.deepEqual(D.filter,w))return w==null?(D.filter=void 0,void this._updateLayer(D)):void(this._validate(s.validateStyle.filter,"layers."+D.id+".filter",w,null,B)||(D.filter=s.clone$1(w),this._updateLayer(D)))}else this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be filtered.")))},v.prototype.getFilter=function(g){return s.clone$1(this.getLayer(g).filter)},v.prototype.setLayoutProperty=function(g,w,B,D){D===void 0&&(D={}),this._checkLoaded();var O=this.getLayer(g);O?s.deepEqual(O.getLayoutProperty(w),B)||(O.setLayoutProperty(w,B,D),this._updateLayer(O)):this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getLayoutProperty=function(g,w){var B=this.getLayer(g);if(B)return B.getLayoutProperty(w);this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style.")))},v.prototype.setPaintProperty=function(g,w,B,D){D===void 0&&(D={}),this._checkLoaded();var O=this.getLayer(g);O?s.deepEqual(O.getPaintProperty(w),B)||(O.setPaintProperty(w,B,D)&&this._updateLayer(O),this._changed=!0,this._updatedPaintProps[g]=!0):this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getPaintProperty=function(g,w){return this.getLayer(g).getPaintProperty(w)},v.prototype.setFeatureState=function(g,w){this._checkLoaded();var B=g.source,D=g.sourceLayer,O=this.sourceCaches[B];if(O!==void 0){var G=O.getSource().type;G==="geojson"&&D?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):G!=="vector"||D?(g.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),O.setFeatureState(D,g.id,w)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+B+"' does not exist in the map's style.")))},v.prototype.removeFeatureState=function(g,w){this._checkLoaded();var B=g.source,D=this.sourceCaches[B];if(D!==void 0){var O=D.getSource().type,G=O==="vector"?g.sourceLayer:void 0;O!=="vector"||G?w&&typeof g.id!="string"&&typeof g.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):D.removeFeatureState(G,g.id,w):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+B+"' does not exist in the map's style.")))},v.prototype.getFeatureState=function(g){this._checkLoaded();var w=g.source,B=g.sourceLayer,D=this.sourceCaches[w];if(D!==void 0){if(D.getSource().type!=="vector"||B)return g.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),D.getFeatureState(B,g.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},v.prototype.getTransition=function(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},v.prototype.serialize=function(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,function(g){return g.serialize()}),layers:this._serializeLayers(this._order)},function(g){return g!==void 0})},v.prototype._updateLayer=function(g){this._updatedLayers[g.id]=!0,g.source&&!this._updatedSources[g.source]&&this.sourceCaches[g.source].getSource().type!=="raster"&&(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause()),this._changed=!0},v.prototype._flattenAndSortRenderedFeatures=function(g){for(var w=this,B=function(U){return w._layers[U].type==="fill-extrusion"},D={},O=[],G=this._order.length-1;G>=0;G--){var J=this._order[G];if(B(J)){D[J]=G;for(var at=0,Et=g;at<Et.length;at+=1){var Ct=Et[at][J];if(Ct)for(var Bt=0,Wt=Ct;Bt<Wt.length;Bt+=1)O.push(Wt[Bt])}}}O.sort(function(U,W){return W.intersectionZ-U.intersectionZ});for(var zt=[],f=this._order.length-1;f>=0;f--){var h=this._order[f];if(B(h))for(var A=O.length-1;A>=0;A--){var b=O[A].feature;if(D[b.layer.id]<f)break;zt.push(b),O.pop()}else for(var E=0,S=g;E<S.length;E+=1){var P=S[E][h];if(P)for(var R=0,F=P;R<F.length;R+=1)zt.push(F[R].feature)}}return zt},v.prototype.queryRenderedFeatures=function(g,w,B){w&&w.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",w.filter,null,w);var D={};if(w&&w.layers){if(!Array.isArray(w.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var O=0,G=w.layers;O<G.length;O+=1){var J=G[O],at=this._layers[J];if(!at)return this.fire(new s.ErrorEvent(new Error("The layer '"+J+"' does not exist in the map's style and cannot be queried for features."))),[];D[at.source]=!0}}var Et=[];for(var Ct in w.availableImages=this._availableImages,this.sourceCaches)w.layers&&!D[Ct]||Et.push(ei(this.sourceCaches[Ct],this._layers,this._serializedLayers,g,w,B));return this.placement&&Et.push((function(Bt,Wt,zt,f,h,A,b){for(var E={},S=A.queryRenderedSymbols(f),P=[],R=0,F=Object.keys(S).map(Number);R<F.length;R+=1)P.push(b[F[R]]);P.sort(ii);for(var U=function(){var Mt=ht[W],Yt=Mt.featureIndex.lookupSymbolFeatures(S[Mt.bucketInstanceId],Wt,Mt.bucketIndex,Mt.sourceLayerIndex,h.filter,h.layers,h.availableImages,Bt);for(var Ht in Yt){var ie=E[Ht]=E[Ht]||[],te=Yt[Ht];te.sort(function(Be,Ge){var ze=Mt.featureSortOrder;if(ze){var Ri=ze.indexOf(Be.featureIndex);return ze.indexOf(Ge.featureIndex)-Ri}return Ge.featureIndex-Be.featureIndex});for(var Jt=0,qt=te;Jt<qt.length;Jt+=1)ie.push(qt[Jt])}},W=0,ht=P;W<ht.length;W+=1)U();var Pt=function(Mt){E[Mt].forEach(function(Yt){var Ht=Yt.feature,ie=zt[Bt[Mt].source].getFeatureState(Ht.layer["source-layer"],Ht.id);Ht.source=Ht.layer.source,Ht.layer["source-layer"]&&(Ht.sourceLayer=Ht.layer["source-layer"]),Ht.state=ie})};for(var It in E)Pt(It);return E})(this._layers,this._serializedLayers,this.sourceCaches,g,w,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Et)},v.prototype.querySourceFeatures=function(g,w){w&&w.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",w.filter,null,w);var B=this.sourceCaches[g];return B?(function(D,O){for(var G=D.getRenderableIds().map(function(Wt){return D.getTileByID(Wt)}),J=[],at={},Et=0;Et<G.length;Et++){var Ct=G[Et],Bt=Ct.tileID.canonical.key;at[Bt]||(at[Bt]=!0,Ct.querySourceFeatures(J,O))}return J})(B,w):[]},v.prototype.addSourceType=function(g,w,B){return v.getSourceType(g)?B(new Error('A source type called "'+g+'" already exists.')):(v.setSourceType(g,w),w.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:g,url:w.workerSourceURL},B):B(null,null))},v.prototype.getLight=function(){return this.light.getLight()},v.prototype.setLight=function(g,w){w===void 0&&(w={}),this._checkLoaded();var B=this.light.getLight(),D=!1;for(var O in g)if(!s.deepEqual(g[O],B[O])){D=!0;break}if(D){var G={now:s.browser.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(g,w),this.light.updateTransitions(G)}},v.prototype._validate=function(g,w,B,D,O){return O===void 0&&(O={}),(!O||O.validate!==!1)&&Ga(this,g.call(s.validateStyle,s.extend({key:w,style:this.serialize(),value:B,styleSpec:s.styleSpec},D)))},v.prototype._remove=function(){for(var g in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[g].setEventedParent(null);for(var w in this.sourceCaches)this.sourceCaches[w].clearTiles(),this.sourceCaches[w].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},v.prototype._clearSource=function(g){this.sourceCaches[g].clearTiles()},v.prototype._reloadSource=function(g){this.sourceCaches[g].resume(),this.sourceCaches[g].reload()},v.prototype._updateSources=function(g){for(var w in this.sourceCaches)this.sourceCaches[w].update(g)},v.prototype._generateCollisionBoxes=function(){for(var g in this.sourceCaches)this._reloadSource(g)},v.prototype._updatePlacement=function(g,w,B,D,O){O===void 0&&(O=!1);for(var G=!1,J=!1,at={},Et=0,Ct=this._order;Et<Ct.length;Et+=1){var Bt=this._layers[Ct[Et]];if(Bt.type==="symbol"){if(!at[Bt.source]){var Wt=this.sourceCaches[Bt.source];at[Bt.source]=Wt.getRenderableIds(!0).map(function(b){return Wt.getTileByID(b)}).sort(function(b,E){return E.tileID.overscaledZ-b.tileID.overscaledZ||(b.tileID.isLessThan(E.tileID)?-1:1)})}var zt=this.crossTileSymbolIndex.addLayer(Bt,at[Bt.source],g.center.lng);G=G||zt}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((O=O||this._layerOrderChanged||B===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.browser.now(),g.zoom))&&(this.pauseablePlacement=new Va(g,this._order,O,w,B,D,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,at),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.browser.now()),J=!0),G&&this.pauseablePlacement.placement.setStale()),J||G)for(var f=0,h=this._order;f<h.length;f+=1){var A=this._layers[h[f]];A.type==="symbol"&&this.placement.updateLayerOpacities(A,at[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.browser.now())},v.prototype._releaseSymbolFadeTiles=function(){for(var g in this.sourceCaches)this.sourceCaches[g].releaseSymbolFadeTiles()},v.prototype.getImages=function(g,w,B){this.imageManager.getImages(w.icons,B),this._updateTilesForChangedImages();var D=this.sourceCaches[w.source];D&&D.setDependencies(w.tileID.key,w.type,w.icons)},v.prototype.getGlyphs=function(g,w,B){this.glyphManager.getGlyphs(w.stacks,B)},v.prototype.getResource=function(g,w,B){return s.makeRequest(w,B)},v})(s.Evented);ys.getSourceType=function(m){return fe[m]},ys.setSourceType=function(m,v){fe[m]=v},ys.registerForPluginStateChange=s.registerForPluginStateChange;var gr=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),ja=Dn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Cf=Dn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Gp=Dn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),jp=Dn(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),lh=Dn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),qr=Dn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),ta=Dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),is=Dn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),hc=Dn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),uh=Dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fc=Dn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Au=Dn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),mu=Dn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Tf=Dn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Nr=Dn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Cl=Dn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Bs=Dn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ea=Dn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),va=Dn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Uo=Dn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Rs=Dn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ls=Dn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),_a=Dn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ia=Dn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),dc=Dn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Sf=Dn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Dn(m,v){var g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,w=v.match(/attribute ([\w]+) ([\w]+)/g),B=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),D=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),O=D?D.concat(B):B,G={};return{fragmentSource:m=m.replace(g,function(J,at,Et,Ct,Bt){return G[Bt]=!0,at==="define"?`
#ifndef HAS_UNIFORM_u_`+Bt+`
varying `+Et+" "+Ct+" "+Bt+`;
#else
uniform `+Et+" "+Ct+" u_"+Bt+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Bt+`
    `+Et+" "+Ct+" "+Bt+" = u_"+Bt+`;
#endif
`}),vertexSource:v=v.replace(g,function(J,at,Et,Ct,Bt){var Wt=Ct==="float"?"vec2":"vec4",zt=Bt.match(/color/)?"color":Wt;return G[Bt]?at==="define"?`
#ifndef HAS_UNIFORM_u_`+Bt+`
uniform lowp float u_`+Bt+`_t;
attribute `+Et+" "+Wt+" a_"+Bt+`;
varying `+Et+" "+Ct+" "+Bt+`;
#else
uniform `+Et+" "+Ct+" u_"+Bt+`;
#endif
`:zt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Bt+`
    `+Bt+" = a_"+Bt+`;
#else
    `+Et+" "+Ct+" "+Bt+" = u_"+Bt+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Bt+`
    `+Bt+" = unpack_mix_"+zt+"(a_"+Bt+", u_"+Bt+`_t);
#else
    `+Et+" "+Ct+" "+Bt+" = u_"+Bt+`;
#endif
`:at==="define"?`
#ifndef HAS_UNIFORM_u_`+Bt+`
uniform lowp float u_`+Bt+`_t;
attribute `+Et+" "+Wt+" a_"+Bt+`;
#else
uniform `+Et+" "+Ct+" u_"+Bt+`;
#endif
`:zt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Bt+`
    `+Et+" "+Ct+" "+Bt+" = a_"+Bt+`;
#else
    `+Et+" "+Ct+" "+Bt+" = u_"+Bt+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Bt+`
    `+Et+" "+Ct+" "+Bt+" = unpack_mix_"+zt+"(a_"+Bt+", u_"+Bt+`_t);
#else
    `+Et+" "+Ct+" "+Bt+" = u_"+Bt+`;
#endif
`}),staticAttributes:w,staticUniforms:O}}var Pf=Object.freeze({__proto__:null,prelude:ja,background:Cf,backgroundPattern:Gp,circle:jp,clippingMask:lh,heatmap:qr,heatmapTexture:ta,collisionBox:is,collisionCircle:hc,debug:uh,fill:fc,fillOutline:Au,fillOutlinePattern:mu,fillPattern:Tf,fillExtrusion:Nr,fillExtrusionPattern:Cl,hillshadePrepare:Bs,hillshade:ea,line:va,lineGradient:Uo,linePattern:Rs,lineSDF:Ls,raster:_a,symbolIcon:ia,symbolSDF:dc,symbolTextAndIcon:Sf}),pc=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function If(m){for(var v=[],g=0;g<m.length;g++)if(m[g]!==null){var w=m[g].split(" ");v.push(w.pop())}return v}pc.prototype.bind=function(m,v,g,w,B,D,O,G){this.context=m;for(var J=this.boundPaintVertexBuffers.length!==w.length,at=0;!J&&at<w.length;at++)this.boundPaintVertexBuffers[at]!==w[at]&&(J=!0);m.extVertexArrayObject&&this.vao&&this.boundProgram===v&&this.boundLayoutVertexBuffer===g&&!J&&this.boundIndexBuffer===B&&this.boundVertexOffset===D&&this.boundDynamicVertexBuffer===O&&this.boundDynamicVertexBuffer2===G?(m.bindVertexArrayOES.set(this.vao),O&&O.bind(),B&&B.dynamicDraw&&B.bind(),G&&G.bind()):this.freshBind(v,g,w,B,D,O,G)},pc.prototype.freshBind=function(m,v,g,w,B,D,O){var G,J=m.numAttributes,at=this.context,Et=at.gl;if(at.extVertexArrayObject)this.vao&&this.destroy(),this.vao=at.extVertexArrayObject.createVertexArrayOES(),at.bindVertexArrayOES.set(this.vao),G=0,this.boundProgram=m,this.boundLayoutVertexBuffer=v,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=w,this.boundVertexOffset=B,this.boundDynamicVertexBuffer=D,this.boundDynamicVertexBuffer2=O;else{G=at.currentNumAttributes||0;for(var Ct=J;Ct<G;Ct++)Et.disableVertexAttribArray(Ct)}v.enableAttributes(Et,m);for(var Bt=0,Wt=g;Bt<Wt.length;Bt+=1)Wt[Bt].enableAttributes(Et,m);D&&D.enableAttributes(Et,m),O&&O.enableAttributes(Et,m),v.bind(),v.setVertexAttribPointers(Et,m,B);for(var zt=0,f=g;zt<f.length;zt+=1){var h=f[zt];h.bind(),h.setVertexAttribPointers(Et,m,B)}D&&(D.bind(),D.setVertexAttribPointers(Et,m,B)),w&&w.bind(),O&&(O.bind(),O.setVertexAttribPointers(Et,m,B)),at.currentNumAttributes=J},pc.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Mf=function(m,v,g,w,B,D){var O=m.gl;this.program=O.createProgram();for(var G=If(g.staticAttributes),J=w?w.getBinderAttributes():[],at=G.concat(J),Et=g.staticUniforms?If(g.staticUniforms):[],Ct=w?w.getBinderUniforms():[],Bt=[],Wt=0,zt=Et.concat(Ct);Wt<zt.length;Wt+=1){var f=zt[Wt];Bt.indexOf(f)<0&&Bt.push(f)}var h=w?w.defines():[];D&&h.push("#define OVERDRAW_INSPECTOR;");var A=h.concat(ja.fragmentSource,g.fragmentSource).join(`
`),b=h.concat(ja.vertexSource,g.vertexSource).join(`
`),E=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())this.failedToCreate=!0;else{O.shaderSource(E,A),O.compileShader(E),O.attachShader(this.program,E);var S=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())this.failedToCreate=!0;else{O.shaderSource(S,b),O.compileShader(S),O.attachShader(this.program,S),this.attributes={};var P={};this.numAttributes=at.length;for(var R=0;R<this.numAttributes;R++)at[R]&&(O.bindAttribLocation(this.program,R,at[R]),this.attributes[at[R]]=R);O.linkProgram(this.program),O.deleteShader(S),O.deleteShader(E);for(var F=0;F<Bt.length;F++){var U=Bt[F];if(U&&!P[U]){var W=O.getUniformLocation(this.program,U);W&&(P[U]=W)}}this.fixedUniforms=B(m,P),this.binderUniforms=w?w.getUniforms(m,P):[]}}};function Bf(m,v,g){var w=1/Fn(g,1,v.transform.tileZoom),B=Math.pow(2,g.tileID.overscaledZ),D=g.tileSize*Math.pow(2,v.transform.tileZoom)/B,O=D*(g.tileID.canonical.x+g.tileID.wrap*B),G=D*g.tileID.canonical.y;return{u_image:0,u_texsize:g.imageAtlasTexture.size,u_scale:[w,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[O>>16,G>>16],u_pixel_coord_lower:[65535&O,65535&G]}}Mf.prototype.draw=function(m,v,g,w,B,D,O,G,J,at,Et,Ct,Bt,Wt,zt,f){var h,A=m.gl;if(!this.failedToCreate){for(var b in m.program.set(this.program),m.setDepthMode(g),m.setStencilMode(w),m.setColorMode(B),m.setCullFace(D),this.fixedUniforms)this.fixedUniforms[b].set(O[b]);Wt&&Wt.setUniforms(m,this.binderUniforms,Ct,{zoom:Bt});for(var E=(h={},h[A.LINES]=2,h[A.TRIANGLES]=3,h[A.LINE_STRIP]=1,h)[v],S=0,P=Et.get();S<P.length;S+=1){var R=P[S],F=R.vaos||(R.vaos={});(F[G]||(F[G]=new pc)).bind(m,this,J,Wt?Wt.getPaintVertexBuffers():[],at,R.vertexOffset,zt,f),A.drawElements(v,R.primitiveLength*E,A.UNSIGNED_SHORT,R.primitiveOffset*E*2)}}};var Rf=function(m,v,g,w){var B=v.style.light,D=B.properties.get("position"),O=[D.x,D.y,D.z],G=s.create$1();B.properties.get("anchor")==="viewport"&&s.fromRotation(G,-v.transform.angle),s.transformMat3(O,O,G);var J=B.properties.get("color");return{u_matrix:m,u_lightpos:O,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+g,u_opacity:w}},Wa=function(m,v,g,w,B,D,O){return s.extend(Rf(m,v,g,w),Bf(D,v,O),{u_height_factor:-Math.pow(2,B.overscaledZ)/O.tileSize/8})},ba=function(m){return{u_matrix:m}},Ha=function(m,v,g,w){return s.extend(ba(m),Bf(g,v,w))},gu=function(m,v){return{u_matrix:m,u_world:v}},Lf=function(m,v,g,w,B){return s.extend(Ha(m,v,g,w),{u_world:B})},ch=function(m,v,g,w){var B,D,O=m.transform;if(w.paint.get("circle-pitch-alignment")==="map"){var G=Fn(g,1,O.zoom);B=!0,D=[G,G]}else B=!1,D=O.pixelsToGLUnits;return{u_camera_to_center_distance:O.cameraToCenterDistance,u_scale_with_map:+(w.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(v.posMatrix,g,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_pitch_with_map:+B,u_device_pixel_ratio:s.browser.devicePixelRatio,u_extrude_scale:D}},Xa=function(m,v,g){var w=Fn(g,1,v.zoom),B=Math.pow(2,v.zoom-g.tileID.overscaledZ),D=g.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:v.cameraToCenterDistance,u_pixels_to_tile_units:w,u_extrude_scale:[v.pixelsToGLUnits[0]/(w*B),v.pixelsToGLUnits[1]/(w*B)],u_overscale_factor:D}},Tl=function(m,v,g){return{u_matrix:m,u_inv_matrix:v,u_camera_to_center_distance:g.cameraToCenterDistance,u_viewport_size:[g.width,g.height]}},qa=function(m,v,g){return g===void 0&&(g=1),{u_matrix:m,u_color:v,u_overlay:0,u_overlay_scale:g}},na=function(m){return{u_matrix:m}},hh=function(m,v,g,w){return{u_matrix:m,u_extrude_scale:Fn(v,1,g),u_intensity:w}},Vo=function(m,v,g){var w=m.transform;return{u_matrix:fh(m,v,g),u_ratio:1/Fn(v,1,w.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},zn=function(m,v,g,w){return s.extend(Vo(m,v,g),{u_image:0,u_image_height:w})},Sl=function(m,v,g,w){var B=m.transform,D=Pl(v,B);return{u_matrix:fh(m,v,g),u_texsize:v.imageAtlasTexture.size,u_ratio:1/Fn(v,1,B.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_image:0,u_scale:[D,w.fromScale,w.toScale],u_fade:w.t,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]]}},Df=function(m,v,g,w,B){var D=m.lineAtlas,O=Pl(v,m.transform),G=g.layout.get("line-cap")==="round",J=D.getDash(w.from,G),at=D.getDash(w.to,G),Et=J.width*B.fromScale,Ct=at.width*B.toScale;return s.extend(Vo(m,v,g),{u_patternscale_a:[O/Et,-J.height/2],u_patternscale_b:[O/Ct,-at.height/2],u_sdfgamma:D.width/(256*Math.min(Et,Ct)*s.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:J.y,u_tex_y_b:at.y,u_mix:B.t})};function Pl(m,v){return 1/Fn(m,1,v.tileZoom)}function fh(m,v,g){return m.translatePosMatrix(v.tileID.posMatrix,v,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}var dh=function(m,v,g,w,B){return{u_matrix:m,u_tl_parent:v,u_scale_parent:g,u_buffer_scale:1,u_fade_t:w.mix,u_opacity:w.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:(O=B.paint.get("raster-saturation"),O>0?1-1/(1.001-O):-O),u_contrast_factor:(D=B.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:Ac(B.paint.get("raster-hue-rotate"))};var D,O};function Ac(m){m*=Math.PI/180;var v=Math.sin(m),g=Math.cos(m);return[(2*g+1)/3,(-Math.sqrt(3)*v-g+1)/3,(Math.sqrt(3)*v-g+1)/3]}var Il,Go=function(m,v,g,w,B,D,O,G,J,at){var Et=B.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:v?v.uSizeT:0,u_size:v?v.uSize:0,u_camera_to_center_distance:Et.cameraToCenterDistance,u_pitch:Et.pitch/360*2*Math.PI,u_rotate_symbol:+g,u_aspect_ratio:Et.width/Et.height,u_fade_change:B.options.fadeDuration?B.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:O,u_coord_matrix:G,u_is_text:+J,u_pitch_with_map:+w,u_texsize:at,u_texture:0}},Rn=function(m,v,g,w,B,D,O,G,J,at,Et){var Ct=B.transform;return s.extend(Go(m,v,g,w,B,D,O,G,J,at),{u_gamma_scale:w?Math.cos(Ct._pitch)*Ct.cameraToCenterDistance:1,u_device_pixel_ratio:s.browser.devicePixelRatio,u_is_halo:1})},mc=function(m,v,g,w,B,D,O,G,J,at){return s.extend(Rn(m,v,g,w,B,D,O,G,!0,J),{u_texsize_icon:at,u_texture_icon:1})},Ml=function(m,v,g){return{u_matrix:m,u_opacity:v,u_color:g}},Ka=function(m,v,g,w,B,D){return s.extend((function(O,G,J,at){var Et=J.imageManager.getPattern(O.from.toString()),Ct=J.imageManager.getPattern(O.to.toString()),Bt=J.imageManager.getPixelSize(),Wt=Bt.width,zt=Bt.height,f=Math.pow(2,at.tileID.overscaledZ),h=at.tileSize*Math.pow(2,J.transform.tileZoom)/f,A=h*(at.tileID.canonical.x+at.tileID.wrap*f),b=h*at.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Et.tl,u_pattern_br_a:Et.br,u_pattern_tl_b:Ct.tl,u_pattern_br_b:Ct.br,u_texsize:[Wt,zt],u_mix:G.t,u_pattern_size_a:Et.displaySize,u_pattern_size_b:Ct.displaySize,u_scale_a:G.fromScale,u_scale_b:G.toScale,u_tile_units_to_pixels:1/Fn(at,1,J.transform.tileZoom),u_pixel_coord_upper:[A>>16,b>>16],u_pixel_coord_lower:[65535&A,65535&b]}})(w,D,g,B),{u_matrix:m,u_opacity:v})},kf={fillExtrusion:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_lightpos:new s.Uniform3f(m,v.u_lightpos),u_lightintensity:new s.Uniform1f(m,v.u_lightintensity),u_lightcolor:new s.Uniform3f(m,v.u_lightcolor),u_vertical_gradient:new s.Uniform1f(m,v.u_vertical_gradient),u_opacity:new s.Uniform1f(m,v.u_opacity)}},fillExtrusionPattern:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_lightpos:new s.Uniform3f(m,v.u_lightpos),u_lightintensity:new s.Uniform1f(m,v.u_lightintensity),u_lightcolor:new s.Uniform3f(m,v.u_lightcolor),u_vertical_gradient:new s.Uniform1f(m,v.u_vertical_gradient),u_height_factor:new s.Uniform1f(m,v.u_height_factor),u_image:new s.Uniform1i(m,v.u_image),u_texsize:new s.Uniform2f(m,v.u_texsize),u_pixel_coord_upper:new s.Uniform2f(m,v.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(m,v.u_pixel_coord_lower),u_scale:new s.Uniform3f(m,v.u_scale),u_fade:new s.Uniform1f(m,v.u_fade),u_opacity:new s.Uniform1f(m,v.u_opacity)}},fill:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix)}},fillPattern:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_image:new s.Uniform1i(m,v.u_image),u_texsize:new s.Uniform2f(m,v.u_texsize),u_pixel_coord_upper:new s.Uniform2f(m,v.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(m,v.u_pixel_coord_lower),u_scale:new s.Uniform3f(m,v.u_scale),u_fade:new s.Uniform1f(m,v.u_fade)}},fillOutline:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_world:new s.Uniform2f(m,v.u_world)}},fillOutlinePattern:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_world:new s.Uniform2f(m,v.u_world),u_image:new s.Uniform1i(m,v.u_image),u_texsize:new s.Uniform2f(m,v.u_texsize),u_pixel_coord_upper:new s.Uniform2f(m,v.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(m,v.u_pixel_coord_lower),u_scale:new s.Uniform3f(m,v.u_scale),u_fade:new s.Uniform1f(m,v.u_fade)}},circle:function(m,v){return{u_camera_to_center_distance:new s.Uniform1f(m,v.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(m,v.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(m,v.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(m,v.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(m,v.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(m,v.u_matrix)}},collisionBox:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_camera_to_center_distance:new s.Uniform1f(m,v.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(m,v.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(m,v.u_extrude_scale),u_overscale_factor:new s.Uniform1f(m,v.u_overscale_factor)}},collisionCircle:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_inv_matrix:new s.UniformMatrix4f(m,v.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(m,v.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(m,v.u_viewport_size)}},debug:function(m,v){return{u_color:new s.UniformColor(m,v.u_color),u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_overlay:new s.Uniform1i(m,v.u_overlay),u_overlay_scale:new s.Uniform1f(m,v.u_overlay_scale)}},clippingMask:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix)}},heatmap:function(m,v){return{u_extrude_scale:new s.Uniform1f(m,v.u_extrude_scale),u_intensity:new s.Uniform1f(m,v.u_intensity),u_matrix:new s.UniformMatrix4f(m,v.u_matrix)}},heatmapTexture:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_world:new s.Uniform2f(m,v.u_world),u_image:new s.Uniform1i(m,v.u_image),u_color_ramp:new s.Uniform1i(m,v.u_color_ramp),u_opacity:new s.Uniform1f(m,v.u_opacity)}},hillshade:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_image:new s.Uniform1i(m,v.u_image),u_latrange:new s.Uniform2f(m,v.u_latrange),u_light:new s.Uniform2f(m,v.u_light),u_shadow:new s.UniformColor(m,v.u_shadow),u_highlight:new s.UniformColor(m,v.u_highlight),u_accent:new s.UniformColor(m,v.u_accent)}},hillshadePrepare:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_image:new s.Uniform1i(m,v.u_image),u_dimension:new s.Uniform2f(m,v.u_dimension),u_zoom:new s.Uniform1f(m,v.u_zoom),u_unpack:new s.Uniform4f(m,v.u_unpack)}},line:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_ratio:new s.Uniform1f(m,v.u_ratio),u_device_pixel_ratio:new s.Uniform1f(m,v.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(m,v.u_units_to_pixels)}},lineGradient:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_ratio:new s.Uniform1f(m,v.u_ratio),u_device_pixel_ratio:new s.Uniform1f(m,v.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(m,v.u_units_to_pixels),u_image:new s.Uniform1i(m,v.u_image),u_image_height:new s.Uniform1f(m,v.u_image_height)}},linePattern:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_texsize:new s.Uniform2f(m,v.u_texsize),u_ratio:new s.Uniform1f(m,v.u_ratio),u_device_pixel_ratio:new s.Uniform1f(m,v.u_device_pixel_ratio),u_image:new s.Uniform1i(m,v.u_image),u_units_to_pixels:new s.Uniform2f(m,v.u_units_to_pixels),u_scale:new s.Uniform3f(m,v.u_scale),u_fade:new s.Uniform1f(m,v.u_fade)}},lineSDF:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_ratio:new s.Uniform1f(m,v.u_ratio),u_device_pixel_ratio:new s.Uniform1f(m,v.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(m,v.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(m,v.u_patternscale_a),u_patternscale_b:new s.Uniform2f(m,v.u_patternscale_b),u_sdfgamma:new s.Uniform1f(m,v.u_sdfgamma),u_image:new s.Uniform1i(m,v.u_image),u_tex_y_a:new s.Uniform1f(m,v.u_tex_y_a),u_tex_y_b:new s.Uniform1f(m,v.u_tex_y_b),u_mix:new s.Uniform1f(m,v.u_mix)}},raster:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_tl_parent:new s.Uniform2f(m,v.u_tl_parent),u_scale_parent:new s.Uniform1f(m,v.u_scale_parent),u_buffer_scale:new s.Uniform1f(m,v.u_buffer_scale),u_fade_t:new s.Uniform1f(m,v.u_fade_t),u_opacity:new s.Uniform1f(m,v.u_opacity),u_image0:new s.Uniform1i(m,v.u_image0),u_image1:new s.Uniform1i(m,v.u_image1),u_brightness_low:new s.Uniform1f(m,v.u_brightness_low),u_brightness_high:new s.Uniform1f(m,v.u_brightness_high),u_saturation_factor:new s.Uniform1f(m,v.u_saturation_factor),u_contrast_factor:new s.Uniform1f(m,v.u_contrast_factor),u_spin_weights:new s.Uniform3f(m,v.u_spin_weights)}},symbolIcon:function(m,v){return{u_is_size_zoom_constant:new s.Uniform1i(m,v.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(m,v.u_is_size_feature_constant),u_size_t:new s.Uniform1f(m,v.u_size_t),u_size:new s.Uniform1f(m,v.u_size),u_camera_to_center_distance:new s.Uniform1f(m,v.u_camera_to_center_distance),u_pitch:new s.Uniform1f(m,v.u_pitch),u_rotate_symbol:new s.Uniform1i(m,v.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(m,v.u_aspect_ratio),u_fade_change:new s.Uniform1f(m,v.u_fade_change),u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(m,v.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(m,v.u_coord_matrix),u_is_text:new s.Uniform1i(m,v.u_is_text),u_pitch_with_map:new s.Uniform1i(m,v.u_pitch_with_map),u_texsize:new s.Uniform2f(m,v.u_texsize),u_texture:new s.Uniform1i(m,v.u_texture)}},symbolSDF:function(m,v){return{u_is_size_zoom_constant:new s.Uniform1i(m,v.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(m,v.u_is_size_feature_constant),u_size_t:new s.Uniform1f(m,v.u_size_t),u_size:new s.Uniform1f(m,v.u_size),u_camera_to_center_distance:new s.Uniform1f(m,v.u_camera_to_center_distance),u_pitch:new s.Uniform1f(m,v.u_pitch),u_rotate_symbol:new s.Uniform1i(m,v.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(m,v.u_aspect_ratio),u_fade_change:new s.Uniform1f(m,v.u_fade_change),u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(m,v.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(m,v.u_coord_matrix),u_is_text:new s.Uniform1i(m,v.u_is_text),u_pitch_with_map:new s.Uniform1i(m,v.u_pitch_with_map),u_texsize:new s.Uniform2f(m,v.u_texsize),u_texture:new s.Uniform1i(m,v.u_texture),u_gamma_scale:new s.Uniform1f(m,v.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(m,v.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(m,v.u_is_halo)}},symbolTextAndIcon:function(m,v){return{u_is_size_zoom_constant:new s.Uniform1i(m,v.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(m,v.u_is_size_feature_constant),u_size_t:new s.Uniform1f(m,v.u_size_t),u_size:new s.Uniform1f(m,v.u_size),u_camera_to_center_distance:new s.Uniform1f(m,v.u_camera_to_center_distance),u_pitch:new s.Uniform1f(m,v.u_pitch),u_rotate_symbol:new s.Uniform1i(m,v.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(m,v.u_aspect_ratio),u_fade_change:new s.Uniform1f(m,v.u_fade_change),u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(m,v.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(m,v.u_coord_matrix),u_is_text:new s.Uniform1i(m,v.u_is_text),u_pitch_with_map:new s.Uniform1i(m,v.u_pitch_with_map),u_texsize:new s.Uniform2f(m,v.u_texsize),u_texsize_icon:new s.Uniform2f(m,v.u_texsize_icon),u_texture:new s.Uniform1i(m,v.u_texture),u_texture_icon:new s.Uniform1i(m,v.u_texture_icon),u_gamma_scale:new s.Uniform1f(m,v.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(m,v.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(m,v.u_is_halo)}},background:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_opacity:new s.Uniform1f(m,v.u_opacity),u_color:new s.UniformColor(m,v.u_color)}},backgroundPattern:function(m,v){return{u_matrix:new s.UniformMatrix4f(m,v.u_matrix),u_opacity:new s.Uniform1f(m,v.u_opacity),u_image:new s.Uniform1i(m,v.u_image),u_pattern_tl_a:new s.Uniform2f(m,v.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(m,v.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(m,v.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(m,v.u_pattern_br_b),u_texsize:new s.Uniform2f(m,v.u_texsize),u_mix:new s.Uniform1f(m,v.u_mix),u_pattern_size_a:new s.Uniform2f(m,v.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(m,v.u_pattern_size_b),u_scale_a:new s.Uniform1f(m,v.u_scale_a),u_scale_b:new s.Uniform1f(m,v.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(m,v.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(m,v.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(m,v.u_tile_units_to_pixels)}}};function Bl(m,v,g,w,B,D,O){for(var G=m.context,J=G.gl,at=m.useProgram("collisionBox"),Et=[],Ct=0,Bt=0,Wt=0;Wt<w.length;Wt++){var zt=w[Wt],f=v.getTile(zt),h=f.getBucket(g);if(h){var A=zt.posMatrix;B[0]===0&&B[1]===0||(A=m.translatePosMatrix(zt.posMatrix,f,B,D));var b=O?h.textCollisionBox:h.iconCollisionBox,E=h.collisionCircleArray;if(E.length>0){var S=s.create(),P=A;s.mul(S,h.placementInvProjMatrix,m.transform.glCoordMatrix),s.mul(S,S,h.placementViewportMatrix),Et.push({circleArray:E,circleOffset:Bt,transform:P,invTransform:S}),Bt=Ct+=E.length/4}b&&at.draw(G,J.LINES,xt.disabled,Nt.disabled,m.colorModeForRenderPass(),wt.disabled,Xa(A,m.transform,f),g.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,m.transform.zoom,null,null,b.collisionVertexBuffer)}}if(O&&Et.length){var R=m.useProgram("collisionCircle"),F=new s.StructArrayLayout2f1f2i16;F.resize(4*Ct),F._trim();for(var U=0,W=0,ht=Et;W<ht.length;W+=1)for(var Pt=ht[W],It=0;It<Pt.circleArray.length/4;It++){var Mt=4*It,Yt=Pt.circleArray[Mt+0],Ht=Pt.circleArray[Mt+1],ie=Pt.circleArray[Mt+2],te=Pt.circleArray[Mt+3];F.emplace(U++,Yt,Ht,ie,te,0),F.emplace(U++,Yt,Ht,ie,te,1),F.emplace(U++,Yt,Ht,ie,te,2),F.emplace(U++,Yt,Ht,ie,te,3)}(!Il||Il.length<2*Ct)&&(Il=(function(Ci){var ji=2*Ci,Ti=new s.StructArrayLayout3ui6;Ti.resize(ji),Ti._trim();for(var ai=0;ai<ji;ai++){var We=6*ai;Ti.uint16[We+0]=4*ai+0,Ti.uint16[We+1]=4*ai+1,Ti.uint16[We+2]=4*ai+2,Ti.uint16[We+3]=4*ai+2,Ti.uint16[We+4]=4*ai+3,Ti.uint16[We+5]=4*ai+0}return Ti})(Ct));for(var Jt=G.createIndexBuffer(Il,!0),qt=G.createVertexBuffer(F,s.collisionCircleLayout.members,!0),Be=0,Ge=Et;Be<Ge.length;Be+=1){var ze=Ge[Be],Ri=Tl(ze.transform,ze.invTransform,m.transform);R.draw(G,J.TRIANGLES,xt.disabled,Nt.disabled,m.colorModeForRenderPass(),wt.disabled,Ri,g.id,qt,Jt,s.SegmentVector.simpleSegment(0,2*ze.circleOffset,ze.circleArray.length,ze.circleArray.length/2),null,m.transform.zoom,null,null,null)}qt.destroy(),Jt.destroy()}}var _o=s.identity(new Float32Array(16));function Of(m,v,g,w,B,D){var O=s.getAnchorAlignment(m),G=-(O.horizontalAlign-.5)*v,J=-(O.verticalAlign-.5)*g,at=s.evaluateVariableOffset(m,w);return new s.Point((G/B+at[0])*D,(J/B+at[1])*D)}function vs(m,v,g,w,B,D,O,G,J,at,Et){var Ct=m.text.placedSymbolArray,Bt=m.text.dynamicLayoutVertexArray,Wt=m.icon.dynamicLayoutVertexArray,zt={};Bt.clear();for(var f=0;f<Ct.length;f++){var h=Ct.get(f),A=h.hidden||!h.crossTileID||m.allowVerticalPlacement&&!h.placedOrientation?null:w[h.crossTileID];if(A){var b=new s.Point(h.anchorX,h.anchorY),E=ti(b,g?G:O),S=sn(D.cameraToCenterDistance,E.signedDistanceFromCamera),P=B.evaluateSizeForFeature(m.textSizeData,at,h)*S/s.ONE_EM;g&&(P*=m.tilePixelRatio/J);for(var R=Of(A.anchor,A.width,A.height,A.textOffset,A.textBoxScale,P),F=g?ti(b.add(R),O).point:E.point.add(v?R.rotate(-D.angle):R),U=m.allowVerticalPlacement&&h.placedOrientation===s.WritingMode.vertical?Math.PI/2:0,W=0;W<h.numGlyphs;W++)s.addDynamicAttributes(Bt,F,U);Et&&h.associatedIconIndex>=0&&(zt[h.associatedIconIndex]={shiftedAnchor:F,angle:U})}else Lr(h.numGlyphs,Bt)}if(Et){Wt.clear();for(var ht=m.icon.placedSymbolArray,Pt=0;Pt<ht.length;Pt++){var It=ht.get(Pt);if(It.hidden)Lr(It.numGlyphs,Wt);else{var Mt=zt[Pt];if(Mt)for(var Yt=0;Yt<It.numGlyphs;Yt++)s.addDynamicAttributes(Wt,Mt.shiftedAnchor,Mt.angle);else Lr(It.numGlyphs,Wt)}}m.icon.dynamicLayoutVertexBuffer.updateData(Wt)}m.text.dynamicLayoutVertexBuffer.updateData(Bt)}function gc(m,v,g){return g.iconsInText&&v?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Ks(m,v,g,w,B,D,O,G,J,at,Et,Ct){for(var Bt=m.context,Wt=Bt.gl,zt=m.transform,f=G==="map",h=J==="map",A=f&&g.layout.get("symbol-placement")!=="point",b=f&&!h&&!A,E=g.layout.get("symbol-sort-key").constantOr(1)!==void 0,S=!1,P=m.depthModeForSublayer(0,xt.ReadOnly),R=g.layout.get("text-variable-anchor"),F=[],U=0,W=w;U<W.length;U+=1){var ht=W[U],Pt=v.getTile(ht),It=Pt.getBucket(g);if(It){var Mt=B?It.text:It.icon;if(Mt&&Mt.segments.get().length){var Yt=Mt.programConfigurations.get(g.id),Ht=B||It.sdfIcons,ie=B?It.textSizeData:It.iconSizeData,te=h||zt.pitch!==0,Jt=m.useProgram(gc(Ht,B,It),Yt),qt=s.evaluateSizeForZoom(ie,zt.zoom),Be=void 0,Ge=[0,0],ze=void 0,Ri=void 0,Ci=null,ji=void 0;if(B)ze=Pt.glyphAtlasTexture,Ri=Wt.LINEAR,Be=Pt.glyphAtlasTexture.size,It.iconsInText&&(Ge=Pt.imageAtlasTexture.size,Ci=Pt.imageAtlasTexture,ji=te||m.options.rotating||m.options.zooming||ie.kind==="composite"||ie.kind==="camera"?Wt.LINEAR:Wt.NEAREST);else{var Ti=g.layout.get("icon-size").constantOr(0)!==1||It.iconsNeedLinear;ze=Pt.imageAtlasTexture,Ri=Ht||m.options.rotating||m.options.zooming||Ti||te?Wt.LINEAR:Wt.NEAREST,Be=Pt.imageAtlasTexture.size}var ai=Fn(Pt,1,m.transform.zoom),We=mi(ht.posMatrix,h,f,m.transform,ai),Wi=_t(ht.posMatrix,h,f,m.transform,ai),fn=R&&It.hasTextData(),Zi=g.layout.get("icon-text-fit")!=="none"&&fn&&It.hasIconData();A&&ga(It,ht.posMatrix,m,B,We,Wi,h,at);var gn=m.translatePosMatrix(ht.posMatrix,Pt,D,O),or=A||B&&R||Zi?_o:We,Ys=m.translatePosMatrix(Wi,Pt,D,O,!0),xh=Ht&&g.paint.get(B?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Tc={program:Jt,buffers:Mt,uniformValues:Ht?It.iconsInText?mc(ie.kind,qt,b,h,m,gn,or,Ys,Be,Ge):Rn(ie.kind,qt,b,h,m,gn,or,Ys,B,Be):Go(ie.kind,qt,b,h,m,gn,or,Ys,B,Be),atlasTexture:ze,atlasTextureIcon:Ci,atlasInterpolation:Ri,atlasInterpolationIcon:ji,isSDF:Ht,hasHalo:xh};if(E&&It.canOverlap){S=!0;for(var Vl=0,Sc=Mt.segments.get();Vl<Sc.length;Vl+=1){var wh=Sc[Vl];F.push({segments:new s.SegmentVector([wh]),sortKey:wh.sortKey,state:Tc})}}else F.push({segments:Mt.segments,sortKey:0,state:Tc})}}}S&&F.sort(function(Gl,Mu){return Gl.sortKey-Mu.sortKey});for(var Ta=0,Eh=F;Ta<Eh.length;Ta+=1){var Sa=Eh[Ta],Zr=Sa.state;if(Bt.activeTexture.set(Wt.TEXTURE0),Zr.atlasTexture.bind(Zr.atlasInterpolation,Wt.CLAMP_TO_EDGE),Zr.atlasTextureIcon&&(Bt.activeTexture.set(Wt.TEXTURE1),Zr.atlasTextureIcon&&Zr.atlasTextureIcon.bind(Zr.atlasInterpolationIcon,Wt.CLAMP_TO_EDGE)),Zr.isSDF){var $a=Zr.uniformValues;Zr.hasHalo&&($a.u_is_halo=1,yu(Zr.buffers,Sa.segments,g,m,Zr.program,P,Et,Ct,$a)),$a.u_is_halo=0}yu(Zr.buffers,Sa.segments,g,m,Zr.program,P,Et,Ct,Zr.uniformValues)}}function yu(m,v,g,w,B,D,O,G,J){var at=w.context;B.draw(at,at.gl.TRIANGLES,D,O,G,wt.disabled,J,g.id,m.layoutVertexBuffer,m.indexBuffer,v,g.paint,w.transform.zoom,m.programConfigurations.get(g.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Rl(m,v,g,w,B,D,O){var G,J,at,Et,Ct,Bt=m.context.gl,Wt=g.paint.get("fill-pattern"),zt=Wt&&Wt.constantOr(1),f=g.getCrossfadeParameters();O?(J=zt&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=Bt.LINES):(J=zt?"fillPattern":"fill",G=Bt.TRIANGLES);for(var h=0,A=w;h<A.length;h+=1){var b=A[h],E=v.getTile(b);if(!zt||E.patternsLoaded()){var S=E.getBucket(g);if(S){var P=S.programConfigurations.get(g.id),R=m.useProgram(J,P);zt&&(m.context.activeTexture.set(Bt.TEXTURE0),E.imageAtlasTexture.bind(Bt.LINEAR,Bt.CLAMP_TO_EDGE),P.updatePaintBuffers(f));var F=Wt.constantOr(null);if(F&&E.imageAtlas){var U=E.imageAtlas,W=U.patternPositions[F.to.toString()],ht=U.patternPositions[F.from.toString()];W&&ht&&P.setConstantPatternPositions(W,ht)}var Pt=m.translatePosMatrix(b.posMatrix,E,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(O){Et=S.indexBuffer2,Ct=S.segments2;var It=[Bt.drawingBufferWidth,Bt.drawingBufferHeight];at=J==="fillOutlinePattern"&&zt?Lf(Pt,m,f,E,It):gu(Pt,It)}else Et=S.indexBuffer,Ct=S.segments,at=zt?Ha(Pt,m,f,E):ba(Pt);R.draw(m.context,G,B,m.stencilModeForClipping(b),D,wt.disabled,at,g.id,S.layoutVertexBuffer,Et,Ct,g.paint,m.transform.zoom,P)}}}}function ph(m,v,g,w,B,D,O){for(var G=m.context,J=G.gl,at=g.paint.get("fill-extrusion-pattern"),Et=at.constantOr(1),Ct=g.getCrossfadeParameters(),Bt=g.paint.get("fill-extrusion-opacity"),Wt=0,zt=w;Wt<zt.length;Wt+=1){var f=zt[Wt],h=v.getTile(f),A=h.getBucket(g);if(A){var b=A.programConfigurations.get(g.id),E=m.useProgram(Et?"fillExtrusionPattern":"fillExtrusion",b);Et&&(m.context.activeTexture.set(J.TEXTURE0),h.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),b.updatePaintBuffers(Ct));var S=at.constantOr(null);if(S&&h.imageAtlas){var P=h.imageAtlas,R=P.patternPositions[S.to.toString()],F=P.patternPositions[S.from.toString()];R&&F&&b.setConstantPatternPositions(R,F)}var U=m.translatePosMatrix(f.posMatrix,h,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),W=g.paint.get("fill-extrusion-vertical-gradient"),ht=Et?Wa(U,m,W,Bt,f,Ct,h):Rf(U,m,W,Bt);E.draw(G,G.gl.TRIANGLES,B,D,O,wt.backCCW,ht,g.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,g.paint,m.transform.zoom,b)}}}function _s(m,v,g,w,B,D){var O=m.context,G=O.gl,J=v.fbo;if(J){var at=m.useProgram("hillshade");O.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,J.colorAttachment.get());var Et=(function(Ct,Bt,Wt){var zt=Wt.paint.get("hillshade-shadow-color"),f=Wt.paint.get("hillshade-highlight-color"),h=Wt.paint.get("hillshade-accent-color"),A=Wt.paint.get("hillshade-illumination-direction")*(Math.PI/180);Wt.paint.get("hillshade-illumination-anchor")==="viewport"&&(A-=Ct.transform.angle);var b,E,S,P=!Ct.options.moving;return{u_matrix:Ct.transform.calculatePosMatrix(Bt.tileID.toUnwrapped(),P),u_image:0,u_latrange:(b=Bt.tileID,E=Math.pow(2,b.canonical.z),S=b.canonical.y,[new s.MercatorCoordinate(0,S/E).toLngLat().lat,new s.MercatorCoordinate(0,(S+1)/E).toLngLat().lat]),u_light:[Wt.paint.get("hillshade-exaggeration"),A],u_shadow:zt,u_highlight:f,u_accent:h}})(m,v,g);at.draw(O,G.TRIANGLES,w,B,D,wt.disabled,Et,g.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}}function Ah(m,v,g,w,B,D){var O=m.context,G=O.gl,J=v.dem;if(J&&J.data){var at=J.dim,Et=J.stride,Ct=J.getPixels();if(O.activeTexture.set(G.TEXTURE1),O.pixelStoreUnpackPremultiplyAlpha.set(!1),v.demTexture=v.demTexture||m.getTileTexture(Et),v.demTexture){var Bt=v.demTexture;Bt.update(Ct,{premultiply:!1}),Bt.bind(G.NEAREST,G.CLAMP_TO_EDGE)}else v.demTexture=new s.Texture(O,Ct,G.RGBA,{premultiply:!1}),v.demTexture.bind(G.NEAREST,G.CLAMP_TO_EDGE);O.activeTexture.set(G.TEXTURE0);var Wt=v.fbo;if(!Wt){var zt=new s.Texture(O,{width:at,height:at,data:null},G.RGBA);zt.bind(G.LINEAR,G.CLAMP_TO_EDGE),(Wt=v.fbo=O.createFramebuffer(at,at,!0)).colorAttachment.set(zt.texture)}O.bindFramebuffer.set(Wt.framebuffer),O.viewport.set([0,0,at,at]),m.useProgram("hillshadePrepare").draw(O,G.TRIANGLES,w,B,D,wt.disabled,(function(f,h){var A=h.stride,b=s.create();return s.ortho(b,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(b,b,[0,-s.EXTENT,0]),{u_matrix:b,u_image:1,u_dimension:[A,A],u_zoom:f.overscaledZ,u_unpack:h.getUnpackVector()}})(v.tileID,J),g.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),v.needsHillshadePrepare=!1}}function Ll(m,v,g,w,B){var D=w.paint.get("raster-fade-duration");if(D>0){var O=s.browser.now(),G=(O-m.timeAdded)/D,J=v?(O-v.timeAdded)/D:-1,at=g.getSource(),Et=B.coveringZoomLevel({tileSize:at.tileSize,roundZoom:at.roundZoom}),Ct=!v||Math.abs(v.tileID.overscaledZ-Et)>Math.abs(m.tileID.overscaledZ-Et),Bt=Ct&&m.refreshedUponExpiration?1:s.clamp(Ct?G:1-J,0,1);return m.refreshedUponExpiration&&G>=1&&(m.refreshedUponExpiration=!1),v?{opacity:1,mix:1-Bt}:{opacity:Bt,mix:0}}return{opacity:1,mix:0}}var xa=new s.Color(1,0,0,1),wa=new s.Color(0,1,0,1),Za=new s.Color(0,0,1,1),yc=new s.Color(1,0,1,1),vc=new s.Color(0,1,1,1);function mh(m,v,g,w){_u(m,0,v+g/2,m.transform.width,g,w)}function vu(m,v,g,w){_u(m,v-g/2,0,g,m.transform.height,w)}function _u(m,v,g,w,B,D){var O=m.context,G=O.gl;G.enable(G.SCISSOR_TEST),G.scissor(v*s.browser.devicePixelRatio,g*s.browser.devicePixelRatio,w*s.browser.devicePixelRatio,B*s.browser.devicePixelRatio),O.clear({color:D}),G.disable(G.SCISSOR_TEST)}function Ff(m,v,g){var w=m.context,B=w.gl,D=g.posMatrix,O=m.useProgram("debug"),G=xt.disabled,J=Nt.disabled,at=m.colorModeForRenderPass();w.activeTexture.set(B.TEXTURE0),m.emptyTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),O.draw(w,B.LINE_STRIP,G,J,at,wt.disabled,qa(D,s.Color.red),"$debug",m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments);var Et=v.getTileByID(g.key).latestRawTileData,Ct=Math.floor((Et&&Et.byteLength||0)/1024),Bt=v.getTile(g).tileSize,Wt=512/Math.min(Bt,512)*(g.overscaledZ/m.transform.zoom)*.5,zt=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(zt+=" => "+g.overscaledZ),(function(f,h){f.initDebugOverlayCanvas();var A=f.debugOverlayCanvas,b=f.context.gl,E=f.debugOverlayCanvas.getContext("2d");E.clearRect(0,0,A.width,A.height),E.shadowColor="white",E.shadowBlur=2,E.lineWidth=1.5,E.strokeStyle="white",E.textBaseline="top",E.font="bold 36px Open Sans, sans-serif",E.fillText(h,5,5),E.strokeText(h,5,5),f.debugOverlayTexture.update(A),f.debugOverlayTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE)})(m,zt+" "+Ct+"kb"),O.draw(w,B.TRIANGLES,G,J,mt.alphaBlended,wt.disabled,qa(D,s.Color.transparent,Wt),"$debug",m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}var ra={symbol:function(m,v,g,w,B){if(m.renderPass==="translucent"){var D=Nt.disabled,O=m.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&(function(G,J,at,Et,Ct,Bt,Wt){for(var zt=J.transform,f=Ct==="map",h=Bt==="map",A=0,b=G;A<b.length;A+=1){var E=b[A],S=Et.getTile(E),P=S.getBucket(at);if(P&&P.text&&P.text.segments.get().length){var R=s.evaluateSizeForZoom(P.textSizeData,zt.zoom),F=Fn(S,1,J.transform.zoom),U=mi(E.posMatrix,h,f,J.transform,F),W=at.layout.get("icon-text-fit")!=="none"&&P.hasIconData();if(R){var ht=Math.pow(2,zt.zoom-S.tileID.overscaledZ);vs(P,f,h,Wt,s.symbolSize,zt,U,E.posMatrix,ht,R,W)}}}})(w,m,g,v,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),B),g.paint.get("icon-opacity").constantOr(1)!==0&&Ks(m,v,g,w,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),D,O),g.paint.get("text-opacity").constantOr(1)!==0&&Ks(m,v,g,w,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),D,O),v.map.showCollisionBoxes&&(Bl(m,v,g,w,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),Bl(m,v,g,w,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))}},circle:function(m,v,g,w){if(m.renderPass==="translucent"){var B=g.paint.get("circle-opacity"),D=g.paint.get("circle-stroke-width"),O=g.paint.get("circle-stroke-opacity"),G=g.layout.get("circle-sort-key").constantOr(1)!==void 0;if(B.constantOr(1)!==0||D.constantOr(1)!==0&&O.constantOr(1)!==0){for(var J=m.context,at=J.gl,Et=m.depthModeForSublayer(0,xt.ReadOnly),Ct=Nt.disabled,Bt=m.colorModeForRenderPass(),Wt=[],zt=0;zt<w.length;zt++){var f=w[zt],h=v.getTile(f),A=h.getBucket(g);if(A){var b=A.programConfigurations.get(g.id),E={programConfiguration:b,program:m.useProgram("circle",b),layoutVertexBuffer:A.layoutVertexBuffer,indexBuffer:A.indexBuffer,uniformValues:ch(m,f,h,g)};if(G)for(var S=0,P=A.segments.get();S<P.length;S+=1){var R=P[S];Wt.push({segments:new s.SegmentVector([R]),sortKey:R.sortKey,state:E})}else Wt.push({segments:A.segments,sortKey:0,state:E})}}G&&Wt.sort(function(Pt,It){return Pt.sortKey-It.sortKey});for(var F=0,U=Wt;F<U.length;F+=1){var W=U[F],ht=W.state;ht.program.draw(J,at.TRIANGLES,Et,Ct,Bt,wt.disabled,ht.uniformValues,g.id,ht.layoutVertexBuffer,ht.indexBuffer,W.segments,g.paint,m.transform.zoom,ht.programConfiguration)}}}},heatmap:function(m,v,g,w){if(g.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){var B=m.context,D=B.gl,O=Nt.disabled,G=new mt([D.ONE,D.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(Wt,zt,f){var h=Wt.gl;Wt.activeTexture.set(h.TEXTURE1),Wt.viewport.set([0,0,zt.width/4,zt.height/4]);var A=f.heatmapFbo;if(A)h.bindTexture(h.TEXTURE_2D,A.colorAttachment.get()),Wt.bindFramebuffer.set(A.framebuffer);else{var b=h.createTexture();h.bindTexture(h.TEXTURE_2D,b),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),A=f.heatmapFbo=Wt.createFramebuffer(zt.width/4,zt.height/4,!1),(function(E,S,P,R){var F=E.gl;F.texImage2D(F.TEXTURE_2D,0,F.RGBA,S.width/4,S.height/4,0,F.RGBA,E.extRenderToTextureHalfFloat?E.extTextureHalfFloat.HALF_FLOAT_OES:F.UNSIGNED_BYTE,null),R.colorAttachment.set(P)})(Wt,zt,b,A)}})(B,m,g),B.clear({color:s.Color.transparent});for(var J=0;J<w.length;J++){var at=w[J];if(!v.hasRenderableParent(at)){var Et=v.getTile(at),Ct=Et.getBucket(g);if(Ct){var Bt=Ct.programConfigurations.get(g.id);m.useProgram("heatmap",Bt).draw(B,D.TRIANGLES,xt.disabled,O,G,wt.disabled,hh(at.posMatrix,Et,m.transform.zoom,g.paint.get("heatmap-intensity")),g.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,g.paint,m.transform.zoom,Bt)}}}B.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),(function(Wt,zt){var f=Wt.context,h=f.gl,A=zt.heatmapFbo;if(A){f.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,A.colorAttachment.get()),f.activeTexture.set(h.TEXTURE1);var b=zt.colorRampTexture;b||(b=zt.colorRampTexture=new s.Texture(f,zt.colorRamp,h.RGBA)),b.bind(h.LINEAR,h.CLAMP_TO_EDGE),Wt.useProgram("heatmapTexture").draw(f,h.TRIANGLES,xt.disabled,Nt.disabled,Wt.colorModeForRenderPass(),wt.disabled,(function(E,S,P,R){var F=s.create();s.ortho(F,0,E.width,E.height,0,0,1);var U=E.context.gl;return{u_matrix:F,u_world:[U.drawingBufferWidth,U.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:S.paint.get("heatmap-opacity")}})(Wt,zt),zt.id,Wt.viewportBuffer,Wt.quadTriangleIndexBuffer,Wt.viewportSegments,zt.paint,Wt.transform.zoom)}})(m,g))},line:function(m,v,g,w){if(m.renderPass==="translucent"){var B=g.paint.get("line-opacity"),D=g.paint.get("line-width");if(B.constantOr(1)!==0&&D.constantOr(1)!==0)for(var O=m.depthModeForSublayer(0,xt.ReadOnly),G=m.colorModeForRenderPass(),J=g.paint.get("line-dasharray"),at=g.paint.get("line-pattern"),Et=at.constantOr(1),Ct=g.paint.get("line-gradient"),Bt=g.getCrossfadeParameters(),Wt=Et?"linePattern":J?"lineSDF":Ct?"lineGradient":"line",zt=m.context,f=zt.gl,h=!0,A=0,b=w;A<b.length;A+=1){var E=b[A],S=v.getTile(E);if(!Et||S.patternsLoaded()){var P=S.getBucket(g);if(P){var R=P.programConfigurations.get(g.id),F=m.context.program.get(),U=m.useProgram(Wt,R),W=h||U.program!==F,ht=at.constantOr(null);if(ht&&S.imageAtlas){var Pt=S.imageAtlas,It=Pt.patternPositions[ht.to.toString()],Mt=Pt.patternPositions[ht.from.toString()];It&&Mt&&R.setConstantPatternPositions(It,Mt)}var Yt=Et?Sl(m,S,g,Bt):J?Df(m,S,g,J,Bt):Ct?zn(m,S,g,P.lineClipsArray.length):Vo(m,S,g);if(Et)zt.activeTexture.set(f.TEXTURE0),S.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),R.updatePaintBuffers(Bt);else if(J&&(W||m.lineAtlas.dirty))zt.activeTexture.set(f.TEXTURE0),m.lineAtlas.bind(zt);else if(Ct){var Ht=P.gradients[g.id],ie=Ht.texture;if(g.gradientVersion!==Ht.version){var te=256;if(g.stepInterpolant){var Jt=v.getSource().maxzoom,qt=E.canonical.z===Jt?Math.ceil(1<<m.transform.maxZoom-E.canonical.z):1;te=s.clamp(s.nextPowerOfTwo(P.maxLineLength/s.EXTENT*1024*qt),256,zt.maxTextureSize)}Ht.gradient=s.renderColorRamp({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:te,image:Ht.gradient||void 0,clips:P.lineClipsArray}),Ht.texture?Ht.texture.update(Ht.gradient):Ht.texture=new s.Texture(zt,Ht.gradient,f.RGBA),Ht.version=g.gradientVersion,ie=Ht.texture}zt.activeTexture.set(f.TEXTURE0),ie.bind(g.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE)}U.draw(zt,f.TRIANGLES,O,m.stencilModeForClipping(E),G,wt.disabled,Yt,g.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,g.paint,m.transform.zoom,R,P.layoutVertexBuffer2),h=!1}}}}},fill:function(m,v,g,w){var B=g.paint.get("fill-color"),D=g.paint.get("fill-opacity");if(D.constantOr(1)!==0){var O=m.colorModeForRenderPass(),G=g.paint.get("fill-pattern"),J=m.opaquePassEnabledForLayer()&&!G.constantOr(1)&&B.constantOr(s.Color.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===J){var at=m.depthModeForSublayer(1,m.renderPass==="opaque"?xt.ReadWrite:xt.ReadOnly);Rl(m,v,g,w,at,O,!1)}if(m.renderPass==="translucent"&&g.paint.get("fill-antialias")){var Et=m.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,xt.ReadOnly);Rl(m,v,g,w,Et,O,!0)}}},"fill-extrusion":function(m,v,g,w){var B=g.paint.get("fill-extrusion-opacity");if(B!==0&&m.renderPass==="translucent"){var D=new xt(m.context.gl.LEQUAL,xt.ReadWrite,m.depthRangeFor3D);if(B!==1||g.paint.get("fill-extrusion-pattern").constantOr(1))ph(m,v,g,w,D,Nt.disabled,mt.disabled),ph(m,v,g,w,D,m.stencilModeFor3D(),m.colorModeForRenderPass());else{var O=m.colorModeForRenderPass();ph(m,v,g,w,D,Nt.disabled,O)}}},hillshade:function(m,v,g,w){if(m.renderPass==="offscreen"||m.renderPass==="translucent"){for(var B=m.context,D=m.depthModeForSublayer(0,xt.ReadOnly),O=m.colorModeForRenderPass(),G=m.renderPass==="translucent"?m.stencilConfigForOverlap(w):[{},w],J=G[0],at=0,Et=G[1];at<Et.length;at+=1){var Ct=Et[at],Bt=v.getTile(Ct);Bt.needsHillshadePrepare&&m.renderPass==="offscreen"?Ah(m,Bt,g,D,Nt.disabled,O):m.renderPass==="translucent"&&_s(m,Bt,g,D,J[Ct.overscaledZ],O)}B.viewport.set([0,0,m.width,m.height])}},raster:function(m,v,g,w){if(m.renderPass==="translucent"&&g.paint.get("raster-opacity")!==0&&w.length)for(var B=m.context,D=B.gl,O=v.getSource(),G=m.useProgram("raster"),J=m.colorModeForRenderPass(),at=O instanceof ye?[{},w]:m.stencilConfigForOverlap(w),Et=at[0],Ct=at[1],Bt=Ct[Ct.length-1].overscaledZ,Wt=!m.options.moving,zt=0,f=Ct;zt<f.length;zt+=1){var h=f[zt],A=m.depthModeForSublayer(h.overscaledZ-Bt,g.paint.get("raster-opacity")===1?xt.ReadWrite:xt.ReadOnly,D.LESS),b=v.getTile(h),E=m.transform.calculatePosMatrix(h.toUnwrapped(),Wt);b.registerFadeDuration(g.paint.get("raster-fade-duration"));var S=v.findLoadedParent(h,0),P=Ll(b,S,v,g,m.transform),R=void 0,F=void 0,U=g.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;B.activeTexture.set(D.TEXTURE0),b.texture.bind(U,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(D.TEXTURE1),S?(S.texture.bind(U,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),R=Math.pow(2,S.tileID.overscaledZ-b.tileID.overscaledZ),F=[b.tileID.canonical.x*R%1,b.tileID.canonical.y*R%1]):b.texture.bind(U,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);var W=dh(E,F||[0,0],R||1,P,g);O instanceof ye?G.draw(B,D.TRIANGLES,A,Nt.disabled,J,wt.disabled,W,g.id,O.boundsBuffer,m.quadTriangleIndexBuffer,O.boundsSegments):G.draw(B,D.TRIANGLES,A,Et[h.overscaledZ],J,wt.disabled,W,g.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,v,g){var w=g.paint.get("background-color"),B=g.paint.get("background-opacity");if(B!==0){var D=m.context,O=D.gl,G=m.transform,J=G.tileSize,at=g.paint.get("background-pattern");if(!m.isPatternMissing(at)){var Et=!at&&w.a===1&&B===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass===Et){var Ct=Nt.disabled,Bt=m.depthModeForSublayer(0,Et==="opaque"?xt.ReadWrite:xt.ReadOnly),Wt=m.colorModeForRenderPass(),zt=m.useProgram(at?"backgroundPattern":"background"),f=G.coveringTiles({tileSize:J});at&&(D.activeTexture.set(O.TEXTURE0),m.imageManager.bind(m.context));for(var h=g.getCrossfadeParameters(),A=0,b=f;A<b.length;A+=1){var E=b[A],S=m.transform.calculatePosMatrix(E.toUnwrapped()),P=at?Ka(S,B,m,at,{tileID:E,tileSize:J},h):Ml(S,B,w);zt.draw(D,O.TRIANGLES,Bt,Ct,Wt,wt.disabled,P,g.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}}}},debug:function(m,v,g){for(var w=0;w<g.length;w++)Ff(m,v,g[w])},custom:function(m,v,g){var w=m.context,B=g.implementation;if(m.renderPass==="offscreen"){var D=B.prerender;D&&(m.setCustomLayerDefaults(),w.setColorMode(m.colorModeForRenderPass()),D.call(B,w.gl,m.transform.customLayerMatrix()),w.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),w.setColorMode(m.colorModeForRenderPass()),w.setStencilMode(Nt.disabled);var O=B.renderingMode==="3d"?new xt(m.context.gl.LEQUAL,xt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,xt.ReadOnly);w.setDepthMode(O),B.render(w.gl,m.transform.customLayerMatrix()),w.setDirty(),m.setBaseState(),w.bindFramebuffer.set(null)}}},Wn=function(m,v){this.context=new lt(m),this.transform=v,this._tileTextures={},this.setup(),this.numSublayers=pt.maxUnderzooming+pt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $o,this.gpuTimers={}};Wn.prototype.resize=function(m,v){if(this.width=m*s.browser.devicePixelRatio,this.height=v*s.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var g=0,w=this.style._order;g<w.length;g+=1)this.style._layers[w[g]].resize()},Wn.prototype.setup=function(){var m=this.context,v=new s.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(s.EXTENT,0),v.emplaceBack(0,s.EXTENT),v.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=m.createVertexBuffer(v,gr.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);var g=new s.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(s.EXTENT,0),g.emplaceBack(0,s.EXTENT),g.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=m.createVertexBuffer(g,gr.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);var w=new s.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(s.EXTENT,0,s.EXTENT,0),w.emplaceBack(0,s.EXTENT,0,s.EXTENT),w.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=m.createVertexBuffer(w,de.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);var B=new s.StructArrayLayout2i4;B.emplaceBack(0,0),B.emplaceBack(1,0),B.emplaceBack(0,1),B.emplaceBack(1,1),this.viewportBuffer=m.createVertexBuffer(B,gr.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);var D=new s.StructArrayLayout1ui2;D.emplaceBack(0),D.emplaceBack(1),D.emplaceBack(3),D.emplaceBack(2),D.emplaceBack(0),this.tileBorderIndexBuffer=m.createIndexBuffer(D);var O=new s.StructArrayLayout3ui6;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=m.createIndexBuffer(O),this.emptyTexture=new s.Texture(m,{width:1,height:1,data:new Uint8Array([0,0,0,0])},m.gl.RGBA);var G=this.context.gl;this.stencilClearMode=new Nt({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO)},Wn.prototype.clearStencil=function(){var m=this.context,v=m.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var g=s.create();s.ortho(g,0,this.width,this.height,0,0,1),s.scale(g,g,[v.drawingBufferWidth,v.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(m,v.TRIANGLES,xt.disabled,this.stencilClearMode,mt.disabled,wt.disabled,na(g),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Wn.prototype._renderTileClippingMasks=function(m,v){if(this.currentStencilSource!==m.source&&m.isTileClipped()&&v&&v.length){this.currentStencilSource=m.source;var g=this.context,w=g.gl;this.nextStencilID+v.length>256&&this.clearStencil(),g.setColorMode(mt.disabled),g.setDepthMode(xt.disabled);var B=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var D=0,O=v;D<O.length;D+=1){var G=O[D],J=this._tileClippingMaskIDs[G.key]=this.nextStencilID++;B.draw(g,w.TRIANGLES,xt.disabled,new Nt({func:w.ALWAYS,mask:0},J,255,w.KEEP,w.KEEP,w.REPLACE),mt.disabled,wt.disabled,na(G.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Wn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var m=this.nextStencilID++,v=this.context.gl;return new Nt({func:v.NOTEQUAL,mask:255},m,255,v.KEEP,v.KEEP,v.REPLACE)},Wn.prototype.stencilModeForClipping=function(m){var v=this.context.gl;return new Nt({func:v.EQUAL,mask:255},this._tileClippingMaskIDs[m.key],0,v.KEEP,v.KEEP,v.REPLACE)},Wn.prototype.stencilConfigForOverlap=function(m){var v,g=this.context.gl,w=m.sort(function(J,at){return at.overscaledZ-J.overscaledZ}),B=w[w.length-1].overscaledZ,D=w[0].overscaledZ-B+1;if(D>1){this.currentStencilSource=void 0,this.nextStencilID+D>256&&this.clearStencil();for(var O={},G=0;G<D;G++)O[G+B]=new Nt({func:g.GEQUAL,mask:255},G+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=D,[O,w]}return[(v={},v[B]=Nt.disabled,v),w]},Wn.prototype.colorModeForRenderPass=function(){var m=this.context.gl;return this._showOverdrawInspector?new mt([m.CONSTANT_COLOR,m.ONE],new s.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mt.unblended:mt.alphaBlended},Wn.prototype.depthModeForSublayer=function(m,v,g){if(!this.opaquePassEnabledForLayer())return xt.disabled;var w=1-((1+this.currentLayer)*this.numSublayers+m)*this.depthEpsilon;return new xt(g||this.context.gl.LEQUAL,v,[w,w])},Wn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Wn.prototype.render=function(m,v){var g=this;this.style=m,this.options=v,this.lineAtlas=m.lineAtlas,this.imageManager=m.imageManager,this.glyphManager=m.glyphManager,this.symbolFadeChange=m.placement.symbolFadeChange(s.browser.now()),this.imageManager.beginFrame();var w=this.style._order,B=this.style.sourceCaches;for(var D in B){var O=B[D];O.used&&O.prepare(this.context)}var G,J,at={},Et={},Ct={};for(var Bt in B){var Wt=B[Bt];at[Bt]=Wt.getVisibleCoordinates(),Et[Bt]=at[Bt].slice().reverse(),Ct[Bt]=Wt.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var zt=0;zt<w.length;zt++)if(this.style._layers[w[zt]].is3D()){this.opaquePassCutoff=zt;break}this.renderPass="offscreen";for(var f=0,h=w;f<h.length;f+=1){var A=this.style._layers[h[f]];if(A.hasOffscreenPass()&&!A.isHidden(this.transform.zoom)){var b=Et[A.source];(A.type==="custom"||b.length)&&this.renderLayer(this,B[A.source],A,b)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:v.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=v.showOverdrawInspector,this.depthRangeFor3D=[0,1-(m._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){var E=this.style._layers[w[this.currentLayer]],S=B[E.source],P=at[E.source];this._renderTileClippingMasks(E,P),this.renderLayer(this,S,E,P)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){var R=this.style._layers[w[this.currentLayer]],F=B[R.source],U=(R.type==="symbol"?Ct:Et)[R.source];this._renderTileClippingMasks(R,at[R.source]),this.renderLayer(this,F,R,U)}this.options.showTileBoundaries&&(s.values(this.style._layers).forEach(function(W){W.source&&!W.isHidden(g.transform.zoom)&&(W.source!==(J&&J.id)&&(J=g.style.sourceCaches[W.source]),(!G||G.getSource().maxzoom<J.getSource().maxzoom)&&(G=J))}),G&&ra.debug(this,G,G.getVisibleCoordinates())),this.options.showPadding&&(function(W){var ht=W.transform.padding;mh(W,W.transform.height-(ht.top||0),3,xa),mh(W,ht.bottom||0,3,wa),vu(W,ht.left||0,3,Za),vu(W,W.transform.width-(ht.right||0),3,yc);var Pt=W.transform.centerPoint;(function(It,Mt,Yt,Ht){_u(It,Mt-1,Yt-10,2,20,Ht),_u(It,Mt-10,Yt-1,20,2,Ht)})(W,Pt.x,W.transform.height-Pt.y,vc)})(this),this.context.setDefault()},Wn.prototype.renderLayer=function(m,v,g,w){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="custom"||w.length)&&(this.id=g.id,this.gpuTimingStart(g),ra[g.type](m,v,g,w,this.style.placement.variableOffsets),this.gpuTimingEnd())},Wn.prototype.gpuTimingStart=function(m){if(this.options.gpuTiming){var v=this.context.extTimerQuery,g=this.gpuTimers[m.id];g||(g=this.gpuTimers[m.id]={calls:0,cpuTime:0,query:v.createQueryEXT()}),g.calls++,v.beginQueryEXT(v.TIME_ELAPSED_EXT,g.query)}},Wn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var m=this.context.extTimerQuery;m.endQueryEXT(m.TIME_ELAPSED_EXT)}},Wn.prototype.collectGpuTimers=function(){var m=this.gpuTimers;return this.gpuTimers={},m},Wn.prototype.queryGpuTimers=function(m){var v={};for(var g in m){var w=m[g],B=this.context.extTimerQuery,D=B.getQueryObjectEXT(w.query,B.QUERY_RESULT_EXT)/1e6;B.deleteQueryEXT(w.query),v[g]=D}return v},Wn.prototype.translatePosMatrix=function(m,v,g,w,B){if(!g[0]&&!g[1])return m;var D=B?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(D){var O=Math.sin(D),G=Math.cos(D);g=[g[0]*G-g[1]*O,g[0]*O+g[1]*G]}var J=[B?g[0]:Fn(v,g[0],this.transform.zoom),B?g[1]:Fn(v,g[1],this.transform.zoom),0],at=new Float32Array(16);return s.translate(at,m,J),at},Wn.prototype.saveTileTexture=function(m){var v=this._tileTextures[m.size[0]];v?v.push(m):this._tileTextures[m.size[0]]=[m]},Wn.prototype.getTileTexture=function(m){var v=this._tileTextures[m];return v&&v.length>0?v.pop():null},Wn.prototype.isPatternMissing=function(m){if(!m)return!1;if(!m.from||!m.to)return!0;var v=this.imageManager.getPattern(m.from.toString()),g=this.imageManager.getPattern(m.to.toString());return!v||!g},Wn.prototype.useProgram=function(m,v){this.cache=this.cache||{};var g=""+m+(v?v.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[g]||(this.cache[g]=new Mf(this.context,m,Pf[m],v,kf[m],this._showOverdrawInspector)),this.cache[g]},Wn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Wn.prototype.setBaseState=function(){var m=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(m.FUNC_ADD)},Wn.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Wn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Dl=function(m,v){this.points=m,this.planes=v};Dl.fromInvProjectionMatrix=function(m,v,g){var w=Math.pow(2,g),B=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(O){return s.transformMat4([],O,m)}).map(function(O){return s.scale$1([],O,1/O[3]/v*w)}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(O){var G=s.sub([],B[O[0]],B[O[1]]),J=s.sub([],B[O[2]],B[O[1]]),at=s.normalize([],s.cross([],G,J)),Et=-s.dot(at,B[O[1]]);return at.concat(Et)});return new Dl(B,D)};var bo=function(m,v){this.min=m,this.max=v,this.center=s.scale$2([],s.add([],this.min,this.max),.5)};bo.prototype.quadrant=function(m){for(var v=[m%2==0,m<2],g=s.clone$2(this.min),w=s.clone$2(this.max),B=0;B<v.length;B++)g[B]=v[B]?this.min[B]:this.center[B],w[B]=v[B]?this.center[B]:this.max[B];return w[2]=this.max[2],new bo(g,w)},bo.prototype.distanceX=function(m){return Math.max(Math.min(this.max[0],m[0]),this.min[0])-m[0]},bo.prototype.distanceY=function(m){return Math.max(Math.min(this.max[1],m[1]),this.min[1])-m[1]},bo.prototype.intersects=function(m){for(var v=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],g=!0,w=0;w<m.planes.length;w++){for(var B=m.planes[w],D=0,O=0;O<v.length;O++)D+=s.dot$1(B,v[O])>=0;if(D===0)return 0;D!==v.length&&(g=!1)}if(g)return 2;for(var G=0;G<3;G++){for(var J=Number.MAX_VALUE,at=-Number.MAX_VALUE,Et=0;Et<m.points.length;Et++){var Ct=m.points[Et][G]-this.min[G];J=Math.min(J,Ct),at=Math.max(at,Ct)}if(at<0||J>this.max[G]-this.min[G])return 0}return 1};var Zs=function(m,v,g,w){if(m===void 0&&(m=0),v===void 0&&(v=0),g===void 0&&(g=0),w===void 0&&(w=0),isNaN(m)||m<0||isNaN(v)||v<0||isNaN(g)||g<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=m,this.bottom=v,this.left=g,this.right=w};Zs.prototype.interpolate=function(m,v,g){return v.top!=null&&m.top!=null&&(this.top=s.number(m.top,v.top,g)),v.bottom!=null&&m.bottom!=null&&(this.bottom=s.number(m.bottom,v.bottom,g)),v.left!=null&&m.left!=null&&(this.left=s.number(m.left,v.left,g)),v.right!=null&&m.right!=null&&(this.right=s.number(m.right,v.right,g)),this},Zs.prototype.getCenter=function(m,v){var g=s.clamp((this.left+m-this.right)/2,0,m),w=s.clamp((this.top+v-this.bottom)/2,0,v);return new s.Point(g,w)},Zs.prototype.equals=function(m){return this.top===m.top&&this.bottom===m.bottom&&this.left===m.left&&this.right===m.right},Zs.prototype.clone=function(){return new Zs(this.top,this.bottom,this.left,this.right)},Zs.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var qi=function(m,v,g,w,B){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=B===void 0||B,this._minZoom=m||0,this._maxZoom=v||22,this._minPitch=g??0,this._maxPitch=w??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Zs,this._posMatrixCache={},this._alignedPosMatrixCache={}},Un={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};qi.prototype.clone=function(){var m=new qi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return m.tileSize=this.tileSize,m.latRange=this.latRange,m.width=this.width,m.height=this.height,m._center=this._center,m.zoom=this.zoom,m.angle=this.angle,m._fov=this._fov,m._pitch=this._pitch,m._unmodified=this._unmodified,m._edgeInsets=this._edgeInsets.clone(),m._calcMatrices(),m},Un.minZoom.get=function(){return this._minZoom},Un.minZoom.set=function(m){this._minZoom!==m&&(this._minZoom=m,this.zoom=Math.max(this.zoom,m))},Un.maxZoom.get=function(){return this._maxZoom},Un.maxZoom.set=function(m){this._maxZoom!==m&&(this._maxZoom=m,this.zoom=Math.min(this.zoom,m))},Un.minPitch.get=function(){return this._minPitch},Un.minPitch.set=function(m){this._minPitch!==m&&(this._minPitch=m,this.pitch=Math.max(this.pitch,m))},Un.maxPitch.get=function(){return this._maxPitch},Un.maxPitch.set=function(m){this._maxPitch!==m&&(this._maxPitch=m,this.pitch=Math.min(this.pitch,m))},Un.renderWorldCopies.get=function(){return this._renderWorldCopies},Un.renderWorldCopies.set=function(m){m===void 0?m=!0:m===null&&(m=!1),this._renderWorldCopies=m},Un.worldSize.get=function(){return this.tileSize*this.scale},Un.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Un.size.get=function(){return new s.Point(this.width,this.height)},Un.bearing.get=function(){return-this.angle/Math.PI*180},Un.bearing.set=function(m){var v=-s.wrap(m,-180,180)*Math.PI/180;this.angle!==v&&(this._unmodified=!1,this.angle=v,this._calcMatrices(),this.rotationMatrix=s.create$2(),s.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Un.pitch.get=function(){return this._pitch/Math.PI*180},Un.pitch.set=function(m){var v=s.clamp(m,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==v&&(this._unmodified=!1,this._pitch=v,this._calcMatrices())},Un.fov.get=function(){return this._fov/Math.PI*180},Un.fov.set=function(m){m=Math.max(.01,Math.min(60,m)),this._fov!==m&&(this._unmodified=!1,this._fov=m/180*Math.PI,this._calcMatrices())},Un.zoom.get=function(){return this._zoom},Un.zoom.set=function(m){var v=Math.min(Math.max(m,this.minZoom),this.maxZoom);this._zoom!==v&&(this._unmodified=!1,this._zoom=v,this.scale=this.zoomScale(v),this.tileZoom=Math.floor(v),this.zoomFraction=v-this.tileZoom,this._constrain(),this._calcMatrices())},Un.center.get=function(){return this._center},Un.center.set=function(m){m.lat===this._center.lat&&m.lng===this._center.lng||(this._unmodified=!1,this._center=m,this._constrain(),this._calcMatrices())},Un.padding.get=function(){return this._edgeInsets.toJSON()},Un.padding.set=function(m){this._edgeInsets.equals(m)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,m,1),this._calcMatrices())},Un.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},qi.prototype.isPaddingEqual=function(m){return this._edgeInsets.equals(m)},qi.prototype.interpolatePadding=function(m,v,g){this._unmodified=!1,this._edgeInsets.interpolate(m,v,g),this._constrain(),this._calcMatrices()},qi.prototype.coveringZoomLevel=function(m){var v=(m.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/m.tileSize));return Math.max(0,v)},qi.prototype.getVisibleUnwrappedCoordinates=function(m){var v=[new s.UnwrappedTileID(0,m)];if(this._renderWorldCopies)for(var g=this.pointCoordinate(new s.Point(0,0)),w=this.pointCoordinate(new s.Point(this.width,0)),B=this.pointCoordinate(new s.Point(this.width,this.height)),D=this.pointCoordinate(new s.Point(0,this.height)),O=Math.floor(Math.min(g.x,w.x,B.x,D.x)),G=Math.floor(Math.max(g.x,w.x,B.x,D.x)),J=O-1;J<=G+1;J++)J!==0&&v.push(new s.UnwrappedTileID(J,m));return v},qi.prototype.coveringTiles=function(m){var v=this.coveringZoomLevel(m),g=v;if(m.minzoom!==void 0&&v<m.minzoom)return[];m.maxzoom!==void 0&&v>m.maxzoom&&(v=m.maxzoom);var w=s.MercatorCoordinate.fromLngLat(this.center),B=Math.pow(2,v),D=[B*w.x,B*w.y,0],O=Dl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v),G=m.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(G=v);var J=function(W){return{aabb:new bo([W*B,0,0],[(W+1)*B,B,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}},at=[],Et=[],Ct=v,Bt=m.reparseOverscaled?g:v;if(this._renderWorldCopies)for(var Wt=1;Wt<=3;Wt++)at.push(J(-Wt)),at.push(J(Wt));for(at.push(J(0));at.length>0;){var zt=at.pop(),f=zt.x,h=zt.y,A=zt.fullyVisible;if(!A){var b=zt.aabb.intersects(O);if(b===0)continue;A=b===2}var E=zt.aabb.distanceX(D),S=zt.aabb.distanceY(D),P=Math.max(Math.abs(E),Math.abs(S));if(zt.zoom===Ct||P>3+(1<<Ct-zt.zoom)-2&&zt.zoom>=G)Et.push({tileID:new s.OverscaledTileID(zt.zoom===Ct?Bt:zt.zoom,zt.wrap,zt.zoom,f,h),distanceSq:s.sqrLen([D[0]-.5-f,D[1]-.5-h])});else for(var R=0;R<4;R++){var F=(f<<1)+R%2,U=(h<<1)+(R>>1);at.push({aabb:zt.aabb.quadrant(R),zoom:zt.zoom+1,x:F,y:U,wrap:zt.wrap,fullyVisible:A})}}return Et.sort(function(W,ht){return W.distanceSq-ht.distanceSq}).map(function(W){return W.tileID})},qi.prototype.resize=function(m,v){this.width=m,this.height=v,this.pixelsToGLUnits=[2/m,-2/v],this._constrain(),this._calcMatrices()},Un.unmodified.get=function(){return this._unmodified},qi.prototype.zoomScale=function(m){return Math.pow(2,m)},qi.prototype.scaleZoom=function(m){return Math.log(m)/Math.LN2},qi.prototype.project=function(m){var v=s.clamp(m.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(m.lng)*this.worldSize,s.mercatorYfromLat(v)*this.worldSize)},qi.prototype.unproject=function(m){return new s.MercatorCoordinate(m.x/this.worldSize,m.y/this.worldSize).toLngLat()},Un.point.get=function(){return this.project(this.center)},qi.prototype.setLocationAtPoint=function(m,v){var g=this.pointCoordinate(v),w=this.pointCoordinate(this.centerPoint),B=this.locationCoordinate(m),D=new s.MercatorCoordinate(B.x-(g.x-w.x),B.y-(g.y-w.y));this.center=this.coordinateLocation(D),this._renderWorldCopies&&(this.center=this.center.wrap())},qi.prototype.locationPoint=function(m){return this.coordinatePoint(this.locationCoordinate(m))},qi.prototype.pointLocation=function(m){return this.coordinateLocation(this.pointCoordinate(m))},qi.prototype.locationCoordinate=function(m){return s.MercatorCoordinate.fromLngLat(m)},qi.prototype.coordinateLocation=function(m){return m.toLngLat()},qi.prototype.pointCoordinate=function(m){var v=[m.x,m.y,0,1],g=[m.x,m.y,1,1];s.transformMat4(v,v,this.pixelMatrixInverse),s.transformMat4(g,g,this.pixelMatrixInverse);var w=v[3],B=g[3],D=v[1]/w,O=g[1]/B,G=v[2]/w,J=g[2]/B,at=G===J?0:(0-G)/(J-G);return new s.MercatorCoordinate(s.number(v[0]/w,g[0]/B,at)/this.worldSize,s.number(D,O,at)/this.worldSize)},qi.prototype.coordinatePoint=function(m){var v=[m.x*this.worldSize,m.y*this.worldSize,0,1];return s.transformMat4(v,v,this.pixelMatrix),new s.Point(v[0]/v[3],v[1]/v[3])},qi.prototype.getBounds=function(){return new s.LngLatBounds().extend(this.pointLocation(new s.Point(0,0))).extend(this.pointLocation(new s.Point(this.width,0))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))},qi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},qi.prototype.setMaxBounds=function(m){m?(this.lngRange=[m.getWest(),m.getEast()],this.latRange=[m.getSouth(),m.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},qi.prototype.calculatePosMatrix=function(m,v){v===void 0&&(v=!1);var g=m.key,w=v?this._alignedPosMatrixCache:this._posMatrixCache;if(w[g])return w[g];var B=m.canonical,D=this.worldSize/this.zoomScale(B.z),O=B.x+Math.pow(2,B.z)*m.wrap,G=s.identity(new Float64Array(16));return s.translate(G,G,[O*D,B.y*D,0]),s.scale(G,G,[D/s.EXTENT,D/s.EXTENT,1]),s.multiply(G,v?this.alignedProjMatrix:this.projMatrix,G),w[g]=new Float32Array(G),w[g]},qi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},qi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var m,v,g,w,B=-90,D=90,O=-180,G=180,J=this.size,at=this._unmodified;if(this.latRange){var Et=this.latRange;B=s.mercatorYfromLat(Et[1])*this.worldSize,m=(D=s.mercatorYfromLat(Et[0])*this.worldSize)-B<J.y?J.y/(D-B):0}if(this.lngRange){var Ct=this.lngRange;O=s.mercatorXfromLng(Ct[0])*this.worldSize,v=(G=s.mercatorXfromLng(Ct[1])*this.worldSize)-O<J.x?J.x/(G-O):0}var Bt=this.point,Wt=Math.max(v||0,m||0);if(Wt)return this.center=this.unproject(new s.Point(v?(G+O)/2:Bt.x,m?(D+B)/2:Bt.y)),this.zoom+=this.scaleZoom(Wt),this._unmodified=at,void(this._constraining=!1);if(this.latRange){var zt=Bt.y,f=J.y/2;zt-f<B&&(w=B+f),zt+f>D&&(w=D-f)}if(this.lngRange){var h=Bt.x,A=J.x/2;h-A<O&&(g=O+A),h+A>G&&(g=G-A)}g===void 0&&w===void 0||(this.center=this.unproject(new s.Point(g!==void 0?g:Bt.x,w!==void 0?w:Bt.y))),this._unmodified=at,this._constraining=!1}},qi.prototype._calcMatrices=function(){if(this.height){var m=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var v=Math.PI/2+this._pitch,g=this._fov*(.5+m.y/this.height),w=Math.sin(g)*this.cameraToCenterDistance/Math.sin(s.clamp(Math.PI-v-g,.01,Math.PI-.01)),B=this.point,D=B.x,O=B.y,G=1.01*(Math.cos(Math.PI/2-this._pitch)*w+this.cameraToCenterDistance),J=this.height/50,at=new Float64Array(16);s.perspective(at,this._fov,this.width/this.height,J,G),at[8]=2*-m.x/this.width,at[9]=2*m.y/this.height,s.scale(at,at,[1,-1,1]),s.translate(at,at,[0,0,-this.cameraToCenterDistance]),s.rotateX(at,at,this._pitch),s.rotateZ(at,at,this.angle),s.translate(at,at,[-D,-O,0]),this.mercatorMatrix=s.scale([],at,[this.worldSize,this.worldSize,this.worldSize]),s.scale(at,at,[1,1,s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=at,this.invProjMatrix=s.invert([],this.projMatrix);var Et=this.width%2/2,Ct=this.height%2/2,Bt=Math.cos(this.angle),Wt=Math.sin(this.angle),zt=D-Math.round(D)+Bt*Et+Wt*Ct,f=O-Math.round(O)+Bt*Ct+Wt*Et,h=new Float64Array(at);if(s.translate(h,h,[zt>.5?zt-1:zt,f>.5?f-1:f,0]),this.alignedProjMatrix=h,at=s.create(),s.scale(at,at,[this.width/2,-this.height/2,1]),s.translate(at,at,[1,-1,0]),this.labelPlaneMatrix=at,at=s.create(),s.scale(at,at,[1,-1,1]),s.translate(at,at,[-1,-1,0]),s.scale(at,at,[2/this.width,2/this.height,1]),this.glCoordMatrix=at,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(at=s.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=at,this._posMatrixCache={},this._alignedPosMatrixCache={}}},qi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var m=this.pointCoordinate(new s.Point(0,0)),v=[m.x*this.worldSize,m.y*this.worldSize,0,1];return s.transformMat4(v,v,this.pixelMatrix)[3]/this.cameraToCenterDistance},qi.prototype.getCameraPoint=function(){var m=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,m))},qi.prototype.getCameraQueryGeometry=function(m){var v=this.getCameraPoint();if(m.length===1)return[m[0],v];for(var g=v.x,w=v.y,B=v.x,D=v.y,O=0,G=m;O<G.length;O+=1){var J=G[O];g=Math.min(g,J.x),w=Math.min(w,J.y),B=Math.max(B,J.x),D=Math.max(D,J.y)}return[new s.Point(g,w),new s.Point(B,w),new s.Point(B,D),new s.Point(g,D),new s.Point(g,w)]},Object.defineProperties(qi.prototype,Un);var ns=function(m){var v,g,w,B;this._hashName=m&&encodeURIComponent(m),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(v=this._updateHashUnthrottled.bind(this),g=!1,w=null,B=function(){w=null,g&&(v(),w=setTimeout(B,300),g=!1)},function(){return g=!0,w||B(),w})};ns.prototype.addTo=function(m){return this._map=m,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ns.prototype.remove=function(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ns.prototype.getHashString=function(m){var v=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,w=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),B=Math.pow(10,w),D=Math.round(v.lng*B)/B,O=Math.round(v.lat*B)/B,G=this._map.getBearing(),J=this._map.getPitch(),at="";if(at+=m?"/"+D+"/"+O+"/"+g:g+"/"+O+"/"+D,(G||J)&&(at+="/"+Math.round(10*G)/10),J&&(at+="/"+Math.round(J)),this._hashName){var Et=this._hashName,Ct=!1,Bt=s.window.location.hash.slice(1).split("&").map(function(Wt){var zt=Wt.split("=")[0];return zt===Et?(Ct=!0,zt+"="+at):Wt}).filter(function(Wt){return Wt});return Ct||Bt.push(Et+"="+at),"#"+Bt.join("&")}return"#"+at},ns.prototype._getCurrentHash=function(){var m,v=this,g=s.window.location.hash.replace("#","");return this._hashName?(g.split("&").map(function(w){return w.split("=")}).forEach(function(w){w[0]===v._hashName&&(m=w)}),(m&&m[1]||"").split("/")):g.split("/")},ns.prototype._onHashChange=function(){var m=this._getCurrentHash();if(m.length>=3&&!m.some(function(g){return isNaN(g)})){var v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(m[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:v,pitch:+(m[4]||0)}),!0}return!1},ns.prototype._updateHashUnthrottled=function(){var m=s.window.location.href.replace(/(#.+)?$/,this.getHashString());try{s.window.history.replaceState(s.window.history.state,null,m)}catch{}};var bu={linearity:.3,easing:s.bezier(0,0,.3,1)},kl=s.extend({deceleration:2500,maxSpeed:1400},bu),xu=s.extend({deceleration:20,maxSpeed:1400},bu),Nf=s.extend({deceleration:1e3,maxSpeed:360},bu),Wp=s.extend({deceleration:1e3,maxSpeed:90},bu),wu=function(m){this._map=m,this.clear()};function Eu(m,v){(!m.duration||m.duration<v.duration)&&(m.duration=v.duration,m.easing=v.easing)}function ao(m,v,g){var w=g.maxSpeed,B=g.linearity,D=g.deceleration,O=s.clamp(m*B/(v/1e3),-w,w),G=Math.abs(O)/(D*B);return{easing:g.easing,duration:1e3*G,amount:O*(G/2)}}wu.prototype.clear=function(){this._inertiaBuffer=[]},wu.prototype.record=function(m){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.browser.now(),settings:m})},wu.prototype._drainInertiaBuffer=function(){for(var m=this._inertiaBuffer,v=s.browser.now();m.length>0&&v-m[0].time>160;)m.shift()},wu.prototype._onMoveEnd=function(m){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var v={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0},g=0,w=this._inertiaBuffer;g<w.length;g+=1){var B=w[g].settings;v.zoom+=B.zoomDelta||0,v.bearing+=B.bearingDelta||0,v.pitch+=B.pitchDelta||0,B.panDelta&&v.pan._add(B.panDelta),B.around&&(v.around=B.around),B.pinchAround&&(v.pinchAround=B.pinchAround)}var D=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,O={};if(v.pan.mag()){var G=ao(v.pan.mag(),D,s.extend({},kl,m||{}));O.offset=v.pan.mult(G.amount/v.pan.mag()),O.center=this._map.transform.center,Eu(O,G)}if(v.zoom){var J=ao(v.zoom,D,xu);O.zoom=this._map.transform.zoom+J.amount,Eu(O,J)}if(v.bearing){var at=ao(v.bearing,D,Nf);O.bearing=this._map.transform.bearing+s.clamp(at.amount,-179,179),Eu(O,at)}if(v.pitch){var Et=ao(v.pitch,D,Wp);O.pitch=this._map.transform.pitch+Et.amount,Eu(O,Et)}if(O.zoom||O.bearing){var Ct=v.pinchAround===void 0?v.around:v.pinchAround;O.around=Ct?this._map.unproject(Ct):this._map.getCenter()}return this.clear(),s.extend(O,{noMoveStart:!0})}};var xr=(function(m){function v(w,B,D,O){O===void 0&&(O={});var G=c.mousePos(B.getCanvasContainer(),D),J=B.unproject(G);m.call(this,w,s.extend({point:G,lngLat:J,originalEvent:D},O)),this._defaultPrevented=!1,this.target=B}m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v;var g={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},g.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,g),v})(s.Event),Ya=(function(m){function v(w,B,D){var O=w==="touchend"?D.changedTouches:D.touches,G=c.touchPos(B.getCanvasContainer(),O),J=G.map(function(Ct){return B.unproject(Ct)}),at=G.reduce(function(Ct,Bt,Wt,zt){return Ct.add(Bt.div(zt.length))},new s.Point(0,0)),Et=B.unproject(at);m.call(this,w,{points:G,point:at,lngLats:J,lngLat:Et,originalEvent:D}),this._defaultPrevented=!1}m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v;var g={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},g.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,g),v})(s.Event),zf=(function(m){function v(w,B,D){m.call(this,w,{originalEvent:D}),this._defaultPrevented=!1}m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v;var g={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},g.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,g),v})(s.Event),wr=function(m,v){this._map=m,this._clickTolerance=v.clickTolerance};wr.prototype.reset=function(){delete this._mousedownPos},wr.prototype.wheel=function(m){return this._firePreventable(new zf(m.type,this._map,m))},wr.prototype.mousedown=function(m,v){return this._mousedownPos=v,this._firePreventable(new xr(m.type,this._map,m))},wr.prototype.mouseup=function(m){this._map.fire(new xr(m.type,this._map,m))},wr.prototype.click=function(m,v){this._mousedownPos&&this._mousedownPos.dist(v)>=this._clickTolerance||this._map.fire(new xr(m.type,this._map,m))},wr.prototype.dblclick=function(m){return this._firePreventable(new xr(m.type,this._map,m))},wr.prototype.mouseover=function(m){this._map.fire(new xr(m.type,this._map,m))},wr.prototype.mouseout=function(m){this._map.fire(new xr(m.type,this._map,m))},wr.prototype.touchstart=function(m){return this._firePreventable(new Ya(m.type,this._map,m))},wr.prototype.touchmove=function(m){this._map.fire(new Ya(m.type,this._map,m))},wr.prototype.touchend=function(m){this._map.fire(new Ya(m.type,this._map,m))},wr.prototype.touchcancel=function(m){this._map.fire(new Ya(m.type,this._map,m))},wr.prototype._firePreventable=function(m){if(this._map.fire(m),m.defaultPrevented)return{}},wr.prototype.isEnabled=function(){return!0},wr.prototype.isActive=function(){return!1},wr.prototype.enable=function(){},wr.prototype.disable=function(){};var ci=function(m){this._map=m};ci.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},ci.prototype.mousemove=function(m){this._map.fire(new xr(m.type,this._map,m))},ci.prototype.mousedown=function(){this._delayContextMenu=!0},ci.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},ci.prototype.contextmenu=function(m){this._delayContextMenu?this._contextMenuEvent=m:this._map.fire(new xr(m.type,this._map,m)),this._map.listens("contextmenu")&&m.preventDefault()},ci.prototype.isEnabled=function(){return!0},ci.prototype.isActive=function(){return!1},ci.prototype.enable=function(){},ci.prototype.disable=function(){};var Ds=function(m,v){this._map=m,this._el=m.getCanvasContainer(),this._container=m.getContainer(),this._clickTolerance=v.clickTolerance||1};function _c(m,v){for(var g={},w=0;w<m.length;w++)g[m[w].identifier]=v[w];return g}Ds.prototype.isEnabled=function(){return!!this._enabled},Ds.prototype.isActive=function(){return!!this._active},Ds.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ds.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ds.prototype.mousedown=function(m,v){this.isEnabled()&&m.shiftKey&&m.button===0&&(c.disableDrag(),this._startPos=this._lastPos=v,this._active=!0)},Ds.prototype.mousemoveWindow=function(m,v){if(this._active){var g=v;if(!(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)){var w=this._startPos;this._lastPos=g,this._box||(this._box=c.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",m));var B=Math.min(w.x,g.x),D=Math.max(w.x,g.x),O=Math.min(w.y,g.y),G=Math.max(w.y,g.y);c.setTransform(this._box,"translate("+B+"px,"+O+"px)"),this._box.style.width=D-B+"px",this._box.style.height=G-O+"px"}}},Ds.prototype.mouseupWindow=function(m,v){var g=this;if(this._active&&m.button===0){var w=this._startPos,B=v;if(this.reset(),c.suppressClick(),w.x!==B.x||w.y!==B.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:m})),{cameraAnimation:function(D){return D.fitScreenCoordinates(w,B,g._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",m)}},Ds.prototype.keydown=function(m){this._active&&m.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",m))},Ds.prototype.blur=function(){this.reset()},Ds.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(c.remove(this._box),this._box=null),c.enableDrag(),delete this._startPos,delete this._lastPos},Ds.prototype._fireEvent=function(m,v){return this._map.fire(new s.Event(m,{originalEvent:v}))};var Ol=function(m){this.reset(),this.numTouches=m.numTouches};Ol.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ol.prototype.touchstart=function(m,v,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=m.timeStamp),g.length===this.numTouches&&(this.centroid=(function(w){for(var B=new s.Point(0,0),D=0,O=w;D<O.length;D+=1)B._add(O[D]);return B.div(w.length)})(v),this.touches=_c(g,v)))},Ol.prototype.touchmove=function(m,v,g){if(!this.aborted&&this.centroid){var w=_c(g,v);for(var B in this.touches){var D=w[B];(!D||D.dist(this.touches[B])>30)&&(this.aborted=!0)}}},Ol.prototype.touchend=function(m,v,g){if((!this.centroid||m.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){var w=!this.aborted&&this.centroid;if(this.reset(),w)return w}};var xo=function(m){this.singleTap=new Ol(m),this.numTaps=m.numTaps,this.reset()};xo.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},xo.prototype.touchstart=function(m,v,g){this.singleTap.touchstart(m,v,g)},xo.prototype.touchmove=function(m,v,g){this.singleTap.touchmove(m,v,g)},xo.prototype.touchend=function(m,v,g){var w=this.singleTap.touchend(m,v,g);if(w){var B=m.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(w)<30;if(B&&D||this.reset(),this.count++,this.lastTime=m.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}};var bs=function(){this._zoomIn=new xo({numTouches:1,numTaps:2}),this._zoomOut=new xo({numTouches:2,numTaps:1}),this.reset()};bs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},bs.prototype.touchstart=function(m,v,g){this._zoomIn.touchstart(m,v,g),this._zoomOut.touchstart(m,v,g)},bs.prototype.touchmove=function(m,v,g){this._zoomIn.touchmove(m,v,g),this._zoomOut.touchmove(m,v,g)},bs.prototype.touchend=function(m,v,g){var w=this,B=this._zoomIn.touchend(m,v,g),D=this._zoomOut.touchend(m,v,g);return B?(this._active=!0,m.preventDefault(),setTimeout(function(){return w.reset()},0),{cameraAnimation:function(O){return O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(B)},{originalEvent:m})}}):D?(this._active=!0,m.preventDefault(),setTimeout(function(){return w.reset()},0),{cameraAnimation:function(O){return O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(D)},{originalEvent:m})}}):void 0},bs.prototype.touchcancel=function(){this.reset()},bs.prototype.enable=function(){this._enabled=!0},bs.prototype.disable=function(){this._enabled=!1,this.reset()},bs.prototype.isEnabled=function(){return this._enabled},bs.prototype.isActive=function(){return this._active};var gh={0:1,2:2},ni=function(m){this.reset(),this._clickTolerance=m.clickTolerance||1};ni.prototype.blur=function(){this.reset()},ni.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},ni.prototype._correctButton=function(m,v){return!1},ni.prototype._move=function(m,v){return{}},ni.prototype.mousedown=function(m,v){if(!this._lastPoint){var g=c.mouseButton(m);this._correctButton(m,g)&&(this._lastPoint=v,this._eventButton=g)}},ni.prototype.mousemoveWindow=function(m,v){var g=this._lastPoint;if(g){if(m.preventDefault(),(function(w,B){var D=gh[B];return w.buttons===void 0||(w.buttons&D)!==D})(m,this._eventButton))this.reset();else if(this._moved||!(v.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=v,this._move(g,v)}},ni.prototype.mouseupWindow=function(m){this._lastPoint&&c.mouseButton(m)===this._eventButton&&(this._moved&&c.suppressClick(),this.reset())},ni.prototype.enable=function(){this._enabled=!0},ni.prototype.disable=function(){this._enabled=!1,this.reset()},ni.prototype.isEnabled=function(){return this._enabled},ni.prototype.isActive=function(){return this._active};var wo=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.mousedown=function(g,w){m.prototype.mousedown.call(this,g,w),this._lastPoint&&(this._active=!0)},v.prototype._correctButton=function(g,w){return w===0&&!g.ctrlKey},v.prototype._move=function(g,w){return{around:w,panDelta:w.sub(g)}},v})(ni),Cu=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype._correctButton=function(g,w){return w===0&&g.ctrlKey||w===2},v.prototype._move=function(g,w){var B=.8*(w.x-g.x);if(B)return this._active=!0,{bearingDelta:B}},v.prototype.contextmenu=function(g){g.preventDefault()},v})(ni),yh=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype._correctButton=function(g,w){return w===0&&g.ctrlKey||w===2},v.prototype._move=function(g,w){var B=-.5*(w.y-g.y);if(B)return this._active=!0,{pitchDelta:B}},v.prototype.contextmenu=function(g){g.preventDefault()},v})(ni),lo=function(m){this._minTouches=1,this._clickTolerance=m.clickTolerance||1,this.reset()};lo.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)},lo.prototype.touchstart=function(m,v,g){return this._calculateTransform(m,v,g)},lo.prototype.touchmove=function(m,v,g){if(this._active&&!(g.length<this._minTouches))return m.preventDefault(),this._calculateTransform(m,v,g)},lo.prototype.touchend=function(m,v,g){this._calculateTransform(m,v,g),this._active&&g.length<this._minTouches&&this.reset()},lo.prototype.touchcancel=function(){this.reset()},lo.prototype._calculateTransform=function(m,v,g){g.length>0&&(this._active=!0);var w=_c(g,v),B=new s.Point(0,0),D=new s.Point(0,0),O=0;for(var G in w){var J=w[G],at=this._touches[G];at&&(B._add(J),D._add(J.sub(at)),O++,w[G]=J)}if(this._touches=w,!(O<this._minTouches)&&D.mag()){var Et=D.div(O);if(this._sum._add(Et),!(this._sum.mag()<this._clickTolerance))return{around:B.div(O),panDelta:Et}}},lo.prototype.enable=function(){this._enabled=!0},lo.prototype.disable=function(){this._enabled=!1,this.reset()},lo.prototype.isEnabled=function(){return this._enabled},lo.prototype.isActive=function(){return this._active};var ks=function(){this.reset()};function bc(m,v,g){for(var w=0;w<m.length;w++)if(m[w].identifier===g)return v[w]}function xc(m,v){return Math.log(m/v)/Math.LN2}ks.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ks.prototype._start=function(m){},ks.prototype._move=function(m,v,g){return{}},ks.prototype.touchstart=function(m,v,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([v[0],v[1]]))},ks.prototype.touchmove=function(m,v,g){if(this._firstTwoTouches){m.preventDefault();var w=this._firstTwoTouches,B=w[1],D=bc(g,v,w[0]),O=bc(g,v,B);if(D&&O){var G=this._aroundCenter?null:D.add(O).div(2);return this._move([D,O],G,m)}}},ks.prototype.touchend=function(m,v,g){if(this._firstTwoTouches){var w=this._firstTwoTouches,B=w[1],D=bc(g,v,w[0]),O=bc(g,v,B);D&&O||(this._active&&c.suppressClick(),this.reset())}},ks.prototype.touchcancel=function(){this.reset()},ks.prototype.enable=function(m){this._enabled=!0,this._aroundCenter=!!m&&m.around==="center"},ks.prototype.disable=function(){this._enabled=!1,this.reset()},ks.prototype.isEnabled=function(){return this._enabled},ks.prototype.isActive=function(){return this._active};var Sr=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.reset=function(){m.prototype.reset.call(this),delete this._distance,delete this._startDistance},v.prototype._start=function(g){this._startDistance=this._distance=g[0].dist(g[1])},v.prototype._move=function(g,w){var B=this._distance;if(this._distance=g[0].dist(g[1]),this._active||!(Math.abs(xc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xc(this._distance,B),pinchAround:w}},v})(ks);function Eo(m,v){return 180*m.angleWith(v)/Math.PI}var Uf=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.reset=function(){m.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},v.prototype._start=function(g){this._startVector=this._vector=g[0].sub(g[1]),this._minDiameter=g[0].dist(g[1])},v.prototype._move=function(g,w){var B=this._vector;if(this._vector=g[0].sub(g[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Eo(this._vector,B),pinchAround:w}},v.prototype._isBelowThreshold=function(g){this._minDiameter=Math.min(this._minDiameter,g.mag());var w=25/(Math.PI*this._minDiameter)*360,B=Eo(g,this._startVector);return Math.abs(B)<w},v})(ks);function Ea(m){return Math.abs(m.y)>Math.abs(m.x)}var wc=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.reset=function(){m.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},v.prototype._start=function(g){this._lastPoints=g,Ea(g[0].sub(g[1]))&&(this._valid=!1)},v.prototype._move=function(g,w,B){var D=g[0].sub(this._lastPoints[0]),O=g[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(D,O,B.timeStamp),this._valid)return this._lastPoints=g,this._active=!0,{pitchDelta:(D.y+O.y)/2*-.5}},v.prototype.gestureBeginsVertically=function(g,w,B){if(this._valid!==void 0)return this._valid;var D=g.mag()>=2,O=w.mag()>=2;if(D||O){if(!D||!O)return this._firstMove===void 0&&(this._firstMove=B),B-this._firstMove<100&&void 0;var G=g.y>0==w.y>0;return Ea(g)&&Ea(w)&&G}},v})(ks),vh={panStep:100,bearingStep:15,pitchStep:10},Co=function(){var m=vh;this._panStep=m.panStep,this._bearingStep=m.bearingStep,this._pitchStep=m.pitchStep,this._rotationDisabled=!1};function rs(m){return m*(2-m)}Co.prototype.blur=function(){this.reset()},Co.prototype.reset=function(){this._active=!1},Co.prototype.keydown=function(m){var v=this;if(!(m.altKey||m.ctrlKey||m.metaKey)){var g=0,w=0,B=0,D=0,O=0;switch(m.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:m.shiftKey?w=-1:(m.preventDefault(),D=-1);break;case 39:m.shiftKey?w=1:(m.preventDefault(),D=1);break;case 38:m.shiftKey?B=1:(m.preventDefault(),O=-1);break;case 40:m.shiftKey?B=-1:(m.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(w=0,B=0),{cameraAnimation:function(G){var J=G.getZoom();G.easeTo({duration:300,easeId:"keyboardHandler",easing:rs,zoom:g?Math.round(J)+g*(m.shiftKey?2:1):J,bearing:G.getBearing()+w*v._bearingStep,pitch:G.getPitch()+B*v._pitchStep,offset:[-D*v._panStep,-O*v._panStep],center:G.getCenter()},{originalEvent:m})}}}},Co.prototype.enable=function(){this._enabled=!0},Co.prototype.disable=function(){this._enabled=!1,this.reset()},Co.prototype.isEnabled=function(){return this._enabled},Co.prototype.isActive=function(){return this._active},Co.prototype.disableRotation=function(){this._rotationDisabled=!0},Co.prototype.enableRotation=function(){this._rotationDisabled=!1};var un=function(m,v){this._map=m,this._el=m.getCanvasContainer(),this._handler=v,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,s.bindAll(["_onTimeout"],this)};un.prototype.setZoomRate=function(m){this._defaultZoomRate=m},un.prototype.setWheelZoomRate=function(m){this._wheelZoomRate=m},un.prototype.isEnabled=function(){return!!this._enabled},un.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},un.prototype.isZooming=function(){return!!this._zooming},un.prototype.enable=function(m){this.isEnabled()||(this._enabled=!0,this._aroundCenter=m&&m.around==="center")},un.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},un.prototype.wheel=function(m){if(this.isEnabled()){var v=m.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*m.deltaY:m.deltaY,g=s.browser.now(),w=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,v!==0&&v%4.000244140625==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,m)):this._type||(this._type=Math.abs(w*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),m.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=m,this._delta-=v,this._active||this._start(m)),m.preventDefault()}},un.prototype._onTimeout=function(m){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},un.prototype._start=function(m){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var v=c.mousePos(this._el,m);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(v)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},un.prototype.renderFrame=function(){var m=this;if(this._frameId&&(this._frameId=null,this.isActive())){var v=this._map.transform;if(this._delta!==0){var g=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,w=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&w!==0&&(w=1/w);var B=typeof this._targetZoom=="number"?v.zoomScale(this._targetZoom):v.scale;this._targetZoom=Math.min(v.maxZoom,Math.max(v.minZoom,v.scaleZoom(B*w))),this._type==="wheel"&&(this._startZoom=v.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var D,O=typeof this._targetZoom=="number"?this._targetZoom:v.zoom,G=this._startZoom,J=this._easing,at=!1;if(this._type==="wheel"&&G&&J){var Et=Math.min((s.browser.now()-this._lastWheelEventTime)/200,1),Ct=J(Et);D=s.number(G,O,Ct),Et<1?this._frameId||(this._frameId=!0):at=!0}else D=O,at=!0;return this._active=!0,at&&(this._active=!1,this._finishTimeout=setTimeout(function(){m._zooming=!1,m._handler._triggerRenderFrame(),delete m._targetZoom,delete m._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!at,zoomDelta:D-v.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},un.prototype._smoothOutEasing=function(m){var v=s.ease;if(this._prevEase){var g=this._prevEase,w=(s.browser.now()-g.start)/g.duration,B=g.easing(w+.01)-g.easing(w),D=.27/Math.sqrt(B*B+1e-4)*.01,O=Math.sqrt(.0729-D*D);v=s.bezier(D,O,.25,1)}return this._prevEase={start:s.browser.now(),duration:m,easing:v},v},un.prototype.blur=function(){this.reset()},un.prototype.reset=function(){this._active=!1};var Os=function(m,v){this._clickZoom=m,this._tapZoom=v};Os.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Os.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Os.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Os.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Fs=function(){this.reset()};Fs.prototype.reset=function(){this._active=!1},Fs.prototype.blur=function(){this.reset()},Fs.prototype.dblclick=function(m,v){return m.preventDefault(),{cameraAnimation:function(g){g.easeTo({duration:300,zoom:g.getZoom()+(m.shiftKey?-1:1),around:g.unproject(v)},{originalEvent:m})}}},Fs.prototype.enable=function(){this._enabled=!0},Fs.prototype.disable=function(){this._enabled=!1,this.reset()},Fs.prototype.isEnabled=function(){return this._enabled},Fs.prototype.isActive=function(){return this._active};var Dr=function(){this._tap=new xo({numTouches:1,numTaps:1}),this.reset()};Dr.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Dr.prototype.touchstart=function(m,v,g){this._swipePoint||(this._tapTime&&m.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=v[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(m,v,g))},Dr.prototype.touchmove=function(m,v,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;var w=v[0],B=w.y-this._swipePoint.y;return this._swipePoint=w,m.preventDefault(),this._active=!0,{zoomDelta:B/128}}}else this._tap.touchmove(m,v,g)},Dr.prototype.touchend=function(m,v,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(m,v,g)&&(this._tapTime=m.timeStamp)},Dr.prototype.touchcancel=function(){this.reset()},Dr.prototype.enable=function(){this._enabled=!0},Dr.prototype.disable=function(){this._enabled=!1,this.reset()},Dr.prototype.isEnabled=function(){return this._enabled},Dr.prototype.isActive=function(){return this._active};var Ca=function(m,v,g){this._el=m,this._mousePan=v,this._touchPan=g};Ca.prototype.enable=function(m){this._inertiaOptions=m||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ca.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ca.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ca.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var To=function(m,v,g){this._pitchWithRotate=m.pitchWithRotate,this._mouseRotate=v,this._mousePitch=g};To.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},To.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},To.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},To.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var uo=function(m,v,g,w){this._el=m,this._touchZoom=v,this._touchRotate=g,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0};uo.prototype.enable=function(m){this._touchZoom.enable(m),this._rotationDisabled||this._touchRotate.enable(m),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},uo.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},uo.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},uo.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},uo.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},uo.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var us=function(m){return m.zoom||m.drag||m.pitch||m.rotate},Tu=(function(m){function v(){m.apply(this,arguments)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v})(s.Event);function Ii(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}var pi=function(m,v){this._map=m,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wu(m),this._bearingSnap=v.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(v),s.bindAll(["handleEvent","handleWindowEvent"],this);var g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[s.window,"blur",void 0]];for(var w=0,B=this._listeners;w<B.length;w+=1){var D=B[w],O=D[0];c.addEventListener(O,D[1],O===s.window.document?this.handleWindowEvent:this.handleEvent,D[2])}};pi.prototype.destroy=function(){for(var m=0,v=this._listeners;m<v.length;m+=1){var g=v[m],w=g[0];c.removeEventListener(w,g[1],w===s.window.document?this.handleWindowEvent:this.handleEvent,g[2])}},pi.prototype._addDefaultHandlers=function(m){var v=this._map,g=v.getCanvasContainer();this._add("mapEvent",new wr(v,m));var w=v.boxZoom=new Ds(v,m);this._add("boxZoom",w);var B=new bs,D=new Fs;v.doubleClickZoom=new Os(D,B),this._add("tapZoom",B),this._add("clickZoom",D);var O=new Dr;this._add("tapDragZoom",O);var G=v.touchPitch=new wc;this._add("touchPitch",G);var J=new Cu(m),at=new yh(m);v.dragRotate=new To(m,J,at),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",at,["mouseRotate"]);var Et=new wo(m),Ct=new lo(m);v.dragPan=new Ca(g,Et,Ct),this._add("mousePan",Et),this._add("touchPan",Ct,["touchZoom","touchRotate"]);var Bt=new Uf,Wt=new Sr;v.touchZoomRotate=new uo(g,Wt,Bt,O),this._add("touchRotate",Bt,["touchPan","touchZoom"]),this._add("touchZoom",Wt,["touchPan","touchRotate"]);var zt=v.scrollZoom=new un(v,this);this._add("scrollZoom",zt,["mousePan"]);var f=v.keyboard=new Co;this._add("keyboard",f),this._add("blockableMapEvent",new ci(v));for(var h=0,A=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];h<A.length;h+=1){var b=A[h];m.interactive&&m[b]&&v[b].enable(m[b])}},pi.prototype._add=function(m,v,g){this._handlers.push({handlerName:m,handler:v,allowed:g}),this._handlersById[m]=v},pi.prototype.stop=function(m){if(!this._updatingCamera){for(var v=0,g=this._handlers;v<g.length;v+=1)g[v].handler.reset();this._inertia.clear(),this._fireEvents({},{},m),this._changes=[]}},pi.prototype.isActive=function(){for(var m=0,v=this._handlers;m<v.length;m+=1)if(v[m].handler.isActive())return!0;return!1},pi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},pi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},pi.prototype.isMoving=function(){return!!us(this._eventsInProgress)||this.isZooming()},pi.prototype._blockedByActive=function(m,v,g){for(var w in m)if(w!==g&&(!v||v.indexOf(w)<0))return!0;return!1},pi.prototype.handleWindowEvent=function(m){this.handleEvent(m,m.type+"Window")},pi.prototype._getMapTouches=function(m){for(var v=[],g=0,w=m;g<w.length;g+=1){var B=w[g];this._el.contains(B.target)&&v.push(B)}return v},pi.prototype.handleEvent=function(m,v){this._updatingCamera=!0;for(var g=m.type==="renderFrame"?void 0:m,w={needsRenderFrame:!1},B={},D={},O=m.touches?this._getMapTouches(m.touches):void 0,G=O?c.touchPos(this._el,O):c.mousePos(this._el,m),J=0,at=this._handlers;J<at.length;J+=1){var Et=at[J],Ct=Et.handlerName,Bt=Et.handler,Wt=Et.allowed;if(Bt.isEnabled()){var zt=void 0;this._blockedByActive(D,Wt,Ct)?Bt.reset():Bt[v||m.type]&&(zt=Bt[v||m.type](m,G,O),this.mergeHandlerResult(w,B,zt,Ct,g),zt&&zt.needsRenderFrame&&this._triggerRenderFrame()),(zt||Bt.isActive())&&(D[Ct]=Bt)}}var f={};for(var h in this._previousActiveHandlers)D[h]||(f[h]=g);this._previousActiveHandlers=D,(Object.keys(f).length||Ii(w))&&(this._changes.push([w,B,f]),this._triggerRenderFrame()),(Object.keys(D).length||Ii(w))&&this._map._stop(!0),this._updatingCamera=!1;var A=w.cameraAnimation;A&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],A(this._map))},pi.prototype.mergeHandlerResult=function(m,v,g,w,B){if(g){s.extend(m,g);var D={handlerName:w,originalEvent:g.originalEvent||B};g.zoomDelta!==void 0&&(v.zoom=D),g.panDelta!==void 0&&(v.drag=D),g.pitchDelta!==void 0&&(v.pitch=D),g.bearingDelta!==void 0&&(v.rotate=D)}},pi.prototype._applyChanges=function(){for(var m={},v={},g={},w=0,B=this._changes;w<B.length;w+=1){var D=B[w],O=D[0],G=D[1],J=D[2];O.panDelta&&(m.panDelta=(m.panDelta||new s.Point(0,0))._add(O.panDelta)),O.zoomDelta&&(m.zoomDelta=(m.zoomDelta||0)+O.zoomDelta),O.bearingDelta&&(m.bearingDelta=(m.bearingDelta||0)+O.bearingDelta),O.pitchDelta&&(m.pitchDelta=(m.pitchDelta||0)+O.pitchDelta),O.around!==void 0&&(m.around=O.around),O.pinchAround!==void 0&&(m.pinchAround=O.pinchAround),O.noInertia&&(m.noInertia=O.noInertia),s.extend(v,G),s.extend(g,J)}this._updateMapTransform(m,v,g),this._changes=[]},pi.prototype._updateMapTransform=function(m,v,g){var w=this._map,B=w.transform;if(!Ii(m))return this._fireEvents(v,g,!0);var D=m.panDelta,O=m.zoomDelta,G=m.bearingDelta,J=m.pitchDelta,at=m.around,Et=m.pinchAround;Et!==void 0&&(at=Et),w._stop(!0),at=at||w.transform.centerPoint;var Ct=B.pointLocation(D?at.sub(D):at);G&&(B.bearing+=G),J&&(B.pitch+=J),O&&(B.zoom+=O),B.setLocationAtPoint(Ct,at),this._map._update(),m.noInertia||this._inertia.record(m),this._fireEvents(v,g,!0)},pi.prototype._fireEvents=function(m,v,g){var w=this,B=us(this._eventsInProgress),D=us(m),O={};for(var G in m)this._eventsInProgress[G]||(O[G+"start"]=m[G].originalEvent),this._eventsInProgress[G]=m[G];for(var J in!B&&D&&this._fireEvent("movestart",D.originalEvent),O)this._fireEvent(J,O[J]);for(var at in D&&this._fireEvent("move",D.originalEvent),m)this._fireEvent(at,m[at].originalEvent);var Et,Ct={};for(var Bt in this._eventsInProgress){var Wt=this._eventsInProgress[Bt],zt=Wt.handlerName,f=Wt.originalEvent;this._handlersById[zt].isActive()||(delete this._eventsInProgress[Bt],Ct[Bt+"end"]=Et=v[zt]||f)}for(var h in Ct)this._fireEvent(h,Ct[h]);var A=us(this._eventsInProgress);if(g&&(B||D)&&!A){this._updatingCamera=!0;var b=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),E=function(S){return S!==0&&-w._bearingSnap<S&&S<w._bearingSnap};b?(E(b.bearing||this._map.getBearing())&&(b.bearing=0),this._map.easeTo(b,{originalEvent:Et})):(this._map.fire(new s.Event("moveend",{originalEvent:Et})),E(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},pi.prototype._fireEvent=function(m,v){this._map.fire(new s.Event(m,v?{originalEvent:v}:{}))},pi.prototype._requestFrame=function(){var m=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(v){delete m._frameId,m.handleEvent(new Tu("renderFrame",{timeStamp:v})),m._applyChanges()})},pi.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ec=(function(m){function v(g,w){m.call(this),this._moving=!1,this._zooming=!1,this.transform=g,this._bearingSnap=w.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.getCenter=function(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)},v.prototype.setCenter=function(g,w){return this.jumpTo({center:g},w)},v.prototype.panBy=function(g,w,B){return g=s.Point.convert(g).mult(-1),this.panTo(this.transform.center,s.extend({offset:g},w),B)},v.prototype.panTo=function(g,w,B){return this.easeTo(s.extend({center:g},w),B)},v.prototype.getZoom=function(){return this.transform.zoom},v.prototype.setZoom=function(g,w){return this.jumpTo({zoom:g},w),this},v.prototype.zoomTo=function(g,w,B){return this.easeTo(s.extend({zoom:g},w),B)},v.prototype.zoomIn=function(g,w){return this.zoomTo(this.getZoom()+1,g,w),this},v.prototype.zoomOut=function(g,w){return this.zoomTo(this.getZoom()-1,g,w),this},v.prototype.getBearing=function(){return this.transform.bearing},v.prototype.setBearing=function(g,w){return this.jumpTo({bearing:g},w),this},v.prototype.getPadding=function(){return this.transform.padding},v.prototype.setPadding=function(g,w){return this.jumpTo({padding:g},w),this},v.prototype.rotateTo=function(g,w,B){return this.easeTo(s.extend({bearing:g},w),B)},v.prototype.resetNorth=function(g,w){return this.rotateTo(0,s.extend({duration:1e3},g),w),this},v.prototype.resetNorthPitch=function(g,w){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},g),w),this},v.prototype.snapToNorth=function(g,w){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(g,w):this},v.prototype.getPitch=function(){return this.transform.pitch},v.prototype.setPitch=function(g,w){return this.jumpTo({pitch:g},w),this},v.prototype.cameraForBounds=function(g,w){g=s.LngLatBounds.convert(g);var B=w&&w.bearing||0;return this._cameraForBoxAndBearing(g.getNorthWest(),g.getSouthEast(),B,w)},v.prototype._cameraForBoxAndBearing=function(g,w,B,D){var O={top:0,bottom:0,right:0,left:0};if(typeof(D=s.extend({padding:O,offset:[0,0],maxZoom:this.transform.maxZoom},D)).padding=="number"){var G=D.padding;D.padding={top:G,bottom:G,right:G,left:G}}D.padding=s.extend(O,D.padding);var J=this.transform,at=J.padding,Et=J.project(s.LngLat.convert(g)),Ct=J.project(s.LngLat.convert(w)),Bt=Et.rotate(-B*Math.PI/180),Wt=Ct.rotate(-B*Math.PI/180),zt=new s.Point(Math.max(Bt.x,Wt.x),Math.max(Bt.y,Wt.y)),f=new s.Point(Math.min(Bt.x,Wt.x),Math.min(Bt.y,Wt.y)),h=zt.sub(f),A=(J.width-(at.left+at.right+D.padding.left+D.padding.right))/h.x,b=(J.height-(at.top+at.bottom+D.padding.top+D.padding.bottom))/h.y;if(!(b<0||A<0)){var E=Math.min(J.scaleZoom(J.scale*Math.min(A,b)),D.maxZoom),S=typeof D.offset.x=="number"?new s.Point(D.offset.x,D.offset.y):s.Point.convert(D.offset),P=new s.Point((D.padding.left-D.padding.right)/2,(D.padding.top-D.padding.bottom)/2).rotate(B*Math.PI/180),R=S.add(P).mult(J.scale/J.zoomScale(E));return{center:J.unproject(Et.add(Ct).div(2).sub(R)),zoom:E,bearing:B}}s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},v.prototype.fitBounds=function(g,w,B){return this._fitInternal(this.cameraForBounds(g,w),w,B)},v.prototype.fitScreenCoordinates=function(g,w,B,D,O){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(g)),this.transform.pointLocation(s.Point.convert(w)),B,D),D,O)},v.prototype._fitInternal=function(g,w,B){return g?(delete(w=s.extend(g,w)).padding,w.linear?this.easeTo(w,B):this.flyTo(w,B)):this},v.prototype.jumpTo=function(g,w){this.stop();var B=this.transform,D=!1,O=!1,G=!1;return"zoom"in g&&B.zoom!==+g.zoom&&(D=!0,B.zoom=+g.zoom),g.center!==void 0&&(B.center=s.LngLat.convert(g.center)),"bearing"in g&&B.bearing!==+g.bearing&&(O=!0,B.bearing=+g.bearing),"pitch"in g&&B.pitch!==+g.pitch&&(G=!0,B.pitch=+g.pitch),g.padding==null||B.isPaddingEqual(g.padding)||(B.padding=g.padding),this.fire(new s.Event("movestart",w)).fire(new s.Event("move",w)),D&&this.fire(new s.Event("zoomstart",w)).fire(new s.Event("zoom",w)).fire(new s.Event("zoomend",w)),O&&this.fire(new s.Event("rotatestart",w)).fire(new s.Event("rotate",w)).fire(new s.Event("rotateend",w)),G&&this.fire(new s.Event("pitchstart",w)).fire(new s.Event("pitch",w)).fire(new s.Event("pitchend",w)),this.fire(new s.Event("moveend",w))},v.prototype.easeTo=function(g,w){var B=this;this._stop(!1,g.easeId),((g=s.extend({offset:[0,0],duration:500,easing:s.ease},g)).animate===!1||!g.essential&&s.browser.prefersReducedMotion)&&(g.duration=0);var D=this.transform,O=this.getZoom(),G=this.getBearing(),J=this.getPitch(),at=this.getPadding(),Et="zoom"in g?+g.zoom:O,Ct="bearing"in g?this._normalizeBearing(g.bearing,G):G,Bt="pitch"in g?+g.pitch:J,Wt="padding"in g?g.padding:D.padding,zt=s.Point.convert(g.offset),f=D.centerPoint.add(zt),h=D.pointLocation(f),A=s.LngLat.convert(g.center||h);this._normalizeCenter(A);var b,E,S=D.project(h),P=D.project(A).sub(S),R=D.zoomScale(Et-O);g.around&&(b=s.LngLat.convert(g.around),E=D.locationPoint(b));var F={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Et!==O,this._rotating=this._rotating||G!==Ct,this._pitching=this._pitching||Bt!==J,this._padding=!D.isPaddingEqual(Wt),this._easeId=g.easeId,this._prepareEase(w,g.noMoveStart,F),this._ease(function(U){if(B._zooming&&(D.zoom=s.number(O,Et,U)),B._rotating&&(D.bearing=s.number(G,Ct,U)),B._pitching&&(D.pitch=s.number(J,Bt,U)),B._padding&&(D.interpolatePadding(at,Wt,U),f=D.centerPoint.add(zt)),b)D.setLocationAtPoint(b,E);else{var W=D.zoomScale(D.zoom-O),ht=Et>O?Math.min(2,R):Math.max(.5,R),Pt=Math.pow(ht,1-U),It=D.unproject(S.add(P.mult(U*Pt)).mult(W));D.setLocationAtPoint(D.renderWorldCopies?It.wrap():It,f)}B._fireMoveEvents(w)},function(U){B._afterEase(w,U)},g),this},v.prototype._prepareEase=function(g,w,B){B===void 0&&(B={}),this._moving=!0,w||B.moving||this.fire(new s.Event("movestart",g)),this._zooming&&!B.zooming&&this.fire(new s.Event("zoomstart",g)),this._rotating&&!B.rotating&&this.fire(new s.Event("rotatestart",g)),this._pitching&&!B.pitching&&this.fire(new s.Event("pitchstart",g))},v.prototype._fireMoveEvents=function(g){this.fire(new s.Event("move",g)),this._zooming&&this.fire(new s.Event("zoom",g)),this._rotating&&this.fire(new s.Event("rotate",g)),this._pitching&&this.fire(new s.Event("pitch",g))},v.prototype._afterEase=function(g,w){if(!this._easeId||!w||this._easeId!==w){delete this._easeId;var B=this._zooming,D=this._rotating,O=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,B&&this.fire(new s.Event("zoomend",g)),D&&this.fire(new s.Event("rotateend",g)),O&&this.fire(new s.Event("pitchend",g)),this.fire(new s.Event("moveend",g))}},v.prototype.flyTo=function(g,w){var B=this;if(!g.essential&&s.browser.prefersReducedMotion){var D=s.pick(g,["center","zoom","bearing","pitch","around"]);return this.jumpTo(D,w)}this.stop(),g=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},g);var O=this.transform,G=this.getZoom(),J=this.getBearing(),at=this.getPitch(),Et=this.getPadding(),Ct="zoom"in g?s.clamp(+g.zoom,O.minZoom,O.maxZoom):G,Bt="bearing"in g?this._normalizeBearing(g.bearing,J):J,Wt="pitch"in g?+g.pitch:at,zt="padding"in g?g.padding:O.padding,f=O.zoomScale(Ct-G),h=s.Point.convert(g.offset),A=O.centerPoint.add(h),b=O.pointLocation(A),E=s.LngLat.convert(g.center||b);this._normalizeCenter(E);var S=O.project(b),P=O.project(E).sub(S),R=g.curve,F=Math.max(O.width,O.height),U=F/f,W=P.mag();if("minZoom"in g){var ht=s.clamp(Math.min(g.minZoom,G,Ct),O.minZoom,O.maxZoom),Pt=F/O.zoomScale(ht-G);R=Math.sqrt(Pt/W*2)}var It=R*R;function Mt(Ge){var ze=(U*U-F*F+(Ge?-1:1)*It*It*W*W)/(2*(Ge?U:F)*It*W);return Math.log(Math.sqrt(ze*ze+1)-ze)}function Yt(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function Ht(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}var ie=Mt(0),te=function(Ge){return Ht(ie)/Ht(ie+R*Ge)},Jt=function(Ge){return F*((Ht(ie)*(Yt(ze=ie+R*Ge)/Ht(ze))-Yt(ie))/It)/W;var ze},qt=(Mt(1)-ie)/R;if(Math.abs(W)<1e-6||!isFinite(qt)){if(Math.abs(F-U)<1e-6)return this.easeTo(g,w);var Be=U<F?-1:1;qt=Math.abs(Math.log(U/F))/R,Jt=function(){return 0},te=function(Ge){return Math.exp(Be*R*Ge)}}return g.duration="duration"in g?+g.duration:1e3*qt/("screenSpeed"in g?+g.screenSpeed/R:+g.speed),g.maxDuration&&g.duration>g.maxDuration&&(g.duration=0),this._zooming=!0,this._rotating=J!==Bt,this._pitching=Wt!==at,this._padding=!O.isPaddingEqual(zt),this._prepareEase(w,!1),this._ease(function(Ge){var ze=Ge*qt,Ri=1/te(ze);O.zoom=Ge===1?Ct:G+O.scaleZoom(Ri),B._rotating&&(O.bearing=s.number(J,Bt,Ge)),B._pitching&&(O.pitch=s.number(at,Wt,Ge)),B._padding&&(O.interpolatePadding(Et,zt,Ge),A=O.centerPoint.add(h));var Ci=Ge===1?E:O.unproject(S.add(P.mult(Jt(ze))).mult(Ri));O.setLocationAtPoint(O.renderWorldCopies?Ci.wrap():Ci,A),B._fireMoveEvents(w)},function(){return B._afterEase(w)},g),this},v.prototype.isEasing=function(){return!!this._easeFrameId},v.prototype.stop=function(){return this._stop()},v.prototype._stop=function(g,w){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var B=this._onEaseEnd;delete this._onEaseEnd,B.call(this,w)}if(!g){var D=this.handlers;D&&D.stop(!1)}return this},v.prototype._ease=function(g,w,B){B.animate===!1||B.duration===0?(g(1),w()):(this._easeStart=s.browser.now(),this._easeOptions=B,this._onEaseFrame=g,this._onEaseEnd=w,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},v.prototype._renderFrameCallback=function(){var g=Math.min((s.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},v.prototype._normalizeBearing=function(g,w){g=s.wrap(g,-180,180);var B=Math.abs(g-w);return Math.abs(g-360-w)<B&&(g-=360),Math.abs(g+360-w)<B&&(g+=360),g},v.prototype._normalizeCenter=function(g){var w=this.transform;if(w.renderWorldCopies&&!w.lngRange){var B=g.lng-w.center.lng;g.lng+=B>180?-360:B<-180?360:0}},v})(s.Evented),cs=function(m){m===void 0&&(m={}),this.options=m,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};cs.prototype.getDefaultPosition=function(){return"bottom-right"},cs.prototype.onAdd=function(m){var v=this.options&&this.options.compact;return this._map=m,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=c.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=c.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),v&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),v===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},cs.prototype.onRemove=function(){c.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},cs.prototype._setElementTitle=function(m,v){var g=this._map._getUIString("AttributionControl."+v);m.title=g,m.setAttribute("aria-label",g)},cs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},cs.prototype._updateEditLink=function(){var m=this._editLink;m||(m=this._editLink=this._container.querySelector(".mapbox-improve-map"));var v=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(m){var g=v.reduce(function(w,B,D){return B.value&&(w+=B.key+"="+B.value+(D<v.length-1?"&":"")),w},"?");m.href=s.config.FEEDBACK_URL+"/"+g+(this._map._hash?this._map._hash.getHashString(!0):""),m.rel="noopener nofollow",this._setElementTitle(m,"MapFeedback")}},cs.prototype._updateData=function(m){!m||m.sourceDataType!=="metadata"&&m.sourceDataType!=="visibility"&&m.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},cs.prototype._updateAttributions=function(){if(this._map.style){var m=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?m=m.concat(this.options.customAttribution.map(function(G){return typeof G!="string"?"":G})):typeof this.options.customAttribution=="string"&&m.push(this.options.customAttribution)),this._map.style.stylesheet){var v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}var g=this._map.style.sourceCaches;for(var w in g){var B=g[w];if(B.used){var D=B.getSource();D.attribution&&m.indexOf(D.attribution)<0&&m.push(D.attribution)}}m.sort(function(G,J){return G.length-J.length});var O=(m=m.filter(function(G,J){for(var at=J+1;at<m.length;at++)if(m[at].indexOf(G)>=0)return!1;return!0})).join(" | ");O!==this._attribHTML&&(this._attribHTML=O,m.length?(this._innerContainer.innerHTML=O,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},cs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var So=function(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)};So.prototype.onAdd=function(m){this._map=m,this._container=c.create("div","mapboxgl-ctrl");var v=c.create("a","mapboxgl-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://www.mapbox.com/",v.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),v.setAttribute("rel","noopener nofollow"),this._container.appendChild(v),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},So.prototype.onRemove=function(){c.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},So.prototype.getDefaultPosition=function(){return"bottom-left"},So.prototype._updateLogo=function(m){m&&m.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},So.prototype._logoRequired=function(){if(this._map.style){var m=this._map.style.sourceCaches;for(var v in m)if(m[v].getSource().mapbox_logo)return!0;return!1}},So.prototype._updateCompact=function(){var m=this._container.children;if(m.length){var v=m[0];this._map.getCanvasContainer().offsetWidth<250?v.classList.add("mapboxgl-compact"):v.classList.remove("mapboxgl-compact")}};var Kr=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Kr.prototype.add=function(m){var v=++this._id;return this._queue.push({callback:m,id:v,cancelled:!1}),v},Kr.prototype.remove=function(m){for(var v=this._currentlyRunning,g=0,w=v?this._queue.concat(v):this._queue;g<w.length;g+=1){var B=w[g];if(B.id===m)return void(B.cancelled=!0)}},Kr.prototype.run=function(m){m===void 0&&(m=0);var v=this._currentlyRunning=this._queue;this._queue=[];for(var g=0,w=v;g<w.length;g+=1){var B=w[g];if(!B.cancelled&&(B.callback(m),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Kr.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var jo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Cc=s.window.HTMLImageElement,Su=s.window.HTMLElement,Ki=s.window.ImageBitmap,zr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Vf=(function(m){function v(w){var B=this;if((w=s.extend({},zr,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var D=new qi(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies);if(m.call(this,D,w),this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new Kr,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},jo,w.locale),this._clickTolerance=w.clickTolerance,this._requestManager=new s.RequestManager(w.transformRequest,w.accessToken),typeof w.container=="string"){if(this._container=s.window.document.getElementById(w.container),!this._container)throw new Error("Container '"+w.container+"' not found.")}else{if(!(w.container instanceof Su))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return B._update(!1)}),this.on("moveend",function(){return B._update(!1)}),this.on("zoom",function(){return B._update(!0)}),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new pi(this,w),this._hash=w.hash&&new ns(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,s.extend({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new cs({customAttribution:w.customAttribution})),this.addControl(new So,w.logoPosition),this.on("style.load",function(){B.transform.unmodified&&B.jumpTo(B.style.stylesheet)}),this.on("data",function(O){B._update(O.dataType==="style"),B.fire(new s.Event(O.dataType+"data",O))}),this.on("dataloading",function(O){B.fire(new s.Event(O.dataType+"dataloading",O))})}m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v;var g={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return v.prototype._getMapId=function(){return this._mapId},v.prototype.addControl=function(w,B){if(B===void 0&&(B=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var D=w.onAdd(this);this._controls.push(w);var O=this._controlPositions[B];return B.indexOf("bottom")!==-1?O.insertBefore(D,O.firstChild):O.appendChild(D),this},v.prototype.removeControl=function(w){if(!w||!w.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var B=this._controls.indexOf(w);return B>-1&&this._controls.splice(B,1),w.onRemove(this),this},v.prototype.hasControl=function(w){return this._controls.indexOf(w)>-1},v.prototype.resize=function(w){var B=this._containerDimensions(),D=B[0],O=B[1];if(D===this.transform.width&&O===this.transform.height)return this;this._resizeCanvas(D,O),this.transform.resize(D,O),this.painter.resize(D,O);var G=!this._moving;return G&&this.fire(new s.Event("movestart",w)).fire(new s.Event("move",w)),this.fire(new s.Event("resize",w)),G&&this.fire(new s.Event("moveend",w)),this},v.prototype.getBounds=function(){return this.transform.getBounds()},v.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},v.prototype.setMaxBounds=function(w){return this.transform.setMaxBounds(s.LngLatBounds.convert(w)),this._update()},v.prototype.setMinZoom=function(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},v.prototype.getMinZoom=function(){return this.transform.minZoom},v.prototype.setMaxZoom=function(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")},v.prototype.getMaxZoom=function(){return this.transform.maxZoom},v.prototype.setMinPitch=function(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},v.prototype.getMinPitch=function(){return this.transform.minPitch},v.prototype.setMaxPitch=function(w){if((w=w??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")},v.prototype.getMaxPitch=function(){return this.transform.maxPitch},v.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},v.prototype.setRenderWorldCopies=function(w){return this.transform.renderWorldCopies=w,this._update()},v.prototype.project=function(w){return this.transform.locationPoint(s.LngLat.convert(w))},v.prototype.unproject=function(w){return this.transform.pointLocation(s.Point.convert(w))},v.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},v.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},v.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},v.prototype._createDelegatedListener=function(w,B,D){var O,G=this;if(w==="mouseenter"||w==="mouseover"){var J=!1;return{layer:B,listener:D,delegates:{mousemove:function(Et){var Ct=G.getLayer(B)?G.queryRenderedFeatures(Et.point,{layers:[B]}):[];Ct.length?J||(J=!0,D.call(G,new xr(w,G,Et.originalEvent,{features:Ct}))):J=!1},mouseout:function(){J=!1}}}}if(w==="mouseleave"||w==="mouseout"){var at=!1;return{layer:B,listener:D,delegates:{mousemove:function(Et){(G.getLayer(B)?G.queryRenderedFeatures(Et.point,{layers:[B]}):[]).length?at=!0:at&&(at=!1,D.call(G,new xr(w,G,Et.originalEvent)))},mouseout:function(Et){at&&(at=!1,D.call(G,new xr(w,G,Et.originalEvent)))}}}}return{layer:B,listener:D,delegates:(O={},O[w]=function(Et){var Ct=G.getLayer(B)?G.queryRenderedFeatures(Et.point,{layers:[B]}):[];Ct.length&&(Et.features=Ct,D.call(G,Et),delete Et.features)},O)}},v.prototype.on=function(w,B,D){if(D===void 0)return m.prototype.on.call(this,w,B);var O=this._createDelegatedListener(w,B,D);for(var G in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(O),O.delegates)this.on(G,O.delegates[G]);return this},v.prototype.once=function(w,B,D){if(D===void 0)return m.prototype.once.call(this,w,B);var O=this._createDelegatedListener(w,B,D);for(var G in O.delegates)this.once(G,O.delegates[G]);return this},v.prototype.off=function(w,B,D){var O=this;return D===void 0?m.prototype.off.call(this,w,B):(this._delegatedListeners&&this._delegatedListeners[w]&&(function(G){for(var J=G[w],at=0;at<J.length;at++){var Et=J[at];if(Et.layer===B&&Et.listener===D){for(var Ct in Et.delegates)O.off(Ct,Et.delegates[Ct]);return J.splice(at,1),O}}})(this._delegatedListeners),this)},v.prototype.queryRenderedFeatures=function(w,B){if(!this.style)return[];var D;if(B!==void 0||w===void 0||w instanceof s.Point||Array.isArray(w)||(B=w,w=void 0),B=B||{},(w=w||[[0,0],[this.transform.width,this.transform.height]])instanceof s.Point||typeof w[0]=="number")D=[s.Point.convert(w)];else{var O=s.Point.convert(w[0]),G=s.Point.convert(w[1]);D=[O,new s.Point(G.x,O.y),G,new s.Point(O.x,G.y),O]}return this.style.queryRenderedFeatures(D,B,this.transform)},v.prototype.querySourceFeatures=function(w,B){return this.style.querySourceFeatures(w,B)},v.prototype.setStyle=function(w,B){return(B=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},B)).diff!==!1&&B.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,B),this):(this._localIdeographFontFamily=B.localIdeographFontFamily,this._updateStyle(w,B))},v.prototype._getUIString=function(w){var B=this._locale[w];if(B==null)throw new Error("Missing UI string '"+w+"'");return B},v.prototype._updateStyle=function(w,B){return this.style&&(this.style.setEventedParent(null),this.style._remove()),w?(this.style=new ys(this,B||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w):this.style.loadJSON(w),this):(delete this.style,this)},v.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ys(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},v.prototype._diffStyle=function(w,B){var D=this;if(typeof w=="string"){var O=this._requestManager.normalizeStyleURL(w),G=this._requestManager.transformRequest(O,s.ResourceType.Style);s.getJSON(G,function(J,at){J?D.fire(new s.ErrorEvent(J)):at&&D._updateDiff(at,B)})}else typeof w=="object"&&this._updateDiff(w,B)},v.prototype._updateDiff=function(w,B){try{this.style.setState(w)&&this._update(!0)}catch(D){s.warnOnce("Unable to perform style diff: "+(D.message||D.error||D)+".  Rebuilding the style from scratch."),this._updateStyle(w,B)}},v.prototype.getStyle=function(){if(this.style)return this.style.serialize()},v.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")},v.prototype.addSource=function(w,B){return this._lazyInitEmptyStyle(),this.style.addSource(w,B),this._update(!0)},v.prototype.isSourceLoaded=function(w){var B=this.style&&this.style.sourceCaches[w];if(B!==void 0)return B.loaded();this.fire(new s.ErrorEvent(new Error("There is no source with ID '"+w+"'")))},v.prototype.areTilesLoaded=function(){var w=this.style&&this.style.sourceCaches;for(var B in w){var D=w[B]._tiles;for(var O in D){var G=D[O];if(G.state!=="loaded"&&G.state!=="errored")return!1}}return!0},v.prototype.addSourceType=function(w,B,D){return this._lazyInitEmptyStyle(),this.style.addSourceType(w,B,D)},v.prototype.removeSource=function(w){return this.style.removeSource(w),this._update(!0)},v.prototype.getSource=function(w){return this.style.getSource(w)},v.prototype.addImage=function(w,B,D){D===void 0&&(D={});var O=D.pixelRatio;O===void 0&&(O=1);var G=D.sdf;G===void 0&&(G=!1);var J=D.stretchX,at=D.stretchY,Et=D.content;if(this._lazyInitEmptyStyle(),B instanceof Cc||Ki&&B instanceof Ki){var Ct=s.browser.getImageData(B);this.style.addImage(w,{data:new s.RGBAImage({width:Ct.width,height:Ct.height},Ct.data),pixelRatio:O,stretchX:J,stretchY:at,content:Et,sdf:G,version:0})}else{if(B.width===void 0||B.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Bt=B;this.style.addImage(w,{data:new s.RGBAImage({width:B.width,height:B.height},new Uint8Array(B.data)),pixelRatio:O,stretchX:J,stretchY:at,content:Et,sdf:G,version:0,userImage:Bt}),Bt.onAdd&&Bt.onAdd(this,w)}},v.prototype.updateImage=function(w,B){var D=this.style.getImage(w);if(!D)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var O=B instanceof Cc||Ki&&B instanceof Ki?s.browser.getImageData(B):B,G=O.width,J=O.height,at=O.data;return G===void 0||J===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):G!==D.data.width||J!==D.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(D.data.replace(at,!(B instanceof Cc||Ki&&B instanceof Ki)),void this.style.updateImage(w,D))},v.prototype.hasImage=function(w){return w?!!this.style.getImage(w):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)},v.prototype.removeImage=function(w){this.style.removeImage(w)},v.prototype.loadImage=function(w,B){s.getImage(this._requestManager.transformRequest(w,s.ResourceType.Image),B)},v.prototype.listImages=function(){return this.style.listImages()},v.prototype.addLayer=function(w,B){return this._lazyInitEmptyStyle(),this.style.addLayer(w,B),this._update(!0)},v.prototype.moveLayer=function(w,B){return this.style.moveLayer(w,B),this._update(!0)},v.prototype.removeLayer=function(w){return this.style.removeLayer(w),this._update(!0)},v.prototype.getLayer=function(w){return this.style.getLayer(w)},v.prototype.setLayerZoomRange=function(w,B,D){return this.style.setLayerZoomRange(w,B,D),this._update(!0)},v.prototype.setFilter=function(w,B,D){return D===void 0&&(D={}),this.style.setFilter(w,B,D),this._update(!0)},v.prototype.getFilter=function(w){return this.style.getFilter(w)},v.prototype.setPaintProperty=function(w,B,D,O){return O===void 0&&(O={}),this.style.setPaintProperty(w,B,D,O),this._update(!0)},v.prototype.getPaintProperty=function(w,B){return this.style.getPaintProperty(w,B)},v.prototype.setLayoutProperty=function(w,B,D,O){return O===void 0&&(O={}),this.style.setLayoutProperty(w,B,D,O),this._update(!0)},v.prototype.getLayoutProperty=function(w,B){return this.style.getLayoutProperty(w,B)},v.prototype.setLight=function(w,B){return B===void 0&&(B={}),this._lazyInitEmptyStyle(),this.style.setLight(w,B),this._update(!0)},v.prototype.getLight=function(){return this.style.getLight()},v.prototype.setFeatureState=function(w,B){return this.style.setFeatureState(w,B),this._update()},v.prototype.removeFeatureState=function(w,B){return this.style.removeFeatureState(w,B),this._update()},v.prototype.getFeatureState=function(w){return this.style.getFeatureState(w)},v.prototype.getContainer=function(){return this._container},v.prototype.getCanvasContainer=function(){return this._canvasContainer},v.prototype.getCanvas=function(){return this._canvas},v.prototype._containerDimensions=function(){var w=0,B=0;return this._container&&(w=this._container.clientWidth||400,B=this._container.clientHeight||300),[w,B]},v.prototype._detectMissingCSS=function(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},v.prototype._setupContainer=function(){var w=this._container;w.classList.add("mapboxgl-map"),(this._missingCSSCanary=c.create("div","mapboxgl-canary",w)).style.visibility="hidden",this._detectMissingCSS();var B=this._canvasContainer=c.create("div","mapboxgl-canvas-container",w);this._interactive&&B.classList.add("mapboxgl-interactive"),this._canvas=c.create("canvas","mapboxgl-canvas",B),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var D=this._containerDimensions();this._resizeCanvas(D[0],D[1]);var O=this._controlContainer=c.create("div","mapboxgl-control-container",w),G=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(J){G[J]=c.create("div","mapboxgl-ctrl-"+J,O)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},v.prototype._resizeCanvas=function(w,B){var D=s.browser.devicePixelRatio||1;this._canvas.width=D*w,this._canvas.height=D*B,this._canvas.style.width=w+"px",this._canvas.style.height=B+"px"},v.prototype._setupPainter=function(){var w=s.extend({},l.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),B=this._canvas.getContext("webgl",w)||this._canvas.getContext("experimental-webgl",w);B?(this.painter=new Wn(B,this.transform),s.webpSupported.testSupport(B)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))},v.prototype._contextLost=function(w){w.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:w}))},v.prototype._contextRestored=function(w){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:w}))},v.prototype._onMapScroll=function(w){if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},v.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},v.prototype._update=function(w){return this.style?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this},v.prototype._requestRenderFrame=function(w){return this._update(),this._renderTaskQueue.add(w)},v.prototype._cancelRenderFrame=function(w){this._renderTaskQueue.remove(w)},v.prototype._render=function(w){var B,D=this,O=0,G=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(B=G.createQueryEXT(),G.beginQueryEXT(G.TIME_ELAPSED_EXT,B),O=s.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),!this._removed){var J=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var at=this.transform.zoom,Et=s.browser.now();this.style.zoomHistory.update(at,Et);var Ct=new s.EvaluationParameters(at,{now:Et,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Bt=Ct.crossFadingFactor();Bt===1&&Bt===this._crossFadingFactor||(J=!0,this._crossFadingFactor=Bt),this.style.update(Ct)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||J)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Wt=s.browser.now()-O;G.endQueryEXT(G.TIME_ELAPSED_EXT,B),setTimeout(function(){var h=G.getQueryObjectEXT(B,G.QUERY_RESULT_EXT)/1e6;G.deleteQueryEXT(B),D.fire(new s.Event("gpu-timing-frame",{cpuTime:Wt,gpuTime:h}))},50)}if(this.listens("gpu-timing-layer")){var zt=this.painter.collectGpuTimers();setTimeout(function(){var h=D.painter.queryGpuTimers(zt);D.fire(new s.Event("gpu-timing-layer",{layerTimes:h}))},50)}var f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0),this}},v.prototype.remove=function(){this._hash&&this._hash.remove();for(var w=0,B=this._controls;w<B.length;w+=1)B[w].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));var D=this.painter.context.gl.getExtension("WEBGL_lose_context");D&&D.loseContext(),Po(this._canvasContainer),Po(this._controlContainer),Po(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new s.Event("remove"))},v.prototype.triggerRepaint=function(){var w=this;this.style&&!this._frame&&(this._frame=s.browser.frame(function(B){w._frame=null,w._render(B)}))},v.prototype._onWindowOnline=function(){this._update()},v.prototype._onWindowResize=function(w){this._trackResize&&this.resize({originalEvent:w})._update()},g.showTileBoundaries.get=function(){return!!this._showTileBoundaries},g.showTileBoundaries.set=function(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())},g.showPadding.get=function(){return!!this._showPadding},g.showPadding.set=function(w){this._showPadding!==w&&(this._showPadding=w,this._update())},g.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},g.showCollisionBoxes.set=function(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())},g.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},g.showOverdrawInspector.set=function(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())},g.repaint.get=function(){return!!this._repaint},g.repaint.set=function(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())},g.vertices.get=function(){return!!this._vertices},g.vertices.set=function(w){this._vertices=w,this._update()},v.prototype._setCacheLimits=function(w,B){s.setCacheLimits(w,B)},g.version.get=function(){return s.version},Object.defineProperties(v.prototype,g),v})(Ec);function Po(m){m.parentNode&&m.parentNode.removeChild(m)}var Ns={showCompass:!0,showZoom:!0,visualizePitch:!1},sa=function(m){var v=this;this.options=s.extend({},Ns,m),this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(g){return g.preventDefault()}),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(g){return v._map.zoomIn({},{originalEvent:g})}),c.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(g){return v._map.zoomOut({},{originalEvent:g})}),c.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(g){v.options.visualizePitch?v._map.resetNorthPitch({},{originalEvent:g}):v._map.resetNorth({},{originalEvent:g})}),this._compassIcon=c.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};sa.prototype._updateZoomButtons=function(){var m=this._map.getZoom(),v=m===this._map.getMaxZoom(),g=m===this._map.getMinZoom();this._zoomInButton.disabled=v,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",v.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},sa.prototype._rotateCompassArrow=function(){var m=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=m},sa.prototype.onAdd=function(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zs(this._map,this._compass,this.options.visualizePitch)),this._container},sa.prototype.onRemove=function(){c.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},sa.prototype._createButton=function(m,v){var g=c.create("button",m,this._container);return g.type="button",g.addEventListener("click",v),g},sa.prototype._setButtonTitle=function(m,v){var g=this._map._getUIString("NavigationControl."+v);m.title=g,m.setAttribute("aria-label",g)};var zs=function(m,v,g){g===void 0&&(g=!1),this._clickTolerance=10,this.element=v,this.mouseRotate=new Cu({clickTolerance:m.dragRotate._mouseRotate._clickTolerance}),this.map=m,g&&(this.mousePitch=new yh({clickTolerance:m.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener(v,"mousedown",this.mousedown),c.addEventListener(v,"touchstart",this.touchstart,{passive:!1}),c.addEventListener(v,"touchmove",this.touchmove),c.addEventListener(v,"touchend",this.touchend),c.addEventListener(v,"touchcancel",this.reset)};function Fl(m,v,g){if(m=new s.LngLat(m.lng,m.lat),v){var w=new s.LngLat(m.lng-360,m.lat),B=new s.LngLat(m.lng+360,m.lat),D=g.locationPoint(m).distSqr(v);g.locationPoint(w).distSqr(v)<D?m=w:g.locationPoint(B).distSqr(v)<D&&(m=B)}for(;Math.abs(m.lng-g.center.lng)>180;){var O=g.locationPoint(m);if(O.x>=0&&O.y>=0&&O.x<=g.width&&O.y<=g.height)break;m.lng>g.center.lng?m.lng-=360:m.lng+=360}return m}zs.prototype.down=function(m,v){this.mouseRotate.mousedown(m,v),this.mousePitch&&this.mousePitch.mousedown(m,v),c.disableDrag()},zs.prototype.move=function(m,v){var g=this.map,w=this.mouseRotate.mousemoveWindow(m,v);if(w&&w.bearingDelta&&g.setBearing(g.getBearing()+w.bearingDelta),this.mousePitch){var B=this.mousePitch.mousemoveWindow(m,v);B&&B.pitchDelta&&g.setPitch(g.getPitch()+B.pitchDelta)}},zs.prototype.off=function(){var m=this.element;c.removeEventListener(m,"mousedown",this.mousedown),c.removeEventListener(m,"touchstart",this.touchstart,{passive:!1}),c.removeEventListener(m,"touchmove",this.touchmove),c.removeEventListener(m,"touchend",this.touchend),c.removeEventListener(m,"touchcancel",this.reset),this.offTemp()},zs.prototype.offTemp=function(){c.enableDrag(),c.removeEventListener(s.window,"mousemove",this.mousemove),c.removeEventListener(s.window,"mouseup",this.mouseup)},zs.prototype.mousedown=function(m){this.down(s.extend({},m,{ctrlKey:!0,preventDefault:function(){return m.preventDefault()}}),c.mousePos(this.element,m)),c.addEventListener(s.window,"mousemove",this.mousemove),c.addEventListener(s.window,"mouseup",this.mouseup)},zs.prototype.mousemove=function(m){this.move(m,c.mousePos(this.element,m))},zs.prototype.mouseup=function(m){this.mouseRotate.mouseupWindow(m),this.mousePitch&&this.mousePitch.mouseupWindow(m),this.offTemp()},zs.prototype.touchstart=function(m){m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=c.touchPos(this.element,m.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return m.preventDefault()}},this._startPos))},zs.prototype.touchmove=function(m){m.targetTouches.length!==1?this.reset():(this._lastPos=c.touchPos(this.element,m.targetTouches)[0],this.move({preventDefault:function(){return m.preventDefault()}},this._lastPos))},zs.prototype.touchend=function(m){m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},zs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Io={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Pu(m,v,g){var w=m.classList;for(var B in Io)w.remove("mapboxgl-"+g+"-anchor-"+B);w.add("mapboxgl-"+g+"-anchor-"+v)}var Qa,Nl=(function(m){function v(g,w){if(m.call(this),(g instanceof s.window.HTMLElement||w)&&(g=s.extend({element:g},w)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=g&&g.anchor||"center",this._color=g&&g.color||"#3FB1CE",this._scale=g&&g.scale||1,this._draggable=g&&g.draggable||!1,this._clickTolerance=g&&g.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=g&&g.rotation||0,this._rotationAlignment=g&&g.rotationAlignment||"auto",this._pitchAlignment=g&&g.pitchAlignment&&g.pitchAlignment!=="auto"?g.pitchAlignment:this._rotationAlignment,g&&g.element)this._element=g.element,this._offset=s.Point.convert(g&&g.offset||[0,0]);else{this._defaultMarker=!0,this._element=c.create("div"),this._element.setAttribute("aria-label","Map marker");var B=c.createNS("http://www.w3.org/2000/svg","svg");B.setAttributeNS(null,"display","block"),B.setAttributeNS(null,"height","41px"),B.setAttributeNS(null,"width","27px"),B.setAttributeNS(null,"viewBox","0 0 27 41");var D=c.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"stroke","none"),D.setAttributeNS(null,"stroke-width","1"),D.setAttributeNS(null,"fill","none"),D.setAttributeNS(null,"fill-rule","evenodd");var O=c.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill-rule","nonzero");var G=c.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(3.0, 29.0)"),G.setAttributeNS(null,"fill","#000000");for(var J=0,at=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];J<at.length;J+=1){var Et=at[J],Ct=c.createNS("http://www.w3.org/2000/svg","ellipse");Ct.setAttributeNS(null,"opacity","0.04"),Ct.setAttributeNS(null,"cx","10.5"),Ct.setAttributeNS(null,"cy","5.80029008"),Ct.setAttributeNS(null,"rx",Et.rx),Ct.setAttributeNS(null,"ry",Et.ry),G.appendChild(Ct)}var Bt=c.createNS("http://www.w3.org/2000/svg","g");Bt.setAttributeNS(null,"fill",this._color);var Wt=c.createNS("http://www.w3.org/2000/svg","path");Wt.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Bt.appendChild(Wt);var zt=c.createNS("http://www.w3.org/2000/svg","g");zt.setAttributeNS(null,"opacity","0.25"),zt.setAttributeNS(null,"fill","#000000");var f=c.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),zt.appendChild(f);var h=c.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"transform","translate(6.0, 7.0)"),h.setAttributeNS(null,"fill","#FFFFFF");var A=c.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(8.0, 8.0)");var b=c.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#000000"),b.setAttributeNS(null,"opacity","0.25"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962");var E=c.createNS("http://www.w3.org/2000/svg","circle");E.setAttributeNS(null,"fill","#FFFFFF"),E.setAttributeNS(null,"cx","5.5"),E.setAttributeNS(null,"cy","5.5"),E.setAttributeNS(null,"r","5.4999962"),A.appendChild(b),A.appendChild(E),O.appendChild(G),O.appendChild(Bt),O.appendChild(zt),O.appendChild(h),O.appendChild(A),B.appendChild(O),B.setAttributeNS(null,"height",41*this._scale+"px"),B.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(B),this._offset=s.Point.convert(g&&g.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(S){S.preventDefault()}),this._element.addEventListener("mousedown",function(S){S.preventDefault()}),Pu(this._element,this._anchor,"marker"),this._popup=null}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.addTo=function(g){return this.remove(),this._map=g,g.getCanvasContainer().appendChild(this._element),g.on("move",this._update),g.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},v.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),c.remove(this._element),this._popup&&this._popup.remove(),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(g){return this._lngLat=s.LngLat.convert(g),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},v.prototype.getElement=function(){return this._element},v.prototype.setPopup=function(g){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),g){if(!("offset"in g.options)){var w=Math.sqrt(Math.pow(13.5,2)/2);g.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=g,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},v.prototype._onKeyPress=function(g){var w=g.code,B=g.charCode||g.keyCode;w!=="Space"&&w!=="Enter"&&B!==32&&B!==13||this.togglePopup()},v.prototype._onMapClick=function(g){var w=g.originalEvent.target,B=this._element;this._popup&&(w===B||B.contains(w))&&this.togglePopup()},v.prototype.getPopup=function(){return this._popup},v.prototype.togglePopup=function(){var g=this._popup;return g?(g.isOpen()?g.remove():g.addTo(this._map),this):this},v.prototype._update=function(g){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Fl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(w="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var B="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?B="rotateX(0deg)":this._pitchAlignment==="map"&&(B="rotateX("+this._map.getPitch()+"deg)"),g&&g.type!=="moveend"||(this._pos=this._pos.round()),c.setTransform(this._element,Io[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+B+" "+w)}},v.prototype.getOffset=function(){return this._offset},v.prototype.setOffset=function(g){return this._offset=s.Point.convert(g),this._update(),this},v.prototype._onMove=function(g){if(!this._isDragging){var w=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=w}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))},v.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"},v.prototype._addDragHandler=function(g){this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},v.prototype.setDraggable=function(g){return this._draggable=!!g,this._map&&(g?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},v.prototype.isDraggable=function(){return this._draggable},v.prototype.setRotation=function(g){return this._rotation=g||0,this._update(),this},v.prototype.getRotation=function(){return this._rotation},v.prototype.setRotationAlignment=function(g){return this._rotationAlignment=g||"auto",this._update(),this},v.prototype.getRotationAlignment=function(){return this._rotationAlignment},v.prototype.setPitchAlignment=function(g){return this._pitchAlignment=g&&g!=="auto"?g:this._rotationAlignment,this._update(),this},v.prototype.getPitchAlignment=function(){return this._pitchAlignment},v})(s.Evented),_h={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},zl=0,Ja=!1,bh=(function(m){function v(g){m.call(this),this.options=s.extend({},_h,g),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.onAdd=function(g){var w;return this._map=g,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),w=this._setupUI,Qa!==void 0?w(Qa):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(function(B){w(Qa=B.state!=="denied")}):w(Qa=!!s.window.navigator.geolocation),this._container},v.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),c.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zl=0,Ja=!1},v.prototype._isOutOfMapMaxBounds=function(g){var w=this._map.getMaxBounds(),B=g.coords;return w&&(B.longitude<w.getWest()||B.longitude>w.getEast()||B.latitude<w.getSouth()||B.latitude>w.getNorth())},v.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},v.prototype._onSuccess=function(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",g)),this._finish()}},v.prototype._updateCamera=function(g){var w=new s.LngLat(g.coords.longitude,g.coords.latitude),B=g.coords.accuracy,D=this._map.getBearing(),O=s.extend({bearing:D},this.options.fitBoundsOptions);this._map.fitBounds(w.toBounds(B),O,{geolocateSource:!0})},v.prototype._updateMarker=function(g){if(g){var w=new s.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(w).addTo(this._map),this._userLocationDotMarker.setLngLat(w).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},v.prototype._updateCircleRadius=function(){var g=this._map._container.clientHeight/2,w=this._map.unproject([0,g]),B=this._map.unproject([1,g]),D=w.distanceTo(B),O=Math.ceil(2*this._accuracy/D);this._circleElement.style.width=O+"px",this._circleElement.style.height=O+"px"},v.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},v.prototype._onError=function(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var w=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&Ja)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",g)),this._finish()}},v.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},v.prototype._setupUI=function(g){var w=this;if(this._container.addEventListener("contextmenu",function(O){return O.preventDefault()}),this._geolocateButton=c.create("button","mapboxgl-ctrl-geolocate",this._container),c.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",g===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var B=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=B,this._geolocateButton.setAttribute("aria-label",B)}else{var D=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=D,this._geolocateButton.setAttribute("aria-label",D)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=c.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Nl(this._dotElement),this._circleElement=c.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(O){O.geolocateSource||w._watchState!=="ACTIVE_LOCK"||O.originalEvent&&O.originalEvent.type==="resize"||(w._watchState="BACKGROUND",w._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),w._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),w.fire(new s.Event("trackuserlocationend")))})},v.prototype.trigger=function(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zl--,Ja=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++zl>1?(g={maximumAge:6e5,timeout:0},Ja=!0):(g=this.options.positionOptions,Ja=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},v.prototype._clearWatch=function(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},v})(s.Evented),xs={maxWidth:100,unit:"metric"},ss=function(m){this.options=s.extend({},xs,m),s.bindAll(["_onMove","setUnit"],this)};function Fi(m,v,g){var w=g&&g.maxWidth||100,B=m._container.clientHeight/2,D=m.unproject([0,B]),O=m.unproject([w,B]),G=D.distanceTo(O);if(g&&g.unit==="imperial"){var J=3.2808*G;J>5280?Pr(v,w,J/5280,m._getUIString("ScaleControl.Miles")):Pr(v,w,J,m._getUIString("ScaleControl.Feet"))}else g&&g.unit==="nautical"?Pr(v,w,G/1852,m._getUIString("ScaleControl.NauticalMiles")):G>=1e3?Pr(v,w,G/1e3,m._getUIString("ScaleControl.Kilometers")):Pr(v,w,G,m._getUIString("ScaleControl.Meters"))}function Pr(m,v,g,w){var B,D,O,G=(B=g,(D=Math.pow(10,(""+Math.floor(B)).length-1))*(O=(O=B/D)>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:(function(J){var at=Math.pow(10,Math.ceil(-Math.log(J)/Math.LN10));return Math.round(J*at)/at})(O)));m.style.width=v*(G/g)+"px",m.innerHTML=G+"&nbsp;"+w}ss.prototype.getDefaultPosition=function(){return"bottom-left"},ss.prototype._onMove=function(){Fi(this._map,this._container,this.options)},ss.prototype.onAdd=function(m){return this._map=m,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ss.prototype.onRemove=function(){c.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ss.prototype.setUnit=function(m){this.options.unit=m,Fi(this._map,this._container,this.options)};var Ei=function(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof s.window.HTMLElement?this._container=m.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in s.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in s.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in s.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ei.prototype.onAdd=function(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ei.prototype.onRemove=function(){c.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ei.prototype._checkFullscreenSupport=function(){return!!(s.window.document.fullscreenEnabled||s.window.document.mozFullScreenEnabled||s.window.document.msFullscreenEnabled||s.window.document.webkitFullscreenEnabled)},Ei.prototype._setupUI=function(){var m=this._fullscreenButton=c.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);c.create("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden",!0),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ei.prototype._updateTitle=function(){var m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m},Ei.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ei.prototype._isFullscreen=function(){return this._fullscreen},Ei.prototype._changeIcon=function(){(s.window.document.fullscreenElement||s.window.document.mozFullScreenElement||s.window.document.webkitFullscreenElement||s.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ei.prototype._onClickFullscreen=function(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.mozCancelFullScreen?s.window.document.mozCancelFullScreen():s.window.document.msExitFullscreen?s.window.document.msExitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Ur={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ul=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Iu=(function(m){function v(g){m.call(this),this.options=s.extend(Object.create(Ur),g),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return m&&(v.__proto__=m),(v.prototype=Object.create(m&&m.prototype)).constructor=v,v.prototype.addTo=function(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this},v.prototype.isOpen=function(){return!!this._map},v.prototype.remove=function(){return this._content&&c.remove(this._content),this._container&&(c.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(g){return this._lngLat=s.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},v.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},v.prototype.getElement=function(){return this._container},v.prototype.setText=function(g){return this.setDOMContent(s.window.document.createTextNode(g))},v.prototype.setHTML=function(g){var w,B=s.window.document.createDocumentFragment(),D=s.window.document.createElement("body");for(D.innerHTML=g;w=D.firstChild;)B.appendChild(w);return this.setDOMContent(B)},v.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},v.prototype.setMaxWidth=function(g){return this.options.maxWidth=g,this._update(),this},v.prototype.setDOMContent=function(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=c.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this},v.prototype.addClassName=function(g){this._container&&this._container.classList.add(g)},v.prototype.removeClassName=function(g){this._container&&this._container.classList.remove(g)},v.prototype.setOffset=function(g){return this.options.offset=g,this._update(),this},v.prototype.toggleClassName=function(g){if(this._container)return this._container.classList.toggle(g)},v.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=c.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},v.prototype._onMouseUp=function(g){this._update(g.point)},v.prototype._onMouseMove=function(g){this._update(g.point)},v.prototype._onDrag=function(g){this._update(g.point)},v.prototype._update=function(g){var w=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=c.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=c.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Ct){return w._container.classList.add(Ct)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||g)){var B=this._pos=this._trackPointer&&g?g:this._map.project(this._lngLat),D=this.options.anchor,O=(function Ct(Bt){if(Bt){if(typeof Bt=="number"){var Wt=Math.round(Math.sqrt(.5*Math.pow(Bt,2)));return{center:new s.Point(0,0),top:new s.Point(0,Bt),"top-left":new s.Point(Wt,Wt),"top-right":new s.Point(-Wt,Wt),bottom:new s.Point(0,-Bt),"bottom-left":new s.Point(Wt,-Wt),"bottom-right":new s.Point(-Wt,-Wt),left:new s.Point(Bt,0),right:new s.Point(-Bt,0)}}if(Bt instanceof s.Point||Array.isArray(Bt)){var zt=s.Point.convert(Bt);return{center:zt,top:zt,"top-left":zt,"top-right":zt,bottom:zt,"bottom-left":zt,"bottom-right":zt,left:zt,right:zt}}return{center:s.Point.convert(Bt.center||[0,0]),top:s.Point.convert(Bt.top||[0,0]),"top-left":s.Point.convert(Bt["top-left"]||[0,0]),"top-right":s.Point.convert(Bt["top-right"]||[0,0]),bottom:s.Point.convert(Bt.bottom||[0,0]),"bottom-left":s.Point.convert(Bt["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(Bt["bottom-right"]||[0,0]),left:s.Point.convert(Bt.left||[0,0]),right:s.Point.convert(Bt.right||[0,0])}}return Ct(new s.Point(0,0))})(this.options.offset);if(!D){var G,J=this._container.offsetWidth,at=this._container.offsetHeight;G=B.y+O.bottom.y<at?["top"]:B.y>this._map.transform.height-at?["bottom"]:[],B.x<J/2?G.push("left"):B.x>this._map.transform.width-J/2&&G.push("right"),D=G.length===0?"bottom":G.join("-")}var Et=B.add(O[D]).round();c.setTransform(this._container,Io[D]+" translate("+Et.x+"px,"+Et.y+"px)"),Pu(this._container,D,"popup")}},v.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var g=this._container.querySelector(Ul);g&&g.focus()}},v.prototype._onClose=function(){this.remove()},v})(s.Evented),Mo={version:s.version,supported:l,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:Vf,NavigationControl:sa,GeolocateControl:bh,AttributionControl:cs,ScaleControl:ss,FullscreenControl:Ei,Popup:Iu,Marker:Nl,Style:ys,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,config:s.config,prewarm:function(){ge().acquire(ne)},clearPrewarmedResources:function(){var m=ke;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(ne),ke=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(m){s.config.ACCESS_TOKEN=m},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(m){s.config.API_URL=m},get workerCount(){return Ie.workerCount},set workerCount(m){Ie.workerCount=m},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){s.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage:function(m){s.clearTileCache(m)},workerUrl:""};return Mo}),r})})(e2)),e2.exports}var Ltt=Rtt();const uu=df(Ltt);var Dtt=1e-7;function i2(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function v8(i,t){if(i===t)return!0;if(i2(i)&&i2(t)){if(i.length!==t.length)return!1;for(var e=0;e<i.length;++e)if(!v8(i[e],t[e]))return!1;return!0}return Math.abs(i-t)<=Dtt}function R0(i,t,e){return Math.max(t,Math.min(e,i))}function ay(i,t,e){return i2(i)?i.map(function(n,r){return ay(n,t[r],e)}):e*t+(1-e)*i}function ll(i,t){if(!i)throw new Error(t||"react-map-gl: assertion failed.")}function HS(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function XS(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?HS(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):HS(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var Xh={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},$_={pitch:0,bearing:0,altitude:1.5},qS=5,ktt=1.2,up=(function(){function i(t){var e=t.width,n=t.height,r=t.latitude,o=t.longitude,s=t.zoom,l=t.bearing,c=l===void 0?$_.bearing:l,y=t.pitch,_=y===void 0?$_.pitch:y,C=t.altitude,I=C===void 0?$_.altitude:C,k=t.maxZoom,z=k===void 0?Xh.maxZoom:k,V=t.minZoom,X=V===void 0?Xh.minZoom:V,H=t.maxPitch,$=H===void 0?Xh.maxPitch:H,Y=t.minPitch,ct=Y===void 0?Xh.minPitch:Y,rt=t.transitionDuration,nt=t.transitionEasing,Ot=t.transitionInterpolator,Kt=t.transitionInterruption,ft=t.startPanLngLat,st=t.startZoomLngLat,Ut=t.startRotatePos,K=t.startBearing,dt=t.startPitch,Tt=t.startZoom;th(this,i),ll(Number.isFinite(e),"`width` must be supplied"),ll(Number.isFinite(n),"`height` must be supplied"),ll(Number.isFinite(o),"`longitude` must be supplied"),ll(Number.isFinite(r),"`latitude` must be supplied"),ll(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:e,height:n,latitude:r,longitude:o,zoom:s,bearing:c,pitch:_,altitude:I,maxZoom:z,minZoom:X,maxPitch:$,minPitch:ct,transitionDuration:rt,transitionEasing:nt,transitionInterpolator:Ot,transitionInterruption:Kt}),this._state={startPanLngLat:ft,startZoomLngLat:st,startRotatePos:Ut,startBearing:K,startPitch:dt,startZoom:Tt}}return $c(i,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,r=this._state.startPanLngLat||this._unproject(n);if(!r)return this;var o=this._calculateNewLngLat({startPanLngLat:r,pos:e}),s=ms(o,2),l=s[0],c=s[1];return this._getUpdatedMapState({longitude:l,latitude:c})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){var e=t.pos;return this._getUpdatedMapState({startRotatePos:e,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.pos,n=t.deltaAngleX,r=n===void 0?0:n,o=t.deltaAngleY,s=o===void 0?0:o,l=this._state,c=l.startRotatePos,y=l.startBearing,_=l.startPitch;if(!Number.isFinite(y)||!Number.isFinite(_))return this;var C;return e?C=this._calculateNewPitchAndBearing(XS(XS({},this._getRotationParams(e,c)),{},{startBearing:y,startPitch:_})):C={bearing:y+r,pitch:_+s},this._getUpdatedMapState(C)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,r=t.scale;ll(r>0,"`scale` must be a positive number");var o=this._state,s=o.startZoom,l=o.startZoomLngLat;Number.isFinite(s)||(s=this._viewportProps.zoom,l=this._unproject(n)||this._unproject(e)),ll(l,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var c=this._calculateNewZoom({scale:r,startZoom:s||0}),y=new ou(Object.assign({},this._viewportProps,{zoom:c})),_=y.getMapCenterByLngLatPosition({lngLat:l,pos:e}),C=ms(_,2),I=C[0],k=C[1];return this._getUpdatedMapState({zoom:c,longitude:I,latitude:k})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(t){return new i(Object.assign({},this._viewportProps,this._state,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,r=t.zoom;t.zoom=R0(r,n,e);var o=t.maxPitch,s=t.minPitch,l=t.pitch;return t.pitch=R0(l,s,o),Object.assign(t,xtt(t)),t}},{key:"_unproject",value:function(t){var e=new ou(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,n=t.pos,r=new ou(this._viewportProps);return r.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,n=t.startZoom,r=this._viewportProps,o=r.maxZoom,s=r.minZoom,l=n+Math.log2(e);return R0(l,s,o)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY,r=t.startBearing,o=t.startPitch;n=R0(n,-1,1);var s=this._viewportProps,l=s.minPitch,c=s.maxPitch,y=r+180*e,_=o;return n>0?_=o+n*(c-o):n<0&&(_=o-n*(l-o)),{pitch:_,bearing:y}}},{key:"_getRotationParams",value:function(t,e){var n=t[0]-e[0],r=t[1]-e[1],o=t[1],s=e[1],l=this._viewportProps,c=l.width,y=l.height,_=n/c,C=0;return r>0?Math.abs(y-s)>qS&&(C=r/(s-y)*ktt):r<0&&s>qS&&(C=1-o/s),C=Math.min(1,Math.max(-1,C)),{deltaScaleX:_,deltaScaleY:C}}}]),i})();function Ott(i){return i[0].toLowerCase()+i.slice(1)}function Ftt(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xh;for(var e in t){var n=e.slice(0,3),r=Ott(e.slice(3));if(n==="min"&&i[r]<t[e]||n==="max"&&i[r]>t[e])return!1}return!0}function KS(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function ZS(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?KS(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):KS(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var yf=Re.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),rw=yf.Provider;function Ntt(i){var t=i.value,e=i.children,n=Re.useState(null),r=ms(n,2),o=r[0],s=r[1],l=Re.useContext(yf);return t=ZS(ZS({setMap:s},l),{},{map:l&&l.map||o},t),Re.createElement(rw,{value:t},e)}yf.Provider=Ntt;var n2=typeof window<"u"?Re.useLayoutEffect:Re.useEffect;function YS(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function al(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?YS(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):YS(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var ztt="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",_8="A valid API access token is required to use Mapbox data";function Utt(){}function b8(i){var t=i.props,e=i.width,n=i.height;return new ou(al(al(al({},t),t.viewState),{},{width:e,height:n}))}var Vtt=401,QS={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},Gtt=Object.assign({},gf.propTypes,{width:_e.oneOfType([_e.number,_e.string]),height:_e.oneOfType([_e.number,_e.string]),onResize:_e.func,disableTokenWarning:_e.bool,visible:_e.bool,className:_e.string,style:_e.object,visibilityConstraints:_e.object}),jtt=Object.assign({},gf.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:Utt,className:"",style:null,visibilityConstraints:Xh});function Wtt(){var i={position:"absolute",left:0,top:0};return Re.createElement("div",{key:"warning",id:"no-token-warning",style:i},Re.createElement("h3",{key:"header"},_8),Re.createElement("div",{key:"text"},"For information on setting up your basemap, read"),Re.createElement("a",{key:"link",href:ztt},"Note on Map Tokens"))}function Htt(i){return{getMap:function(){return i.current&&i.current.getMap()},queryRenderedFeatures:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=i.current&&i.current.getMap();return n&&n.queryRenderedFeatures(t,e)}}}var nc=Re.forwardRef(function(i,t){var e=Re.useState(!0),n=ms(e,2),r=n[0],o=n[1],s=Re.useState({width:0,height:0}),l=ms(s,2),c=l[0],y=l[1],_=Re.useRef(null),C=Re.useRef(null),I=Re.useRef(null),k=Re.useRef(null),z=Re.useContext(yf);n2(function(){if(nc.supported()){var st=new gf(al(al(al({},i),c),{},{mapboxgl:uu,container:C.current,onError:function(K){var dt=K.error&&K.error.status||K.status;dt===Vtt&&r&&(console.error(_8),o(!1)),i.onError(K)}}));_.current=st,z&&z.setMap&&z.setMap(st.getMap());var Ut=new BF(function(K){if(K[0].contentRect){var dt=K[0].contentRect,Tt=dt.width,ue=dt.height;y({width:Tt,height:ue}),i.onResize({width:Tt,height:ue})}});return Ut.observe(I.current),function(){st.finalize(),_.current=null,Ut.disconnect()}}},[]),n2(function(){_.current&&_.current.setProps(al(al({},i),c))});var V=_.current&&_.current.getMap();Re.useImperativeHandle(t,function(){return Htt(_)},[]);var X=Re.useCallback(function(st){var Ut=st.target;Ut===k.current&&Ut.scrollTo(0,0)},[]),H=V&&Re.createElement(rw,{value:al(al({},z),{},{viewport:z.viewport||b8(al({map:V,props:i},c)),map:V,container:z.container||I.current})},Re.createElement("div",{key:"map-overlays",className:"overlays",ref:k,style:QS,onScroll:X},i.children)),$=i.className,Y=i.width,ct=i.height,rt=i.style,nt=i.visibilityConstraints,Ot=Object.assign({position:"relative"},rt,{width:Y,height:ct}),Kt=i.visible&&Ftt(i.viewState||i,nt),ft=Object.assign({},QS,{visibility:Kt?"inherit":"hidden"});return Re.createElement("div",{key:"map-container",ref:I,style:Ot},Re.createElement("div",{key:"map-mapbox",ref:C,style:ft,className:$}),H,!r&&!i.disableTokenWarning&&Re.createElement(Wtt,null))});nc.supported=function(){return uu&&uu.supported()};nc.propTypes=Gtt;nc.defaultProps=jtt;function Xtt(i,t){var e;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(e=qtt(i))||t){e&&(i=e);var n=0,r=function(){};return{s:r,n:function(){return n>=i.length?{done:!0}:{done:!1,value:i[n++]}},e:function(c){throw c},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){e=i[Symbol.iterator]()},n:function(){var c=e.next();return o=c.done,c},e:function(c){s=!0,l=c},f:function(){try{!o&&e.return!=null&&e.return()}finally{if(s)throw l}}}}function qtt(i,t){if(i){if(typeof i=="string")return JS(i,t);var e=Object.prototype.toString.call(i).slice(8,-1);if(e==="Object"&&i.constructor&&(e=i.constructor.name),e==="Map"||e==="Set")return Array.from(i);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return JS(i,t)}}function JS(i,t){(t==null||t>i.length)&&(t=i.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=i[e];return n}var x8=(function(){function i(){th(this,i),Bi(this,"propNames",[])}return $c(i,[{key:"arePropsEqual",value:function(t,e){var n=Xtt(this.propNames||[]),r;try{for(n.s();!(r=n.n()).done;){var o=r.value;if(!v8(t[o],e[o]))return!1}}catch(s){n.e(s)}finally{n.f()}return!0}},{key:"initializeProps",value:function(t,e){return{start:t,end:e}}},{key:"interpolateProps",value:function(t,e,n){ll(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(t,e){return e.transitionDuration}}]),i})(),Ktt={longitude:1,bearing:1};function ly(i){return Number.isFinite(i)||Array.isArray(i)}function Ztt(i){return i in Ktt}function r2(i,t,e){return Ztt(i)&&Math.abs(e-t)>180&&(e=e<0?e+360:e-360),e}function t1(i,t){var e;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(e=Ytt(i))||t){e&&(i=e);var n=0,r=function(){};return{s:r,n:function(){return n>=i.length?{done:!0}:{done:!1,value:i[n++]}},e:function(c){throw c},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){e=i[Symbol.iterator]()},n:function(){var c=e.next();return o=c.done,c},e:function(c){s=!0,l=c},f:function(){try{!o&&e.return!=null&&e.return()}finally{if(s)throw l}}}}function Ytt(i,t){if(i){if(typeof i=="string")return $S(i,t);var e=Object.prototype.toString.call(i).slice(8,-1);if(e==="Object"&&i.constructor&&(e=i.constructor.name),e==="Map"||e==="Set")return Array.from(i);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $S(i,t)}}function $S(i,t){(t==null||t>i.length)&&(t=i.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=i[e];return n}function Qtt(i){var t=Jtt();return function(){var e=Ap(i),n;if(t){var r=Ap(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return j2(this,n)}}function Jtt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var $tt=["longitude","latitude","zoom","bearing","pitch"],tet=["latitude","longitude","zoom","width","height"],tP=["bearing","pitch"],eet={speed:1.2,curve:1.414};(function(i){G2(e,i);var t=Qtt(e);function e(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return th(this,e),n=t.call(this),Bi(zc(n),"propNames",$tt),n.props=Object.assign({},eet,r),n}return $c(e,[{key:"initializeProps",value:function(n,r){var o={},s={},l=t1(tet),c;try{for(l.s();!(c=l.n()).done;){var y=c.value,_=n[y],C=r[y];ll(ly(_)&&ly(C),"".concat(y," must be supplied for transition")),o[y]=_,s[y]=r2(y,_,C)}}catch(H){l.e(H)}finally{l.f()}var I=t1(tP),k;try{for(I.s();!(k=I.n()).done;){var z=k.value,V=n[z]||0,X=r[z]||0;o[z]=V,s[z]=r2(z,V,X)}}catch(H){I.e(H)}finally{I.f()}return{start:o,end:s}}},{key:"interpolateProps",value:function(n,r,o){var s=Ett(n,r,o,this.props),l=t1(tP),c;try{for(l.s();!(c=l.n()).done;){var y=c.value;s[y]=ay(n[y],r[y],o)}}catch(_){l.e(_)}finally{l.f()}return s}},{key:"getDuration",value:function(n,r){var o=r.transitionDuration;return o==="auto"&&(o=Ctt(n,r,this.props)),o}}]),e})(x8);function eP(i,t){var e;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(e=iet(i))||t){e&&(i=e);var n=0,r=function(){};return{s:r,n:function(){return n>=i.length?{done:!0}:{done:!1,value:i[n++]}},e:function(c){throw c},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){e=i[Symbol.iterator]()},n:function(){var c=e.next();return o=c.done,c},e:function(c){s=!0,l=c},f:function(){try{!o&&e.return!=null&&e.return()}finally{if(s)throw l}}}}function iet(i,t){if(i){if(typeof i=="string")return iP(i,t);var e=Object.prototype.toString.call(i).slice(8,-1);if(e==="Object"&&i.constructor&&(e=i.constructor.name),e==="Map"||e==="Set")return Array.from(i);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return iP(i,t)}}function iP(i,t){(t==null||t>i.length)&&(t=i.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=i[e];return n}function net(i){var t=ret();return function(){var e=Ap(i),n;if(t){var r=Ap(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return j2(this,n)}}function ret(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var set=["longitude","latitude","zoom","bearing","pitch"],XA=(function(i){G2(e,i);var t=net(e);function e(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return th(this,e),n=t.call(this),Array.isArray(r)&&(r={transitionProps:r}),n.propNames=r.transitionProps||set,r.around&&(n.around=r.around),n}return $c(e,[{key:"initializeProps",value:function(n,r){var o={},s={};if(this.around){o.around=this.around;var l=new ou(n).unproject(this.around);Object.assign(s,r,{around:new ou(r).project(l),aroundLngLat:l})}var c=eP(this.propNames),y;try{for(c.s();!(y=c.n()).done;){var _=y.value,C=n[_],I=r[_];ll(ly(C)&&ly(I),"".concat(_," must be supplied for transition")),o[_]=C,s[_]=r2(_,C,I)}}catch(k){c.e(k)}finally{c.f()}return{start:o,end:s}}},{key:"interpolateProps",value:function(n,r,o){var s={},l=eP(this.propNames),c;try{for(l.s();!(c=l.n()).done;){var y=c.value;s[y]=ay(n[y],r[y],o)}}catch(z){l.e(z)}finally{l.f()}if(r.around){var _=new ou(Object.assign({},r,s)).getMapCenterByLngLatPosition({lngLat:r.aroundLngLat,pos:ay(n.around,r.around,o)}),C=ms(_,2),I=C[0],k=C[1];s.longitude=I,s.latitude=k}return s}}]),e})(x8),qA=function(){};function oet(i,t){var e=i(t);return function(n){return 1/(1-e)*(i(n*(1-t)+t)-e)}}var KA={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},aet={transitionDuration:0,transitionEasing:function(i){return i},transitionInterpolator:new XA,transitionInterruption:KA.BREAK,onTransitionStart:qA,onTransitionInterrupt:qA,onTransitionEnd:qA},sw=(function(){function i(){var t=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};th(this,i),Bi(this,"_animationFrame",null),Bi(this,"_onTransitionFrame",function(){t._animationFrame=requestAnimationFrame(t._onTransitionFrame),t._updateViewport()}),this.props=null,this.onViewportChange=e.onViewportChange||qA,this.onStateChange=e.onStateChange||qA,this.time=e.getTime||Date.now}return $c(i,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(t){var e=this.props;if(this.props=t,!e||this._shouldIgnoreViewportChange(e,t))return!1;if(this._isTransitionEnabled(t)){var n=Object.assign({},e),r=Object.assign({},t);if(this._isTransitionInProgress()&&(e.onTransitionInterrupt(),this.state.interruption===KA.SNAP_TO_END?Object.assign(n,this.state.endProps):Object.assign(n,this.state.propsInTransition),this.state.interruption===KA.UPDATE)){var o=this.time(),s=(o-this.state.startTime)/this.state.duration;r.transitionDuration=this.state.duration-(o-this.state.startTime),r.transitionEasing=oet(this.state.easing,s),r.transitionInterpolator=n.transitionInterpolator}return r.onTransitionStart(),this._triggerTransition(n,r),!0}return this._isTransitionInProgress()&&(e.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(t){var e=t.transitionDuration,n=t.transitionInterpolator;return(e>0||e==="auto")&&!!n}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(t,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return t?this._isTransitionInProgress()?this.state.interruption===KA.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0:!0}},{key:"_triggerTransition",value:function(t,e){ll(this._isTransitionEnabled(e)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var n=e.transitionInterpolator,r=n.getDuration?n.getDuration(t,e):e.transitionDuration;if(r!==0){var o=e.transitionInterpolator.initializeProps(t,e),s={inTransition:!0,isZooming:t.zoom!==e.zoom,isPanning:t.longitude!==e.longitude||t.latitude!==e.latitude,isRotating:t.bearing!==e.bearing||t.pitch!==e.pitch};this.state={duration:r,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startTime:this.time(),startProps:o.start,endProps:o.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(s)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var t=this.time(),e=this.state,n=e.startTime,r=e.duration,o=e.easing,s=e.interpolator,l=e.startProps,c=e.endProps,y=!1,_=(t-n)/r;_>=1&&(_=1,y=!0),_=o(_);var C=s.interpolateProps(l,c,_),I=new up(Object.assign({},this.props,C));this.state.propsInTransition=I.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),y&&(this._endTransition(),this.props.onTransitionEnd())}}]),i})();Bi(sw,"defaultProps",aet);var nP={exports:{}},rP;function uet(){return rP||(rP=1,(function(i){(function(t,e,n,r){var o=["","webkit","Moz","MS","ms","o"],s=e.createElement("div"),l="function",c=Math.round,y=Math.abs,_=Date.now;function C(yt,Dt,$t){return setTimeout(Y(yt,$t),Dt)}function I(yt,Dt,$t){return Array.isArray(yt)?(k(yt,$t[Dt],$t),!0):!1}function k(yt,Dt,$t){var Se;if(yt)if(yt.forEach)yt.forEach(Dt,$t);else if(yt.length!==r)for(Se=0;Se<yt.length;)Dt.call($t,yt[Se],Se,yt),Se++;else for(Se in yt)yt.hasOwnProperty(Se)&&Dt.call($t,yt[Se],Se,yt)}function z(yt,Dt,$t){var Se="DEPRECATED METHOD: "+Dt+`
`+$t+` AT 
`;return function(){var Ye=new Error("get-stack-trace"),Xi=Ye&&Ye.stack?Ye.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",En=t.console&&(t.console.warn||t.console.log);return En&&En.call(t.console,Se,Xi),yt.apply(this,arguments)}}var V;typeof Object.assign!="function"?V=function(yt){if(yt===r||yt===null)throw new TypeError("Cannot convert undefined or null to object");for(var Dt=Object(yt),$t=1;$t<arguments.length;$t++){var Se=arguments[$t];if(Se!==r&&Se!==null)for(var Ye in Se)Se.hasOwnProperty(Ye)&&(Dt[Ye]=Se[Ye])}return Dt}:V=Object.assign;var X=z(function(yt,Dt,$t){for(var Se=Object.keys(Dt),Ye=0;Ye<Se.length;)(!$t||$t&&yt[Se[Ye]]===r)&&(yt[Se[Ye]]=Dt[Se[Ye]]),Ye++;return yt},"extend","Use `assign`."),H=z(function(yt,Dt){return X(yt,Dt,!0)},"merge","Use `assign`.");function $(yt,Dt,$t){var Se=Dt.prototype,Ye;Ye=yt.prototype=Object.create(Se),Ye.constructor=yt,Ye._super=Se,$t&&V(Ye,$t)}function Y(yt,Dt){return function(){return yt.apply(Dt,arguments)}}function ct(yt,Dt){return typeof yt==l?yt.apply(Dt&&Dt[0]||r,Dt):yt}function rt(yt,Dt){return yt===r?Dt:yt}function nt(yt,Dt,$t){k(st(Dt),function(Se){yt.addEventListener(Se,$t,!1)})}function Ot(yt,Dt,$t){k(st(Dt),function(Se){yt.removeEventListener(Se,$t,!1)})}function Kt(yt,Dt){for(;yt;){if(yt==Dt)return!0;yt=yt.parentNode}return!1}function ft(yt,Dt){return yt.indexOf(Dt)>-1}function st(yt){return yt.trim().split(/\s+/g)}function Ut(yt,Dt,$t){if(yt.indexOf&&!$t)return yt.indexOf(Dt);for(var Se=0;Se<yt.length;){if($t&&yt[Se][$t]==Dt||!$t&&yt[Se]===Dt)return Se;Se++}return-1}function K(yt){return Array.prototype.slice.call(yt,0)}function dt(yt,Dt,$t){for(var Se=[],Ye=[],Xi=0;Xi<yt.length;){var En=yt[Xi][Dt];Ut(Ye,En)<0&&Se.push(yt[Xi]),Ye[Xi]=En,Xi++}return Se=Se.sort(function(Yn,Tn){return Yn[Dt]>Tn[Dt]}),Se}function Tt(yt,Dt){for(var $t,Se,Ye=Dt[0].toUpperCase()+Dt.slice(1),Xi=0;Xi<o.length;){if($t=o[Xi],Se=$t?$t+Ye:Dt,Se in yt)return Se;Xi++}return r}var ue=1;function Rt(){return ue++}function Ft(yt){var Dt=yt.ownerDocument||yt;return Dt.defaultView||Dt.parentWindow||t}var Gt=/mobile|tablet|ip(ad|hone|od)|android/i,se="ontouchstart"in t,le=Tt(t,"PointerEvent")!==r,de=se&&Gt.test(navigator.userAgent),ye="touch",Oe="pen",Le="mouse",fe="kinect",_i=25,ei=1,ii=2,Qe=4,yi=8,cn=1,Ni=2,Pi=4,Xn=8,xi=16,wi=Ni|Pi,mn=Xn|xi,zi=wi|mn,cr=["x","y"],tr=["clientX","clientY"];function xn(yt,Dt){var $t=this;this.manager=yt,this.callback=Dt,this.element=yt.element,this.target=yt.options.inputTarget,this.domHandler=function(Se){ct(yt.options.enable,[yt])&&$t.handler(Se)},this.init()}xn.prototype={handler:function(){},init:function(){this.evEl&&nt(this.element,this.evEl,this.domHandler),this.evTarget&&nt(this.target,this.evTarget,this.domHandler),this.evWin&&nt(Ft(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ot(this.element,this.evEl,this.domHandler),this.evTarget&&Ot(this.target,this.evTarget,this.domHandler),this.evWin&&Ot(Ft(this.element),this.evWin,this.domHandler)}};function sr(yt){var Dt,$t=yt.options.inputClass;return $t?Dt=$t:le?Dt=St:de?Dt=mt:se?Dt=d:Dt=qe,new Dt(yt,qn)}function qn(yt,Dt,$t){var Se=$t.pointers.length,Ye=$t.changedPointers.length,Xi=Dt&ei&&Se-Ye===0,En=Dt&(Qe|yi)&&Se-Ye===0;$t.isFirst=!!Xi,$t.isFinal=!!En,Xi&&(yt.session={}),$t.eventType=Dt,Bn(yt,$t),yt.emit("hammer.input",$t),yt.recognize($t),yt.session.prevInput=$t}function Bn(yt,Dt){var $t=yt.session,Se=Dt.pointers,Ye=Se.length;$t.firstInput||($t.firstInput=bi(Dt)),Ye>1&&!$t.firstMultiple?$t.firstMultiple=bi(Dt):Ye===1&&($t.firstMultiple=!1);var Xi=$t.firstInput,En=$t.firstMultiple,Yn=En?En.center:Xi.center,Tn=Dt.center=Oi(Se);Dt.timeStamp=_(),Dt.deltaTime=Dt.timeStamp-Xi.timeStamp,Dt.angle=je(Yn,Tn),Dt.distance=Lt(Yn,Tn),er($t,Dt),Dt.offsetDirection=Ar(Dt.deltaX,Dt.deltaY);var Xr=on(Dt.deltaTime,Dt.deltaX,Dt.deltaY);Dt.overallVelocityX=Xr.x,Dt.overallVelocityY=Xr.y,Dt.overallVelocity=y(Xr.x)>y(Xr.y)?Xr.x:Xr.y,Dt.scale=En?di(En.pointers,Se):1,Dt.rotation=En?$e(En.pointers,Se):0,Dt.maxPointers=$t.prevInput?Dt.pointers.length>$t.prevInput.maxPointers?Dt.pointers.length:$t.prevInput.maxPointers:Dt.pointers.length,Ke($t,Dt);var qs=yt.element;Kt(Dt.srcEvent.target,qs)&&(qs=Dt.srcEvent.target),Dt.target=qs}function er(yt,Dt){var $t=Dt.center,Se=yt.offsetDelta||{},Ye=yt.prevDelta||{},Xi=yt.prevInput||{};(Dt.eventType===ei||Xi.eventType===Qe)&&(Ye=yt.prevDelta={x:Xi.deltaX||0,y:Xi.deltaY||0},Se=yt.offsetDelta={x:$t.x,y:$t.y}),Dt.deltaX=Ye.x+($t.x-Se.x),Dt.deltaY=Ye.y+($t.y-Se.y)}function Ke(yt,Dt){var $t=yt.lastInterval||Dt,Se=Dt.timeStamp-$t.timeStamp,Ye,Xi,En,Yn;if(Dt.eventType!=yi&&(Se>_i||$t.velocity===r)){var Tn=Dt.deltaX-$t.deltaX,Xr=Dt.deltaY-$t.deltaY,qs=on(Se,Tn,Xr);Xi=qs.x,En=qs.y,Ye=y(qs.x)>y(qs.y)?qs.x:qs.y,Yn=Ar(Tn,Xr),yt.lastInterval=Dt}else Ye=$t.velocity,Xi=$t.velocityX,En=$t.velocityY,Yn=$t.direction;Dt.velocity=Ye,Dt.velocityX=Xi,Dt.velocityY=En,Dt.direction=Yn}function bi(yt){for(var Dt=[],$t=0;$t<yt.pointers.length;)Dt[$t]={clientX:c(yt.pointers[$t].clientX),clientY:c(yt.pointers[$t].clientY)},$t++;return{timeStamp:_(),pointers:Dt,center:Oi(Dt),deltaX:yt.deltaX,deltaY:yt.deltaY}}function Oi(yt){var Dt=yt.length;if(Dt===1)return{x:c(yt[0].clientX),y:c(yt[0].clientY)};for(var $t=0,Se=0,Ye=0;Ye<Dt;)$t+=yt[Ye].clientX,Se+=yt[Ye].clientY,Ye++;return{x:c($t/Dt),y:c(Se/Dt)}}function on(yt,Dt,$t){return{x:Dt/yt||0,y:$t/yt||0}}function Ar(yt,Dt){return yt===Dt?cn:y(yt)>=y(Dt)?yt<0?Ni:Pi:Dt<0?Xn:xi}function Lt(yt,Dt,$t){$t||($t=cr);var Se=Dt[$t[0]]-yt[$t[0]],Ye=Dt[$t[1]]-yt[$t[1]];return Math.sqrt(Se*Se+Ye*Ye)}function je(yt,Dt,$t){$t||($t=cr);var Se=Dt[$t[0]]-yt[$t[0]],Ye=Dt[$t[1]]-yt[$t[1]];return Math.atan2(Ye,Se)*180/Math.PI}function $e(yt,Dt){return je(Dt[1],Dt[0],tr)+je(yt[1],yt[0],tr)}function di(yt,Dt){return Lt(Dt[0],Dt[1],tr)/Lt(yt[0],yt[1],tr)}var oe={mousedown:ei,mousemove:ii,mouseup:Qe},Fe="mousedown",vt="mousemove mouseup";function qe(){this.evEl=Fe,this.evWin=vt,this.pressed=!1,xn.apply(this,arguments)}$(qe,xn,{handler:function(yt){var Dt=oe[yt.type];Dt&ei&&yt.button===0&&(this.pressed=!0),Dt&ii&&yt.which!==1&&(Dt=Qe),this.pressed&&(Dt&Qe&&(this.pressed=!1),this.callback(this.manager,Dt,{pointers:[yt],changedPointers:[yt],pointerType:Le,srcEvent:yt}))}});var Ce={pointerdown:ei,pointermove:ii,pointerup:Qe,pointercancel:yi,pointerout:yi},q={2:ye,3:Oe,4:Le,5:fe},Ee="pointerdown",Me="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Ee="MSPointerDown",Me="MSPointerMove MSPointerUp MSPointerCancel");function St(){this.evEl=Ee,this.evWin=Me,xn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$(St,xn,{handler:function(yt){var Dt=this.store,$t=!1,Se=yt.type.toLowerCase().replace("ms",""),Ye=Ce[Se],Xi=q[yt.pointerType]||yt.pointerType,En=Xi==ye,Yn=Ut(Dt,yt.pointerId,"pointerId");Ye&ei&&(yt.button===0||En)?Yn<0&&(Dt.push(yt),Yn=Dt.length-1):Ye&(Qe|yi)&&($t=!0),!(Yn<0)&&(Dt[Yn]=yt,this.callback(this.manager,Ye,{pointers:Dt,changedPointers:[yt],pointerType:Xi,srcEvent:yt}),$t&&Dt.splice(Yn,1))}});var ee={touchstart:ei,touchmove:ii,touchend:Qe,touchcancel:yi},Ae="touchstart",Q="touchstart touchmove touchend touchcancel";function it(){this.evTarget=Ae,this.evWin=Q,this.started=!1,xn.apply(this,arguments)}$(it,xn,{handler:function(yt){var Dt=ee[yt.type];if(Dt===ei&&(this.started=!0),!!this.started){var $t=ut.call(this,yt,Dt);Dt&(Qe|yi)&&$t[0].length-$t[1].length===0&&(this.started=!1),this.callback(this.manager,Dt,{pointers:$t[0],changedPointers:$t[1],pointerType:ye,srcEvent:yt})}}});function ut(yt,Dt){var $t=K(yt.touches),Se=K(yt.changedTouches);return Dt&(Qe|yi)&&($t=dt($t.concat(Se),"identifier")),[$t,Se]}var xt={touchstart:ei,touchmove:ii,touchend:Qe,touchcancel:yi},Nt="touchstart touchmove touchend touchcancel";function mt(){this.evTarget=Nt,this.targetIds={},xn.apply(this,arguments)}$(mt,xn,{handler:function(yt){var Dt=xt[yt.type],$t=wt.call(this,yt,Dt);$t&&this.callback(this.manager,Dt,{pointers:$t[0],changedPointers:$t[1],pointerType:ye,srcEvent:yt})}});function wt(yt,Dt){var $t=K(yt.touches),Se=this.targetIds;if(Dt&(ei|ii)&&$t.length===1)return Se[$t[0].identifier]=!0,[$t,$t];var Ye,Xi,En=K(yt.changedTouches),Yn=[],Tn=this.target;if(Xi=$t.filter(function(Xr){return Kt(Xr.target,Tn)}),Dt===ei)for(Ye=0;Ye<Xi.length;)Se[Xi[Ye].identifier]=!0,Ye++;for(Ye=0;Ye<En.length;)Se[En[Ye].identifier]&&Yn.push(En[Ye]),Dt&(Qe|yi)&&delete Se[En[Ye].identifier],Ye++;if(Yn.length)return[dt(Xi.concat(Yn),"identifier"),Yn]}var lt=2500,pt=25;function d(){xn.apply(this,arguments);var yt=Y(this.handler,this);this.touch=new mt(this.manager,yt),this.mouse=new qe(this.manager,yt),this.primaryTouch=null,this.lastTouches=[]}$(d,xn,{handler:function(yt,Dt,$t){var Se=$t.pointerType==ye,Ye=$t.pointerType==Le;if(!(Ye&&$t.sourceCapabilities&&$t.sourceCapabilities.firesTouchEvents)){if(Se)tt.call(this,Dt,$t);else if(Ye&&ne.call(this,$t))return;this.callback(yt,Dt,$t)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function tt(yt,Dt){yt&ei?(this.primaryTouch=Dt.changedPointers[0].identifier,Pe.call(this,Dt)):yt&(Qe|yi)&&Pe.call(this,Dt)}function Pe(yt){var Dt=yt.changedPointers[0];if(Dt.identifier===this.primaryTouch){var $t={x:Dt.clientX,y:Dt.clientY};this.lastTouches.push($t);var Se=this.lastTouches,Ye=function(){var Xi=Se.indexOf($t);Xi>-1&&Se.splice(Xi,1)};setTimeout(Ye,lt)}}function ne(yt){for(var Dt=yt.srcEvent.clientX,$t=yt.srcEvent.clientY,Se=0;Se<this.lastTouches.length;Se++){var Ye=this.lastTouches[Se],Xi=Math.abs(Dt-Ye.x),En=Math.abs($t-Ye.y);if(Xi<=pt&&En<=pt)return!0}return!1}var Ie=Tt(s.style,"touchAction"),ke=Ie!==r,Ue="compute",ge="auto",Ve="manipulation",De="none",Ze="pan-x",Gi="pan-y",si=Yi();function rn(yt,Dt){this.manager=yt,this.set(Dt)}rn.prototype={set:function(yt){yt==Ue&&(yt=this.compute()),ke&&this.manager.element.style&&si[yt]&&(this.manager.element.style[Ie]=yt),this.actions=yt.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var yt=[];return k(this.manager.recognizers,function(Dt){ct(Dt.options.enable,[Dt])&&(yt=yt.concat(Dt.getTouchAction()))}),hn(yt.join(" "))},preventDefaults:function(yt){var Dt=yt.srcEvent,$t=yt.offsetDirection;if(this.manager.session.prevented){Dt.preventDefault();return}var Se=this.actions,Ye=ft(Se,De)&&!si[De],Xi=ft(Se,Gi)&&!si[Gi],En=ft(Se,Ze)&&!si[Ze];if(Ye){var Yn=yt.pointers.length===1,Tn=yt.distance<2,Xr=yt.deltaTime<250;if(Yn&&Tn&&Xr)return}if(!(En&&Xi)&&(Ye||Xi&&$t&wi||En&&$t&mn))return this.preventSrc(Dt)},preventSrc:function(yt){this.manager.session.prevented=!0,yt.preventDefault()}};function hn(yt){if(ft(yt,De))return De;var Dt=ft(yt,Ze),$t=ft(yt,Gi);return Dt&&$t?De:Dt||$t?Dt?Ze:Gi:ft(yt,Ve)?Ve:ge}function Yi(){if(!ke)return!1;var yt={},Dt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function($t){yt[$t]=Dt?t.CSS.supports("touch-action",$t):!0}),yt}var Ji=1,Hi=2,mr=4,Qi=8,mi=Qi,_t=16,ti=32;function sn(yt){this.options=V({},this.defaults,yt||{}),this.id=Rt(),this.manager=null,this.options.enable=rt(this.options.enable,!0),this.state=Ji,this.simultaneous={},this.requireFail=[]}sn.prototype={defaults:{},set:function(yt){return V(this.options,yt),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(yt){if(I(yt,"recognizeWith",this))return this;var Dt=this.simultaneous;return yt=hr(yt,this),Dt[yt.id]||(Dt[yt.id]=yt,yt.recognizeWith(this)),this},dropRecognizeWith:function(yt){return I(yt,"dropRecognizeWith",this)?this:(yt=hr(yt,this),delete this.simultaneous[yt.id],this)},requireFailure:function(yt){if(I(yt,"requireFailure",this))return this;var Dt=this.requireFail;return yt=hr(yt,this),Ut(Dt,yt)===-1&&(Dt.push(yt),yt.requireFailure(this)),this},dropRequireFailure:function(yt){if(I(yt,"dropRequireFailure",this))return this;yt=hr(yt,this);var Dt=Ut(this.requireFail,yt);return Dt>-1&&this.requireFail.splice(Dt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(yt){return!!this.simultaneous[yt.id]},emit:function(yt){var Dt=this,$t=this.state;function Se(Ye){Dt.manager.emit(Ye,yt)}$t<Qi&&Se(Dt.options.event+Wr($t)),Se(Dt.options.event),yt.additionalEvent&&Se(yt.additionalEvent),$t>=Qi&&Se(Dt.options.event+Wr($t))},tryEmit:function(yt){if(this.canEmit())return this.emit(yt);this.state=ti},canEmit:function(){for(var yt=0;yt<this.requireFail.length;){if(!(this.requireFail[yt].state&(ti|Ji)))return!1;yt++}return!0},recognize:function(yt){var Dt=V({},yt);if(!ct(this.options.enable,[this,Dt])){this.reset(),this.state=ti;return}this.state&(mi|_t|ti)&&(this.state=Ji),this.state=this.process(Dt),this.state&(Hi|mr|Qi|_t)&&this.tryEmit(Dt)},process:function(yt){},getTouchAction:function(){},reset:function(){}};function Wr(yt){return yt&_t?"cancel":yt&Qi?"end":yt&mr?"move":yt&Hi?"start":""}function ga(yt){return yt==xi?"down":yt==Xn?"up":yt==Ni?"left":yt==Pi?"right":""}function hr(yt,Dt){var $t=Dt.manager;return $t?$t.get(yt):yt}function Kn(){sn.apply(this,arguments)}$(Kn,sn,{defaults:{pointers:1},attrTest:function(yt){var Dt=this.options.pointers;return Dt===0||yt.pointers.length===Dt},process:function(yt){var Dt=this.state,$t=yt.eventType,Se=Dt&(Hi|mr),Ye=this.attrTest(yt);return Se&&($t&yi||!Ye)?Dt|_t:Se||Ye?$t&Qe?Dt|Qi:Dt&Hi?Dt|mr:Hi:ti}});function gt(){Kn.apply(this,arguments),this.pX=null,this.pY=null}$(gt,Kn,{defaults:{event:"pan",threshold:10,pointers:1,direction:zi},getTouchAction:function(){var yt=this.options.direction,Dt=[];return yt&wi&&Dt.push(Gi),yt&mn&&Dt.push(Ze),Dt},directionTest:function(yt){var Dt=this.options,$t=!0,Se=yt.distance,Ye=yt.direction,Xi=yt.deltaX,En=yt.deltaY;return Ye&Dt.direction||(Dt.direction&wi?(Ye=Xi===0?cn:Xi<0?Ni:Pi,$t=Xi!=this.pX,Se=Math.abs(yt.deltaX)):(Ye=En===0?cn:En<0?Xn:xi,$t=En!=this.pY,Se=Math.abs(yt.deltaY))),yt.direction=Ye,$t&&Se>Dt.threshold&&Ye&Dt.direction},attrTest:function(yt){return Kn.prototype.attrTest.call(this,yt)&&(this.state&Hi||!(this.state&Hi)&&this.directionTest(yt))},emit:function(yt){this.pX=yt.deltaX,this.pY=yt.deltaY;var Dt=ga(yt.direction);Dt&&(yt.additionalEvent=this.options.event+Dt),this._super.emit.call(this,yt)}});function Qo(){Kn.apply(this,arguments)}$(Qo,Kn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(yt){return this._super.attrTest.call(this,yt)&&(Math.abs(yt.scale-1)>this.options.threshold||this.state&Hi)},emit:function(yt){if(yt.scale!==1){var Dt=yt.scale<1?"in":"out";yt.additionalEvent=this.options.event+Dt}this._super.emit.call(this,yt)}});function Zn(){sn.apply(this,arguments),this._timer=null,this._input=null}$(Zn,sn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ge]},process:function(yt){var Dt=this.options,$t=yt.pointers.length===Dt.pointers,Se=yt.distance<Dt.threshold,Ye=yt.deltaTime>Dt.time;if(this._input=yt,!Se||!$t||yt.eventType&(Qe|yi)&&!Ye)this.reset();else if(yt.eventType&ei)this.reset(),this._timer=C(function(){this.state=mi,this.tryEmit()},Dt.time,this);else if(yt.eventType&Qe)return mi;return ti},reset:function(){clearTimeout(this._timer)},emit:function(yt){this.state===mi&&(yt&&yt.eventType&Qe?this.manager.emit(this.options.event+"up",yt):(this._input.timeStamp=_(),this.manager.emit(this.options.event,this._input)))}});function Jo(){Kn.apply(this,arguments)}$(Jo,Kn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(yt){return this._super.attrTest.call(this,yt)&&(Math.abs(yt.rotation)>this.options.threshold||this.state&Hi)}});function Lr(){Kn.apply(this,arguments)}$(Lr,Kn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:wi|mn,pointers:1},getTouchAction:function(){return gt.prototype.getTouchAction.call(this)},attrTest:function(yt){var Dt=this.options.direction,$t;return Dt&(wi|mn)?$t=yt.overallVelocity:Dt&wi?$t=yt.overallVelocityX:Dt&mn&&($t=yt.overallVelocityY),this._super.attrTest.call(this,yt)&&Dt&yt.offsetDirection&&yt.distance>this.options.threshold&&yt.maxPointers==this.options.pointers&&y($t)>this.options.velocity&&yt.eventType&Qe},emit:function(yt){var Dt=ga(yt.offsetDirection);Dt&&this.manager.emit(this.options.event+Dt,yt),this.manager.emit(this.options.event,yt)}});function fr(){sn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$(fr,sn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ve]},process:function(yt){var Dt=this.options,$t=yt.pointers.length===Dt.pointers,Se=yt.distance<Dt.threshold,Ye=yt.deltaTime<Dt.time;if(this.reset(),yt.eventType&ei&&this.count===0)return this.failTimeout();if(Se&&Ye&&$t){if(yt.eventType!=Qe)return this.failTimeout();var Xi=this.pTime?yt.timeStamp-this.pTime<Dt.interval:!0,En=!this.pCenter||Lt(this.pCenter,yt.center)<Dt.posThreshold;this.pTime=yt.timeStamp,this.pCenter=yt.center,!En||!Xi?this.count=1:this.count+=1,this._input=yt;var Yn=this.count%Dt.taps;if(Yn===0)return this.hasRequireFailures()?(this._timer=C(function(){this.state=mi,this.tryEmit()},Dt.interval,this),Hi):mi}return ti},failTimeout:function(){return this._timer=C(function(){this.state=ti},this.options.interval,this),ti},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==mi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Tr(yt,Dt){return Dt=Dt||{},Dt.recognizers=rt(Dt.recognizers,Tr.defaults.preset),new Hr(yt,Dt)}Tr.VERSION="2.0.7",Tr.defaults={domEvents:!1,touchAction:Ue,enable:!0,inputTarget:null,inputClass:null,preset:[[Jo,{enable:!1}],[Qo,{enable:!1},["rotate"]],[Lr,{direction:wi}],[gt,{direction:wi},["swipe"]],[fr],[fr,{event:"doubletap",taps:2},["tap"]],[Zn]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Fn=1,gs=2;function Hr(yt,Dt){this.options=V({},Tr.defaults,Dt||{}),this.options.inputTarget=this.options.inputTarget||yt,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=yt,this.input=sr(this),this.touchAction=new rn(this,this.options.touchAction),Ms(this,!0),k(this.options.recognizers,function($t){var Se=this.add(new $t[0]($t[1]));$t[2]&&Se.recognizeWith($t[2]),$t[3]&&Se.requireFailure($t[3])},this)}Hr.prototype={set:function(yt){return V(this.options,yt),yt.touchAction&&this.touchAction.update(),yt.inputTarget&&(this.input.destroy(),this.input.target=yt.inputTarget,this.input.init()),this},stop:function(yt){this.session.stopped=yt?gs:Fn},recognize:function(yt){var Dt=this.session;if(!Dt.stopped){this.touchAction.preventDefaults(yt);var $t,Se=this.recognizers,Ye=Dt.curRecognizer;(!Ye||Ye&&Ye.state&mi)&&(Ye=Dt.curRecognizer=null);for(var Xi=0;Xi<Se.length;)$t=Se[Xi],Dt.stopped!==gs&&(!Ye||$t==Ye||$t.canRecognizeWith(Ye))?$t.recognize(yt):$t.reset(),!Ye&&$t.state&(Hi|mr|Qi)&&(Ye=Dt.curRecognizer=$t),Xi++}},get:function(yt){if(yt instanceof sn)return yt;for(var Dt=this.recognizers,$t=0;$t<Dt.length;$t++)if(Dt[$t].options.event==yt)return Dt[$t];return null},add:function(yt){if(I(yt,"add",this))return this;var Dt=this.get(yt.options.event);return Dt&&this.remove(Dt),this.recognizers.push(yt),yt.manager=this,this.touchAction.update(),yt},remove:function(yt){if(I(yt,"remove",this))return this;if(yt=this.get(yt),yt){var Dt=this.recognizers,$t=Ut(Dt,yt);$t!==-1&&(Dt.splice($t,1),this.touchAction.update())}return this},on:function(yt,Dt){if(yt!==r&&Dt!==r){var $t=this.handlers;return k(st(yt),function(Se){$t[Se]=$t[Se]||[],$t[Se].push(Dt)}),this}},off:function(yt,Dt){if(yt!==r){var $t=this.handlers;return k(st(yt),function(Se){Dt?$t[Se]&&$t[Se].splice(Ut($t[Se],Dt),1):delete $t[Se]}),this}},emit:function(yt,Dt){this.options.domEvents&&Ln(yt,Dt);var $t=this.handlers[yt]&&this.handlers[yt].slice();if(!(!$t||!$t.length)){Dt.type=yt,Dt.preventDefault=function(){Dt.srcEvent.preventDefault()};for(var Se=0;Se<$t.length;)$t[Se](Dt),Se++}},destroy:function(){this.element&&Ms(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ms(yt,Dt){var $t=yt.element;if($t.style){var Se;k(yt.options.cssProps,function(Ye,Xi){Se=Tt($t.style,Xi),Dt?(yt.oldCssProps[Se]=$t.style[Se],$t.style[Se]=Ye):$t.style[Se]=yt.oldCssProps[Se]||""}),Dt||(yt.oldCssProps={})}}function Ln(yt,Dt){var $t=e.createEvent("Event");$t.initEvent(yt,!0,!0),$t.gesture=Dt,Dt.target.dispatchEvent($t)}V(Tr,{INPUT_START:ei,INPUT_MOVE:ii,INPUT_END:Qe,INPUT_CANCEL:yi,STATE_POSSIBLE:Ji,STATE_BEGAN:Hi,STATE_CHANGED:mr,STATE_ENDED:Qi,STATE_RECOGNIZED:mi,STATE_CANCELLED:_t,STATE_FAILED:ti,DIRECTION_NONE:cn,DIRECTION_LEFT:Ni,DIRECTION_RIGHT:Pi,DIRECTION_UP:Xn,DIRECTION_DOWN:xi,DIRECTION_HORIZONTAL:wi,DIRECTION_VERTICAL:mn,DIRECTION_ALL:zi,Manager:Hr,Input:xn,TouchAction:rn,TouchInput:mt,MouseInput:qe,PointerEventInput:St,TouchMouseInput:d,SingleTouchInput:it,Recognizer:sn,AttrRecognizer:Kn,Tap:fr,Pan:gt,Swipe:Lr,Pinch:Qo,Rotate:Jo,Press:Zn,on:nt,off:Ot,each:k,merge:H,extend:X,assign:V,inherit:$,bindFn:Y,prefixed:Tt});var ah=typeof t<"u"?t:typeof self<"u"?self:{};ah.Hammer=Tr,i.exports?i.exports=Tr:t[n]=Tr})(window,document,"Hammer")})(nP)),nP.exports}var _m=uet();const cet=df(_m),Ql=UF({__proto__:null,default:cet},[_m]),w8=1,E8=2,s2=4,het={mousedown:w8,mousemove:E8,mouseup:s2};function fet(i,t){for(let e=0;e<i.length;e++)if(t(i[e]))return!0;return!1}function det(i){const t=i.prototype.handler;i.prototype.handler=function(e){const n=this.store;e.button>0&&e.type==="pointerdown"&&(fet(n,r=>r.pointerId===e.pointerId)||n.push(e)),t.call(this,e)}}function pet(i){i.prototype.handler=function(t){let e=het[t.type];e&w8&&t.button>=0&&(this.pressed=!0),e&E8&&t.buttons===0&&(e=s2),this.pressed&&(e&s2&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}det(_m.PointerEventInput);pet(_m.MouseInput);const Aet=_m.Manager;class Hy{constructor(t,e,n){this.element=t,this.callback=e,this.options={enable:!0,...n}}}const met=Ql?[[Ql.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Ql.Rotate,{enable:!1}],[Ql.Pinch,{enable:!1}],[Ql.Swipe,{enable:!1}],[Ql.Pan,{threshold:0,enable:!1}],[Ql.Press,{enable:!1}],[Ql.Tap,{event:"doubletap",taps:2,enable:!1}],[Ql.Tap,{event:"anytap",enable:!1}],[Ql.Tap,{enable:!1}]]:null,sP={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},get={doubletap:["tap"]},yet={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},ow={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},vet={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},oP={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},_et=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Qd=typeof window<"u"?window:global;let o2=!1;try{const i={get passive(){return o2=!0,!0}};Qd.addEventListener("test",null,i),Qd.removeEventListener("test",null)}catch{o2=!1}const bet=_et.indexOf("firefox")!==-1,{WHEEL_EVENTS:xet}=ow,aP="wheel",lP=4.000244140625,wet=40,Eet=.25;class Cet extends Hy{constructor(t,e,n){super(t,e,n),this.handleEvent=r=>{if(!this.options.enable)return;let o=r.deltaY;Qd.WheelEvent&&(bet&&r.deltaMode===Qd.WheelEvent.DOM_DELTA_PIXEL&&(o/=Qd.devicePixelRatio),r.deltaMode===Qd.WheelEvent.DOM_DELTA_LINE&&(o*=wet)),o!==0&&o%lP===0&&(o=Math.floor(o/lP)),r.shiftKey&&o&&(o=o*Eet),this.callback({type:aP,center:{x:r.clientX,y:r.clientY},delta:-o,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(xet),this.events.forEach(r=>t.addEventListener(r,this.handleEvent,o2?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===aP&&(this.options.enable=e)}}const{MOUSE_EVENTS:Tet}=ow,uP="pointermove",cP="pointerover",hP="pointerout",fP="pointerenter",dP="pointerleave";class Pet extends Hy{constructor(t,e,n){super(t,e,n),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(Tet),this.events.forEach(o=>t.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===uP&&(this.enableMoveEvent=e),t===cP&&(this.enableOverEvent=e),t===hP&&(this.enableOutEvent=e),t===fP&&(this.enableEnterEvent=e),t===dP&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(cP,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(hP,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(fP,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(dP,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit(uP,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:Iet}=ow,pP="keydown",AP="keyup";class Met extends Hy{constructor(t,e,n){super(t,e,n),this.handleEvent=r=>{const o=r.target||r.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:pP,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:AP,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Iet),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(r=>t.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===pP&&(this.enableDownEvent=e),t===AP&&(this.enableUpEvent=e)}}const mP="contextmenu";class Bet extends Hy{constructor(t,e,n){super(t,e,n),this.handleEvent=r=>{this.options.enable&&this.callback({type:mP,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===mP&&(this.options.enable=e)}}const gP=1,a2=2,yP=4,Ret={pointerdown:gP,pointermove:a2,pointerup:yP,mousedown:gP,mousemove:a2,mouseup:yP},Let=0,Det=1,ket=2,Oet=1,Fet=2,Net=4;function zet(i){const t=Ret[i.srcEvent.type];if(!t)return null;const{buttons:e,button:n}=i.srcEvent;let r=!1,o=!1,s=!1;return t===a2?(r=!!(e&Oet),o=!!(e&Net),s=!!(e&Fet)):(r=n===Let,o=n===Det,s=n===ket),{leftButton:r,middleButton:o,rightButton:s}}function Uet(i,t){const e=i.center;if(!e)return null;const n=t.getBoundingClientRect(),r=n.width/t.offsetWidth||1,o=n.height/t.offsetHeight||1,s={x:(e.x-n.left-t.clientLeft)/r,y:(e.y-n.top-t.clientTop)/o};return{center:e,offsetCenter:s}}const e1={srcElement:"root",priority:0};class Vet{constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const n=this._normalizeEvent(e);let r=e.srcEvent.target;for(;r&&r!==n.rootElement;){if(this._emit(n,r),n.handled)return;r=r.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,n,r=!1,o=!1){const{handlers:s,handlersByElement:l}=this;let c=e1;typeof n=="string"||n&&n.addEventListener?c={...e1,srcElement:n}:n&&(c={...e1,...n});let y=l.get(c.srcElement);y||(y=[],l.set(c.srcElement,y));const _={type:t,handler:e,srcElement:c.srcElement,priority:c.priority};r&&(_.once=!0),o&&(_.passive=!0),s.push(_),this._active=this._active||!_.passive;let C=y.length-1;for(;C>=0&&!(y[C].priority>=_.priority);)C--;y.splice(C+1,0,_)}remove(t,e){const{handlers:n,handlersByElement:r}=this;for(let o=n.length-1;o>=0;o--){const s=n[o];if(s.type===t&&s.handler===e){n.splice(o,1);const l=r.get(s.srcElement);l.splice(l.indexOf(s),1),l.length===0&&r.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(t,e){const n=this.handlersByElement.get(e);if(n){let r=!1;const o=()=>{t.handled=!0},s=()=>{t.handled=!0,r=!0},l=[];for(let c=0;c<n.length;c++){const{type:y,handler:_,once:C}=n[c];if(_({...t,type:y,stopPropagation:o,stopImmediatePropagation:s}),C&&l.push(n[c]),r)break}for(let c=0;c<l.length;c++){const{type:y,handler:_}=l[c];this.remove(y,_)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...zet(t),...Uet(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const Get={events:null,recognizers:null,recognizerOptions:{},Manager:Aet,touchAction:"none",tabIndex:0};class jet{constructor(t=null,e){this._onBasicInput=r=>{const{srcEvent:o}=r,s=yet[o.type];s&&this.manager.emit(s,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...Get,...e},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,n=e.Manager;this.manager=new n(t,{touchAction:e.touchAction,recognizers:e.recognizers||met}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(sP).forEach(r=>{const o=this.manager.get(r);o&&sP[r].forEach(s=>{o.recognizeWith(s)})});for(const r in e.recognizerOptions){const o=this.manager.get(r);if(o){const s=e.recognizerOptions[r];delete s.enable,o.set(s)}}this.wheelInput=new Cet(t,this._onOtherEvent,{enable:!1}),this.moveInput=new Pet(t,this._onOtherEvent,{enable:!1}),this.keyInput=new Met(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new Bet(t,this._onOtherEvent,{enable:!1});for(const[r,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(r,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,n){this._addEventHandler(t,e,n,!1)}once(t,e,n){this._addEventHandler(t,e,n,!0)}watch(t,e,n){this._addEventHandler(t,e,n,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:n}=this;if(!n)return;const r=n.get(t);if(r&&r.options.enable!==e){r.set({enable:e});const o=get[t];o&&!this.options.recognizers&&o.forEach(s=>{const l=n.get(s);e?(l.requireFailure(t),r.dropRequireFailure(s)):l.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,n,r,o){if(typeof t!="string"){n=e;for(const _ in t)this._addEventHandler(_,t[_],n,r,o);return}const{manager:s,events:l}=this,c=oP[t]||t;let y=l.get(c);y||(y=new Vet(this),l.set(c,y),y.recognizerName=vet[c]||c,s&&s.on(c,y.handleEvent)),y.add(t,e,n,r,o),y.isEmpty()||this._toggleRecognizer(y.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const s in t)this._removeEventHandler(s,t[s]);return}const{events:n}=this,r=oP[t]||t,o=n.get(r);if(o&&(o.remove(t,e),o.isEmpty())){const{recognizerName:s}=o;let l=!1;for(const c of n.values())if(c.recognizerName===s&&!c.isEmpty()){l=!0;break}l||this._toggleRecognizer(s,!1)}}}function vP(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function Do(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?vP(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):vP(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var kh={transitionDuration:0},Vu={transitionDuration:300,transitionEasing:function(i){return i},transitionInterpolator:new XA,transitionInterruption:KA.BREAK},L0=300,D0=function(i){return 1-(1-i)*(1-i)},xd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},C8=(function(){function i(){var t=this;th(this,i),Bi(this,"events",[]),Bi(this,"scrollZoom",!0),Bi(this,"dragPan",!0),Bi(this,"dragRotate",!0),Bi(this,"doubleClickZoom",!0),Bi(this,"touchZoom",!0),Bi(this,"touchRotate",!1),Bi(this,"keyboard",!0),Bi(this,"_interactionState",{isDragging:!1}),Bi(this,"_events",{}),Bi(this,"_setInteractionState",function(e){Object.assign(t._interactionState,e),t.onStateChange&&t.onStateChange(t._interactionState)}),Bi(this,"_onTransition",function(e,n){t.onViewportChange(e,t._interactionState,n)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new sw({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return $c(i,[{key:"handleEvent",value:function(t){this.mapState=this.getMapState();var e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=t.offsetCenter,n=e.x,r=e.y;return[n,r]}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"blockEvents",value:function(t){var e=this,n=setTimeout(function(){e._eventStartBlocked===n&&(e._eventStartBlocked=null)},t);this._eventStartBlocked=n}},{key:"updateViewport",value:function(t,e,n){var r=this.mapState instanceof up?this.mapState.getViewportProps():this.mapState,o=Do(Do({},t.getViewportProps()),e),s=Object.keys(o).some(function(l){return r[l]!==o[l]});this._state=t.getState(),this._setInteractionState(n),s&&this.onViewportChange(o,this._interactionState,r)}},{key:"getMapState",value:function(t){return new up(Do(Do(Do({},this.mapStateProps),this._state),t))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(t){var e=t.onViewportChange,n=t.onStateChange,r=t.eventManager,o=r===void 0?this.eventManager:r,s=t.isInteractive,l=s===void 0?!0:s,c=t.scrollZoom,y=c===void 0?this.scrollZoom:c,_=t.dragPan,C=_===void 0?this.dragPan:_,I=t.dragRotate,k=I===void 0?this.dragRotate:I,z=t.doubleClickZoom,V=z===void 0?this.doubleClickZoom:z,X=t.touchZoom,H=X===void 0?this.touchZoom:X,$=t.touchRotate,Y=$===void 0?this.touchRotate:$,ct=t.keyboard,rt=ct===void 0?this.keyboard:ct;this.onViewportChange=e,this.onStateChange=n;var nt=this.mapStateProps||{},Ot=nt.height!==t.height||nt.width!==t.width;this.mapStateProps=t,Ot&&(this.mapState=nt,this.updateViewport(new up(t))),this._transitionManager.processViewportChange(t),this.eventManager!==o&&(this.eventManager=o,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(xd.WHEEL,l&&!!y),this.toggleEvents(xd.PAN,l&&!!(C||k)),this.toggleEvents(xd.PINCH,l&&!!(H||Y)),this.toggleEvents(xd.TRIPLE_PAN,l&&!!Y),this.toggleEvents(xd.DOUBLE_TAP,l&&!!V),this.toggleEvents(xd.KEYBOARD,l&&!!rt),this.scrollZoom=y,this.dragPan=C,this.dragRotate=k,this.doubleClickZoom=V,this.touchZoom=H,this.touchRotate=Y,this.keyboard=rt}},{key:"toggleEvents",value:function(t,e){var n=this;this.eventManager&&t.forEach(function(r){n._events[r]!==e&&(n._events[r]=e,e?n.eventManager.on(r,n.handleEvent):n.eventManager.off(r,n.handleEvent))})}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t);this._panRotate=this.isFunctionKeyPressed(t)||t.rightButton;var n=this._panRotate?this.mapState.rotateStart({pos:e}):this.mapState.panStart({pos:e});return this.updateViewport(n,kh,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotate(t):this._onPanMove(t):!1}},{key:"_onPanEnd",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotateEnd(t):this._onPanMoveEnd(t):!1}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t),n=this.mapState.pan({pos:e});return this.updateViewport(n,kh,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(t){if(this.dragPan){var e=this.dragPan.inertia,n=e===void 0?L0:e;if(n&&t.velocity){var r=this.getCenter(t),o=[r[0]+t.velocityX*n/2,r[1]+t.velocityY*n/2],s=this.mapState.pan({pos:o}).panEnd();return this.updateViewport(s,Do(Do({},Vu),{},{transitionDuration:n,transitionEasing:D0}),{isDragging:!1,isPanning:!0}),!0}}var l=this.mapState.panEnd();return this.updateViewport(l,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=this.getCenter(t),n=this.mapState.rotate({pos:e});return this.updateViewport(n,kh,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(t){if(this.dragRotate){var e=this.dragRotate.inertia,n=e===void 0?L0:e;if(n&&t.velocity){var r=this.getCenter(t),o=[r[0]+t.velocityX*n/2,r[1]+t.velocityY*n/2],s=this.mapState.rotate({pos:o}).rotateEnd();return this.updateViewport(s,Do(Do({},Vu),{},{transitionDuration:n,transitionEasing:D0}),{isDragging:!1,isRotating:!0}),!0}}var l=this.mapState.panEnd();return this.updateViewport(l,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;var e=this.scrollZoom,n=e.speed,r=n===void 0?.01:n,o=e.smooth,s=o===void 0?!1:o;t.preventDefault();var l=this.getCenter(t),c=t.delta,y=2/(1+Math.exp(-Math.abs(c*r)));c<0&&y!==0&&(y=1/y);var _=this.mapState.zoom({pos:l,scale:y});return _.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(_,Do(Do({},Vu),{},{transitionInterpolator:new XA({around:l}),transitionDuration:s?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t),n=this.mapState.zoomStart({pos:e}).rotateStart({pos:e});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(n,kh,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var e=this.mapState;if(this.touchZoom){var n=t.scale,r=this.getCenter(t);e=e.zoom({pos:r,scale:n})}if(this.touchRotate){var o=t.rotation;e=e.rotate({deltaAngleX:this._startPinchRotation-o})}return this.updateViewport(e,kh,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=t,!0}},{key:"_onPinchEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchZoom){var e=this.touchZoom.inertia,n=e===void 0?L0:e,r=this._lastPinchEvent;if(n&&r&&t.scale!==r.scale){var o=this.getCenter(t),s=this.mapState.rotateEnd(),l=Math.log2(t.scale),c=(l-Math.log2(r.scale))/(t.deltaTime-r.deltaTime),y=Math.pow(2,l+c*n/2);return s=s.zoom({pos:o,scale:y}).zoomEnd(),this.updateViewport(s,Do(Do({},Vu),{},{transitionInterpolator:new XA({around:o}),transitionDuration:n,transitionEasing:D0}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(n),!0}}var _=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(_,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(t){var e=this.getCenter(t),n=this.mapState.rotateStart({pos:e});return this.updateViewport(n,kh,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(t){if(!this.isDragging()||!this.touchRotate)return!1;var e=this.getCenter(t);e[0]-=t.deltaX;var n=this.mapState.rotate({pos:e});return this.updateViewport(n,kh,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchRotate){var e=this.touchRotate.inertia,n=e===void 0?L0:e;if(n&&t.velocityY){var r=this.getCenter(t),o=[r[0],r[1]+=t.velocityY*n/2],s=this.mapState.rotate({pos:o});return this.updateViewport(s,Do(Do({},Vu),{},{transitionDuration:n,transitionEasing:D0}),{isDragging:!1,isRotating:!0}),this.blockEvents(n),!1}}var l=this.mapState.rotateEnd();return this.updateViewport(l,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t),n=this.isFunctionKeyPressed(t),r=this.mapState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(r,Object.assign({},Vu,{transitionInterpolator:new XA({around:e})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e=this.isFunctionKeyPressed(t),n=this.keyboard,r=n.zoomSpeed,o=r===void 0?2:r,s=n.moveSpeed,l=s===void 0?100:s,c=n.rotateSpeedX,y=c===void 0?15:c,_=n.rotateSpeedY,C=_===void 0?10:_,I=this.mapStateProps,k;switch(t.srcEvent.keyCode){case 189:e?k=this.getMapState({zoom:I.zoom-Math.log2(o)-1}):k=this.getMapState({zoom:I.zoom-Math.log2(o)});break;case 187:e?k=this.getMapState({zoom:I.zoom+Math.log2(o)+1}):k=this.getMapState({zoom:I.zoom+Math.log2(o)});break;case 37:e?k=this.getMapState({bearing:I.bearing-y}):k=this.mapState.pan({pos:[l,0],startPos:[0,0]});break;case 39:e?k=this.getMapState({bearing:I.bearing+y}):k=this.mapState.pan({pos:[-l,0],startPos:[0,0]});break;case 38:e?k=this.getMapState({pitch:I.pitch+C}):k=this.mapState.pan({pos:[0,l],startPos:[0,0]});break;case 40:e?k=this.getMapState({pitch:I.pitch-C}):k=this.mapState.pan({pos:[0,-l],startPos:[0,0]});break;default:return!1}return this.updateViewport(k,Vu)}}]),i})();function _P(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function zu(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?_P(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):_P(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var Wet=Object.assign({},nc.propTypes,{maxZoom:_e.number,minZoom:_e.number,maxPitch:_e.number,minPitch:_e.number,onViewStateChange:_e.func,onViewportChange:_e.func,onInteractionStateChange:_e.func,transitionDuration:_e.oneOfType([_e.number,_e.string]),transitionInterpolator:_e.object,transitionInterruption:_e.number,transitionEasing:_e.func,onTransitionStart:_e.func,onTransitionInterrupt:_e.func,onTransitionEnd:_e.func,scrollZoom:_e.oneOfType([_e.bool,_e.object]),dragPan:_e.oneOfType([_e.bool,_e.object]),dragRotate:_e.oneOfType([_e.bool,_e.object]),doubleClickZoom:_e.bool,touchZoom:_e.oneOfType([_e.bool,_e.object]),touchRotate:_e.oneOfType([_e.bool,_e.object]),keyboard:_e.oneOfType([_e.bool,_e.object]),onHover:_e.func,onClick:_e.func,onDblClick:_e.func,onContextMenu:_e.func,onMouseDown:_e.func,onMouseMove:_e.func,onMouseUp:_e.func,onTouchStart:_e.func,onTouchMove:_e.func,onTouchEnd:_e.func,onMouseEnter:_e.func,onMouseLeave:_e.func,onMouseOut:_e.func,onWheel:_e.func,touchAction:_e.string,eventRecognizerOptions:_e.object,clickRadius:_e.number,interactiveLayerIds:_e.array,getCursor:_e.func,controller:_e.instanceOf(C8)}),Het=function(i){var t=i.isDragging,e=i.isHovering;return t?"grabbing":e?"pointer":"grab"},Xet=Object.assign({},nc.defaultProps,Xh,sw.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(i){return i.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:Het});function aw(i){if(i.lngLat||!i.offsetCenter)return i;var t=i.offsetCenter,e=t.x,n=t.y;if(!Number.isFinite(e)||!Number.isFinite(n))return i;var r=[e,n];return i.point=r,i.lngLat=this.viewport.unproject(r),i}function T8(i){var t=this.map;if(!t||!i)return null;var e={},n=this.props.clickRadius;this.props.interactiveLayerIds&&(e.layers=this.props.interactiveLayerIds);try{return t.queryRenderedFeatures(n?[[i[0]-n,i[1]+n],[i[0]+n,i[1]-n]]:i,e)}catch{return null}}function qu(i,t){var e=this.props[i];e&&e(aw.call(this,t))}function qet(i){qu.call(this,i.pointerType==="touch"?"onTouchStart":"onMouseDown",i)}function Ket(i){qu.call(this,i.pointerType==="touch"?"onTouchEnd":"onMouseUp",i)}function Zet(i){if(qu.call(this,i.pointerType==="touch"?"onTouchMove":"onMouseMove",i),!this.state.isDragging){var t=this.props,e=t.onHover,n=t.interactiveLayerIds,r;i=aw.call(this,i),(n||e)&&(r=T8.call(this,i.point));var o=!!(n&&r&&r.length>0),s=o&&!this.state.isHovering,l=!o&&this.state.isHovering;(e||s)&&(i.features=r,e&&e(i)),s&&qu.call(this,"onMouseEnter",i),l&&qu.call(this,"onMouseLeave",i),(s||l)&&this.setState({isHovering:o})}}function bP(i){var t=this.props,e=t.onClick,n=t.onNativeClick,r=t.onDblClick,o=t.doubleClickZoom,s=[],l=r||o;switch(i.type){case"anyclick":s.push(n),l||s.push(e);break;case"click":l&&s.push(e);break}s=s.filter(Boolean),s.length&&(i=aw.call(this,i),i.features=T8.call(this,i.point),s.forEach(function(c){return c(i)}))}function Yet(i){return{getMap:i.current&&i.current.getMap,queryRenderedFeatures:i.current&&i.current.queryRenderedFeatures}}var lw=Re.forwardRef(function(i,t){var e=Re.useContext(yf),n=Re.useMemo(function(){return i.controller||new C8},[]),r=Re.useMemo(function(){return new jet(null,{touchAction:i.touchAction,recognizerOptions:i.eventRecognizerOptions})},[]),o=Re.useRef(null),s=Re.useRef(null),l=Re.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),c=l.current;c.props=i,c.map=s.current&&s.current.getMap(),c.setState=function(nt){c.state=zu(zu({},c.state),nt),o.current.style.cursor=i.getCursor(c.state)};var y=!0,_,C,I=function(nt,Ot,Kt){if(y){_=[nt,Ot,Kt];return}var ft=c.props,st=ft.onViewStateChange,Ut=ft.onViewportChange;st&&st({viewState:nt,interactionState:Ot,oldViewState:Kt}),Ut&&Ut(nt,Ot,Kt)};Re.useImperativeHandle(t,function(){return Yet(s)},[]);var k=Re.useMemo(function(){return zu(zu({},e),{},{eventManager:r,container:e.container||o.current})},[e,o.current]);k.onViewportChange=I,k.viewport=e.viewport||b8(c),c.viewport=k.viewport;var z=function(nt){var Ot=nt.isDragging,Kt=Ot===void 0?!1:Ot;if(Kt!==c.state.isDragging&&c.setState({isDragging:Kt}),y){C=nt;return}var ft=c.props.onInteractionStateChange;ft&&ft(nt)},V=function(){c.width&&c.height&&n.setOptions(zu(zu(zu({},c.props),c.props.viewState),{},{isInteractive:!!(c.props.onViewStateChange||c.props.onViewportChange),onViewportChange:I,onStateChange:z,eventManager:r,width:c.width,height:c.height}))},X=function(nt){var Ot=nt.width,Kt=nt.height;c.width=Ot,c.height=Kt,V(),c.props.onResize({width:Ot,height:Kt})};Re.useEffect(function(){return r.setElement(o.current),r.on({pointerdown:qet.bind(c),pointermove:Zet.bind(c),pointerup:Ket.bind(c),pointerleave:qu.bind(c,"onMouseOut"),click:bP.bind(c),anyclick:bP.bind(c),dblclick:qu.bind(c,"onDblClick"),wheel:qu.bind(c,"onWheel"),contextmenu:qu.bind(c,"onContextMenu")}),function(){r.destroy()}},[]),n2(function(){_&&I.apply(void 0,DF(_)),C&&z(C)}),V();var H=i.width,$=i.height,Y=i.style,ct=i.getCursor,rt=Re.useMemo(function(){return zu(zu({position:"relative"},Y),{},{width:H,height:$,cursor:ct(c.state)})},[Y,H,$,ct,c.state]);return(!_||!c._child)&&(c._child=Re.createElement(rw,{value:k},Re.createElement("div",{key:"event-canvas",ref:o,style:rt},Re.createElement(nc,YB({},i,{width:"100%",height:"100%",style:null,onResize:X,ref:s}))))),y=!1,c._child});lw.supported=nc.supported;lw.propTypes=Wet;lw.defaultProps=Xet;_e.string.isRequired;var Qet=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];_e.oneOf(Qet).isRequired;var eh={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},wl={captureScroll:_e.bool,captureDrag:_e.bool,captureClick:_e.bool,captureDoubleClick:_e.bool,capturePointerMove:_e.bool};function Jet(i){var t=i.containerRef.current,e=i.context.eventManager;if(!(!t||!e)){var n={wheel:function(r){var o=i.props;o.captureScroll&&r.stopPropagation(),o.onScroll&&o.onScroll(r,i)},panstart:function(r){var o=i.props;o.captureDrag&&r.stopPropagation(),o.onDragStart&&o.onDragStart(r,i)},anyclick:function(r){var o=i.props;o.captureClick&&r.stopPropagation(),o.onNativeClick&&o.onNativeClick(r,i)},click:function(r){var o=i.props;o.captureClick&&r.stopPropagation(),o.onClick&&o.onClick(r,i)},dblclick:function(r){var o=i.props;o.captureDoubleClick&&r.stopPropagation(),o.onDoubleClick&&o.onDoubleClick(r,i)},pointermove:function(r){var o=i.props;o.capturePointerMove&&r.stopPropagation(),o.onPointerMove&&o.onPointerMove(r,i)}};return e.watch(n,t),function(){e.off(n)}}}function ih(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Re.useContext(yf),e=Re.useRef(null),n=Re.useRef({props:i,state:{},context:t,containerRef:e}),r=n.current;return r.props=i,r.context=t,Re.useEffect(function(){return Jet(r)},[t.eventManager]),r}function $et(i){var t=tit();return function(){var e=Ap(i),n;if(t){var r=Ap(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return j2(this,n)}}function tit(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function eit(i){var t=i.instance,e=ih(i),n=e.context,r=e.containerRef;return t._context=n,t._containerRef=r,t._render()}var S8=(function(i){G2(e,i);var t=$et(e);function e(){var n;th(this,e);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Bi(zc(n),"_context",{}),Bi(zc(n),"_containerRef",Re.createRef()),Bi(zc(n),"_onScroll",function(l){}),Bi(zc(n),"_onDragStart",function(l){}),Bi(zc(n),"_onDblClick",function(l){}),Bi(zc(n),"_onClick",function(l){}),Bi(zc(n),"_onPointerMove",function(l){}),n}return $c(e,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return Re.createElement(eit,YB({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),e})(Re.PureComponent);Bi(S8,"propTypes",wl);Bi(S8,"defaultProps",eh);function xP(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function wP(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?xP(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):xP(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var iit=Object.assign({},wl,{draggable:_e.bool,onDrag:_e.func,onDragEnd:_e.func,onDragStart:_e.func,offsetLeft:_e.number,offsetTop:_e.number}),nit=Object.assign({},eh,{draggable:!1,offsetLeft:0,offsetTop:0});function P8(i){var t=i.offsetCenter,e=t.x,n=t.y;return[e,n]}function rit(i,t){var e=i.center,n=e.x,r=e.y;if(t){var o=t.getBoundingClientRect();return[o.left-n,o.top-r]}return null}function uw(i,t,e,n){var r=i[0]+t[0]-e.offsetLeft,o=i[1]+t[1]-e.offsetTop;return n.viewport.unproject([r,o])}function sit(i,t){var e=t.props,n=t.callbacks,r=t.state,o=t.context,s=t.containerRef,l=e.draggable;if(l){i.stopPropagation();var c=P8(i),y=rit(i,s.current);if(r.setDragPos(c),r.setDragOffset(y),n.onDragStart&&y){var _=Object.assign({},i);_.lngLat=uw(c,y,e,o),n.onDragStart(_)}}}function oit(i,t){var e=t.props,n=t.callbacks,r=t.state,o=t.context;i.stopPropagation();var s=P8(i);r.setDragPos(s);var l=r.dragOffset;if(n.onDrag&&l){var c=Object.assign({},i);c.lngLat=uw(s,l,e,o),n.onDrag(c)}}function ait(i,t){var e=t.props,n=t.callbacks,r=t.state,o=t.context;i.stopPropagation();var s=r.dragPos,l=r.dragOffset;if(r.setDragPos(null),r.setDragOffset(null),n.onDragEnd&&s&&l){var c=Object.assign({},i);c.lngLat=uw(s,l,e,o),n.onDragEnd(c)}}function lit(i,t){var e=t.state;i.stopPropagation(),e.setDragPos(null),e.setDragOffset(null)}function uit(i){var t=i.context.eventManager;if(!(!t||!i.state.dragPos)){var e={panmove:function(n){return oit(n,i)},panend:function(n){return ait(n,i)},pancancel:function(n){return lit(n,i)}};return t.watch(e),function(){t.off(e)}}}function cit(i){var t=Re.useState(null),e=ms(t,2),n=e[0],r=e[1],o=Re.useState(null),s=ms(o,2),l=s[0],c=s[1],y=ih(wP(wP({},i),{},{onDragStart:sit}));return y.callbacks=i,y.state.dragPos=n,y.state.setDragPos=r,y.state.dragOffset=l,y.state.setDragOffset=c,Re.useEffect(function(){return uit(y)},[y.context.eventManager,!!n]),y}var EP=typeof window<"u"&&window.devicePixelRatio||1,um=function(i){return Math.round(i*EP)/EP},CP=function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(i===null)return t;var n=e==="x"?i.offsetWidth:i.offsetHeight;return um(t/100*n)/n*100};function TP(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function hit(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?TP(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):TP(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var fit=Object.assign({},iit,{className:_e.string,longitude:_e.number.isRequired,latitude:_e.number.isRequired,style:_e.object}),dit=Object.assign({},nit,{className:""});function pit(i){var t=i.props,e=i.state,n=i.context,r=t.longitude,o=t.latitude,s=t.offsetLeft,l=t.offsetTop,c=e.dragPos,y=e.dragOffset;if(c&&y)return[c[0]+y[0],c[1]+y[1]];var _=n.viewport.project([r,o]),C=ms(_,2),I=C[0],k=C[1];return I+=s,k+=l,[I,k]}function cw(i){var t=cit(i),e=t.state,n=t.containerRef,r=i.children,o=i.className,s=i.draggable,l=i.style,c=e.dragPos,y=pit(t),_=ms(y,2),C=_[0],I=_[1],k="translate(".concat(um(C),"px, ").concat(um(I),"px)"),z=s?c?"grabbing":"grab":"auto",V=Re.useMemo(function(){var H=hit({position:"absolute",left:0,top:0,transform:k,cursor:z},l);return Re.createElement("div",{className:"mapboxgl-marker ".concat(o),ref:t.containerRef,style:H},r)},[r,o]),X=n.current;return X&&(X.style.transform=k,X.style.cursor=z),V}cw.defaultProps=dit;cw.propTypes=fit;Re.memo(cw);var cm={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},Ait=Object.keys(cm);function mit(i){var t=i.x,e=i.y,n=i.width,r=i.height,o=i.selfWidth,s=i.selfHeight,l=i.anchor,c=i.padding,y=c===void 0?0:c,_=cm[l],C=_.x,I=_.y,k=e-I*s,z=k+s,V=Math.max(0,y-k)+Math.max(0,z-r+y);if(V>0){var X=I,H=V;for(I=0;I<=1;I+=.5)k=e-I*s,z=k+s,V=Math.max(0,y-k)+Math.max(0,z-r+y),V<H&&(H=V,X=I);I=X}var $=.5;I===.5&&(C=Math.floor(C),$=1);var Y=t-C*o,ct=Y+o,rt=Math.max(0,y-Y)+Math.max(0,ct-n+y);if(rt>0){var nt=C,Ot=rt;for(C=0;C<=1;C+=$)Y=t-C*o,ct=Y+o,rt=Math.max(0,y-Y)+Math.max(0,ct-n+y),rt<Ot&&(Ot=rt,nt=C);C=nt}return Ait.find(function(Kt){var ft=cm[Kt];return ft.x===C&&ft.y===I})||l}var git=Object.assign({},wl,{className:_e.string,longitude:_e.number.isRequired,latitude:_e.number.isRequired,altitude:_e.number,offsetLeft:_e.number,offsetTop:_e.number,tipSize:_e.number,closeButton:_e.bool,closeOnClick:_e.bool,anchor:_e.oneOf(Object.keys(cm)),dynamicPosition:_e.bool,sortByDepth:_e.bool,onClose:_e.func}),yit=Object.assign({},eh,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function vit(i,t,e,n){var r=ms(n,2),o=r[0],s=r[1],l=i.anchor,c=i.dynamicPosition,y=i.tipSize;return e&&c?mit({x:o,y:s,anchor:l,padding:y,width:t.width,height:t.height,selfWidth:e.clientWidth,selfHeight:e.clientHeight}):l}function _it(i,t,e,n,r){var o=ms(n,3),s=o[0],l=o[1],c=o[2],y=i.offsetLeft,_=i.offsetTop,C=i.sortByDepth,I=cm[r],k=s+y,z=l+_,V=CP(e,-I.x*100),X=CP(e,-I.y*100,"y"),H={position:"absolute",transform:`
      translate(`.concat(V,"%, ").concat(X,`%)
      translate(`).concat(um(k),"px, ").concat(um(z),`px)
    `),display:void 0,zIndex:void 0};return C&&(c>1||c<-1||s<0||s>t.width||l<0||l>t.height?H.display="none":H.zIndex=Math.floor((1-c)/2*1e5)),H}function hw(i){var t=Re.useRef(null),e=ih(i),n=e.context,r=e.containerRef,o=Re.useState(!1),s=ms(o,2),l=s[1];Re.useEffect(function(){l(!0)},[t.current]),Re.useEffect(function(){if(n.eventManager&&i.closeOnClick){var ct=function(){return e.props.onClose()};return n.eventManager.on("anyclick",ct),function(){n.eventManager.off("anyclick",ct)}}},[n.eventManager,i.closeOnClick]);var c=n.viewport,y=i.className,_=i.longitude,C=i.latitude,I=i.altitude,k=i.tipSize,z=i.closeButton,V=i.children,X=c.project([_,C,I]),H=vit(i,c,t.current,X),$=_it(i,c,r.current,X,H),Y=Re.useCallback(function(ct){e.props.onClose();var rt=e.context.eventManager;rt&&rt.once("click",function(nt){return nt.stopPropagation()},ct.target)},[]);return Re.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(H," ").concat(y),style:$,ref:r},Re.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:k}}),Re.createElement("div",{key:"content",ref:t,className:"mapboxgl-popup-content"},z&&Re.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:Y},""),V))}hw.propTypes=git;hw.defaultProps=yit;Re.memo(hw);function SP(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function bit(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?SP(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):SP(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var xit=Object.assign({},wl,{toggleLabel:_e.string,className:_e.string,style:_e.object,compact:_e.bool,customAttribution:_e.oneOfType([_e.string,_e.arrayOf(_e.string)])}),wit=Object.assign({},eh,{className:"",toggleLabel:"Toggle Attribution"});function Eit(i,t,e,n){var r=new uu.AttributionControl(i);return r._map=t,r._container=e,r._innerContainer=n,r._updateAttributions(),r._updateEditLink(),t.on("styledata",r._updateData),t.on("sourcedata",r._updateData),r}function Cit(i){i._map.off("styledata",i._updateData),i._map.off("sourcedata",i._updateData)}function fw(i){var t=ih(i),e=t.context,n=t.containerRef,r=Re.useRef(null),o=Re.useState(!1),s=ms(o,2),l=s[0],c=s[1];Re.useEffect(function(){var I;return e.map&&(I=Eit({customAttribution:i.customAttribution},e.map,n.current,r.current)),function(){return I&&Cit(I)}},[e.map]);var y=i.compact===void 0?e.viewport.width<=640:i.compact;Re.useEffect(function(){!y&&l&&c(!1)},[y]);var _=Re.useCallback(function(){return c(function(I){return!I})},[]),C=Re.useMemo(function(){return bit({position:"absolute"},i.style)},[i.style]);return Re.createElement("div",{style:C,className:i.className},Re.createElement("div",{ref:n,"aria-pressed":l,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(y?"mapboxgl-compact":""," ").concat(l?"mapboxgl-compact-show":"")},Re.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:i.toggleLabel,onClick:_}),Re.createElement("div",{ref:r,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}fw.propTypes=xit;fw.defaultProps=wit;Re.memo(fw);function PP(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function Tit(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?PP(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):PP(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var Sit=Object.assign({},wl,{className:_e.string,style:_e.object,container:_e.object,label:_e.string}),Pit=Object.assign({},eh,{className:"",container:null,label:"Toggle fullscreen"});function dw(i){var t=ih(i),e=t.context,n=t.containerRef,r=Re.useState(!1),o=ms(r,2),s=o[0],l=o[1],c=Re.useState(!1),y=ms(c,2),_=y[0],C=y[1],I=Re.useState(null),k=ms(I,2),z=k[0],V=k[1];Re.useEffect(function(){var rt=new uu.FullscreenControl;V(rt),C(rt._checkFullscreenSupport());var nt=function(){var Ot=!rt._fullscreen;rt._fullscreen=Ot,l(Ot)};return Hu.addEventListener(rt._fullscreenchange,nt),function(){Hu.removeEventListener(rt._fullscreenchange,nt)}},[]);var X=function(){z&&(z._container=i.container||e.container,z._onClickFullscreen())},H=Re.useMemo(function(){return Tit({position:"absolute"},i.style)},[i.style]);if(!_)return null;var $=i.className,Y=i.label,ct=s?"shrink":"fullscreen";return Re.createElement("div",{style:H,className:$},Re.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Re.createElement("button",{key:ct,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(ct),type:"button",title:Y,onClick:X},Re.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}dw.propTypes=Sit;dw.defaultProps=Pit;Re.memo(dw);var wd;function Iit(){return wd!==void 0?Promise.resolve(wd):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(i){return wd=i.state!=="denied",wd}):(wd=!!window.navigator.geolocation,Promise.resolve(wd))}function IP(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function Mit(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?IP(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):IP(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var MP=function(){},Bit=Object.assign({},wl,{className:_e.string,style:_e.object,label:_e.string,disabledLabel:_e.string,auto:_e.bool,positionOptions:_e.object,fitBoundsOptions:_e.object,trackUserLocation:_e.bool,showUserLocation:_e.bool,showAccuracyCircle:_e.bool,showUserHeading:_e.bool,onViewStateChange:_e.func,onViewportChange:_e.func,onGeolocate:_e.func}),Rit=Object.assign({},eh,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function Lit(i){var t=new uu.LngLat(i.coords.longitude,i.coords.latitude),e=i.coords.accuracy,n=t.toBounds(e);return[[n._ne.lng,n._ne.lat],[n._sw.lng,n._sw.lat]]}function Dit(i,t,e){var n=new uu.GeolocateControl(t);n._container=Hu.createElement("div"),n._map={on:function(){},_getUIString:function(){return""}},n._setupUI(!0),n._map=i.map,n._geolocateButton=e;var r=i.eventManager;return n.options.trackUserLocation&&r&&r.on("panstart",function(){n._watchState==="ACTIVE_LOCK"&&(n._watchState="BACKGROUND",e.classList.add("mapboxgl-ctrl-geolocate-background"),e.classList.remove("mapboxgl-ctrl-geolocate-active"))}),n.on("geolocate",t.onGeolocate),n}function kit(i,t){var e=t.context,n=t.props,r=Lit(i),o=e.viewport.fitBounds(r,n.fitBoundsOptions),s=o.longitude,l=o.latitude,c=o.zoom,y=Object.assign({},e.viewport,{longitude:s,latitude:l,zoom:c}),_=new up(y),C=Object.assign({},_.getViewportProps(),Vu),I=n.onViewportChange||e.onViewportChange||MP,k=n.onViewStateChange||e.onViewStateChange||MP;k({viewState:C}),I(C)}function pw(i){var t=ih(i),e=t.context,n=t.containerRef,r=Re.useRef(null),o=Re.useState(null),s=ms(o,2),l=s[0],c=s[1],y=Re.useState(!1),_=ms(y,2),C=_[0],I=_[1];Re.useEffect(function(){var Y;return e.map&&Iit().then(function(ct){I(ct),r.current&&(Y=Dit(e,i,r.current),Y._updateCamera=function(rt){return kit(rt,t)},c(Y))}),function(){Y&&Y._clearWatch()}},[e.map]);var k=Re.useCallback(function(){l&&(l.options=t.props,l.trigger())},[l]);Re.useEffect(function(){i.auto&&k()},[l,i.auto]),Re.useEffect(function(){l&&l._onZoom()},[e.viewport.zoom]);var z=i.className,V=i.label,X=i.disabledLabel,H=i.trackUserLocation,$=Re.useMemo(function(){return Mit({position:"absolute"},i.style)},[i.style]);return Re.createElement("div",{style:$,className:z},Re.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Re.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:r,disabled:!C,"aria-pressed":!H,type:"button",title:C?V:X,"aria-label":C?V:X,onClick:k},Re.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}pw.propTypes=Bit;pw.defaultProps=Rit;Re.memo(pw);function Oit(i,t){for(var e=(i||"").split(".").map(Number),n=t.split(".").map(Number),r=0;r<3;r++){var o=e[r]||0,s=n[r]||0;if(o<s)return-1;if(o>s)return 1}return 0}function BP(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function Fit(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?BP(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):BP(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var RP=function(){},Nit=Object.assign({},wl,{className:_e.string,style:_e.object,onViewStateChange:_e.func,onViewportChange:_e.func,showCompass:_e.bool,showZoom:_e.bool,zoomInLabel:_e.string,zoomOutLabel:_e.string,compassLabel:_e.string}),zit=Object.assign({},eh,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),Uit=1,l2=2;function Vit(i){return Oit(i,"1.6.0")>=0?l2:Uit}function i1(i,t,e){var n=i.viewport,r=new up(Object.assign({},n,e)),o=Object.assign({},r.getViewportProps(),Vu),s=t.onViewportChange||i.onViewportChange||RP,l=t.onViewStateChange||i.onViewStateChange||RP;l({viewState:o}),s(o)}function n1(i,t,e,n){return Re.createElement("button",{key:i,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(i),type:"button",title:t,onClick:e},n||Re.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function Git(i){var t=Re.useMemo(function(){return i.map?Vit(i.map.version):l2},[i.map]),e=i.viewport.bearing,n={transform:"rotate(".concat(-e,"deg)")};return t===l2?Re.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:n}):Re.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:n})}function Aw(i){var t=ih(i),e=t.context,n=t.containerRef,r=function(){i1(e,i,{zoom:e.viewport.zoom+1})},o=function(){i1(e,i,{zoom:e.viewport.zoom-1})},s=function(){i1(e,i,{bearing:0,pitch:0})},l=i.className,c=i.showCompass,y=i.showZoom,_=i.zoomInLabel,C=i.zoomOutLabel,I=i.compassLabel,k=Re.useMemo(function(){return Fit({position:"absolute"},i.style)},[i.style]);return Re.createElement("div",{style:k,className:l},Re.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},y&&n1("zoom-in",_,r),y&&n1("zoom-out",C,o),c&&n1("compass",I,s,Git(e))))}Aw.propTypes=Nit;Aw.defaultProps=zit;const jit=Re.memo(Aw);function LP(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,n)}return e}function Wit(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?LP(Object(e),!0).forEach(function(n){Bi(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):LP(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}var Hit=Object.assign({},wl,{className:_e.string,style:_e.object,maxWidth:_e.number,unit:_e.oneOf(["imperial","metric","nautical"])}),Xit=Object.assign({},eh,{className:"",maxWidth:100,unit:"metric"});function mw(i){var t=ih(i),e=t.context,n=t.containerRef,r=Re.useState(null),o=ms(r,2),s=o[0],l=o[1];Re.useEffect(function(){if(e.map){var y=new uu.ScaleControl;y._map=e.map,y._container=n.current,l(y)}},[e.map]),s&&(s.options=i,s._onMove&&s._onMove());var c=Re.useMemo(function(){return Wit({position:"absolute"},i.style)},[i.style]);return Re.createElement("div",{style:c,className:i.className},Re.createElement("div",{ref:n,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}mw.propTypes=Hit;mw.defaultProps=Xit;Re.memo(mw);Object.assign({},wl,{redraw:_e.func.isRequired});Object.assign({},wl,{redraw:_e.func.isRequired,style:_e.object});Object.assign({},wl,{redraw:_e.func.isRequired,style:_e.object});uu&&uu.setRTLTextPlugin;const qit=()=>$l.jsx($l.Fragment,{}),DP=ZB("div",{target:"e1az0zs51"})(({height:i})=>({position:"relative",height:i,width:"100%"}),""),Kit=ZB("div",{target:"e1az0zs50"})(({theme:i})=>({position:"absolute",right:"2.625rem",top:i.spacing.md,zIndex:i.zIndices.priority,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:i.colors.bgColor},"button:not(:disabled)":{background:i.colors.bgColor,width:i.iconSizes.twoXL,height:i.iconSizes.twoXL,"& + button":{borderTopColor:i.colors.borderColor},".mapboxgl-ctrl-icon":{backgroundSize:i.iconSizes.twoXL,"&:hover":{backgroundColor:i.colors.darkenedBgMix25}},"& span":{filter:KB(i)?"":"invert(100%)"}}}),""),Zit=({container:i,element:t,heightFallback:e="auto",isFullScreen:n,shouldUseContainerWidth:r,widthFallback:o="auto"})=>{const s=Re.useMemo(()=>r||n?"100%":t.width||i.width||o,[i.width,t.width,n,r,o]),l=Re.useMemo(()=>n&&i.height?i.height:t.height||i.height||e,[n,t.height,i.height,e]);return{width:s,height:l}},kP=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,Yit={name:"arc",vs:kP,fs:kP,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},Qit=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Jit=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,uy=[0,0,0,255],$it={getSourcePosition:{type:"accessor",value:i=>i.sourcePosition},getTargetPosition:{type:"accessor",value:i=>i.targetPosition},getSourceColor:{type:"accessor",value:uy},getTargetColor:{type:"accessor",value:uy},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class bm extends Ps{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Qit,fs:Jit,modules:[Hs,ma,Yit]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:uy},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:uy},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:e,widthScale:n,widthMinPixels:r,widthMaxPixels:o,greatCircle:s,wrapLongitude:l,numSegments:c}=this.props,y={numSegments:c,widthUnits:Oo[e],widthScale:n,widthMinPixels:r,widthMaxPixels:o,greatCircle:s,useShortestPath:l},_=this.state.model;_.shaderInputs.setProps({arc:y}),_.setVertexCount(c*2),_.draw(this.context.renderPass)}_getModel(){return new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}bm.layerName="ArcLayer";bm.defaultProps=$it;const tnt=new Uint32Array([0,2,1,0,3,2]),ent=new Float32Array([0,1,0,0,1,0,1,1]);function int(i,t){if(!t)return nnt(i);const e=Math.max(Math.abs(i[0][0]-i[3][0]),Math.abs(i[1][0]-i[2][0])),n=Math.max(Math.abs(i[1][1]-i[0][1]),Math.abs(i[2][1]-i[3][1])),r=Math.ceil(e/t)+1,o=Math.ceil(n/t)+1,s=(r-1)*(o-1)*6,l=new Uint32Array(s),c=new Float32Array(r*o*2),y=new Float64Array(r*o*3);let _=0,C=0;for(let I=0;I<r;I++){const k=I/(r-1);for(let z=0;z<o;z++){const V=z/(o-1),X=rnt(i,k,V);y[_*3+0]=X[0],y[_*3+1]=X[1],y[_*3+2]=X[2]||0,c[_*2+0]=k,c[_*2+1]=1-V,I>0&&z>0&&(l[C++]=_-o,l[C++]=_-o-1,l[C++]=_-1,l[C++]=_-o,l[C++]=_-1,l[C++]=_),_++}}return{vertexCount:s,positions:y,indices:l,texCoords:c}}function nnt(i){const t=new Float64Array(12);for(let e=0;e<i.length;e++)t[e*3+0]=i[e][0],t[e*3+1]=i[e][1],t[e*3+2]=i[e][2]||0;return{vertexCount:6,positions:t,indices:tnt,texCoords:ent}}function rnt(i,t,e){return gl(gl(i[0],i[1],e),gl(i[3],i[2],e),t)}const OP=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,snt={name:"bitmap",vs:OP,fs:OP,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},ont=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,ant=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,lnt=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${ant}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,unt={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:nn.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class Xy extends Ps{getShaders(){return super.getShaders({vs:ont,fs:lnt,modules:[Hs,ma,snt]})}initializeState(){const t=this.getAttributeManager();t.remove(["instancePickingColors"]);const e=!0;t.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:e},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:e},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:e}})}updateState({props:t,oldProps:e,changeFlags:n}){const r=this.getAttributeManager();if(n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll()),t.bounds!==e.bounds){const o=this.state.mesh,s=this._createMesh();this.state.model.setVertexCount(s.vertexCount);for(const l in s)o&&o[l]!==s[l]&&r.invalidate(l);this.setState({mesh:s,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==e._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(t){const{image:e}=this.props,n=t.info;if(!n.color||!e)return n.bitmap=null,n;const{width:r,height:o}=e;n.index=0;const s=cnt(n.color);return n.bitmap={size:{width:r,height:o},uv:s,pixel:[Math.floor(s[0]*r),Math.floor(s[1]*o)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:t}=this.props;let e=t;return FP(t)&&(e=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),int(e,this.context.viewport.resolution)}_getModel(){return new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(t){const{shaderModuleProps:e}=t,{model:n,coordinateConversion:r,bounds:o,disablePicking:s}=this.state,{image:l,desaturate:c,transparentColor:y,tintColor:_}=this.props;if(!(e.picking.isActive&&s)&&l&&n){const C={bitmapTexture:l,bounds:o,coordinateConversion:r,desaturate:c,tintColor:_.slice(0,3).map(I=>I/255),transparentColor:y.map(I=>I/255)};n.shaderInputs.setProps({bitmap:C}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:t,CARTESIAN:e,DEFAULT:n}=nn;let{_imageCoordinateSystem:r}=this.props;if(r!==n){const{bounds:o}=this.props;if(!FP(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const s=this.context.viewport.resolution?t:e;if(r=r===t?t:e,r===t&&s===e)return{coordinateConversion:-1,bounds:o};if(r===e&&s===t){const l=$u([o[0],o[1]]),c=$u([o[2],o[3]]);return{coordinateConversion:1,bounds:[l[0],l[1],c[0],c[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}Xy.layerName="BitmapLayer";Xy.defaultProps=unt;function cnt(i){const[t,e,n]=i,r=(n&240)/256,o=(n&15)/16;return[(t+o)/256,(e+r)/256]}function FP(i){return Number.isFinite(i[0])}const NP=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,hnt={name:"icon",vs:NP,fs:NP,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},fnt=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,dnt=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,pnt=1024,Ant=4,zP=()=>{},UP={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mnt={x:0,y:0,width:0,height:0};function gnt(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function ynt(i,t,e,n){const r=Math.min(e/t.width,n/t.height),o=Math.floor(t.width*r),s=Math.floor(t.height*r);return r===1?{image:t,width:o,height:s}:(i.canvas.height=s,i.canvas.width=o,i.clearRect(0,0,o,s),i.drawImage(t,0,0,t.width,t.height,0,0,o,s),{image:i.canvas,width:o,height:s})}function hm(i){return i&&(i.id||i.url)}function vnt(i,t,e,n){const{width:r,height:o,device:s}=i,l=s.createTexture({format:"rgba8unorm",width:t,height:e,sampler:n,mipLevels:s.getMipLevelCount(t,e)}),c=s.createCommandEncoder();return c.copyTextureToTexture({sourceTexture:i,destinationTexture:l,width:r,height:o}),c.finish(),l.generateMipmapsWebGL(),i.destroy(),l}function VP(i,t,e){for(let n=0;n<t.length;n++){const{icon:r,xOffset:o}=t[n],s=hm(r);i[s]={...r,x:o,y:e}}}function _nt({icons:i,buffer:t,mapping:e={},xOffset:n=0,yOffset:r=0,rowHeight:o=0,canvasWidth:s}){let l=[];for(let c=0;c<i.length;c++){const y=i[c],_=hm(y);if(!e[_]){const{height:C,width:I}=y;n+I+t>s&&(VP(e,l,r),n=0,r=o+r+t,o=0,l=[]),l.push({icon:y,xOffset:n}),n=n+I+t,o=Math.max(o,C)}}return l.length>0&&VP(e,l,r),{mapping:e,rowHeight:o,xOffset:n,yOffset:r,canvasWidth:s,canvasHeight:gnt(o+r+t)}}function bnt(i,t,e){if(!i||!t)return null;e=e||{};const n={},{iterable:r,objectInfo:o}=fu(i);for(const s of r){o.index++;const l=t(s,o),c=hm(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!n[c]&&(!e[c]||l.url!==e[c].url)&&(n[c]={...l,source:s,sourceIndex:o.index})}return n}class xnt{constructor(t,{onUpdate:e=zP,onError:n=zP}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Ant,this._canvasWidth=pnt,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=e,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const e=this._autoPacking?hm(t):t;return this._mapping[e]||mnt}setProps({loadOptions:t,autoPacking:e,iconAtlas:n,iconMapping:r,textureParameters:o}){t&&(this._loadOptions=t),e!==void 0&&(this._autoPacking=e),r&&(this._mapping=r),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),o&&(this._samplerParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(t,e){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(bnt(t,e,this._mapping)||{});if(n.length>0){const{mapping:r,xOffset:o,yOffset:s,rowHeight:l,canvasHeight:c}=_nt({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=r,this._xOffset=o,this._yOffset=s,this._canvasHeight=c,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||UP,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=vnt(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||UP)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n),this._texture?.generateMipmapsWebGL()}}_loadIcons(t){const e=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of t)this._pendingCount++,Qu(n.url,this._loadOptions).then(r=>{const o=hm(n),s=this._mapping[o],{x:l,y:c,width:y,height:_}=s,{image:C,width:I,height:k}=ynt(e,r,y,_);this._texture?.copyExternalImage({image:C,x:l+(y-I)/2,y:c+(_-k)/2,width:I,height:k}),s.width=I,s.height=k,this._texture?.generateMipmapsWebGL(),this.onUpdate()}).catch(r=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const I8=[0,0,0,255],wnt={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:i=>i.position},getIcon:{type:"accessor",value:i=>i.icon},getColor:{type:"accessor",value:I8},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Op extends Ps{getShaders(){return super.getShaders({vs:fnt,fs:dnt,modules:[Hs,ma,hnt]})}initializeState(){this.state={iconManager:new xnt(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:I8},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:r}=t,o=this.getAttributeManager(),{iconAtlas:s,iconMapping:l,data:c,getIcon:y,textureParameters:_}=e,{iconManager:C}=this.state;if(typeof s=="string")return;const I=s||this.internalState.isAsyncPropLoading("iconAtlas");C.setProps({loadOptions:e.loadOptions,autoPacking:!I,iconAtlas:s,iconMapping:I?l:null,textureParameters:_}),I?n.iconMapping!==e.iconMapping&&o.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&C.packIcons(c,y),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeBasis:n,sizeMinPixels:r,sizeMaxPixels:o,sizeUnits:s,billboard:l,alphaCutoff:c}=this.props,{iconManager:y}=this.state,_=y.getTexture();if(_){const C=this.state.model,I={iconsTexture:_,iconsTextureDim:[_.width,_.height],sizeUnits:Oo[s],sizeScale:e,sizeBasis:n==="height"?1:0,sizeMinPixels:r,sizeMaxPixels:o,billboard:l,alphaCutoff:c};C.shaderInputs.setProps({icon:I}),C.draw(this.context.renderPass)}}_getModel(){const t=[-1,-1,1,-1,-1,1,1,1];return new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new no({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){const e=this.getCurrentLayer()?.props.onIconError;e?e(t):$i.error(t.error.message)()}getInstanceOffset(t){const{width:e,height:n,anchorX:r=e/2,anchorY:o=n/2}=this.state.iconManager.getIconMapping(t);return[e/2-r,n/2-o]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:e,y:n,width:r,height:o}=this.state.iconManager.getIconMapping(t);return[e,n,r,o]}}Op.defaultProps=wnt;Op.layerName="IconLayer";const Ent=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,GP=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,Cnt={name:"line",source:Ent,vs:GP,fs:GP,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},Tnt=`// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, color, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct ColorUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> color: ColorUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * color.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
}
`,Snt=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Pnt=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Int=[0,0,0,255],Mnt={getSourcePosition:{type:"accessor",value:i=>i.sourcePosition},getTargetPosition:{type:"accessor",value:i=>i.targetPosition},getColor:{type:"accessor",value:Int},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class qy extends Ps{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Snt,fs:Pnt,source:Tnt,modules:[Hs,Rx,ma,Cnt]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:e,widthScale:n,widthMinPixels:r,widthMaxPixels:o,wrapLongitude:s}=this.props,l=this.state.model,c={widthUnits:Oo[e],widthScale:n,widthMinPixels:r,widthMaxPixels:o,useShortestPath:s?1:0};l.shaderInputs.setProps({line:c}),l.draw(this.context.renderPass),s&&(l.shaderInputs.setProps({line:{...c,useShortestPath:-1}}),l.draw(this.context.renderPass))}_getModel(){const t=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new no({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),parameters:t,isInstanced:!0})}}qy.layerName="LineLayer";qy.defaultProps=Mnt;const Bnt=`struct PointCloudUniforms {
  radiusPixels: f32,
  sizeUnits: i32,
};

@group(0) @binding(3)
var<uniform> pointCloud: PointCloudUniforms;
`,jP=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,Rnt={name:"pointCloud",source:Bnt,vs:jP,fs:jP,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},Lnt=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Dnt=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,knt=`struct ConstantAttributes {
  instanceNormals: vec3<f32>,
  instanceColors: vec4<f32>,
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(1.0, 0.0, 0.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceNormals: vec3<f32>,
  @location(4) instanceColors: vec4<f32>,
  @location(5) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) unitPosition: vec2<f32>,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;
  
  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;
  // geometry.normal = project_normal(instanceNormals);

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  // Find the center of the point and add the current vertex
  let offset = vec3<f32>(attributes.positions.xy * project_unit_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
  // DECKGL_FILTER_SIZE(offset, geometry);

  varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
  // DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  let clipPixels = project_pixel_size_to_clipspace(offset.xy);
  varyings.position.x += clipPixels.x;
  varyings.position.y += clipPixels.y;

  // Apply lighting
  let lightColor = lighting_getLightColor2(attributes.instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);

  // Apply opacity to instance color, or return instance picking color
  varyings.vColor = vec4(lightColor, attributes.instanceColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(vColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition.xy;

  let distToCenter = length(varyings.unitPosition);
  if (distToCenter > 1.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  fragColor = varyings.vColor;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
}
`,M8=[0,0,0,255],B8=[0,0,1],Ont={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:i=>i.position},getNormal:{type:"accessor",value:B8},getColor:{type:"accessor",value:M8},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Fnt(i){const{header:t,attributes:e}=i;if(!(!t||!e)&&(i.length=t.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0)){const{size:n,value:r}=e.COLOR_0;e.instanceColors={size:n,type:"unorm8",value:r}}}class xm extends Ps{getShaders(){return super.getShaders({vs:Lnt,fs:Dnt,source:knt,modules:[Hs,Rx,By,ma,Rnt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:B8},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:M8}})}updateState(t){const{changeFlags:e,props:n}=t;super.updateState(t),e.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),e.dataChanged&&Fnt(n.data)}draw({uniforms:t}){const{pointSize:e,sizeUnits:n}=this.props,r=this.state.model,o={sizeUnits:Oo[n],radiusPixels:e};r.shaderInputs.setProps({pointCloud:o}),this.context.device.type==="webgpu"&&(r.instanceCount=this.props.data.length),r.draw(this.context.renderPass)}_getModel(){const t=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,e=[];for(let n=0;n<3;n++){const r=n/3*Math.PI*2;e.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new no({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),parameters:t,isInstanced:!0})}}xm.layerName="PointCloudLayer";xm.defaultProps=Ont;const WP=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Nnt={name:"scatterplot",vs:WP,fs:WP,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},znt=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Unt=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Vnt=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,HP=[0,0,0,255],Gnt={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:i=>i.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:HP},getLineColor:{type:"accessor",value:HP},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class wm extends Ps{getShaders(){return super.getShaders({vs:znt,fs:Unt,source:Vnt,modules:[Hs,Rx,ma,Nnt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{radiusUnits:e,radiusScale:n,radiusMinPixels:r,radiusMaxPixels:o,stroked:s,filled:l,billboard:c,antialiasing:y,lineWidthUnits:_,lineWidthScale:C,lineWidthMinPixels:I,lineWidthMaxPixels:k}=this.props,z={stroked:s,filled:l,billboard:c,antialiasing:y,radiusUnits:Oo[e],radiusScale:n,radiusMinPixels:r,radiusMaxPixels:o,lineWidthUnits:Oo[_],lineWidthScale:C,lineWidthMinPixels:I,lineWidthMaxPixels:k},V=this.state.model;V.shaderInputs.setProps({scatterplot:z}),this.context.device.type==="webgpu"&&(V.instanceCount=this.props.data.length),V.draw(this.context.renderPass)}_getModel(){const t=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new no({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0,parameters:t})}}wm.defaultProps=Gnt;wm.layerName="ScatterplotLayer";const gw={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function yw(i,t,e={}){return jnt(i,e)!==t?(Hnt(i,e),!0):!1}function jnt(i,t={}){return Math.sign(Wnt(i,t))}const XP={x:0,y:1,z:2};function Wnt(i,t={}){const{start:e=0,end:n=i.length,plane:r="xy"}=t,o=t.size||2;let s=0;const l=XP[r[0]],c=XP[r[1]];for(let y=e,_=n-o;y<n;y+=o)s+=(i[y+l]-i[_+l])*(i[y+c]+i[_+c]),_=y;return s/2}function Hnt(i,t){const{start:e=0,end:n=i.length,size:r=2}=t,o=(n-e)/r,s=Math.floor(o/2);for(let l=0;l<s;++l){const c=e+l*r,y=e+(o-1-l)*r;for(let _=0;_<r;++_){const C=i[c+_];i[c+_]=i[y+_],i[y+_]=C}}}function Al(i,t){const e=t.length,n=i.length;if(n>0){let r=!0;for(let o=0;o<e;o++)if(i[n-e+o]!==t[o]){r=!1;break}if(r)return!1}for(let r=0;r<e;r++)i[n+r]=t[r];return!0}function u2(i,t){const e=t.length;for(let n=0;n<e;n++)i[n]=t[n]}function fm(i,t,e,n,r=[]){const o=n+t*e;for(let s=0;s<e;s++)r[s]=i[o+s];return r}function c2(i,t,e,n,r=[]){let o,s;if(e&8)o=(n[3]-i[1])/(t[1]-i[1]),s=3;else if(e&4)o=(n[1]-i[1])/(t[1]-i[1]),s=1;else if(e&2)o=(n[2]-i[0])/(t[0]-i[0]),s=2;else if(e&1)o=(n[0]-i[0])/(t[0]-i[0]),s=0;else return null;for(let l=0;l<i.length;l++)r[l]=(s&1)===l?n[s]:o*(t[l]-i[l])+i[l];return r}function Cg(i,t){let e=0;return i[0]<t[0]?e|=1:i[0]>t[2]&&(e|=2),i[1]<t[1]?e|=4:i[1]>t[3]&&(e|=8),e}function R8(i,t){const{size:e=2,broken:n=!1,gridResolution:r=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:l=i.length}=t||{},c=(l-s)/e;let y=[];const _=[y],C=fm(i,0,e,s);let I,k;const z=D8(C,r,o,[]),V=[];Al(y,C);for(let X=1;X<c;X++){for(I=fm(i,X,e,s,I),k=Cg(I,z);k;){c2(C,I,k,z,V);const H=Cg(V,z);H&&(c2(C,V,H,z,V),k=H),Al(y,V),u2(C,V),qnt(z,r,k),n&&y.length>e&&(y=[],_.push(y),Al(y,C)),k=Cg(I,z)}Al(y,I),u2(C,I)}return n?_:_[0]}const qP=0,Xnt=1;function L8(i,t=null,e){if(!i.length)return[];const{size:n=2,gridResolution:r=10,gridOffset:o=[0,0],edgeTypes:s=!1}=e||{},l=[],c=[{pos:i,types:s?new Array(i.length/n).fill(Xnt):null,holes:t||[]}],y=[[],[]];let _=[];for(;c.length;){const{pos:C,types:I,holes:k}=c.shift();Knt(C,n,k[0]||C.length,y),_=D8(y[0],r,o,_);const z=Cg(y[1],_);if(z){let V=KP(C,I,n,0,k[0]||C.length,_,z);const X={pos:V[0].pos,types:V[0].types,holes:[]},H={pos:V[1].pos,types:V[1].types,holes:[]};c.push(X,H);for(let $=0;$<k.length;$++)V=KP(C,I,n,k[$],k[$+1]||C.length,_,z),V[0]&&(X.holes.push(X.pos.length),X.pos=k0(X.pos,V[0].pos),s&&(X.types=k0(X.types,V[0].types))),V[1]&&(H.holes.push(H.pos.length),H.pos=k0(H.pos,V[1].pos),s&&(H.types=k0(H.types,V[1].types)))}else{const V={positions:C};s&&(V.edgeTypes=I),k.length&&(V.holeIndices=k),l.push(V)}}return l}function KP(i,t,e,n,r,o,s){const l=(r-n)/e,c=[],y=[],_=[],C=[],I=[];let k,z,V;const X=fm(i,l-1,e,n);let H=Math.sign(s&8?X[1]-o[3]:X[0]-o[2]),$=t&&t[l-1],Y=0,ct=0;for(let rt=0;rt<l;rt++)k=fm(i,rt,e,n,k),z=Math.sign(s&8?k[1]-o[3]:k[0]-o[2]),V=t&&t[n/e+rt],z&&H&&H!==z&&(c2(X,k,s,o,I),Al(c,I)&&_.push($),Al(y,I)&&C.push($)),z<=0?(Al(c,k)&&_.push(V),Y-=z):_.length&&(_[_.length-1]=qP),z>=0?(Al(y,k)&&C.push(V),ct+=z):C.length&&(C[C.length-1]=qP),u2(X,k),H=z,$=V;return[Y?{pos:c,types:t&&_}:null,ct?{pos:y,types:t&&C}:null]}function D8(i,t,e,n){const r=Math.floor((i[0]-e[0])/t)*t+e[0],o=Math.floor((i[1]-e[1])/t)*t+e[1];return n[0]=r,n[1]=o,n[2]=r+t,n[3]=o+t,n}function qnt(i,t,e){e&8?(i[1]+=t,i[3]+=t):e&4?(i[1]-=t,i[3]-=t):e&2?(i[0]+=t,i[2]+=t):e&1&&(i[0]-=t,i[2]-=t)}function Knt(i,t,e,n){let r=1/0,o=-1/0,s=1/0,l=-1/0;for(let c=0;c<e;c+=t){const y=i[c],_=i[c+1];r=y<r?y:r,o=y>o?y:o,s=_<s?_:s,l=_>l?_:l}return n[0][0]=r,n[0][1]=s,n[1][0]=o,n[1][1]=l,n}function k0(i,t){for(let e=0;e<t.length;e++)i.push(t[e]);return i}const Znt=85.051129;function Ynt(i,t){const{size:e=2,startIndex:n=0,endIndex:r=i.length,normalize:o=!0}=t||{},s=i.slice(n,r);k8(s,e,0,r-n);const l=R8(s,{size:e,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const c of l)O8(c,e);return l}function Qnt(i,t=null,e){const{size:n=2,normalize:r=!0,edgeTypes:o=!1}=e||{};t=t||[];const s=[],l=[];let c=0,y=0;for(let C=0;C<=t.length;C++){const I=t[C]||i.length,k=y,z=Jnt(i,n,c,I);for(let V=z;V<I;V++)s[y++]=i[V];for(let V=c;V<z;V++)s[y++]=i[V];k8(s,n,k,y),$nt(s,n,k,y,e?.maxLatitude),c=I,l[C]=y}l.pop();const _=L8(s,l,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(r)for(const C of _)O8(C.positions,n);return _}function Jnt(i,t,e,n){let r=-1,o=-1;for(let s=e+1;s<n;s+=t){const l=Math.abs(i[s]);l>r&&(r=l,o=s-1)}return o}function $nt(i,t,e,n,r=Znt){const o=i[e],s=i[n-t];if(Math.abs(o-s)>180){const l=fm(i,0,t,e);l[0]+=Math.round((s-o)/360)*360,Al(i,l),l[1]=Math.sign(l[1])*r,Al(i,l),l[0]=o,Al(i,l)}}function k8(i,t,e,n){let r=i[0],o;for(let s=e;s<n;s+=t){o=i[s];const l=o-r;(l>180||l<-180)&&(o-=Math.round(l/360)*360),i[s]=r=o}}function O8(i,t){let e;const n=i.length/t;for(let o=0;o<n&&(e=i[o*t],(e+180)%360===0);o++);const r=-Math.round(e/360)*360;if(r!==0)for(let o=0;o<n;o++)i[o*t]+=r}class trt extends no{constructor(t){const{indices:e,attributes:n}=ert(t);super({...t,indices:e,attributes:n})}}function ert(i){const{radius:t,height:e=1,nradial:n=10}=i;let{vertices:r}=i;r&&($i.assert(r.length>=n),r=r.flatMap(k=>[k[0],k[1]]),yw(r,gw.COUNTER_CLOCKWISE));const o=e>0,s=n+1,l=o?s*3+1:n,c=Math.PI*2/n,y=new Uint16Array(o?n*3*2:0),_=new Float32Array(l*3),C=new Float32Array(l*3);let I=0;if(o){for(let k=0;k<s;k++){const z=k*c,V=k%n,X=Math.sin(z),H=Math.cos(z);for(let $=0;$<2;$++)_[I+0]=r?r[V*2]:H*t,_[I+1]=r?r[V*2+1]:X*t,_[I+2]=(1/2-$)*e,C[I+0]=r?r[V*2]:H,C[I+1]=r?r[V*2+1]:X,I+=3}_[I+0]=_[I-3],_[I+1]=_[I-2],_[I+2]=_[I-1],I+=3}for(let k=o?0:1;k<s;k++){const z=Math.floor(k/2)*Math.sign(.5-k%2),V=z*c,X=(z+n)%n,H=Math.sin(V),$=Math.cos(V);_[I+0]=r?r[X*2]:$*t,_[I+1]=r?r[X*2+1]:H*t,_[I+2]=e/2,C[I+2]=1,I+=3}if(o){let k=0;for(let z=0;z<n;z++)y[k++]=z*2+0,y[k++]=z*2+2,y[k++]=z*2+0,y[k++]=z*2+1,y[k++]=z*2+1,y[k++]=z*2+3}return{indices:y,attributes:{POSITION:{size:3,value:_},NORMAL:{size:3,value:C}}}}const ZP=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,irt={name:"column",vs:ZP,fs:ZP,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},nrt=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,rrt=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,cy=[0,0,0,255],srt={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:i=>i.position},getFillColor:{type:"accessor",value:cy},getLineColor:{type:"accessor",value:cy},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class du extends Ps{getShaders(){const t={},{flatShading:e}=this.props;return e&&(t.FLAT_SHADING=1),super.getShaders({vs:nrt,fs:rrt,defines:t,modules:[Hs,e?Mx:By,ma,irt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:cy},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:cy},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:r}=t,o=r.extensionsChanged||e.flatShading!==n.flatShading;o&&(this.state.models?.forEach(l=>l.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(o||e.diskResolution!==n.diskResolution||e.vertices!==n.vertices||(e.extruded||e.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(e)}getGeometry(t,e,n){const r=new trt({radius:1,height:n?2:0,vertices:e,nradial:t});let o=0;if(e)for(let s=0;s<t;s++){const l=e[s],c=Math.sqrt(l[0]*l[0]+l[1]*l[1]);o+=c/t}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*o}),r}_getModels(){const t=this.getShaders(),e=this.getAttributeManager().getBufferLayouts(),n=new Rr(this.context.device,{...t,id:`${this.props.id}-fill`,bufferLayout:e,isInstanced:!0}),r=new Rr(this.context.device,{...t,id:`${this.props.id}-wireframe`,bufferLayout:e,isInstanced:!0});return{fillModel:n,wireframeModel:r,models:[r,n]}}_updateGeometry({diskResolution:t,vertices:e,extruded:n,stroked:r}){const o=this.getGeometry(t,e,n||r);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});const s=this.state.fillModel,l=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),l.setGeometry(o),l.setTopology("line-list")}draw({uniforms:t}){const{lineWidthUnits:e,lineWidthScale:n,lineWidthMinPixels:r,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:l,extruded:c,filled:y,stroked:_,wireframe:C,offset:I,coverage:k,radius:z,angle:V}=this.props,X=this.state.fillModel,H=this.state.wireframeModel,{fillVertexCount:$,edgeDistance:Y}=this.state,ct={radius:z,angle:V/180*Math.PI,offset:I,extruded:c,stroked:_,coverage:k,elevationScale:l,edgeDistance:Y,radiusUnits:Oo[s],widthUnits:Oo[e],widthScale:n,widthMinPixels:r,widthMaxPixels:o};c&&C&&(H.shaderInputs.setProps({column:{...ct,isStroke:!0}}),H.draw(this.context.renderPass)),y&&(X.setVertexCount($),X.shaderInputs.setProps({column:{...ct,isStroke:!1}}),X.draw(this.context.renderPass)),!c&&_&&(X.setVertexCount($*2/3),X.shaderInputs.setProps({column:{...ct,isStroke:!0}}),X.draw(this.context.renderPass))}}du.layerName="ColumnLayer";du.defaultProps=srt;const ort={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};let vw=class extends du{_updateGeometry(){const i=new nL;this.state.fillModel.setGeometry(i)}draw({uniforms:i}){const{elevationScale:t,extruded:e,offset:n,coverage:r,cellSize:o,angle:s,radiusUnits:l}=this.props,c=this.state.fillModel,y={radius:o/2,radiusUnits:Oo[l],angle:s,offset:n,extruded:e,stroked:!1,coverage:r,elevationScale:t,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};c.shaderInputs.setProps({column:y}),c.draw(this.context.renderPass)}};vw.layerName="GridCellLayer";vw.defaultProps=ort;function art(i,t,e,n){let r;if(Array.isArray(i[0])){const o=i.length*t;r=new Array(o);for(let s=0;s<i.length;s++)for(let l=0;l<t;l++)r[s*t+l]=i[s][l]||0}else r=i;return e?R8(r,{size:t,gridResolution:e}):n?Ynt(r,{size:t}):r}const lrt=1,urt=2,r1=4;class crt extends DL{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?art(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(YP(t)){let n=0;for(const r of t)n+=this.getGeometrySize(r);return n}const e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(t,e){if(e.geometrySize!==0)if(t&&YP(t))for(const n of t){const r=this.getGeometrySize(n);e.geometrySize=r,this.updateGeometryAttributes(n,e),e.vertexStart+=r}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}_updateSegmentTypes(t,e){const n=this.attributes.segmentTypes,r=t?this.isClosed(t):!1,{vertexStart:o,geometrySize:s}=e;n.fill(0,o,o+s),r?(n[o]=r1,n[o+s-2]=r1):(n[o]+=lrt,n[o+s-2]+=urt),n[o+s-1]=r1}_updatePositions(t,e){const{positions:n}=this.attributes;if(!n||!t)return;const{vertexStart:r,geometrySize:o}=e,s=new Array(3);for(let l=r,c=0;c<o;l++,c++)this.getPointOnPath(t,c,s),n[l*3]=s[0],n[l*3+1]=s[1],n[l*3+2]=s[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,e,n=[]){const{positionSize:r}=this;e*r>=t.length&&(e+=1-t.length/r);const o=e*r;return n[0]=t[o],n[1]=t[o+1],n[2]=r===3&&t[o+2]||0,n}isClosed(t){if(!this.normalize)return!!this.opts.loop;const{positionSize:e}=this,n=t.length-e;return t[0]===t[n]&&t[1]===t[n+1]&&(e===2||t[2]===t[n+2])}}function YP(i){return Array.isArray(i[0])}const QP=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,hrt={name:"path",vs:QP,fs:QP,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},frt=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,drt=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,F8=[0,0,0,255],prt={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:i=>i.path},getColor:{type:"accessor",value:F8},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},s1={enter:(i,t)=>t.length?t.subarray(t.length-i.length):i};class nh extends Ps{getShaders(){return super.getShaders({vs:frt,fs:drt,modules:[Hs,ma,hrt]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:s1,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:s1,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:s1,defaultValue:F8},instancePickingColors:{size:4,type:"uint8",accessor:(t,{index:e,target:n})=>this.encodePickingColor(t&&t.__source?t.__source.index:e,n)}}),this.setState({pathTesselator:new crt({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);const{props:e,changeFlags:n}=t,r=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:o}=this.state,s=e.data.attributes||{};o.updateGeometry({data:e.data,geometryBuffer:s.getPath,buffers:s,normalize:!e._pathType,loop:e._pathType==="loop",getGeometry:e.getPath,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),n.dataChanged||r.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n}=e,r=this.props.data;return r[0]&&r[0].__source&&(e.object=r.find(o=>o.__source.index===n)),e}disablePickingIndex(t){const e=this.props.data;if(e[0]&&e[0].__source)for(let n=0;n<e.length;n++)e[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:e,capRounded:n,billboard:r,miterLimit:o,widthUnits:s,widthScale:l,widthMinPixels:c,widthMaxPixels:y}=this.props,_=this.state.model,C={jointType:Number(e),capType:Number(n),billboard:r,widthUnits:Oo[s],widthScale:l,miterLimit:o,widthMinPixels:c,widthMaxPixels:y};_.shaderInputs.setProps({path:C}),_.draw(this.context.renderPass)}_getModel(){const t=[0,1,2,1,4,2,1,3,4,3,5,4],e=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new no({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(e),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateSegmentTypes(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}}nh.defaultProps=prt;nh.layerName="PathLayer";var O0={exports:{}},JP;function Art(){if(JP)return O0.exports;JP=1,O0.exports=i,O0.exports.default=i;function i(Rt,Ft,Gt){Gt=Gt||2;var se=Ft&&Ft.length,le=se?Ft[0]*Gt:Rt.length,de=t(Rt,0,le,Gt,!0),ye=[];if(!de||de.next===de.prev)return ye;var Oe,Le,fe,_i,ei,ii,Qe;if(se&&(de=c(Rt,Ft,de,Gt)),Rt.length>80*Gt){Oe=fe=Rt[0],Le=_i=Rt[1];for(var yi=Gt;yi<le;yi+=Gt)ei=Rt[yi],ii=Rt[yi+1],ei<Oe&&(Oe=ei),ii<Le&&(Le=ii),ei>fe&&(fe=ei),ii>_i&&(_i=ii);Qe=Math.max(fe-Oe,_i-Le),Qe=Qe!==0?32767/Qe:0}return n(de,ye,Gt,Oe,Le,Qe,0),ye}function t(Rt,Ft,Gt,se,le){var de,ye;if(le===ue(Rt,Ft,Gt,se)>0)for(de=Ft;de<Gt;de+=se)ye=K(de,Rt[de],Rt[de+1],ye);else for(de=Gt-se;de>=Ft;de-=se)ye=K(de,Rt[de],Rt[de+1],ye);return ye&&ct(ye,ye.next)&&(dt(ye),ye=ye.next),ye}function e(Rt,Ft){if(!Rt)return Rt;Ft||(Ft=Rt);var Gt=Rt,se;do if(se=!1,!Gt.steiner&&(ct(Gt,Gt.next)||Y(Gt.prev,Gt,Gt.next)===0)){if(dt(Gt),Gt=Ft=Gt.prev,Gt===Gt.next)break;se=!0}else Gt=Gt.next;while(se||Gt!==Ft);return Ft}function n(Rt,Ft,Gt,se,le,de,ye){if(Rt){!ye&&de&&k(Rt,se,le,de);for(var Oe=Rt,Le,fe;Rt.prev!==Rt.next;){if(Le=Rt.prev,fe=Rt.next,de?o(Rt,se,le,de):r(Rt)){Ft.push(Le.i/Gt|0),Ft.push(Rt.i/Gt|0),Ft.push(fe.i/Gt|0),dt(Rt),Rt=fe.next,Oe=fe.next;continue}if(Rt=fe,Rt===Oe){ye?ye===1?(Rt=s(e(Rt),Ft,Gt),n(Rt,Ft,Gt,se,le,de,2)):ye===2&&l(Rt,Ft,Gt,se,le,de):n(e(Rt),Ft,Gt,se,le,de,1);break}}}}function r(Rt){var Ft=Rt.prev,Gt=Rt,se=Rt.next;if(Y(Ft,Gt,se)>=0)return!1;for(var le=Ft.x,de=Gt.x,ye=se.x,Oe=Ft.y,Le=Gt.y,fe=se.y,_i=le<de?le<ye?le:ye:de<ye?de:ye,ei=Oe<Le?Oe<fe?Oe:fe:Le<fe?Le:fe,ii=le>de?le>ye?le:ye:de>ye?de:ye,Qe=Oe>Le?Oe>fe?Oe:fe:Le>fe?Le:fe,yi=se.next;yi!==Ft;){if(yi.x>=_i&&yi.x<=ii&&yi.y>=ei&&yi.y<=Qe&&H(le,Oe,de,Le,ye,fe,yi.x,yi.y)&&Y(yi.prev,yi,yi.next)>=0)return!1;yi=yi.next}return!0}function o(Rt,Ft,Gt,se){var le=Rt.prev,de=Rt,ye=Rt.next;if(Y(le,de,ye)>=0)return!1;for(var Oe=le.x,Le=de.x,fe=ye.x,_i=le.y,ei=de.y,ii=ye.y,Qe=Oe<Le?Oe<fe?Oe:fe:Le<fe?Le:fe,yi=_i<ei?_i<ii?_i:ii:ei<ii?ei:ii,cn=Oe>Le?Oe>fe?Oe:fe:Le>fe?Le:fe,Ni=_i>ei?_i>ii?_i:ii:ei>ii?ei:ii,Pi=V(Qe,yi,Ft,Gt,se),Xn=V(cn,Ni,Ft,Gt,se),xi=Rt.prevZ,wi=Rt.nextZ;xi&&xi.z>=Pi&&wi&&wi.z<=Xn;){if(xi.x>=Qe&&xi.x<=cn&&xi.y>=yi&&xi.y<=Ni&&xi!==le&&xi!==ye&&H(Oe,_i,Le,ei,fe,ii,xi.x,xi.y)&&Y(xi.prev,xi,xi.next)>=0||(xi=xi.prevZ,wi.x>=Qe&&wi.x<=cn&&wi.y>=yi&&wi.y<=Ni&&wi!==le&&wi!==ye&&H(Oe,_i,Le,ei,fe,ii,wi.x,wi.y)&&Y(wi.prev,wi,wi.next)>=0))return!1;wi=wi.nextZ}for(;xi&&xi.z>=Pi;){if(xi.x>=Qe&&xi.x<=cn&&xi.y>=yi&&xi.y<=Ni&&xi!==le&&xi!==ye&&H(Oe,_i,Le,ei,fe,ii,xi.x,xi.y)&&Y(xi.prev,xi,xi.next)>=0)return!1;xi=xi.prevZ}for(;wi&&wi.z<=Xn;){if(wi.x>=Qe&&wi.x<=cn&&wi.y>=yi&&wi.y<=Ni&&wi!==le&&wi!==ye&&H(Oe,_i,Le,ei,fe,ii,wi.x,wi.y)&&Y(wi.prev,wi,wi.next)>=0)return!1;wi=wi.nextZ}return!0}function s(Rt,Ft,Gt){var se=Rt;do{var le=se.prev,de=se.next.next;!ct(le,de)&&rt(le,se,se.next,de)&&ft(le,de)&&ft(de,le)&&(Ft.push(le.i/Gt|0),Ft.push(se.i/Gt|0),Ft.push(de.i/Gt|0),dt(se),dt(se.next),se=Rt=de),se=se.next}while(se!==Rt);return e(se)}function l(Rt,Ft,Gt,se,le,de){var ye=Rt;do{for(var Oe=ye.next.next;Oe!==ye.prev;){if(ye.i!==Oe.i&&$(ye,Oe)){var Le=Ut(ye,Oe);ye=e(ye,ye.next),Le=e(Le,Le.next),n(ye,Ft,Gt,se,le,de,0),n(Le,Ft,Gt,se,le,de,0);return}Oe=Oe.next}ye=ye.next}while(ye!==Rt)}function c(Rt,Ft,Gt,se){var le=[],de,ye,Oe,Le,fe;for(de=0,ye=Ft.length;de<ye;de++)Oe=Ft[de]*se,Le=de<ye-1?Ft[de+1]*se:Rt.length,fe=t(Rt,Oe,Le,se,!1),fe===fe.next&&(fe.steiner=!0),le.push(X(fe));for(le.sort(y),de=0;de<le.length;de++)Gt=_(le[de],Gt);return Gt}function y(Rt,Ft){return Rt.x-Ft.x}function _(Rt,Ft){var Gt=C(Rt,Ft);if(!Gt)return Ft;var se=Ut(Gt,Rt);return e(se,se.next),e(Gt,Gt.next)}function C(Rt,Ft){var Gt=Ft,se=Rt.x,le=Rt.y,de=-1/0,ye;do{if(le<=Gt.y&&le>=Gt.next.y&&Gt.next.y!==Gt.y){var Oe=Gt.x+(le-Gt.y)*(Gt.next.x-Gt.x)/(Gt.next.y-Gt.y);if(Oe<=se&&Oe>de&&(de=Oe,ye=Gt.x<Gt.next.x?Gt:Gt.next,Oe===se))return ye}Gt=Gt.next}while(Gt!==Ft);if(!ye)return null;var Le=ye,fe=ye.x,_i=ye.y,ei=1/0,ii;Gt=ye;do se>=Gt.x&&Gt.x>=fe&&se!==Gt.x&&H(le<_i?se:de,le,fe,_i,le<_i?de:se,le,Gt.x,Gt.y)&&(ii=Math.abs(le-Gt.y)/(se-Gt.x),ft(Gt,Rt)&&(ii<ei||ii===ei&&(Gt.x>ye.x||Gt.x===ye.x&&I(ye,Gt)))&&(ye=Gt,ei=ii)),Gt=Gt.next;while(Gt!==Le);return ye}function I(Rt,Ft){return Y(Rt.prev,Rt,Ft.prev)<0&&Y(Ft.next,Rt,Rt.next)<0}function k(Rt,Ft,Gt,se){var le=Rt;do le.z===0&&(le.z=V(le.x,le.y,Ft,Gt,se)),le.prevZ=le.prev,le.nextZ=le.next,le=le.next;while(le!==Rt);le.prevZ.nextZ=null,le.prevZ=null,z(le)}function z(Rt){var Ft,Gt,se,le,de,ye,Oe,Le,fe=1;do{for(Gt=Rt,Rt=null,de=null,ye=0;Gt;){for(ye++,se=Gt,Oe=0,Ft=0;Ft<fe&&(Oe++,se=se.nextZ,!!se);Ft++);for(Le=fe;Oe>0||Le>0&&se;)Oe!==0&&(Le===0||!se||Gt.z<=se.z)?(le=Gt,Gt=Gt.nextZ,Oe--):(le=se,se=se.nextZ,Le--),de?de.nextZ=le:Rt=le,le.prevZ=de,de=le;Gt=se}de.nextZ=null,fe*=2}while(ye>1);return Rt}function V(Rt,Ft,Gt,se,le){return Rt=(Rt-Gt)*le|0,Ft=(Ft-se)*le|0,Rt=(Rt|Rt<<8)&16711935,Rt=(Rt|Rt<<4)&252645135,Rt=(Rt|Rt<<2)&858993459,Rt=(Rt|Rt<<1)&1431655765,Ft=(Ft|Ft<<8)&16711935,Ft=(Ft|Ft<<4)&252645135,Ft=(Ft|Ft<<2)&858993459,Ft=(Ft|Ft<<1)&1431655765,Rt|Ft<<1}function X(Rt){var Ft=Rt,Gt=Rt;do(Ft.x<Gt.x||Ft.x===Gt.x&&Ft.y<Gt.y)&&(Gt=Ft),Ft=Ft.next;while(Ft!==Rt);return Gt}function H(Rt,Ft,Gt,se,le,de,ye,Oe){return(le-ye)*(Ft-Oe)>=(Rt-ye)*(de-Oe)&&(Rt-ye)*(se-Oe)>=(Gt-ye)*(Ft-Oe)&&(Gt-ye)*(de-Oe)>=(le-ye)*(se-Oe)}function $(Rt,Ft){return Rt.next.i!==Ft.i&&Rt.prev.i!==Ft.i&&!Kt(Rt,Ft)&&(ft(Rt,Ft)&&ft(Ft,Rt)&&st(Rt,Ft)&&(Y(Rt.prev,Rt,Ft.prev)||Y(Rt,Ft.prev,Ft))||ct(Rt,Ft)&&Y(Rt.prev,Rt,Rt.next)>0&&Y(Ft.prev,Ft,Ft.next)>0)}function Y(Rt,Ft,Gt){return(Ft.y-Rt.y)*(Gt.x-Ft.x)-(Ft.x-Rt.x)*(Gt.y-Ft.y)}function ct(Rt,Ft){return Rt.x===Ft.x&&Rt.y===Ft.y}function rt(Rt,Ft,Gt,se){var le=Ot(Y(Rt,Ft,Gt)),de=Ot(Y(Rt,Ft,se)),ye=Ot(Y(Gt,se,Rt)),Oe=Ot(Y(Gt,se,Ft));return!!(le!==de&&ye!==Oe||le===0&&nt(Rt,Gt,Ft)||de===0&&nt(Rt,se,Ft)||ye===0&&nt(Gt,Rt,se)||Oe===0&&nt(Gt,Ft,se))}function nt(Rt,Ft,Gt){return Ft.x<=Math.max(Rt.x,Gt.x)&&Ft.x>=Math.min(Rt.x,Gt.x)&&Ft.y<=Math.max(Rt.y,Gt.y)&&Ft.y>=Math.min(Rt.y,Gt.y)}function Ot(Rt){return Rt>0?1:Rt<0?-1:0}function Kt(Rt,Ft){var Gt=Rt;do{if(Gt.i!==Rt.i&&Gt.next.i!==Rt.i&&Gt.i!==Ft.i&&Gt.next.i!==Ft.i&&rt(Gt,Gt.next,Rt,Ft))return!0;Gt=Gt.next}while(Gt!==Rt);return!1}function ft(Rt,Ft){return Y(Rt.prev,Rt,Rt.next)<0?Y(Rt,Ft,Rt.next)>=0&&Y(Rt,Rt.prev,Ft)>=0:Y(Rt,Ft,Rt.prev)<0||Y(Rt,Rt.next,Ft)<0}function st(Rt,Ft){var Gt=Rt,se=!1,le=(Rt.x+Ft.x)/2,de=(Rt.y+Ft.y)/2;do Gt.y>de!=Gt.next.y>de&&Gt.next.y!==Gt.y&&le<(Gt.next.x-Gt.x)*(de-Gt.y)/(Gt.next.y-Gt.y)+Gt.x&&(se=!se),Gt=Gt.next;while(Gt!==Rt);return se}function Ut(Rt,Ft){var Gt=new Tt(Rt.i,Rt.x,Rt.y),se=new Tt(Ft.i,Ft.x,Ft.y),le=Rt.next,de=Ft.prev;return Rt.next=Ft,Ft.prev=Rt,Gt.next=le,le.prev=Gt,se.next=Gt,Gt.prev=se,de.next=se,se.prev=de,se}function K(Rt,Ft,Gt,se){var le=new Tt(Rt,Ft,Gt);return se?(le.next=se.next,le.prev=se,se.next.prev=le,se.next=le):(le.prev=le,le.next=le),le}function dt(Rt){Rt.next.prev=Rt.prev,Rt.prev.next=Rt.next,Rt.prevZ&&(Rt.prevZ.nextZ=Rt.nextZ),Rt.nextZ&&(Rt.nextZ.prevZ=Rt.prevZ)}function Tt(Rt,Ft,Gt){this.i=Rt,this.x=Ft,this.y=Gt,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(Rt,Ft,Gt,se){var le=Ft&&Ft.length,de=le?Ft[0]*Gt:Rt.length,ye=Math.abs(ue(Rt,0,de,Gt));if(le)for(var Oe=0,Le=Ft.length;Oe<Le;Oe++){var fe=Ft[Oe]*Gt,_i=Oe<Le-1?Ft[Oe+1]*Gt:Rt.length;ye-=Math.abs(ue(Rt,fe,_i,Gt))}var ei=0;for(Oe=0;Oe<se.length;Oe+=3){var ii=se[Oe]*Gt,Qe=se[Oe+1]*Gt,yi=se[Oe+2]*Gt;ei+=Math.abs((Rt[ii]-Rt[yi])*(Rt[Qe+1]-Rt[ii+1])-(Rt[ii]-Rt[Qe])*(Rt[yi+1]-Rt[ii+1]))}return ye===0&&ei===0?0:Math.abs((ei-ye)/ye)};function ue(Rt,Ft,Gt,se){for(var le=0,de=Ft,ye=Gt-se;de<Gt;de+=se)le+=(Rt[ye]-Rt[de])*(Rt[de+1]+Rt[ye+1]),ye=de;return le}return i.flatten=function(Rt){for(var Ft=Rt[0][0].length,Gt={vertices:[],holes:[],dimensions:Ft},se=0,le=0;le<Rt.length;le++){for(var de=0;de<Rt[le].length;de++)for(var ye=0;ye<Ft;ye++)Gt.vertices.push(Rt[le][de][ye]);le>0&&(se+=Rt[le-1].length,Gt.holes.push(se))}return Gt},O0.exports}var mrt=Art();const N8=df(mrt),F0=gw.CLOCKWISE,$P=gw.COUNTER_CLOCKWISE,Hc={};function grt(i){if(i=i&&i.positions||i,!Array.isArray(i)&&!ArrayBuffer.isView(i))throw new Error("invalid polygon")}function DA(i){return"positions"in i?i.positions:i}function Tg(i){return"holeIndices"in i?i.holeIndices:null}function yrt(i){return Array.isArray(i[0])}function vrt(i){return i.length>=1&&i[0].length>=2&&Number.isFinite(i[0][0])}function _rt(i){const t=i[0],e=i[i.length-1];return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function brt(i,t,e,n){for(let r=0;r<t;r++)if(i[e+r]!==i[n-t+r])return!1;return!0}function tI(i,t,e,n,r){let o=t;const s=e.length;for(let l=0;l<s;l++)for(let c=0;c<n;c++)i[o++]=e[l][c]||0;if(!_rt(e))for(let l=0;l<n;l++)i[o++]=e[0][l]||0;return Hc.start=t,Hc.end=o,Hc.size=n,yw(i,r,Hc),o}function eI(i,t,e,n,r=0,o,s){o=o||e.length;const l=o-r;if(l<=0)return t;let c=t;for(let y=0;y<l;y++)i[c++]=e[r+y];if(!brt(e,n,r,o))for(let y=0;y<n;y++)i[c++]=e[r+y];return Hc.start=t,Hc.end=c,Hc.size=n,yw(i,s,Hc),c}function z8(i,t){grt(i);const e=[],n=[];if("positions"in i){const{positions:r,holeIndices:o}=i;if(o){let s=0;for(let l=0;l<=o.length;l++)s=eI(e,s,r,t,o[l-1],o[l],l===0?F0:$P),n.push(s);return n.pop(),{positions:e,holeIndices:n}}i=r}if(!yrt(i))return eI(e,0,i,t,0,e.length,F0),e;if(!vrt(i)){let r=0;for(const[o,s]of i.entries())r=tI(e,r,s,t,o===0?F0:$P),n.push(r);return n.pop(),{positions:e,holeIndices:n}}return tI(e,0,i,t,F0),e}function o1(i,t,e){const n=i.length/3;let r=0;for(let o=0;o<n;o++){const s=(o+1)%n;r+=i[o*3+t]*i[s*3+e],r-=i[s*3+t]*i[o*3+e]}return Math.abs(r/2)}function iI(i,t,e,n){const r=i.length/3;for(let o=0;o<r;o++){const s=o*3,l=i[s+0],c=i[s+1],y=i[s+2];i[s+t]=l,i[s+e]=c,i[s+n]=y}}function xrt(i,t,e,n){let r=Tg(i);r&&(r=r.map(l=>l/t));let o=DA(i);const s=n&&t===3;if(e){const l=o.length;o=o.slice();const c=[];for(let y=0;y<l;y+=t){c[0]=o[y],c[1]=o[y+1],s&&(c[2]=o[y+2]);const _=e(c);o[y]=_[0],o[y+1]=_[1],s&&(o[y+2]=_[2])}}if(s){const l=o1(o,0,1),c=o1(o,0,2),y=o1(o,1,2);if(!l&&!c&&!y)return[];l>c&&l>y||(c>y?(e||(o=o.slice()),iI(o,0,2,1)):(e||(o=o.slice()),iI(o,2,0,1)))}return N8(o,r,t)}class wrt extends DL{constructor(t){const{fp64:e,IndexType:n=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:e?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(t){const{attributes:e}=this;return t==="indices"?e.indices&&e.indices.subarray(0,this.vertexCount):e[t]}updateGeometry(t){super.updateGeometry(t);const e=this.buffers.indices;if(e)this.vertexCount=(e.value||e).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){const e=z8(t,this.positionSize);return this.opts.resolution?L8(DA(e),Tg(e),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Qnt(DA(e),Tg(e),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):e}return t}getGeometrySize(t){if(nI(t)){let e=0;for(const n of t)e+=this.getGeometrySize(n);return e}return DA(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,e){if(t&&nI(t))for(const n of t){const r=this.getGeometrySize(n);e.geometrySize=r,this.updateGeometryAttributes(n,e),e.vertexStart+=r,e.indexStart=this.indexStarts[e.geometryIndex+1]}else{const n=t;this._updateIndices(n,e),this._updatePositions(n,e),this._updateVertexValid(n,e)}}_updateIndices(t,{geometryIndex:e,vertexStart:n,indexStart:r}){const{attributes:o,indexStarts:s,typedArrayManager:l}=this;let c=o.indices;if(!c||!t)return;let y=r;const _=xrt(t,this.positionSize,this.opts.preproject,this.opts.full3d);c=l.allocate(c,r+_.length,{copy:!0});for(let C=0;C<_.length;C++)c[y++]=_[C]+n;s[e+1]=r+_.length,o.indices=c}_updatePositions(t,{vertexStart:e,geometrySize:n}){const{attributes:{positions:r},positionSize:o}=this;if(!r||!t)return;const s=DA(t);for(let l=e,c=0;c<n;l++,c++){const y=s[c*o],_=s[c*o+1],C=o>2?s[c*o+2]:0;r[l*3]=y,r[l*3+1]=_,r[l*3+2]=C}}_updateVertexValid(t,{vertexStart:e,geometrySize:n}){const{positionSize:r}=this,o=this.attributes.vertexValid,s=t&&Tg(t);if(t&&t.edgeTypes?o.set(t.edgeTypes,e):o.fill(1,e,e+n),s)for(let l=0;l<s.length;l++)o[e+s[l]/r-1]=0;o[e+n-1]=0}}function nI(i){return Array.isArray(i)&&i.length>0&&!Number.isFinite(i[0])}const rI=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,Ert={name:"solidPolygon",vs:rI,fs:rI,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},U8=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Crt=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${U8}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Trt=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${U8}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Srt=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,hy=[0,0,0,255],Prt={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:i=>i.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:hy},getLineColor:{type:"accessor",value:hy},material:!0},N0={enter:(i,t)=>t.length?t.subarray(t.length-i.length):i};class rh extends Ps{getShaders(t){return super.getShaders({vs:t==="top"?Crt:Trt,fs:Srt,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Hs,By,ma,Ert]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:t}=this.context;let{coordinateSystem:e}=this.props;const{_full3d:n}=this.props;t.isGeospatial&&e===nn.DEFAULT&&(e=nn.LNGLAT);let r;e===nn.LNGLAT&&(n?r=t.projectPosition.bind(t):r=t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new wrt({preproject:r,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),s=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:N0,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:N0,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:N0,accessor:"getFillColor",defaultValue:hy},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:N0,accessor:"getLineColor",defaultValue:hy},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(l,{index:c,target:y})=>this.encodePickingColor(l&&l.__source?l.__source.index:c,y)}})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n}=e,r=this.props.data;return r[0]&&r[0].__source&&(e.object=r.find(o=>o.__source.index===n)),e}disablePickingIndex(t){const e=this.props.data;if(e[0]&&e[0].__source)for(let n=0;n<e.length;n++)e[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{extruded:e,filled:n,wireframe:r,elevationScale:o}=this.props,{topModel:s,sideModel:l,wireframeModel:c,polygonTesselator:y}=this.state,_={extruded:!!e,elevationScale:o,isWireframe:!1};c&&r&&(c.setInstanceCount(y.instanceCount-1),c.shaderInputs.setProps({solidPolygon:{..._,isWireframe:!0}}),c.draw(this.context.renderPass)),l&&n&&(l.setInstanceCount(y.instanceCount-1),l.shaderInputs.setProps({solidPolygon:_}),l.draw(this.context.renderPass)),s&&n&&(s.setVertexCount(y.vertexCount),s.shaderInputs.setProps({solidPolygon:_}),s.draw(this.context.renderPass))}updateState(t){super.updateState(t),this.updateGeometry(t);const{props:e,oldProps:n,changeFlags:r}=t,o=this.getAttributeManager();(r.extensionsChanged||e.filled!==n.filled||e.extruded!==n.extruded)&&(this.state.models?.forEach(s=>s.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:t,oldProps:e,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:r}=this.state,o=t.data.attributes||{};r.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:t._full3d}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:t,filled:e,extruded:n}=this.props;let r,o,s;if(e){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1;const c=this.getAttributeManager().getBufferLayouts({isInstanced:!1});r=new Rr(this.context.device,{...l,id:`${t}-top`,topology:"triangle-list",bufferLayout:c,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const l=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new Rr(this.context.device,{...this.getShaders("side"),id:`${t}-side`,bufferLayout:l,geometry:new no({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new Rr(this.context.device,{...this.getShaders("side"),id:`${t}-wireframe`,bufferLayout:l,geometry:new no({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,s,r].filter(Boolean),topModel:r,sideModel:o,wireframeModel:s}}calculateIndices(t){const{polygonTesselator:e}=this.state;t.startIndices=e.indexStarts,t.value=e.get("indices")}calculatePositions(t){const{polygonTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}rh.defaultProps=Prt;rh.layerName="SolidPolygonLayer";function V8({data:i,getIndex:t,dataRange:e,replace:n}){const{startRow:r=0,endRow:o=1/0}=e,s=i.length;let l=s,c=s;for(let C=0;C<s;C++){const I=t(i[C]);if(l>C&&I>=r&&(l=C),I>=o){c=C;break}}let y=l;const _=c-l!==n.length?i.slice(c):void 0;for(let C=0;C<n.length;C++)i[y++]=n[C];if(_){for(let C=0;C<_.length;C++)i[y++]=_[C];i.length=y}return{startRow:l,endRow:l+n.length}}const G8=[0,0,0,255],Irt=[0,0,0,255],Mrt={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:i=>i.polygon},getFillColor:{type:"accessor",value:Irt},getLineColor:{type:"accessor",value:G8},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class sh extends Is{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&$i.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:t}){const e=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getPolygon);if(e&&Array.isArray(t.dataChanged)){const n=this.state.paths.slice(),r=t.dataChanged.map(o=>V8({data:n,getIndex:s=>s.__source.index,dataRange:o,replace:this._getPaths(o)}));this.setState({paths:n,pathsDiff:r})}else e&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(t={}){const{data:e,getPolygon:n,positionFormat:r,_normalize:o}=this.props,s=[],l=r==="XY"?2:3,{startRow:c,endRow:y}=t,{iterable:_,objectInfo:C}=fu(e,c,y);for(const I of _){C.index++;let k=n(I,C);o&&(k=z8(k,l));const{holeIndices:z}=k,V=k.positions||k;if(z)for(let X=0;X<=z.length;X++){const H=V.slice(z[X-1]||0,z[X]||V.length);s.push(this.getSubLayerRow({path:H},I,C.index))}else s.push(this.getSubLayerRow({path:V},I,C.index))}return s}renderLayers(){const{data:t,_dataDiff:e,stroked:n,filled:r,extruded:o,wireframe:s,_normalize:l,_windingOrder:c,elevationScale:y,transitions:_,positionFormat:C}=this.props,{lineWidthUnits:I,lineWidthScale:k,lineWidthMinPixels:z,lineWidthMaxPixels:V,lineJointRounded:X,lineMiterLimit:H,lineDashJustified:$}=this.props,{getFillColor:Y,getLineColor:ct,getLineWidth:rt,getLineDashArray:nt,getElevation:Ot,getPolygon:Kt,updateTriggers:ft,material:st}=this.props,{paths:Ut,pathsDiff:K}=this.state,dt=this.getSubLayerClass("fill",rh),Tt=this.getSubLayerClass("stroke",nh),ue=this.shouldRenderSubLayer("fill",Ut)&&new dt({_dataDiff:e,extruded:o,elevationScale:y,filled:r,wireframe:s,_normalize:l,_windingOrder:c,getElevation:Ot,getFillColor:Y,getLineColor:o&&s?ct:G8,material:st,transitions:_},this.getSubLayerProps({id:"fill",updateTriggers:ft&&{getPolygon:ft.getPolygon,getElevation:ft.getElevation,getFillColor:ft.getFillColor,lineColors:o&&s,getLineColor:ft.getLineColor}}),{data:t,positionFormat:C,getPolygon:Kt}),Rt=!o&&n&&this.shouldRenderSubLayer("stroke",Ut)&&new Tt({_dataDiff:K&&(()=>K),widthUnits:I,widthScale:k,widthMinPixels:z,widthMaxPixels:V,jointRounded:X,miterLimit:H,dashJustified:$,_pathType:"loop",transitions:_&&{getWidth:_.getLineWidth,getColor:_.getLineColor,getPath:_.getPolygon},getColor:this.getSubLayerAccessor(ct),getWidth:this.getSubLayerAccessor(rt),getDashArray:this.getSubLayerAccessor(nt)},this.getSubLayerProps({id:"stroke",updateTriggers:ft&&{getWidth:ft.getLineWidth,getColor:ft.getLineColor,getDashArray:ft.getLineDashArray}}),{data:Ut,positionFormat:C,getPath:Ft=>Ft.path});return[!o&&ue,Rt,o&&ue]}}sh.layerName="PolygonLayer";sh.defaultProps=Mrt;function Brt(i,t){if(!i)return null;const e="startIndices"in i?i.startIndices[t]:t,n=i.featureIds.value[e];return e!==-1?Rrt(i,n,e):null}function Rrt(i,t,e){const n={properties:{...i.properties[t]}};for(const r in i.numericProps)n.properties[r]=i.numericProps[r].value[e];return n}function Lrt(i,t){const e={points:null,lines:null,polygons:null};for(const n in e){const r=i[n].globalFeatureIds.value;e[n]=new Uint8ClampedArray(r.length*4);const o=[];for(let s=0;s<r.length;s++)t(r[s],o),e[n][s*4+0]=o[0],e[n][s*4+1]=o[1],e[n][s*4+2]=o[2],e[n][s*4+3]=255}return e}const sI=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,Drt={name:"sdf",vs:sI,fs:sI,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},krt=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,a1=192/256,oI=[],Ort={getIconOffsets:{type:"accessor",value:i=>i.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Ky extends Op{getShaders(){const t=super.getShaders();return{...t,modules:[...t.modules,Drt],fs:krt}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:e,target:n})=>this.encodePickingColor(e,n)}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;let{outlineColor:r}=e;r!==n.outlineColor&&(r=r.map(o=>o/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!e.sdf&&e.outlineWidth&&$i.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){const{sdf:e,smoothing:n,outlineWidth:r}=this.props,{outlineColor:o}=this.state,s=r?Math.max(n,a1*(1-r)):-1,l=this.state.model,c={buffer:a1,outlineBuffer:s,gamma:n,enabled:!!e,outlineColor:o};if(l.shaderInputs.setProps({sdf:c}),super.draw(t),e&&r){const{iconManager:y}=this.state;y.getTexture()&&(l.shaderInputs.setProps({sdf:{...c,outlineBuffer:a1}}),l.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(e=>super.getInstanceOffset(e)):oI}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(e=>super.getInstanceIconFrame(e)):oI}}Ky.defaultProps=Ort;Ky.layerName="MultiIconLayer";const ZA=1e20;class Frt{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:r=.25,fontFamily:o="sans-serif",fontWeight:s="normal",fontStyle:l="normal",lang:c=null}={}){this.buffer=e,this.cutoff=r,this.radius=n,this.lang=c;const y=this.size=t+e*4,_=this._createCanvas(y),C=this.ctx=_.getContext("2d",{willReadFrequently:!0});C.font=`${l} ${s} ${t}px ${o}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:o,actualBoundingBoxRight:s}=this.ctx.measureText(t),l=Math.ceil(n),c=0,y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-o))),_=Math.min(this.size-this.buffer,l+Math.ceil(r)),C=y+2*this.buffer,I=_+2*this.buffer,k=Math.max(C*I,0),z=new Uint8ClampedArray(k),V={data:z,width:C,height:I,glyphWidth:y,glyphHeight:_,glyphTop:l,glyphLeft:c,glyphAdvance:e};if(y===0||_===0)return V;const{ctx:X,buffer:H,gridInner:$,gridOuter:Y}=this;this.lang&&(X.lang=this.lang),X.clearRect(H,H,y,_),X.fillText(t,H,H+l);const ct=X.getImageData(H,H,y,_);Y.fill(ZA,0,k),$.fill(0,0,k);for(let rt=0;rt<_;rt++)for(let nt=0;nt<y;nt++){const Ot=ct.data[4*(rt*y+nt)+3]/255;if(Ot===0)continue;const Kt=(rt+H)*C+nt+H;if(Ot===1)Y[Kt]=0,$[Kt]=ZA;else{const ft=.5-Ot;Y[Kt]=ft>0?ft*ft:0,$[Kt]=ft<0?ft*ft:0}}aI(Y,0,0,C,I,C,this.f,this.v,this.z),aI($,H,H,y,_,C,this.f,this.v,this.z);for(let rt=0;rt<k;rt++){const nt=Math.sqrt(Y[rt])-Math.sqrt($[rt]);z[rt]=Math.round(255-255*(nt/this.radius+this.cutoff))}return V}}function aI(i,t,e,n,r,o,s,l,c){for(let y=t;y<t+n;y++)lI(i,e*o+y,o,r,s,l,c);for(let y=e;y<e+r;y++)lI(i,y*o+t,1,n,s,l,c)}function lI(i,t,e,n,r,o,s){o[0]=0,s[0]=-ZA,s[1]=ZA,r[0]=i[t];for(let l=1,c=0,y=0;l<n;l++){r[l]=i[t+l*e];const _=l*l;do{const C=o[c];y=(r[l]-r[C]+_-C*C)/(l-C)/2}while(y<=s[c]&&--c>-1);c++,o[c]=l,s[c]=y,s[c+1]=ZA}for(let l=0,c=0;l<n;l++){for(;s[c+1]<l;)c++;const y=o[c],_=l-y;i[t+l*e]=r[y]+_*_}}const Nrt=32,zrt=[];function Urt(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function Vrt({characterSet:i,getFontWidth:t,fontHeight:e,buffer:n,maxCanvasWidth:r,mapping:o={},xOffset:s=0,yOffset:l=0}){let c=0,y=s;const _=e+n*2;for(const C of i)if(!o[C]){const I=t(C);y+I+n*2>r&&(y=0,c++),o[C]={x:y+n,y:l+c*_+n,width:I,height:_,layoutWidth:I,layoutHeight:e},y+=I+n*2}return{mapping:o,xOffset:y,yOffset:l+c*_,canvasHeight:Urt(l+(c+1)*_)}}function j8(i,t,e,n){let r=0;for(let o=t;o<e;o++){const s=i[o];r+=n[s]?.layoutWidth||0}return r}function W8(i,t,e,n,r,o){let s=t,l=0;for(let c=t;c<e;c++){const y=j8(i,c,c+1,r);l+y>n&&(s<c&&o.push(c),s=c,l=0),l+=y}return l}function Grt(i,t,e,n,r,o){let s=t,l=t,c=t,y=0;for(let _=t;_<e;_++)if((i[_]===" "||i[_+1]===" "||_+1===e)&&(c=_+1),c>l){let C=j8(i,l,c,r);y+C>n&&(s<l&&(o.push(l),s=l,y=0),C>n&&(C=W8(i,l,c,n,r,o),s=o[o.length-1])),l=c,y+=C}return y}function jrt(i,t,e,n,r=0,o){o===void 0&&(o=i.length);const s=[];return t==="break-all"?W8(i,r,o,e,n,s):Grt(i,r,o,e,n,s),s}function Wrt(i,t,e,n,r,o){let s=0,l=0;for(let c=t;c<e;c++){const y=i[c],_=n[y];_?(l||(l=_.layoutHeight),r[c]=s+_.layoutWidth/2,s+=_.layoutWidth):($i.warn(`Missing character: ${y} (${y.codePointAt(0)})`)(),r[c]=s,s+=Nrt)}o[0]=s,o[1]=l}function Hrt(i,t,e,n,r){const o=Array.from(i),s=o.length,l=new Array(s),c=new Array(s),y=new Array(s),_=(e==="break-word"||e==="break-all")&&isFinite(n)&&n>0,C=[0,0],I=[0,0];let k=0,z=0,V=0;for(let X=0;X<=s;X++){const H=o[X];if((H===`
`||X===s)&&(V=X),V>z){const $=_?jrt(o,e,n,r,z,V):zrt;for(let Y=0;Y<=$.length;Y++){const ct=Y===0?z:$[Y-1],rt=Y<$.length?$[Y]:V;Wrt(o,ct,rt,r,l,I);for(let nt=ct;nt<rt;nt++){const Ot=o[nt],Kt=r[Ot]?.layoutOffsetY||0;c[nt]=k+I[1]/2+Kt,y[nt]=I[0]}k=k+I[1]*t,C[0]=Math.max(C[0],I[0])}z=V}H===`
`&&(l[z]=0,c[z]=0,y[z]=0,z++)}return C[1]=k,{x:l,y:c,rowWidth:y,size:C}}function Xrt({value:i,length:t,stride:e,offset:n,startIndices:r,characterSet:o}){const s=i.BYTES_PER_ELEMENT,l=e?e/s:1,c=n?n/s:0,y=r[t]||Math.ceil((i.length-c)/l),_=o&&new Set,C=new Array(t);let I=i;if(l>1||c>0){const k=i.constructor;I=new k(y);for(let z=0;z<y;z++)I[z]=i[z*l+c]}for(let k=0;k<t;k++){const z=r[k],V=r[k+1]||y,X=I.subarray(z,V);C[k]=String.fromCodePoint.apply(null,X),_&&X.forEach(_.add,_)}if(_)for(const k of _)o.add(String.fromCodePoint(k));return{texts:C,characterCount:y}}class H8{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){const e=this._cache[t];return e&&(this._deleteOrder(t),this._appendOrder(t)),e}set(t,e){this._cache[t]?(this.delete(t),this._cache[t]=e,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=e,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const e=this._order.indexOf(t);e>=0&&this._order.splice(e,1)}_appendOrder(t){this._order.push(t)}}function qrt(){const i=[];for(let t=32;t<128;t++)i.push(String.fromCharCode(t));return i}const cp={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:qrt(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},uI=1024,cI=.9,hI=1.2,X8=3;let fy=new H8(X8);function Krt(i,t){let e;typeof t=="string"?e=new Set(Array.from(t)):e=new Set(t);const n=fy.get(i);if(!n)return e;for(const r in n.mapping)e.has(r)&&e.delete(r);return e}function Zrt(i,t){for(let e=0;e<i.length;e++)t.data[4*e+3]=i[e]}function fI(i,t,e,n){i.font=`${n} ${e}px ${t}`,i.fillStyle="#000",i.textBaseline="alphabetic",i.textAlign="left"}function Yrt(i){$i.assert(Number.isFinite(i)&&i>=X8,"Invalid cache limit"),fy=new H8(i)}class Qrt{constructor(){this.props={...cp}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:t,buffer:e}=this.props;return(t*hI+e*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();const e=Krt(this._key,this.props.characterSet),n=fy.get(this._key);if(n&&e.size===0){this._atlas!==n&&(this._atlas=n);return}const r=this._generateFontAtlas(e,n);this._atlas=r,fy.set(this._key,r)}_generateFontAtlas(t,e){const{fontFamily:n,fontWeight:r,fontSize:o,buffer:s,sdf:l,radius:c,cutoff:y}=this.props;let _=e&&e.data;_||(_=document.createElement("canvas"),_.width=uI);const C=_.getContext("2d",{willReadFrequently:!0});fI(C,n,o,r);const{mapping:I,canvasHeight:k,xOffset:z,yOffset:V}=Vrt({getFontWidth:X=>C.measureText(X).width,fontHeight:o*hI,buffer:s,characterSet:t,maxCanvasWidth:uI,...e&&{mapping:e.mapping,xOffset:e.xOffset,yOffset:e.yOffset}});if(_.height!==k){const X=C.getImageData(0,0,_.width,_.height);_.height=k,C.putImageData(X,0,0)}if(fI(C,n,o,r),l){const X=new Frt({fontSize:o,buffer:s,radius:c,cutoff:y,fontFamily:n,fontWeight:`${r}`});for(const H of t){const{data:$,width:Y,height:ct,glyphTop:rt}=X.draw(H);I[H].width=Y,I[H].layoutOffsetY=o*cI-rt;const nt=C.createImageData(Y,ct);Zrt($,nt),C.putImageData(nt,I[H].x,I[H].y)}}else for(const X of t)C.fillText(X,I[X].x,I[X].y+s+o*cI);return{xOffset:z,yOffset:V,mapping:I,data:_,width:_.width,height:_.height}}_getKey(){const{fontFamily:t,fontWeight:e,fontSize:n,buffer:r,sdf:o,radius:s,cutoff:l}=this.props;return o?`${t} ${e} ${n} ${r} ${s} ${l}`:`${t} ${e} ${n} ${r}`}}const dI=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,Jrt={name:"textBackground",vs:dI,fs:dI,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},$rt=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,tst=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,est={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:i=>i.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Em extends Ps{getShaders(){return super.getShaders({vs:$rt,fs:tst,modules:[Hs,ma,Jrt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t);const{changeFlags:e}=t;e.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{billboard:e,sizeScale:n,sizeUnits:r,sizeMinPixels:o,sizeMaxPixels:s,getLineWidth:l}=this.props;let{padding:c,borderRadius:y}=this.props;c.length<4&&(c=[c[0],c[1],c[0],c[1]]),Array.isArray(y)||(y=[y,y,y,y]);const _=this.state.model,C={billboard:e,stroked:!!l,borderRadius:y,padding:c,sizeUnits:Oo[r],sizeScale:n,sizeMinPixels:o,sizeMaxPixels:s};_.shaderInputs.setProps({textBackground:C}),_.draw(this.context.renderPass)}_getModel(){const t=[0,0,1,0,0,1,1,1];return new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new no({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}Em.defaultProps=est;Em.layerName="TextBackgroundLayer";const pI={start:1,middle:0,end:-1},AI={top:1,center:0,bottom:-1},l1=[0,0,0,255],ist=1,nst={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:l1},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:cp.characterSet},fontFamily:cp.fontFamily,fontWeight:cp.fontWeight,lineHeight:ist,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:l1},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:i=>i.text},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:l1},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class vf extends Is{constructor(){super(...arguments),this.getBoundingRect=(t,e)=>{let{size:[n,r]}=this.transformParagraph(t,e);const{fontSize:o}=this.state.fontAtlasManager.props;n/=o,r/=o;const{getTextAnchor:s,getAlignmentBaseline:l}=this.props,c=pI[typeof s=="function"?s(t,e):s],y=AI[typeof l=="function"?l(t,e):l];return[(c-1)*n/2,(y-1)*r/2,n,r]},this.getIconOffsets=(t,e)=>{const{getTextAnchor:n,getAlignmentBaseline:r}=this.props,{x:o,y:s,rowWidth:l,size:[c,y]}=this.transformParagraph(t,e),_=pI[typeof n=="function"?n(t,e):n],C=AI[typeof r=="function"?r(t,e):r],I=o.length,k=new Array(I*2);let z=0;for(let V=0;V<I;V++){const X=(1-_)*(c-l[V])/2;k[z++]=(_-1)*c/2+X+o[V],k[z++]=(C-1)*y/2+s[V]}return k}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Qrt},this.props.maxWidth>0&&$i.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){const{props:e,oldProps:n,changeFlags:r}=t;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||e.lineHeight!==n.lineHeight||e.wordBreak!==n.wordBreak||e.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:e,fontWeight:n}=this.props,{fontAtlasManager:r,characterSet:o}=this.state,s={...t,characterSet:o,fontFamily:e,fontWeight:n};if(!r.mapping)return r.setProps(s),!0;for(const l in s)if(s[l]!==r.props[l])return r.setProps(s),!0;return!1}_updateText(){const{data:t,characterSet:e}=this.props,n=t.attributes?.getText;let{getText:r}=this.props,o=t.startIndices,s;const l=e==="auto"&&new Set;if(n&&o){const{texts:c,characterCount:y}=Xrt({...ArrayBuffer.isView(n)?{value:n}:n,length:t.length,startIndices:o,characterSet:l});s=y,r=(_,{index:C})=>c[C]}else{const{iterable:c,objectInfo:y}=fu(t);o=[0],s=0;for(const _ of c){y.index++;const C=Array.from(r(_,y)||"");l&&C.forEach(l.add,l),s+=C.length,o.push(s)}}this.setState({getText:r,startIndices:o,numInstances:s,characterSet:l||e})}transformParagraph(t,e){const{fontAtlasManager:n}=this.state,r=n.mapping,o=this.state.getText,{wordBreak:s,lineHeight:l,maxWidth:c}=this.props,y=o(t,e)||"";return Hrt(y,l,s,c*n.props.fontSize,r)}renderLayers(){const{startIndices:t,numInstances:e,getText:n,fontAtlasManager:{scale:r,atlas:o,mapping:s},styleVersion:l}=this.state,{data:c,_dataDiff:y,getPosition:_,getColor:C,getSize:I,getAngle:k,getPixelOffset:z,getBackgroundColor:V,getBorderColor:X,getBorderWidth:H,backgroundBorderRadius:$,backgroundPadding:Y,background:ct,billboard:rt,fontSettings:nt,outlineWidth:Ot,outlineColor:Kt,sizeScale:ft,sizeUnits:st,sizeMinPixels:Ut,sizeMaxPixels:K,transitions:dt,updateTriggers:Tt}=this.props,ue=this.getSubLayerClass("characters",Ky),Rt=this.getSubLayerClass("background",Em);return[ct&&new Rt({getFillColor:V,getLineColor:X,getLineWidth:H,borderRadius:$,padding:Y,getPosition:_,getSize:I,getAngle:k,getPixelOffset:z,billboard:rt,sizeScale:ft,sizeUnits:st,sizeMinPixels:Ut,sizeMaxPixels:K,transitions:dt&&{getPosition:dt.getPosition,getAngle:dt.getAngle,getSize:dt.getSize,getFillColor:dt.getBackgroundColor,getLineColor:dt.getBorderColor,getLineWidth:dt.getBorderWidth,getPixelOffset:dt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Tt.getPosition,getAngle:Tt.getAngle,getSize:Tt.getSize,getFillColor:Tt.getBackgroundColor,getLineColor:Tt.getBorderColor,getLineWidth:Tt.getBorderWidth,getPixelOffset:Tt.getPixelOffset,getBoundingRect:{getText:Tt.getText,getTextAnchor:Tt.getTextAnchor,getAlignmentBaseline:Tt.getAlignmentBaseline,styleVersion:l}}}),{data:c.attributes&&c.attributes.background?{length:c.length,attributes:c.attributes.background}:c,_dataDiff:y,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new ue({sdf:nt.sdf,smoothing:Number.isFinite(nt.smoothing)?nt.smoothing:cp.smoothing,outlineWidth:Ot/(nt.radius||cp.radius),outlineColor:Kt,iconAtlas:o,iconMapping:s,getPosition:_,getColor:C,getSize:I,getAngle:k,getPixelOffset:z,billboard:rt,sizeScale:ft*r,sizeUnits:st,sizeMinPixels:Ut*r,sizeMaxPixels:K*r,transitions:dt&&{getPosition:dt.getPosition,getAngle:dt.getAngle,getColor:dt.getColor,getSize:dt.getSize,getPixelOffset:dt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Tt.getText,getPosition:Tt.getPosition,getAngle:Tt.getAngle,getColor:Tt.getColor,getSize:Tt.getSize,getPixelOffset:Tt.getPixelOffset,getIconOffsets:{getTextAnchor:Tt.getTextAnchor,getAlignmentBaseline:Tt.getAlignmentBaseline,styleVersion:l}}}),{data:c,_dataDiff:y,startIndices:t,numInstances:e,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(t){Yrt(t)}}vf.defaultProps=nst;vf.layerName="TextLayer";const Sg={circle:{type:wm,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Op,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:vf,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Pg={type:nh,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},h2={type:rh,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function _A({type:i,props:t}){const e={};for(const n in t)e[n]=i.defaultProps[t[n]];return e}function u1(i,t){const{transitions:e,updateTriggers:n}=i.props,r={updateTriggers:{},transitions:e&&{getPosition:e.geometry}};for(const o in t){const s=t[o];let l=i.props[o];o.startsWith("get")&&(l=i.getSubLayerAccessor(l),r.updateTriggers[s]=n[o],e&&(r.transitions[s]=e[o])),r[s]=l}return r}function rst(i){if(Array.isArray(i))return i;switch($i.assert(i.type,"GeoJSON does not have type"),i.type){case"Feature":return[i];case"FeatureCollection":return $i.assert(Array.isArray(i.features),"GeoJSON does not have features array"),i.features;default:return[{geometry:i}]}}function mI(i,t,e={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:o=i.length}=e;for(let s=r;s<o;s++){const l=i[s],{geometry:c}=l;if(c)if(c.type==="GeometryCollection"){$i.assert(Array.isArray(c.geometries),"GeoJSON does not have geometries array");const{geometries:y}=c;for(let _=0;_<y.length;_++){const C=y[_];gI(C,n,t,l,s)}}else gI(c,n,t,l,s)}return n}function gI(i,t,e,n,r){const{type:o,coordinates:s}=i,{pointFeatures:l,lineFeatures:c,polygonFeatures:y,polygonOutlineFeatures:_}=t;if(!ost(o,s)){$i.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":l.push(e({geometry:i},n,r));break;case"MultiPoint":s.forEach(C=>{l.push(e({geometry:{type:"Point",coordinates:C}},n,r))});break;case"LineString":c.push(e({geometry:i},n,r));break;case"MultiLineString":s.forEach(C=>{c.push(e({geometry:{type:"LineString",coordinates:C}},n,r))});break;case"Polygon":y.push(e({geometry:i},n,r)),s.forEach(C=>{_.push(e({geometry:{type:"LineString",coordinates:C}},n,r))});break;case"MultiPolygon":s.forEach(C=>{y.push(e({geometry:{type:"Polygon",coordinates:C}},n,r)),C.forEach(I=>{_.push(e({geometry:{type:"LineString",coordinates:I}},n,r))})});break}}const sst={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function ost(i,t){let e=sst[i];for($i.assert(e,`Unknown GeoJSON type ${i}`);t&&--e>0;)t=t[0];return t&&Number.isFinite(t[0])}function q8(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function z0(i){return i.geometry.coordinates}function ast(i,t){const e=q8(),{pointFeatures:n,lineFeatures:r,polygonFeatures:o,polygonOutlineFeatures:s}=i;return e.points.data=n,e.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),e.points.getPosition=z0,e.lines.data=r,e.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),e.lines.getPath=z0,e.polygons.data=o,e.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),e.polygons.getPolygon=z0,e.polygonsOutline.data=s,e.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),e.polygonsOutline.getPath=z0,e}function lst(i,t){const e=q8(),{points:n,lines:r,polygons:o}=i,s=Lrt(i,t);e.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:s.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},e.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:s.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},e.lines._pathType="open";const l=o.positions.value.length/o.positions.size,c=Array(l).fill(1);for(const y of o.primitivePolygonIndices.value)c[y-1]=0;return e.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,instanceVertexValid:{size:1,value:new Uint16Array(c)},pickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},e.polygons._normalize=!1,o.triangles&&(e.polygons.data.attributes.indices=o.triangles.value),e.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},e.polygonsOutline._pathType="open",e}const ust=["points","linestrings","polygons"],cst={..._A(Sg.circle),..._A(Sg.icon),..._A(Sg.text),..._A(Pg),..._A(h2),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:i=>i.properties.icon},getText:{type:"accessor",value:i=>i.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class rc extends Is{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:t,changeFlags:e}){if(!e.dataChanged)return;const{data:n}=this.props,r=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:r}),r?this._updateStateBinary({props:t,changeFlags:e}):this._updateStateJSON({props:t,changeFlags:e})}_updateStateBinary({props:t,changeFlags:e}){const n=lst(t.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:t,changeFlags:e}){const n=rst(t.data),r=this.getSubLayerRow.bind(this);let o={};const s={};if(Array.isArray(e.dataChanged)){const c=this.state.features;for(const y in c)o[y]=c[y].slice(),s[y]=[];for(const y of e.dataChanged){const _=mI(n,r,y);for(const C in c)s[C].push(V8({data:o[C],getIndex:I=>I.__source.index,dataRange:y,replace:_[C]}))}}else o=mI(n,r);const l=ast(o,s);this.setState({features:o,featuresDiff:s,layerProps:l})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n,sourceLayer:r}=e;return e.featureType=ust.find(o=>r.id.startsWith(`${this.id}-${o}-`)),n>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(e.index=this.props.data.points.globalFeatureIds.value[n]),e}_updateAutoHighlight(t){const e=`${this.id}-points-`,n=t.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(e)===n&&r.updateAutoHighlight(t)}_renderPolygonLayer(){const{extruded:t,wireframe:e}=this.props,{layerProps:n}=this.state,r="polygons-fill",o=this.shouldRenderSubLayer(r,n.polygons?.data)&&this.getSubLayerClass(r,h2.type);if(o){const s=u1(this,h2.props),l=t&&e;return l||delete s.getLineColor,s.updateTriggers.lineColors=l,new o(s,this.getSubLayerProps({id:r,updateTriggers:s.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:t,stroked:e}=this.props,{layerProps:n}=this.state,r="polygons-stroke",o="linestrings",s=!t&&e&&this.shouldRenderSubLayer(r,n.polygonsOutline?.data)&&this.getSubLayerClass(r,Pg.type),l=this.shouldRenderSubLayer(o,n.lines?.data)&&this.getSubLayerClass(o,Pg.type);if(s||l){const c=u1(this,Pg.props);return[s&&new s(c,this.getSubLayerProps({id:r,updateTriggers:c.updateTriggers}),n.polygonsOutline),l&&new l(c,this.getSubLayerProps({id:o,updateTriggers:c.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:t}=this.props,{layerProps:e,binary:n}=this.state;let{highlightedObjectIndex:r}=this.props;!n&&Number.isFinite(r)&&(r=e.points.data.findIndex(l=>l.__source.index===r));const o=new Set(t.split("+")),s=[];for(const l of o){const c=`points-${l}`,y=Sg[l],_=y&&this.shouldRenderSubLayer(c,e.points?.data)&&this.getSubLayerClass(c,y.type);if(_){const C=u1(this,y.props);let I=e.points;if(l==="text"&&n){const{instancePickingColors:k,...z}=I.data.attributes;I={...I,data:{...I.data,attributes:z}}}s.push(new _(C,this.getSubLayerProps({id:c,updateTriggers:C.updateTriggers,highlightedObjectIndex:r}),I))}}return s}renderLayers(){const{extruded:t}=this.props,e=this._renderPolygonLayer(),n=this._renderLineLayers(),r=this._renderPointLayers();return[!t&&e,n,r,t&&e]}getSubLayerAccessor(t){const{binary:e}=this.state;return!e||typeof t!="function"?super.getSubLayerAccessor(t):(n,r)=>{const{data:o,index:s}=r,l=Brt(o,s);return t(l,r)}}}rc.layerName="GeoJsonLayer";rc.defaultProps=cst;const hst=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:bm,BitmapLayer:Xy,ColumnLayer:du,GeoJsonLayer:rc,GridCellLayer:vw,IconLayer:Op,LineLayer:qy,PathLayer:nh,PointCloudLayer:xm,PolygonLayer:sh,ScatterplotLayer:wm,SolidPolygonLayer:rh,TextLayer:vf,_MultiIconLayer:Ky,_TextBackgroundLayer:Em},Symbol.toStringTag,{value:"Module"})),fst={...sh.defaultProps};class sc extends Is{indexToBounds(){return null}renderLayers(){const{elevationScale:t,extruded:e,wireframe:n,filled:r,stroked:o,lineWidthUnits:s,lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:y,lineJointRounded:_,lineMiterLimit:C,lineDashJustified:I,getElevation:k,getFillColor:z,getLineColor:V,getLineWidth:X}=this.props,{updateTriggers:H,material:$,transitions:Y}=this.props,ct=this.getSubLayerClass("cell",sh),{updateTriggers:rt,...nt}=this.indexToBounds()||{};return new ct({filled:r,wireframe:n,extruded:e,elevationScale:t,stroked:o,lineWidthUnits:s,lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:y,lineJointRounded:_,lineMiterLimit:C,lineDashJustified:I,material:$,transitions:Y,getElevation:k,getFillColor:z,getLineColor:V,getLineWidth:X},this.getSubLayerProps({id:"cell",updateTriggers:H&&{...rt,getElevation:H.getElevation,getFillColor:H.getFillColor,getLineColor:H.getLineColor,getLineWidth:H.getLineWidth}}),nt)}}sc.layerName="GeoCellLayer";sc.defaultProps=fst;var dst=Object.defineProperty,Cm=(i,t)=>{for(var e in t)dst(i,e,{get:t[e],enumerable:!0})},Fo={};Cm(Fo,{ARRAY_TYPE:()=>es,EPSILON:()=>io,RANDOM:()=>Jh,equals:()=>gst,setMatrixArrayType:()=>pst,toRadian:()=>mst});var io=1e-6,es=typeof Float32Array<"u"?Float32Array:Array,Jh=Math.random;function pst(i){es=i}var Ast=Math.PI/180;function mst(i){return i*Ast}function gst(i,t){return Math.abs(i-t)<=io*Math.max(1,Math.abs(i),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var of={};Cm(of,{LDU:()=>Dst,add:()=>kst,adjoint:()=>Tst,clone:()=>vst,copy:()=>_st,create:()=>yst,determinant:()=>Sst,equals:()=>Fst,exactEquals:()=>Ost,frob:()=>Lst,fromRotation:()=>Mst,fromScaling:()=>Bst,fromValues:()=>xst,identity:()=>bst,invert:()=>Cst,mul:()=>Ust,multiply:()=>K8,multiplyScalar:()=>Nst,multiplyScalarAndAdd:()=>zst,rotate:()=>Pst,scale:()=>Ist,set:()=>wst,str:()=>Rst,sub:()=>Vst,subtract:()=>Z8,transpose:()=>Est});function yst(){var i=new es(4);return es!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i}function vst(i){var t=new es(4);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t}function _st(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i}function bst(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i}function xst(i,t,e,n){var r=new es(4);return r[0]=i,r[1]=t,r[2]=e,r[3]=n,r}function wst(i,t,e,n,r){return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Est(i,t){if(i===t){var e=t[1];i[1]=t[2],i[2]=e}else i[0]=t[0],i[1]=t[2],i[2]=t[1],i[3]=t[3];return i}function Cst(i,t){var e=t[0],n=t[1],r=t[2],o=t[3],s=e*o-r*n;return s?(s=1/s,i[0]=o*s,i[1]=-n*s,i[2]=-r*s,i[3]=e*s,i):null}function Tst(i,t){var e=t[0];return i[0]=t[3],i[1]=-t[1],i[2]=-t[2],i[3]=e,i}function Sst(i){return i[0]*i[3]-i[2]*i[1]}function K8(i,t,e){var n=t[0],r=t[1],o=t[2],s=t[3],l=e[0],c=e[1],y=e[2],_=e[3];return i[0]=n*l+o*c,i[1]=r*l+s*c,i[2]=n*y+o*_,i[3]=r*y+s*_,i}function Pst(i,t,e){var n=t[0],r=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return i[0]=n*c+o*l,i[1]=r*c+s*l,i[2]=n*-l+o*c,i[3]=r*-l+s*c,i}function Ist(i,t,e){var n=t[0],r=t[1],o=t[2],s=t[3],l=e[0],c=e[1];return i[0]=n*l,i[1]=r*l,i[2]=o*c,i[3]=s*c,i}function Mst(i,t){var e=Math.sin(t),n=Math.cos(t);return i[0]=n,i[1]=e,i[2]=-e,i[3]=n,i}function Bst(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=t[1],i}function Rst(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"}function Lst(i){return Math.hypot(i[0],i[1],i[2],i[3])}function Dst(i,t,e,n){return i[2]=n[2]/n[0],e[0]=n[0],e[1]=n[1],e[3]=n[3]-i[2]*e[1],[i,t,e]}function kst(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i}function Z8(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i}function Ost(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]}function Fst(i,t){var e=i[0],n=i[1],r=i[2],o=i[3],s=t[0],l=t[1],c=t[2],y=t[3];return Math.abs(e-s)<=io*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(n-l)<=io*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-c)<=io*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(o-y)<=io*Math.max(1,Math.abs(o),Math.abs(y))}function Nst(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function zst(i,t,e,n){return i[0]=t[0]+e[0]*n,i[1]=t[1]+e[1]*n,i[2]=t[2]+e[2]*n,i[3]=t[3]+e[3]*n,i}var Ust=K8,Vst=Z8;function Gst(){var i=new es(9);return es!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}var f2={};Cm(f2,{add:()=>eat,calculateW:()=>Wot,clone:()=>Qot,conjugate:()=>Kot,copy:()=>$ot,create:()=>p2,dot:()=>hD,equals:()=>aat,exactEquals:()=>oat,exp:()=>aD,fromEuler:()=>Zot,fromMat3:()=>uD,fromValues:()=>Jot,getAngle:()=>Uot,getAxisAngle:()=>zot,identity:()=>Not,invert:()=>qot,len:()=>rat,length:()=>fD,lerp:()=>nat,ln:()=>lD,mul:()=>iat,multiply:()=>oD,normalize:()=>xw,pow:()=>Hot,random:()=>Xot,rotateX:()=>Vot,rotateY:()=>Got,rotateZ:()=>jot,rotationTo:()=>lat,scale:()=>cD,set:()=>tat,setAxes:()=>cat,setAxisAngle:()=>sD,slerp:()=>Mg,sqlerp:()=>uat,sqrLen:()=>sat,squaredLength:()=>dD,str:()=>Yot});var fi={};Cm(fi,{add:()=>Xst,angle:()=>fot,bezier:()=>rot,ceil:()=>qst,clone:()=>jst,copy:()=>Wst,create:()=>_w,cross:()=>Ig,dist:()=>_ot,distance:()=>tD,div:()=>vot,divide:()=>$8,dot:()=>bw,equals:()=>mot,exactEquals:()=>Aot,floor:()=>Kst,forEach:()=>wot,fromValues:()=>d2,hermite:()=>not,inverse:()=>eot,len:()=>rD,length:()=>Y8,lerp:()=>iot,max:()=>Yst,min:()=>Zst,mul:()=>yot,multiply:()=>J8,negate:()=>tot,normalize:()=>nD,random:()=>sot,rotateX:()=>uot,rotateY:()=>cot,rotateZ:()=>hot,round:()=>Qst,scale:()=>Jst,scaleAndAdd:()=>$st,set:()=>Hst,sqrDist:()=>bot,sqrLen:()=>xot,squaredDistance:()=>eD,squaredLength:()=>iD,str:()=>pot,sub:()=>got,subtract:()=>Q8,transformMat3:()=>aot,transformMat4:()=>oot,transformQuat:()=>lot,zero:()=>dot});function _w(){var i=new es(3);return es!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function jst(i){var t=new es(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function Y8(i){var t=i[0],e=i[1],n=i[2];return Math.hypot(t,e,n)}function d2(i,t,e){var n=new es(3);return n[0]=i,n[1]=t,n[2]=e,n}function Wst(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}function Hst(i,t,e,n){return i[0]=t,i[1]=e,i[2]=n,i}function Xst(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function Q8(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function J8(i,t,e){return i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i}function $8(i,t,e){return i[0]=t[0]/e[0],i[1]=t[1]/e[1],i[2]=t[2]/e[2],i}function qst(i,t){return i[0]=Math.ceil(t[0]),i[1]=Math.ceil(t[1]),i[2]=Math.ceil(t[2]),i}function Kst(i,t){return i[0]=Math.floor(t[0]),i[1]=Math.floor(t[1]),i[2]=Math.floor(t[2]),i}function Zst(i,t,e){return i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.min(t[2],e[2]),i}function Yst(i,t,e){return i[0]=Math.max(t[0],e[0]),i[1]=Math.max(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i}function Qst(i,t){return i[0]=Math.round(t[0]),i[1]=Math.round(t[1]),i[2]=Math.round(t[2]),i}function Jst(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function $st(i,t,e,n){return i[0]=t[0]+e[0]*n,i[1]=t[1]+e[1]*n,i[2]=t[2]+e[2]*n,i}function tD(i,t){var e=t[0]-i[0],n=t[1]-i[1],r=t[2]-i[2];return Math.hypot(e,n,r)}function eD(i,t){var e=t[0]-i[0],n=t[1]-i[1],r=t[2]-i[2];return e*e+n*n+r*r}function iD(i){var t=i[0],e=i[1],n=i[2];return t*t+e*e+n*n}function tot(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function eot(i,t){return i[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],i}function nD(i,t){var e=t[0],n=t[1],r=t[2],o=e*e+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i}function bw(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function Ig(i,t,e){var n=t[0],r=t[1],o=t[2],s=e[0],l=e[1],c=e[2];return i[0]=r*c-o*l,i[1]=o*s-n*c,i[2]=n*l-r*s,i}function iot(i,t,e,n){var r=t[0],o=t[1],s=t[2];return i[0]=r+n*(e[0]-r),i[1]=o+n*(e[1]-o),i[2]=s+n*(e[2]-s),i}function not(i,t,e,n,r,o){var s=o*o,l=s*(2*o-3)+1,c=s*(o-2)+o,y=s*(o-1),_=s*(3-2*o);return i[0]=t[0]*l+e[0]*c+n[0]*y+r[0]*_,i[1]=t[1]*l+e[1]*c+n[1]*y+r[1]*_,i[2]=t[2]*l+e[2]*c+n[2]*y+r[2]*_,i}function rot(i,t,e,n,r,o){var s=1-o,l=s*s,c=o*o,y=l*s,_=3*o*l,C=3*c*s,I=c*o;return i[0]=t[0]*y+e[0]*_+n[0]*C+r[0]*I,i[1]=t[1]*y+e[1]*_+n[1]*C+r[1]*I,i[2]=t[2]*y+e[2]*_+n[2]*C+r[2]*I,i}function sot(i,t){t=t||1;var e=Jh()*2*Math.PI,n=Jh()*2-1,r=Math.sqrt(1-n*n)*t;return i[0]=Math.cos(e)*r,i[1]=Math.sin(e)*r,i[2]=n*t,i}function oot(i,t,e){var n=t[0],r=t[1],o=t[2],s=e[3]*n+e[7]*r+e[11]*o+e[15];return s=s||1,i[0]=(e[0]*n+e[4]*r+e[8]*o+e[12])/s,i[1]=(e[1]*n+e[5]*r+e[9]*o+e[13])/s,i[2]=(e[2]*n+e[6]*r+e[10]*o+e[14])/s,i}function aot(i,t,e){var n=t[0],r=t[1],o=t[2];return i[0]=n*e[0]+r*e[3]+o*e[6],i[1]=n*e[1]+r*e[4]+o*e[7],i[2]=n*e[2]+r*e[5]+o*e[8],i}function lot(i,t,e){var n=e[0],r=e[1],o=e[2],s=e[3],l=t[0],c=t[1],y=t[2],_=r*y-o*c,C=o*l-n*y,I=n*c-r*l,k=r*I-o*C,z=o*_-n*I,V=n*C-r*_,X=s*2;return _*=X,C*=X,I*=X,k*=2,z*=2,V*=2,i[0]=l+_+k,i[1]=c+C+z,i[2]=y+I+V,i}function uot(i,t,e,n){var r=[],o=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i}function cot(i,t,e,n){var r=[],o=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i}function hot(i,t,e,n){var r=[],o=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i}function fot(i,t){var e=i[0],n=i[1],r=i[2],o=t[0],s=t[1],l=t[2],c=Math.sqrt(e*e+n*n+r*r),y=Math.sqrt(o*o+s*s+l*l),_=c*y,C=_&&bw(i,t)/_;return Math.acos(Math.min(Math.max(C,-1),1))}function dot(i){return i[0]=0,i[1]=0,i[2]=0,i}function pot(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"}function Aot(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]}function mot(i,t){var e=i[0],n=i[1],r=i[2],o=t[0],s=t[1],l=t[2];return Math.abs(e-o)<=io*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(n-s)<=io*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-l)<=io*Math.max(1,Math.abs(r),Math.abs(l))}var got=Q8,yot=J8,vot=$8,_ot=tD,bot=eD,rD=Y8,xot=iD,wot=(function(){var i=_w();return function(t,e,n,r,o,s){var l,c;for(e||(e=3),n||(n=0),r?c=Math.min(r*e+n,t.length):c=t.length,l=n;l<c;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],o(i,i,s),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2];return t}})();function Eot(){var i=new es(4);return es!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function Cot(i){var t=new es(4);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t}function Tot(i,t,e,n){var r=new es(4);return r[0]=i,r[1]=t,r[2]=e,r[3]=n,r}function Sot(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i}function Pot(i,t,e,n,r){return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Iot(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i}function Mot(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function Bot(i){var t=i[0],e=i[1],n=i[2],r=i[3];return Math.hypot(t,e,n,r)}function Rot(i){var t=i[0],e=i[1],n=i[2],r=i[3];return t*t+e*e+n*n+r*r}function Lot(i,t){var e=t[0],n=t[1],r=t[2],o=t[3],s=e*e+n*n+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),i[0]=e*s,i[1]=n*s,i[2]=r*s,i[3]=o*s,i}function Dot(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]}function kot(i,t,e,n){var r=t[0],o=t[1],s=t[2],l=t[3];return i[0]=r+n*(e[0]-r),i[1]=o+n*(e[1]-o),i[2]=s+n*(e[2]-s),i[3]=l+n*(e[3]-l),i}function Oot(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]}function Fot(i,t){var e=i[0],n=i[1],r=i[2],o=i[3],s=t[0],l=t[1],c=t[2],y=t[3];return Math.abs(e-s)<=io*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(n-l)<=io*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-c)<=io*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(o-y)<=io*Math.max(1,Math.abs(o),Math.abs(y))}(function(){var i=Eot();return function(t,e,n,r,o,s){var l,c;for(e||(e=4),n||(n=0),r?c=Math.min(r*e+n,t.length):c=t.length,l=n;l<c;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],i[3]=t[l+3],o(i,i,s),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2],t[l+3]=i[3];return t}})();function p2(){var i=new es(4);return es!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Not(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function sD(i,t,e){e=e*.5;var n=Math.sin(e);return i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i[3]=Math.cos(e),i}function zot(i,t){var e=Math.acos(t[3])*2,n=Math.sin(e/2);return n>io?(i[0]=t[0]/n,i[1]=t[1]/n,i[2]=t[2]/n):(i[0]=1,i[1]=0,i[2]=0),e}function Uot(i,t){var e=hD(i,t);return Math.acos(2*e*e-1)}function oD(i,t,e){var n=t[0],r=t[1],o=t[2],s=t[3],l=e[0],c=e[1],y=e[2],_=e[3];return i[0]=n*_+s*l+r*y-o*c,i[1]=r*_+s*c+o*l-n*y,i[2]=o*_+s*y+n*c-r*l,i[3]=s*_-n*l-r*c-o*y,i}function Vot(i,t,e){e*=.5;var n=t[0],r=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return i[0]=n*c+s*l,i[1]=r*c+o*l,i[2]=o*c-r*l,i[3]=s*c-n*l,i}function Got(i,t,e){e*=.5;var n=t[0],r=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return i[0]=n*c-o*l,i[1]=r*c+s*l,i[2]=o*c+n*l,i[3]=s*c-r*l,i}function jot(i,t,e){e*=.5;var n=t[0],r=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return i[0]=n*c+r*l,i[1]=r*c-n*l,i[2]=o*c+s*l,i[3]=s*c-o*l,i}function Wot(i,t){var e=t[0],n=t[1],r=t[2];return i[0]=e,i[1]=n,i[2]=r,i[3]=Math.sqrt(Math.abs(1-e*e-n*n-r*r)),i}function aD(i,t){var e=t[0],n=t[1],r=t[2],o=t[3],s=Math.sqrt(e*e+n*n+r*r),l=Math.exp(o),c=s>0?l*Math.sin(s)/s:0;return i[0]=e*c,i[1]=n*c,i[2]=r*c,i[3]=l*Math.cos(s),i}function lD(i,t){var e=t[0],n=t[1],r=t[2],o=t[3],s=Math.sqrt(e*e+n*n+r*r),l=s>0?Math.atan2(s,o)/s:0;return i[0]=e*l,i[1]=n*l,i[2]=r*l,i[3]=.5*Math.log(e*e+n*n+r*r+o*o),i}function Hot(i,t,e){return lD(i,t),cD(i,i,e),aD(i,i),i}function Mg(i,t,e,n){var r=t[0],o=t[1],s=t[2],l=t[3],c=e[0],y=e[1],_=e[2],C=e[3],I,k,z,V,X;return k=r*c+o*y+s*_+l*C,k<0&&(k=-k,c=-c,y=-y,_=-_,C=-C),1-k>io?(I=Math.acos(k),z=Math.sin(I),V=Math.sin((1-n)*I)/z,X=Math.sin(n*I)/z):(V=1-n,X=n),i[0]=V*r+X*c,i[1]=V*o+X*y,i[2]=V*s+X*_,i[3]=V*l+X*C,i}function Xot(i){var t=Jh(),e=Jh(),n=Jh(),r=Math.sqrt(1-t),o=Math.sqrt(t);return i[0]=r*Math.sin(2*Math.PI*e),i[1]=r*Math.cos(2*Math.PI*e),i[2]=o*Math.sin(2*Math.PI*n),i[3]=o*Math.cos(2*Math.PI*n),i}function qot(i,t){var e=t[0],n=t[1],r=t[2],o=t[3],s=e*e+n*n+r*r+o*o,l=s?1/s:0;return i[0]=-e*l,i[1]=-n*l,i[2]=-r*l,i[3]=o*l,i}function Kot(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function uD(i,t){var e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),i[3]=.5*n,n=.5/n,i[0]=(t[5]-t[7])*n,i[1]=(t[6]-t[2])*n,i[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[r*3+r]-t[o*3+o]-t[s*3+s]+1),i[r]=.5*n,n=.5/n,i[3]=(t[o*3+s]-t[s*3+o])*n,i[o]=(t[o*3+r]+t[r*3+o])*n,i[s]=(t[s*3+r]+t[r*3+s])*n}return i}function Zot(i,t,e,n){var r=.5*Math.PI/180;t*=r,e*=r,n*=r;var o=Math.sin(t),s=Math.cos(t),l=Math.sin(e),c=Math.cos(e),y=Math.sin(n),_=Math.cos(n);return i[0]=o*c*_-s*l*y,i[1]=s*l*_+o*c*y,i[2]=s*c*y-o*l*_,i[3]=s*c*_+o*l*y,i}function Yot(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"}var Qot=Cot,Jot=Tot,$ot=Sot,tat=Pot,eat=Iot,iat=oD,cD=Mot,hD=Dot,nat=kot,fD=Bot,rat=fD,dD=Rot,sat=dD,xw=Lot,oat=Oot,aat=Fot,lat=(function(){var i=_w(),t=d2(1,0,0),e=d2(0,1,0);return function(n,r,o){var s=bw(r,o);return s<-.999999?(Ig(i,t,r),rD(i)<1e-6&&Ig(i,e,r),nD(i,i),sD(n,i,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Ig(i,r,o),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1+s,xw(n,n))}})(),uat=(function(){var i=p2(),t=p2();return function(e,n,r,o,s,l){return Mg(i,n,s,l),Mg(t,r,o,l),Mg(e,i,t,2*l*(1-l)),e}})(),cat=(function(){var i=Gst();return function(t,e,n,r){return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=r[0],i[4]=r[1],i[7]=r[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],xw(t,uD(t,i))}})(),vn={};Cm(vn,{add:()=>Aat,angle:()=>kat,ceil:()=>mat,clone:()=>hat,copy:()=>dat,create:()=>pD,cross:()=>Sat,dist:()=>Wat,distance:()=>yD,div:()=>jat,divide:()=>gD,dot:()=>Tat,equals:()=>zat,exactEquals:()=>Nat,floor:()=>gat,forEach:()=>qat,fromValues:()=>fat,inverse:()=>Eat,len:()=>Uat,length:()=>_D,lerp:()=>Pat,max:()=>vat,min:()=>yat,mul:()=>Gat,multiply:()=>mD,negate:()=>wat,normalize:()=>Cat,random:()=>Iat,rotate:()=>Dat,round:()=>_at,scale:()=>bat,scaleAndAdd:()=>xat,set:()=>pat,sqrDist:()=>Hat,sqrLen:()=>Xat,squaredDistance:()=>vD,squaredLength:()=>bD,str:()=>Fat,sub:()=>Vat,subtract:()=>AD,transformMat2:()=>Mat,transformMat2d:()=>Bat,transformMat3:()=>Rat,transformMat4:()=>Lat,zero:()=>Oat});function pD(){var i=new es(2);return es!=Float32Array&&(i[0]=0,i[1]=0),i}function hat(i){var t=new es(2);return t[0]=i[0],t[1]=i[1],t}function fat(i,t){var e=new es(2);return e[0]=i,e[1]=t,e}function dat(i,t){return i[0]=t[0],i[1]=t[1],i}function pat(i,t,e){return i[0]=t,i[1]=e,i}function Aat(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function AD(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i}function mD(i,t,e){return i[0]=t[0]*e[0],i[1]=t[1]*e[1],i}function gD(i,t,e){return i[0]=t[0]/e[0],i[1]=t[1]/e[1],i}function mat(i,t){return i[0]=Math.ceil(t[0]),i[1]=Math.ceil(t[1]),i}function gat(i,t){return i[0]=Math.floor(t[0]),i[1]=Math.floor(t[1]),i}function yat(i,t,e){return i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i}function vat(i,t,e){return i[0]=Math.max(t[0],e[0]),i[1]=Math.max(t[1],e[1]),i}function _at(i,t){return i[0]=Math.round(t[0]),i[1]=Math.round(t[1]),i}function bat(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i}function xat(i,t,e,n){return i[0]=t[0]+e[0]*n,i[1]=t[1]+e[1]*n,i}function yD(i,t){var e=t[0]-i[0],n=t[1]-i[1];return Math.hypot(e,n)}function vD(i,t){var e=t[0]-i[0],n=t[1]-i[1];return e*e+n*n}function _D(i){var t=i[0],e=i[1];return Math.hypot(t,e)}function bD(i){var t=i[0],e=i[1];return t*t+e*e}function wat(i,t){return i[0]=-t[0],i[1]=-t[1],i}function Eat(i,t){return i[0]=1/t[0],i[1]=1/t[1],i}function Cat(i,t){var e=t[0],n=t[1],r=e*e+n*n;return r>0&&(r=1/Math.sqrt(r)),i[0]=t[0]*r,i[1]=t[1]*r,i}function Tat(i,t){return i[0]*t[0]+i[1]*t[1]}function Sat(i,t,e){var n=t[0]*e[1]-t[1]*e[0];return i[0]=i[1]=0,i[2]=n,i}function Pat(i,t,e,n){var r=t[0],o=t[1];return i[0]=r+n*(e[0]-r),i[1]=o+n*(e[1]-o),i}function Iat(i,t){t=t||1;var e=Jh()*2*Math.PI;return i[0]=Math.cos(e)*t,i[1]=Math.sin(e)*t,i}function Mat(i,t,e){var n=t[0],r=t[1];return i[0]=e[0]*n+e[2]*r,i[1]=e[1]*n+e[3]*r,i}function Bat(i,t,e){var n=t[0],r=t[1];return i[0]=e[0]*n+e[2]*r+e[4],i[1]=e[1]*n+e[3]*r+e[5],i}function Rat(i,t,e){var n=t[0],r=t[1];return i[0]=e[0]*n+e[3]*r+e[6],i[1]=e[1]*n+e[4]*r+e[7],i}function Lat(i,t,e){var n=t[0],r=t[1];return i[0]=e[0]*n+e[4]*r+e[12],i[1]=e[1]*n+e[5]*r+e[13],i}function Dat(i,t,e,n){var r=t[0]-e[0],o=t[1]-e[1],s=Math.sin(n),l=Math.cos(n);return i[0]=r*l-o*s+e[0],i[1]=r*s+o*l+e[1],i}function kat(i,t){var e=i[0],n=i[1],r=t[0],o=t[1],s=Math.sqrt(e*e+n*n)*Math.sqrt(r*r+o*o),l=s&&(e*r+n*o)/s;return Math.acos(Math.min(Math.max(l,-1),1))}function Oat(i){return i[0]=0,i[1]=0,i}function Fat(i){return"vec2("+i[0]+", "+i[1]+")"}function Nat(i,t){return i[0]===t[0]&&i[1]===t[1]}function zat(i,t){var e=i[0],n=i[1],r=t[0],o=t[1];return Math.abs(e-r)<=io*Math.max(1,Math.abs(e),Math.abs(r))&&Math.abs(n-o)<=io*Math.max(1,Math.abs(n),Math.abs(o))}var Uat=_D,Vat=AD,Gat=mD,jat=gD,Wat=yD,Hat=vD,Xat=bD,qat=(function(){var i=pD();return function(t,e,n,r,o,s){var l,c;for(e||(e=2),n||(n=0),r?c=Math.min(r*e+n,t.length):c=t.length,l=n;l<c;l+=e)i[0]=t[l],i[1]=t[l+1],o(i,i,s),t[l]=i[0],t[l+1]=i[1];return t}})(),Kat=(1+Math.sqrt(5))/2,dy=2*Math.PI/5,au=Math.PI/5,yI=Math.PI/10,Zat=2*Math.atan(Kat),A2=Math.PI-Zat,Zy=(Math.sqrt(5)-1)/2,Yat=3-Math.sqrt(5);Fo.setMatrixArrayType(Float64Array);var ww=class m2{constructor(t){this.vertices=t,this.isWindingCorrect()||this.vertices.reverse()}getArea(){let t=0;const e=this.vertices.length;for(let n=0;n<e;n++){const r=(n+1)%e;t+=(this.vertices[r][0]-this.vertices[n][0])*(this.vertices[r][1]+this.vertices[n][1])}return t}isWindingCorrect(){return this.getArea()>=0}getVertices(){return this.vertices}scale(t){for(const e of this.vertices)vn.scale(e,e,t);return this}rotate180(){for(const t of this.vertices)vn.negate(t,t);return this}reflectY(){for(const t of this.vertices)t[1]=-t[1];return this.vertices.reverse(),this}translate(t){for(const e of this.vertices)vn.add(e,e,t);return this}transform(t){for(const e of this.vertices)vn.transformMat2(e,e,t);return this}transform2d(t){for(const e of this.vertices)vn.transformMat2d(e,e,t);return this}clone(){return new m2(this.vertices.map(t=>vn.clone(t)))}getCenter(){const t=this.vertices.length;return this.vertices.reduce((e,n)=>[e[0]+n[0]/t,e[1]+n[1]/t],[0,0])}containsPoint(t){if(!this.isWindingCorrect())throw new Error("Pentagon is not counter-clockwise");const e=this.vertices.length;let n=1;for(let r=0;r<e;r++){const o=this.vertices[r],s=this.vertices[(r+1)%e],l=o[0]-s[0],c=o[1]-s[1],y=t[0]-o[0],_=t[1]-o[1],C=l*_-c*y;if(C<0){const I=Math.sqrt(y*y+_*_);n=Math.min(n,C/I)}}return n}splitEdges(t){if(t<=1)return this;const e=[],n=this.vertices.length;for(let r=0;r<n;r++){const o=this.vertices[r],s=this.vertices[(r+1)%n];e.push(vn.clone(o));for(let l=1;l<t;l++){const c=l/t,y=vn.create();vn.lerp(y,o,s,c),e.push(y)}}return new m2(e)}};Fo.setMatrixArrayType(Float64Array);var xD=[0,0],wD=[0,1],af=[.7885966681787006,1.6149108024237764],ED=[1.6171013659387945,1.054928690397459],CD=[Math.cos(yI),Math.sin(yI)],Qat=2*vn.length(af)*Math.cos(au),Jat=au-Math.atan2(af[1],af[0]),$at=2*Zy/Qat;[xD,wD,af,ED,CD].forEach(i=>{vn.scale(i,i,$at),vn.rotate(i,i,[0,0],Jat)});var tlt=new ww([xD,wD,af,ED,CD]),TD=Math.atan2(af[1],af[0])-au,elt=[0,0],py=Zy/Math.cos(au),vI=TD+au,Ay=[py*Math.cos(vI),py*Math.sin(vI)],_I=TD-au,dm=[py*Math.cos(_I),py*Math.sin(_I)],ilt=new ww([elt,Ay,dm]),SD=of.fromValues(Ay[0],Ay[1],dm[0],dm[1]);of.invert(of.create(),SD);var nlt=new Float64Array([-.0022392098386786394,21308606513250217e-22,-2559257686421274e-24,33701965267802837e-28,-4667545312611249e-30,667492870384816e-32]),rlt=new Float64Array([.0022392089963541657,28831978048607556e-22,508622073997266e-23,102018123778161e-25,21912872306767718e-30,49284235482523806e-33]),slt=class{applyCoefficients(i,t){const e=Math.sin(i),n=Math.cos(i),r=2*(n-e)*(n+e);let o,s;return o=r*t[5]+t[4],s=r*o+t[3],o=r*s-o+t[2],s=r*o-s+t[1],o=r*s-o+t[0],i+2*e*n*o}forward(i){return this.applyCoefficients(i,nlt)}inverse(i){return this.applyCoefficients(i,rlt)}};Fo.setMatrixArrayType(Float64Array);var PD=new slt;function bI(i){return i*(Math.PI/180)}function xI(i){return i*(180/Math.PI)}function wI(i){const t=vn.length(i),e=Math.atan2(i[1],i[0]);return[t,e]}function olt([i,t]){const e=i*Math.cos(t),n=i*Math.sin(t);return[e,n]}function alt(i,[t,e,n]){const r=[t[0]-n[0],t[1]-n[1]],o=[n[0]-e[0],n[1]-e[1]],s=[i[0]-n[0],i[1]-n[1]],l=o[0]*r[1]-o[1]*r[0],c=(o[0]*s[1]-o[1]*s[0])/l,y=(r[0]*s[1]-r[1]*s[0])/l,_=1-(c+y);return[c,y,_]}function llt(i,[t,e,n]){return[i[0]*t[0]+i[1]*e[0]+i[2]*n[0],i[0]*t[1]+i[1]*e[1]+i[2]*n[1]]}function g2(i){const t=Math.atan2(i[1],i[0]),e=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),n=Math.acos(i[2]/e);return[t,n]}function hp([i,t]){const e=Math.sin(t),n=e*Math.cos(i),r=e*Math.sin(i),o=Math.cos(t);return[n,r,o]}var ID=93;function ult([i,t]){const e=bI(i+ID),n=bI(t),r=PD.forward(n),o=Math.PI/2-r;return[e,o]}function MD([i,t]){const e=xI(i)-ID,n=Math.PI/2-t,r=PD.inverse(n),o=xI(r);return[e,o]}function clt(i){const t=i.map(o=>hp(ult(o))),e=fi.create();for(const o of t)fi.add(e,e,o);fi.normalize(e,e);let[n,r]=MD(g2(e));return(r>89.99||r<-89.99)&&(n=i[0][0]),n=((n+180)%360+360)%360-180,i.map(o=>{let[s,l]=o;for(;s-n>180;)s=s-360;for(;s-n<-180;)s=s+360;return[s,l]})}Fo.setMatrixArrayType(Float64Array);var Yy=Math.sqrt(5),Qy=Math.sqrt(.2),BD=Math.sqrt((1-Qy)/2),RD=Math.sqrt((1+Qy)/2),U0=.5,EI=Math.sqrt((2.5-Yy)/10),CI=Math.sqrt((2.5+Yy)/10),TI=Math.sqrt((1+Qy)/8),SI=Math.sqrt((1-Qy)/8),PI=Math.sqrt((3-Yy)/8),II=Math.sqrt((3+Yy)/8),hlt=[[0,0],[BD,0],[EI,U0],[-TI,PI],[-TI,-PI],[EI,-U0],[-RD,0],[-SI,-II],[CI,-U0],[CI,U0],[-SI,II],[0,0]],flt=hlt.map(([i,t])=>[-t,i]),V0=flt.map((i,t)=>t===0?[0,0,0,1]:t===11?[0,-1,0,0]:[...i,0,t<6?RD:BD]);Fo.setMatrixArrayType(Float64Array);var LD=["vu","uw","vw","vw","vw"],kA=["wu","uw","vw","vu","uw"],c1=["wu","uv","wv","wu","uw"],G0=["vu","uv","wv","wu","uw"],dlt=[LD,G0,c1,kA,c1,G0,c1,kA,kA,kA,G0,G0],plt=[4,2,3,2,0,4,3,2,2,0,3,0],MI=[0,1,2,4,3,5,7,8,6,11,10,9],yl=[];function Alt(){j0([0,0],0,V0[0]);for(let i=0;i<5;i++){const t=i*dy,e=t+au;j0([t,A2],au,V0[i+1]),j0([e,Math.PI-A2],au,V0[(i+3)%5+6])}j0([0,Math.PI],0,V0[11])}var Ed=0;function j0(i,t,e){if(Ed>11)throw new Error(`Too many origins: ${Ed}`);const n=f2.create();f2.conjugate(n,e);const r={id:Ed,axis:i,quat:e,inverseQuat:n,angle:t,orientation:dlt[Ed],firstQuintant:plt[Ed]};yl.push(r),Ed++}Alt();yl.sort((i,t)=>MI.indexOf(i.id)-MI.indexOf(t.id));yl.forEach((i,t)=>i.id=t);function mlt(i,t){const e=t.orientation,n=e===LD||e===kA?-1:1,r=(i-t.firstQuintant+5)%5,o=e[r];return{quintant:(t.firstQuintant+n*r+5)%5,orientation:o}}var glt=class{forward([i,t]){return[Math.tan(t),i]}inverse([i,t]){return[t,Math.atan(i)]}},Cd=fi.create(),YA=fi.create(),BI=fi.create(),RI=fi.create();function h1(i,t){fi.lerp(Cd,i,t,.5),fi.normalize(Cd,Cd),fi.cross(Cd,i,Cd);const e=fi.length(Cd);if(e<1e-8){const n=fi.subtract(fi.create(),i,t);return .5*fi.length(n)}return e}function ylt(i,t,e){return fi.cross(YA,t,e),fi.dot(i,YA)}function vlt(i,t,e,n,r){fi.cross(YA,n,r);const o=fi.dot(t,YA),s=fi.dot(e,YA);return fi.scale(BI,t,s),fi.scale(RI,e,o),fi.sub(i,RI,BI)}function y2(i,t,e,n){const r=fi.angle(t,e);if(r<1e-12)return fi.lerp(i,t,e,n);const o=Math.sin((1-n)*r)/Math.sin(r),s=Math.sin(n*r)/Math.sin(r),l=fi.scale(fi.create(),t,o),c=fi.scale(fi.create(),e,s);return fi.add(i,l,c)}Fo.setMatrixArrayType(Float64Array);var W0=fi.create(),H0=fi.create(),X0=fi.create(),Td=fi.create(),_lt=class{constructor(i){this._area=null,this.vertices=i,Object.freeze(this.vertices)}getBoundary(i=1,t=!0){const e=[],n=this.vertices.length;for(let r=0;r<n*i;r++){const o=r/i;e.push(this.slerp(o))}return t&&e.push(e[0]),e}slerp(i){const t=this.vertices.length,e=i%1,n=Math.floor(i%t),r=(n+1)%t;return y2(fi.create(),this.vertices[n],this.vertices[r],e)}getTransformedVertices(i){const t=this.vertices.length,e=Math.floor(i%t),n=(e+1)%t,r=(e+t-1)%t,o=fi.clone(this.vertices[e]),s=fi.clone(this.vertices[n]),l=fi.clone(this.vertices[r]);return fi.sub(s,s,o),fi.sub(l,l,o),[o,s,l]}containsPoint(i){const t=this.vertices.length;let e=1/0;for(let n=0;n<t;n++){const[r,o,s]=this.getTransformedVertices(n),l=fi.sub(fi.create(),i,r);fi.normalize(l,l),fi.normalize(o,o),fi.normalize(s,s);const c=fi.cross(fi.create(),o,l),y=fi.cross(fi.create(),l,s),_=fi.dot(r,c),C=fi.dot(r,y);e=Math.min(e,_,C)}return e}getTriangleArea(i,t,e){fi.lerp(W0,t,e,.5),fi.lerp(H0,e,i,.5),fi.lerp(X0,i,t,.5),fi.normalize(W0,W0),fi.normalize(H0,H0),fi.normalize(X0,X0);const n=ylt(W0,H0,X0),r=Math.max(-1,Math.min(1,n));return Math.abs(r)<1e-8?2*r:Math.asin(r)*2}getArea(){return this._area===null&&(this._area=this._getArea()),this._area}_getArea(){if(this.vertices.length<3)return 0;if(this.vertices.length===3)return this._area=this.getTriangleArea(this.vertices[0],this.vertices[1],this.vertices[2]),this._area;fi.set(Td,0,0,0);for(const t of this.vertices)fi.add(Td,Td,t);fi.normalize(Td,Td);let i=0;for(let t=0;t<this.vertices.length;t++){const e=this.vertices[t],n=this.vertices[(t+1)%this.vertices.length],r=this.getTriangleArea(Td,e,n);isNaN(r)||(i+=r)}return this._area=i,this._area}isWindingCorrect(){if(!(this.getArea()>0))debugger}};Fo.setMatrixArrayType(Float64Array);var q0=class extends _lt{constructor(i){if(i.length!==3)throw new Error("SphericalTriangleShape requires exactly 3 vertices");super(i)}};Fo.setMatrixArrayType(Float64Array);var blt=class{forward(i,t,e){const[n,r,o]=t,s=new q0([n,r,o]),l=fi.subtract(fi.create(),i,n);fi.normalize(l,l);const c=vlt(fi.create(),n,l,r,o);fi.normalize(c,c);const y=h1(n,i)/h1(n,c),_=s.getArea(),C=y/_,I=[1-y,C*new q0([n,c,o]).getArea(),C*new q0([n,r,c]).getArea()];return llt(I,e)}inverse(i,t,e){const[n,r,o]=e,s=new q0([n,r,o]),l=alt(i,t),c=1-1e-14;if(l[0]>c)return n;if(l[1]>c)return r;if(l[2]>c)return o;const y=fi.create();fi.cross(y,r,o);const _=s.getArea(),C=1-l[0],I=l[2]/C*_,k=Math.sin(I),z=Math.sin(I/2),V=2*z*z,X=fi.dot(n,r),H=fi.dot(r,o),$=fi.dot(o,n),Y=fi.length(y),ct=fi.dot(n,y),rt=k*ct+V*(X*H-$),nt=V*Y*(1+X),Ot=2/Math.acos(H)*Math.atan2(nt,rt),Kt=y2(fi.create(),r,o,Ot),ft=h1(n,Kt),st=this.safeAcos(C*ft)/this.safeAcos(ft);return y2([0,0,0],n,Kt,st)}safeAcos(i){return i<.001?2*i+i*i*i/3:Math.acos(1-2*i*i)}};Fo.setMatrixArrayType(Float64Array);var ha=-1,ko=1,xlt=([i,t])=>vn.fromValues(i-t,t),v2=vn.fromValues(1,0),_2=vn.fromValues(0,1),LI=vn.negate(vn.create(),v2),DI=vn.negate(vn.create(),_2),f1=vn.fromValues(0,0),wlt=(i,[t,e])=>{let n=f1,r=f1;switch(t===ko&&e===ko?(n=v2,r=_2):t===ha&&e===ko?(n=DI,r=LI):t===ko&&e===ha?(n=_2,r=v2):t===ha&&e===ha&&(n=LI,r=DI),i){case 0:return f1;case 1:return n;case 2:return vn.add(vn.create(),r,n);case 3:return vn.scaleAndAdd(vn.create(),r,n,2);default:throw new Error(`Invalid Quaternary value: ${i}`)}},kI=i=>[[ko,ko],[ko,ha],[ko,ko],[ha,ko]][i],OI=vn.fromValues(-1,1);function DD(i){return Array.from({length:i.length},(t,e)=>i.indexOf(e))}var kD=[0,1,3,4,5,6,7,2],OD=[0,1,2,7,3,4,5,6];DD(kD);DD(OD);var Elt=(i,t,e,n,r)=>{if(t<=0)return;const o=i[t]||0,s=i[t-1],l=e[0]+e[1];let c=!0,y=!0;if(n!==(l===0)?(c=o===1||o===2,y=o===1):(c=o<2,y=o===0),!c)return;const _=y?s:s+4,C=r[_];i[t-1]=C%4,i[t]=(o+4+Math.floor(C/4)-Math.floor(_/4))%4},Clt=(i,t,e)=>{let n=BigInt(i);const r=e==="vu"||e==="wu"||e==="vw",o=e==="wv"||e==="vw",s=e==="wu"||e==="uw";r&&(n=(1n<<BigInt(2*t))-n-1n);const l=Tlt(n,t,o,s);if(s){const{offset:[c,y],flips:[_,C]}=l;l.offset=[y,c],_===ha&&vn.add(l.offset,l.offset,OI),C===ha&&vn.subtract(l.offset,l.offset,OI)}if(o){const{offset:[c,y],flips:_}=l,C=(1<<t)-(c+y);_[0]=-_[0],l.offset[1]=C,l.flips=_}return l},Tlt=(i,t,e,n)=>{const r=vn.create(),o=[ko,ko];let s=BigInt(i);const l=[];for(;s>0n||l.length<t;)l.push(Number(s%4n)),s=s>>2n;const c=n?OD:kD;for(let _=l.length-1;_>=0;_--)Elt(l,_,o,e,c),vn.multiply(o,o,kI(l[_]));o[0]=ko,o[1]=ko;for(let _=l.length-1;_>=0;_--){vn.scale(r,r,2);const C=wlt(l[_],o);vn.add(r,r,C),vn.multiply(o,o,kI(l[_]))}const y=l[0]||0;return{flips:o,k:y,offset:xlt(r)}};Fo.setMatrixArrayType(Float64Array);var Slt=vn.clone(dm),Plt=vn.negate(vn.create(),dm),Ew=[0,1,2,3,4].map(i=>{const t=of.create();return of.fromRotation(t,dy*i),t}),FI=vn.create();function Ilt(i,t,e){const n=tlt.clone();vn.transformMat2(FI,e.offset,SD),e.flips[0]===ko&&e.flips[1]===ha&&n.rotate180();const{k:r}=e,o=e.flips[0]+e.flips[1];return((o===-2||o===2)&&r>1||o===0&&(r===0||r===3))&&n.reflectY(),e.flips[0]===ha&&e.flips[1]===ha?n.rotate180():e.flips[0]===ha?n.translate(Plt):e.flips[1]===ha&&n.translate(Slt),n.translate(FI),n.scale(1/2**i),n.transform(Ew[t]),n}function FD(i){const t=ilt.clone();return t.transform(Ew[i]),t}function Mlt(){const i=[];for(const t of Ew)i.push(vn.transformMat2(vn.create(),Ay,t));return i.reverse(),new ww(i)}Fo.setMatrixArrayType(Float64Array);var Blt=class{constructor(){if(this.vertices=[],this.invocations=0,this.addFaceCenters(),this.addVertices(),this.addMidpoints(),this.vertices.length!==62)throw new Error("Failed to construct CRS: vertices length is not 62");Object.freeze(this.vertices)}getVertex(i){this.invocations++,this.invocations===1e4&&console.warn("Too many CRS invocations, results should be cached");for(const t of this.vertices)if(fi.distance(i,t)<1e-5)return t;throw new Error("Failed to find vertex in CRS")}addFaceCenters(){yl.forEach(i=>this.add(hp(i.axis)))}addVertices(){const i=Math.atan(Yat);for(const t of yl)for(let e=0;e<5;e++){const n=(2*e+1)*Math.PI/5,r=hp([n+t.angle,i]);fi.transformQuat(r,r,t.quat),this.add(r)}}addMidpoints(){const i=Math.atan(Zy);for(const t of yl)for(let e=0;e<5;e++){const n=2*e*Math.PI/5,r=hp([n+t.angle,i]);fi.transformQuat(r,r,t.quat),this.add(r)}}add(i){const t=fi.normalize(fi.create(),i);return this.vertices.find(e=>fi.distance(t,e)<1e-5)?!1:(this.vertices.push(t),!0)}};Fo.setMatrixArrayType(Float64Array);var Rlt=new Blt,Llt=class{constructor(){this.faceTriangles=[],this.sphericalTriangles=[],this.polyhedral=new blt,this.gnomonic=new glt}forward(i,t){const e=yl[t],n=hp(i),r=fi.create();fi.transformQuat(r,n,e.inverseQuat);const o=g2(r),s=this.gnomonic.forward(o);s[1]=s[1]-e.angle;const l=this.getFaceTriangleIndex(s),c=this.shouldReflect(s);let y=this.getFaceTriangle(l,c,!1),_=this.getSphericalTriangle(l,t,c);return this.polyhedral.forward(n,_,y)}inverse(i,t){const e=wI(i),n=this.getFaceTriangleIndex(e),r=this.shouldReflect(e),o=this.getFaceTriangle(n,r,!1),s=this.getSphericalTriangle(n,t,r),l=this.polyhedral.inverse(i,o,s);return g2(l)}shouldReflect(i){const[t,e]=i;return olt([t,this.normalizeGamma(e)])[0]>Zy}getFaceTriangleIndex([i,t]){return(Math.floor(t/au)+10)%10}getFaceTriangle(i,t=!1,e=!1){let n=i;return t&&(n+=e?20:10),this.faceTriangles[n]?this.faceTriangles[n]:(this.faceTriangles[n]=t?this._getReflectedFaceTriangle(i,e):this._getFaceTriangle(i),Object.freeze(this.faceTriangles[n]),this.faceTriangles[n])}_getFaceTriangle(i){const t=Math.floor((i+1)/2)%5,[e,n,r]=FD(t).getVertices(),o=vn.create();return vn.lerp(o,n,r,.5),i%2===0?[e,o,n]:[e,r,o]}_getReflectedFaceTriangle(i,t=!1){let[e,n,r]=this._getFaceTriangle(i).map(l=>vn.clone(l));const o=i%2===0;vn.negate(e,e);const s=o?n:r;return vn.scaleAndAdd(e,e,s,t?1+1/Math.cos(A2):2),[e,r,n]}getSphericalTriangle(i,t,e=!1){let n=10*t+i;return e&&(n+=120),this.sphericalTriangles[n]?this.sphericalTriangles[n]:(this.sphericalTriangles[n]=this._getSphericalTriangle(i,t,e),Object.freeze(this.sphericalTriangles[n]),this.sphericalTriangles[n])}_getSphericalTriangle(i,t,e=!1){const n=yl[t];return this.getFaceTriangle(i,e,!0).map(r=>{const[o,s]=wI(r),l=[o,s+n.angle],c=hp(this.gnomonic.inverse(l));return fi.transformQuat(c,c,n.quat),Rlt.getVertex(c)})}normalizeGamma(i){const t=i/dy,e=Math.round(t);return(t-e)*dy}},fp=2,Dlt=30,klt=58n,Olt=0x3ffffffffffffffn;function Flt(i){let t=Dlt-1,e=i>>1n;for(;t>-1&&(e&0b1n)===0n;)t-=1,e=e>>(t<fp?1n:2n);return t}function Nlt(i){const t=Flt(i);if(t===-1)return{origin:yl[0],segment:0,S:0n,resolution:t};const e=Number(i>>58n);let n,r;if(t===0)n=yl[e],r=0;else{const y=Math.floor(e/5);n=yl[y],r=(e+n.firstQuintant)%5}if(!n)throw new Error(`Could not parse origin: ${e}`);if(t<fp)return{origin:n,segment:r,S:0n,resolution:t};const o=t-fp+1,s=BigInt(2*o),l=klt-s,c=(i&Olt)>>l;return{origin:n,segment:r,S:c,resolution:t}}Fo.setMatrixArrayType(Float64Array);of.create();var zlt=new Llt;function Ult({S:i,segment:t,origin:e,resolution:n}){const{quintant:r,orientation:o}=mlt(t,e);if(n===fp-1)return FD(r);if(n===fp-2)return Mlt();const s=n-fp+1,l=Clt(i,s,o);return Ilt(s,r,l)}function Vlt(i,{closedRing:t=!0,segments:e="auto"}={closedRing:!0,segments:"auto"}){const{S:n,segment:r,origin:o,resolution:s}=Nlt(i);e==="auto"&&(e=Math.max(1,Math.pow(2,6-s)));const l=Ult({S:n,segment:r,origin:o,resolution:s}).splitEdges(e).getVertices().map(y=>zlt.inverse(y,o.id)).map(y=>MD(y)),c=clt(l);return t&&c.push(c[0]),c.reverse(),c}function Glt(i){return BigInt(`0x${i}`)}Fo.setMatrixArrayType(Float64Array);var Ui=(function(i){i=i||{};var t=typeof i<"u"?i:{},e={},n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);var r="";function o(mt){return t.locateFile?t.locateFile(mt,r):r+mt}var s;typeof document<"u"&&document.currentScript&&(r=document.currentScript.src),r.indexOf("blob:")!==0?r=r.substr(0,r.lastIndexOf("/")+1):r="",s=function(mt,wt,lt){var pt=new XMLHttpRequest;pt.open("GET",mt,!0),pt.responseType="arraybuffer",pt.onload=function(){if(pt.status==200||pt.status==0&&pt.response){wt(pt.response);return}var d=Fe(mt);if(d){wt(d.buffer);return}lt()},pt.onerror=lt,pt.send(null)};var l=t.print||console.log.bind(console),c=t.printErr||console.warn.bind(console);for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);e=null,t.arguments&&t.arguments;var y=0,_=function(mt){y=mt},C=function(){return y},I=8;function k(mt,wt,lt,pt){switch(lt=lt||"i8",lt.charAt(lt.length-1)==="*"&&(lt="i32"),lt){case"i1":K[mt>>0]=wt;break;case"i8":K[mt>>0]=wt;break;case"i16":Tt[mt>>1]=wt;break;case"i32":ue[mt>>2]=wt;break;case"i64":er=[wt>>>0,(Bn=wt,+Pi(Bn)>=1?Bn>0?(wi(+xi(Bn/4294967296),4294967295)|0)>>>0:~~+Xn((Bn-+(~~Bn>>>0))/4294967296)>>>0:0)],ue[mt>>2]=er[0],ue[mt+4>>2]=er[1];break;case"float":Rt[mt>>2]=wt;break;case"double":Ft[mt>>3]=wt;break;default:Nt("invalid type for setValue: "+lt)}}function z(mt,wt,lt){switch(wt=wt||"i8",wt.charAt(wt.length-1)==="*"&&(wt="i32"),wt){case"i1":return K[mt>>0];case"i8":return K[mt>>0];case"i16":return Tt[mt>>1];case"i32":return ue[mt>>2];case"i64":return ue[mt>>2];case"float":return Rt[mt>>2];case"double":return Ft[mt>>3];default:Nt("invalid type for getValue: "+wt)}return null}var V=!1;function X(mt,wt){mt||Nt("Assertion failed: "+wt)}function H(mt){var wt=t["_"+mt];return X(wt,"Cannot call unknown function "+mt+", make sure it is exported"),wt}function $(mt,wt,lt,pt,d){var tt={string:function(De){var Ze=0;if(De!=null&&De!==0){var Gi=(De.length<<2)+1;Ze=Ee(Gi),Kt(De,Ze,Gi)}return Ze},array:function(De){var Ze=Ee(De.length);return ft(De,Ze),Ze}};function Pe(De){return wt==="string"?nt(De):wt==="boolean"?!!De:De}var ne=H(mt),Ie=[],ke=0;if(pt)for(var Ue=0;Ue<pt.length;Ue++){var ge=tt[lt[Ue]];ge?(ke===0&&(ke=St()),Ie[Ue]=ge(pt[Ue])):Ie[Ue]=pt[Ue]}var Ve=ne.apply(null,Ie);return Ve=Pe(Ve),ke!==0&&Me(ke),Ve}function Y(mt,wt,lt,pt){lt=lt||[];var d=lt.every(function(Pe){return Pe==="number"}),tt=wt!=="string";return tt&&d&&!pt?H(mt):function(){return $(mt,wt,lt,arguments)}}var ct=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function rt(mt,wt,lt){for(var pt=wt+lt,d=wt;mt[d]&&!(d>=pt);)++d;if(d-wt>16&&mt.subarray&&ct)return ct.decode(mt.subarray(wt,d));for(var tt="";wt<d;){var Pe=mt[wt++];if(!(Pe&128)){tt+=String.fromCharCode(Pe);continue}var ne=mt[wt++]&63;if((Pe&224)==192){tt+=String.fromCharCode((Pe&31)<<6|ne);continue}var Ie=mt[wt++]&63;if((Pe&240)==224?Pe=(Pe&15)<<12|ne<<6|Ie:Pe=(Pe&7)<<18|ne<<12|Ie<<6|mt[wt++]&63,Pe<65536)tt+=String.fromCharCode(Pe);else{var ke=Pe-65536;tt+=String.fromCharCode(55296|ke>>10,56320|ke&1023)}}return tt}function nt(mt,wt){return mt?rt(dt,mt,wt):""}function Ot(mt,wt,lt,pt){if(!(pt>0))return 0;for(var d=lt,tt=lt+pt-1,Pe=0;Pe<mt.length;++Pe){var ne=mt.charCodeAt(Pe);if(ne>=55296&&ne<=57343){var Ie=mt.charCodeAt(++Pe);ne=65536+((ne&1023)<<10)|Ie&1023}if(ne<=127){if(lt>=tt)break;wt[lt++]=ne}else if(ne<=2047){if(lt+1>=tt)break;wt[lt++]=192|ne>>6,wt[lt++]=128|ne&63}else if(ne<=65535){if(lt+2>=tt)break;wt[lt++]=224|ne>>12,wt[lt++]=128|ne>>6&63,wt[lt++]=128|ne&63}else{if(lt+3>=tt)break;wt[lt++]=240|ne>>18,wt[lt++]=128|ne>>12&63,wt[lt++]=128|ne>>6&63,wt[lt++]=128|ne&63}}return wt[lt]=0,lt-d}function Kt(mt,wt,lt){return Ot(mt,dt,wt,lt)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function ft(mt,wt){K.set(mt,wt)}function st(mt,wt){return mt%wt>0&&(mt+=wt-mt%wt),mt}var Ut,K,dt,Tt,ue,Rt,Ft;function Gt(mt){Ut=mt,t.HEAP8=K=new Int8Array(mt),t.HEAP16=Tt=new Int16Array(mt),t.HEAP32=ue=new Int32Array(mt),t.HEAPU8=dt=new Uint8Array(mt),t.HEAPU16=new Uint16Array(mt),t.HEAPU32=new Uint32Array(mt),t.HEAPF32=Rt=new Float32Array(mt),t.HEAPF64=Ft=new Float64Array(mt)}var se=5271520,le=28608,de=t.TOTAL_MEMORY||33554432;t.buffer?Ut=t.buffer:Ut=new ArrayBuffer(de),de=Ut.byteLength,Gt(Ut),ue[le>>2]=se;function ye(mt){for(;mt.length>0;){var wt=mt.shift();if(typeof wt=="function"){wt();continue}var lt=wt.func;typeof lt=="number"?wt.arg===void 0?t.dynCall_v(lt):t.dynCall_vi(lt,wt.arg):lt(wt.arg===void 0?null:wt.arg)}}var Oe=[],Le=[],fe=[],_i=[];function ei(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)cn(t.preRun.shift());ye(Oe)}function ii(){ye(Le)}function Qe(){ye(fe)}function yi(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)Ni(t.postRun.shift());ye(_i)}function cn(mt){Oe.unshift(mt)}function Ni(mt){_i.unshift(mt)}var Pi=Math.abs,Xn=Math.ceil,xi=Math.floor,wi=Math.min,mn=0,zi=null;function cr(mt){mn++,t.monitorRunDependencies&&t.monitorRunDependencies(mn)}function tr(mt){if(mn--,t.monitorRunDependencies&&t.monitorRunDependencies(mn),mn==0&&zi){var wt=zi;zi=null,wt()}}t.preloadedImages={},t.preloadedAudios={};var xn=null,sr="data:application/octet-stream;base64,";function qn(mt){return String.prototype.startsWith?mt.startsWith(sr):mt.indexOf(sr)===0}var Bn,er;xn="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Ke=28624;function bi(mt,wt,lt,pt){Nt("Assertion failed: "+nt(mt)+", at: "+[wt?nt(wt):"unknown filename",lt,pt?nt(pt):"unknown function"])}function Oi(){return K.length}function on(mt,wt,lt){dt.set(dt.subarray(wt,wt+lt),mt)}function Ar(mt){return t.___errno_location&&(ue[t.___errno_location()>>2]=mt),mt}function Lt(mt){Nt("OOM")}function je(mt){try{var wt=new ArrayBuffer(mt);return wt.byteLength!=mt?void 0:(new Int8Array(wt).set(K),q(wt),Gt(wt),1)}catch{}}function $e(mt){var wt=Oi(),lt=16777216,pt=2147483648-lt;if(mt>pt)return!1;for(var d=16777216,tt=Math.max(wt,d);tt<mt;)tt<=536870912?tt=st(2*tt,lt):tt=Math.min(st((3*tt+2147483648)/4,lt),pt);var Pe=je(tt);return!!Pe}var di=typeof atob=="function"?atob:function(mt){var wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",lt="",pt,d,tt,Pe,ne,Ie,ke,Ue=0;mt=mt.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Pe=wt.indexOf(mt.charAt(Ue++)),ne=wt.indexOf(mt.charAt(Ue++)),Ie=wt.indexOf(mt.charAt(Ue++)),ke=wt.indexOf(mt.charAt(Ue++)),pt=Pe<<2|ne>>4,d=(ne&15)<<4|Ie>>2,tt=(Ie&3)<<6|ke,lt=lt+String.fromCharCode(pt),Ie!==64&&(lt=lt+String.fromCharCode(d)),ke!==64&&(lt=lt+String.fromCharCode(tt));while(Ue<mt.length);return lt};function oe(mt){try{for(var wt=di(mt),lt=new Uint8Array(wt.length),pt=0;pt<wt.length;++pt)lt[pt]=wt.charCodeAt(pt);return lt}catch{throw new Error("Converting base64 string to bytes failed.")}}function Fe(mt){if(qn(mt))return oe(mt.slice(sr.length))}var vt={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},qe={b:_,c:C,d:bi,e:Ar,f:Oi,g:on,h:$e,i:Lt,o:Ke,p:le},Ce=(function(mt,wt,lt){"almost asm";var pt=new mt.Int8Array(lt),d=new mt.Int32Array(lt);new mt.Uint8Array(lt),new mt.Float32Array(lt);var tt=new mt.Float64Array(lt),Pe=wt.o|0,ne=wt.p|0,Ie=mt.Math.floor,ke=mt.Math.abs,Ue=mt.Math.sqrt,ge=mt.Math.pow,Ve=mt.Math.cos,De=mt.Math.sin,Ze=mt.Math.tan,Gi=mt.Math.acos,si=mt.Math.asin,rn=mt.Math.atan,hn=mt.Math.atan2,Yi=mt.Math.ceil,Ji=mt.Math.imul,Hi=mt.Math.min,mr=mt.Math.max,Qi=mt.Math.clz32,mi=wt.b,_t=wt.c,ti=wt.d,sn=wt.e,Wr=wt.f,ga=wt.g,hr=wt.h,Kn=wt.i,gt=28640;function Qo(f){return pt=new Int8Array(f),d=new Int32Array(f),tt=new Float64Array(f),lt=f,!0}function Zn(f){f=f|0;var h=0;return h=gt,gt=gt+f|0,gt=gt+15&-16,h|0}function Jo(){return gt|0}function Lr(f){f=f|0,gt=f}function fr(f,h){f=f|0,gt=f}function Tr(f,h){f=f|0,h=h|0;var A=0,b=0,E=0;return(f|0)<0?(h=2,h|0):(f|0)>13780509?(h=ao(15,h)|0,h|0):(A=((f|0)<0)<<31>>31,E=v(f|0,A|0,3,0)|0,b=_t()|0,A=Ei(f|0,A|0,1,0)|0,A=v(E|0,b|0,A|0,_t()|0)|0,A=Ei(A|0,_t()|0,1,0)|0,f=_t()|0,d[h>>2]=A,d[h+4>>2]=f,h=0,h|0)}function Fn(f,h,A,b){return f=f|0,h=h|0,A=A|0,b=b|0,gs(f,h,A,b,0)|0}function gs(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0;if(F=gt,gt=gt+16|0,P=F,!(Hr(f,h,A,b,E)|0))return b=0,gt=F,b|0;do if((A|0)>=0){if((A|0)>13780509){if(S=ao(15,P)|0,S|0)break;R=P,P=d[R>>2]|0,R=d[R+4>>2]|0}else S=((A|0)<0)<<31>>31,U=v(A|0,S|0,3,0)|0,R=_t()|0,S=Ei(A|0,S|0,1,0)|0,S=v(U|0,R|0,S|0,_t()|0)|0,S=Ei(S|0,_t()|0,1,0)|0,R=_t()|0,d[P>>2]=S,d[P+4>>2]=R,P=S;if(Bt(b|0,0,P<<3|0)|0,E|0){Bt(E|0,0,P<<2|0)|0,S=Ms(f,h,A,b,E,P,R,0)|0;break}S=Pr(P,4)|0,S?(U=Ms(f,h,A,b,S,P,R,0)|0,Fi(S),S=U):S=13}else S=2;while(!1);return U=S,gt=F,U|0}function Hr(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0;if(Yt=gt,gt=gt+16|0,It=Yt,Mt=Yt+8|0,Pt=It,d[Pt>>2]=f,d[Pt+4>>2]=h,(A|0)<0)return Mt=2,gt=Yt,Mt|0;if(S=b,d[S>>2]=f,d[S+4>>2]=h,S=(E|0)!=0,S&&(d[E>>2]=0),Rn(f,h)|0)return Mt=9,gt=Yt,Mt|0;d[Mt>>2]=0;t:do if((A|0)>=1)if(S)for(W=1,U=0,ht=0,Pt=1,S=f;;){if(!(U|ht)){if(S=Ln(S,h,4,Mt,It)|0,S|0)break t;if(h=It,S=d[h>>2]|0,h=d[h+4>>2]|0,Rn(S,h)|0){S=9;break t}}if(S=Ln(S,h,d[26800+(ht<<2)>>2]|0,Mt,It)|0,S|0)break t;if(h=It,S=d[h>>2]|0,h=d[h+4>>2]|0,f=b+(W<<3)|0,d[f>>2]=S,d[f+4>>2]=h,d[E+(W<<2)>>2]=Pt,f=U+1|0,P=(f|0)==(Pt|0),R=ht+1|0,F=(R|0)==6,Rn(S,h)|0){S=9;break t}if(Pt=Pt+(F&P&1)|0,(Pt|0)>(A|0)){S=0;break}else W=W+1|0,U=P?0:f,ht=P?F?0:R:ht}else for(W=1,U=0,ht=0,Pt=1,S=f;;){if(!(U|ht)){if(S=Ln(S,h,4,Mt,It)|0,S|0)break t;if(h=It,S=d[h>>2]|0,h=d[h+4>>2]|0,Rn(S,h)|0){S=9;break t}}if(S=Ln(S,h,d[26800+(ht<<2)>>2]|0,Mt,It)|0,S|0)break t;if(h=It,S=d[h>>2]|0,h=d[h+4>>2]|0,f=b+(W<<3)|0,d[f>>2]=S,d[f+4>>2]=h,f=U+1|0,P=(f|0)==(Pt|0),R=ht+1|0,F=(R|0)==6,Rn(S,h)|0){S=9;break t}if(Pt=Pt+(F&P&1)|0,(Pt|0)>(A|0)){S=0;break}else W=W+1|0,U=P?0:f,ht=P?F?0:R:ht}else S=0;while(!1);return Mt=S,gt=Yt,Mt|0}function Ms(f,h,A,b,E,S,P,R){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0,S=S|0,P=P|0,R=R|0;var F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0;if(Yt=gt,gt=gt+16|0,It=Yt+8|0,Mt=Yt,F=w(f|0,h|0,S|0,P|0)|0,W=_t()|0,ht=b+(F<<3)|0,Ht=ht,ie=d[Ht>>2]|0,Ht=d[Ht+4>>2]|0,U=(ie|0)==(f|0)&(Ht|0)==(h|0),!((ie|0)==0&(Ht|0)==0|U))do F=Ei(F|0,W|0,1,0)|0,F=g(F|0,_t()|0,S|0,P|0)|0,W=_t()|0,ht=b+(F<<3)|0,ie=ht,Ht=d[ie>>2]|0,ie=d[ie+4>>2]|0,U=(Ht|0)==(f|0)&(ie|0)==(h|0);while(!((Ht|0)==0&(ie|0)==0|U));if(F=E+(F<<2)|0,U&&(d[F>>2]|0)<=(R|0)||(ie=ht,d[ie>>2]=f,d[ie+4>>2]=h,d[F>>2]=R,(R|0)>=(A|0)))return ie=0,gt=Yt,ie|0;switch(U=R+1|0,d[It>>2]=0,F=Ln(f,h,2,It,Mt)|0,F|0){case 9:{Pt=9;break}case 0:{F=Mt,F=Ms(d[F>>2]|0,d[F+4>>2]|0,A,b,E,S,P,U)|0,F||(Pt=9);break}}t:do if((Pt|0)==9){switch(d[It>>2]=0,F=Ln(f,h,3,It,Mt)|0,F|0){case 9:break;case 0:{if(F=Mt,F=Ms(d[F>>2]|0,d[F+4>>2]|0,A,b,E,S,P,U)|0,F|0)break t;break}default:break t}switch(d[It>>2]=0,F=Ln(f,h,1,It,Mt)|0,F|0){case 9:break;case 0:{if(F=Mt,F=Ms(d[F>>2]|0,d[F+4>>2]|0,A,b,E,S,P,U)|0,F|0)break t;break}default:break t}switch(d[It>>2]=0,F=Ln(f,h,5,It,Mt)|0,F|0){case 9:break;case 0:{if(F=Mt,F=Ms(d[F>>2]|0,d[F+4>>2]|0,A,b,E,S,P,U)|0,F|0)break t;break}default:break t}switch(d[It>>2]=0,F=Ln(f,h,4,It,Mt)|0,F|0){case 9:break;case 0:{if(F=Mt,F=Ms(d[F>>2]|0,d[F+4>>2]|0,A,b,E,S,P,U)|0,F|0)break t;break}default:break t}switch(d[It>>2]=0,F=Ln(f,h,6,It,Mt)|0,F|0){case 9:break;case 0:{if(F=Mt,F=Ms(d[F>>2]|0,d[F+4>>2]|0,A,b,E,S,P,U)|0,F|0)break t;break}default:break t}return ie=0,gt=Yt,ie|0}while(!1);return ie=F,gt=Yt,ie|0}function Ln(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0;if(A>>>0>6)return E=1,E|0;if(ht=(d[b>>2]|0)%6|0,d[b>>2]=ht,(ht|0)>0){S=0;do A=Rs(A)|0,S=S+1|0;while((S|0)<(d[b>>2]|0))}if(ht=D(f|0,h|0,45)|0,_t()|0,W=ht&127,W>>>0>121)return E=5,E|0;F=vs(f,h)|0,S=D(f|0,h|0,52)|0,_t()|0,S=S&15;t:do if(!S)U=8;else{for(;;){if(P=(15-S|0)*3|0,R=D(f|0,h|0,P|0)|0,_t()|0,R=R&7,(R|0)==7){h=5;break}if(Mt=(_s(S)|0)==0,S=S+-1|0,Pt=O(7,0,P|0)|0,h=h&~(_t()|0),It=O(d[(Mt?432:16)+(R*28|0)+(A<<2)>>2]|0,0,P|0)|0,P=_t()|0,A=d[(Mt?640:224)+(R*28|0)+(A<<2)>>2]|0,f=It|f&~Pt,h=P|h,!A){A=0;break t}if(!S){U=8;break t}}return h|0}while(!1);(U|0)==8&&(Mt=d[848+(W*28|0)+(A<<2)>>2]|0,It=O(Mt|0,0,45)|0,f=It|f,h=_t()|0|h&-1040385,A=d[4272+(W*28|0)+(A<<2)>>2]|0,(Mt&127|0)==127&&(Mt=O(d[848+(W*28|0)+20>>2]|0,0,45)|0,h=_t()|0|h&-1040385,A=d[4272+(W*28|0)+20>>2]|0,f=Ks(Mt|f,h)|0,h=_t()|0,d[b>>2]=(d[b>>2]|0)+1)),R=D(f|0,h|0,45)|0,_t()|0,R=R&127;t:do if(Tn(R)|0){e:do if((vs(f,h)|0)==1){if((W|0)!=(R|0))if(ac(R,d[7696+(W*28|0)>>2]|0)|0){f=Rl(f,h)|0,P=1,h=_t()|0;break}else ti(27795,26864,533,26872);switch(F|0){case 3:{f=Ks(f,h)|0,h=_t()|0,d[b>>2]=(d[b>>2]|0)+1,P=0;break e}case 5:{f=Rl(f,h)|0,h=_t()|0,d[b>>2]=(d[b>>2]|0)+5,P=0;break e}case 0:return Mt=9,Mt|0;default:return Mt=1,Mt|0}}else P=0;while(!1);if((A|0)>0){S=0;do f=gc(f,h)|0,h=_t()|0,S=S+1|0;while((S|0)!=(A|0))}if((W|0)!=(R|0)){if(!(Xr(R)|0)){if((P|0)!=0|(vs(f,h)|0)!=5)break;d[b>>2]=(d[b>>2]|0)+1;break}switch(ht&127){case 8:case 118:break t}(vs(f,h)|0)!=3&&(d[b>>2]=(d[b>>2]|0)+1)}}else if((A|0)>0){S=0;do f=Ks(f,h)|0,h=_t()|0,S=S+1|0;while((S|0)!=(A|0))}while(!1);return d[b>>2]=((d[b>>2]|0)+A|0)%6|0,Mt=E,d[Mt>>2]=f,d[Mt+4>>2]=h,Mt=0,Mt|0}function ah(f,h,A,b){return f=f|0,h=h|0,A=A|0,b=b|0,yt(f,h,A,b)|0?(Bt(b|0,0,A*48|0)|0,b=Dt(f,h,A,b)|0,b|0):(b=0,b|0)}function yt(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0;if(Mt=gt,gt=gt+16|0,Pt=Mt,It=Mt+8|0,ht=Pt,d[ht>>2]=f,d[ht+4>>2]=h,(A|0)<0)return It=2,gt=Mt,It|0;if(!A)return It=b,d[It>>2]=f,d[It+4>>2]=h,It=0,gt=Mt,It|0;d[It>>2]=0;t:do if(Rn(f,h)|0)f=9;else{E=0,ht=f;do{if(f=Ln(ht,h,4,It,Pt)|0,f|0)break t;if(h=Pt,ht=d[h>>2]|0,h=d[h+4>>2]|0,E=E+1|0,Rn(ht,h)|0){f=9;break t}}while((E|0)<(A|0));W=b,d[W>>2]=ht,d[W+4>>2]=h,W=A+-1|0,U=0,f=1;do{if(E=26800+(U<<2)|0,(U|0)==5)for(P=d[E>>2]|0,S=0,E=f;;){if(f=Pt,f=Ln(d[f>>2]|0,d[f+4>>2]|0,P,It,Pt)|0,f|0)break t;if((S|0)!=(W|0))if(F=Pt,R=d[F>>2]|0,F=d[F+4>>2]|0,f=b+(E<<3)|0,d[f>>2]=R,d[f+4>>2]=F,!(Rn(R,F)|0))f=E+1|0;else{f=9;break t}else f=E;if(S=S+1|0,(S|0)>=(A|0))break;E=f}else for(P=Pt,F=d[E>>2]|0,R=0,E=f,S=d[P>>2]|0,P=d[P+4>>2]|0;;){if(f=Ln(S,P,F,It,Pt)|0,f|0)break t;if(P=Pt,S=d[P>>2]|0,P=d[P+4>>2]|0,f=b+(E<<3)|0,d[f>>2]=S,d[f+4>>2]=P,f=E+1|0,Rn(S,P)|0){f=9;break t}if(R=R+1|0,(R|0)>=(A|0))break;E=f}U=U+1|0}while(U>>>0<6);f=Pt,f=(ht|0)==(d[f>>2]|0)&&(h|0)==(d[f+4>>2]|0)?0:9}while(!1);return It=f,gt=Mt,It|0}function Dt(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0;if(ht=gt,gt=gt+16|0,P=ht,!A)return d[b>>2]=f,d[b+4>>2]=h,b=0,gt=ht,b|0;do if((A|0)>=0){if((A|0)>13780509){if(E=ao(15,P)|0,E|0)break;S=P,E=d[S>>2]|0,S=d[S+4>>2]|0}else E=((A|0)<0)<<31>>31,W=v(A|0,E|0,3,0)|0,S=_t()|0,E=Ei(A|0,E|0,1,0)|0,E=v(W|0,S|0,E|0,_t()|0)|0,E=Ei(E|0,_t()|0,1,0)|0,S=_t()|0,W=P,d[W>>2]=E,d[W+4>>2]=S;if(U=Pr(E,8)|0,!U)E=13;else{if(W=Pr(E,4)|0,!W){Fi(U),E=13;break}if(E=Ms(f,h,A,U,W,E,S,0)|0,E|0){Fi(U),Fi(W);break}if(h=d[P>>2]|0,P=d[P+4>>2]|0,(P|0)>0|(P|0)==0&h>>>0>0){E=0,R=0,F=0;do f=U+(R<<3)|0,S=d[f>>2]|0,f=d[f+4>>2]|0,!((S|0)==0&(f|0)==0)&&(d[W+(R<<2)>>2]|0)==(A|0)&&(Pt=b+(E<<3)|0,d[Pt>>2]=S,d[Pt+4>>2]=f,E=E+1|0),R=Ei(R|0,F|0,1,0)|0,F=_t()|0;while((F|0)<(P|0)|(F|0)==(P|0)&R>>>0<h>>>0)}Fi(U),Fi(W),E=0}}else E=2;while(!1);return Pt=E,gt=ht,Pt|0}function $t(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0;for(R=gt,gt=gt+16|0,S=R,P=R+8|0,E=(Rn(f,h)|0)==0,E=E?1:2;;){if(d[P>>2]=0,U=(Ln(f,h,E,P,S)|0)==0,F=S,U&((d[F>>2]|0)==(A|0)?(d[F+4>>2]|0)==(b|0):0)){f=4;break}if(E=E+1|0,E>>>0>=7){E=7,f=4;break}}return(f|0)==4?(gt=R,E|0):0}function Se(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0;if(R=gt,gt=gt+48|0,E=R+16|0,S=R+8|0,P=R,A=Os(A)|0,A|0)return P=A,gt=R,P|0;if(U=f,F=d[U+4>>2]|0,A=S,d[A>>2]=d[U>>2],d[A+4>>2]=F,un(S,E),A=ja(E,h,P)|0,!A){if(h=d[S>>2]|0,S=d[f+8>>2]|0,(S|0)>0){E=d[f+12>>2]|0,A=0;do h=(d[E+(A<<3)>>2]|0)+h|0,A=A+1|0;while((A|0)<(S|0))}A=P,E=d[A>>2]|0,A=d[A+4>>2]|0,S=((h|0)<0)<<31>>31,(A|0)<(S|0)|(A|0)==(S|0)&E>>>0<h>>>0?(A=P,d[A>>2]=h,d[A+4>>2]=S,A=S):h=E,F=Ei(h|0,A|0,12,0)|0,U=_t()|0,A=P,d[A>>2]=F,d[A+4>>2]=U,A=b,d[A>>2]=F,d[A+4>>2]=U,A=0}return U=A,gt=R,U|0}function Ye(f,h,A,b,E,S,P){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0,S=S|0,P=P|0;var R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0,Ge=0,ze=0,Ri=0,Ci=0,ji=0,Ti=0,ai=0,We=0,Wi=0,fn=0,Zi=0,gn=0,or=0,Ys=0;if(fn=gt,gt=gt+64|0,Ti=fn+48|0,ai=fn+32|0,We=fn+24|0,Be=fn+8|0,Ge=fn,F=d[f>>2]|0,(F|0)<=0)return Wi=0,gt=fn,Wi|0;for(ze=f+4|0,Ri=Ti+8|0,Ci=ai+8|0,ji=Be+8|0,R=0,Jt=0;;){U=d[ze>>2]|0,te=U+(Jt<<4)|0,d[Ti>>2]=d[te>>2],d[Ti+4>>2]=d[te+4>>2],d[Ti+8>>2]=d[te+8>>2],d[Ti+12>>2]=d[te+12>>2],(Jt|0)==(F+-1|0)?(d[ai>>2]=d[U>>2],d[ai+4>>2]=d[U+4>>2],d[ai+8>>2]=d[U+8>>2],d[ai+12>>2]=d[U+12>>2]):(te=U+(Jt+1<<4)|0,d[ai>>2]=d[te>>2],d[ai+4>>2]=d[te+4>>2],d[ai+8>>2]=d[te+8>>2],d[ai+12>>2]=d[te+12>>2]),F=Cf(Ti,ai,b,We)|0;t:do if(F)U=0,R=F;else if(F=We,U=d[F>>2]|0,F=d[F+4>>2]|0,(F|0)>0|(F|0)==0&U>>>0>0){ie=0,te=0;e:for(;;){if(gn=1/(+(U>>>0)+4294967296*+(F|0)),Ys=+tt[Ti>>3],F=Ur(U|0,F|0,ie|0,te|0)|0,or=+(F>>>0)+4294967296*+(_t()|0),Zi=+(ie>>>0)+4294967296*+(te|0),tt[Be>>3]=gn*(Ys*or)+gn*(+tt[ai>>3]*Zi),tt[ji>>3]=gn*(+tt[Ri>>3]*or)+gn*(+tt[Ci>>3]*Zi),F=Ah(Be,b,Ge)|0,F|0){R=F;break}Ht=Ge,Yt=d[Ht>>2]|0,Ht=d[Ht+4>>2]|0,Pt=w(Yt|0,Ht|0,h|0,A|0)|0,W=_t()|0,F=P+(Pt<<3)|0,ht=F,U=d[ht>>2]|0,ht=d[ht+4>>2]|0;i:do if((U|0)==0&(ht|0)==0)qt=F,Wi=16;else for(It=0,Mt=0;;){if((It|0)>(A|0)|(It|0)==(A|0)&Mt>>>0>h>>>0){R=1;break e}if((U|0)==(Yt|0)&(ht|0)==(Ht|0))break i;if(F=Ei(Pt|0,W|0,1,0)|0,Pt=g(F|0,_t()|0,h|0,A|0)|0,W=_t()|0,Mt=Ei(Mt|0,It|0,1,0)|0,It=_t()|0,F=P+(Pt<<3)|0,ht=F,U=d[ht>>2]|0,ht=d[ht+4>>2]|0,(U|0)==0&(ht|0)==0){qt=F,Wi=16;break}}while(!1);if((Wi|0)==16&&(Wi=0,!((Yt|0)==0&(Ht|0)==0))&&(Mt=qt,d[Mt>>2]=Yt,d[Mt+4>>2]=Ht,Mt=S+(d[E>>2]<<3)|0,d[Mt>>2]=Yt,d[Mt+4>>2]=Ht,Mt=E,Mt=Ei(d[Mt>>2]|0,d[Mt+4>>2]|0,1,0)|0,Yt=_t()|0,Ht=E,d[Ht>>2]=Mt,d[Ht+4>>2]=Yt),ie=Ei(ie|0,te|0,1,0)|0,te=_t()|0,F=We,U=d[F>>2]|0,F=d[F+4>>2]|0,!((F|0)>(te|0)|(F|0)==(te|0)&U>>>0>ie>>>0)){U=1;break t}}U=0}else U=1;while(!1);if(Jt=Jt+1|0,!U){Wi=21;break}if(F=d[f>>2]|0,(Jt|0)>=(F|0)){R=0,Wi=21;break}}return(Wi|0)==21?(gt=fn,R|0):0}function Xi(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0,Ge=0,ze=0,Ri=0,Ci=0,ji=0,Ti=0,ai=0,We=0,Wi=0,fn=0,Zi=0,gn=0,or=0;if(or=gt,gt=gt+112|0,Wi=or+80|0,F=or+72|0,fn=or,Zi=or+56|0,E=Os(A)|0,E|0)return gn=E,gt=or,gn|0;if(U=f+8|0,gn=ss((d[U>>2]<<5)+32|0)|0,!gn)return gn=13,gt=or,gn|0;if(Fs(f,gn),E=Os(A)|0,!E){if(ai=f,We=d[ai+4>>2]|0,E=F,d[E>>2]=d[ai>>2],d[E+4>>2]=We,un(F,Wi),E=ja(Wi,h,fn)|0,E)ai=0,We=0;else{if(E=d[F>>2]|0,S=d[U>>2]|0,(S|0)>0){P=d[f+12>>2]|0,A=0;do E=(d[P+(A<<3)>>2]|0)+E|0,A=A+1|0;while((A|0)!=(S|0));A=E}else A=E;E=fn,S=d[E>>2]|0,E=d[E+4>>2]|0,P=((A|0)<0)<<31>>31,(E|0)<(P|0)|(E|0)==(P|0)&S>>>0<A>>>0?(E=fn,d[E>>2]=A,d[E+4>>2]=P,E=P):A=S,ai=Ei(A|0,E|0,12,0)|0,We=_t()|0,E=fn,d[E>>2]=ai,d[E+4>>2]=We,E=0}if(!E){if(A=Pr(ai,8)|0,!A)return Fi(gn),gn=13,gt=or,gn|0;if(R=Pr(ai,8)|0,!R)return Fi(gn),Fi(A),gn=13,gt=or,gn|0;ji=Wi,d[ji>>2]=0,d[ji+4>>2]=0,ji=f,Ti=d[ji+4>>2]|0,E=F,d[E>>2]=d[ji>>2],d[E+4>>2]=Ti,E=Ye(F,ai,We,h,Wi,A,R)|0;t:do if(E)Fi(A),Fi(R),Fi(gn);else{e:do if((d[U>>2]|0)>0){for(P=f+12|0,S=0;E=Ye((d[P>>2]|0)+(S<<3)|0,ai,We,h,Wi,A,R)|0,S=S+1|0,!(E|0);)if((S|0)>=(d[U>>2]|0))break e;Fi(A),Fi(R),Fi(gn);break t}while(!1);(We|0)>0|(We|0)==0&ai>>>0>0&&Bt(R|0,0,ai<<3|0)|0,Ti=Wi,ji=d[Ti+4>>2]|0;e:do if((ji|0)>0|(ji|0)==0&(d[Ti>>2]|0)>>>0>0){ze=A,Ri=R,Ci=A,ji=R,Ti=A,E=A,qt=A,Be=R,Ge=R,A=R;i:for(;;){for(Ht=0,ie=0,te=0,Jt=0,S=0,P=0;;){R=fn,F=R+56|0;do d[R>>2]=0,R=R+4|0;while((R|0)<(F|0));if(h=ze+(Ht<<3)|0,U=d[h>>2]|0,h=d[h+4>>2]|0,Hr(U,h,1,fn,0)|0){R=fn,F=R+56|0;do d[R>>2]=0,R=R+4|0;while((R|0)<(F|0));R=Pr(7,4)|0,R|0&&(Ms(U,h,1,fn,R,7,0,0)|0,Fi(R))}for(Yt=0;;){Mt=fn+(Yt<<3)|0,It=d[Mt>>2]|0,Mt=d[Mt+4>>2]|0;n:do if((It|0)==0&(Mt|0)==0)R=S,F=P;else{if(W=w(It|0,Mt|0,ai|0,We|0)|0,U=_t()|0,R=b+(W<<3)|0,h=R,F=d[h>>2]|0,h=d[h+4>>2]|0,!((F|0)==0&(h|0)==0)){ht=0,Pt=0;do{if((ht|0)>(We|0)|(ht|0)==(We|0)&Pt>>>0>ai>>>0)break i;if((F|0)==(It|0)&(h|0)==(Mt|0)){R=S,F=P;break n}R=Ei(W|0,U|0,1,0)|0,W=g(R|0,_t()|0,ai|0,We|0)|0,U=_t()|0,Pt=Ei(Pt|0,ht|0,1,0)|0,ht=_t()|0,R=b+(W<<3)|0,h=R,F=d[h>>2]|0,h=d[h+4>>2]|0}while(!((F|0)==0&(h|0)==0))}if((It|0)==0&(Mt|0)==0){R=S,F=P;break}wa(It,Mt,Zi)|0,Dr(f,gn,Zi)|0&&(Pt=Ei(S|0,P|0,1,0)|0,P=_t()|0,ht=R,d[ht>>2]=It,d[ht+4>>2]=Mt,S=Ri+(S<<3)|0,d[S>>2]=It,d[S+4>>2]=Mt,S=Pt),R=S,F=P}while(!1);if(Yt=Yt+1|0,Yt>>>0>=7)break;S=R,P=F}if(Ht=Ei(Ht|0,ie|0,1,0)|0,ie=_t()|0,te=Ei(te|0,Jt|0,1,0)|0,Jt=_t()|0,P=Wi,S=d[P>>2]|0,P=d[P+4>>2]|0,(Jt|0)<(P|0)|(Jt|0)==(P|0)&te>>>0<S>>>0)S=R,P=F;else break}if((P|0)>0|(P|0)==0&S>>>0>0){S=0,P=0;do Jt=ze+(S<<3)|0,d[Jt>>2]=0,d[Jt+4>>2]=0,S=Ei(S|0,P|0,1,0)|0,P=_t()|0,Jt=Wi,te=d[Jt+4>>2]|0;while((P|0)<(te|0)|((P|0)==(te|0)?S>>>0<(d[Jt>>2]|0)>>>0:0))}if(Jt=Wi,d[Jt>>2]=R,d[Jt+4>>2]=F,(F|0)>0|(F|0)==0&R>>>0>0)Yt=A,Ht=Ge,ie=Ti,te=Be,Jt=Ri,A=qt,Ge=E,Be=Ci,qt=Yt,E=Ht,Ti=ji,ji=ie,Ci=te,Ri=ze,ze=Jt;else break e}Fi(Ci),Fi(ji),Fi(gn),E=1;break t}else E=R;while(!1);Fi(gn),Fi(A),Fi(E),E=0}while(!1);return gn=E,gt=or,gn|0}}return Fi(gn),gn=E,gt=or,gn|0}function En(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;if(W=gt,gt=gt+176|0,F=W,(h|0)<1)return Io(A,0,0),U=0,gt=W,U|0;for(R=f,R=D(d[R>>2]|0,d[R+4>>2]|0,52)|0,_t()|0,Io(A,(h|0)>6?h:6,R&15),R=0;b=f+(R<<3)|0,b=Za(d[b>>2]|0,d[b+4>>2]|0,F)|0,!(b|0);){if(b=d[F>>2]|0,(b|0)>0){P=0;do S=F+8+(P<<4)|0,P=P+1|0,b=F+8+(((P|0)%(b|0)|0)<<4)|0,E=zl(A,b,S)|0,E?Nl(A,E)|0:_h(A,S,b)|0,b=d[F>>2]|0;while((P|0)<(b|0))}if(R=R+1|0,(R|0)>=(h|0)){b=0,U=13;break}}return(U|0)==13?(gt=W,b|0):(Pu(A),U=b,gt=W,U|0)}function Yn(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0;if(S=gt,gt=gt+32|0,b=S,E=S+16|0,f=En(f,h,E)|0,f|0)return A=f,gt=S,A|0;if(d[A>>2]=0,d[A+4>>2]=0,d[A+8>>2]=0,f=Qa(E)|0,f|0)do{h=Ol(A)|0;do xo(h,f)|0,P=f+16|0,d[b>>2]=d[P>>2],d[b+4>>2]=d[P+4>>2],d[b+8>>2]=d[P+8>>2],d[b+12>>2]=d[P+12>>2],Nl(E,f)|0,f=Ja(E,b)|0;while((f|0)!=0);f=Qa(E)|0}while((f|0)!=0);return Pu(E),f=gh(A)|0,f?(bs(A),P=f,gt=S,P|0):(P=0,gt=S,P|0)}function Tn(f){return f=f|0,f>>>0>121?(f=0,f|0):(f=d[7696+(f*28|0)+16>>2]|0,f|0)}function Xr(f){return f=f|0,(f|0)==4|(f|0)==117|0}function qs(f){return f=f|0,d[11120+((d[f>>2]|0)*216|0)+((d[f+4>>2]|0)*72|0)+((d[f+8>>2]|0)*24|0)+(d[f+12>>2]<<3)>>2]|0}function wf(f){return f=f|0,d[11120+((d[f>>2]|0)*216|0)+((d[f+4>>2]|0)*72|0)+((d[f+8>>2]|0)*24|0)+(d[f+12>>2]<<3)+4>>2]|0}function Ef(f,h){f=f|0,h=h|0,f=7696+(f*28|0)|0,d[h>>2]=d[f>>2],d[h+4>>2]=d[f+4>>2],d[h+8>>2]=d[f+8>>2],d[h+12>>2]=d[f+12>>2]}function El(f,h){f=f|0,h=h|0;var A=0,b=0;if(h>>>0>20)return h=-1,h|0;do if((d[11120+(h*216|0)>>2]|0)!=(f|0))if((d[11120+(h*216|0)+8>>2]|0)!=(f|0))if((d[11120+(h*216|0)+16>>2]|0)!=(f|0))if((d[11120+(h*216|0)+24>>2]|0)!=(f|0))if((d[11120+(h*216|0)+32>>2]|0)!=(f|0))if((d[11120+(h*216|0)+40>>2]|0)!=(f|0))if((d[11120+(h*216|0)+48>>2]|0)!=(f|0))if((d[11120+(h*216|0)+56>>2]|0)!=(f|0))if((d[11120+(h*216|0)+64>>2]|0)!=(f|0))if((d[11120+(h*216|0)+72>>2]|0)!=(f|0))if((d[11120+(h*216|0)+80>>2]|0)!=(f|0))if((d[11120+(h*216|0)+88>>2]|0)!=(f|0))if((d[11120+(h*216|0)+96>>2]|0)!=(f|0))if((d[11120+(h*216|0)+104>>2]|0)!=(f|0))if((d[11120+(h*216|0)+112>>2]|0)!=(f|0))if((d[11120+(h*216|0)+120>>2]|0)!=(f|0))if((d[11120+(h*216|0)+128>>2]|0)!=(f|0))if((d[11120+(h*216|0)+136>>2]|0)==(f|0))f=2,A=1,b=2;else{if((d[11120+(h*216|0)+144>>2]|0)==(f|0)){f=0,A=2,b=0;break}if((d[11120+(h*216|0)+152>>2]|0)==(f|0)){f=0,A=2,b=1;break}if((d[11120+(h*216|0)+160>>2]|0)==(f|0)){f=0,A=2,b=2;break}if((d[11120+(h*216|0)+168>>2]|0)==(f|0)){f=1,A=2,b=0;break}if((d[11120+(h*216|0)+176>>2]|0)==(f|0)){f=1,A=2,b=1;break}if((d[11120+(h*216|0)+184>>2]|0)==(f|0)){f=1,A=2,b=2;break}if((d[11120+(h*216|0)+192>>2]|0)==(f|0)){f=2,A=2,b=0;break}if((d[11120+(h*216|0)+200>>2]|0)==(f|0)){f=2,A=2,b=1;break}if((d[11120+(h*216|0)+208>>2]|0)==(f|0)){f=2,A=2,b=2;break}else f=-1;return f|0}else f=2,A=1,b=1;else f=2,A=1,b=0;else f=1,A=1,b=2;else f=1,A=1,b=1;else f=1,A=1,b=0;else f=0,A=1,b=2;else f=0,A=1,b=1;else f=0,A=1,b=0;else f=2,A=0,b=2;else f=2,A=0,b=1;else f=2,A=0,b=0;else f=1,A=0,b=2;else f=1,A=0,b=1;else f=1,A=0,b=0;else f=0,A=0,b=2;else f=0,A=0,b=1;else f=0,A=0,b=0;while(!1);return h=d[11120+(h*216|0)+(A*72|0)+(f*24|0)+(b<<3)+4>>2]|0,h|0}function ac(f,h){return f=f|0,h=h|0,(d[7696+(f*28|0)+20>>2]|0)==(h|0)?(h=1,h|0):(h=(d[7696+(f*28|0)+24>>2]|0)==(h|0),h|0)}function Va(f,h){return f=f|0,h=h|0,d[848+(f*28|0)+(h<<2)>>2]|0}function lc(f,h){return f=f|0,h=h|0,(d[848+(f*28|0)>>2]|0)==(h|0)?(h=0,h|0):(d[848+(f*28|0)+4>>2]|0)==(h|0)?(h=1,h|0):(d[848+(f*28|0)+8>>2]|0)==(h|0)?(h=2,h|0):(d[848+(f*28|0)+12>>2]|0)==(h|0)?(h=3,h|0):(d[848+(f*28|0)+16>>2]|0)==(h|0)?(h=4,h|0):(d[848+(f*28|0)+20>>2]|0)==(h|0)?(h=5,h|0):((d[848+(f*28|0)+24>>2]|0)==(h|0)?6:7)|0}function uc(){return 122}function oo(f){f=f|0;var h=0,A=0,b=0;h=0;do O(h|0,0,45)|0,b=_t()|0|134225919,A=f+(h<<3)|0,d[A>>2]=-1,d[A+4>>2]=b,h=h+1|0;while((h|0)!=122);return 0}function ya(f){f=f|0;var h=0,A=0,b=0;return b=+tt[f+16>>3],A=+tt[f+24>>3],h=b-A,+(b<A?h+6.283185307179586:h)}function $o(f){return f=f|0,+tt[f+16>>3]<+tt[f+24>>3]|0}function Ga(f){return f=f|0,+(+tt[f>>3]-+tt[f+8>>3])}function No(f,h){f=f|0,h=h|0;var A=0,b=0,E=0;return A=+tt[h>>3],!(A>=+tt[f+8>>3])||!(A<=+tt[f>>3])?(h=0,h|0):(b=+tt[f+16>>3],A=+tt[f+24>>3],E=+tt[h+8>>3],h=E>=A,f=E<=b&1,b<A?h&&(f=1):h||(f=0),h=(f|0)!=0,h|0)}function zo(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;return+tt[f>>3]<+tt[h+8>>3]||+tt[f+8>>3]>+tt[h>>3]?(b=0,b|0):(S=+tt[f+16>>3],A=f+24|0,W=+tt[A>>3],P=S<W,b=h+16|0,U=+tt[b>>3],E=h+24|0,F=+tt[E>>3],R=U<F,h=W-U<F-S,f=P?R|h?1:2:0,h=R?P?1:h?2:1:0,S=+qi(S,f),S<+qi(+tt[E>>3],h)||(W=+qi(+tt[A>>3],f),W>+qi(+tt[b>>3],h))?(R=0,R|0):(R=1,R|0))}function cc(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0;S=+tt[f+16>>3],F=+tt[f+24>>3],f=S<F,R=+tt[h+16>>3],P=+tt[h+24>>3],E=R<P,h=F-R<P-S,d[A>>2]=f?E|h?1:2:0,d[b>>2]=E?f?1:h?2:1:0}function ys(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;return+tt[f>>3]<+tt[h>>3]||+tt[f+8>>3]>+tt[h+8>>3]?(b=0,b|0):(b=f+16|0,F=+tt[b>>3],S=+tt[f+24>>3],P=F<S,A=h+16|0,W=+tt[A>>3],E=h+24|0,U=+tt[E>>3],R=W<U,h=S-W<U-F,f=P?R|h?1:2:0,h=R?P?1:h?2:1:0,S=+qi(S,f),S<=+qi(+tt[E>>3],h)?(W=+qi(+tt[b>>3],f),R=W>=+qi(+tt[A>>3],h),R|0):(R=0,R|0))}function gr(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0;E=gt,gt=gt+176|0,b=E,d[b>>2]=4,R=+tt[h>>3],tt[b+8>>3]=R,S=+tt[h+16>>3],tt[b+16>>3]=S,tt[b+24>>3]=R,R=+tt[h+24>>3],tt[b+32>>3]=R,P=+tt[h+8>>3],tt[b+40>>3]=P,tt[b+48>>3]=R,tt[b+56>>3]=P,tt[b+64>>3]=S,h=b+72|0,A=h+96|0;do d[h>>2]=0,h=h+4|0;while((h|0)<(A|0));Ct(f|0,b|0,168)|0,gt=E}function ja(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0;Mt=gt,gt=gt+288|0,W=Mt+264|0,ht=Mt+96|0,U=Mt,R=U,F=R+96|0;do d[R>>2]=0,R=R+4|0;while((R|0)<(F|0));return h=vu(h,U)|0,h|0?(It=h,gt=Mt,It|0):(F=U,U=d[F>>2]|0,F=d[F+4>>2]|0,wa(U,F,W)|0,Za(U,F,ht)|0,P=+ns(W,ht+8|0),tt[W>>3]=+tt[f>>3],F=W+8|0,tt[F>>3]=+tt[f+16>>3],tt[ht>>3]=+tt[f+8>>3],U=ht+8|0,tt[U>>3]=+tt[f+24>>3],E=+ns(W,ht),Ht=+tt[F>>3]-+tt[U>>3],S=+ke(+Ht),Yt=+tt[W>>3]-+tt[ht>>3],b=+ke(+Yt),!(Ht==0|Yt==0)&&(Ht=+J(+S,+b),Ht=+Yi(+(E*E/+at(+(Ht/+at(+S,+b)),3)/(P*(P*2.59807621135)*.8))),tt[Pe>>3]=Ht,Pt=~~Ht>>>0,It=+ke(Ht)>=1?Ht>0?~~+Hi(+Ie(Ht/4294967296),4294967295)>>>0:~~+Yi((Ht-+(~~Ht>>>0))/4294967296)>>>0:0,(d[Pe+4>>2]&2146435072|0)!=2146435072)?(ht=(Pt|0)==0&(It|0)==0,h=A,d[h>>2]=ht?1:Pt,d[h+4>>2]=ht?0:It,h=0):h=1,It=h,gt=Mt,It|0)}function Cf(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0;U=gt,gt=gt+288|0,P=U+264|0,R=U+96|0,F=U,E=F,S=E+96|0;do d[E>>2]=0,E=E+4|0;while((E|0)<(S|0));return A=vu(A,F)|0,A|0?(b=A,gt=U,b|0):(A=F,E=d[A>>2]|0,A=d[A+4>>2]|0,wa(E,A,P)|0,Za(E,A,R)|0,W=+ns(P,R+8|0),W=+Yi(+(+ns(f,h)/(W*2))),tt[Pe>>3]=W,A=~~W>>>0,E=+ke(W)>=1?W>0?~~+Hi(+Ie(W/4294967296),4294967295)>>>0:~~+Yi((W-+(~~W>>>0))/4294967296)>>>0:0,(d[Pe+4>>2]&2146435072|0)==2146435072?(b=1,gt=U,b|0):(F=(A|0)==0&(E|0)==0,d[b>>2]=F?1:A,d[b+4>>2]=F?0:E,b=0,gt=U,b|0))}function Gp(f,h){f=f|0,h=+h;var A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;S=f+16|0,P=+tt[S>>3],A=f+24|0,E=+tt[A>>3],b=P-E,b=P<E?b+6.283185307179586:b,U=+tt[f>>3],R=f+8|0,F=+tt[R>>3],W=U-F,b=(b*h-b)*.5,h=(W*h-W)*.5,U=U+h,tt[f>>3]=U>1.5707963267948966?1.5707963267948966:U,h=F-h,tt[R>>3]=h<-1.5707963267948966?-1.5707963267948966:h,h=P+b,h=h>3.141592653589793?h+-6.283185307179586:h,tt[S>>3]=h<-3.141592653589793?h+6.283185307179586:h,h=E-b,h=h>3.141592653589793?h+-6.283185307179586:h,tt[A>>3]=h<-3.141592653589793?h+6.283185307179586:h}function jp(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0,d[f>>2]=h,d[f+4>>2]=A,d[f+8>>2]=b}function lh(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0;ht=h+8|0,d[ht>>2]=0,F=+tt[f>>3],P=+ke(+F),U=+tt[f+8>>3],R=+ke(+U)*1.1547005383792515,P=P+R*.5,A=~~P,f=~~R,P=P-+(A|0),R=R-+(f|0);do if(P<.5)if(P<.3333333333333333)if(d[h>>2]=A,R<(P+1)*.5){d[h+4>>2]=f;break}else{f=f+1|0,d[h+4>>2]=f;break}else if(Pt=1-P,f=(!(R<Pt)&1)+f|0,d[h+4>>2]=f,Pt<=R&R<P*2){A=A+1|0,d[h>>2]=A;break}else{d[h>>2]=A;break}else{if(!(P<.6666666666666666))if(A=A+1|0,d[h>>2]=A,R<P*.5){d[h+4>>2]=f;break}else{f=f+1|0,d[h+4>>2]=f;break}if(R<1-P){if(d[h+4>>2]=f,P*2+-1<R){d[h>>2]=A;break}}else f=f+1|0,d[h+4>>2]=f;A=A+1|0,d[h>>2]=A}while(!1);do if(F<0)if(f&1){W=(f+1|0)/2|0,W=Ur(A|0,((A|0)<0)<<31>>31|0,W|0,((W|0)<0)<<31>>31|0)|0,A=~~(+(A|0)-((+(W>>>0)+4294967296*+(_t()|0))*2+1)),d[h>>2]=A;break}else{W=(f|0)/2|0,W=Ur(A|0,((A|0)<0)<<31>>31|0,W|0,((W|0)<0)<<31>>31|0)|0,A=~~(+(A|0)-(+(W>>>0)+4294967296*+(_t()|0))*2),d[h>>2]=A;break}while(!1);W=h+4|0,U<0&&(A=A-((f<<1|1|0)/2|0)|0,d[h>>2]=A,f=0-f|0,d[W>>2]=f),b=f-A|0,(A|0)<0?(E=0-A|0,d[W>>2]=b,d[ht>>2]=E,d[h>>2]=0,f=b,A=0):E=0,(f|0)<0&&(A=A-f|0,d[h>>2]=A,E=E-f|0,d[ht>>2]=E,d[W>>2]=0,f=0),S=A-E|0,b=f-E|0,(E|0)<0&&(d[h>>2]=S,d[W>>2]=b,d[ht>>2]=0,f=b,A=S,E=0),b=(f|0)<(A|0)?f:A,b=(E|0)<(b|0)?E:b,!((b|0)<=0)&&(d[h>>2]=A-b,d[W>>2]=f-b,d[ht>>2]=E-b)}function qr(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0;h=d[f>>2]|0,P=f+4|0,A=d[P>>2]|0,(h|0)<0&&(A=A-h|0,d[P>>2]=A,S=f+8|0,d[S>>2]=(d[S>>2]|0)-h,d[f>>2]=0,h=0),(A|0)<0?(h=h-A|0,d[f>>2]=h,S=f+8|0,E=(d[S>>2]|0)-A|0,d[S>>2]=E,d[P>>2]=0,A=0):(E=f+8|0,S=E,E=d[E>>2]|0),(E|0)<0&&(h=h-E|0,d[f>>2]=h,A=A-E|0,d[P>>2]=A,d[S>>2]=0,E=0),b=(A|0)<(h|0)?A:h,b=(E|0)<(b|0)?E:b,!((b|0)<=0)&&(d[f>>2]=h-b,d[P>>2]=A-b,d[S>>2]=E-b)}function ta(f,h){f=f|0,h=h|0;var A=0,b=0;b=d[f+8>>2]|0,A=+((d[f+4>>2]|0)-b|0),tt[h>>3]=+((d[f>>2]|0)-b|0)-A*.5,tt[h+8>>3]=A*.8660254037844386}function is(f,h,A){f=f|0,h=h|0,A=A|0,d[A>>2]=(d[h>>2]|0)+(d[f>>2]|0),d[A+4>>2]=(d[h+4>>2]|0)+(d[f+4>>2]|0),d[A+8>>2]=(d[h+8>>2]|0)+(d[f+8>>2]|0)}function hc(f,h,A){f=f|0,h=h|0,A=A|0,d[A>>2]=(d[f>>2]|0)-(d[h>>2]|0),d[A+4>>2]=(d[f+4>>2]|0)-(d[h+4>>2]|0),d[A+8>>2]=(d[f+8>>2]|0)-(d[h+8>>2]|0)}function uh(f,h){f=f|0,h=h|0;var A=0,b=0;A=Ji(d[f>>2]|0,h)|0,d[f>>2]=A,A=f+4|0,b=Ji(d[A>>2]|0,h)|0,d[A>>2]=b,f=f+8|0,h=Ji(d[f>>2]|0,h)|0,d[f>>2]=h}function fc(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;P=d[f>>2]|0,R=(P|0)<0,b=(d[f+4>>2]|0)-(R?P:0)|0,S=(b|0)<0,E=(S?0-b|0:0)+((d[f+8>>2]|0)-(R?P:0))|0,A=(E|0)<0,f=A?0:E,h=(S?0:b)-(A?E:0)|0,E=(R?0:P)-(S?b:0)-(A?E:0)|0,A=(h|0)<(E|0)?h:E,A=(f|0)<(A|0)?f:A,b=(A|0)>0,f=f-(b?A:0)|0,h=h-(b?A:0)|0;t:do switch(E-(b?A:0)|0){case 0:switch(h|0){case 0:return R=(f|0)==0?0:(f|0)==1?1:7,R|0;case 1:return R=(f|0)==0?2:(f|0)==1?3:7,R|0;default:break t}case 1:switch(h|0){case 0:return R=(f|0)==0?4:(f|0)==1?5:7,R|0;case 1:{if(!f)f=6;else break t;return f|0}default:break t}}while(!1);return R=7,R|0}function Au(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0;if(F=f+8|0,P=d[F>>2]|0,R=(d[f>>2]|0)-P|0,U=f+4|0,P=(d[U>>2]|0)-P|0,R>>>0>715827881|P>>>0>715827881){if(b=(R|0)>0,E=2147483647-R|0,S=-2147483648-R|0,(b?(E|0)<(R|0):(S|0)>(R|0))||(A=R<<1,b?(2147483647-A|0)<(R|0):(-2147483648-A|0)>(R|0))||((P|0)>0?(2147483647-P|0)<(P|0):(-2147483648-P|0)>(P|0))||(h=R*3|0,A=P<<1,(b?(E|0)<(A|0):(S|0)>(A|0))||((R|0)>-1?(h|-2147483648|0)>=(P|0):(h^-2147483648|0)<(P|0))))return U=1,U|0}else A=P<<1,h=R*3|0;return b=xs(+(h-P|0)*.14285714285714285)|0,d[f>>2]=b,E=xs(+(A+R|0)*.14285714285714285)|0,d[U>>2]=E,d[F>>2]=0,A=(E|0)<(b|0),h=A?b:E,A=A?E:b,(A|0)<0&&(((A|0)==-2147483648||((h|0)>0?(2147483647-h|0)<(A|0):(-2147483648-h|0)>(A|0)))&&ti(27795,26892,354,26903),((h|0)>-1?(h|-2147483648|0)>=(A|0):(h^-2147483648|0)<(A|0))&&ti(27795,26892,354,26903)),h=E-b|0,(b|0)<0?(A=0-b|0,d[U>>2]=h,d[F>>2]=A,d[f>>2]=0,b=0):(h=E,A=0),(h|0)<0&&(b=b-h|0,d[f>>2]=b,A=A-h|0,d[F>>2]=A,d[U>>2]=0,h=0),S=b-A|0,E=h-A|0,(A|0)<0?(d[f>>2]=S,d[U>>2]=E,d[F>>2]=0,h=E,E=S,A=0):E=b,b=(h|0)<(E|0)?h:E,b=(A|0)<(b|0)?A:b,(b|0)<=0?(U=0,U|0):(d[f>>2]=E-b,d[U>>2]=h-b,d[F>>2]=A-b,U=0,U|0)}function mu(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0,F=0;if(P=f+8|0,E=d[P>>2]|0,S=(d[f>>2]|0)-E|0,R=f+4|0,E=(d[R>>2]|0)-E|0,S>>>0>715827881|E>>>0>715827881){if(A=(S|0)>0,(A?(2147483647-S|0)<(S|0):(-2147483648-S|0)>(S|0))||(h=S<<1,b=(E|0)>0,b?(2147483647-E|0)<(E|0):(-2147483648-E|0)>(E|0)))return R=1,R|0;if(F=E<<1,(b?(2147483647-F|0)<(E|0):(-2147483648-F|0)>(E|0))||(A?(2147483647-h|0)<(E|0):(-2147483648-h|0)>(E|0))||(A=E*3|0,(E|0)>-1?(A|-2147483648|0)>=(S|0):(A^-2147483648|0)<(S|0)))return F=1,F|0}else A=E*3|0,h=S<<1;return b=xs(+(h+E|0)*.14285714285714285)|0,d[f>>2]=b,E=xs(+(A-S|0)*.14285714285714285)|0,d[R>>2]=E,d[P>>2]=0,A=(E|0)<(b|0),h=A?b:E,A=A?E:b,(A|0)<0&&(((A|0)==-2147483648||((h|0)>0?(2147483647-h|0)<(A|0):(-2147483648-h|0)>(A|0)))&&ti(27795,26892,402,26917),((h|0)>-1?(h|-2147483648|0)>=(A|0):(h^-2147483648|0)<(A|0))&&ti(27795,26892,402,26917)),h=E-b|0,(b|0)<0?(A=0-b|0,d[R>>2]=h,d[P>>2]=A,d[f>>2]=0,b=0):(h=E,A=0),(h|0)<0&&(b=b-h|0,d[f>>2]=b,A=A-h|0,d[P>>2]=A,d[R>>2]=0,h=0),S=b-A|0,E=h-A|0,(A|0)<0?(d[f>>2]=S,d[R>>2]=E,d[P>>2]=0,h=E,E=S,A=0):E=b,b=(h|0)<(E|0)?h:E,b=(A|0)<(b|0)?A:b,(b|0)<=0?(F=0,F|0):(d[f>>2]=E-b,d[R>>2]=h-b,d[P>>2]=A-b,F=0,F|0)}function Tf(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;P=f+8|0,A=d[P>>2]|0,h=(d[f>>2]|0)-A|0,R=f+4|0,A=(d[R>>2]|0)-A|0,b=xs(+((h*3|0)-A|0)*.14285714285714285)|0,d[f>>2]=b,h=xs(+((A<<1)+h|0)*.14285714285714285)|0,d[R>>2]=h,d[P>>2]=0,A=h-b|0,(b|0)<0?(S=0-b|0,d[R>>2]=A,d[P>>2]=S,d[f>>2]=0,h=A,b=0,A=S):A=0,(h|0)<0&&(b=b-h|0,d[f>>2]=b,A=A-h|0,d[P>>2]=A,d[R>>2]=0,h=0),S=b-A|0,E=h-A|0,(A|0)<0?(d[f>>2]=S,d[R>>2]=E,d[P>>2]=0,h=E,E=S,A=0):E=b,b=(h|0)<(E|0)?h:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(d[f>>2]=E-b,d[R>>2]=h-b,d[P>>2]=A-b)}function Nr(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;P=f+8|0,A=d[P>>2]|0,h=(d[f>>2]|0)-A|0,R=f+4|0,A=(d[R>>2]|0)-A|0,b=xs(+((h<<1)+A|0)*.14285714285714285)|0,d[f>>2]=b,h=xs(+((A*3|0)-h|0)*.14285714285714285)|0,d[R>>2]=h,d[P>>2]=0,A=h-b|0,(b|0)<0?(S=0-b|0,d[R>>2]=A,d[P>>2]=S,d[f>>2]=0,h=A,b=0,A=S):A=0,(h|0)<0&&(b=b-h|0,d[f>>2]=b,A=A-h|0,d[P>>2]=A,d[R>>2]=0,h=0),S=b-A|0,E=h-A|0,(A|0)<0?(d[f>>2]=S,d[R>>2]=E,d[P>>2]=0,h=E,E=S,A=0):E=b,b=(h|0)<(E|0)?h:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(d[f>>2]=E-b,d[R>>2]=h-b,d[P>>2]=A-b)}function Cl(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;h=d[f>>2]|0,P=f+4|0,A=d[P>>2]|0,R=f+8|0,b=d[R>>2]|0,E=A+(h*3|0)|0,d[f>>2]=E,A=b+(A*3|0)|0,d[P>>2]=A,h=(b*3|0)+h|0,d[R>>2]=h,b=A-E|0,(E|0)<0?(h=h-E|0,d[P>>2]=b,d[R>>2]=h,d[f>>2]=0,A=b,b=0):b=E,(A|0)<0&&(b=b-A|0,d[f>>2]=b,h=h-A|0,d[R>>2]=h,d[P>>2]=0,A=0),S=b-h|0,E=A-h|0,(h|0)<0?(d[f>>2]=S,d[P>>2]=E,d[R>>2]=0,b=S,h=0):E=A,A=(E|0)<(b|0)?E:b,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(d[f>>2]=b-A,d[P>>2]=E-A,d[R>>2]=h-A)}function Bs(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;E=d[f>>2]|0,P=f+4|0,h=d[P>>2]|0,R=f+8|0,A=d[R>>2]|0,b=(h*3|0)+E|0,E=A+(E*3|0)|0,d[f>>2]=E,d[P>>2]=b,h=(A*3|0)+h|0,d[R>>2]=h,A=b-E|0,(E|0)<0?(h=h-E|0,d[P>>2]=A,d[R>>2]=h,d[f>>2]=0,E=0):A=b,(A|0)<0&&(E=E-A|0,d[f>>2]=E,h=h-A|0,d[R>>2]=h,d[P>>2]=0,A=0),S=E-h|0,b=A-h|0,(h|0)<0?(d[f>>2]=S,d[P>>2]=b,d[R>>2]=0,E=S,h=0):b=A,A=(b|0)<(E|0)?b:E,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(d[f>>2]=E-A,d[P>>2]=b-A,d[R>>2]=h-A)}function ea(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0;(h+-1|0)>>>0>=6||(E=(d[15440+(h*12|0)>>2]|0)+(d[f>>2]|0)|0,d[f>>2]=E,R=f+4|0,b=(d[15440+(h*12|0)+4>>2]|0)+(d[R>>2]|0)|0,d[R>>2]=b,P=f+8|0,h=(d[15440+(h*12|0)+8>>2]|0)+(d[P>>2]|0)|0,d[P>>2]=h,A=b-E|0,(E|0)<0?(h=h-E|0,d[R>>2]=A,d[P>>2]=h,d[f>>2]=0,b=0):(A=b,b=E),(A|0)<0&&(b=b-A|0,d[f>>2]=b,h=h-A|0,d[P>>2]=h,d[R>>2]=0,A=0),S=b-h|0,E=A-h|0,(h|0)<0?(d[f>>2]=S,d[R>>2]=E,d[P>>2]=0,b=S,h=0):E=A,A=(E|0)<(b|0)?E:b,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(d[f>>2]=b-A,d[R>>2]=E-A,d[P>>2]=h-A))}function va(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;E=d[f>>2]|0,P=f+4|0,h=d[P>>2]|0,R=f+8|0,A=d[R>>2]|0,b=h+E|0,E=A+E|0,d[f>>2]=E,d[P>>2]=b,h=A+h|0,d[R>>2]=h,A=b-E|0,(E|0)<0?(h=h-E|0,d[P>>2]=A,d[R>>2]=h,d[f>>2]=0,b=0):(A=b,b=E),(A|0)<0&&(b=b-A|0,d[f>>2]=b,h=h-A|0,d[R>>2]=h,d[P>>2]=0,A=0),S=b-h|0,E=A-h|0,(h|0)<0?(d[f>>2]=S,d[P>>2]=E,d[R>>2]=0,b=S,h=0):E=A,A=(E|0)<(b|0)?E:b,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(d[f>>2]=b-A,d[P>>2]=E-A,d[R>>2]=h-A)}function Uo(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;h=d[f>>2]|0,P=f+4|0,b=d[P>>2]|0,R=f+8|0,A=d[R>>2]|0,E=b+h|0,d[f>>2]=E,b=A+b|0,d[P>>2]=b,h=A+h|0,d[R>>2]=h,A=b-E|0,(E|0)<0?(h=h-E|0,d[P>>2]=A,d[R>>2]=h,d[f>>2]=0,b=0):(A=b,b=E),(A|0)<0&&(b=b-A|0,d[f>>2]=b,h=h-A|0,d[R>>2]=h,d[P>>2]=0,A=0),S=b-h|0,E=A-h|0,(h|0)<0?(d[f>>2]=S,d[P>>2]=E,d[R>>2]=0,b=S,h=0):E=A,A=(E|0)<(b|0)?E:b,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(d[f>>2]=b-A,d[P>>2]=E-A,d[R>>2]=h-A)}function Rs(f){switch(f=f|0,f|0){case 1:{f=5;break}case 5:{f=4;break}case 4:{f=6;break}case 6:{f=2;break}case 2:{f=3;break}case 3:{f=1;break}}return f|0}function Ls(f){switch(f=f|0,f|0){case 1:{f=3;break}case 3:{f=2;break}case 2:{f=6;break}case 6:{f=4;break}case 4:{f=5;break}case 5:{f=1;break}}return f|0}function _a(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;h=d[f>>2]|0,P=f+4|0,A=d[P>>2]|0,R=f+8|0,b=d[R>>2]|0,E=A+(h<<1)|0,d[f>>2]=E,A=b+(A<<1)|0,d[P>>2]=A,h=(b<<1)+h|0,d[R>>2]=h,b=A-E|0,(E|0)<0?(h=h-E|0,d[P>>2]=b,d[R>>2]=h,d[f>>2]=0,A=b,b=0):b=E,(A|0)<0&&(b=b-A|0,d[f>>2]=b,h=h-A|0,d[R>>2]=h,d[P>>2]=0,A=0),S=b-h|0,E=A-h|0,(h|0)<0?(d[f>>2]=S,d[P>>2]=E,d[R>>2]=0,b=S,h=0):E=A,A=(E|0)<(b|0)?E:b,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(d[f>>2]=b-A,d[P>>2]=E-A,d[R>>2]=h-A)}function ia(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;E=d[f>>2]|0,P=f+4|0,h=d[P>>2]|0,R=f+8|0,A=d[R>>2]|0,b=(h<<1)+E|0,E=A+(E<<1)|0,d[f>>2]=E,d[P>>2]=b,h=(A<<1)+h|0,d[R>>2]=h,A=b-E|0,(E|0)<0?(h=h-E|0,d[P>>2]=A,d[R>>2]=h,d[f>>2]=0,E=0):A=b,(A|0)<0&&(E=E-A|0,d[f>>2]=E,h=h-A|0,d[R>>2]=h,d[P>>2]=0,A=0),S=E-h|0,b=A-h|0,(h|0)<0?(d[f>>2]=S,d[P>>2]=b,d[R>>2]=0,E=S,h=0):b=A,A=(b|0)<(E|0)?b:E,A=(h|0)<(A|0)?h:A,!((A|0)<=0)&&(d[f>>2]=E-A,d[P>>2]=b-A,d[R>>2]=h-A)}function dc(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0;return P=(d[f>>2]|0)-(d[h>>2]|0)|0,R=(P|0)<0,b=(d[f+4>>2]|0)-(d[h+4>>2]|0)-(R?P:0)|0,S=(b|0)<0,E=(R?0-P|0:0)+(d[f+8>>2]|0)-(d[h+8>>2]|0)+(S?0-b|0:0)|0,f=(E|0)<0,h=f?0:E,A=(S?0:b)-(f?E:0)|0,E=(R?0:P)-(S?b:0)-(f?E:0)|0,f=(A|0)<(E|0)?A:E,f=(h|0)<(f|0)?h:f,b=(f|0)>0,h=h-(b?f:0)|0,A=A-(b?f:0)|0,f=E-(b?f:0)|0,f=(f|0)>-1?f:0-f|0,A=(A|0)>-1?A:0-A|0,h=(h|0)>-1?h:0-h|0,h=(A|0)>(h|0)?A:h,((f|0)>(h|0)?f:h)|0}function Sf(f,h){f=f|0,h=h|0;var A=0;A=d[f+8>>2]|0,d[h>>2]=(d[f>>2]|0)-A,d[h+4>>2]=(d[f+4>>2]|0)-A}function Dn(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0;return b=d[f>>2]|0,d[h>>2]=b,E=d[f+4>>2]|0,P=h+4|0,d[P>>2]=E,R=h+8|0,d[R>>2]=0,A=(E|0)<(b|0),f=A?b:E,A=A?E:b,(A|0)<0&&((A|0)==-2147483648||((f|0)>0?(2147483647-f|0)<(A|0):(-2147483648-f|0)>(A|0))||((f|0)>-1?(f|-2147483648|0)>=(A|0):(f^-2147483648|0)<(A|0)))?(h=1,h|0):(f=E-b|0,(b|0)<0?(A=0-b|0,d[P>>2]=f,d[R>>2]=A,d[h>>2]=0,b=0):(f=E,A=0),(f|0)<0&&(b=b-f|0,d[h>>2]=b,A=A-f|0,d[R>>2]=A,d[P>>2]=0,f=0),S=b-A|0,E=f-A|0,(A|0)<0?(d[h>>2]=S,d[P>>2]=E,d[R>>2]=0,f=E,E=S,A=0):E=b,b=(f|0)<(E|0)?f:E,b=(A|0)<(b|0)?A:b,(b|0)<=0?(h=0,h|0):(d[h>>2]=E-b,d[P>>2]=f-b,d[R>>2]=A-b,h=0,h|0))}function Pf(f){f=f|0;var h=0,A=0,b=0,E=0;h=f+8|0,E=d[h>>2]|0,A=E-(d[f>>2]|0)|0,d[f>>2]=A,b=f+4|0,f=(d[b>>2]|0)-E|0,d[b>>2]=f,d[h>>2]=0-(f+A)}function pc(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;A=d[f>>2]|0,h=0-A|0,d[f>>2]=h,P=f+8|0,d[P>>2]=0,R=f+4|0,b=d[R>>2]|0,E=b+A|0,(A|0)>0?(d[R>>2]=E,d[P>>2]=A,d[f>>2]=0,h=0,b=E):A=0,(b|0)<0?(S=h-b|0,d[f>>2]=S,A=A-b|0,d[P>>2]=A,d[R>>2]=0,E=S-A|0,h=0-A|0,(A|0)<0?(d[f>>2]=E,d[R>>2]=h,d[P>>2]=0,b=h,A=0):(b=0,E=S)):E=h,h=(b|0)<(E|0)?b:E,h=(A|0)<(h|0)?A:h,!((h|0)<=0)&&(d[f>>2]=E-h,d[R>>2]=b-h,d[P>>2]=A-h)}function If(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0;if(ht=gt,gt=gt+64|0,W=ht,R=ht+56|0,!(!0&(h&2013265920|0)==134217728&(!0&(b&2013265920|0)==134217728)))return E=5,gt=ht,E|0;if((f|0)==(A|0)&(h|0)==(b|0))return d[E>>2]=0,E=0,gt=ht,E|0;if(P=D(f|0,h|0,52)|0,_t()|0,P=P&15,U=D(A|0,b|0,52)|0,_t()|0,(P|0)!=(U&15|0))return E=12,gt=ht,E|0;if(S=P+-1|0,P>>>0>1){Il(f,h,S,W)|0,Il(A,b,S,R)|0,U=W,F=d[U>>2]|0,U=d[U+4>>2]|0;t:do if((F|0)==(d[R>>2]|0)&&(U|0)==(d[R+4>>2]|0)){P=(P^15)*3|0,S=D(f|0,h|0,P|0)|0,_t()|0,S=S&7,P=D(A|0,b|0,P|0)|0,_t()|0,P=P&7;do if((S|0)==0|(P|0)==0)d[E>>2]=1,S=0;else if((S|0)==7)S=5;else{if((S|0)==1|(P|0)==1&&Rn(F,U)|0){S=5;break}if((d[15536+(S<<2)>>2]|0)!=(P|0)&&(d[15568+(S<<2)>>2]|0)!=(P|0))break t;d[E>>2]=1,S=0}while(!1);return E=S,gt=ht,E|0}while(!1)}S=W,P=S+56|0;do d[S>>2]=0,S=S+4|0;while((S|0)<(P|0));return Fn(f,h,1,W)|0,h=W,!((d[h>>2]|0)==(A|0)&&(d[h+4>>2]|0)==(b|0))&&(h=W+8|0,!((d[h>>2]|0)==(A|0)&&(d[h+4>>2]|0)==(b|0)))&&(h=W+16|0,!((d[h>>2]|0)==(A|0)&&(d[h+4>>2]|0)==(b|0)))&&(h=W+24|0,!((d[h>>2]|0)==(A|0)&&(d[h+4>>2]|0)==(b|0)))&&(h=W+32|0,!((d[h>>2]|0)==(A|0)&&(d[h+4>>2]|0)==(b|0)))&&(h=W+40|0,!((d[h>>2]|0)==(A|0)&&(d[h+4>>2]|0)==(b|0)))?(S=W+48|0,S=((d[S>>2]|0)==(A|0)?(d[S+4>>2]|0)==(b|0):0)&1):S=1,d[E>>2]=S,E=0,gt=ht,E|0}function Mf(f,h,A,b,E){return f=f|0,h=h|0,A=A|0,b=b|0,E=E|0,A=$t(f,h,A,b)|0,(A|0)==7?(E=11,E|0):(b=O(A|0,0,56)|0,h=h&-2130706433|(_t()|0)|268435456,d[E>>2]=f|b,d[E+4>>2]=h,E=0,E|0)}function Bf(f,h,A){return f=f|0,h=h|0,A=A|0,!0&(h&2013265920|0)==268435456?(d[A>>2]=f,d[A+4>>2]=h&-2130706433|134217728,A=0,A|0):(A=6,A|0)}function Rf(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0;return E=gt,gt=gt+16|0,b=E,d[b>>2]=0,!0&(h&2013265920|0)==268435456?(S=D(f|0,h|0,56)|0,_t()|0,b=Ln(f,h&-2130706433|134217728,S&7,b,A)|0,gt=E,b|0):(b=6,gt=E,b|0)}function Wa(f,h){f=f|0,h=h|0;var A=0;switch(A=D(f|0,h|0,56)|0,_t()|0,A&7){case 0:case 7:return A=0,A|0}return A=h&-2130706433|134217728,!(!0&(h&2013265920|0)==268435456)||!0&(h&117440512|0)==16777216&(Rn(f,A)|0)!=0?(A=0,A|0):(A=dh(f,A)|0,A|0)}function ba(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0;return E=gt,gt=gt+16|0,b=E,!0&(h&2013265920|0)==268435456?(S=h&-2130706433|134217728,P=A,d[P>>2]=f,d[P+4>>2]=S,d[b>>2]=0,h=D(f|0,h|0,56)|0,_t()|0,b=Ln(f,S,h&7,b,A+8|0)|0,gt=E,b|0):(b=6,gt=E,b|0)}function Ha(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0;return E=(Rn(f,h)|0)==0,h=h&-2130706433,b=A,d[b>>2]=E?f:0,d[b+4>>2]=E?h|285212672:0,b=A+8|0,d[b>>2]=f,d[b+4>>2]=h|301989888,b=A+16|0,d[b>>2]=f,d[b+4>>2]=h|318767104,b=A+24|0,d[b>>2]=f,d[b+4>>2]=h|335544320,b=A+32|0,d[b>>2]=f,d[b+4>>2]=h|352321536,A=A+40|0,d[A>>2]=f,d[A+4>>2]=h|369098752,0}function gu(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0;return P=gt,gt=gt+16|0,E=P,S=h&-2130706433|134217728,!0&(h&2013265920|0)==268435456?(b=D(f|0,h|0,56)|0,_t()|0,b=Vf(f,S,b&7)|0,(b|0)==-1?(d[A>>2]=0,S=6,gt=P,S|0):(xa(f,S,E)|0&&ti(27795,26932,282,26947),h=D(f|0,h|0,52)|0,_t()|0,h=h&15,Rn(f,S)|0?na(E,h,b,2,A):Sl(E,h,b,2,A),S=0,gt=P,S|0)):(S=6,gt=P,S|0)}function Lf(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0;b=gt,gt=gt+16|0,E=b,ch(f,h,A,E),lh(E,A+4|0),gt=b}function ch(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0;if(R=gt,gt=gt+16|0,F=R,Xa(f,A,F),S=+Gi(+(1-+tt[F>>3]*.5)),S<1e-16){d[b>>2]=0,d[b+4>>2]=0,d[b+8>>2]=0,d[b+12>>2]=0,gt=R;return}if(F=d[A>>2]|0,E=+tt[15920+(F*24|0)>>3],E=+bo(E-+bo(+kl(15600+(F<<4)|0,f))),_s(h)|0?P=+bo(E+-.3334731722518321):P=E,E=+Ze(+S)*2.618033988749896,(h|0)>0){f=0;do E=E*2.6457513110645907,f=f+1|0;while((f|0)!=(h|0))}S=+Ve(+P)*E,tt[b>>3]=S,P=+De(+P)*E,tt[b+8>>3]=P,gt=R}function Xa(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0;if(S=gt,gt=gt+32|0,E=S,zr(f,E),d[h>>2]=0,tt[A>>3]=5,b=+Ki(16400,E),b<+tt[A>>3]&&(d[h>>2]=0,tt[A>>3]=b),b=+Ki(16424,E),b<+tt[A>>3]&&(d[h>>2]=1,tt[A>>3]=b),b=+Ki(16448,E),b<+tt[A>>3]&&(d[h>>2]=2,tt[A>>3]=b),b=+Ki(16472,E),b<+tt[A>>3]&&(d[h>>2]=3,tt[A>>3]=b),b=+Ki(16496,E),b<+tt[A>>3]&&(d[h>>2]=4,tt[A>>3]=b),b=+Ki(16520,E),b<+tt[A>>3]&&(d[h>>2]=5,tt[A>>3]=b),b=+Ki(16544,E),b<+tt[A>>3]&&(d[h>>2]=6,tt[A>>3]=b),b=+Ki(16568,E),b<+tt[A>>3]&&(d[h>>2]=7,tt[A>>3]=b),b=+Ki(16592,E),b<+tt[A>>3]&&(d[h>>2]=8,tt[A>>3]=b),b=+Ki(16616,E),b<+tt[A>>3]&&(d[h>>2]=9,tt[A>>3]=b),b=+Ki(16640,E),b<+tt[A>>3]&&(d[h>>2]=10,tt[A>>3]=b),b=+Ki(16664,E),b<+tt[A>>3]&&(d[h>>2]=11,tt[A>>3]=b),b=+Ki(16688,E),b<+tt[A>>3]&&(d[h>>2]=12,tt[A>>3]=b),b=+Ki(16712,E),b<+tt[A>>3]&&(d[h>>2]=13,tt[A>>3]=b),b=+Ki(16736,E),b<+tt[A>>3]&&(d[h>>2]=14,tt[A>>3]=b),b=+Ki(16760,E),b<+tt[A>>3]&&(d[h>>2]=15,tt[A>>3]=b),b=+Ki(16784,E),b<+tt[A>>3]&&(d[h>>2]=16,tt[A>>3]=b),b=+Ki(16808,E),b<+tt[A>>3]&&(d[h>>2]=17,tt[A>>3]=b),b=+Ki(16832,E),b<+tt[A>>3]&&(d[h>>2]=18,tt[A>>3]=b),b=+Ki(16856,E),!(b<+tt[A>>3])){gt=S;return}d[h>>2]=19,tt[A>>3]=b,gt=S}function Tl(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0;if(S=+jo(f),S<1e-16){h=15600+(h<<4)|0,d[E>>2]=d[h>>2],d[E+4>>2]=d[h+4>>2],d[E+8>>2]=d[h+8>>2],d[E+12>>2]=d[h+12>>2];return}if(P=+hn(+ +tt[f+8>>3],+ +tt[f>>3]),(A|0)>0){f=0;do S=S*.37796447300922725,f=f+1|0;while((f|0)!=(A|0))}R=S*.3333333333333333,b?(A=(_s(A)|0)==0,S=+rn(+((A?R:R*.37796447300922725)*.381966011250105))):(S=+rn(+(S*.381966011250105)),_s(A)|0&&(P=+bo(P+.3334731722518321))),xu(15600+(h<<4)|0,+bo(+tt[15920+(h*24|0)>>3]-P),S,E)}function qa(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0;b=gt,gt=gt+16|0,E=b,ta(f+4|0,E),Tl(E,d[f>>2]|0,h,0,A),gt=b}function na(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0,Ge=0,ze=0,Ri=0,Ci=0,ji=0,Ti=0,ai=0,We=0,Wi=0,fn=0,Zi=0;if(Wi=gt,gt=gt+272|0,S=Wi+256|0,te=Wi+240|0,Ti=Wi,ai=Wi+224|0,We=Wi+208|0,Jt=Wi+176|0,qt=Wi+160|0,Be=Wi+192|0,Ge=Wi+144|0,ze=Wi+128|0,Ri=Wi+112|0,Ci=Wi+96|0,ji=Wi+80|0,d[S>>2]=h,d[te>>2]=d[f>>2],d[te+4>>2]=d[f+4>>2],d[te+8>>2]=d[f+8>>2],d[te+12>>2]=d[f+12>>2],hh(te,S,Ti),d[E>>2]=0,te=b+A+((b|0)==5&1)|0,(te|0)<=(A|0)){gt=Wi;return}F=d[S>>2]|0,U=ai+4|0,W=Jt+4|0,ht=A+5|0,Pt=16880+(F<<2)|0,It=16960+(F<<2)|0,Mt=ze+8|0,Yt=Ri+8|0,Ht=Ci+8|0,ie=We+4|0,R=A;t:for(;;){P=Ti+(((R|0)%5|0)<<4)|0,d[We>>2]=d[P>>2],d[We+4>>2]=d[P+4>>2],d[We+8>>2]=d[P+8>>2],d[We+12>>2]=d[P+12>>2];do;while((Vo(We,F,0,1)|0)==2);if((R|0)>(A|0)&(_s(h)|0)!=0){if(d[Jt>>2]=d[We>>2],d[Jt+4>>2]=d[We+4>>2],d[Jt+8>>2]=d[We+8>>2],d[Jt+12>>2]=d[We+12>>2],ta(U,qt),b=d[Jt>>2]|0,S=d[17040+(b*80|0)+(d[ai>>2]<<2)>>2]|0,d[Jt>>2]=d[18640+(b*80|0)+(S*20|0)>>2],P=d[18640+(b*80|0)+(S*20|0)+16>>2]|0,(P|0)>0){f=0;do va(W),f=f+1|0;while((f|0)<(P|0))}switch(P=18640+(b*80|0)+(S*20|0)+4|0,d[Be>>2]=d[P>>2],d[Be+4>>2]=d[P+4>>2],d[Be+8>>2]=d[P+8>>2],uh(Be,(d[Pt>>2]|0)*3|0),is(W,Be,W),qr(W),ta(W,Ge),fn=+(d[It>>2]|0),tt[ze>>3]=fn*3,tt[Mt>>3]=0,Zi=fn*-1.5,tt[Ri>>3]=Zi,tt[Yt>>3]=fn*2.598076211353316,tt[Ci>>3]=Zi,tt[Ht>>3]=fn*-2.598076211353316,d[17040+((d[Jt>>2]|0)*80|0)+(d[We>>2]<<2)>>2]|0){case 1:{f=Ri,b=ze;break}case 3:{f=Ci,b=Ri;break}case 2:{f=ze,b=Ci;break}default:{f=12;break t}}Cc(qt,Ge,b,f,ji),Tl(ji,d[Jt>>2]|0,F,1,E+8+(d[E>>2]<<4)|0),d[E>>2]=(d[E>>2]|0)+1}if((R|0)<(ht|0)&&(ta(ie,Jt),Tl(Jt,d[We>>2]|0,F,1,E+8+(d[E>>2]<<4)|0),d[E>>2]=(d[E>>2]|0)+1),d[ai>>2]=d[We>>2],d[ai+4>>2]=d[We+4>>2],d[ai+8>>2]=d[We+8>>2],d[ai+12>>2]=d[We+12>>2],R=R+1|0,(R|0)>=(te|0)){f=3;break}}if((f|0)==3){gt=Wi;return}else(f|0)==12&&ti(26970,27017,572,27027)}function hh(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0;F=gt,gt=gt+128|0,b=F+64|0,E=F,S=b,P=20240,R=S+60|0;do d[S>>2]=d[P>>2],S=S+4|0,P=P+4|0;while((S|0)<(R|0));S=E,P=20304,R=S+60|0;do d[S>>2]=d[P>>2],S=S+4|0,P=P+4|0;while((S|0)<(R|0));R=(_s(d[h>>2]|0)|0)==0,b=R?b:E,E=f+4|0,_a(E),ia(E),_s(d[h>>2]|0)|0&&(Bs(E),d[h>>2]=(d[h>>2]|0)+1),d[A>>2]=d[f>>2],h=A+4|0,is(E,b,h),qr(h),d[A+16>>2]=d[f>>2],h=A+20|0,is(E,b+12|0,h),qr(h),d[A+32>>2]=d[f>>2],h=A+36|0,is(E,b+24|0,h),qr(h),d[A+48>>2]=d[f>>2],h=A+52|0,is(E,b+36|0,h),qr(h),d[A+64>>2]=d[f>>2],A=A+68|0,is(E,b+48|0,A),qr(A),gt=F}function Vo(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0;if(Mt=gt,gt=gt+32|0,Pt=Mt+12|0,R=Mt,It=f+4|0,ht=d[16960+(h<<2)>>2]|0,W=(b|0)!=0,ht=W?ht*3|0:ht,E=d[It>>2]|0,U=f+8|0,P=d[U>>2]|0,W){if(S=f+12|0,b=d[S>>2]|0,E=P+E+b|0,(E|0)==(ht|0))return It=1,gt=Mt,It|0;F=S}else F=f+12|0,b=d[F>>2]|0,E=P+E+b|0;if((E|0)<=(ht|0))return It=0,gt=Mt,It|0;do if((b|0)>0){if(b=d[f>>2]|0,(P|0)>0){S=18640+(b*80|0)+60|0,b=f;break}b=18640+(b*80|0)+40|0,A?(jp(Pt,ht,0,0),hc(It,Pt,R),Uo(R),is(R,Pt,It),S=b,b=f):(S=b,b=f)}else S=18640+((d[f>>2]|0)*80|0)+20|0,b=f;while(!1);if(d[b>>2]=d[S>>2],E=S+16|0,(d[E>>2]|0)>0){b=0;do va(It),b=b+1|0;while((b|0)<(d[E>>2]|0))}return f=S+4|0,d[Pt>>2]=d[f>>2],d[Pt+4>>2]=d[f+4>>2],d[Pt+8>>2]=d[f+8>>2],h=d[16880+(h<<2)>>2]|0,uh(Pt,W?h*3|0:h),is(It,Pt,It),qr(It),W?b=((d[U>>2]|0)+(d[It>>2]|0)+(d[F>>2]|0)|0)==(ht|0)?1:2:b=2,It=b,gt=Mt,It|0}function zn(f,h){f=f|0,h=h|0;var A=0;do A=Vo(f,h,0,1)|0;while((A|0)==2);return A|0}function Sl(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0,Ge=0,ze=0,Ri=0,Ci=0,ji=0,Ti=0;if(Ci=gt,gt=gt+240|0,S=Ci+224|0,Be=Ci+208|0,Ge=Ci,ze=Ci+192|0,Ri=Ci+176|0,Ht=Ci+160|0,ie=Ci+144|0,te=Ci+128|0,Jt=Ci+112|0,qt=Ci+96|0,d[S>>2]=h,d[Be>>2]=d[f>>2],d[Be+4>>2]=d[f+4>>2],d[Be+8>>2]=d[f+8>>2],d[Be+12>>2]=d[f+12>>2],Df(Be,S,Ge),d[E>>2]=0,Yt=b+A+((b|0)==6&1)|0,(Yt|0)<=(A|0)){gt=Ci;return}F=d[S>>2]|0,U=A+6|0,W=16960+(F<<2)|0,ht=ie+8|0,Pt=te+8|0,It=Jt+8|0,Mt=ze+4|0,P=0,R=A,b=-1;t:for(;;){if(S=(R|0)%6|0,f=Ge+(S<<4)|0,d[ze>>2]=d[f>>2],d[ze+4>>2]=d[f+4>>2],d[ze+8>>2]=d[f+8>>2],d[ze+12>>2]=d[f+12>>2],f=P,P=Vo(ze,F,0,1)|0,(R|0)>(A|0)&(_s(h)|0)!=0&&(f|0)!=1&&(d[ze>>2]|0)!=(b|0)){switch(ta(Ge+(((S+5|0)%6|0)<<4)+4|0,Ri),ta(Ge+(S<<4)+4|0,Ht),ji=+(d[W>>2]|0),tt[ie>>3]=ji*3,tt[ht>>3]=0,Ti=ji*-1.5,tt[te>>3]=Ti,tt[Pt>>3]=ji*2.598076211353316,tt[Jt>>3]=Ti,tt[It>>3]=ji*-2.598076211353316,S=d[Be>>2]|0,d[17040+(S*80|0)+(((b|0)==(S|0)?d[ze>>2]|0:b)<<2)>>2]|0){case 1:{f=te,b=ie;break}case 3:{f=Jt,b=te;break}case 2:{f=ie,b=Jt;break}default:{f=8;break t}}Cc(Ri,Ht,b,f,qt),!(Su(Ri,qt)|0)&&!(Su(Ht,qt)|0)&&(Tl(qt,d[Be>>2]|0,F,1,E+8+(d[E>>2]<<4)|0),d[E>>2]=(d[E>>2]|0)+1)}if((R|0)<(U|0)&&(ta(Mt,Ri),Tl(Ri,d[ze>>2]|0,F,1,E+8+(d[E>>2]<<4)|0),d[E>>2]=(d[E>>2]|0)+1),R=R+1|0,(R|0)>=(Yt|0)){f=3;break}else b=d[ze>>2]|0}if((f|0)==3){gt=Ci;return}else(f|0)==8&&ti(27054,27017,737,27099)}function Df(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0;F=gt,gt=gt+160|0,b=F+80|0,E=F,S=b,P=20368,R=S+72|0;do d[S>>2]=d[P>>2],S=S+4|0,P=P+4|0;while((S|0)<(R|0));S=E,P=20448,R=S+72|0;do d[S>>2]=d[P>>2],S=S+4|0,P=P+4|0;while((S|0)<(R|0));R=(_s(d[h>>2]|0)|0)==0,b=R?b:E,E=f+4|0,_a(E),ia(E),_s(d[h>>2]|0)|0&&(Bs(E),d[h>>2]=(d[h>>2]|0)+1),d[A>>2]=d[f>>2],h=A+4|0,is(E,b,h),qr(h),d[A+16>>2]=d[f>>2],h=A+20|0,is(E,b+12|0,h),qr(h),d[A+32>>2]=d[f>>2],h=A+36|0,is(E,b+24|0,h),qr(h),d[A+48>>2]=d[f>>2],h=A+52|0,is(E,b+36|0,h),qr(h),d[A+64>>2]=d[f>>2],h=A+68|0,is(E,b+48|0,h),qr(h),d[A+80>>2]=d[f>>2],A=A+84|0,is(E,b+60|0,A),qr(A),gt=F}function Pl(f,h){return f=f|0,h=h|0,h=D(f|0,h|0,52)|0,_t()|0,h&15|0}function fh(f,h){return f=f|0,h=h|0,h=D(f|0,h|0,45)|0,_t()|0,h&127|0}function dh(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0;return!(!0&(h&-16777216|0)==134217728)||(b=D(f|0,h|0,52)|0,_t()|0,b=b&15,A=D(f|0,h|0,45)|0,_t()|0,A=A&127,A>>>0>121)?(f=0,f|0):(P=(b^15)*3|0,E=D(f|0,h|0,P|0)|0,P=O(E|0,_t()|0,P|0)|0,E=_t()|0,S=Ur(-1227133514,-1171,P|0,E|0)|0,!((P&613566756&S|0)==0&(E&4681&(_t()|0)|0)==0)||(P=(b*3|0)+19|0,S=O(~f|0,~h|0,P|0)|0,P=D(S|0,_t()|0,P|0)|0,!((b|0)==15|(P|0)==0&(_t()|0)==0))?(P=0,P|0):!(pt[20528+A>>0]|0)||(h=h&8191,(f|0)==0&(h|0)==0)?(P=1,P|0):(P=G(f|0,h|0)|0,_t()|0,((63-P|0)%3|0|0)!=0|0))}function Ac(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0;if(E=O(h|0,0,52)|0,S=_t()|0,A=O(A|0,0,45)|0,A=S|(_t()|0)|134225919,(h|0)<1){S=-1,b=A,h=f,d[h>>2]=S,f=f+4|0,d[f>>2]=b;return}for(S=1,E=-1;P=(15-S|0)*3|0,R=O(7,0,P|0)|0,A=A&~(_t()|0),P=O(b|0,0,P|0)|0,E=E&~R|P,A=A|(_t()|0),(S|0)!=(h|0);)S=S+1|0;R=f,P=R,d[P>>2]=E,R=R+4|0,d[R>>2]=A}function Il(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0;if(S=D(f|0,h|0,52)|0,_t()|0,S=S&15,A>>>0>15)return b=4,b|0;if((S|0)<(A|0))return b=12,b|0;if((S|0)==(A|0))return d[b>>2]=f,d[b+4>>2]=h,b=0,b|0;if(E=O(A|0,0,52)|0,E=E|f,f=_t()|0|h&-15728641,(S|0)>(A|0))do h=O(7,0,(14-A|0)*3|0)|0,A=A+1|0,E=h|E,f=_t()|0|f;while((A|0)<(S|0));return d[b>>2]=E,d[b+4>>2]=f,b=0,b|0}function Go(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0;if(S=D(f|0,h|0,52)|0,_t()|0,S=S&15,!((A|0)<16&(S|0)<=(A|0)))return b=4,b|0;E=A-S|0,A=D(f|0,h|0,45)|0,_t()|0;t:do if(!(Tn(A&127)|0))A=Sr(7,0,E,((E|0)<0)<<31>>31)|0,E=_t()|0;else{e:do if(S|0){for(A=1;P=O(7,0,(15-A|0)*3|0)|0,!!((P&f|0)==0&((_t()|0)&h|0)==0);)if(A>>>0<S>>>0)A=A+1|0;else break e;A=Sr(7,0,E,((E|0)<0)<<31>>31)|0,E=_t()|0;break t}while(!1);A=Sr(7,0,E,((E|0)<0)<<31>>31)|0,A=v(A|0,_t()|0,5,0)|0,A=Ei(A|0,_t()|0,-5,-1)|0,A=Mo(A|0,_t()|0,6,0)|0,A=Ei(A|0,_t()|0,1,0)|0,E=_t()|0}while(!1);return P=b,d[P>>2]=A,d[P+4>>2]=E,P=0,P|0}function Rn(f,h){f=f|0,h=h|0;var A=0,b=0,E=0;if(E=D(f|0,h|0,45)|0,_t()|0,!(Tn(E&127)|0))return E=0,E|0;E=D(f|0,h|0,52)|0,_t()|0,E=E&15;t:do if(!E)A=0;else for(b=1;;){if(A=D(f|0,h|0,(15-b|0)*3|0)|0,_t()|0,A=A&7,A|0)break t;if(b>>>0<E>>>0)b=b+1|0;else{A=0;break}}while(!1);return E=(A|0)==0&1,E|0}function mc(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0;if(P=gt,gt=gt+16|0,S=P,ra(S,f,h,A),h=S,f=d[h>>2]|0,h=d[h+4>>2]|0,(f|0)==0&(h|0)==0)return gt=P,0;E=0,A=0;do R=b+(E<<3)|0,d[R>>2]=f,d[R+4>>2]=h,E=Ei(E|0,A|0,1,0)|0,A=_t()|0,Dl(S),R=S,f=d[R>>2]|0,h=d[R+4>>2]|0;while(!((f|0)==0&(h|0)==0));return gt=P,0}function Ml(f,h,A,b){return f=f|0,h=h|0,A=A|0,b=b|0,(b|0)<(A|0)?(A=h,b=f,mi(A|0),b|0):(A=O(-1,-1,((b-A|0)*3|0)+3|0)|0,b=O(~A|0,~(_t()|0)|0,(15-b|0)*3|0)|0,A=~(_t()|0)&h,b=~b&f,mi(A|0),b|0)}function Ka(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0;return E=D(f|0,h|0,52)|0,_t()|0,E=E&15,(A|0)<16&(E|0)<=(A|0)?((E|0)<(A|0)&&(E=O(-1,-1,((A+-1-E|0)*3|0)+3|0)|0,E=O(~E|0,~(_t()|0)|0,(15-A|0)*3|0)|0,h=~(_t()|0)&h,f=~E&f),E=O(A|0,0,52)|0,A=h&-15728641|(_t()|0),d[b>>2]=f|E,d[b+4>>2]=A,b=0,b|0):(b=4,b|0)}function kf(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0,Ge=0,ze=0,Ri=0,Ci=0,ji=0,Ti=0,ai=0,We=0;if((A|0)==0&(b|0)==0)return We=0,We|0;if(E=f,S=d[E>>2]|0,E=d[E+4>>2]|0,!0&(E&15728640|0)==0){if(!((b|0)>0|(b|0)==0&A>>>0>0)||(We=h,d[We>>2]=S,d[We+4>>2]=E,(A|0)==1&(b|0)==0))return We=0,We|0;E=1,S=0;do Ti=f+(E<<3)|0,ai=d[Ti+4>>2]|0,We=h+(E<<3)|0,d[We>>2]=d[Ti>>2],d[We+4>>2]=ai,E=Ei(E|0,S|0,1,0)|0,S=_t()|0;while((S|0)<(b|0)|(S|0)==(b|0)&E>>>0<A>>>0);return E=0,E|0}if(ji=A<<3,ai=ss(ji)|0,!ai)return We=13,We|0;if(Ct(ai|0,f|0,ji|0)|0,Ti=Pr(A,8)|0,!Ti)return Fi(ai),We=13,We|0;t:for(;;){E=ai,U=d[E>>2]|0,E=d[E+4>>2]|0,Ri=D(U|0,E|0,52)|0,_t()|0,Ri=Ri&15,Ci=Ri+-1|0,ze=(Ri|0)!=0,Ge=(b|0)>0|(b|0)==0&A>>>0>0;e:do if(ze&Ge){if(te=O(Ci|0,0,52)|0,Jt=_t()|0,Ci>>>0>15){if(!((U|0)==0&(E|0)==0)){We=16;break t}for(S=0,f=0;;){if(S=Ei(S|0,f|0,1,0)|0,f=_t()|0,!((f|0)<(b|0)|(f|0)==(b|0)&S>>>0<A>>>0))break e;if(P=ai+(S<<3)|0,Be=d[P>>2]|0,P=d[P+4>>2]|0,!((Be|0)==0&(P|0)==0)){E=P,We=16;break t}}}for(R=U,f=E,S=0,P=0;;){if(!((R|0)==0&(f|0)==0)){if(!(!0&(f&117440512|0)==0)){We=21;break t}if(W=D(R|0,f|0,52)|0,_t()|0,W=W&15,(W|0)<(Ci|0)){E=12,We=27;break t}if((W|0)!=(Ci|0)&&(R=R|te,f=f&-15728641|Jt,W>>>0>=Ri>>>0)){F=Ci;do Be=O(7,0,(14-F|0)*3|0)|0,F=F+1|0,R=Be|R,f=_t()|0|f;while(F>>>0<W>>>0)}if(Pt=w(R|0,f|0,A|0,b|0)|0,It=_t()|0,F=Ti+(Pt<<3)|0,W=F,ht=d[W>>2]|0,W=d[W+4>>2]|0,!((ht|0)==0&(W|0)==0)){Ht=0,ie=0;do{if((Ht|0)>(b|0)|(Ht|0)==(b|0)&ie>>>0>A>>>0){We=31;break t}if((ht|0)==(R|0)&(W&-117440513|0)==(f|0)){Mt=D(ht|0,W|0,56)|0,_t()|0,Mt=Mt&7,Yt=Mt+1|0,Be=D(ht|0,W|0,45)|0,_t()|0;i:do if(!(Tn(Be&127)|0))W=7;else{if(ht=D(ht|0,W|0,52)|0,_t()|0,ht=ht&15,!ht){W=6;break}for(W=1;;){if(Be=O(7,0,(15-W|0)*3|0)|0,!((Be&R|0)==0&((_t()|0)&f|0)==0)){W=7;break i}if(W>>>0<ht>>>0)W=W+1|0;else{W=6;break}}}while(!1);if((Mt+2|0)>>>0>W>>>0){We=41;break t}Be=O(Yt|0,0,56)|0,f=_t()|0|f&-117440513,qt=F,d[qt>>2]=0,d[qt+4>>2]=0,R=Be|R}else Pt=Ei(Pt|0,It|0,1,0)|0,Pt=g(Pt|0,_t()|0,A|0,b|0)|0,It=_t()|0;ie=Ei(ie|0,Ht|0,1,0)|0,Ht=_t()|0,F=Ti+(Pt<<3)|0,W=F,ht=d[W>>2]|0,W=d[W+4>>2]|0}while(!((ht|0)==0&(W|0)==0))}Be=F,d[Be>>2]=R,d[Be+4>>2]=f}if(S=Ei(S|0,P|0,1,0)|0,P=_t()|0,!((P|0)<(b|0)|(P|0)==(b|0)&S>>>0<A>>>0))break e;f=ai+(S<<3)|0,R=d[f>>2]|0,f=d[f+4>>2]|0}}while(!1);if(Be=Ei(A|0,b|0,5,0)|0,qt=_t()|0,qt>>>0<0|(qt|0)==0&Be>>>0<11){We=85;break}if(Be=Mo(A|0,b|0,6,0)|0,_t()|0,Be=Pr(Be,8)|0,!Be){We=48;break}do if(Ge){for(Yt=0,f=0,Mt=0,Ht=0;;){if(W=Ti+(Yt<<3)|0,P=W,S=d[P>>2]|0,P=d[P+4>>2]|0,(S|0)==0&(P|0)==0)qt=Mt;else{ht=D(S|0,P|0,56)|0,_t()|0,ht=ht&7,R=ht+1|0,Pt=P&-117440513,qt=D(S|0,P|0,45)|0,_t()|0;e:do if(Tn(qt&127)|0){if(It=D(S|0,P|0,52)|0,_t()|0,It=It&15,It|0)for(F=1;;){if(qt=O(7,0,(15-F|0)*3|0)|0,!((S&qt|0)==0&(Pt&(_t()|0)|0)==0))break e;if(F>>>0<It>>>0)F=F+1|0;else break}P=O(R|0,0,56)|0,S=P|S,P=_t()|0|Pt,R=W,d[R>>2]=S,d[R+4>>2]=P,R=ht+2|0}while(!1);(R|0)==7?(qt=Be+(f<<3)|0,d[qt>>2]=S,d[qt+4>>2]=P&-117440513,f=Ei(f|0,Mt|0,1,0)|0,qt=_t()|0):qt=Mt}if(Yt=Ei(Yt|0,Ht|0,1,0)|0,Ht=_t()|0,(Ht|0)<(b|0)|(Ht|0)==(b|0)&Yt>>>0<A>>>0)Mt=qt;else break}if(Ge){if(ie=Ci>>>0>15,te=O(Ci|0,0,52)|0,Jt=_t()|0,!ze){for(S=0,F=0,R=0,P=0;(U|0)==0&(E|0)==0||(Ci=h+(S<<3)|0,d[Ci>>2]=U,d[Ci+4>>2]=E,S=Ei(S|0,F|0,1,0)|0,F=_t()|0),R=Ei(R|0,P|0,1,0)|0,P=_t()|0,!!((P|0)<(b|0)|(P|0)==(b|0)&R>>>0<A>>>0);)E=ai+(R<<3)|0,U=d[E>>2]|0,E=d[E+4>>2]|0;E=qt;break}for(S=0,F=0,P=0,R=0;;){do if(!((U|0)==0&(E|0)==0)){if(It=D(U|0,E|0,52)|0,_t()|0,It=It&15,ie|(It|0)<(Ci|0)){We=80;break t}if((It|0)!=(Ci|0)){if(W=U|te,ht=E&-15728641|Jt,It>>>0>=Ri>>>0){Pt=Ci;do ze=O(7,0,(14-Pt|0)*3|0)|0,Pt=Pt+1|0,W=ze|W,ht=_t()|0|ht;while(Pt>>>0<It>>>0)}}else W=U,ht=E;Mt=w(W|0,ht|0,A|0,b|0)|0,Pt=0,It=0,Ht=_t()|0;do{if((Pt|0)>(b|0)|(Pt|0)==(b|0)&It>>>0>A>>>0){We=81;break t}if(ze=Ti+(Mt<<3)|0,Yt=d[ze+4>>2]|0,(Yt&-117440513|0)==(ht|0)&&(d[ze>>2]|0)==(W|0)){We=65;break}ze=Ei(Mt|0,Ht|0,1,0)|0,Mt=g(ze|0,_t()|0,A|0,b|0)|0,Ht=_t()|0,It=Ei(It|0,Pt|0,1,0)|0,Pt=_t()|0,ze=Ti+(Mt<<3)|0}while(!((d[ze>>2]|0)==(W|0)&&(d[ze+4>>2]|0)==(ht|0)));if((We|0)==65&&(We=0,!0&(Yt&117440512|0)==100663296))break;ze=h+(S<<3)|0,d[ze>>2]=U,d[ze+4>>2]=E,S=Ei(S|0,F|0,1,0)|0,F=_t()|0}while(!1);if(P=Ei(P|0,R|0,1,0)|0,R=_t()|0,!((R|0)<(b|0)|(R|0)==(b|0)&P>>>0<A>>>0))break;E=ai+(P<<3)|0,U=d[E>>2]|0,E=d[E+4>>2]|0}E=qt}else S=0,E=qt}else S=0,f=0,E=0;while(!1);if(Bt(Ti|0,0,ji|0)|0,Ct(ai|0,Be|0,f<<3|0)|0,Fi(Be),(f|0)==0&(E|0)==0){We=89;break}else h=h+(S<<3)|0,b=E,A=f}if((We|0)==16)!0&(E&117440512|0)==0?(E=4,We=27):We=21;else if((We|0)==31)ti(27795,27122,529,27132);else{if((We|0)==41)return Fi(ai),Fi(Ti),We=10,We|0;if((We|0)==48)return Fi(ai),Fi(Ti),We=13,We|0;(We|0)==80?ti(27795,27122,620,27132):(We|0)==81?ti(27795,27122,632,27132):(We|0)==85&&(Ct(h|0,ai|0,A<<3|0)|0,We=89)}return(We|0)==21?(Fi(ai),Fi(Ti),We=5,We|0):(We|0)==27?(Fi(ai),Fi(Ti),We=E,We|0):(We|0)==89?(Fi(ai),Fi(Ti),We=0,We|0):0}function Bl(f,h,A,b,E,S,P){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0,S=S|0,P=P|0;var R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0;if(Yt=gt,gt=gt+16|0,Mt=Yt,!((A|0)>0|(A|0)==0&h>>>0>0))return Mt=0,gt=Yt,Mt|0;if((P|0)>=16)return Mt=12,gt=Yt,Mt|0;Pt=0,It=0,ht=0,R=0;t:for(;;){if(U=f+(Pt<<3)|0,F=d[U>>2]|0,U=d[U+4>>2]|0,W=D(F|0,U|0,52)|0,_t()|0,(W&15|0)>(P|0)){R=12,F=11;break}if(ra(Mt,F,U,P),W=Mt,U=d[W>>2]|0,W=d[W+4>>2]|0,(U|0)==0&(W|0)==0)F=ht;else{F=ht;do{if(!((R|0)<(S|0)|(R|0)==(S|0)&F>>>0<E>>>0)){F=10;break t}ht=b+(F<<3)|0,d[ht>>2]=U,d[ht+4>>2]=W,F=Ei(F|0,R|0,1,0)|0,R=_t()|0,Dl(Mt),ht=Mt,U=d[ht>>2]|0,W=d[ht+4>>2]|0}while(!((U|0)==0&(W|0)==0))}if(Pt=Ei(Pt|0,It|0,1,0)|0,It=_t()|0,(It|0)<(A|0)|(It|0)==(A|0)&Pt>>>0<h>>>0)ht=F;else{R=0,F=11;break}}return(F|0)==10?(Mt=14,gt=Yt,Mt|0):(F|0)==11?(gt=Yt,R|0):0}function _o(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0;Pt=gt,gt=gt+16|0,ht=Pt;t:do if((A|0)>0|(A|0)==0&h>>>0>0){for(U=0,P=0,S=0,W=0;;){if(F=f+(U<<3)|0,R=d[F>>2]|0,F=d[F+4>>2]|0,!((R|0)==0&(F|0)==0)&&(F=(Go(R,F,b,ht)|0)==0,R=ht,P=Ei(d[R>>2]|0,d[R+4>>2]|0,P|0,S|0)|0,S=_t()|0,!F)){S=12;break}if(U=Ei(U|0,W|0,1,0)|0,W=_t()|0,!((W|0)<(A|0)|(W|0)==(A|0)&U>>>0<h>>>0))break t}return gt=Pt,S|0}else P=0,S=0;while(!1);return d[E>>2]=P,d[E+4>>2]=S,E=0,gt=Pt,E|0}function Of(f,h){return f=f|0,h=h|0,h=D(f|0,h|0,52)|0,_t()|0,h&1|0}function vs(f,h){f=f|0,h=h|0;var A=0,b=0,E=0;if(E=D(f|0,h|0,52)|0,_t()|0,E=E&15,!E)return E=0,E|0;for(b=1;;){if(A=D(f|0,h|0,(15-b|0)*3|0)|0,_t()|0,A=A&7,A|0){b=5;break}if(b>>>0<E>>>0)b=b+1|0;else{A=0,b=5;break}}return(b|0)==5?A|0:0}function gc(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0;if(F=D(f|0,h|0,52)|0,_t()|0,F=F&15,!F)return R=h,F=f,mi(R|0),F|0;for(R=1,A=0;;){S=(15-R|0)*3|0,b=O(7,0,S|0)|0,E=_t()|0,P=D(f|0,h|0,S|0)|0,_t()|0,S=O(Rs(P&7)|0,0,S|0)|0,P=_t()|0,f=S|f&~b,h=P|h&~E;t:do if(!A)if((S&b|0)==0&(P&E|0)==0)A=0;else if(b=D(f|0,h|0,52)|0,_t()|0,b=b&15,!b)A=1;else{A=1;e:for(;;){switch(P=D(f|0,h|0,(15-A|0)*3|0)|0,_t()|0,P&7){case 1:break e;case 0:break;default:{A=1;break t}}if(A>>>0<b>>>0)A=A+1|0;else{A=1;break t}}for(A=1;;)if(P=(15-A|0)*3|0,E=D(f|0,h|0,P|0)|0,_t()|0,S=O(7,0,P|0)|0,h=h&~(_t()|0),P=O(Rs(E&7)|0,0,P|0)|0,f=f&~S|P,h=h|(_t()|0),A>>>0<b>>>0)A=A+1|0;else{A=1;break}}while(!1);if(R>>>0<F>>>0)R=R+1|0;else break}return mi(h|0),f|0}function Ks(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0;if(b=D(f|0,h|0,52)|0,_t()|0,b=b&15,!b)return A=h,b=f,mi(A|0),b|0;for(A=1;S=(15-A|0)*3|0,P=D(f|0,h|0,S|0)|0,_t()|0,E=O(7,0,S|0)|0,h=h&~(_t()|0),S=O(Rs(P&7)|0,0,S|0)|0,f=S|f&~E,h=_t()|0|h,A>>>0<b>>>0;)A=A+1|0;return mi(h|0),f|0}function yu(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0;if(F=D(f|0,h|0,52)|0,_t()|0,F=F&15,!F)return R=h,F=f,mi(R|0),F|0;for(R=1,A=0;;){S=(15-R|0)*3|0,b=O(7,0,S|0)|0,E=_t()|0,P=D(f|0,h|0,S|0)|0,_t()|0,S=O(Ls(P&7)|0,0,S|0)|0,P=_t()|0,f=S|f&~b,h=P|h&~E;t:do if(!A)if((S&b|0)==0&(P&E|0)==0)A=0;else if(b=D(f|0,h|0,52)|0,_t()|0,b=b&15,!b)A=1;else{A=1;e:for(;;){switch(P=D(f|0,h|0,(15-A|0)*3|0)|0,_t()|0,P&7){case 1:break e;case 0:break;default:{A=1;break t}}if(A>>>0<b>>>0)A=A+1|0;else{A=1;break t}}for(A=1;;)if(E=(15-A|0)*3|0,S=O(7,0,E|0)|0,P=h&~(_t()|0),h=D(f|0,h|0,E|0)|0,_t()|0,h=O(Ls(h&7)|0,0,E|0)|0,f=f&~S|h,h=P|(_t()|0),A>>>0<b>>>0)A=A+1|0;else{A=1;break}}while(!1);if(R>>>0<F>>>0)R=R+1|0;else break}return mi(h|0),f|0}function Rl(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0;if(b=D(f|0,h|0,52)|0,_t()|0,b=b&15,!b)return A=h,b=f,mi(A|0),b|0;for(A=1;P=(15-A|0)*3|0,S=O(7,0,P|0)|0,E=h&~(_t()|0),h=D(f|0,h|0,P|0)|0,_t()|0,h=O(Ls(h&7)|0,0,P|0)|0,f=h|f&~S,h=_t()|0|E,A>>>0<b>>>0;)A=A+1|0;return mi(h|0),f|0}function ph(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;if(F=gt,gt=gt+64|0,R=F+40|0,b=F+24|0,E=F+12|0,S=F,O(h|0,0,52)|0,A=_t()|0|134225919,!h)return(d[f+4>>2]|0)>2||(d[f+8>>2]|0)>2||(d[f+12>>2]|0)>2?(P=0,R=0,mi(P|0),gt=F,R|0):(O(qs(f)|0,0,45)|0,P=_t()|0|A,R=-1,mi(P|0),gt=F,R|0);if(d[R>>2]=d[f>>2],d[R+4>>2]=d[f+4>>2],d[R+8>>2]=d[f+8>>2],d[R+12>>2]=d[f+12>>2],P=R+4|0,(h|0)>0)for(f=-1;d[b>>2]=d[P>>2],d[b+4>>2]=d[P+4>>2],d[b+8>>2]=d[P+8>>2],h&1?(Tf(P),d[E>>2]=d[P>>2],d[E+4>>2]=d[P+4>>2],d[E+8>>2]=d[P+8>>2],Cl(E)):(Nr(P),d[E>>2]=d[P>>2],d[E+4>>2]=d[P+4>>2],d[E+8>>2]=d[P+8>>2],Bs(E)),hc(b,E,S),qr(S),W=(15-h|0)*3|0,U=O(7,0,W|0)|0,A=A&~(_t()|0),W=O(fc(S)|0,0,W|0)|0,f=W|f&~U,A=_t()|0|A,(h|0)>1;)h=h+-1|0;else f=-1;t:do if((d[P>>2]|0)<=2&&(d[R+8>>2]|0)<=2&&(d[R+12>>2]|0)<=2){if(b=qs(R)|0,h=O(b|0,0,45)|0,h=h|f,f=_t()|0|A&-1040385,S=wf(R)|0,!(Tn(b)|0)){if((S|0)<=0)break;for(E=0;;){if(b=D(h|0,f|0,52)|0,_t()|0,b=b&15,b)for(A=1;W=(15-A|0)*3|0,R=D(h|0,f|0,W|0)|0,_t()|0,U=O(7,0,W|0)|0,f=f&~(_t()|0),W=O(Rs(R&7)|0,0,W|0)|0,h=h&~U|W,f=f|(_t()|0),A>>>0<b>>>0;)A=A+1|0;if(E=E+1|0,(E|0)==(S|0))break t}}E=D(h|0,f|0,52)|0,_t()|0,E=E&15;e:do if(E){A=1;i:for(;;){switch(W=D(h|0,f|0,(15-A|0)*3|0)|0,_t()|0,W&7){case 1:break i;case 0:break;default:break e}if(A>>>0<E>>>0)A=A+1|0;else break e}if(ac(b,d[R>>2]|0)|0)for(A=1;R=(15-A|0)*3|0,U=O(7,0,R|0)|0,W=f&~(_t()|0),f=D(h|0,f|0,R|0)|0,_t()|0,f=O(Ls(f&7)|0,0,R|0)|0,h=h&~U|f,f=W|(_t()|0),A>>>0<E>>>0;)A=A+1|0;else for(A=1;W=(15-A|0)*3|0,R=D(h|0,f|0,W|0)|0,_t()|0,U=O(7,0,W|0)|0,f=f&~(_t()|0),W=O(Rs(R&7)|0,0,W|0)|0,h=h&~U|W,f=f|(_t()|0),A>>>0<E>>>0;)A=A+1|0}while(!1);if((S|0)>0){A=0;do h=gc(h,f)|0,f=_t()|0,A=A+1|0;while((A|0)!=(S|0))}}else h=0,f=0;while(!1);return U=f,W=h,mi(U|0),gt=F,W|0}function _s(f){return f=f|0,(f|0)%2|0|0}function Ah(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0;return E=gt,gt=gt+16|0,b=E,h>>>0>15?(b=4,gt=E,b|0):(d[f+4>>2]&2146435072|0)==2146435072||(d[f+8+4>>2]&2146435072|0)==2146435072?(b=3,gt=E,b|0):(Lf(f,h,b),h=ph(b,h)|0,b=_t()|0,d[A>>2]=h,d[A+4>>2]=b,(h|0)==0&(b|0)==0&&ti(27795,27122,959,27145),b=0,gt=E,b|0)}function Ll(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0;if(E=A+4|0,S=D(f|0,h|0,52)|0,_t()|0,S=S&15,P=D(f|0,h|0,45)|0,_t()|0,b=(S|0)==0,Tn(P&127)|0){if(b)return P=1,P|0;b=1}else{if(b)return P=0,P|0;(d[E>>2]|0)==0&&(d[A+8>>2]|0)==0?b=(d[A+12>>2]|0)!=0&1:b=1}for(A=1;A&1?Cl(E):Bs(E),P=D(f|0,h|0,(15-A|0)*3|0)|0,_t()|0,ea(E,P&7),A>>>0<S>>>0;)A=A+1|0;return b|0}function xa(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;if(W=gt,gt=gt+16|0,F=W,U=D(f|0,h|0,45)|0,_t()|0,U=U&127,U>>>0>121)return d[A>>2]=0,d[A+4>>2]=0,d[A+8>>2]=0,d[A+12>>2]=0,U=5,gt=W,U|0;t:do if((Tn(U)|0)!=0&&(S=D(f|0,h|0,52)|0,_t()|0,S=S&15,(S|0)!=0)){b=1;e:for(;;){switch(R=D(f|0,h|0,(15-b|0)*3|0)|0,_t()|0,R&7){case 5:break e;case 0:break;default:{b=h;break t}}if(b>>>0<S>>>0)b=b+1|0;else{b=h;break t}}for(E=1,b=h;h=(15-E|0)*3|0,P=O(7,0,h|0)|0,R=b&~(_t()|0),b=D(f|0,b|0,h|0)|0,_t()|0,b=O(Ls(b&7)|0,0,h|0)|0,f=f&~P|b,b=R|(_t()|0),E>>>0<S>>>0;)E=E+1|0}else b=h;while(!1);if(R=7696+(U*28|0)|0,d[A>>2]=d[R>>2],d[A+4>>2]=d[R+4>>2],d[A+8>>2]=d[R+8>>2],d[A+12>>2]=d[R+12>>2],!(Ll(f,b,A)|0))return U=0,gt=W,U|0;if(P=A+4|0,d[F>>2]=d[P>>2],d[F+4>>2]=d[P+4>>2],d[F+8>>2]=d[P+8>>2],S=D(f|0,b|0,52)|0,_t()|0,R=S&15,S&1?(Bs(P),S=R+1|0):S=R,!(Tn(U)|0))b=0;else{t:do if(!R)b=0;else for(h=1;;){if(E=D(f|0,b|0,(15-h|0)*3|0)|0,_t()|0,E=E&7,E|0){b=E;break t}if(h>>>0<R>>>0)h=h+1|0;else{b=0;break}}while(!1);b=(b|0)==4&1}if(!(Vo(A,S,b,0)|0))(S|0)!=(R|0)&&(d[P>>2]=d[F>>2],d[P+4>>2]=d[F+4>>2],d[P+8>>2]=d[F+8>>2]);else{if(Tn(U)|0)do;while((Vo(A,S,0,0)|0)!=0);(S|0)!=(R|0)&&Nr(P)}return U=0,gt=W,U|0}function wa(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0;return S=gt,gt=gt+16|0,b=S,E=xa(f,h,b)|0,E|0?(gt=S,E|0):(E=D(f|0,h|0,52)|0,_t()|0,qa(b,E&15,A),E=0,gt=S,E|0)}function Za(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0;if(P=gt,gt=gt+16|0,S=P,b=xa(f,h,S)|0,b|0)return S=b,gt=P,S|0;b=D(f|0,h|0,45)|0,_t()|0,b=(Tn(b&127)|0)==0,E=D(f|0,h|0,52)|0,_t()|0,E=E&15;t:do if(!b){if(E|0)for(b=1;;){if(R=O(7,0,(15-b|0)*3|0)|0,!((R&f|0)==0&((_t()|0)&h|0)==0))break t;if(b>>>0<E>>>0)b=b+1|0;else break}return na(S,E,0,5,A),R=0,gt=P,R|0}while(!1);return Sl(S,E,0,6,A),R=0,gt=P,R|0}function yc(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0;if(E=D(f|0,h|0,45)|0,_t()|0,!(Tn(E&127)|0))return E=2,d[A>>2]=E,0;if(E=D(f|0,h|0,52)|0,_t()|0,E=E&15,!E)return E=5,d[A>>2]=E,0;for(b=1;;){if(S=O(7,0,(15-b|0)*3|0)|0,!((S&f|0)==0&((_t()|0)&h|0)==0)){b=2,f=6;break}if(b>>>0<E>>>0)b=b+1|0;else{b=5,f=6;break}}return(f|0)==6&&(d[A>>2]=b),0}function vc(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0;ht=gt,gt=gt+128|0,U=ht+112|0,S=ht+96|0,W=ht,E=D(f|0,h|0,52)|0,_t()|0,R=E&15,d[U>>2]=R,P=D(f|0,h|0,45)|0,_t()|0,P=P&127;t:do if(Tn(P)|0){if(R|0)for(b=1;;){if(F=O(7,0,(15-b|0)*3|0)|0,!((F&f|0)==0&((_t()|0)&h|0)==0)){E=0;break t}if(b>>>0<R>>>0)b=b+1|0;else break}if(E&1)E=1;else return F=O(R+1|0,0,52)|0,W=_t()|0|h&-15728641,U=O(7,0,(14-R|0)*3|0)|0,W=vc((F|f)&~U,W&~(_t()|0),A)|0,gt=ht,W|0}else E=0;while(!1);if(b=xa(f,h,S)|0,!b){E?(hh(S,U,W),F=5):(Df(S,U,W),F=6);t:do if(Tn(P)|0)if(!R)f=5;else for(b=1;;){if(P=O(7,0,(15-b|0)*3|0)|0,!((P&f|0)==0&((_t()|0)&h|0)==0)){f=2;break t}if(b>>>0<R>>>0)b=b+1|0;else{f=5;break}}else f=2;while(!1);Bt(A|0,-1,f<<2|0)|0;t:do if(E)for(S=0;;){if(P=W+(S<<4)|0,zn(P,d[U>>2]|0)|0,P=d[P>>2]|0,R=d[A>>2]|0,(R|0)==-1|(R|0)==(P|0))b=A;else{E=0;do{if(E=E+1|0,E>>>0>=f>>>0){b=1;break t}b=A+(E<<2)|0,R=d[b>>2]|0}while(!((R|0)==-1|(R|0)==(P|0)))}if(d[b>>2]=P,S=S+1|0,S>>>0>=F>>>0){b=0;break}}else for(S=0;;){if(P=W+(S<<4)|0,Vo(P,d[U>>2]|0,0,1)|0,P=d[P>>2]|0,R=d[A>>2]|0,(R|0)==-1|(R|0)==(P|0))b=A;else{E=0;do{if(E=E+1|0,E>>>0>=f>>>0){b=1;break t}b=A+(E<<2)|0,R=d[b>>2]|0}while(!((R|0)==-1|(R|0)==(P|0)))}if(d[b>>2]=P,S=S+1|0,S>>>0>=F>>>0){b=0;break}}while(!1)}return W=b,gt=ht,W|0}function mh(){return 12}function vu(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0;if(f>>>0>15)return R=4,R|0;if(O(f|0,0,52)|0,R=_t()|0|134225919,!f){A=0,b=0;do Tn(b)|0&&(O(b|0,0,45)|0,P=R|(_t()|0),f=h+(A<<3)|0,d[f>>2]=-1,d[f+4>>2]=P,A=A+1|0),b=b+1|0;while((b|0)!=122);return A=0,A|0}A=0,P=0;do{if(Tn(P)|0){for(O(P|0,0,45)|0,b=1,E=-1,S=R|(_t()|0);F=O(7,0,(15-b|0)*3|0)|0,E=E&~F,S=S&~(_t()|0),(b|0)!=(f|0);)b=b+1|0;F=h+(A<<3)|0,d[F>>2]=E,d[F+4>>2]=S,A=A+1|0}P=P+1|0}while((P|0)!=122);return A=0,A|0}function _u(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0;if(te=gt,gt=gt+16|0,Ht=te,ie=D(f|0,h|0,52)|0,_t()|0,ie=ie&15,A>>>0>15)return ie=4,gt=te,ie|0;if((ie|0)<(A|0))return ie=12,gt=te,ie|0;if((ie|0)!=(A|0))if(S=O(A|0,0,52)|0,S=S|f,R=_t()|0|h&-15728641,(ie|0)>(A|0)){F=A;do Yt=O(7,0,(14-F|0)*3|0)|0,F=F+1|0,S=Yt|S,R=_t()|0|R;while((F|0)<(ie|0));Yt=S}else Yt=S;else Yt=f,R=h;Mt=D(Yt|0,R|0,45)|0,_t()|0;t:do if(Tn(Mt&127)|0){if(F=D(Yt|0,R|0,52)|0,_t()|0,F=F&15,F|0)for(S=1;;){if(Mt=O(7,0,(15-S|0)*3|0)|0,!((Mt&Yt|0)==0&((_t()|0)&R|0)==0)){U=33;break t}if(S>>>0<F>>>0)S=S+1|0;else break}if(Mt=b,d[Mt>>2]=0,d[Mt+4>>2]=0,(ie|0)>(A|0)){for(Mt=h&-15728641,It=ie;;){if(Pt=It,It=It+-1|0,It>>>0>15|(ie|0)<(It|0)){U=19;break}if((ie|0)!=(It|0))if(S=O(It|0,0,52)|0,S=S|f,F=_t()|0|Mt,(ie|0)<(Pt|0))ht=S;else{U=It;do ht=O(7,0,(14-U|0)*3|0)|0,U=U+1|0,S=ht|S,F=_t()|0|F;while((U|0)<(ie|0));ht=S}else ht=f,F=h;if(W=D(ht|0,F|0,45)|0,_t()|0,!(Tn(W&127)|0))S=0;else{W=D(ht|0,F|0,52)|0,_t()|0,W=W&15;e:do if(!W)S=0;else for(U=1;;){if(S=D(ht|0,F|0,(15-U|0)*3|0)|0,_t()|0,S=S&7,S|0)break e;if(U>>>0<W>>>0)U=U+1|0;else{S=0;break}}while(!1);S=(S|0)==0&1}if(F=D(f|0,h|0,(15-Pt|0)*3|0)|0,_t()|0,F=F&7,(F|0)==7){E=5,U=42;break}if(S=(S|0)!=0,(F|0)==1&S){E=5,U=42;break}if(ht=F+(((F|0)!=0&S)<<31>>31)|0,ht|0&&(U=ie-Pt|0,U=Sr(7,0,U,((U|0)<0)<<31>>31)|0,W=_t()|0,S?(S=v(U|0,W|0,5,0)|0,S=Ei(S|0,_t()|0,-5,-1)|0,S=Mo(S|0,_t()|0,6,0)|0,S=Ei(S|0,_t()|0,1,0)|0,F=_t()|0):(S=U,F=W),Pt=ht+-1|0,Pt=v(U|0,W|0,Pt|0,((Pt|0)<0)<<31>>31|0)|0,Pt=Ei(S|0,F|0,Pt|0,_t()|0)|0,ht=_t()|0,W=b,W=Ei(Pt|0,ht|0,d[W>>2]|0,d[W+4>>2]|0)|0,ht=_t()|0,Pt=b,d[Pt>>2]=W,d[Pt+4>>2]=ht),(It|0)<=(A|0)){U=37;break}}if((U|0)==19)ti(27795,27122,1276,27158);else if((U|0)==37){P=b,E=d[P+4>>2]|0,P=d[P>>2]|0;break}else if((U|0)==42)return gt=te,E|0}else E=0,P=0}else U=33;while(!1);t:do if((U|0)==33)if(Mt=b,d[Mt>>2]=0,d[Mt+4>>2]=0,(ie|0)>(A|0)){for(S=ie;;){if(E=D(f|0,h|0,(15-S|0)*3|0)|0,_t()|0,E=E&7,(E|0)==7){E=5;break}if(P=ie-S|0,P=Sr(7,0,P,((P|0)<0)<<31>>31)|0,E=v(P|0,_t()|0,E|0,0)|0,P=_t()|0,Mt=b,P=Ei(d[Mt>>2]|0,d[Mt+4>>2]|0,E|0,P|0)|0,E=_t()|0,Mt=b,d[Mt>>2]=P,d[Mt+4>>2]=E,S=S+-1|0,(S|0)<=(A|0))break t}return gt=te,E|0}else E=0,P=0;while(!1);return Go(Yt,R,ie,Ht)|0&&ti(27795,27122,1236,27173),ie=Ht,Ht=d[ie+4>>2]|0,((E|0)>-1|(E|0)==-1&P>>>0>4294967295)&((Ht|0)>(E|0)|((Ht|0)==(E|0)?(d[ie>>2]|0)>>>0>P>>>0:0))?(ie=0,gt=te,ie|0):(ti(27795,27122,1316,27158),0)}function Ff(f,h,A,b,E,S){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0,S=S|0;var P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0;if(ht=gt,gt=gt+16|0,P=ht,E>>>0>15)return S=4,gt=ht,S|0;if(R=D(A|0,b|0,52)|0,_t()|0,R=R&15,(R|0)>(E|0))return S=12,gt=ht,S|0;if(Go(A,b,E,P)|0&&ti(27795,27122,1236,27173),W=P,U=d[W+4>>2]|0,!(((h|0)>-1|(h|0)==-1&f>>>0>4294967295)&((U|0)>(h|0)|((U|0)==(h|0)?(d[W>>2]|0)>>>0>f>>>0:0))))return S=2,gt=ht,S|0;W=E-R|0,E=O(E|0,0,52)|0,F=_t()|0|b&-15728641,U=S,d[U>>2]=E|A,d[U+4>>2]=F,U=D(A|0,b|0,45)|0,_t()|0;t:do if(Tn(U&127)|0){if(R|0)for(P=1;;){if(U=O(7,0,(15-P|0)*3|0)|0,!((U&A|0)==0&((_t()|0)&b|0)==0))break t;if(P>>>0<R>>>0)P=P+1|0;else break}if((W|0)<1)return S=0,gt=ht,S|0;for(U=R^15,b=-1,F=1,P=1;;){R=W-F|0,R=Sr(7,0,R,((R|0)<0)<<31>>31)|0,A=_t()|0;do if(P)if(P=v(R|0,A|0,5,0)|0,P=Ei(P|0,_t()|0,-5,-1)|0,P=Mo(P|0,_t()|0,6,0)|0,E=_t()|0,(h|0)>(E|0)|(h|0)==(E|0)&f>>>0>P>>>0){h=Ei(f|0,h|0,-1,-1)|0,h=Ur(h|0,_t()|0,P|0,E|0)|0,P=_t()|0,Pt=S,Mt=d[Pt>>2]|0,Pt=d[Pt+4>>2]|0,Yt=(U+b|0)*3|0,It=O(7,0,Yt|0)|0,Pt=Pt&~(_t()|0),b=Mo(h|0,P|0,R|0,A|0)|0,f=_t()|0,E=Ei(b|0,f|0,2,0)|0,Yt=O(E|0,_t()|0,Yt|0)|0,Pt=_t()|0|Pt,E=S,d[E>>2]=Yt|Mt&~It,d[E+4>>2]=Pt,f=v(b|0,f|0,R|0,A|0)|0,f=Ur(h|0,P|0,f|0,_t()|0)|0,P=0,h=_t()|0;break}else{Yt=S,It=d[Yt>>2]|0,Yt=d[Yt+4>>2]|0,Mt=O(7,0,(U+b|0)*3|0)|0,Yt=Yt&~(_t()|0),P=S,d[P>>2]=It&~Mt,d[P+4>>2]=Yt,P=1;break}else It=S,E=d[It>>2]|0,It=d[It+4>>2]|0,b=(U+b|0)*3|0,Pt=O(7,0,b|0)|0,It=It&~(_t()|0),Yt=Mo(f|0,h|0,R|0,A|0)|0,P=_t()|0,b=O(Yt|0,P|0,b|0)|0,It=_t()|0|It,Mt=S,d[Mt>>2]=b|E&~Pt,d[Mt+4>>2]=It,P=v(Yt|0,P|0,R|0,A|0)|0,f=Ur(f|0,h|0,P|0,_t()|0)|0,P=0,h=_t()|0;while(!1);if((W|0)>(F|0))b=~F,F=F+1|0;else{h=0;break}}return gt=ht,h|0}while(!1);if((W|0)<1)return Yt=0,gt=ht,Yt|0;for(E=R^15,P=1;;)if(Mt=W-P|0,Mt=Sr(7,0,Mt,((Mt|0)<0)<<31>>31)|0,Yt=_t()|0,F=S,A=d[F>>2]|0,F=d[F+4>>2]|0,R=(E-P|0)*3|0,b=O(7,0,R|0)|0,F=F&~(_t()|0),Pt=Mo(f|0,h|0,Mt|0,Yt|0)|0,It=_t()|0,R=O(Pt|0,It|0,R|0)|0,F=_t()|0|F,U=S,d[U>>2]=R|A&~b,d[U+4>>2]=F,Yt=v(Pt|0,It|0,Mt|0,Yt|0)|0,f=Ur(f|0,h|0,Yt|0,_t()|0)|0,h=_t()|0,(W|0)<=(P|0)){h=0;break}else P=P+1|0;return gt=ht,h|0}function ra(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0;E=D(h|0,A|0,52)|0,_t()|0,E=E&15,(h|0)==0&(A|0)==0|((b|0)>15|(E|0)>(b|0))?(S=-1,h=-1,A=0,E=0):(h=Ml(h,A,E+1|0,b)|0,P=(_t()|0)&-15728641,A=O(b|0,0,52)|0,A=h|A,P=P|(_t()|0),h=(Rn(A,P)|0)==0,S=E,h=h?-1:b,E=P),P=f,d[P>>2]=A,d[P+4>>2]=E,d[f+8>>2]=S,d[f+12>>2]=h}function Wn(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0;if(E=D(f|0,h|0,52)|0,_t()|0,E=E&15,S=b+8|0,d[S>>2]=E,(f|0)==0&(h|0)==0|((A|0)>15|(E|0)>(A|0))){A=b,d[A>>2]=0,d[A+4>>2]=0,d[S>>2]=-1,d[b+12>>2]=-1;return}if(f=Ml(f,h,E+1|0,A)|0,S=(_t()|0)&-15728641,E=O(A|0,0,52)|0,E=f|E,S=S|(_t()|0),f=b,d[f>>2]=E,d[f+4>>2]=S,f=b+12|0,Rn(E,S)|0){d[f>>2]=A;return}else{d[f>>2]=-1;return}}function Dl(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0;if(A=f,h=d[A>>2]|0,A=d[A+4>>2]|0,!((h|0)==0&(A|0)==0)&&(b=D(h|0,A|0,52)|0,_t()|0,b=b&15,R=O(1,0,(b^15)*3|0)|0,h=Ei(R|0,_t()|0,h|0,A|0)|0,A=_t()|0,R=f,d[R>>2]=h,d[R+4>>2]=A,R=f+8|0,P=d[R>>2]|0,!((b|0)<(P|0)))){for(F=f+12|0,S=b;;){if((S|0)==(P|0)){b=5;break}if(U=(S|0)==(d[F>>2]|0),E=(15-S|0)*3|0,b=D(h|0,A|0,E|0)|0,_t()|0,b=b&7,U&((b|0)==1&!0)){b=7;break}if(!((b|0)==7&!0)){b=10;break}if(U=O(1,0,E|0)|0,h=Ei(h|0,A|0,U|0,_t()|0)|0,A=_t()|0,U=f,d[U>>2]=h,d[U+4>>2]=A,(S|0)>(P|0))S=S+-1|0;else{b=10;break}}if((b|0)==5){U=f,d[U>>2]=0,d[U+4>>2]=0,d[R>>2]=-1,d[F>>2]=-1;return}else if((b|0)==7){P=O(1,0,E|0)|0,P=Ei(h|0,A|0,P|0,_t()|0)|0,R=_t()|0,U=f,d[U>>2]=P,d[U+4>>2]=R,d[F>>2]=S+-1;return}else if((b|0)==10)return}}function bo(f){f=+f;var h=0;return h=f<0?f+6.283185307179586:f,+(f>=6.283185307179586?h+-6.283185307179586:h)}function Zs(f,h){return f=f|0,h=h|0,+ke(+(+tt[f>>3]-+tt[h>>3]))<17453292519943298e-27?(h=+ke(+(+tt[f+8>>3]-+tt[h+8>>3]))<17453292519943298e-27,h|0):(h=0,h|0)}function qi(f,h){switch(f=+f,h=h|0,h|0){case 1:{f=f<0?f+6.283185307179586:f;break}case 2:{f=f>0?f+-6.283185307179586:f;break}}return+f}function Un(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0;return E=+tt[h>>3],b=+tt[f>>3],S=+De(+((E-b)*.5)),A=+De(+((+tt[h+8>>3]-+tt[f+8>>3])*.5)),A=S*S+A*(+Ve(+E)*+Ve(+b)*A),+(+hn(+ +Ue(+A),+ +Ue(+(1-A)))*2)}function ns(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0;return E=+tt[h>>3],b=+tt[f>>3],S=+De(+((E-b)*.5)),A=+De(+((+tt[h+8>>3]-+tt[f+8>>3])*.5)),A=S*S+A*(+Ve(+E)*+Ve(+b)*A),+(+hn(+ +Ue(+A),+ +Ue(+(1-A)))*2*6371.007180918475)}function bu(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0;return E=+tt[h>>3],b=+tt[f>>3],S=+De(+((E-b)*.5)),A=+De(+((+tt[h+8>>3]-+tt[f+8>>3])*.5)),A=S*S+A*(+Ve(+E)*+Ve(+b)*A),+(+hn(+ +Ue(+A),+ +Ue(+(1-A)))*2*6371.007180918475*1e3)}function kl(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0;return S=+tt[h>>3],b=+Ve(+S),E=+tt[h+8>>3]-+tt[f+8>>3],P=b*+De(+E),A=+tt[f>>3],+ +hn(+P,+(+De(+S)*+Ve(+A)-+Ve(+E)*(b*+De(+A))))}function xu(f,h,A,b){f=f|0,h=+h,A=+A,b=b|0;var E=0,S=0,P=0,R=0;if(A<1e-16){d[b>>2]=d[f>>2],d[b+4>>2]=d[f+4>>2],d[b+8>>2]=d[f+8>>2],d[b+12>>2]=d[f+12>>2];return}S=h<0?h+6.283185307179586:h,S=h>=6.283185307179586?S+-6.283185307179586:S;do if(S<1e-16)h=+tt[f>>3]+A,tt[b>>3]=h,E=b;else{if(E=+ke(+(S+-3.141592653589793))<1e-16,h=+tt[f>>3],E){h=h-A,tt[b>>3]=h,E=b;break}if(P=+Ve(+A),A=+De(+A),h=P*+De(+h)+ +Ve(+S)*(A*+Ve(+h)),h=h>1?1:h,h=+si(+(h<-1?-1:h)),tt[b>>3]=h,+ke(+(h+-1.5707963267948966))<1e-16){tt[b>>3]=1.5707963267948966,tt[b+8>>3]=0;return}if(+ke(+(h+1.5707963267948966))<1e-16){tt[b>>3]=-1.5707963267948966,tt[b+8>>3]=0;return}if(R=1/+Ve(+h),S=A*+De(+S)*R,A=+tt[f>>3],h=R*((P-+De(+h)*+De(+A))/+Ve(+A)),P=S>1?1:S,h=h>1?1:h,h=+tt[f+8>>3]+ +hn(+(P<-1?-1:P),+(h<-1?-1:h)),h>3.141592653589793)do h=h+-6.283185307179586;while(h>3.141592653589793);if(h<-3.141592653589793)do h=h+6.283185307179586;while(h<-3.141592653589793);tt[b+8>>3]=h;return}while(!1);if(+ke(+(h+-1.5707963267948966))<1e-16){tt[E>>3]=1.5707963267948966,tt[b+8>>3]=0;return}if(+ke(+(h+1.5707963267948966))<1e-16){tt[E>>3]=-1.5707963267948966,tt[b+8>>3]=0;return}if(h=+tt[f+8>>3],h>3.141592653589793)do h=h+-6.283185307179586;while(h>3.141592653589793);if(h<-3.141592653589793)do h=h+6.283185307179586;while(h<-3.141592653589793);tt[b+8>>3]=h}function Nf(f,h){return f=f|0,h=h|0,f>>>0>15?(h=4,h|0):(tt[h>>3]=+tt[20656+(f<<3)>>3],h=0,h|0)}function Wp(f,h){return f=f|0,h=h|0,f>>>0>15?(h=4,h|0):(tt[h>>3]=+tt[20784+(f<<3)>>3],h=0,h|0)}function wu(f,h){return f=f|0,h=h|0,f>>>0>15?(h=4,h|0):(tt[h>>3]=+tt[20912+(f<<3)>>3],h=0,h|0)}function Eu(f,h){return f=f|0,h=h|0,f>>>0>15?(h=4,h|0):(tt[h>>3]=+tt[21040+(f<<3)>>3],h=0,h|0)}function ao(f,h){f=f|0,h=h|0;var A=0;return f>>>0>15?(h=4,h|0):(A=Sr(7,0,f,((f|0)<0)<<31>>31)|0,A=v(A|0,_t()|0,120,0)|0,f=_t()|0,d[h>>2]=A|2,d[h+4>>2]=f,h=0,h|0)}function xr(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0;return Pt=+tt[h>>3],W=+tt[f>>3],F=+De(+((Pt-W)*.5)),S=+tt[h+8>>3],U=+tt[f+8>>3],P=+De(+((S-U)*.5)),R=+Ve(+W),ht=+Ve(+Pt),P=F*F+P*(ht*R*P),P=+hn(+ +Ue(+P),+ +Ue(+(1-P)))*2,F=+tt[A>>3],Pt=+De(+((F-Pt)*.5)),b=+tt[A+8>>3],S=+De(+((b-S)*.5)),E=+Ve(+F),S=Pt*Pt+S*(ht*E*S),S=+hn(+ +Ue(+S),+ +Ue(+(1-S)))*2,F=+De(+((W-F)*.5)),b=+De(+((U-b)*.5)),b=F*F+b*(R*E*b),b=+hn(+ +Ue(+b),+ +Ue(+(1-b)))*2,E=(P+S+b)*.5,+(+rn(+ +Ue(+(+Ze(+(E*.5))*+Ze(+((E-P)*.5))*+Ze(+((E-S)*.5))*+Ze(+((E-b)*.5)))))*4)}function Ya(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0;if(R=gt,gt=gt+192|0,S=R+168|0,P=R,E=wa(f,h,S)|0,E|0)return A=E,gt=R,A|0;if(Za(f,h,P)|0&&ti(27795,27190,415,27199),h=d[P>>2]|0,(h|0)>0){if(b=+xr(P+8|0,P+8+(((h|0)!=1&1)<<4)|0,S)+0,(h|0)!=1){f=1;do E=f,f=f+1|0,b=b+ +xr(P+8+(E<<4)|0,P+8+(((f|0)%(h|0)|0)<<4)|0,S);while((f|0)<(h|0))}}else b=0;return tt[A>>3]=b,A=0,gt=R,A|0}function zf(f,h,A){return f=f|0,h=h|0,A=A|0,f=Ya(f,h,A)|0,f|0||(tt[A>>3]=+tt[A>>3]*6371.007180918475*6371.007180918475),f|0}function wr(f,h,A){return f=f|0,h=h|0,A=A|0,f=Ya(f,h,A)|0,f|0||(tt[A>>3]=+tt[A>>3]*6371.007180918475*6371.007180918475*1e3*1e3),f|0}function ci(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;if(R=gt,gt=gt+176|0,P=R,f=gu(f,h,P)|0,f|0)return P=f,gt=R,P|0;if(tt[A>>3]=0,f=d[P>>2]|0,(f|0)<=1)return P=0,gt=R,P|0;h=f+-1|0,f=0,b=+tt[P+8>>3],E=+tt[P+16>>3],S=0;do f=f+1|0,U=b,b=+tt[P+8+(f<<4)>>3],W=+De(+((b-U)*.5)),F=E,E=+tt[P+8+(f<<4)+8>>3],F=+De(+((E-F)*.5)),F=W*W+F*(+Ve(+b)*+Ve(+U)*F),S=S+ +hn(+ +Ue(+F),+ +Ue(+(1-F)))*2;while((f|0)<(h|0));return tt[A>>3]=S,P=0,gt=R,P|0}function Ds(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;if(R=gt,gt=gt+176|0,P=R,f=gu(f,h,P)|0,f|0)return P=f,S=+tt[A>>3],S=S*6371.007180918475,tt[A>>3]=S,gt=R,P|0;if(tt[A>>3]=0,f=d[P>>2]|0,(f|0)<=1)return P=0,S=0,S=S*6371.007180918475,tt[A>>3]=S,gt=R,P|0;h=f+-1|0,f=0,b=+tt[P+8>>3],E=+tt[P+16>>3],S=0;do f=f+1|0,U=b,b=+tt[P+8+(f<<4)>>3],W=+De(+((b-U)*.5)),F=E,E=+tt[P+8+(f<<4)+8>>3],F=+De(+((E-F)*.5)),F=W*W+F*(+Ve(+U)*+Ve(+b)*F),S=S+ +hn(+ +Ue(+F),+ +Ue(+(1-F)))*2;while((f|0)!=(h|0));return tt[A>>3]=S,P=0,W=S,W=W*6371.007180918475,tt[A>>3]=W,gt=R,P|0}function _c(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;if(R=gt,gt=gt+176|0,P=R,f=gu(f,h,P)|0,f|0)return P=f,S=+tt[A>>3],S=S*6371.007180918475,S=S*1e3,tt[A>>3]=S,gt=R,P|0;if(tt[A>>3]=0,f=d[P>>2]|0,(f|0)<=1)return P=0,S=0,S=S*6371.007180918475,S=S*1e3,tt[A>>3]=S,gt=R,P|0;h=f+-1|0,f=0,b=+tt[P+8>>3],E=+tt[P+16>>3],S=0;do f=f+1|0,U=b,b=+tt[P+8+(f<<4)>>3],W=+De(+((b-U)*.5)),F=E,E=+tt[P+8+(f<<4)+8>>3],F=+De(+((E-F)*.5)),F=W*W+F*(+Ve(+U)*+Ve(+b)*F),S=S+ +hn(+ +Ue(+F),+ +Ue(+(1-F)))*2;while((f|0)!=(h|0));return tt[A>>3]=S,P=0,W=S,W=W*6371.007180918475,W=W*1e3,tt[A>>3]=W,gt=R,P|0}function Ol(f){f=f|0;var h=0,A=0,b=0;return h=Pr(1,12)|0,h||ti(27280,27235,49,27293),A=f+4|0,b=d[A>>2]|0,b|0?(b=b+8|0,d[b>>2]=h,d[A>>2]=h,h|0):(d[f>>2]|0&&ti(27310,27235,61,27333),b=f,d[b>>2]=h,d[A>>2]=h,h|0)}function xo(f,h){f=f|0,h=h|0;var A=0,b=0;return b=ss(24)|0,b||ti(27347,27235,78,27361),d[b>>2]=d[h>>2],d[b+4>>2]=d[h+4>>2],d[b+8>>2]=d[h+8>>2],d[b+12>>2]=d[h+12>>2],d[b+16>>2]=0,h=f+4|0,A=d[h>>2]|0,A|0?(d[A+16>>2]=b,d[h>>2]=b,b|0):(d[f>>2]|0&&ti(27376,27235,82,27361),d[f>>2]=b,d[h>>2]=b,b|0)}function bs(f){f=f|0;var h=0,A=0,b=0,E=0;if(f)for(b=1;;){if(h=d[f>>2]|0,h|0)do{if(A=d[h>>2]|0,A|0)do E=A,A=d[A+16>>2]|0,Fi(E);while((A|0)!=0);E=h,h=d[h+8>>2]|0,Fi(E)}while((h|0)!=0);if(h=f,f=d[f+8>>2]|0,b||Fi(h),f)b=0;else break}}function gh(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0,Ge=0,ze=0,Ri=0,Ci=0,ji=0,Ti=0,ai=0,We=0,Wi=0,fn=0,Zi=0;if(E=f+8|0,d[E>>2]|0)return Zi=1,Zi|0;if(b=d[f>>2]|0,!b)return Zi=0,Zi|0;h=b,A=0;do A=A+1|0,h=d[h+8>>2]|0;while((h|0)!=0);if(A>>>0<2)return Zi=0,Zi|0;Wi=ss(A<<2)|0,Wi||ti(27396,27235,317,27415),We=ss(A<<5)|0,We||ti(27437,27235,321,27415),d[f>>2]=0,Ge=f+4|0,d[Ge>>2]=0,d[E>>2]=0,A=0,ai=0,Be=0,ht=0;t:for(;;){if(W=d[b>>2]|0,W){S=0,P=W;do{if(F=+tt[P+8>>3],h=P,P=d[P+16>>2]|0,U=(P|0)==0,E=U?W:P,R=+tt[E+8>>3],+ke(+(F-R))>3.141592653589793){Zi=14;break}S=S+(R-F)*(+tt[h>>3]+ +tt[E>>3])}while(!U);if((Zi|0)==14){Zi=0,S=0,h=W;do qt=+tt[h+8>>3],Ti=h+16|0,ji=d[Ti>>2]|0,ji=(ji|0)==0?W:ji,Jt=+tt[ji+8>>3],S=S+(+tt[h>>3]+ +tt[ji>>3])*((Jt<0?Jt+6.283185307179586:Jt)-(qt<0?qt+6.283185307179586:qt)),h=d[((h|0)==0?b:Ti)>>2]|0;while((h|0)!=0)}S>0?(d[Wi+(ai<<2)>>2]=b,ai=ai+1|0,E=Be,h=ht):Zi=19}else Zi=19;if((Zi|0)==19){Zi=0;do if(A){if(h=A+8|0,d[h>>2]|0){Zi=21;break t}if(A=Pr(1,12)|0,!A){Zi=23;break t}d[h>>2]=A,E=A+4|0,P=A,h=ht}else if(ht){E=Ge,P=ht+8|0,h=b,A=f;break}else if(d[f>>2]|0){Zi=27;break t}else{E=Ge,P=f,h=b,A=f;break}while(!1);if(d[P>>2]=b,d[E>>2]=b,P=We+(Be<<5)|0,U=d[b>>2]|0,U){for(W=We+(Be<<5)+8|0,tt[W>>3]=17976931348623157e292,ht=We+(Be<<5)+24|0,tt[ht>>3]=17976931348623157e292,tt[P>>3]=-17976931348623157e292,Pt=We+(Be<<5)+16|0,tt[Pt>>3]=-17976931348623157e292,ie=17976931348623157e292,te=-17976931348623157e292,E=0,It=U,F=17976931348623157e292,Yt=17976931348623157e292,Ht=-17976931348623157e292,R=-17976931348623157e292;S=+tt[It>>3],qt=+tt[It+8>>3],It=d[It+16>>2]|0,Mt=(It|0)==0,Jt=+tt[(Mt?U:It)+8>>3],S<F&&(tt[W>>3]=S,F=S),qt<Yt&&(tt[ht>>3]=qt,Yt=qt),S>Ht?tt[P>>3]=S:S=Ht,qt>R&&(tt[Pt>>3]=qt,R=qt),ie=qt>0&qt<ie?qt:ie,te=qt<0&qt>te?qt:te,E=E|+ke(+(qt-Jt))>3.141592653589793,!Mt;)Ht=S;E&&(tt[Pt>>3]=te,tt[ht>>3]=ie)}else d[P>>2]=0,d[P+4>>2]=0,d[P+8>>2]=0,d[P+12>>2]=0,d[P+16>>2]=0,d[P+20>>2]=0,d[P+24>>2]=0,d[P+28>>2]=0;E=Be+1|0}if(Ti=b+8|0,b=d[Ti>>2]|0,d[Ti>>2]=0,b)Be=E,ht=h;else{Zi=45;break}}if((Zi|0)==21)ti(27213,27235,35,27247);else if((Zi|0)==23)ti(27267,27235,37,27247);else if((Zi|0)==27)ti(27310,27235,61,27333);else if((Zi|0)==45){t:do if((ai|0)>0){for(Ti=(E|0)==0,Ci=E<<2,ji=(f|0)==0,Ri=0,h=0;;){if(ze=d[Wi+(Ri<<2)>>2]|0,Ti)Zi=73;else{if(Be=ss(Ci)|0,!Be){Zi=50;break}if(Ge=ss(Ci)|0,!Ge){Zi=52;break}e:do if(ji)A=0;else{for(E=0,A=0,P=f;b=We+(E<<5)|0,ni(d[P>>2]|0,b,d[ze>>2]|0)|0?(d[Be+(A<<2)>>2]=P,d[Ge+(A<<2)>>2]=b,Mt=A+1|0):Mt=A,P=d[P+8>>2]|0,P;)E=E+1|0,A=Mt;if((Mt|0)>0)if(b=d[Be>>2]|0,(Mt|0)==1)A=b;else for(Pt=0,It=-1,A=b,ht=b;;){for(U=d[ht>>2]|0,b=0,P=0;E=d[d[Be+(P<<2)>>2]>>2]|0,(E|0)==(U|0)?W=b:W=b+((ni(E,d[Ge+(P<<2)>>2]|0,d[U>>2]|0)|0)&1)|0,P=P+1|0,(P|0)!=(Mt|0);)b=W;if(E=(W|0)>(It|0),A=E?ht:A,b=Pt+1|0,(b|0)==(Mt|0))break e;Pt=b,It=E?W:It,ht=d[Be+(b<<2)>>2]|0}else A=0}while(!1);if(Fi(Be),Fi(Ge),A){if(E=A+4|0,b=d[E>>2]|0,b)A=b+8|0;else if(d[A>>2]|0){Zi=70;break}d[A>>2]=ze,d[E>>2]=ze}else Zi=73}if((Zi|0)==73){if(Zi=0,h=d[ze>>2]|0,h|0)do Ge=h,h=d[h+16>>2]|0,Fi(Ge);while((h|0)!=0);Fi(ze),h=1}if(Ri=Ri+1|0,(Ri|0)>=(ai|0)){fn=h;break t}}(Zi|0)==50?ti(27452,27235,249,27471):(Zi|0)==52?ti(27490,27235,252,27471):(Zi|0)==70&&ti(27310,27235,61,27333)}else fn=0;while(!1);return Fi(Wi),Fi(We),Zi=fn,Zi|0}return 0}function ni(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0;if(!(No(h,A)|0)||(h=$o(h)|0,b=+tt[A>>3],E=+tt[A+8>>3],E=h&E<0?E+6.283185307179586:E,f=d[f>>2]|0,!f))return f=0,f|0;if(h){h=0,U=E,A=f;t:for(;;){for(;P=+tt[A>>3],E=+tt[A+8>>3],A=A+16|0,W=d[A>>2]|0,W=(W|0)==0?f:W,S=+tt[W>>3],R=+tt[W+8>>3],P>S?(F=P,P=R):(F=S,S=P,P=E,E=R),b=b==S|b==F?b+2220446049250313e-31:b,!!(b<S|b>F);)if(A=d[A>>2]|0,!A){A=22;break t}if(R=P<0?P+6.283185307179586:P,P=E<0?E+6.283185307179586:E,U=R==U|P==U?U+-2220446049250313e-31:U,F=R+(P-R)*((b-S)/(F-S)),(F<0?F+6.283185307179586:F)>U&&(h=h^1),A=d[A>>2]|0,!A){A=22;break}}if((A|0)==22)return h|0}else{h=0,U=E,A=f;t:for(;;){for(;P=+tt[A>>3],E=+tt[A+8>>3],A=A+16|0,W=d[A>>2]|0,W=(W|0)==0?f:W,S=+tt[W>>3],R=+tt[W+8>>3],P>S?(F=P,P=R):(F=S,S=P,P=E,E=R),b=b==S|b==F?b+2220446049250313e-31:b,!!(b<S|b>F);)if(A=d[A>>2]|0,!A){A=22;break t}if(U=P==U|E==U?U+-2220446049250313e-31:U,P+(E-P)*((b-S)/(F-S))>U&&(h=h^1),A=d[A>>2]|0,!A){A=22;break}}if((A|0)==22)return h|0}return 0}function wo(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0;if(te=gt,gt=gt+32|0,ie=te+16|0,Ht=te,S=D(f|0,h|0,52)|0,_t()|0,S=S&15,It=D(A|0,b|0,52)|0,_t()|0,(S|0)!=(It&15|0))return ie=12,gt=te,ie|0;if(U=D(f|0,h|0,45)|0,_t()|0,U=U&127,W=D(A|0,b|0,45)|0,_t()|0,W=W&127,U>>>0>121|W>>>0>121)return ie=5,gt=te,ie|0;if(It=(U|0)!=(W|0),It){if(R=lc(U,W)|0,(R|0)==7)return ie=1,gt=te,ie|0;F=lc(W,U)|0,(F|0)==7?ti(27514,27538,161,27548):(Mt=R,P=F)}else Mt=0,P=0;ht=Tn(U)|0,Pt=Tn(W)|0,d[ie>>2]=0,d[ie+4>>2]=0,d[ie+8>>2]=0,d[ie+12>>2]=0;do if(Mt){if(W=d[4272+(U*28|0)+(Mt<<2)>>2]|0,R=(W|0)>0,Pt)if(R){U=0,F=A,R=b;do F=yu(F,R)|0,R=_t()|0,P=Ls(P)|0,(P|0)==1&&(P=Ls(1)|0),U=U+1|0;while((U|0)!=(W|0));W=P,U=F,F=R}else W=P,U=A,F=b;else if(R){U=0,F=A,R=b;do F=Rl(F,R)|0,R=_t()|0,P=Ls(P)|0,U=U+1|0;while((U|0)!=(W|0));W=P,U=F,F=R}else W=P,U=A,F=b;if(Ll(U,F,ie)|0,It||ti(27563,27538,191,27548),R=(ht|0)!=0,P=(Pt|0)!=0,R&P&&ti(27590,27538,192,27548),R){if(P=vs(f,h)|0,(P|0)==7){S=5;break}if(pt[22e3+(P*7|0)+Mt>>0]|0){S=1;break}F=d[21168+(P*28|0)+(Mt<<2)>>2]|0,U=F}else if(P){if(P=vs(U,F)|0,(P|0)==7){S=5;break}if(pt[22e3+(P*7|0)+W>>0]|0){S=1;break}U=0,F=d[21168+(W*28|0)+(P<<2)>>2]|0}else U=0,F=0;if((U|F|0)<0)S=5;else{if((F|0)>0){R=ie+4|0,P=0;do Uo(R),P=P+1|0;while((P|0)!=(F|0))}if(d[Ht>>2]=0,d[Ht+4>>2]=0,d[Ht+8>>2]=0,ea(Ht,Mt),S|0)for(;_s(S)|0?Cl(Ht):Bs(Ht),(S|0)>1;)S=S+-1|0;if((U|0)>0){S=0;do Uo(Ht),S=S+1|0;while((S|0)!=(U|0))}Yt=ie+4|0,is(Yt,Ht,Yt),qr(Yt),Yt=51}}else if(Ll(A,b,ie)|0,(ht|0)!=0&(Pt|0)!=0)if((W|0)!=(U|0)&&ti(27621,27538,261,27548),P=vs(f,h)|0,S=vs(A,b)|0,(P|0)==7|(S|0)==7)S=5;else if(pt[22e3+(P*7|0)+S>>0]|0)S=1;else if(P=d[21168+(P*28|0)+(S<<2)>>2]|0,(P|0)>0){R=ie+4|0,S=0;do Uo(R),S=S+1|0;while((S|0)!=(P|0));Yt=51}else Yt=51;else Yt=51;while(!1);return(Yt|0)==51&&(S=ie+4|0,d[E>>2]=d[S>>2],d[E+4>>2]=d[S+4>>2],d[E+8>>2]=d[S+8>>2],S=0),ie=S,gt=te,ie|0}function Cu(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0;if(Yt=gt,gt=gt+48|0,U=Yt+36|0,P=Yt+24|0,R=Yt+12|0,F=Yt,E=D(f|0,h|0,52)|0,_t()|0,E=E&15,Pt=D(f|0,h|0,45)|0,_t()|0,Pt=Pt&127,Pt>>>0>121)return b=5,gt=Yt,b|0;if(W=Tn(Pt)|0,O(E|0,0,52)|0,Ht=_t()|0|134225919,S=b,d[S>>2]=-1,d[S+4>>2]=Ht,!E)return E=fc(A)|0,(E|0)==7||(E=Va(Pt,E)|0,(E|0)==127)?(Ht=1,gt=Yt,Ht|0):(It=O(E|0,0,45)|0,Mt=_t()|0,Pt=b,Mt=d[Pt+4>>2]&-1040385|Mt,Ht=b,d[Ht>>2]=d[Pt>>2]|It,d[Ht+4>>2]=Mt,Ht=0,gt=Yt,Ht|0);for(d[U>>2]=d[A>>2],d[U+4>>2]=d[A+4>>2],d[U+8>>2]=d[A+8>>2],A=E;;){if(S=A,A=A+-1|0,d[P>>2]=d[U>>2],d[P+4>>2]=d[U+4>>2],d[P+8>>2]=d[U+8>>2],_s(S)|0){if(E=Au(U)|0,E|0){A=13;break}d[R>>2]=d[U>>2],d[R+4>>2]=d[U+4>>2],d[R+8>>2]=d[U+8>>2],Cl(R)}else{if(E=mu(U)|0,E|0){A=13;break}d[R>>2]=d[U>>2],d[R+4>>2]=d[U+4>>2],d[R+8>>2]=d[U+8>>2],Bs(R)}if(hc(P,R,F),qr(F),E=b,te=d[E>>2]|0,E=d[E+4>>2]|0,Jt=(15-S|0)*3|0,ie=O(7,0,Jt|0)|0,E=E&~(_t()|0),Jt=O(fc(F)|0,0,Jt|0)|0,E=_t()|0|E,Ht=b,d[Ht>>2]=Jt|te&~ie,d[Ht+4>>2]=E,(S|0)<=1){A=14;break}}t:do if((A|0)!=13&&(A|0)==14)if((d[U>>2]|0)<=1&&(d[U+4>>2]|0)<=1&&(d[U+8>>2]|0)<=1){A=fc(U)|0,E=Va(Pt,A)|0,(E|0)==127?F=0:F=Tn(E)|0;e:do if(A){if(W){if(E=vs(f,h)|0,(E|0)==7){E=5;break t}if(S=d[21376+(E*28|0)+(A<<2)>>2]|0,(S|0)>0){E=A,A=0;do E=Rs(E)|0,A=A+1|0;while((A|0)!=(S|0))}else E=A;if((E|0)==1){E=9;break t}A=Va(Pt,E)|0,(A|0)==127&&ti(27648,27538,411,27678),Tn(A)|0?ti(27693,27538,412,27678):(Mt=A,It=S,ht=E)}else Mt=E,It=0,ht=A;if(R=d[4272+(Pt*28|0)+(ht<<2)>>2]|0,(R|0)<=-1&&ti(27724,27538,419,27678),!F){if((It|0)<0){E=5;break t}if(It|0){S=b,E=0,A=d[S>>2]|0,S=d[S+4>>2]|0;do A=Ks(A,S)|0,S=_t()|0,Jt=b,d[Jt>>2]=A,d[Jt+4>>2]=S,E=E+1|0;while((E|0)<(It|0))}if((R|0)<=0){E=Mt,A=58;break}for(S=b,E=0,A=d[S>>2]|0,S=d[S+4>>2]|0;;)if(A=Ks(A,S)|0,S=_t()|0,Jt=b,d[Jt>>2]=A,d[Jt+4>>2]=S,E=E+1|0,(E|0)==(R|0)){E=Mt,A=58;break e}}if(P=lc(Mt,Pt)|0,(P|0)==7&&ti(27514,27538,428,27678),E=b,A=d[E>>2]|0,E=d[E+4>>2]|0,(R|0)>0){S=0;do A=Ks(A,E)|0,E=_t()|0,Jt=b,d[Jt>>2]=A,d[Jt+4>>2]=E,S=S+1|0;while((S|0)!=(R|0))}if(E=vs(A,E)|0,(E|0)==7&&ti(27795,27538,440,27678),A=Xr(Mt)|0,A=d[(A?21792:21584)+(P*28|0)+(E<<2)>>2]|0,(A|0)<0&&ti(27795,27538,454,27678),!A)E=Mt,A=58;else{P=b,E=0,S=d[P>>2]|0,P=d[P+4>>2]|0;do S=gc(S,P)|0,P=_t()|0,Jt=b,d[Jt>>2]=S,d[Jt+4>>2]=P,E=E+1|0;while((E|0)<(A|0));E=Mt,A=58}}else if((W|0)!=0&(F|0)!=0){if(A=vs(f,h)|0,S=b,S=vs(d[S>>2]|0,d[S+4>>2]|0)|0,(A|0)==7|(S|0)==7){E=5;break t}if(S=d[21376+(A*28|0)+(S<<2)>>2]|0,(S|0)<0){E=5;break t}if(!S)A=59;else{R=b,A=0,P=d[R>>2]|0,R=d[R+4>>2]|0;do P=Ks(P,R)|0,R=_t()|0,Jt=b,d[Jt>>2]=P,d[Jt+4>>2]=R,A=A+1|0;while((A|0)<(S|0));A=58}}else A=58;while(!1);if((A|0)==58&&F&&(A=59),(A|0)==59&&(Jt=b,(vs(d[Jt>>2]|0,d[Jt+4>>2]|0)|0)==1)){E=9;break}Jt=b,ie=d[Jt>>2]|0,Jt=d[Jt+4>>2]&-1040385,te=O(E|0,0,45)|0,Jt=Jt|(_t()|0),E=b,d[E>>2]=ie|te,d[E+4>>2]=Jt,E=0}else E=1;while(!1);return Jt=E,gt=Yt,Jt|0}function yh(f,h,A,b,E,S){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0,S=S|0;var P=0,R=0;return R=gt,gt=gt+16|0,P=R,E?f=15:(f=wo(f,h,A,b,P)|0,f||(Sf(P,S),f=0)),gt=R,f|0}function lo(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0;return P=gt,gt=gt+16|0,S=P,b?A=15:(A=Dn(A,S)|0,A||(A=Cu(f,h,S,E)|0)),gt=P,A|0}function ks(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0;return F=gt,gt=gt+32|0,P=F+12|0,R=F,S=wo(f,h,f,h,P)|0,S|0?(R=S,gt=F,R|0):(f=wo(f,h,A,b,R)|0,f|0?(R=f,gt=F,R|0):(P=dc(P,R)|0,R=E,d[R>>2]=P,d[R+4>>2]=((P|0)<0)<<31>>31,R=0,gt=F,R|0))}function bc(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0;return F=gt,gt=gt+32|0,P=F+12|0,R=F,S=wo(f,h,f,h,P)|0,!S&&(S=wo(f,h,A,b,R)|0,!S)?(b=dc(P,R)|0,b=Ei(b|0,((b|0)<0)<<31>>31|0,1,0)|0,P=_t()|0,R=E,d[R>>2]=b,d[R+4>>2]=P,R=0,gt=F,R|0):(R=S,gt=F,R|0)}function xc(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0,Ge=0,ze=0,Ri=0;if(ze=gt,gt=gt+48|0,Be=ze+24|0,P=ze+12|0,Ge=ze,S=wo(f,h,f,h,Be)|0,!S&&(S=wo(f,h,A,b,P)|0,!S)){Jt=dc(Be,P)|0,qt=((Jt|0)<0)<<31>>31,d[Be>>2]=0,d[Be+4>>2]=0,d[Be+8>>2]=0,d[P>>2]=0,d[P+4>>2]=0,d[P+8>>2]=0,wo(f,h,f,h,Be)|0&&ti(27795,27538,692,27747),wo(f,h,A,b,P)|0&&ti(27795,27538,697,27747),Pf(Be),Pf(P),W=(Jt|0)==0?0:1/+(Jt|0),A=d[Be>>2]|0,Yt=W*+((d[P>>2]|0)-A|0),Ht=Be+4|0,b=d[Ht>>2]|0,ie=W*+((d[P+4>>2]|0)-b|0),te=Be+8|0,S=d[te>>2]|0,W=W*+((d[P+8>>2]|0)-S|0),d[Ge>>2]=A,ht=Ge+4|0,d[ht>>2]=b,Pt=Ge+8|0,d[Pt>>2]=S;t:do if((Jt|0)<0)S=0;else for(It=0,Mt=0;;){F=+(Mt>>>0)+4294967296*+(It|0),Ri=Yt*F+ +(A|0),R=ie*F+ +(b|0),F=W*F+ +(S|0),A=~~+Et(+Ri),P=~~+Et(+R),S=~~+Et(+F),Ri=+ke(+(+(A|0)-Ri)),R=+ke(+(+(P|0)-R)),F=+ke(+(+(S|0)-F));do if(Ri>R&Ri>F)A=0-(P+S)|0,b=P;else if(U=0-A|0,R>F){b=U-S|0;break}else{b=P,S=U-P|0;break}while(!1);if(d[Ge>>2]=A,d[ht>>2]=b,d[Pt>>2]=S,pc(Ge),S=Cu(f,h,Ge,E+(Mt<<3)|0)|0,S|0)break t;if(!((It|0)<(qt|0)|(It|0)==(qt|0)&Mt>>>0<Jt>>>0)){S=0;break t}A=Ei(Mt|0,It|0,1,0)|0,b=_t()|0,It=b,Mt=A,A=d[Be>>2]|0,b=d[Ht>>2]|0,S=d[te>>2]|0}while(!1);return Ge=S,gt=ze,Ge|0}return Ge=S,gt=ze,Ge|0}function Sr(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0;if((A|0)==0&(b|0)==0)return E=0,S=1,mi(E|0),S|0;S=f,E=h,f=1,h=0;do P=(A&1|0)==0&!0,f=v((P?1:S)|0,(P?0:E)|0,f|0,h|0)|0,h=_t()|0,A=B(A|0,b|0,1)|0,b=_t()|0,S=v(S|0,E|0,S|0,E|0)|0,E=_t()|0;while(!((A|0)==0&(b|0)==0));return mi(h|0),f|0}function Eo(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0;R=gt,gt=gt+16|0,S=R,P=D(f|0,h|0,52)|0,_t()|0,P=P&15;do if(P){if(E=wa(f,h,S)|0,!E){U=+tt[S>>3],F=1/+Ve(+U),W=+tt[25968+(P<<3)>>3],tt[A>>3]=U+W,tt[A+8>>3]=U-W,U=+tt[S+8>>3],F=W*F,tt[A+16>>3]=F+U,tt[A+24>>3]=U-F;break}return P=E,gt=R,P|0}else{if(E=D(f|0,h|0,45)|0,_t()|0,E=E&127,E>>>0>121)return P=5,gt=R,P|0;S=22064+(E<<5)|0,d[A>>2]=d[S>>2],d[A+4>>2]=d[S+4>>2],d[A+8>>2]=d[S+8>>2],d[A+12>>2]=d[S+12>>2],d[A+16>>2]=d[S+16>>2],d[A+20>>2]=d[S+20>>2],d[A+24>>2]=d[S+24>>2],d[A+28>>2]=d[S+28>>2];break}while(!1);return Gp(A,b?1.4:1.1),b=26096+(P<<3)|0,(d[b>>2]|0)==(f|0)&&(d[b+4>>2]|0)==(h|0)&&(tt[A>>3]=1.5707963267948966),P=26224+(P<<3)|0,(d[P>>2]|0)==(f|0)&&(d[P+4>>2]|0)==(h|0)&&(tt[A+8>>3]=-1.5707963267948966),+tt[A>>3]!=1.5707963267948966&&+tt[A+8>>3]!=-1.5707963267948966?(P=0,gt=R,P|0):(tt[A+16>>3]=3.141592653589793,tt[A+24>>3]=-3.141592653589793,P=0,gt=R,P|0)}function Uf(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0;U=gt,gt=gt+48|0,P=U+32|0,S=U+40|0,R=U,Ac(P,0,0,0),F=d[P>>2]|0,P=d[P+4>>2]|0;do if(A>>>0<=15){if(E=Os(b)|0,E|0){b=R,d[b>>2]=0,d[b+4>>2]=0,d[R+8>>2]=E,d[R+12>>2]=-1,b=R+16|0,F=R+29|0,d[b>>2]=0,d[b+4>>2]=0,d[b+8>>2]=0,pt[b+12>>0]=0,pt[F>>0]=pt[S>>0]|0,pt[F+1>>0]=pt[S+1>>0]|0,pt[F+2>>0]=pt[S+2>>0]|0;break}if(E=Pr((d[h+8>>2]|0)+1|0,32)|0,E){Fs(h,E),W=R,d[W>>2]=F,d[W+4>>2]=P,d[R+8>>2]=0,d[R+12>>2]=A,d[R+16>>2]=b,d[R+20>>2]=h,d[R+24>>2]=E,pt[R+28>>0]=0,F=R+29|0,pt[F>>0]=pt[S>>0]|0,pt[F+1>>0]=pt[S+1>>0]|0,pt[F+2>>0]=pt[S+2>>0]|0;break}else{b=R,d[b>>2]=0,d[b+4>>2]=0,d[R+8>>2]=13,d[R+12>>2]=-1,b=R+16|0,F=R+29|0,d[b>>2]=0,d[b+4>>2]=0,d[b+8>>2]=0,pt[b+12>>0]=0,pt[F>>0]=pt[S>>0]|0,pt[F+1>>0]=pt[S+1>>0]|0,pt[F+2>>0]=pt[S+2>>0]|0;break}}else F=R,d[F>>2]=0,d[F+4>>2]=0,d[R+8>>2]=4,d[R+12>>2]=-1,F=R+16|0,W=R+29|0,d[F>>2]=0,d[F+4>>2]=0,d[F+8>>2]=0,pt[F+12>>0]=0,pt[W>>0]=pt[S>>0]|0,pt[W+1>>0]=pt[S+1>>0]|0,pt[W+2>>0]=pt[S+2>>0]|0;while(!1);Ea(R),d[f>>2]=d[R>>2],d[f+4>>2]=d[R+4>>2],d[f+8>>2]=d[R+8>>2],d[f+12>>2]=d[R+12>>2],d[f+16>>2]=d[R+16>>2],d[f+20>>2]=d[R+20>>2],d[f+24>>2]=d[R+24>>2],d[f+28>>2]=d[R+28>>2],gt=U}function Ea(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0;if(qt=gt,gt=gt+336|0,It=qt+168|0,Mt=qt,b=f,A=d[b>>2]|0,b=d[b+4>>2]|0,(A|0)==0&(b|0)==0){gt=qt;return}if(h=f+28|0,pt[h>>0]|0?(A=wc(A,b)|0,b=_t()|0):pt[h>>0]=1,Jt=f+20|0,!(d[d[Jt>>2]>>2]|0)){h=f+24|0,A=d[h>>2]|0,A|0&&Fi(A),te=f,d[te>>2]=0,d[te+4>>2]=0,d[f+8>>2]=0,d[Jt>>2]=0,d[f+12>>2]=-1,d[f+16>>2]=0,d[h>>2]=0,gt=qt;return}te=f+16|0,h=d[te>>2]|0,E=h&15;t:do if((A|0)==0&(b|0)==0)ie=f+24|0;else{Yt=f+12|0,ht=(E|0)==3,W=h&255,F=(E|1|0)==3,Pt=f+24|0,U=(E+-1|0)>>>0<3,P=(E|2|0)==3,R=Mt+8|0;e:for(;;){if(S=D(A|0,b|0,52)|0,_t()|0,S=S&15,(S|0)==(d[Yt>>2]|0)){switch(W&15){case 0:case 2:case 3:{if(E=wa(A,b,It)|0,E|0){Ht=15;break e}if(Dr(d[Jt>>2]|0,d[Pt>>2]|0,It)|0){Ht=19;break e}break}}if(F&&(E=d[(d[Jt>>2]|0)+4>>2]|0,d[It>>2]=d[E>>2],d[It+4>>2]=d[E+4>>2],d[It+8>>2]=d[E+8>>2],d[It+12>>2]=d[E+12>>2],No(26832,It)|0)){if(Ah(d[(d[Jt>>2]|0)+4>>2]|0,S,Mt)|0){Ht=25;break}if(E=Mt,(d[E>>2]|0)==(A|0)&&(d[E+4>>2]|0)==(b|0)){Ht=29;break}}if(U){if(E=Za(A,b,It)|0,E|0){Ht=32;break}if(Eo(A,b,Mt,0)|0){Ht=36;break}if(P&&Ca(d[Jt>>2]|0,d[Pt>>2]|0,It,Mt)|0){Ht=42;break}if(F&&uo(d[Jt>>2]|0,d[Pt>>2]|0,It,Mt)|0){Ht=42;break}}if(ht){if(h=Eo(A,b,It,1)|0,E=d[Pt>>2]|0,h|0){Ht=45;break}if(zo(E,It)|0){if(gr(Mt,It),ys(It,d[Pt>>2]|0)|0){Ht=53;break}if(Dr(d[Jt>>2]|0,d[Pt>>2]|0,R)|0){Ht=53;break}if(uo(d[Jt>>2]|0,d[Pt>>2]|0,Mt,It)|0){Ht=53;break}}}}do if((S|0)<(d[Yt>>2]|0)){if(h=Eo(A,b,It,1)|0,E=d[Pt>>2]|0,h|0){Ht=58;break e}if(!(zo(E,It)|0)){Ht=73;break}if(ys(d[Pt>>2]|0,It)|0&&(gr(Mt,It),Ca(d[Jt>>2]|0,d[Pt>>2]|0,Mt,It)|0)){Ht=65;break e}if(A=Ka(A,b,S+1|0,Mt)|0,A|0){Ht=67;break e}b=Mt,A=d[b>>2]|0,b=d[b+4>>2]|0}else Ht=73;while(!1);if((Ht|0)==73&&(Ht=0,A=wc(A,b)|0,b=_t()|0),(A|0)==0&(b|0)==0){ie=Pt;break t}}switch(Ht|0){case 15:{h=d[Pt>>2]|0,h|0&&Fi(h),Ht=f,d[Ht>>2]=0,d[Ht+4>>2]=0,d[Jt>>2]=0,d[Yt>>2]=-1,d[te>>2]=0,d[Pt>>2]=0,d[f+8>>2]=E,Ht=20;break}case 19:{d[f>>2]=A,d[f+4>>2]=b,Ht=20;break}case 25:{ti(27795,27761,470,27772);break}case 29:{d[f>>2]=A,d[f+4>>2]=b,gt=qt;return}case 32:{h=d[Pt>>2]|0,h|0&&Fi(h),ie=f,d[ie>>2]=0,d[ie+4>>2]=0,d[Jt>>2]=0,d[Yt>>2]=-1,d[te>>2]=0,d[Pt>>2]=0,d[f+8>>2]=E,gt=qt;return}case 36:{ti(27795,27761,493,27772);break}case 42:{d[f>>2]=A,d[f+4>>2]=b,gt=qt;return}case 45:{E|0&&Fi(E),Ht=f,d[Ht>>2]=0,d[Ht+4>>2]=0,d[Jt>>2]=0,d[Yt>>2]=-1,d[te>>2]=0,d[Pt>>2]=0,d[f+8>>2]=h,Ht=55;break}case 53:{d[f>>2]=A,d[f+4>>2]=b,Ht=55;break}case 58:{E|0&&Fi(E),Ht=f,d[Ht>>2]=0,d[Ht+4>>2]=0,d[Jt>>2]=0,d[Yt>>2]=-1,d[te>>2]=0,d[Pt>>2]=0,d[f+8>>2]=h,Ht=71;break}case 65:{d[f>>2]=A,d[f+4>>2]=b,Ht=71;break}case 67:{h=d[Pt>>2]|0,h|0&&Fi(h),ie=f,d[ie>>2]=0,d[ie+4>>2]=0,d[Jt>>2]=0,d[Yt>>2]=-1,d[te>>2]=0,d[Pt>>2]=0,d[f+8>>2]=A,gt=qt;return}}if((Ht|0)==20){gt=qt;return}else if((Ht|0)==55){gt=qt;return}else if((Ht|0)==71){gt=qt;return}}while(!1);h=d[ie>>2]|0,h|0&&Fi(h),Ht=f,d[Ht>>2]=0,d[Ht+4>>2]=0,d[f+8>>2]=0,d[Jt>>2]=0,d[f+12>>2]=-1,d[te>>2]=0,d[ie>>2]=0,gt=qt}function wc(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0;ht=gt,gt=gt+16|0,W=ht,b=D(f|0,h|0,52)|0,_t()|0,b=b&15,A=D(f|0,h|0,45)|0,_t()|0;do if(b){for(;A=O(b+4095|0,0,52)|0,E=_t()|0|h&-15728641,S=(15-b|0)*3|0,P=O(7,0,S|0)|0,R=_t()|0,A=A|f|P,E=E|R,F=D(f|0,h|0,S|0)|0,_t()|0,F=F&7,b=b+-1|0,!(F>>>0<6);)if(b)h=E,f=A;else{U=4;break}if((U|0)==4){A=D(A|0,E|0,45)|0,_t()|0;break}return W=(F|0)==0&(Rn(A,E)|0)!=0,W=O((W?2:1)+F|0,0,S|0)|0,U=_t()|0|h&~R,W=W|f&~P,mi(U|0),gt=ht,W|0}while(!1);return A=A&127,A>>>0>120?(U=0,W=0,mi(U|0),gt=ht,W|0):(Ac(W,0,A+1|0,0),U=d[W+4>>2]|0,W=d[W>>2]|0,mi(U|0),gt=ht,W|0)}function vh(f,h,A,b,E,S){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0,S=S|0;var P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0;Ht=gt,gt=gt+160|0,ht=Ht+80|0,R=Ht+64|0,Pt=Ht+112|0,Yt=Ht,Uf(ht,f,h,A),U=ht,ra(R,d[U>>2]|0,d[U+4>>2]|0,h),U=R,F=d[U>>2]|0,U=d[U+4>>2]|0,P=d[ht+8>>2]|0,It=Pt+4|0,d[It>>2]=d[ht>>2],d[It+4>>2]=d[ht+4>>2],d[It+8>>2]=d[ht+8>>2],d[It+12>>2]=d[ht+12>>2],d[It+16>>2]=d[ht+16>>2],d[It+20>>2]=d[ht+20>>2],d[It+24>>2]=d[ht+24>>2],d[It+28>>2]=d[ht+28>>2],It=Yt,d[It>>2]=F,d[It+4>>2]=U,It=Yt+8|0,d[It>>2]=P,f=Yt+12|0,h=Pt,A=f+36|0;do d[f>>2]=d[h>>2],f=f+4|0,h=h+4|0;while((f|0)<(A|0));if(Pt=Yt+48|0,d[Pt>>2]=d[R>>2],d[Pt+4>>2]=d[R+4>>2],d[Pt+8>>2]=d[R+8>>2],d[Pt+12>>2]=d[R+12>>2],(F|0)==0&(U|0)==0)return Yt=P,gt=Ht,Yt|0;A=Yt+16|0,W=Yt+24|0,ht=Yt+28|0,P=0,R=0,h=F,f=U;do{if(!((P|0)<(E|0)|(P|0)==(E|0)&R>>>0<b>>>0)){Mt=4;break}if(U=R,R=Ei(R|0,P|0,1,0)|0,P=_t()|0,U=S+(U<<3)|0,d[U>>2]=h,d[U+4>>2]=f,Dl(Pt),f=Pt,h=d[f>>2]|0,f=d[f+4>>2]|0,(h|0)==0&(f|0)==0){if(Ea(A),h=A,f=d[h>>2]|0,h=d[h+4>>2]|0,(f|0)==0&(h|0)==0){Mt=10;break}Wn(f,h,d[ht>>2]|0,Pt),f=Pt,h=d[f>>2]|0,f=d[f+4>>2]|0}U=Yt,d[U>>2]=h,d[U+4>>2]=f}while(!((h|0)==0&(f|0)==0));return(Mt|0)==4?(f=Yt+40|0,h=d[f>>2]|0,h|0&&Fi(h),Mt=Yt+16|0,d[Mt>>2]=0,d[Mt+4>>2]=0,d[W>>2]=0,d[Yt+36>>2]=0,d[ht>>2]=-1,d[Yt+32>>2]=0,d[f>>2]=0,Wn(0,0,0,Pt),d[Yt>>2]=0,d[Yt+4>>2]=0,d[It>>2]=0,Yt=14,gt=Ht,Yt|0):((Mt|0)==10&&(d[Yt>>2]=0,d[Yt+4>>2]=0,d[It>>2]=d[W>>2]),Yt=d[It>>2]|0,gt=Ht,Yt|0)}function Co(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0;if(ht=gt,gt=gt+48|0,F=ht+32|0,R=ht+40|0,U=ht,!(d[f>>2]|0))return W=b,d[W>>2]=0,d[W+4>>2]=0,W=0,gt=ht,W|0;Ac(F,0,0,0),P=F,E=d[P>>2]|0,P=d[P+4>>2]|0;do if(h>>>0>15)W=U,d[W>>2]=0,d[W+4>>2]=0,d[U+8>>2]=4,d[U+12>>2]=-1,W=U+16|0,A=U+29|0,d[W>>2]=0,d[W+4>>2]=0,d[W+8>>2]=0,pt[W+12>>0]=0,pt[A>>0]=pt[R>>0]|0,pt[A+1>>0]=pt[R+1>>0]|0,pt[A+2>>0]=pt[R+2>>0]|0,A=4,W=9;else{if(A=Os(A)|0,A|0){F=U,d[F>>2]=0,d[F+4>>2]=0,d[U+8>>2]=A,d[U+12>>2]=-1,F=U+16|0,W=U+29|0,d[F>>2]=0,d[F+4>>2]=0,d[F+8>>2]=0,pt[F+12>>0]=0,pt[W>>0]=pt[R>>0]|0,pt[W+1>>0]=pt[R+1>>0]|0,pt[W+2>>0]=pt[R+2>>0]|0,W=9;break}if(A=Pr((d[f+8>>2]|0)+1|0,32)|0,!A){W=U,d[W>>2]=0,d[W+4>>2]=0,d[U+8>>2]=13,d[U+12>>2]=-1,W=U+16|0,A=U+29|0,d[W>>2]=0,d[W+4>>2]=0,d[W+8>>2]=0,pt[W+12>>0]=0,pt[A>>0]=pt[R>>0]|0,pt[A+1>>0]=pt[R+1>>0]|0,pt[A+2>>0]=pt[R+2>>0]|0,A=13,W=9;break}Fs(f,A),It=U,d[It>>2]=E,d[It+4>>2]=P,P=U+8|0,d[P>>2]=0,d[U+12>>2]=h,d[U+20>>2]=f,d[U+24>>2]=A,pt[U+28>>0]=0,E=U+29|0,pt[E>>0]=pt[R>>0]|0,pt[E+1>>0]=pt[R+1>>0]|0,pt[E+2>>0]=pt[R+2>>0]|0,d[U+16>>2]=3,Pt=+Ga(A),Pt=Pt*+ya(A),S=+ke(+ +tt[A>>3]),S=Pt/+Ve(+ +at(+S,+ +ke(+ +tt[A+8>>3])))*6371.007180918475*6371.007180918475,E=U+12|0,A=d[E>>2]|0;t:do if((A|0)>0)do{if(Nf(A+-1|0,F)|0,!(S/+tt[F>>3]>10))break t;It=d[E>>2]|0,A=It+-1|0,d[E>>2]=A}while((It|0)>1);while(!1);if(Ea(U),E=b,d[E>>2]=0,d[E+4>>2]=0,E=U,A=d[E>>2]|0,E=d[E+4>>2]|0,!((A|0)==0&(E|0)==0))do Go(A,E,h,F)|0,R=F,f=b,R=Ei(d[f>>2]|0,d[f+4>>2]|0,d[R>>2]|0,d[R+4>>2]|0)|0,f=_t()|0,It=b,d[It>>2]=R,d[It+4>>2]=f,Ea(U),It=U,A=d[It>>2]|0,E=d[It+4>>2]|0;while(!((A|0)==0&(E|0)==0));A=d[P>>2]|0}while(!1);return It=A,gt=ht,It|0}function rs(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0;if(!(No(h,A)|0)||(h=$o(h)|0,b=+tt[A>>3],E=+tt[A+8>>3],E=h&E<0?E+6.283185307179586:E,Pt=d[f>>2]|0,(Pt|0)<=0))return Pt=0,Pt|0;if(ht=d[f+4>>2]|0,h){h=0,W=E,A=-1,f=0;t:for(;;){for(U=f;P=+tt[ht+(U<<4)>>3],E=+tt[ht+(U<<4)+8>>3],f=(A+2|0)%(Pt|0)|0,S=+tt[ht+(f<<4)>>3],R=+tt[ht+(f<<4)+8>>3],P>S?(F=P,P=R):(F=S,S=P,P=E,E=R),b=b==S|b==F?b+2220446049250313e-31:b,!!(b<S|b>F);)if(A=U+1|0,(A|0)>=(Pt|0)){A=22;break t}else f=U,U=A,A=f;if(R=P<0?P+6.283185307179586:P,P=E<0?E+6.283185307179586:E,W=R==W|P==W?W+-2220446049250313e-31:W,F=R+(P-R)*((b-S)/(F-S)),(F<0?F+6.283185307179586:F)>W&&(h=h^1),f=U+1|0,(f|0)>=(Pt|0)){A=22;break}else A=U}if((A|0)==22)return h|0}else{h=0,W=E,A=-1,f=0;t:for(;;){for(U=f;P=+tt[ht+(U<<4)>>3],E=+tt[ht+(U<<4)+8>>3],f=(A+2|0)%(Pt|0)|0,S=+tt[ht+(f<<4)>>3],R=+tt[ht+(f<<4)+8>>3],P>S?(F=P,P=R):(F=S,S=P,P=E,E=R),b=b==S|b==F?b+2220446049250313e-31:b,!!(b<S|b>F);)if(A=U+1|0,(A|0)>=(Pt|0)){A=22;break t}else f=U,U=A,A=f;if(W=P==W|E==W?W+-2220446049250313e-31:W,P+(E-P)*((b-S)/(F-S))>W&&(h=h^1),f=U+1|0,(f|0)>=(Pt|0)){A=22;break}else A=U}if((A|0)==22)return h|0}return 0}function un(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0;if(Mt=d[f>>2]|0,!Mt){d[h>>2]=0,d[h+4>>2]=0,d[h+8>>2]=0,d[h+12>>2]=0,d[h+16>>2]=0,d[h+20>>2]=0,d[h+24>>2]=0,d[h+28>>2]=0;return}if(Yt=h+8|0,tt[Yt>>3]=17976931348623157e292,Ht=h+24|0,tt[Ht>>3]=17976931348623157e292,tt[h>>3]=-17976931348623157e292,ie=h+16|0,tt[ie>>3]=-17976931348623157e292,!((Mt|0)<=0)){for(Pt=d[f+4>>2]|0,U=17976931348623157e292,W=-17976931348623157e292,ht=0,f=-1,S=17976931348623157e292,P=17976931348623157e292,F=-17976931348623157e292,b=-17976931348623157e292,It=0;A=+tt[Pt+(It<<4)>>3],R=+tt[Pt+(It<<4)+8>>3],f=f+2|0,E=+tt[Pt+(((f|0)==(Mt|0)?0:f)<<4)+8>>3],A<S&&(tt[Yt>>3]=A,S=A),R<P&&(tt[Ht>>3]=R,P=R),A>F?tt[h>>3]=A:A=F,R>b&&(tt[ie>>3]=R,b=R),U=R>0&R<U?R:U,W=R<0&R>W?R:W,ht=ht|+ke(+(R-E))>3.141592653589793,f=It+1|0,(f|0)!=(Mt|0);)te=It,F=A,It=f,f=te;ht&&(tt[ie>>3]=W,tt[Ht>>3]=U)}}function Os(f){return f=f|0,(f>>>0<4?0:15)|0}function Fs(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0,Ge=0,ze=0;if(Mt=d[f>>2]|0,Mt){if(Yt=h+8|0,tt[Yt>>3]=17976931348623157e292,Ht=h+24|0,tt[Ht>>3]=17976931348623157e292,tt[h>>3]=-17976931348623157e292,ie=h+16|0,tt[ie>>3]=-17976931348623157e292,(Mt|0)>0){for(E=d[f+4>>2]|0,Pt=17976931348623157e292,It=-17976931348623157e292,b=0,A=-1,F=17976931348623157e292,U=17976931348623157e292,ht=-17976931348623157e292,P=-17976931348623157e292,te=0;S=+tt[E+(te<<4)>>3],W=+tt[E+(te<<4)+8>>3],Ge=A+2|0,R=+tt[E+(((Ge|0)==(Mt|0)?0:Ge)<<4)+8>>3],S<F&&(tt[Yt>>3]=S,F=S),W<U&&(tt[Ht>>3]=W,U=W),S>ht?tt[h>>3]=S:S=ht,W>P&&(tt[ie>>3]=W,P=W),Pt=W>0&W<Pt?W:Pt,It=W<0&W>It?W:It,b=b|+ke(+(W-R))>3.141592653589793,A=te+1|0,(A|0)!=(Mt|0);)Ge=te,ht=S,te=A,A=Ge;b&&(tt[ie>>3]=It,tt[Ht>>3]=Pt)}}else d[h>>2]=0,d[h+4>>2]=0,d[h+8>>2]=0,d[h+12>>2]=0,d[h+16>>2]=0,d[h+20>>2]=0,d[h+24>>2]=0,d[h+28>>2]=0;if(Ge=f+8|0,A=d[Ge>>2]|0,!((A|0)<=0)){Be=f+12|0,qt=0;do if(E=d[Be>>2]|0,b=qt,qt=qt+1|0,Ht=h+(qt<<5)|0,ie=d[E+(b<<3)>>2]|0,ie){if(te=h+(qt<<5)+8|0,tt[te>>3]=17976931348623157e292,f=h+(qt<<5)+24|0,tt[f>>3]=17976931348623157e292,tt[Ht>>3]=-17976931348623157e292,Jt=h+(qt<<5)+16|0,tt[Jt>>3]=-17976931348623157e292,(ie|0)>0){for(Mt=d[E+(b<<3)+4>>2]|0,Pt=17976931348623157e292,It=-17976931348623157e292,E=0,b=-1,Yt=0,F=17976931348623157e292,U=17976931348623157e292,W=-17976931348623157e292,P=-17976931348623157e292;S=+tt[Mt+(Yt<<4)>>3],ht=+tt[Mt+(Yt<<4)+8>>3],b=b+2|0,R=+tt[Mt+(((b|0)==(ie|0)?0:b)<<4)+8>>3],S<F&&(tt[te>>3]=S,F=S),ht<U&&(tt[f>>3]=ht,U=ht),S>W?tt[Ht>>3]=S:S=W,ht>P&&(tt[Jt>>3]=ht,P=ht),Pt=ht>0&ht<Pt?ht:Pt,It=ht<0&ht>It?ht:It,E=E|+ke(+(ht-R))>3.141592653589793,b=Yt+1|0,(b|0)!=(ie|0);)ze=Yt,Yt=b,W=S,b=ze;E&&(tt[Jt>>3]=It,tt[f>>3]=Pt)}}else d[Ht>>2]=0,d[Ht+4>>2]=0,d[Ht+8>>2]=0,d[Ht+12>>2]=0,d[Ht+16>>2]=0,d[Ht+20>>2]=0,d[Ht+24>>2]=0,d[Ht+28>>2]=0,A=d[Ge>>2]|0;while((qt|0)<(A|0))}}function Dr(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0;if(!(rs(f,h,A)|0))return E=0,E|0;if(E=f+8|0,(d[E>>2]|0)<=0)return E=1,E|0;for(b=f+12|0,f=0;;){if(S=f,f=f+1|0,rs((d[b>>2]|0)+(S<<3)|0,h+(f<<5)|0,A)|0){f=0,b=6;break}if((f|0)>=(d[E>>2]|0)){f=1,b=6;break}}return(b|0)==6?f|0:0}function Ca(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0;if(U=gt,gt=gt+16|0,R=U,P=A+8|0,!(rs(f,h,P)|0))return F=0,gt=U,F|0;F=f+8|0;t:do if((d[F>>2]|0)>0){for(S=f+12|0,E=0;;){if(W=E,E=E+1|0,rs((d[S>>2]|0)+(W<<3)|0,h+(E<<5)|0,P)|0){E=0;break}if((E|0)>=(d[F>>2]|0))break t}return gt=U,E|0}while(!1);if(To(f,h,A,b)|0)return W=0,gt=U,W|0;d[R>>2]=d[A>>2],d[R+4>>2]=P,E=d[F>>2]|0;t:do if((E|0)>0)for(f=f+12|0,P=0,S=E;;){if(E=d[f>>2]|0,(d[E+(P<<3)>>2]|0)>0){if(rs(R,b,d[E+(P<<3)+4>>2]|0)|0){E=0;break t}if(E=P+1|0,To((d[f>>2]|0)+(P<<3)|0,h+(E<<5)|0,A,b)|0){E=0;break t}S=d[F>>2]|0}else E=P+1|0;if((E|0)<(S|0))P=E;else{E=1;break}}else E=1;while(!1);return W=E,gt=U,W|0}function To(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0,Ge=0,ze=0,Ri=0;if(Ge=gt,gt=gt+176|0,te=Ge+172|0,E=Ge+168|0,Jt=Ge,!(zo(h,b)|0))return f=0,gt=Ge,f|0;if(cc(h,b,te,E),Ct(Jt|0,A|0,168)|0,(d[A>>2]|0)>0){h=0;do ze=Jt+8+(h<<4)+8|0,ie=+qi(+tt[ze>>3],d[E>>2]|0),tt[ze>>3]=ie,h=h+1|0;while((h|0)<(d[A>>2]|0))}Yt=+tt[b>>3],Ht=+tt[b+8>>3],ie=+qi(+tt[b+16>>3],d[E>>2]|0),It=+qi(+tt[b+24>>3],d[E>>2]|0);t:do if((d[f>>2]|0)>0){if(b=f+4|0,E=d[Jt>>2]|0,(E|0)<=0){for(h=0;;)if(h=h+1|0,(h|0)>=(d[f>>2]|0)){h=0;break t}}for(A=0;;){if(h=d[b>>2]|0,Pt=+tt[h+(A<<4)>>3],Mt=+qi(+tt[h+(A<<4)+8>>3],d[te>>2]|0),h=d[b>>2]|0,A=A+1|0,ze=(A|0)%(d[f>>2]|0)|0,S=+tt[h+(ze<<4)>>3],P=+qi(+tt[h+(ze<<4)+8>>3],d[te>>2]|0),!(Pt>=Yt)|!(S>=Yt)&&!(Pt<=Ht)|!(S<=Ht)&&!(Mt<=It)|!(P<=It)&&!(Mt>=ie)|!(P>=ie)){ht=S-Pt,U=P-Mt,h=0;do if(Ri=h,h=h+1|0,ze=(h|0)==(E|0)?0:h,S=+tt[Jt+8+(Ri<<4)+8>>3],P=+tt[Jt+8+(ze<<4)+8>>3]-S,R=+tt[Jt+8+(Ri<<4)>>3],F=+tt[Jt+8+(ze<<4)>>3]-R,W=ht*P-U*F,W!=0&&(qt=Mt-S,Be=Pt-R,F=(qt*F-P*Be)/W,!(F<0|F>1))&&(W=(ht*qt-U*Be)/W,W>=0&W<=1)){h=1;break t}while((h|0)<(E|0))}if((A|0)>=(d[f>>2]|0)){h=0;break}}}else h=0;while(!1);return Ri=h,gt=Ge,Ri|0}function uo(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0;if(To(f,h,A,b)|0)return S=1,S|0;if(S=f+8|0,(d[S>>2]|0)<=0)return S=0,S|0;for(E=f+12|0,f=0;;){if(P=f,f=f+1|0,To((d[E>>2]|0)+(P<<3)|0,h+(f<<5)|0,A,b)|0){f=1,E=6;break}if((f|0)>=(d[S>>2]|0)){f=0,E=6;break}}return(E|0)==6?f|0:0}function us(){return 8}function Tu(){return 16}function Ii(){return 168}function pi(){return 8}function Ec(){return 16}function cs(){return 12}function So(){return 8}function Kr(f){return f=f|0,+(+((d[f>>2]|0)>>>0)+4294967296*+(d[f+4>>2]|0))}function jo(f){f=f|0;var h=0,A=0;return A=+tt[f>>3],h=+tt[f+8>>3],+ +Ue(+(A*A+h*h))}function Cc(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0;U=+tt[f>>3],F=+tt[h>>3]-U,R=+tt[f+8>>3],P=+tt[h+8>>3]-R,ht=+tt[A>>3],S=+tt[b>>3]-ht,Pt=+tt[A+8>>3],W=+tt[b+8>>3]-Pt,S=(S*(R-Pt)-(U-ht)*W)/(F*W-P*S),tt[E>>3]=U+F*S,tt[E+8>>3]=R+P*S}function Su(f,h){return f=f|0,h=h|0,+ke(+(+tt[f>>3]-+tt[h>>3]))<11920928955078125e-23?(h=+ke(+(+tt[f+8>>3]-+tt[h+8>>3]))<11920928955078125e-23,h|0):(h=0,h|0)}function Ki(f,h){f=f|0,h=h|0;var A=0,b=0,E=0;return E=+tt[f>>3]-+tt[h>>3],b=+tt[f+8>>3]-+tt[h+8>>3],A=+tt[f+16>>3]-+tt[h+16>>3],+(E*E+b*b+A*A)}function zr(f,h){f=f|0,h=h|0;var A=0,b=0,E=0;A=+tt[f>>3],b=+Ve(+A),A=+De(+A),tt[h+16>>3]=A,A=+tt[f+8>>3],E=b*+Ve(+A),tt[h>>3]=E,A=b*+De(+A),tt[h+8>>3]=A}function Vf(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0;if(S=gt,gt=gt+16|0,E=S,b=Rn(f,h)|0,(A+-1|0)>>>0>5||(b=(b|0)!=0,(A|0)==1&b))return E=-1,gt=S,E|0;do if(Po(f,h,E)|0)b=-1;else if(b){b=((d[26352+(A<<2)>>2]|0)+5-(d[E>>2]|0)|0)%5|0;break}else{b=((d[26384+(A<<2)>>2]|0)+6-(d[E>>2]|0)|0)%6|0;break}while(!1);return E=b,gt=S,E|0}function Po(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0,U=0;if(U=gt,gt=gt+32|0,P=U+16|0,R=U,b=xa(f,h,P)|0,b|0)return A=b,gt=U,A|0;S=fh(f,h)|0,F=vs(f,h)|0,Ef(S,R),b=El(S,d[P>>2]|0)|0;t:do if(Tn(S)|0){do switch(S|0){case 4:{f=0;break}case 14:{f=1;break}case 24:{f=2;break}case 38:{f=3;break}case 49:{f=4;break}case 58:{f=5;break}case 63:{f=6;break}case 72:{f=7;break}case 83:{f=8;break}case 97:{f=9;break}case 107:{f=10;break}case 117:{f=11;break}default:{b=1;break t}}while(!1);if(E=d[26416+(f*24|0)+8>>2]|0,h=d[26416+(f*24|0)+16>>2]|0,f=d[P>>2]|0,(f|0)!=(d[R>>2]|0)&&(R=Xr(S)|0,f=d[P>>2]|0,R|(f|0)==(h|0)&&(b=(b+1|0)%6|0)),(F|0)==3&(f|0)==(h|0)){b=(b+5|0)%6|0,E=22;break}(F|0)==5&(f|0)==(E|0)&&(b=(b+1|0)%6|0),E=22}else E=22;while(!1);return(E|0)==22&&(d[A>>2]=b,b=0),A=b,gt=U,A|0}function Ns(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0;if(Jt=gt,gt=gt+32|0,te=Jt+24|0,Ht=Jt+20|0,Mt=Jt+8|0,It=Jt+16|0,Pt=Jt,F=(Rn(f,h)|0)==0,F=F?6:5,W=D(f|0,h|0,52)|0,_t()|0,W=W&15,F>>>0<=A>>>0)return b=2,gt=Jt,b|0;ht=(W|0)==0,!ht&&(Yt=O(7,0,(W^15)*3|0)|0,(Yt&f|0)==0&((_t()|0)&h|0)==0)?E=A:S=4;t:do if((S|0)==4){if(E=(Rn(f,h)|0)!=0,((E?4:5)|0)<(A|0)||Po(f,h,te)|0||(S=(d[te>>2]|0)+A|0,E?E=26704+(((S|0)%5|0)<<2)|0:E=26736+(((S|0)%6|0)<<2)|0,Yt=d[E>>2]|0,(Yt|0)==7))return b=1,gt=Jt,b|0;d[Ht>>2]=0,E=Ln(f,h,Yt,Ht,Mt)|0;do if(!E){if(R=Mt,U=d[R>>2]|0,R=d[R+4>>2]|0,P=R>>>0<h>>>0|(R|0)==(h|0)&U>>>0<f>>>0,S=P?U:f,P=P?R:h,!ht&&(ht=O(7,0,(W^15)*3|0)|0,(U&ht|0)==0&(R&(_t()|0)|0)==0))E=A;else{if(R=(A+-1+F|0)%(F|0)|0,E=Rn(f,h)|0,(R|0)<0&&ti(27795,27797,246,27806),F=(E|0)!=0,((F?4:5)|0)<(R|0)&&ti(27795,27797,246,27806),Po(f,h,te)|0&&ti(27795,27797,246,27806),E=(d[te>>2]|0)+R|0,F?E=26704+(((E|0)%5|0)<<2)|0:E=26736+(((E|0)%6|0)<<2)|0,R=d[E>>2]|0,(R|0)==7&&ti(27795,27797,246,27806),d[It>>2]=0,E=Ln(f,h,R,It,Pt)|0,E|0)break;U=Pt,F=d[U>>2]|0,U=d[U+4>>2]|0;do if(U>>>0<P>>>0|(U|0)==(P|0)&F>>>0<S>>>0){if(Rn(F,U)|0?S=$t(F,U,f,h)|0:S=d[26800+((((d[It>>2]|0)+(d[26768+(R<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,E=Rn(F,U)|0,(S+-1|0)>>>0>5){E=-1,S=F,P=U;break}if(E=(E|0)!=0,(S|0)==1&E){E=-1,S=F,P=U;break}do if(Po(F,U,te)|0)E=-1;else if(E){E=((d[26352+(S<<2)>>2]|0)+5-(d[te>>2]|0)|0)%5|0;break}else{E=((d[26384+(S<<2)>>2]|0)+6-(d[te>>2]|0)|0)%6|0;break}while(!1);S=F,P=U}else E=A;while(!1);R=Mt,U=d[R>>2]|0,R=d[R+4>>2]|0}if((S|0)==(U|0)&(P|0)==(R|0)){if(F=(Rn(U,R)|0)!=0,F?f=$t(U,R,f,h)|0:f=d[26800+((((d[Ht>>2]|0)+(d[26768+(Yt<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,E=Rn(U,R)|0,(f+-1|0)>>>0<=5&&(ie=(E|0)!=0,!((f|0)==1&ie)))do if(Po(U,R,te)|0)E=-1;else if(ie){E=((d[26352+(f<<2)>>2]|0)+5-(d[te>>2]|0)|0)%5|0;break}else{E=((d[26384+(f<<2)>>2]|0)+6-(d[te>>2]|0)|0)%6|0;break}while(!1);else E=-1;E=E+1|0,E=(E|0)==6|F&(E|0)==5?0:E}h=P,f=S;break t}while(!1);return b=E,gt=Jt,b|0}while(!1);return ie=O(E|0,0,56)|0,te=_t()|0|h&-2130706433|536870912,d[b>>2]=ie|f,d[b+4>>2]=te,b=0,gt=Jt,b|0}function sa(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0;return S=(Rn(f,h)|0)==0,b=Ns(f,h,0,A)|0,E=(b|0)==0,S?!E||(b=Ns(f,h,1,A+8|0)|0,b|0)||(b=Ns(f,h,2,A+16|0)|0,b|0)||(b=Ns(f,h,3,A+24|0)|0,b|0)||(b=Ns(f,h,4,A+32|0)|0,b)?(S=b,S|0):Ns(f,h,5,A+40|0)|0:!E||(b=Ns(f,h,1,A+8|0)|0,b|0)||(b=Ns(f,h,2,A+16|0)|0,b|0)||(b=Ns(f,h,3,A+24|0)|0,b|0)||(b=Ns(f,h,4,A+32|0)|0,b|0)?(S=b,S|0):(S=A+40|0,d[S>>2]=0,d[S+4>>2]=0,S=0,S|0)}function zs(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0,R=0,F=0;return F=gt,gt=gt+192|0,E=F,S=F+168|0,P=D(f|0,h|0,56)|0,_t()|0,P=P&7,R=h&-2130706433|134217728,b=xa(f,R,S)|0,b|0?(R=b,gt=F,R|0):(h=D(f|0,h|0,52)|0,_t()|0,h=h&15,Rn(f,R)|0?na(S,h,P,1,E):Sl(S,h,P,1,E),R=E+8|0,d[A>>2]=d[R>>2],d[A+4>>2]=d[R+4>>2],d[A+8>>2]=d[R+8>>2],d[A+12>>2]=d[R+12>>2],R=0,gt=F,R|0)}function Fl(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0;return E=gt,gt=gt+16|0,A=E,!(!0&(h&2013265920|0)==536870912)||(b=h&-2130706433|134217728,!(dh(f,b)|0))?(b=0,gt=E,b|0):(S=D(f|0,h|0,56)|0,_t()|0,S=(Ns(f,b,S&7,A)|0)==0,b=A,b=S&((d[b>>2]|0)==(f|0)?(d[b+4>>2]|0)==(h|0):0)&1,gt=E,b|0)}function Io(f,h,A){f=f|0,h=h|0,A=A|0;var b=0;(h|0)>0?(b=Pr(h,4)|0,d[f>>2]=b,b||ti(27819,27842,40,27856)):d[f>>2]=0,d[f+4>>2]=h,d[f+8>>2]=0,d[f+12>>2]=A}function Pu(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0;E=f+4|0,S=f+12|0,P=f+8|0;t:for(;;){for(A=d[E>>2]|0,h=0;;){if((h|0)>=(A|0))break t;if(b=d[f>>2]|0,R=d[b+(h<<2)>>2]|0,!R)h=h+1|0;else break}h=b+(~~(+ke(+(+ge(10,+ +(15-(d[S>>2]|0)|0))*(+tt[R>>3]+ +tt[R+8>>3])))%+(A|0))>>>0<<2)|0,A=d[h>>2]|0;e:do if(A|0){if(b=R+32|0,(A|0)==(R|0))d[h>>2]=d[b>>2];else{if(A=A+32|0,h=d[A>>2]|0,!h)break;for(;(h|0)!=(R|0);)if(A=h+32|0,h=d[A>>2]|0,!h)break e;d[A>>2]=d[b>>2]}Fi(R),d[P>>2]=(d[P>>2]|0)+-1}while(!1)}Fi(d[f>>2]|0)}function Qa(f){f=f|0;var h=0,A=0,b=0;for(b=d[f+4>>2]|0,A=0;;){if((A|0)>=(b|0)){h=0,A=4;break}if(h=d[(d[f>>2]|0)+(A<<2)>>2]|0,!h)A=A+1|0;else{A=4;break}}return(A|0)==4?h|0:0}function Nl(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0;if(A=~~(+ke(+(+ge(10,+ +(15-(d[f+12>>2]|0)|0))*(+tt[h>>3]+ +tt[h+8>>3])))%+(d[f+4>>2]|0))>>>0,A=(d[f>>2]|0)+(A<<2)|0,b=d[A>>2]|0,!b)return S=1,S|0;S=h+32|0;do if((b|0)!=(h|0)){if(A=d[b+32>>2]|0,!A)return S=1,S|0;for(E=A;;){if((E|0)==(h|0)){E=8;break}if(A=d[E+32>>2]|0,A)b=E,E=A;else{A=1,E=10;break}}if((E|0)==8){d[b+32>>2]=d[S>>2];break}else if((E|0)==10)return A|0}else d[A>>2]=d[S>>2];while(!1);return Fi(h),S=f+8|0,d[S>>2]=(d[S>>2]|0)+-1,S=0,S|0}function _h(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0;S=ss(40)|0,S||ti(27872,27842,98,27885),d[S>>2]=d[h>>2],d[S+4>>2]=d[h+4>>2],d[S+8>>2]=d[h+8>>2],d[S+12>>2]=d[h+12>>2],E=S+16|0,d[E>>2]=d[A>>2],d[E+4>>2]=d[A+4>>2],d[E+8>>2]=d[A+8>>2],d[E+12>>2]=d[A+12>>2],d[S+32>>2]=0,E=~~(+ke(+(+ge(10,+ +(15-(d[f+12>>2]|0)|0))*(+tt[h>>3]+ +tt[h+8>>3])))%+(d[f+4>>2]|0))>>>0,E=(d[f>>2]|0)+(E<<2)|0,b=d[E>>2]|0;do if(!b)d[E>>2]=S;else{for(;!(Zs(b,h)|0&&Zs(b+16|0,A)|0);)if(E=d[b+32>>2]|0,b=(E|0)==0?b:E,!(d[b+32>>2]|0)){P=10;break}if((P|0)==10){d[b+32>>2]=S;break}return Fi(S),P=b,P|0}while(!1);return P=f+8|0,d[P>>2]=(d[P>>2]|0)+1,P=S,P|0}function zl(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0;if(E=~~(+ke(+(+ge(10,+ +(15-(d[f+12>>2]|0)|0))*(+tt[h>>3]+ +tt[h+8>>3])))%+(d[f+4>>2]|0))>>>0,E=d[(d[f>>2]|0)+(E<<2)>>2]|0,!E)return A=0,A|0;if(!A){for(f=E;;){if(Zs(f,h)|0){b=10;break}if(f=d[f+32>>2]|0,!f){f=0,b=10;break}}if((b|0)==10)return f|0}for(f=E;;){if(Zs(f,h)|0&&Zs(f+16|0,A)|0){b=10;break}if(f=d[f+32>>2]|0,!f){f=0,b=10;break}}return(b|0)==10?f|0:0}function Ja(f,h){f=f|0,h=h|0;var A=0;if(A=~~(+ke(+(+ge(10,+ +(15-(d[f+12>>2]|0)|0))*(+tt[h>>3]+ +tt[h+8>>3])))%+(d[f+4>>2]|0))>>>0,f=d[(d[f>>2]|0)+(A<<2)>>2]|0,!f)return A=0,A|0;for(;;){if(Zs(f,h)|0){h=5;break}if(f=d[f+32>>2]|0,!f){f=0,h=5;break}}return(h|0)==5?f|0:0}function bh(){return 27904}function xs(f){return f=+f,~~+Wt(+f)|0}function ss(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0,Yt=0,Ht=0,ie=0,te=0,Jt=0,qt=0,Be=0;Be=gt,gt=gt+16|0,Pt=Be;do if(f>>>0<245){if(U=f>>>0<11?16:f+11&-8,f=U>>>3,ht=d[6977]|0,A=ht>>>f,A&3|0)return h=(A&1^1)+f|0,f=27948+(h<<1<<2)|0,A=f+8|0,b=d[A>>2]|0,E=b+8|0,S=d[E>>2]|0,(S|0)==(f|0)?d[6977]=ht&~(1<<h):(d[S+12>>2]=f,d[A>>2]=S),qt=h<<3,d[b+4>>2]=qt|3,qt=b+qt+4|0,d[qt>>2]=d[qt>>2]|1,qt=E,gt=Be,qt|0;if(W=d[6979]|0,U>>>0>W>>>0){if(A|0)return h=2<<f,h=A<<f&(h|0-h),h=(h&0-h)+-1|0,R=h>>>12&16,h=h>>>R,A=h>>>5&8,h=h>>>A,S=h>>>2&4,h=h>>>S,f=h>>>1&2,h=h>>>f,b=h>>>1&1,b=(A|R|S|f|b)+(h>>>b)|0,h=27948+(b<<1<<2)|0,f=h+8|0,S=d[f>>2]|0,R=S+8|0,A=d[R>>2]|0,(A|0)==(h|0)?(f=ht&~(1<<b),d[6977]=f):(d[A+12>>2]=h,d[f>>2]=A,f=ht),qt=b<<3,P=qt-U|0,d[S+4>>2]=U|3,E=S+U|0,d[E+4>>2]=P|1,d[S+qt>>2]=P,W|0&&(b=d[6982]|0,h=W>>>3,A=27948+(h<<1<<2)|0,h=1<<h,f&h?(f=A+8|0,h=d[f>>2]|0):(d[6977]=f|h,h=A,f=A+8|0),d[f>>2]=b,d[h+12>>2]=b,d[b+8>>2]=h,d[b+12>>2]=A),d[6979]=P,d[6982]=E,qt=R,gt=Be,qt|0;if(S=d[6978]|0,S){for(A=(S&0-S)+-1|0,E=A>>>12&16,A=A>>>E,b=A>>>5&8,A=A>>>b,P=A>>>2&4,A=A>>>P,R=A>>>1&2,A=A>>>R,F=A>>>1&1,F=d[28212+((b|E|P|R|F)+(A>>>F)<<2)>>2]|0,A=F,R=F,F=(d[F+4>>2]&-8)-U|0;f=d[A+16>>2]|0,!(!f&&(f=d[A+20>>2]|0,!f));)P=(d[f+4>>2]&-8)-U|0,E=P>>>0<F>>>0,A=f,R=E?f:R,F=E?P:F;if(P=R+U|0,P>>>0>R>>>0){E=d[R+24>>2]|0,h=d[R+12>>2]|0;do if((h|0)==(R|0)){if(f=R+20|0,h=d[f>>2]|0,!h&&(f=R+16|0,h=d[f>>2]|0,!h)){A=0;break}for(;;)if(b=h+20|0,A=d[b>>2]|0,A)h=A,f=b;else if(b=h+16|0,A=d[b>>2]|0,A)h=A,f=b;else break;d[f>>2]=0,A=h}else A=d[R+8>>2]|0,d[A+12>>2]=h,d[h+8>>2]=A,A=h;while(!1);do if(E|0){if(h=d[R+28>>2]|0,f=28212+(h<<2)|0,(R|0)==(d[f>>2]|0)){if(d[f>>2]=A,!A){d[6978]=S&~(1<<h);break}}else if(qt=E+16|0,d[((d[qt>>2]|0)==(R|0)?qt:E+20|0)>>2]=A,!A)break;d[A+24>>2]=E,h=d[R+16>>2]|0,h|0&&(d[A+16>>2]=h,d[h+24>>2]=A),h=d[R+20>>2]|0,h|0&&(d[A+20>>2]=h,d[h+24>>2]=A)}while(!1);return F>>>0<16?(qt=F+U|0,d[R+4>>2]=qt|3,qt=R+qt+4|0,d[qt>>2]=d[qt>>2]|1):(d[R+4>>2]=U|3,d[P+4>>2]=F|1,d[P+F>>2]=F,W|0&&(b=d[6982]|0,h=W>>>3,A=27948+(h<<1<<2)|0,h=1<<h,h&ht?(f=A+8|0,h=d[f>>2]|0):(d[6977]=h|ht,h=A,f=A+8|0),d[f>>2]=b,d[h+12>>2]=b,d[b+8>>2]=h,d[b+12>>2]=A),d[6979]=F,d[6982]=P),qt=R+8|0,gt=Be,qt|0}else ht=U}else ht=U}else ht=U}else if(f>>>0<=4294967231)if(f=f+11|0,U=f&-8,b=d[6978]|0,b){E=0-U|0,f=f>>>8,f?U>>>0>16777215?F=31:(ht=(f+1048320|0)>>>16&8,Yt=f<<ht,R=(Yt+520192|0)>>>16&4,Yt=Yt<<R,F=(Yt+245760|0)>>>16&2,F=14-(R|ht|F)+(Yt<<F>>>15)|0,F=U>>>(F+7|0)&1|F<<1):F=0,A=d[28212+(F<<2)>>2]|0;t:do if(!A)A=0,f=0,Yt=61;else for(f=0,R=U<<((F|0)==31?0:25-(F>>>1)|0),S=0;;){if(P=(d[A+4>>2]&-8)-U|0,P>>>0<E>>>0)if(P)f=A,E=P;else{f=A,E=0,Yt=65;break t}if(Yt=d[A+20>>2]|0,A=d[A+16+(R>>>31<<2)>>2]|0,S=(Yt|0)==0|(Yt|0)==(A|0)?S:Yt,A)R=R<<1;else{A=S,Yt=61;break}}while(!1);if((Yt|0)==61){if((A|0)==0&(f|0)==0){if(f=2<<F,f=(f|0-f)&b,!f){ht=U;break}ht=(f&0-f)+-1|0,P=ht>>>12&16,ht=ht>>>P,S=ht>>>5&8,ht=ht>>>S,R=ht>>>2&4,ht=ht>>>R,F=ht>>>1&2,ht=ht>>>F,A=ht>>>1&1,f=0,A=d[28212+((S|P|R|F|A)+(ht>>>A)<<2)>>2]|0}A?Yt=65:(R=f,P=E)}if((Yt|0)==65)for(S=A;;)if(ht=(d[S+4>>2]&-8)-U|0,A=ht>>>0<E>>>0,E=A?ht:E,f=A?S:f,A=d[S+16>>2]|0,A||(A=d[S+20>>2]|0),A)S=A;else{R=f,P=E;break}if((R|0)!=0&&P>>>0<((d[6979]|0)-U|0)>>>0&&(W=R+U|0,W>>>0>R>>>0)){S=d[R+24>>2]|0,h=d[R+12>>2]|0;do if((h|0)==(R|0)){if(f=R+20|0,h=d[f>>2]|0,!h&&(f=R+16|0,h=d[f>>2]|0,!h)){h=0;break}for(;;)if(E=h+20|0,A=d[E>>2]|0,A)h=A,f=E;else if(E=h+16|0,A=d[E>>2]|0,A)h=A,f=E;else break;d[f>>2]=0}else qt=d[R+8>>2]|0,d[qt+12>>2]=h,d[h+8>>2]=qt;while(!1);do if(S){if(f=d[R+28>>2]|0,A=28212+(f<<2)|0,(R|0)==(d[A>>2]|0)){if(d[A>>2]=h,!h){b=b&~(1<<f),d[6978]=b;break}}else if(qt=S+16|0,d[((d[qt>>2]|0)==(R|0)?qt:S+20|0)>>2]=h,!h)break;d[h+24>>2]=S,f=d[R+16>>2]|0,f|0&&(d[h+16>>2]=f,d[f+24>>2]=h),f=d[R+20>>2]|0,f&&(d[h+20>>2]=f,d[f+24>>2]=h)}while(!1);t:do if(P>>>0<16)qt=P+U|0,d[R+4>>2]=qt|3,qt=R+qt+4|0,d[qt>>2]=d[qt>>2]|1;else{if(d[R+4>>2]=U|3,d[W+4>>2]=P|1,d[W+P>>2]=P,h=P>>>3,P>>>0<256){A=27948+(h<<1<<2)|0,f=d[6977]|0,h=1<<h,f&h?(f=A+8|0,h=d[f>>2]|0):(d[6977]=f|h,h=A,f=A+8|0),d[f>>2]=W,d[h+12>>2]=W,d[W+8>>2]=h,d[W+12>>2]=A;break}if(h=P>>>8,h?P>>>0>16777215?A=31:(Jt=(h+1048320|0)>>>16&8,qt=h<<Jt,te=(qt+520192|0)>>>16&4,qt=qt<<te,A=(qt+245760|0)>>>16&2,A=14-(te|Jt|A)+(qt<<A>>>15)|0,A=P>>>(A+7|0)&1|A<<1):A=0,h=28212+(A<<2)|0,d[W+28>>2]=A,f=W+16|0,d[f+4>>2]=0,d[f>>2]=0,f=1<<A,!(b&f)){d[6978]=b|f,d[h>>2]=W,d[W+24>>2]=h,d[W+12>>2]=W,d[W+8>>2]=W;break}h=d[h>>2]|0;e:do if((d[h+4>>2]&-8|0)!=(P|0)){for(b=P<<((A|0)==31?0:25-(A>>>1)|0);A=h+16+(b>>>31<<2)|0,f=d[A>>2]|0,!!f;)if((d[f+4>>2]&-8|0)==(P|0)){h=f;break e}else b=b<<1,h=f;d[A>>2]=W,d[W+24>>2]=h,d[W+12>>2]=W,d[W+8>>2]=W;break t}while(!1);Jt=h+8|0,qt=d[Jt>>2]|0,d[qt+12>>2]=W,d[Jt>>2]=W,d[W+8>>2]=qt,d[W+12>>2]=h,d[W+24>>2]=0}while(!1);return qt=R+8|0,gt=Be,qt|0}else ht=U}else ht=U;else ht=-1;while(!1);if(A=d[6979]|0,A>>>0>=ht>>>0)return h=A-ht|0,f=d[6982]|0,h>>>0>15?(qt=f+ht|0,d[6982]=qt,d[6979]=h,d[qt+4>>2]=h|1,d[f+A>>2]=h,d[f+4>>2]=ht|3):(d[6979]=0,d[6982]=0,d[f+4>>2]=A|3,qt=f+A+4|0,d[qt>>2]=d[qt>>2]|1),qt=f+8|0,gt=Be,qt|0;if(P=d[6980]|0,P>>>0>ht>>>0)return te=P-ht|0,d[6980]=te,qt=d[6983]|0,Jt=qt+ht|0,d[6983]=Jt,d[Jt+4>>2]=te|1,d[qt+4>>2]=ht|3,qt=qt+8|0,gt=Be,qt|0;if(d[7095]|0?f=d[7097]|0:(d[7097]=4096,d[7096]=4096,d[7098]=-1,d[7099]=-1,d[7100]=0,d[7088]=0,d[7095]=Pt&-16^1431655768,f=4096),R=ht+48|0,F=ht+47|0,S=f+F|0,E=0-f|0,U=S&E,U>>>0<=ht>>>0||(f=d[7087]|0,f|0&&(W=d[7085]|0,Pt=W+U|0,Pt>>>0<=W>>>0|Pt>>>0>f>>>0)))return qt=0,gt=Be,qt|0;t:do if(d[7088]&4)h=0,Yt=143;else{A=d[6983]|0;e:do if(A){for(b=28356;Pt=d[b>>2]|0,!(Pt>>>0<=A>>>0&&(Pt+(d[b+4>>2]|0)|0)>>>0>A>>>0);)if(f=d[b+8>>2]|0,f)b=f;else{Yt=128;break e}if(h=S-P&E,h>>>0<2147483647)if(f=zt(h|0)|0,(f|0)==((d[b>>2]|0)+(d[b+4>>2]|0)|0)){if((f|0)!=-1){P=h,S=f,Yt=145;break t}}else b=f,Yt=136;else h=0}else Yt=128;while(!1);do if((Yt|0)==128)if(A=zt(0)|0,(A|0)!=-1&&(h=A,It=d[7096]|0,Mt=It+-1|0,h=((Mt&h|0)==0?0:(Mt+h&0-It)-h|0)+U|0,It=d[7085]|0,Mt=h+It|0,h>>>0>ht>>>0&h>>>0<2147483647)){if(Pt=d[7087]|0,Pt|0&&Mt>>>0<=It>>>0|Mt>>>0>Pt>>>0){h=0;break}if(f=zt(h|0)|0,(f|0)==(A|0)){P=h,S=A,Yt=145;break t}else b=f,Yt=136}else h=0;while(!1);do if((Yt|0)==136){if(A=0-h|0,!(R>>>0>h>>>0&(h>>>0<2147483647&(b|0)!=-1)))if((b|0)==-1){h=0;break}else{P=h,S=b,Yt=145;break t}if(f=d[7097]|0,f=F-h+f&0-f,f>>>0>=2147483647){P=h,S=b,Yt=145;break t}if((zt(f|0)|0)==-1){zt(A|0)|0,h=0;break}else{P=f+h|0,S=b,Yt=145;break t}}while(!1);d[7088]=d[7088]|4,Yt=143}while(!1);if((Yt|0)==143&&U>>>0<2147483647&&(te=zt(U|0)|0,Mt=zt(0)|0,Ht=Mt-te|0,ie=Ht>>>0>(ht+40|0)>>>0,!((te|0)==-1|ie^1|te>>>0<Mt>>>0&((te|0)!=-1&(Mt|0)!=-1)^1))&&(P=ie?Ht:h,S=te,Yt=145),(Yt|0)==145){h=(d[7085]|0)+P|0,d[7085]=h,h>>>0>(d[7086]|0)>>>0&&(d[7086]=h),F=d[6983]|0;t:do if(F){for(h=28356;;){if(f=d[h>>2]|0,A=d[h+4>>2]|0,(S|0)==(f+A|0)){Yt=154;break}if(b=d[h+8>>2]|0,b)h=b;else break}if((Yt|0)==154&&(Jt=h+4|0,(d[h+12>>2]&8|0)==0)&&S>>>0>F>>>0&f>>>0<=F>>>0){d[Jt>>2]=A+P,qt=(d[6980]|0)+P|0,te=F+8|0,te=(te&7|0)==0?0:0-te&7,Jt=F+te|0,te=qt-te|0,d[6983]=Jt,d[6980]=te,d[Jt+4>>2]=te|1,d[F+qt+4>>2]=40,d[6984]=d[7099];break}for(S>>>0<(d[6981]|0)>>>0&&(d[6981]=S),A=S+P|0,h=28356;;){if((d[h>>2]|0)==(A|0)){Yt=162;break}if(f=d[h+8>>2]|0,f)h=f;else break}if((Yt|0)==162&&(d[h+12>>2]&8|0)==0){d[h>>2]=S,W=h+4|0,d[W>>2]=(d[W>>2]|0)+P,W=S+8|0,W=S+((W&7|0)==0?0:0-W&7)|0,h=A+8|0,h=A+((h&7|0)==0?0:0-h&7)|0,U=W+ht|0,R=h-W-ht|0,d[W+4>>2]=ht|3;e:do if((F|0)==(h|0))qt=(d[6980]|0)+R|0,d[6980]=qt,d[6983]=U,d[U+4>>2]=qt|1;else{if((d[6982]|0)==(h|0)){qt=(d[6979]|0)+R|0,d[6979]=qt,d[6982]=U,d[U+4>>2]=qt|1,d[U+qt>>2]=qt;break}if(f=d[h+4>>2]|0,(f&3|0)==1){P=f&-8,b=f>>>3;i:do if(f>>>0<256)if(f=d[h+8>>2]|0,A=d[h+12>>2]|0,(A|0)==(f|0)){d[6977]=d[6977]&~(1<<b);break}else{d[f+12>>2]=A,d[A+8>>2]=f;break}else{S=d[h+24>>2]|0,f=d[h+12>>2]|0;do if((f|0)==(h|0)){if(A=h+16|0,b=A+4|0,f=d[b>>2]|0,f)A=b;else if(f=d[A>>2]|0,!f){f=0;break}for(;;)if(E=f+20|0,b=d[E>>2]|0,b)f=b,A=E;else if(E=f+16|0,b=d[E>>2]|0,b)f=b,A=E;else break;d[A>>2]=0}else qt=d[h+8>>2]|0,d[qt+12>>2]=f,d[f+8>>2]=qt;while(!1);if(!S)break;A=d[h+28>>2]|0,b=28212+(A<<2)|0;do if((d[b>>2]|0)!=(h|0)){if(qt=S+16|0,d[((d[qt>>2]|0)==(h|0)?qt:S+20|0)>>2]=f,!f)break i}else{if(d[b>>2]=f,f|0)break;d[6978]=d[6978]&~(1<<A);break i}while(!1);if(d[f+24>>2]=S,A=h+16|0,b=d[A>>2]|0,b|0&&(d[f+16>>2]=b,d[b+24>>2]=f),A=d[A+4>>2]|0,!A)break;d[f+20>>2]=A,d[A+24>>2]=f}while(!1);h=h+P|0,E=P+R|0}else E=R;if(h=h+4|0,d[h>>2]=d[h>>2]&-2,d[U+4>>2]=E|1,d[U+E>>2]=E,h=E>>>3,E>>>0<256){A=27948+(h<<1<<2)|0,f=d[6977]|0,h=1<<h,f&h?(f=A+8|0,h=d[f>>2]|0):(d[6977]=f|h,h=A,f=A+8|0),d[f>>2]=U,d[h+12>>2]=U,d[U+8>>2]=h,d[U+12>>2]=A;break}h=E>>>8;do if(!h)b=0;else{if(E>>>0>16777215){b=31;break}Jt=(h+1048320|0)>>>16&8,qt=h<<Jt,te=(qt+520192|0)>>>16&4,qt=qt<<te,b=(qt+245760|0)>>>16&2,b=14-(te|Jt|b)+(qt<<b>>>15)|0,b=E>>>(b+7|0)&1|b<<1}while(!1);if(h=28212+(b<<2)|0,d[U+28>>2]=b,f=U+16|0,d[f+4>>2]=0,d[f>>2]=0,f=d[6978]|0,A=1<<b,!(f&A)){d[6978]=f|A,d[h>>2]=U,d[U+24>>2]=h,d[U+12>>2]=U,d[U+8>>2]=U;break}h=d[h>>2]|0;i:do if((d[h+4>>2]&-8|0)!=(E|0)){for(b=E<<((b|0)==31?0:25-(b>>>1)|0);A=h+16+(b>>>31<<2)|0,f=d[A>>2]|0,!!f;)if((d[f+4>>2]&-8|0)==(E|0)){h=f;break i}else b=b<<1,h=f;d[A>>2]=U,d[U+24>>2]=h,d[U+12>>2]=U,d[U+8>>2]=U;break e}while(!1);Jt=h+8|0,qt=d[Jt>>2]|0,d[qt+12>>2]=U,d[Jt>>2]=U,d[U+8>>2]=qt,d[U+12>>2]=h,d[U+24>>2]=0}while(!1);return qt=W+8|0,gt=Be,qt|0}for(h=28356;f=d[h>>2]|0,!(f>>>0<=F>>>0&&(qt=f+(d[h+4>>2]|0)|0,qt>>>0>F>>>0));)h=d[h+8>>2]|0;E=qt+-47|0,f=E+8|0,f=E+((f&7|0)==0?0:0-f&7)|0,E=F+16|0,f=f>>>0<E>>>0?F:f,h=f+8|0,A=P+-40|0,te=S+8|0,te=(te&7|0)==0?0:0-te&7,Jt=S+te|0,te=A-te|0,d[6983]=Jt,d[6980]=te,d[Jt+4>>2]=te|1,d[S+A+4>>2]=40,d[6984]=d[7099],A=f+4|0,d[A>>2]=27,d[h>>2]=d[7089],d[h+4>>2]=d[7090],d[h+8>>2]=d[7091],d[h+12>>2]=d[7092],d[7089]=S,d[7090]=P,d[7092]=0,d[7091]=h,h=f+24|0;do Jt=h,h=h+4|0,d[h>>2]=7;while((Jt+8|0)>>>0<qt>>>0);if((f|0)!=(F|0)){if(S=f-F|0,d[A>>2]=d[A>>2]&-2,d[F+4>>2]=S|1,d[f>>2]=S,h=S>>>3,S>>>0<256){A=27948+(h<<1<<2)|0,f=d[6977]|0,h=1<<h,f&h?(f=A+8|0,h=d[f>>2]|0):(d[6977]=f|h,h=A,f=A+8|0),d[f>>2]=F,d[h+12>>2]=F,d[F+8>>2]=h,d[F+12>>2]=A;break}if(h=S>>>8,h?S>>>0>16777215?b=31:(Jt=(h+1048320|0)>>>16&8,qt=h<<Jt,te=(qt+520192|0)>>>16&4,qt=qt<<te,b=(qt+245760|0)>>>16&2,b=14-(te|Jt|b)+(qt<<b>>>15)|0,b=S>>>(b+7|0)&1|b<<1):b=0,A=28212+(b<<2)|0,d[F+28>>2]=b,d[F+20>>2]=0,d[E>>2]=0,h=d[6978]|0,f=1<<b,!(h&f)){d[6978]=h|f,d[A>>2]=F,d[F+24>>2]=A,d[F+12>>2]=F,d[F+8>>2]=F;break}h=d[A>>2]|0;e:do if((d[h+4>>2]&-8|0)!=(S|0)){for(b=S<<((b|0)==31?0:25-(b>>>1)|0);A=h+16+(b>>>31<<2)|0,f=d[A>>2]|0,!!f;)if((d[f+4>>2]&-8|0)==(S|0)){h=f;break e}else b=b<<1,h=f;d[A>>2]=F,d[F+24>>2]=h,d[F+12>>2]=F,d[F+8>>2]=F;break t}while(!1);Jt=h+8|0,qt=d[Jt>>2]|0,d[qt+12>>2]=F,d[Jt>>2]=F,d[F+8>>2]=qt,d[F+12>>2]=h,d[F+24>>2]=0}}else qt=d[6981]|0,(qt|0)==0|S>>>0<qt>>>0&&(d[6981]=S),d[7089]=S,d[7090]=P,d[7092]=0,d[6986]=d[7095],d[6985]=-1,d[6990]=27948,d[6989]=27948,d[6992]=27956,d[6991]=27956,d[6994]=27964,d[6993]=27964,d[6996]=27972,d[6995]=27972,d[6998]=27980,d[6997]=27980,d[7e3]=27988,d[6999]=27988,d[7002]=27996,d[7001]=27996,d[7004]=28004,d[7003]=28004,d[7006]=28012,d[7005]=28012,d[7008]=28020,d[7007]=28020,d[7010]=28028,d[7009]=28028,d[7012]=28036,d[7011]=28036,d[7014]=28044,d[7013]=28044,d[7016]=28052,d[7015]=28052,d[7018]=28060,d[7017]=28060,d[7020]=28068,d[7019]=28068,d[7022]=28076,d[7021]=28076,d[7024]=28084,d[7023]=28084,d[7026]=28092,d[7025]=28092,d[7028]=28100,d[7027]=28100,d[7030]=28108,d[7029]=28108,d[7032]=28116,d[7031]=28116,d[7034]=28124,d[7033]=28124,d[7036]=28132,d[7035]=28132,d[7038]=28140,d[7037]=28140,d[7040]=28148,d[7039]=28148,d[7042]=28156,d[7041]=28156,d[7044]=28164,d[7043]=28164,d[7046]=28172,d[7045]=28172,d[7048]=28180,d[7047]=28180,d[7050]=28188,d[7049]=28188,d[7052]=28196,d[7051]=28196,qt=P+-40|0,te=S+8|0,te=(te&7|0)==0?0:0-te&7,Jt=S+te|0,te=qt-te|0,d[6983]=Jt,d[6980]=te,d[Jt+4>>2]=te|1,d[S+qt+4>>2]=40,d[6984]=d[7099];while(!1);if(h=d[6980]|0,h>>>0>ht>>>0)return te=h-ht|0,d[6980]=te,qt=d[6983]|0,Jt=qt+ht|0,d[6983]=Jt,d[Jt+4>>2]=te|1,d[qt+4>>2]=ht|3,qt=qt+8|0,gt=Be,qt|0}return qt=bh()|0,d[qt>>2]=12,qt=0,gt=Be,qt|0}function Fi(f){f=f|0;var h=0,A=0,b=0,E=0,S=0,P=0,R=0,F=0;if(f){A=f+-8|0,E=d[6981]|0,f=d[f+-4>>2]|0,h=f&-8,F=A+h|0;do if(f&1)R=A,P=A;else{if(b=d[A>>2]|0,!(f&3)||(P=A+(0-b)|0,S=b+h|0,P>>>0<E>>>0))return;if((d[6982]|0)==(P|0)){if(f=F+4|0,h=d[f>>2]|0,(h&3|0)!=3){R=P,h=S;break}d[6979]=S,d[f>>2]=h&-2,d[P+4>>2]=S|1,d[P+S>>2]=S;return}if(A=b>>>3,b>>>0<256)if(f=d[P+8>>2]|0,h=d[P+12>>2]|0,(h|0)==(f|0)){d[6977]=d[6977]&~(1<<A),R=P,h=S;break}else{d[f+12>>2]=h,d[h+8>>2]=f,R=P,h=S;break}E=d[P+24>>2]|0,f=d[P+12>>2]|0;do if((f|0)==(P|0)){if(h=P+16|0,A=h+4|0,f=d[A>>2]|0,f)h=A;else if(f=d[h>>2]|0,!f){f=0;break}for(;;)if(b=f+20|0,A=d[b>>2]|0,A)f=A,h=b;else if(b=f+16|0,A=d[b>>2]|0,A)f=A,h=b;else break;d[h>>2]=0}else R=d[P+8>>2]|0,d[R+12>>2]=f,d[f+8>>2]=R;while(!1);if(E){if(h=d[P+28>>2]|0,A=28212+(h<<2)|0,(d[A>>2]|0)==(P|0)){if(d[A>>2]=f,!f){d[6978]=d[6978]&~(1<<h),R=P,h=S;break}}else if(R=E+16|0,d[((d[R>>2]|0)==(P|0)?R:E+20|0)>>2]=f,!f){R=P,h=S;break}d[f+24>>2]=E,h=P+16|0,A=d[h>>2]|0,A|0&&(d[f+16>>2]=A,d[A+24>>2]=f),h=d[h+4>>2]|0,h?(d[f+20>>2]=h,d[h+24>>2]=f,R=P,h=S):(R=P,h=S)}else R=P,h=S}while(!1);if(!(P>>>0>=F>>>0)&&(f=F+4|0,b=d[f>>2]|0,!!(b&1))){if(b&2)d[f>>2]=b&-2,d[R+4>>2]=h|1,d[P+h>>2]=h,E=h;else{if((d[6983]|0)==(F|0)){if(F=(d[6980]|0)+h|0,d[6980]=F,d[6983]=R,d[R+4>>2]=F|1,(R|0)!=(d[6982]|0))return;d[6982]=0,d[6979]=0;return}if((d[6982]|0)==(F|0)){F=(d[6979]|0)+h|0,d[6979]=F,d[6982]=P,d[R+4>>2]=F|1,d[P+F>>2]=F;return}E=(b&-8)+h|0,A=b>>>3;do if(b>>>0<256)if(h=d[F+8>>2]|0,f=d[F+12>>2]|0,(f|0)==(h|0)){d[6977]=d[6977]&~(1<<A);break}else{d[h+12>>2]=f,d[f+8>>2]=h;break}else{S=d[F+24>>2]|0,f=d[F+12>>2]|0;do if((f|0)==(F|0)){if(h=F+16|0,A=h+4|0,f=d[A>>2]|0,f)h=A;else if(f=d[h>>2]|0,!f){A=0;break}for(;;)if(b=f+20|0,A=d[b>>2]|0,A)f=A,h=b;else if(b=f+16|0,A=d[b>>2]|0,A)f=A,h=b;else break;d[h>>2]=0,A=f}else A=d[F+8>>2]|0,d[A+12>>2]=f,d[f+8>>2]=A,A=f;while(!1);if(S|0){if(f=d[F+28>>2]|0,h=28212+(f<<2)|0,(d[h>>2]|0)==(F|0)){if(d[h>>2]=A,!A){d[6978]=d[6978]&~(1<<f);break}}else if(b=S+16|0,d[((d[b>>2]|0)==(F|0)?b:S+20|0)>>2]=A,!A)break;d[A+24>>2]=S,f=F+16|0,h=d[f>>2]|0,h|0&&(d[A+16>>2]=h,d[h+24>>2]=A),f=d[f+4>>2]|0,f|0&&(d[A+20>>2]=f,d[f+24>>2]=A)}}while(!1);if(d[R+4>>2]=E|1,d[P+E>>2]=E,(R|0)==(d[6982]|0)){d[6979]=E;return}}if(f=E>>>3,E>>>0<256){A=27948+(f<<1<<2)|0,h=d[6977]|0,f=1<<f,h&f?(h=A+8|0,f=d[h>>2]|0):(d[6977]=h|f,f=A,h=A+8|0),d[h>>2]=R,d[f+12>>2]=R,d[R+8>>2]=f,d[R+12>>2]=A;return}f=E>>>8,f?E>>>0>16777215?b=31:(P=(f+1048320|0)>>>16&8,F=f<<P,S=(F+520192|0)>>>16&4,F=F<<S,b=(F+245760|0)>>>16&2,b=14-(S|P|b)+(F<<b>>>15)|0,b=E>>>(b+7|0)&1|b<<1):b=0,f=28212+(b<<2)|0,d[R+28>>2]=b,d[R+20>>2]=0,d[R+16>>2]=0,h=d[6978]|0,A=1<<b;t:do if(!(h&A))d[6978]=h|A,d[f>>2]=R,d[R+24>>2]=f,d[R+12>>2]=R,d[R+8>>2]=R;else{f=d[f>>2]|0;e:do if((d[f+4>>2]&-8|0)!=(E|0)){for(b=E<<((b|0)==31?0:25-(b>>>1)|0);A=f+16+(b>>>31<<2)|0,h=d[A>>2]|0,!!h;)if((d[h+4>>2]&-8|0)==(E|0)){f=h;break e}else b=b<<1,f=h;d[A>>2]=R,d[R+24>>2]=f,d[R+12>>2]=R,d[R+8>>2]=R;break t}while(!1);P=f+8|0,F=d[P>>2]|0,d[F+12>>2]=R,d[P>>2]=R,d[R+8>>2]=F,d[R+12>>2]=f,d[R+24>>2]=0}while(!1);if(F=(d[6985]|0)+-1|0,d[6985]=F,!(F|0)){for(f=28364;f=d[f>>2]|0,f;)f=f+8|0;d[6985]=-1}}}}function Pr(f,h){f=f|0,h=h|0;var A=0;return f?(A=Ji(h,f)|0,(h|f)>>>0>65535&&(A=((A>>>0)/(f>>>0)|0|0)==(h|0)?A:-1)):A=0,f=ss(A)|0,!f||!(d[f+-4>>2]&3)||Bt(f|0,0,A|0)|0,f|0}function Ei(f,h,A,b){return f=f|0,h=h|0,A=A|0,b=b|0,A=f+A>>>0,mi(h+b+(A>>>0<f>>>0|0)>>>0|0),A|0|0}function Ur(f,h,A,b){return f=f|0,h=h|0,A=A|0,b=b|0,b=h-b-(A>>>0>f>>>0|0)>>>0,mi(b|0),f-A>>>0|0|0}function Ul(f){return f=f|0,(f?31-(Qi(f^f-1)|0)|0:32)|0}function Iu(f,h,A,b,E){f=f|0,h=h|0,A=A|0,b=b|0,E=E|0;var S=0,P=0,R=0,F=0,U=0,W=0,ht=0,Pt=0,It=0,Mt=0;if(W=f,F=h,U=F,P=A,Pt=b,R=Pt,!U)return S=(E|0)!=0,R?S?(d[E>>2]=f|0,d[E+4>>2]=h&0,Pt=0,E=0,mi(Pt|0),E|0):(Pt=0,E=0,mi(Pt|0),E|0):(S&&(d[E>>2]=(W>>>0)%(P>>>0),d[E+4>>2]=0),Pt=0,E=(W>>>0)/(P>>>0)>>>0,mi(Pt|0),E|0);S=(R|0)==0;do if(P){if(!S){if(S=(Qi(R|0)|0)-(Qi(U|0)|0)|0,S>>>0<=31){ht=S+1|0,R=31-S|0,h=S-31>>31,P=ht,f=W>>>(ht>>>0)&h|U<<R,h=U>>>(ht>>>0)&h,S=0,R=W<<R;break}return E?(d[E>>2]=f|0,d[E+4>>2]=F|h&0,Pt=0,E=0,mi(Pt|0),E|0):(Pt=0,E=0,mi(Pt|0),E|0)}if(S=P-1|0,S&P|0){R=(Qi(P|0)|0)+33-(Qi(U|0)|0)|0,Mt=64-R|0,ht=32-R|0,F=ht>>31,It=R-32|0,h=It>>31,P=R,f=ht-1>>31&U>>>(It>>>0)|(U<<ht|W>>>(R>>>0))&h,h=h&U>>>(R>>>0),S=W<<Mt&F,R=(U<<Mt|W>>>(It>>>0))&F|W<<ht&R-33>>31;break}return E|0&&(d[E>>2]=S&W,d[E+4>>2]=0),(P|0)==1?(It=F|h&0,Mt=f|0|0,mi(It|0),Mt|0):(Mt=Ul(P|0)|0,It=U>>>(Mt>>>0)|0,Mt=U<<32-Mt|W>>>(Mt>>>0)|0,mi(It|0),Mt|0)}else{if(S)return E|0&&(d[E>>2]=(U>>>0)%(P>>>0),d[E+4>>2]=0),It=0,Mt=(U>>>0)/(P>>>0)>>>0,mi(It|0),Mt|0;if(!W)return E|0&&(d[E>>2]=0,d[E+4>>2]=(U>>>0)%(R>>>0)),It=0,Mt=(U>>>0)/(R>>>0)>>>0,mi(It|0),Mt|0;if(S=R-1|0,!(S&R))return E|0&&(d[E>>2]=f|0,d[E+4>>2]=S&U|h&0),It=0,Mt=U>>>((Ul(R|0)|0)>>>0),mi(It|0),Mt|0;if(S=(Qi(R|0)|0)-(Qi(U|0)|0)|0,S>>>0<=30){h=S+1|0,R=31-S|0,P=h,f=U<<R|W>>>(h>>>0),h=U>>>(h>>>0),S=0,R=W<<R;break}return E?(d[E>>2]=f|0,d[E+4>>2]=F|h&0,It=0,Mt=0,mi(It|0),Mt|0):(It=0,Mt=0,mi(It|0),Mt|0)}while(!1);if(!P)U=R,F=0,R=0;else{ht=A|0|0,W=Pt|b&0,U=Ei(ht|0,W|0,-1,-1)|0,A=_t()|0,F=R,R=0;do b=F,F=S>>>31|F<<1,S=R|S<<1,b=f<<1|b>>>31|0,Pt=f>>>31|h<<1|0,Ur(U|0,A|0,b|0,Pt|0)|0,Mt=_t()|0,It=Mt>>31|((Mt|0)<0?-1:0)<<1,R=It&1,f=Ur(b|0,Pt|0,It&ht|0,(((Mt|0)<0?-1:0)>>31|((Mt|0)<0?-1:0)<<1)&W|0)|0,h=_t()|0,P=P-1|0;while((P|0)!=0);U=F,F=0}return P=0,E|0&&(d[E>>2]=f,d[E+4>>2]=h),It=(S|0)>>>31|(U|P)<<1|(P<<1|S>>>31)&0|F,Mt=(S<<1|0)&-2|R,mi(It|0),Mt|0}function Mo(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0;return U=h>>31|((h|0)<0?-1:0)<<1,F=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,S=b>>31|((b|0)<0?-1:0)<<1,E=((b|0)<0?-1:0)>>31|((b|0)<0?-1:0)<<1,R=Ur(U^f|0,F^h|0,U|0,F|0)|0,P=_t()|0,f=S^U,h=E^F,Ur((Iu(R,P,Ur(S^A|0,E^b|0,S|0,E|0)|0,_t()|0,0)|0)^f|0,(_t()|0)^h|0,f|0,h|0)|0}function m(f,h){f=f|0,h=h|0;var A=0,b=0,E=0,S=0;return S=f&65535,E=h&65535,A=Ji(E,S)|0,b=f>>>16,f=(A>>>16)+(Ji(E,b)|0)|0,E=h>>>16,h=Ji(E,S)|0,mi((f>>>16)+(Ji(E,b)|0)+(((f&65535)+h|0)>>>16)|0),f+h<<16|A&65535|0|0}function v(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0;return E=f,S=A,A=m(E,S)|0,f=_t()|0,mi((Ji(h,S)|0)+(Ji(b,E)|0)+f|f&0|0),A|0|0|0}function g(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0,P=0,R=0,F=0,U=0;return E=gt,gt=gt+16|0,R=E|0,P=h>>31|((h|0)<0?-1:0)<<1,S=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,U=b>>31|((b|0)<0?-1:0)<<1,F=((b|0)<0?-1:0)>>31|((b|0)<0?-1:0)<<1,f=Ur(P^f|0,S^h|0,P|0,S|0)|0,h=_t()|0,Iu(f,h,Ur(U^A|0,F^b|0,U|0,F|0)|0,_t()|0,R)|0,b=Ur(d[R>>2]^P|0,d[R+4>>2]^S|0,P|0,S|0)|0,A=_t()|0,gt=E,mi(A|0),b|0}function w(f,h,A,b){f=f|0,h=h|0,A=A|0,b=b|0;var E=0,S=0;return S=gt,gt=gt+16|0,E=S|0,Iu(f,h,A,b,E)|0,gt=S,mi(d[E+4>>2]|0),d[E>>2]|0|0}function B(f,h,A){return f=f|0,h=h|0,A=A|0,(A|0)<32?(mi(h>>A|0),f>>>A|(h&(1<<A)-1)<<32-A):(mi(((h|0)<0?-1:0)|0),h>>A-32|0)}function D(f,h,A){return f=f|0,h=h|0,A=A|0,(A|0)<32?(mi(h>>>A|0),f>>>A|(h&(1<<A)-1)<<32-A):(mi(0),h>>>A-32|0)}function O(f,h,A){return f=f|0,h=h|0,A=A|0,(A|0)<32?(mi(h<<A|(f&(1<<A)-1<<32-A)>>>32-A|0),f<<A):(mi(f<<A-32|0),0)}function G(f,h,A){return f=f|0,h=h|0,h=Qi(h)|0,(h|0)==32&&(h=h+(Qi(f)|0)|0),mi(0),h|0}function J(f,h){return f=+f,h=+h,f!=f?+h:h!=h?+f:+mr(+f,+h)}function at(f,h){return f=+f,h=+h,f!=f?+h:h!=h?+f:+Hi(+f,+h)}function Et(f){return f=+f,f>=0?+Ie(f+.5):+Yi(f-.5)}function Ct(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0;if((A|0)>=8192)return ga(f|0,h|0,A|0)|0,f|0;if(S=f|0,E=f+A|0,(f&3)==(h&3)){for(;f&3;){if(!A)return S|0;pt[f>>0]=pt[h>>0]|0,f=f+1|0,h=h+1|0,A=A-1|0}for(A=E&-4|0,b=A-64|0;(f|0)<=(b|0);)d[f>>2]=d[h>>2],d[f+4>>2]=d[h+4>>2],d[f+8>>2]=d[h+8>>2],d[f+12>>2]=d[h+12>>2],d[f+16>>2]=d[h+16>>2],d[f+20>>2]=d[h+20>>2],d[f+24>>2]=d[h+24>>2],d[f+28>>2]=d[h+28>>2],d[f+32>>2]=d[h+32>>2],d[f+36>>2]=d[h+36>>2],d[f+40>>2]=d[h+40>>2],d[f+44>>2]=d[h+44>>2],d[f+48>>2]=d[h+48>>2],d[f+52>>2]=d[h+52>>2],d[f+56>>2]=d[h+56>>2],d[f+60>>2]=d[h+60>>2],f=f+64|0,h=h+64|0;for(;(f|0)<(A|0);)d[f>>2]=d[h>>2],f=f+4|0,h=h+4|0}else for(A=E-4|0;(f|0)<(A|0);)pt[f>>0]=pt[h>>0]|0,pt[f+1>>0]=pt[h+1>>0]|0,pt[f+2>>0]=pt[h+2>>0]|0,pt[f+3>>0]=pt[h+3>>0]|0,f=f+4|0,h=h+4|0;for(;(f|0)<(E|0);)pt[f>>0]=pt[h>>0]|0,f=f+1|0,h=h+1|0;return S|0}function Bt(f,h,A){f=f|0,h=h|0,A=A|0;var b=0,E=0,S=0,P=0;if(S=f+A|0,h=h&255,(A|0)>=67){for(;f&3;)pt[f>>0]=h,f=f+1|0;for(b=S&-4|0,P=h|h<<8|h<<16|h<<24,E=b-64|0;(f|0)<=(E|0);)d[f>>2]=P,d[f+4>>2]=P,d[f+8>>2]=P,d[f+12>>2]=P,d[f+16>>2]=P,d[f+20>>2]=P,d[f+24>>2]=P,d[f+28>>2]=P,d[f+32>>2]=P,d[f+36>>2]=P,d[f+40>>2]=P,d[f+44>>2]=P,d[f+48>>2]=P,d[f+52>>2]=P,d[f+56>>2]=P,d[f+60>>2]=P,f=f+64|0;for(;(f|0)<(b|0);)d[f>>2]=P,f=f+4|0}for(;(f|0)<(S|0);)pt[f>>0]=h,f=f+1|0;return S-A|0}function Wt(f){return f=+f,f>=0?+Ie(f+.5):+Yi(f-.5)}function zt(f){f=f|0;var h=0,A=0,b=0;return b=Wr()|0,A=d[ne>>2]|0,h=A+f|0,(f|0)>0&(h|0)<(A|0)|(h|0)<0?(Kn(h|0)|0,sn(12),-1):(h|0)>(b|0)&&!(hr(h|0)|0)?(sn(12),-1):(d[ne>>2]=h,A|0)}return{___divdi3:Mo,___muldi3:v,___remdi3:g,___uremdi3:w,_areNeighborCells:If,_bitshift64Ashr:B,_bitshift64Lshr:D,_bitshift64Shl:O,_calloc:Pr,_cellAreaKm2:zf,_cellAreaM2:wr,_cellAreaRads2:Ya,_cellToBoundary:Za,_cellToCenterChild:Ka,_cellToChildPos:_u,_cellToChildren:mc,_cellToChildrenSize:Go,_cellToLatLng:wa,_cellToLocalIj:yh,_cellToParent:Il,_cellToVertex:Ns,_cellToVertexes:sa,_cellsToDirectedEdge:Mf,_cellsToLinkedMultiPolygon:Yn,_childPosToCell:Ff,_compactCells:kf,_destroyLinkedMultiPolygon:bs,_directedEdgeToBoundary:gu,_directedEdgeToCells:ba,_edgeLengthKm:Ds,_edgeLengthM:_c,_edgeLengthRads:ci,_emscripten_replace_memory:Qo,_free:Fi,_getBaseCellNumber:fh,_getDirectedEdgeDestination:Rf,_getDirectedEdgeOrigin:Bf,_getHexagonAreaAvgKm2:Nf,_getHexagonAreaAvgM2:Wp,_getHexagonEdgeLengthAvgKm:wu,_getHexagonEdgeLengthAvgM:Eu,_getIcosahedronFaces:vc,_getNumCells:ao,_getPentagons:vu,_getRes0Cells:oo,_getResolution:Pl,_greatCircleDistanceKm:ns,_greatCircleDistanceM:bu,_greatCircleDistanceRads:Un,_gridDisk:Fn,_gridDiskDistances:gs,_gridDistance:ks,_gridPathCells:xc,_gridPathCellsSize:bc,_gridRing:ah,_gridRingUnsafe:yt,_i64Add:Ei,_i64Subtract:Ur,_isPentagon:Rn,_isResClassIII:Of,_isValidCell:dh,_isValidDirectedEdge:Wa,_isValidVertex:Fl,_latLngToCell:Ah,_llvm_ctlz_i64:G,_llvm_maxnum_f64:J,_llvm_minnum_f64:at,_llvm_round_f64:Et,_localIjToCell:lo,_malloc:ss,_maxFaceCount:yc,_maxGridDiskSize:Tr,_maxPolygonToCellsSize:Se,_maxPolygonToCellsSizeExperimental:Co,_memcpy:Ct,_memset:Bt,_originToDirectedEdges:Ha,_pentagonCount:mh,_polygonToCells:Xi,_polygonToCellsExperimental:vh,_readInt64AsDoubleFromPointer:Kr,_res0CellCount:uc,_round:Wt,_sbrk:zt,_sizeOfCellBoundary:Ii,_sizeOfCoordIJ:So,_sizeOfGeoLoop:pi,_sizeOfGeoPolygon:Ec,_sizeOfH3Index:us,_sizeOfLatLng:Tu,_sizeOfLinkedGeoPolygon:cs,_uncompactCells:Bl,_uncompactCellsSize:_o,_vertexToLatLng:zs,establishStackSpace:fr,stackAlloc:Zn,stackRestore:Lr,stackSave:Jo}})(vt,qe,Ut);t.___divdi3=Ce.___divdi3,t.___muldi3=Ce.___muldi3,t.___remdi3=Ce.___remdi3,t.___uremdi3=Ce.___uremdi3,t._areNeighborCells=Ce._areNeighborCells,t._bitshift64Ashr=Ce._bitshift64Ashr,t._bitshift64Lshr=Ce._bitshift64Lshr,t._bitshift64Shl=Ce._bitshift64Shl,t._calloc=Ce._calloc,t._cellAreaKm2=Ce._cellAreaKm2,t._cellAreaM2=Ce._cellAreaM2,t._cellAreaRads2=Ce._cellAreaRads2,t._cellToBoundary=Ce._cellToBoundary,t._cellToCenterChild=Ce._cellToCenterChild,t._cellToChildPos=Ce._cellToChildPos,t._cellToChildren=Ce._cellToChildren,t._cellToChildrenSize=Ce._cellToChildrenSize,t._cellToLatLng=Ce._cellToLatLng,t._cellToLocalIj=Ce._cellToLocalIj,t._cellToParent=Ce._cellToParent,t._cellToVertex=Ce._cellToVertex,t._cellToVertexes=Ce._cellToVertexes,t._cellsToDirectedEdge=Ce._cellsToDirectedEdge,t._cellsToLinkedMultiPolygon=Ce._cellsToLinkedMultiPolygon,t._childPosToCell=Ce._childPosToCell,t._compactCells=Ce._compactCells,t._destroyLinkedMultiPolygon=Ce._destroyLinkedMultiPolygon,t._directedEdgeToBoundary=Ce._directedEdgeToBoundary,t._directedEdgeToCells=Ce._directedEdgeToCells,t._edgeLengthKm=Ce._edgeLengthKm,t._edgeLengthM=Ce._edgeLengthM,t._edgeLengthRads=Ce._edgeLengthRads;var q=t._emscripten_replace_memory=Ce._emscripten_replace_memory;t._free=Ce._free,t._getBaseCellNumber=Ce._getBaseCellNumber,t._getDirectedEdgeDestination=Ce._getDirectedEdgeDestination,t._getDirectedEdgeOrigin=Ce._getDirectedEdgeOrigin,t._getHexagonAreaAvgKm2=Ce._getHexagonAreaAvgKm2,t._getHexagonAreaAvgM2=Ce._getHexagonAreaAvgM2,t._getHexagonEdgeLengthAvgKm=Ce._getHexagonEdgeLengthAvgKm,t._getHexagonEdgeLengthAvgM=Ce._getHexagonEdgeLengthAvgM,t._getIcosahedronFaces=Ce._getIcosahedronFaces,t._getNumCells=Ce._getNumCells,t._getPentagons=Ce._getPentagons,t._getRes0Cells=Ce._getRes0Cells,t._getResolution=Ce._getResolution,t._greatCircleDistanceKm=Ce._greatCircleDistanceKm,t._greatCircleDistanceM=Ce._greatCircleDistanceM,t._greatCircleDistanceRads=Ce._greatCircleDistanceRads,t._gridDisk=Ce._gridDisk,t._gridDiskDistances=Ce._gridDiskDistances,t._gridDistance=Ce._gridDistance,t._gridPathCells=Ce._gridPathCells,t._gridPathCellsSize=Ce._gridPathCellsSize,t._gridRing=Ce._gridRing,t._gridRingUnsafe=Ce._gridRingUnsafe,t._i64Add=Ce._i64Add,t._i64Subtract=Ce._i64Subtract,t._isPentagon=Ce._isPentagon,t._isResClassIII=Ce._isResClassIII,t._isValidCell=Ce._isValidCell,t._isValidDirectedEdge=Ce._isValidDirectedEdge,t._isValidVertex=Ce._isValidVertex,t._latLngToCell=Ce._latLngToCell,t._llvm_ctlz_i64=Ce._llvm_ctlz_i64,t._llvm_maxnum_f64=Ce._llvm_maxnum_f64,t._llvm_minnum_f64=Ce._llvm_minnum_f64,t._llvm_round_f64=Ce._llvm_round_f64,t._localIjToCell=Ce._localIjToCell,t._malloc=Ce._malloc,t._maxFaceCount=Ce._maxFaceCount,t._maxGridDiskSize=Ce._maxGridDiskSize,t._maxPolygonToCellsSize=Ce._maxPolygonToCellsSize,t._maxPolygonToCellsSizeExperimental=Ce._maxPolygonToCellsSizeExperimental,t._memcpy=Ce._memcpy,t._memset=Ce._memset,t._originToDirectedEdges=Ce._originToDirectedEdges,t._pentagonCount=Ce._pentagonCount,t._polygonToCells=Ce._polygonToCells,t._polygonToCellsExperimental=Ce._polygonToCellsExperimental,t._readInt64AsDoubleFromPointer=Ce._readInt64AsDoubleFromPointer,t._res0CellCount=Ce._res0CellCount,t._round=Ce._round,t._sbrk=Ce._sbrk,t._sizeOfCellBoundary=Ce._sizeOfCellBoundary,t._sizeOfCoordIJ=Ce._sizeOfCoordIJ,t._sizeOfGeoLoop=Ce._sizeOfGeoLoop,t._sizeOfGeoPolygon=Ce._sizeOfGeoPolygon,t._sizeOfH3Index=Ce._sizeOfH3Index,t._sizeOfLatLng=Ce._sizeOfLatLng,t._sizeOfLinkedGeoPolygon=Ce._sizeOfLinkedGeoPolygon,t._uncompactCells=Ce._uncompactCells,t._uncompactCellsSize=Ce._uncompactCellsSize,t._vertexToLatLng=Ce._vertexToLatLng,t.establishStackSpace=Ce.establishStackSpace;var Ee=t.stackAlloc=Ce.stackAlloc,Me=t.stackRestore=Ce.stackRestore,St=t.stackSave=Ce.stackSave;if(t.asm=Ce,t.cwrap=Y,t.setValue=k,t.getValue=z,xn){qn(xn)||(xn=o(xn));{cr();var ee=function(mt){mt.byteLength&&(mt=new Uint8Array(mt)),dt.set(mt,I),t.memoryInitializerRequest&&delete t.memoryInitializerRequest.response,tr()},Ae=function(){s(xn,ee,function(){throw"could not load memory initializer "+xn})},Q=Fe(xn);if(Q)ee(Q.buffer);else if(t.memoryInitializerRequest){var it=function(){var mt=t.memoryInitializerRequest,wt=mt.response;if(mt.status!==200&&mt.status!==0){var lt=Fe(t.memoryInitializerRequestURL);if(lt)wt=lt.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+mt.status+", retrying "+xn),Ae();return}}ee(wt)};t.memoryInitializerRequest.response?setTimeout(it,0):t.memoryInitializerRequest.addEventListener("load",it)}else Ae()}}var ut;zi=function mt(){ut||xt(),ut||(zi=mt)};function xt(mt){if(mn>0||(ei(),mn>0))return;function wt(){ut||(ut=!0,!V&&(ii(),Qe(),t.onRuntimeInitialized&&t.onRuntimeInitialized(),yi()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),wt()},1)):wt()}t.run=xt;function Nt(mt){throw t.onAbort&&t.onAbort(mt),mt+="",l(mt),c(mt),V=!0,"abort("+mt+"). Build with -s ASSERTIONS=1 for more info."}if(t.abort=Nt,t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return xt(),i})(typeof Ui=="object"?Ui:{}),An="number",en=An,bA=An,dn=An,pn=An,Ws=An,ki=An,jlt=[["sizeOfH3Index",An],["sizeOfLatLng",An],["sizeOfCellBoundary",An],["sizeOfGeoLoop",An],["sizeOfGeoPolygon",An],["sizeOfLinkedGeoPolygon",An],["sizeOfCoordIJ",An],["readInt64AsDoubleFromPointer",An],["isValidCell",bA,[dn,pn]],["latLngToCell",en,[An,An,Ws,ki]],["cellToLatLng",en,[dn,pn,ki]],["cellToBoundary",en,[dn,pn,ki]],["maxGridDiskSize",en,[An,ki]],["gridDisk",en,[dn,pn,An,ki]],["gridDiskDistances",en,[dn,pn,An,ki,ki]],["gridRing",en,[dn,pn,An,ki]],["gridRingUnsafe",en,[dn,pn,An,ki]],["maxPolygonToCellsSize",en,[ki,Ws,An,ki]],["polygonToCells",en,[ki,Ws,An,ki]],["maxPolygonToCellsSizeExperimental",en,[ki,Ws,An,ki]],["polygonToCellsExperimental",en,[ki,Ws,An,An,An,ki]],["cellsToLinkedMultiPolygon",en,[ki,An,ki]],["destroyLinkedMultiPolygon",null,[ki]],["compactCells",en,[ki,ki,An,An]],["uncompactCells",en,[ki,An,An,ki,An,Ws]],["uncompactCellsSize",en,[ki,An,An,Ws,ki]],["isPentagon",bA,[dn,pn]],["isResClassIII",bA,[dn,pn]],["getBaseCellNumber",An,[dn,pn]],["getResolution",An,[dn,pn]],["maxFaceCount",en,[dn,pn,ki]],["getIcosahedronFaces",en,[dn,pn,ki]],["cellToParent",en,[dn,pn,Ws,ki]],["cellToChildren",en,[dn,pn,Ws,ki]],["cellToCenterChild",en,[dn,pn,Ws,ki]],["cellToChildrenSize",en,[dn,pn,Ws,ki]],["cellToChildPos",en,[dn,pn,Ws,ki]],["childPosToCell",en,[An,An,dn,pn,Ws,ki]],["areNeighborCells",en,[dn,pn,dn,pn,ki]],["cellsToDirectedEdge",en,[dn,pn,dn,pn,ki]],["getDirectedEdgeOrigin",en,[dn,pn,ki]],["getDirectedEdgeDestination",en,[dn,pn,ki]],["isValidDirectedEdge",bA,[dn,pn]],["directedEdgeToCells",en,[dn,pn,ki]],["originToDirectedEdges",en,[dn,pn,ki]],["directedEdgeToBoundary",en,[dn,pn,ki]],["gridDistance",en,[dn,pn,dn,pn,ki]],["gridPathCells",en,[dn,pn,dn,pn,ki]],["gridPathCellsSize",en,[dn,pn,dn,pn,ki]],["cellToLocalIj",en,[dn,pn,dn,pn,An,ki]],["localIjToCell",en,[dn,pn,ki,An,ki]],["getHexagonAreaAvgM2",en,[Ws,ki]],["getHexagonAreaAvgKm2",en,[Ws,ki]],["getHexagonEdgeLengthAvgM",en,[Ws,ki]],["getHexagonEdgeLengthAvgKm",en,[Ws,ki]],["greatCircleDistanceM",An,[ki,ki]],["greatCircleDistanceKm",An,[ki,ki]],["greatCircleDistanceRads",An,[ki,ki]],["cellAreaM2",en,[dn,pn,ki]],["cellAreaKm2",en,[dn,pn,ki]],["cellAreaRads2",en,[dn,pn,ki]],["edgeLengthM",en,[dn,pn,ki]],["edgeLengthKm",en,[dn,pn,ki]],["edgeLengthRads",en,[dn,pn,ki]],["getNumCells",en,[Ws,ki]],["getRes0Cells",en,[ki]],["res0CellCount",An],["getPentagons",en,[An,ki]],["pentagonCount",An],["cellToVertex",en,[dn,pn,An,ki]],["cellToVertexes",en,[dn,pn,ki]],["vertexToLatLng",en,[dn,pn,ki]],["isValidVertex",bA,[dn,pn]]],Wlt=0,Hlt=1,Xlt=2,qlt=3,ND=4,Klt=5,Zlt=6,Ylt=7,Qlt=8,Jlt=9,$lt=10,tut=11,eut=12,iut=13,nut=14,rut=15,so={};so[Wlt]="Success";so[Hlt]="The operation failed but a more specific error is not available";so[Xlt]="Argument was outside of acceptable range";so[qlt]="Latitude or longitude arguments were outside of acceptable range";so[ND]="Resolution argument was outside of acceptable range";so[Klt]="Cell argument was not valid";so[Zlt]="Directed edge argument was not valid";so[Ylt]="Undirected edge argument was not valid";so[Qlt]="Vertex argument was not valid";so[Jlt]="Pentagon distortion was encountered";so[$lt]="Duplicate input";so[tut]="Cell arguments were not neighbors";so[eut]="Cell arguments had incompatible resolutions";so[iut]="Memory allocation failed";so[nut]="Bounds of provided memory were insufficient";so[rut]="Mode or flags argument was not valid";var Cw=1e3,zD=1001,UD=1002,Jy={};Jy[Cw]="Unknown unit";Jy[zD]="Array length out of bounds";Jy[UD]="Got unexpected null value for H3 index";var sut="Unknown error";function VD(i,t,e){var n=e&&"value"in e,r=new Error((i[t]||sut)+" (code: "+t+(n?", value: "+e.value:"")+")");return r.code=t,r}function GD(i,t){var e=arguments.length===2?{value:t}:{};return VD(so,i,e)}function $y(i,t){var e=arguments.length===2?{value:t}:{};return VD(Jy,i,e)}function ro(i){if(i!==0)throw GD(i)}var rr={};jlt.forEach(function(i){rr[i[0]]=Ui.cwrap.apply(Ui,i)});var Jd=16,Cp=4,NI=4,cu=8,tv=8,Jc=rr.sizeOfH3Index(),Tw=rr.sizeOfLatLng(),out=rr.sizeOfCellBoundary(),aut=rr.sizeOfGeoPolygon(),QA=rr.sizeOfGeoLoop(),lut=rr.sizeOfLinkedGeoPolygon();rr.sizeOfCoordIJ();var dp={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function Sw(i){if(typeof i!="number"||i<0||i>15||Math.floor(i)!==i)throw GD(ND,i);return i}function jD(i){if(!i)throw $y(UD);return i}var uut=Math.pow(2,32)-1;function WD(i){if(i>uut)throw $y(zD,i);return i}var cut=/[^0-9a-fA-F]/;function bl(i){if(Array.isArray(i)&&i.length===2&&Number.isInteger(i[0])&&Number.isInteger(i[1]))return i;if(typeof i!="string"||cut.test(i))return[0,0];var t=parseInt(i.substring(0,i.length-8),Jd),e=parseInt(i.substring(i.length-8),Jd);return[e,t]}function zI(i){if(i>=0)return i.toString(Jd);i=i&2147483647;var t=HD(8,i.toString(Jd)),e=(parseInt(t[0],Jd)+8).toString(Jd);return t=e+t.substring(1),t}function hut(i,t){return zI(t)+HD(8,zI(i))}function HD(i,t){for(var e=i-t.length,n="",r=0;r<e;r++)n+="0";return n=n+t,n}function UI(i,t,e){for(var n=i.length,r=Ui._calloc(n,Tw),o=e?1:0,s=e?0:1,l=0;l<n*2;l+=2)Ui.HEAPF64.set([i[l/2][o],i[l/2][s]].map(QD),r/cu+l);return Ui.HEAPU32.set([n,r],t/Cp),t}function fut(i,t){var e=i.length-1,n=Ui._calloc(aut),r=0,o=r+QA,s=o+Cp;UI(i[0],n+r,t);var l;if(e>0){l=Ui._calloc(e,QA);for(var c=0;c<e;c++)UI(i[c+1],l+QA*c,t)}return Ui.setValue(n+o,e,"i32"),Ui.setValue(n+s,l,"i32"),n}function dut(i){var t=0,e=t+QA,n=e+Cp,r=Cp;Ui._free(Ui.getValue(i+t+r,"i8*"));var o=Ui.getValue(i+e,"i32");if(o>0){for(var s=Ui.getValue(i+n,"i32"),l=0;l<o;l++)Ui._free(Ui.getValue(s+QA*l+r,"i8*"));Ui._free(s)}Ui._free(i)}function Pw(i,t){t===void 0&&(t=0);var e=Ui.getValue(i+Jc*t,"i32"),n=Ui.getValue(i+Jc*t+Cp,"i32");return n?hut(e,n):null}function XD(i,t){return t===void 0&&(t=0),Ui.getValue(i+cu*t,"double")}function ev(i){return rr.readInt64AsDoubleFromPointer(i)}function put(i,t,e){Ui.HEAPU32.set(bl(i),t/Cp+2*e)}function Iw(i,t){for(var e=[],n=0;n<t;n++){var r=Pw(i,n);r!==null&&e.push(r)}return e}function Aut(i,t){for(var e=t.length,n=0;n<e;n++)put(t[n],i,n)}function my(i){return Sut(Ui.getValue(i,"double"))}function qD(i){return[my(i),my(i+cu)]}function KD(i){return[my(i+cu),my(i)]}function mut(i,t,e){for(var n=Ui.getValue(i,"i32"),r=i+cu,o=[],s=t?KD:qD,l=0;l<n*2;l+=2)o.push(s(r+cu*l));return e&&o.push(o[0]),o}function gut(i,t){for(var e=[],n=KD,r,o,s,l;i;){for(e.push(r=[]),o=Ui.getValue(i,"i8*");o;){for(r.push(s=[]),l=Ui.getValue(o,"i8*");l;)s.push(n(l)),l=Ui.getValue(l+cu*2,"i8*");s.push(s[0]),o=Ui.getValue(o+NI*2,"i8*")}i=Ui.getValue(i+NI*2,"i8*")}return e}function yut(i){var t=bl(i),e=t[0],n=t[1];return!!rr.isPentagon(e,n)}function lf(i){var t=bl(i),e=t[0],n=t[1];return rr.isValidCell(e,n)?rr.getResolution(e,n):-1}function Mw(i,t,e){var n=Ui._malloc(Tw);Ui.HEAPF64.set([i,t].map(QD),n/cu);var r=Ui._malloc(Jc);try{return ro(rr.latLngToCell(n,e,r)),jD(Pw(r))}finally{Ui._free(r),Ui._free(n)}}function iv(i){var t=Ui._malloc(Tw),e=bl(i),n=e[0],r=e[1];try{return ro(rr.cellToLatLng(n,r,t)),qD(t)}finally{Ui._free(t)}}function ZD(i,t){var e=Ui._malloc(out),n=bl(i),r=n[0],o=n[1];try{return ro(rr.cellToBoundary(r,o,e)),mut(e,t,t)}finally{Ui._free(e)}}function YD(i,t){var e=bl(i),n=e[0],r=e[1],o=Ui._malloc(Jc);try{return ro(rr.cellToParent(n,r,t,o)),jD(Pw(o))}finally{Ui._free(o)}}function vut(i,t){var e=bl(i),n=e[0],r=e[1],o=Ui._malloc(tv);try{ro(rr.maxGridDiskSize(t,o));var s=WD(ev(o)),l=Ui._calloc(s,Jc);try{return ro(rr.gridDisk(n,r,t,l)),Iw(l,s)}finally{Ui._free(l)}}finally{Ui._free(o)}}function _ut(i,t,e){if(Sw(t),e=!!e,i.length===0||i[0].length===0)return[];var n=typeof i[0][0]=="number"?[i]:i,r=fut(n,e),o=Ui._malloc(tv);try{ro(rr.maxPolygonToCellsSize(r,t,0,o));var s=WD(ev(o)),l=Ui._calloc(s,Jc);try{return ro(rr.polygonToCells(r,t,0,l)),Iw(l,s)}finally{Ui._free(l)}}finally{Ui._free(o),dut(r)}}function but(i,t){if(!i||!i.length)return[];var e=i.length,n=Ui._calloc(e,Jc);Aut(n,i);var r=Ui._calloc(lut);try{return ro(rr.cellsToLinkedMultiPolygon(n,e,r)),gut(r,t)}finally{rr.destroyLinkedMultiPolygon(r),Ui._free(r),Ui._free(n)}}function xut(i){var t=bl(i),e=t[0],n=t[1],r=6,o=Ui._calloc(r,Jc);try{return ro(rr.originToDirectedEdges(e,n,o)),Iw(o,r)}finally{Ui._free(o)}}function wut(i,t){var e=bl(i),n=e[0],r=e[1],o=bl(t),s=o[0],l=o[1],c=Ui._malloc(tv);try{return ro(rr.gridDistance(n,r,s,l,c)),ev(c)}finally{Ui._free(c)}}function Eut(i,t){var e=bl(i),n=e[0],r=e[1],o=Ui._malloc(cu);try{switch(t){case dp.m:ro(rr.edgeLengthM(n,r,o));break;case dp.km:ro(rr.edgeLengthKm(n,r,o));break;case dp.rads:ro(rr.edgeLengthRads(n,r,o));break;default:throw $y(Cw,t)}return XD(o)}finally{Ui._free(o)}}function Cut(i,t){Sw(i);var e=Ui._malloc(cu);try{switch(t){case dp.m:ro(rr.getHexagonEdgeLengthAvgM(i,e));break;case dp.km:ro(rr.getHexagonEdgeLengthAvgKm(i,e));break;default:throw $y(Cw,t)}return XD(e)}finally{Ui._free(e)}}function Tut(i){Sw(i);var t=Ui._malloc(tv);try{return ro(rr.getNumCells(i,t)),ev(t)}finally{Ui._free(t)}}function QD(i){return i*Math.PI/180}function Sut(i){return i*180/Math.PI}function Bw(i,t){t=t===void 0?i[0][0]:t;for(const e of i){const n=e[0]-t;n>180?e[0]-=360:n<-180&&(e[0]+=360)}}function Put(i,t,e){const[n,r]=iv(i),o=t.length;Bw(t,r);const s=t[0]===t[o-1]?o-1:o;for(let l=0;l<s;l++)t[l][0]=gl(r,t[l][0],e),t[l][1]=gl(n,t[l][1],e)}function Iut(i,t,e){const n=i(t,e),[r,o]=iv(n);return[o,r]}function VI(i,t=1){const e=ZD(i,!0);return t!==1?Put(i,e,t):Bw(e),e}function JD(i){const t=new Float64Array(i.length*2);let e=0;for(const n of i)t[e++]=n[0],t[e++]=n[1];return t}const Mut={getPentagon:{type:"accessor",value:i=>i.pentagon}};class Rw extends sc{indexToBounds(){const{data:t,getPentagon:e}=this.props;return{data:t,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(n,r)=>{const o=e(n,r),s=Vlt(typeof o=="string"?Glt(o):o,{closedRing:!0,segments:"auto"});return JD(s)}}}}Rw.layerName="A5Layer";Rw.defaultProps=Mut;function But(i){return typeof i=="string"?i.charAt(0).toLowerCase()+i.slice(1):i}function b2(i){if(Array.isArray(i))return i.map(t=>b2(t));if(i&&typeof i=="object"){const t={};for(const[e,n]of Object.entries(i))t[But(e)]=b2(n);return t}return i}var d1={},GI={},jI;function Lw(){return jI||(jI=1,(function(i){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+t+"]["+e+"]*",r=new RegExp("^"+n+"$"),o=function(l,c){const y=[];let _=c.exec(l);for(;_;){const C=[];C.startIndex=c.lastIndex-_[0].length;const I=_.length;for(let k=0;k<I;k++)C.push(_[k]);y.push(C),_=c.exec(l)}return y},s=function(l){const c=r.exec(l);return!(c===null||typeof c>"u")};i.isExist=function(l){return typeof l<"u"},i.isEmptyObject=function(l){return Object.keys(l).length===0},i.merge=function(l,c,y){if(c){const _=Object.keys(c),C=_.length;for(let I=0;I<C;I++)y==="strict"?l[_[I]]=[c[_[I]]]:l[_[I]]=c[_[I]]}},i.getValue=function(l){return i.isExist(l)?l:""},i.isName=s,i.getAllMatches=o,i.nameRegexp=n})(GI)),GI}var WI;function $D(){if(WI)return d1;WI=1;const i=Lw(),t={allowBooleanAttributes:!1,unpairedTags:[]};d1.validate=function(H,$){$=Object.assign({},t,$);const Y=[];let ct=!1,rt=!1;H[0]==="\uFEFF"&&(H=H.substr(1));for(let nt=0;nt<H.length;nt++)if(H[nt]==="<"&&H[nt+1]==="?"){if(nt+=2,nt=n(H,nt),nt.err)return nt}else if(H[nt]==="<"){let Ot=nt;if(nt++,H[nt]==="!"){nt=r(H,nt);continue}else{let Kt=!1;H[nt]==="/"&&(Kt=!0,nt++);let ft="";for(;nt<H.length&&H[nt]!==">"&&H[nt]!==" "&&H[nt]!=="	"&&H[nt]!==`
`&&H[nt]!=="\r";nt++)ft+=H[nt];if(ft=ft.trim(),ft[ft.length-1]==="/"&&(ft=ft.substring(0,ft.length-1),nt--),!z(ft)){let K;return ft.trim().length===0?K="Invalid space after '<'.":K="Tag '"+ft+"' is an invalid name.",I("InvalidTag",K,V(H,nt))}const st=l(H,nt);if(st===!1)return I("InvalidAttr","Attributes for '"+ft+"' have open quote.",V(H,nt));let Ut=st.value;if(nt=st.index,Ut[Ut.length-1]==="/"){const K=nt-Ut.length;Ut=Ut.substring(0,Ut.length-1);const dt=y(Ut,$);if(dt===!0)ct=!0;else return I(dt.err.code,dt.err.msg,V(H,K+dt.err.line))}else if(Kt)if(st.tagClosed){if(Ut.trim().length>0)return I("InvalidTag","Closing tag '"+ft+"' can't have attributes or invalid starting.",V(H,Ot));if(Y.length===0)return I("InvalidTag","Closing tag '"+ft+"' has not been opened.",V(H,Ot));{const K=Y.pop();if(ft!==K.tagName){let dt=V(H,K.tagStartPos);return I("InvalidTag","Expected closing tag '"+K.tagName+"' (opened in line "+dt.line+", col "+dt.col+") instead of closing tag '"+ft+"'.",V(H,Ot))}Y.length==0&&(rt=!0)}}else return I("InvalidTag","Closing tag '"+ft+"' doesn't have proper closing.",V(H,nt));else{const K=y(Ut,$);if(K!==!0)return I(K.err.code,K.err.msg,V(H,nt-Ut.length+K.err.line));if(rt===!0)return I("InvalidXml","Multiple possible root nodes found.",V(H,nt));$.unpairedTags.indexOf(ft)!==-1||Y.push({tagName:ft,tagStartPos:Ot}),ct=!0}for(nt++;nt<H.length;nt++)if(H[nt]==="<")if(H[nt+1]==="!"){nt++,nt=r(H,nt);continue}else if(H[nt+1]==="?"){if(nt=n(H,++nt),nt.err)return nt}else break;else if(H[nt]==="&"){const K=C(H,nt);if(K==-1)return I("InvalidChar","char '&' is not expected.",V(H,nt));nt=K}else if(rt===!0&&!e(H[nt]))return I("InvalidXml","Extra text at the end",V(H,nt));H[nt]==="<"&&nt--}}else{if(e(H[nt]))continue;return I("InvalidChar","char '"+H[nt]+"' is not expected.",V(H,nt))}if(ct){if(Y.length==1)return I("InvalidTag","Unclosed tag '"+Y[0].tagName+"'.",V(H,Y[0].tagStartPos));if(Y.length>0)return I("InvalidXml","Invalid '"+JSON.stringify(Y.map(nt=>nt.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return I("InvalidXml","Start tag expected.",1);return!0};function e(H){return H===" "||H==="	"||H===`
`||H==="\r"}function n(H,$){const Y=$;for(;$<H.length;$++)if(H[$]=="?"||H[$]==" "){const ct=H.substr(Y,$-Y);if($>5&&ct==="xml")return I("InvalidXml","XML declaration allowed only at the start of the document.",V(H,$));if(H[$]=="?"&&H[$+1]==">"){$++;break}else continue}return $}function r(H,$){if(H.length>$+5&&H[$+1]==="-"&&H[$+2]==="-"){for($+=3;$<H.length;$++)if(H[$]==="-"&&H[$+1]==="-"&&H[$+2]===">"){$+=2;break}}else if(H.length>$+8&&H[$+1]==="D"&&H[$+2]==="O"&&H[$+3]==="C"&&H[$+4]==="T"&&H[$+5]==="Y"&&H[$+6]==="P"&&H[$+7]==="E"){let Y=1;for($+=8;$<H.length;$++)if(H[$]==="<")Y++;else if(H[$]===">"&&(Y--,Y===0))break}else if(H.length>$+9&&H[$+1]==="["&&H[$+2]==="C"&&H[$+3]==="D"&&H[$+4]==="A"&&H[$+5]==="T"&&H[$+6]==="A"&&H[$+7]==="["){for($+=8;$<H.length;$++)if(H[$]==="]"&&H[$+1]==="]"&&H[$+2]===">"){$+=2;break}}return $}const o='"',s="'";function l(H,$){let Y="",ct="",rt=!1;for(;$<H.length;$++){if(H[$]===o||H[$]===s)ct===""?ct=H[$]:ct!==H[$]||(ct="");else if(H[$]===">"&&ct===""){rt=!0;break}Y+=H[$]}return ct!==""?!1:{value:Y,index:$,tagClosed:rt}}const c=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function y(H,$){const Y=i.getAllMatches(H,c),ct={};for(let rt=0;rt<Y.length;rt++){if(Y[rt][1].length===0)return I("InvalidAttr","Attribute '"+Y[rt][2]+"' has no space in starting.",X(Y[rt]));if(Y[rt][3]!==void 0&&Y[rt][4]===void 0)return I("InvalidAttr","Attribute '"+Y[rt][2]+"' is without value.",X(Y[rt]));if(Y[rt][3]===void 0&&!$.allowBooleanAttributes)return I("InvalidAttr","boolean attribute '"+Y[rt][2]+"' is not allowed.",X(Y[rt]));const nt=Y[rt][2];if(!k(nt))return I("InvalidAttr","Attribute '"+nt+"' is an invalid name.",X(Y[rt]));if(!ct.hasOwnProperty(nt))ct[nt]=1;else return I("InvalidAttr","Attribute '"+nt+"' is repeated.",X(Y[rt]))}return!0}function _(H,$){let Y=/\d/;for(H[$]==="x"&&($++,Y=/[\da-fA-F]/);$<H.length;$++){if(H[$]===";")return $;if(!H[$].match(Y))break}return-1}function C(H,$){if($++,H[$]===";")return-1;if(H[$]==="#")return $++,_(H,$);let Y=0;for(;$<H.length;$++,Y++)if(!(H[$].match(/\w/)&&Y<20)){if(H[$]===";")break;return-1}return $}function I(H,$,Y){return{err:{code:H,msg:$,line:Y.line||Y,col:Y.col}}}function k(H){return i.isName(H)}function z(H){return i.isName(H)}function V(H,$){const Y=H.substring(0,$).split(/\r?\n/);return{line:Y.length,col:Y[Y.length-1].length+1}}function X(H){return H.startIndex+H[1].length}return d1}var K0={},HI;function Rut(){if(HI)return K0;HI=1;const i={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,n){return n},attributeValueProcessor:function(e,n){return n},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,n,r){return e}},t=function(e){return Object.assign({},i,e)};return K0.buildOptions=t,K0.defaultOptions=i,K0}var p1,XI;function Lut(){if(XI)return p1;XI=1;class i{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,n){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:n})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}return p1=i,p1}var A1,qI;function Dut(){if(qI)return A1;qI=1;const i=Lw();function t(y,_){const C={};if(y[_+3]==="O"&&y[_+4]==="C"&&y[_+5]==="T"&&y[_+6]==="Y"&&y[_+7]==="P"&&y[_+8]==="E"){_=_+9;let I=1,k=!1,z=!1,V="";for(;_<y.length;_++)if(y[_]==="<"&&!z){if(k&&r(y,_)){_+=7;let X,H;[X,H,_]=e(y,_+1),H.indexOf("&")===-1&&(C[c(X)]={regx:RegExp(`&${X};`,"g"),val:H})}else if(k&&o(y,_))_+=8;else if(k&&s(y,_))_+=8;else if(k&&l(y,_))_+=9;else if(n)z=!0;else throw new Error("Invalid DOCTYPE");I++,V=""}else if(y[_]===">"){if(z?y[_-1]==="-"&&y[_-2]==="-"&&(z=!1,I--):I--,I===0)break}else y[_]==="["?k=!0:V+=y[_];if(I!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:C,i:_}}function e(y,_){let C="";for(;_<y.length&&y[_]!=="'"&&y[_]!=='"';_++)C+=y[_];if(C=C.trim(),C.indexOf(" ")!==-1)throw new Error("External entites are not supported");const I=y[_++];let k="";for(;_<y.length&&y[_]!==I;_++)k+=y[_];return[C,k,_]}function n(y,_){return y[_+1]==="!"&&y[_+2]==="-"&&y[_+3]==="-"}function r(y,_){return y[_+1]==="!"&&y[_+2]==="E"&&y[_+3]==="N"&&y[_+4]==="T"&&y[_+5]==="I"&&y[_+6]==="T"&&y[_+7]==="Y"}function o(y,_){return y[_+1]==="!"&&y[_+2]==="E"&&y[_+3]==="L"&&y[_+4]==="E"&&y[_+5]==="M"&&y[_+6]==="E"&&y[_+7]==="N"&&y[_+8]==="T"}function s(y,_){return y[_+1]==="!"&&y[_+2]==="A"&&y[_+3]==="T"&&y[_+4]==="T"&&y[_+5]==="L"&&y[_+6]==="I"&&y[_+7]==="S"&&y[_+8]==="T"}function l(y,_){return y[_+1]==="!"&&y[_+2]==="N"&&y[_+3]==="O"&&y[_+4]==="T"&&y[_+5]==="A"&&y[_+6]==="T"&&y[_+7]==="I"&&y[_+8]==="O"&&y[_+9]==="N"}function c(y){if(i.isName(y))return y;throw new Error(`Invalid entity name ${y}`)}return A1=t,A1}var m1,KI;function kut(){if(KI)return m1;KI=1;const i=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,e={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function n(s,l={}){if(l=Object.assign({},e,l),!s||typeof s!="string")return s;let c=s.trim();if(l.skipLike!==void 0&&l.skipLike.test(c))return s;if(s==="0")return 0;if(l.hex&&i.test(c))return o(c,16);if(c.search(/[eE]/)!==-1){const y=c.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(y){if(l.leadingZeros)c=(y[1]||"")+y[3];else if(!(y[2]==="0"&&y[3][0]==="."))return s;return l.eNotation?Number(c):s}else return s}else{const y=t.exec(c);if(y){const _=y[1],C=y[2];let I=r(y[3]);if(!l.leadingZeros&&C.length>0&&_&&c[2]!=="."||!l.leadingZeros&&C.length>0&&!_&&c[1]!==".")return s;if(l.leadingZeros&&C===s)return 0;{const k=Number(c),z=""+k;return z.search(/[eE]/)!==-1?l.eNotation?k:s:c.indexOf(".")!==-1?z==="0"&&I===""||z===I||_&&z==="-"+I?k:s:C?I===z||_+I===z?k:s:c===z||c===_+z?k:s}}else return s}}function r(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}function o(s,l){if(parseInt)return parseInt(s,l);if(Number.parseInt)return Number.parseInt(s,l);if(window&&window.parseInt)return window.parseInt(s,l);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}return m1=n,m1}var g1,ZI;function t5(){if(ZI)return g1;ZI=1;function i(t){return typeof t=="function"?t:Array.isArray(t)?e=>{for(const n of t)if(typeof n=="string"&&e===n||n instanceof RegExp&&n.test(e))return!0}:()=>!1}return g1=i,g1}var y1,YI;function Out(){if(YI)return y1;YI=1;const i=Lw(),t=Lut(),e=Dut(),n=kut(),r=t5();class o{constructor(nt){this.options=nt,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(Ot,Kt)=>String.fromCharCode(Number.parseInt(Kt,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(Ot,Kt)=>String.fromCharCode(Number.parseInt(Kt,16))}},this.addExternalEntities=s,this.parseXml=C,this.parseTextData=l,this.resolveNameSpace=c,this.buildAttributesMap=_,this.isItStopNode=V,this.replaceEntitiesValue=k,this.readStopNodeData=Y,this.saveTextToParentTag=z,this.addChild=I,this.ignoreAttributesFn=r(this.options.ignoreAttributes)}}function s(rt){const nt=Object.keys(rt);for(let Ot=0;Ot<nt.length;Ot++){const Kt=nt[Ot];this.lastEntities[Kt]={regex:new RegExp("&"+Kt+";","g"),val:rt[Kt]}}}function l(rt,nt,Ot,Kt,ft,st,Ut){if(rt!==void 0&&(this.options.trimValues&&!Kt&&(rt=rt.trim()),rt.length>0)){Ut||(rt=this.replaceEntitiesValue(rt));const K=this.options.tagValueProcessor(nt,rt,Ot,ft,st);return K==null?rt:typeof K!=typeof rt||K!==rt?K:this.options.trimValues?ct(rt,this.options.parseTagValue,this.options.numberParseOptions):rt.trim()===rt?ct(rt,this.options.parseTagValue,this.options.numberParseOptions):rt}}function c(rt){if(this.options.removeNSPrefix){const nt=rt.split(":"),Ot=rt.charAt(0)==="/"?"/":"";if(nt[0]==="xmlns")return"";nt.length===2&&(rt=Ot+nt[1])}return rt}const y=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function _(rt,nt,Ot){if(this.options.ignoreAttributes!==!0&&typeof rt=="string"){const Kt=i.getAllMatches(rt,y),ft=Kt.length,st={};for(let Ut=0;Ut<ft;Ut++){const K=this.resolveNameSpace(Kt[Ut][1]);if(this.ignoreAttributesFn(K,nt))continue;let dt=Kt[Ut][4],Tt=this.options.attributeNamePrefix+K;if(K.length)if(this.options.transformAttributeName&&(Tt=this.options.transformAttributeName(Tt)),Tt==="__proto__"&&(Tt="#__proto__"),dt!==void 0){this.options.trimValues&&(dt=dt.trim()),dt=this.replaceEntitiesValue(dt);const ue=this.options.attributeValueProcessor(K,dt,nt);ue==null?st[Tt]=dt:typeof ue!=typeof dt||ue!==dt?st[Tt]=ue:st[Tt]=ct(dt,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(st[Tt]=!0)}if(!Object.keys(st).length)return;if(this.options.attributesGroupName){const Ut={};return Ut[this.options.attributesGroupName]=st,Ut}return st}}const C=function(rt){rt=rt.replace(/\r\n?/g,`
`);const nt=new t("!xml");let Ot=nt,Kt="",ft="";for(let st=0;st<rt.length;st++)if(rt[st]==="<")if(rt[st+1]==="/"){const Ut=H(rt,">",st,"Closing Tag is not closed.");let K=rt.substring(st+2,Ut).trim();if(this.options.removeNSPrefix){const ue=K.indexOf(":");ue!==-1&&(K=K.substr(ue+1))}this.options.transformTagName&&(K=this.options.transformTagName(K)),Ot&&(Kt=this.saveTextToParentTag(Kt,Ot,ft));const dt=ft.substring(ft.lastIndexOf(".")+1);if(K&&this.options.unpairedTags.indexOf(K)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${K}>`);let Tt=0;dt&&this.options.unpairedTags.indexOf(dt)!==-1?(Tt=ft.lastIndexOf(".",ft.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Tt=ft.lastIndexOf("."),ft=ft.substring(0,Tt),Ot=this.tagsNodeStack.pop(),Kt="",st=Ut}else if(rt[st+1]==="?"){let Ut=$(rt,st,!1,"?>");if(!Ut)throw new Error("Pi Tag is not closed.");if(Kt=this.saveTextToParentTag(Kt,Ot,ft),!(this.options.ignoreDeclaration&&Ut.tagName==="?xml"||this.options.ignorePiTags)){const K=new t(Ut.tagName);K.add(this.options.textNodeName,""),Ut.tagName!==Ut.tagExp&&Ut.attrExpPresent&&(K[":@"]=this.buildAttributesMap(Ut.tagExp,ft,Ut.tagName)),this.addChild(Ot,K,ft)}st=Ut.closeIndex+1}else if(rt.substr(st+1,3)==="!--"){const Ut=H(rt,"-->",st+4,"Comment is not closed.");if(this.options.commentPropName){const K=rt.substring(st+4,Ut-2);Kt=this.saveTextToParentTag(Kt,Ot,ft),Ot.add(this.options.commentPropName,[{[this.options.textNodeName]:K}])}st=Ut}else if(rt.substr(st+1,2)==="!D"){const Ut=e(rt,st);this.docTypeEntities=Ut.entities,st=Ut.i}else if(rt.substr(st+1,2)==="!["){const Ut=H(rt,"]]>",st,"CDATA is not closed.")-2,K=rt.substring(st+9,Ut);Kt=this.saveTextToParentTag(Kt,Ot,ft);let dt=this.parseTextData(K,Ot.tagname,ft,!0,!1,!0,!0);dt==null&&(dt=""),this.options.cdataPropName?Ot.add(this.options.cdataPropName,[{[this.options.textNodeName]:K}]):Ot.add(this.options.textNodeName,dt),st=Ut+2}else{let Ut=$(rt,st,this.options.removeNSPrefix),K=Ut.tagName;const dt=Ut.rawTagName;let Tt=Ut.tagExp,ue=Ut.attrExpPresent,Rt=Ut.closeIndex;this.options.transformTagName&&(K=this.options.transformTagName(K)),Ot&&Kt&&Ot.tagname!=="!xml"&&(Kt=this.saveTextToParentTag(Kt,Ot,ft,!1));const Ft=Ot;if(Ft&&this.options.unpairedTags.indexOf(Ft.tagname)!==-1&&(Ot=this.tagsNodeStack.pop(),ft=ft.substring(0,ft.lastIndexOf("."))),K!==nt.tagname&&(ft+=ft?"."+K:K),this.isItStopNode(this.options.stopNodes,ft,K)){let Gt="";if(Tt.length>0&&Tt.lastIndexOf("/")===Tt.length-1)K[K.length-1]==="/"?(K=K.substr(0,K.length-1),ft=ft.substr(0,ft.length-1),Tt=K):Tt=Tt.substr(0,Tt.length-1),st=Ut.closeIndex;else if(this.options.unpairedTags.indexOf(K)!==-1)st=Ut.closeIndex;else{const le=this.readStopNodeData(rt,dt,Rt+1);if(!le)throw new Error(`Unexpected end of ${dt}`);st=le.i,Gt=le.tagContent}const se=new t(K);K!==Tt&&ue&&(se[":@"]=this.buildAttributesMap(Tt,ft,K)),Gt&&(Gt=this.parseTextData(Gt,K,ft,!0,ue,!0,!0)),ft=ft.substr(0,ft.lastIndexOf(".")),se.add(this.options.textNodeName,Gt),this.addChild(Ot,se,ft)}else{if(Tt.length>0&&Tt.lastIndexOf("/")===Tt.length-1){K[K.length-1]==="/"?(K=K.substr(0,K.length-1),ft=ft.substr(0,ft.length-1),Tt=K):Tt=Tt.substr(0,Tt.length-1),this.options.transformTagName&&(K=this.options.transformTagName(K));const Gt=new t(K);K!==Tt&&ue&&(Gt[":@"]=this.buildAttributesMap(Tt,ft,K)),this.addChild(Ot,Gt,ft),ft=ft.substr(0,ft.lastIndexOf("."))}else{const Gt=new t(K);this.tagsNodeStack.push(Ot),K!==Tt&&ue&&(Gt[":@"]=this.buildAttributesMap(Tt,ft,K)),this.addChild(Ot,Gt,ft),Ot=Gt}Kt="",st=Rt}}else Kt+=rt[st];return nt.child};function I(rt,nt,Ot){const Kt=this.options.updateTag(nt.tagname,Ot,nt[":@"]);Kt===!1||(typeof Kt=="string"&&(nt.tagname=Kt),rt.addChild(nt))}const k=function(rt){if(this.options.processEntities){for(let nt in this.docTypeEntities){const Ot=this.docTypeEntities[nt];rt=rt.replace(Ot.regx,Ot.val)}for(let nt in this.lastEntities){const Ot=this.lastEntities[nt];rt=rt.replace(Ot.regex,Ot.val)}if(this.options.htmlEntities)for(let nt in this.htmlEntities){const Ot=this.htmlEntities[nt];rt=rt.replace(Ot.regex,Ot.val)}rt=rt.replace(this.ampEntity.regex,this.ampEntity.val)}return rt};function z(rt,nt,Ot,Kt){return rt&&(Kt===void 0&&(Kt=nt.child.length===0),rt=this.parseTextData(rt,nt.tagname,Ot,!1,nt[":@"]?Object.keys(nt[":@"]).length!==0:!1,Kt),rt!==void 0&&rt!==""&&nt.add(this.options.textNodeName,rt),rt=""),rt}function V(rt,nt,Ot){const Kt="*."+Ot;for(const ft in rt){const st=rt[ft];if(Kt===st||nt===st)return!0}return!1}function X(rt,nt,Ot=">"){let Kt,ft="";for(let st=nt;st<rt.length;st++){let Ut=rt[st];if(Kt)Ut===Kt&&(Kt="");else if(Ut==='"'||Ut==="'")Kt=Ut;else if(Ut===Ot[0])if(Ot[1]){if(rt[st+1]===Ot[1])return{data:ft,index:st}}else return{data:ft,index:st};else Ut==="	"&&(Ut=" ");ft+=Ut}}function H(rt,nt,Ot,Kt){const ft=rt.indexOf(nt,Ot);if(ft===-1)throw new Error(Kt);return ft+nt.length-1}function $(rt,nt,Ot,Kt=">"){const ft=X(rt,nt+1,Kt);if(!ft)return;let st=ft.data;const Ut=ft.index,K=st.search(/\s/);let dt=st,Tt=!0;K!==-1&&(dt=st.substring(0,K),st=st.substring(K+1).trimStart());const ue=dt;if(Ot){const Rt=dt.indexOf(":");Rt!==-1&&(dt=dt.substr(Rt+1),Tt=dt!==ft.data.substr(Rt+1))}return{tagName:dt,tagExp:st,closeIndex:Ut,attrExpPresent:Tt,rawTagName:ue}}function Y(rt,nt,Ot){const Kt=Ot;let ft=1;for(;Ot<rt.length;Ot++)if(rt[Ot]==="<")if(rt[Ot+1]==="/"){const st=H(rt,">",Ot,`${nt} is not closed`);if(rt.substring(Ot+2,st).trim()===nt&&(ft--,ft===0))return{tagContent:rt.substring(Kt,Ot),i:st};Ot=st}else if(rt[Ot+1]==="?")Ot=H(rt,"?>",Ot+1,"StopNode is not closed.");else if(rt.substr(Ot+1,3)==="!--")Ot=H(rt,"-->",Ot+3,"StopNode is not closed.");else if(rt.substr(Ot+1,2)==="![")Ot=H(rt,"]]>",Ot,"StopNode is not closed.")-2;else{const st=$(rt,Ot,">");st&&((st&&st.tagName)===nt&&st.tagExp[st.tagExp.length-1]!=="/"&&ft++,Ot=st.closeIndex)}}function ct(rt,nt,Ot){if(nt&&typeof rt=="string"){const Kt=rt.trim();return Kt==="true"?!0:Kt==="false"?!1:n(rt,Ot)}else return i.isExist(rt)?rt:""}return y1=o,y1}var v1={},QI;function Fut(){if(QI)return v1;QI=1;function i(o,s){return t(o,s)}function t(o,s,l){let c;const y={};for(let _=0;_<o.length;_++){const C=o[_],I=e(C);let k="";if(l===void 0?k=I:k=l+"."+I,I===s.textNodeName)c===void 0?c=C[I]:c+=""+C[I];else{if(I===void 0)continue;if(C[I]){let z=t(C[I],s,k);const V=r(z,s);C[":@"]?n(z,C[":@"],k,s):Object.keys(z).length===1&&z[s.textNodeName]!==void 0&&!s.alwaysCreateTextNode?z=z[s.textNodeName]:Object.keys(z).length===0&&(s.alwaysCreateTextNode?z[s.textNodeName]="":z=""),y[I]!==void 0&&y.hasOwnProperty(I)?(Array.isArray(y[I])||(y[I]=[y[I]]),y[I].push(z)):s.isArray(I,k,V)?y[I]=[z]:y[I]=z}}}return typeof c=="string"?c.length>0&&(y[s.textNodeName]=c):c!==void 0&&(y[s.textNodeName]=c),y}function e(o){const s=Object.keys(o);for(let l=0;l<s.length;l++){const c=s[l];if(c!==":@")return c}}function n(o,s,l,c){if(s){const y=Object.keys(s),_=y.length;for(let C=0;C<_;C++){const I=y[C];c.isArray(I,l+"."+I,!0,!0)?o[I]=[s[I]]:o[I]=s[I]}}}function r(o,s){const{textNodeName:l}=s,c=Object.keys(o).length;return!!(c===0||c===1&&(o[l]||typeof o[l]=="boolean"||o[l]===0))}return v1.prettify=i,v1}var _1,JI;function Nut(){if(JI)return _1;JI=1;const{buildOptions:i}=Rut(),t=Out(),{prettify:e}=Fut(),n=$D();class r{constructor(s){this.externalEntities={},this.options=i(s)}parse(s,l){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(l){l===!0&&(l={});const _=n.validate(s,l);if(_!==!0)throw Error(`${_.err.msg}:${_.err.line}:${_.err.col}`)}const c=new t(this.options);c.addExternalEntities(this.externalEntities);const y=c.parseXml(s);return this.options.preserveOrder||y===void 0?y:e(y,this.options)}addEntity(s,l){if(l.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(l==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=l}}return _1=r,_1}var b1,$I;function zut(){if($I)return b1;$I=1;const i=`
`;function t(l,c){let y="";return c.format&&c.indentBy.length>0&&(y=i),e(l,c,"",y)}function e(l,c,y,_){let C="",I=!1;for(let k=0;k<l.length;k++){const z=l[k],V=n(z);if(V===void 0)continue;let X="";if(y.length===0?X=V:X=`${y}.${V}`,V===c.textNodeName){let rt=z[V];o(X,c)||(rt=c.tagValueProcessor(V,rt),rt=s(rt,c)),I&&(C+=_),C+=rt,I=!1;continue}else if(V===c.cdataPropName){I&&(C+=_),C+=`<![CDATA[${z[V][0][c.textNodeName]}]]>`,I=!1;continue}else if(V===c.commentPropName){C+=_+`<!--${z[V][0][c.textNodeName]}-->`,I=!0;continue}else if(V[0]==="?"){const rt=r(z[":@"],c),nt=V==="?xml"?"":_;let Ot=z[V][0][c.textNodeName];Ot=Ot.length!==0?" "+Ot:"",C+=nt+`<${V}${Ot}${rt}?>`,I=!0;continue}let H=_;H!==""&&(H+=c.indentBy);const $=r(z[":@"],c),Y=_+`<${V}${$}`,ct=e(z[V],c,X,H);c.unpairedTags.indexOf(V)!==-1?c.suppressUnpairedNode?C+=Y+">":C+=Y+"/>":(!ct||ct.length===0)&&c.suppressEmptyNode?C+=Y+"/>":ct&&ct.endsWith(">")?C+=Y+`>${ct}${_}</${V}>`:(C+=Y+">",ct&&_!==""&&(ct.includes("/>")||ct.includes("</"))?C+=_+c.indentBy+ct+_:C+=ct,C+=`</${V}>`),I=!0}return C}function n(l){const c=Object.keys(l);for(let y=0;y<c.length;y++){const _=c[y];if(l.hasOwnProperty(_)&&_!==":@")return _}}function r(l,c){let y="";if(l&&!c.ignoreAttributes)for(let _ in l){if(!l.hasOwnProperty(_))continue;let C=c.attributeValueProcessor(_,l[_]);C=s(C,c),C===!0&&c.suppressBooleanAttributes?y+=` ${_.substr(c.attributeNamePrefix.length)}`:y+=` ${_.substr(c.attributeNamePrefix.length)}="${C}"`}return y}function o(l,c){l=l.substr(0,l.length-c.textNodeName.length-1);let y=l.substr(l.lastIndexOf(".")+1);for(let _ in c.stopNodes)if(c.stopNodes[_]===l||c.stopNodes[_]==="*."+y)return!0;return!1}function s(l,c){if(l&&l.length>0&&c.processEntities)for(let y=0;y<c.entities.length;y++){const _=c.entities[y];l=l.replace(_.regex,_.val)}return l}return b1=t,b1}var x1,t4;function Uut(){if(t4)return x1;t4=1;const i=zut(),t=t5(),e={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(l,c){return c},attributeValueProcessor:function(l,c){return c},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function n(l){this.options=Object.assign({},e,l),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=t(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=s),this.processTextOrObjNode=r,this.options.format?(this.indentate=o,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}n.prototype.build=function(l){return this.options.preserveOrder?i(l,this.options):(Array.isArray(l)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(l={[this.options.arrayNodeName]:l}),this.j2x(l,0,[]).val)},n.prototype.j2x=function(l,c,y){let _="",C="";const I=y.join(".");for(let k in l)if(Object.prototype.hasOwnProperty.call(l,k))if(typeof l[k]>"u")this.isAttribute(k)&&(C+="");else if(l[k]===null)this.isAttribute(k)||k===this.options.cdataPropName?C+="":k[0]==="?"?C+=this.indentate(c)+"<"+k+"?"+this.tagEndChar:C+=this.indentate(c)+"<"+k+"/"+this.tagEndChar;else if(l[k]instanceof Date)C+=this.buildTextValNode(l[k],k,"",c);else if(typeof l[k]!="object"){const z=this.isAttribute(k);if(z&&!this.ignoreAttributesFn(z,I))_+=this.buildAttrPairStr(z,""+l[k]);else if(!z)if(k===this.options.textNodeName){let V=this.options.tagValueProcessor(k,""+l[k]);C+=this.replaceEntitiesValue(V)}else C+=this.buildTextValNode(l[k],k,"",c)}else if(Array.isArray(l[k])){const z=l[k].length;let V="",X="";for(let H=0;H<z;H++){const $=l[k][H];if(!(typeof $>"u"))if($===null)k[0]==="?"?C+=this.indentate(c)+"<"+k+"?"+this.tagEndChar:C+=this.indentate(c)+"<"+k+"/"+this.tagEndChar;else if(typeof $=="object")if(this.options.oneListGroup){const Y=this.j2x($,c+1,y.concat(k));V+=Y.val,this.options.attributesGroupName&&$.hasOwnProperty(this.options.attributesGroupName)&&(X+=Y.attrStr)}else V+=this.processTextOrObjNode($,k,c,y);else if(this.options.oneListGroup){let Y=this.options.tagValueProcessor(k,$);Y=this.replaceEntitiesValue(Y),V+=Y}else V+=this.buildTextValNode($,k,"",c)}this.options.oneListGroup&&(V=this.buildObjectNode(V,k,X,c)),C+=V}else if(this.options.attributesGroupName&&k===this.options.attributesGroupName){const z=Object.keys(l[k]),V=z.length;for(let X=0;X<V;X++)_+=this.buildAttrPairStr(z[X],""+l[k][z[X]])}else C+=this.processTextOrObjNode(l[k],k,c,y);return{attrStr:_,val:C}},n.prototype.buildAttrPairStr=function(l,c){return c=this.options.attributeValueProcessor(l,""+c),c=this.replaceEntitiesValue(c),this.options.suppressBooleanAttributes&&c==="true"?" "+l:" "+l+'="'+c+'"'};function r(l,c,y,_){const C=this.j2x(l,y+1,_.concat(c));return l[this.options.textNodeName]!==void 0&&Object.keys(l).length===1?this.buildTextValNode(l[this.options.textNodeName],c,C.attrStr,y):this.buildObjectNode(C.val,c,C.attrStr,y)}n.prototype.buildObjectNode=function(l,c,y,_){if(l==="")return c[0]==="?"?this.indentate(_)+"<"+c+y+"?"+this.tagEndChar:this.indentate(_)+"<"+c+y+this.closeTag(c)+this.tagEndChar;{let C="</"+c+this.tagEndChar,I="";return c[0]==="?"&&(I="?",C=""),(y||y==="")&&l.indexOf("<")===-1?this.indentate(_)+"<"+c+y+I+">"+l+C:this.options.commentPropName!==!1&&c===this.options.commentPropName&&I.length===0?this.indentate(_)+`<!--${l}-->`+this.newLine:this.indentate(_)+"<"+c+y+I+this.tagEndChar+l+this.indentate(_)+C}},n.prototype.closeTag=function(l){let c="";return this.options.unpairedTags.indexOf(l)!==-1?this.options.suppressUnpairedNode||(c="/"):this.options.suppressEmptyNode?c="/":c=`></${l}`,c},n.prototype.buildTextValNode=function(l,c,y,_){if(this.options.cdataPropName!==!1&&c===this.options.cdataPropName)return this.indentate(_)+`<![CDATA[${l}]]>`+this.newLine;if(this.options.commentPropName!==!1&&c===this.options.commentPropName)return this.indentate(_)+`<!--${l}-->`+this.newLine;if(c[0]==="?")return this.indentate(_)+"<"+c+y+"?"+this.tagEndChar;{let C=this.options.tagValueProcessor(c,l);return C=this.replaceEntitiesValue(C),C===""?this.indentate(_)+"<"+c+y+this.closeTag(c)+this.tagEndChar:this.indentate(_)+"<"+c+y+">"+C+"</"+c+this.tagEndChar}},n.prototype.replaceEntitiesValue=function(l){if(l&&l.length>0&&this.options.processEntities)for(let c=0;c<this.options.entities.length;c++){const y=this.options.entities[c];l=l.replace(y.regex,y.val)}return l};function o(l){return this.options.indentBy.repeat(l)}function s(l){return l.startsWith(this.options.attributeNamePrefix)&&l!==this.options.textNodeName?l.substr(this.attrPrefixLen):!1}return x1=n,x1}var w1,e4;function Vut(){if(e4)return w1;e4=1;const i=$D(),t=Nut(),e=Uut();return w1={XMLParser:t,XMLValidator:i,XMLBuilder:e},w1}var Gut=Vut();function i4(i,t){if(t?._parser&&t._parser!=="fast-xml-parser")throw new Error(t?._parser);const e={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:t?.removeNSPrefix,textNodeName:t?.textNodeName,isArray:(r,o,s,l)=>!!t?.arrayPaths?.some(c=>o===c),...t?._fastXML},n=jut(i,e);return t?.uncapitalizeKeys?b2(n):n}function jut(i,t){return new Gut.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...t}).parse(i)}const Wut="4.3.3",Tp={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Wut,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:Hut,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(i,t)=>i4(new TextDecoder().decode(i),{...Tp.options.xml,...t?.xml}),parseTextSync:(i,t)=>i4(i,{...Tp.options.xml,...t?.xml})};function Hut(i){return i.startsWith("<?xml")}function Xut(i,t){const e=Tp.parseTextSync?.(i,t),n=e?.ServiceExceptionReport?.ServiceException||e?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof n=="string"?n:n.value||n.code||"Unknown error"}const qut="4.3.3",Bg={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:qut,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:Kut,options:{wms:{throwOnError:!1}},parse:async(i,t)=>E1(new TextDecoder().decode(i),t),parseSync:(i,t)=>E1(new TextDecoder().decode(i),t),parseTextSync:(i,t)=>E1(i,t)};function Kut(i){return i.startsWith("<?xml")}function E1(i,t){const e={...Bg.options.wms,...t?.wms},n=Xut(i,e),r=e.minimalErrors?n:`WMS Service error: ${n}`;if(e.throwOnError)throw new Error(r);return r}function Sp(i){return Array.isArray(i)?i:i?[i]:[]}function nv(i){const t=Sp(i);return t.length>0&&t.every(e=>typeof e=="string")?t:[]}function Z0(i,t=void 0){switch(typeof i){case"number":return i;case"string":return parseFloat(i);default:return}}function C1(i,t=void 0){switch(typeof i){case"number":return i;case"string":return parseInt(i,10);default:return}}function pp(i){switch(i){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function n4(i,t){const e=Tp.parseTextSync?.(i,t),n=e.WMT_MS_Capabilities||e.WMS_Capabilities||e,r=Zut(n);if(t?.inheritedLayerProps)for(const o of r.layers)i5(o,null);return t?.includeRawJSON&&(r.json=n),t?.includeXMLText&&(r.xml=i),r}function Zut(i){const t={version:String(i.version||""),name:String(i.Service?.Name||"unnamed"),title:i.Service?.Title?String(i.Service?.Title):void 0,abstract:i.Service?.Abstract?String(i.Service?.Abstract):void 0,keywords:nv(i.Service?.KeywordList?.Keyword),fees:i.Service?.Fees?JSON.stringify(i.Service?.Fees):void 0,accessConstraints:i.Service?.AccessConstraints?JSON.stringify(i.Service?.AccessConstraints):void 0,layerLimit:C1(i.Service?.LayerLimit),maxWidth:C1(i.Service?.maxWidth),maxHeight:C1(i.Service?.maxHeight),layers:[],requests:Yut(i.Capability?.Request),exceptions:Qut(i.Exception)},e=Sp(i.Capability?.Layer);for(const n of e)t.layers.push(e5(n));for(const[n,r]of Object.entries(t))r===void 0&&delete t[n];return t}function Yut(i){const t={};for(const[e,n]of Object.entries(i||{})){const r=nv(n?.Format);t[e]={mimeTypes:r}}return t}function Qut(i){if(Sp(i?.Format).length>0)return{mimeTypes:nv(i)}}function e5(i){const t={title:String(i?.Title||""),name:i?.Name&&String(i?.Name),abstract:i?.Name&&String(i?.Abstract),keywords:nv(i.KeywordList?.Keyword)},e=i?.CRS||i?.SRS;e&&Array.isArray(e)&&e.every(c=>typeof c=="string")&&(t.crs=e);let n=i?.EX_GeographicBoundingBox&&Jut(i?.EX_GeographicBoundingBox);n&&(t.geographicBoundingBox=n),n=i?.LatLonBoundingBox&&$ut(i?.LatLonBoundingBox),n&&(t.geographicBoundingBox=n);const r=i?.BoundingBox&&tct(i?.BoundingBox);r&&r.length>0&&(t.boundingBoxes=r);const o=Sp(i?.Dimension).map(c=>ict(c));o.length&&(t.dimensions=o),i?.opaque&&(t.opaque=pp(i?.opaque)),i?.cascaded&&(t.cascaded=pp(i?.cascaded)),i?.queryable&&(t.queryable=pp(i?.queryable));const s=Sp(i?.Layer),l=[];for(const c of s)l.push(e5(c));l.length>0&&(t.layers=l);for(const[c,y]of Object.entries(t))y===void 0&&delete t[c];return t}function Jut(i){const{westBoundLongitude:t,northBoundLatitude:e,eastBoundLongitude:n,southBoundLatitude:r}=i;return[[t,r],[n,e]]}function $ut(i){const{minx:t,miny:e,maxx:n,maxy:r}=i;return[[t,e],[n,r]]}function tct(i){return Sp(i).map(t=>ect(t))}function ect(i){const{CRS:t,SRS:e,minx:n,miny:r,maxx:o,maxy:s,resx:l,resy:c}=i,y={crs:t||e,boundingBox:[[Z0(n),Z0(r)],[Z0(o),Z0(s)]]};return l&&(y.xResolution=l),c&&(y.yResolution=c),y}function ict(i){const{name:t,units:e,value:n}=i,r={name:t,units:e,extent:n};return i.unitSymbol&&(r.unitSymbol=i.unitSymbol),i.default&&(r.defaultValue=i.default),i.multipleValues&&(r.multipleValues=pp(i.multipleValues)),i.nearestValue&&(r.nearestValue=pp(i.nearestValue)),i.current&&(r.current=pp(i.current)),r}function i5(i,t){t?.geographicBoundingBox&&!i.geographicBoundingBox&&(i.geographicBoundingBox=[...t.geographicBoundingBox]),t?.crs&&!i.crs&&(i.crs=[...t.crs]),t?.boundingBoxes&&!i.boundingBoxes&&(i.boundingBoxes=[...t.boundingBoxes]),t?.dimensions&&!i.dimensions&&(i.dimensions=[...t.dimensions]);for(const e of i.layers||[])i5(e,i)}const nct="4.3.3",Dw={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:nct,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:rct,options:{wms:{}},parse:async(i,t)=>n4(new TextDecoder().decode(i),t?.wms),parseTextSync:(i,t)=>n4(i,t?.wms)};function rct(i){return i.startsWith("<?xml")}function r4(i,t){const e=(Tp.parseTextSync?.(i,t)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(e)?e:[e]).map(n=>sct(n))}}function sct(i){return{attributes:i||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const oct={...Dw,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(i,t)=>r4(new TextDecoder().decode(i),t),parseTextSync:(i,t)=>r4(i,t)};function s4(i,t){return Tp.parseTextSync?.(i,t)}const act={...Dw,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(i,t)=>s4(new TextDecoder().decode(i),t),parseTextSync:(i,t)=>s4(i,t)},lct={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:i=>i.toLowerCase().includes("wms"),createDataSource:(i,t)=>new uct(i,t)};class uct extends K2{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(t,e){super(e),this.url=t,this.data=t,this.substituteCRS84=e.wms?.substituteCRS84??e.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...e.wmsParameters,...e.wms?.wmsParameters},this.vendorParameters=e.wms?.vendorParameters||e.vendorParameters||{}}async getMetadata(){const t=await this.getCapabilities();return this.normalizeMetadata(t)}async getImage(t){const{boundingBox:e,bbox:n,...r}=t,o={bbox:e?[...e[0],...e[1]]:n,...r};return await this.getMap(o)}normalizeMetadata(t){return t}async getCapabilities(t,e){const n=this.getCapabilitiesURL(t,e),r=await this.fetch(n),o=await r.arrayBuffer();this._checkResponse(r,o);const s=await Dw.parse(o,this.loadOptions);return this.capabilities=s,s}async getMap(t,e){const n=this.getMapURL(t,e),r=await this.fetch(n),o=await r.arrayBuffer();this._checkResponse(r,o);try{return await zg.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}async getFeatureInfo(t,e){const n=this.getFeatureInfoURL(t,e),r=await this.fetch(n),o=await r.arrayBuffer();return this._checkResponse(r,o),await oct.parse(o,this.loadOptions)}async getFeatureInfoText(t,e){const n=this.getFeatureInfoURL(t,e),r=await this.fetch(n),o=await r.arrayBuffer();return this._checkResponse(r,o),new TextDecoder().decode(o)}async describeLayer(t,e){const n=this.describeLayerURL(t,e),r=await this.fetch(n),o=await r.arrayBuffer();return this._checkResponse(r,o),await act.parse(o,this.loadOptions)}async getLegendGraphic(t,e){const n=this.getLegendGraphicURL(t,e),r=await this.fetch(n),o=await r.arrayBuffer();this._checkResponse(r,o);try{return await zg.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}getCapabilitiesURL(t,e){const n={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetCapabilities",n,e)}getMapURL(t,e){t=this._getWMS130Parameters(t);const n={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetMap",n,e)}getFeatureInfoURL(t,e){t=this._getWMS130Parameters(t);const{boundingBox:n,bbox:r}=t;t.bbox=n?[...n[0],...n[1]]:r;const o={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetFeatureInfo",o,e)}describeLayerURL(t,e){const n={version:this.wmsParameters.version,...t};return this._getWMSUrl("DescribeLayer",n,e)}getLegendGraphicURL(t,e){const n={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetLegendGraphic",n,e)}_parseWMSUrl(t){const[e,n]=t.split("?"),r=n.split("&"),o={};for(const s of r){const[l,c]=s.split("=");o[l]=c}return{url:e,parameters:o}}_getWMSUrl(t,e,n){let r=this.url,o=!0;const s={service:"WMS",version:e.version,request:t,...e,...this.vendorParameters,...n},l=["transparent","time","elevation"];for(const[c,y]of Object.entries(s))(!l.includes(c)||y)&&(r+=o?"?":"&",o=!1,r+=this._getURLParameter(c,y,e));return encodeURI(r)}_getWMS130Parameters(t){const e={...t};return e.srs&&(e.crs=e.crs||e.srs,delete e.srs),e}_getURLParameter(t,e,n){switch(t){case"crs":n.version!=="1.3.0"?t="srs":this.substituteCRS84&&e==="EPSG:4326"&&(e="CRS:84");break;case"srs":n.version==="1.3.0"&&(t="crs");break;case"bbox":const r=this._flipBoundingBox(e,n);r&&(e=r);break;case"x":n.version==="1.3.0"&&(t="i");break;case"y":n.version==="1.3.0"&&(t="j");break}return t=t.toUpperCase(),Array.isArray(e)?`${t}=${e.join(",")}`:`${t}=${e?String(e):""}`}_flipBoundingBox(t,e){if(!Array.isArray(t)||t.length!==4)return null;const n=e.version==="1.3.0"&&this.flipCRS.includes(e.crs||"")&&!(this.substituteCRS84&&e.crs==="EPSG:4326"),r=t;return n?[r[1],r[0],r[3],r[2]]:r}async _fetchArrayBuffer(t){const e=await this.fetch(t),n=await e.arrayBuffer();return this._checkResponse(e,n),n}_checkResponse(t,e){const n=t.headers["content-type"];if(!t.ok||Bg.mimeTypes.includes(n)){const r=i6(this.loadOptions,{wms:{throwOnError:!0}}),o=Bg.parseSync?.(e,r);throw new Error(o)}}_parseError(t){const e=Bg.parseSync?.(t,this.loadOptions);return new Error(e)}}const cct={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:i=>i.toLowerCase().includes("ImageServer"),createDataSource:(i,t)=>new hct(i,t)};class hct extends K2{url;data;constructor(t,e){super(e),this.url=t,this.data=t}async getMetadata(){return await this.metadata()}async getImage(t){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(t){throw new Error("not implemented")}metadataURL(t){return`${this.url}?f=pjson`}exportImageURL(t){const e=`bbox=${t.bbox[0]},${t.bbox[1]},${t.bbox[2]},${t.bbox[3]}`,n=`size=${t.width},${t.height}`,r={...t,bbox:e,size:n};return delete r.width,delete r.height,this.getUrl("exportImage",r)}getUrl(t,e,n){let r=`${this.url}/${t}`,o=!0;for(const[s,l]of Object.entries(e))r+=o?"?":"&",o=!1,Array.isArray(l)?r+=`${s.toUpperCase()}=${l.join(",")}`:r+=`${s.toUpperCase()}=${l?String(l):""}`;return r}async checkResponse(t){if(!t.ok)throw new Error("error")}}const fct=[lct,cct];function dct(i,t=fct){const{type:e="auto"}=i,n=e==="auto"?Act(i.url,t):pct(e,t);if(!n)throw new Error("Not a valid image source type");return n.createDataSource(i.url,i)}function pct(i,t){for(const e of t)if(e.type===i)return e;return null}function Act(i,t){for(const e of t)if(e.testURL&&e.testURL(i))return e;return null}const o4=6378137*Math.PI;function a4(i){const t=$u(i);return t[0]=(t[0]/256-1)*o4,t[1]=(t[1]/256-1)*o4,t}const mct={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(i,t)=>console.error(t,i)}};class kw extends Is{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:t,props:e,oldProps:n}){const{viewport:r}=this.context;t.dataChanged||e.serviceType!==n.serviceType?(this.state.imageSource=this._createImageSource(e),this._loadMetadata(),this.debounce(()=>this.loadImage(r,"image source changed"),0)):Or(e.layers,n.layers,1)?t.viewportChanged&&this.debounce(()=>this.loadImage(r,"viewport changed")):this.debounce(()=>this.loadImage(r,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:t,image:e,lastRequestParameters:n}=this.state;return e&&new Xy({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:n.srs==="EPSG:4326"?nn.LNGLAT:nn.CARTESIAN,bounds:t,image:e})}async getFeatureInfoText(t,e){const{lastRequestParameters:n}=this.state;return n?await this.state.imageSource.getFeatureInfoText?.({...n,query_layers:n.layers,x:t,y:e,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(t){if(t.data instanceof K2)return t.data;if(typeof t.data=="string")return dct({url:t.data,loadOptions:t.loadOptions,type:t.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){const{imageSource:t}=this.state;try{this.state.loadCounter++;const e=await t.getMetadata();this.state.imageSource===t&&this.getCurrentLayer()?.props.onMetadataLoad(e)}catch(e){this.getCurrentLayer()?.props.onMetadataLoadError(e)}finally{this.state.loadCounter--}}async loadImage(t,e){const{layers:n,serviceType:r}=this.props;if(r==="wms"&&n.length===0)return;const o=t.getBounds(),{width:s,height:l}=t,c=this.getRequestId();let{srs:y}=this.props;y==="auto"&&(y=t.resolution?"EPSG:4326":"EPSG:3857");const _={width:s,height:l,boundingBox:[[o[0],o[1]],[o[2],o[3]]],layers:n,crs:y};if(y==="EPSG:3857"){const C=a4([o[0],o[1]]),I=a4([o[2],o[3]]);_.boundingBox=[C,I]}try{this.state.loadCounter++,this.props.onImageLoadStart(c);const C=await this.state.imageSource.getImage(_);this.state.lastRequestId<c&&(this.getCurrentLayer()?.props.onImageLoad(c),this.setState({image:C,bounds:o,lastRequestParameters:_,lastRequestId:c}))}catch(C){this.raiseError(C,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(c,C)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(t,e=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>t(),e)}}kw.layerName="WMSLayer";kw.defaultProps=mct;const gct={getHeight:{type:"accessor",value:0},greatCircle:!0};class Ow extends bm{}Ow.layerName="GreatCircleLayer";Ow.defaultProps=gct;function yct(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var x2={exports:{}},vct=x2.exports,l4;function _ct(){return l4||(l4=1,(function(i){(function(t,e){typeof yct=="function"&&i&&i.exports?i.exports=e():(t.dcodeIO=t.dcodeIO||{}).Long=e()})(vct,function(){function t(st,Ut,K){this.low=st|0,this.high=Ut|0,this.unsigned=!!K}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function e(st){return(st&&st.__isLong__)===!0}t.isLong=e;var n={},r={};function o(st,Ut){var K,dt,Tt;return Ut?(st>>>=0,(Tt=0<=st&&st<256)&&(dt=r[st],dt)?dt:(K=l(st,(st|0)<0?-1:0,!0),Tt&&(r[st]=K),K)):(st|=0,(Tt=-128<=st&&st<128)&&(dt=n[st],dt)?dt:(K=l(st,st<0?-1:0,!1),Tt&&(n[st]=K),K))}t.fromInt=o;function s(st,Ut){if(isNaN(st)||!isFinite(st))return Ut?$:H;if(Ut){if(st<0)return $;if(st>=z)return Ot}else{if(st<=-V)return Kt;if(st+1>=V)return nt}return st<0?s(-st,Ut).neg():l(st%k|0,st/k|0,Ut)}t.fromNumber=s;function l(st,Ut,K){return new t(st,Ut,K)}t.fromBits=l;var c=Math.pow;function y(st,Ut,K){if(st.length===0)throw Error("empty string");if(st==="NaN"||st==="Infinity"||st==="+Infinity"||st==="-Infinity")return H;if(typeof Ut=="number"?(K=Ut,Ut=!1):Ut=!!Ut,K=K||10,K<2||36<K)throw RangeError("radix");var dt;if((dt=st.indexOf("-"))>0)throw Error("interior hyphen");if(dt===0)return y(st.substring(1),Ut,K).neg();for(var Tt=s(c(K,8)),ue=H,Rt=0;Rt<st.length;Rt+=8){var Ft=Math.min(8,st.length-Rt),Gt=parseInt(st.substring(Rt,Rt+Ft),K);if(Ft<8){var se=s(c(K,Ft));ue=ue.mul(se).add(s(Gt))}else ue=ue.mul(Tt),ue=ue.add(s(Gt))}return ue.unsigned=Ut,ue}t.fromString=y;function _(st){return st instanceof t?st:typeof st=="number"?s(st):typeof st=="string"?y(st):l(st.low,st.high,st.unsigned)}t.fromValue=_;var C=65536,I=1<<24,k=C*C,z=k*k,V=z/2,X=o(I),H=o(0);t.ZERO=H;var $=o(0,!0);t.UZERO=$;var Y=o(1);t.ONE=Y;var ct=o(1,!0);t.UONE=ct;var rt=o(-1);t.NEG_ONE=rt;var nt=l(-1,2147483647,!1);t.MAX_VALUE=nt;var Ot=l(-1,-1,!0);t.MAX_UNSIGNED_VALUE=Ot;var Kt=l(0,-2147483648,!1);t.MIN_VALUE=Kt;var ft=t.prototype;return ft.toInt=function(){return this.unsigned?this.low>>>0:this.low},ft.toNumber=function(){return this.unsigned?(this.high>>>0)*k+(this.low>>>0):this.high*k+(this.low>>>0)},ft.toString=function(st){if(st=st||10,st<2||36<st)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Kt)){var Ut=s(st),K=this.div(Ut),dt=K.mul(Ut).sub(this);return K.toString(st)+dt.toInt().toString(st)}else return"-"+this.neg().toString(st);for(var Tt=s(c(st,6),this.unsigned),ue=this,Rt="";;){var Ft=ue.div(Tt),Gt=ue.sub(Ft.mul(Tt)).toInt()>>>0,se=Gt.toString(st);if(ue=Ft,ue.isZero())return se+Rt;for(;se.length<6;)se="0"+se;Rt=""+se+Rt}},ft.getHighBits=function(){return this.high},ft.getHighBitsUnsigned=function(){return this.high>>>0},ft.getLowBits=function(){return this.low},ft.getLowBitsUnsigned=function(){return this.low>>>0},ft.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Kt)?64:this.neg().getNumBitsAbs();for(var st=this.high!=0?this.high:this.low,Ut=31;Ut>0&&(st&1<<Ut)==0;Ut--);return this.high!=0?Ut+33:Ut+1},ft.isZero=function(){return this.high===0&&this.low===0},ft.isNegative=function(){return!this.unsigned&&this.high<0},ft.isPositive=function(){return this.unsigned||this.high>=0},ft.isOdd=function(){return(this.low&1)===1},ft.isEven=function(){return(this.low&1)===0},ft.equals=function(st){return e(st)||(st=_(st)),this.unsigned!==st.unsigned&&this.high>>>31===1&&st.high>>>31===1?!1:this.high===st.high&&this.low===st.low},ft.eq=ft.equals,ft.notEquals=function(st){return!this.eq(st)},ft.neq=ft.notEquals,ft.lessThan=function(st){return this.comp(st)<0},ft.lt=ft.lessThan,ft.lessThanOrEqual=function(st){return this.comp(st)<=0},ft.lte=ft.lessThanOrEqual,ft.greaterThan=function(st){return this.comp(st)>0},ft.gt=ft.greaterThan,ft.greaterThanOrEqual=function(st){return this.comp(st)>=0},ft.gte=ft.greaterThanOrEqual,ft.compare=function(st){if(e(st)||(st=_(st)),this.eq(st))return 0;var Ut=this.isNegative(),K=st.isNegative();return Ut&&!K?-1:!Ut&&K?1:this.unsigned?st.high>>>0>this.high>>>0||st.high===this.high&&st.low>>>0>this.low>>>0?-1:1:this.sub(st).isNegative()?-1:1},ft.comp=ft.compare,ft.negate=function(){return!this.unsigned&&this.eq(Kt)?Kt:this.not().add(Y)},ft.neg=ft.negate,ft.add=function(st){e(st)||(st=_(st));var Ut=this.high>>>16,K=this.high&65535,dt=this.low>>>16,Tt=this.low&65535,ue=st.high>>>16,Rt=st.high&65535,Ft=st.low>>>16,Gt=st.low&65535,se=0,le=0,de=0,ye=0;return ye+=Tt+Gt,de+=ye>>>16,ye&=65535,de+=dt+Ft,le+=de>>>16,de&=65535,le+=K+Rt,se+=le>>>16,le&=65535,se+=Ut+ue,se&=65535,l(de<<16|ye,se<<16|le,this.unsigned)},ft.subtract=function(st){return e(st)||(st=_(st)),this.add(st.neg())},ft.sub=ft.subtract,ft.multiply=function(st){if(this.isZero()||(e(st)||(st=_(st)),st.isZero()))return H;if(this.eq(Kt))return st.isOdd()?Kt:H;if(st.eq(Kt))return this.isOdd()?Kt:H;if(this.isNegative())return st.isNegative()?this.neg().mul(st.neg()):this.neg().mul(st).neg();if(st.isNegative())return this.mul(st.neg()).neg();if(this.lt(X)&&st.lt(X))return s(this.toNumber()*st.toNumber(),this.unsigned);var Ut=this.high>>>16,K=this.high&65535,dt=this.low>>>16,Tt=this.low&65535,ue=st.high>>>16,Rt=st.high&65535,Ft=st.low>>>16,Gt=st.low&65535,se=0,le=0,de=0,ye=0;return ye+=Tt*Gt,de+=ye>>>16,ye&=65535,de+=dt*Gt,le+=de>>>16,de&=65535,de+=Tt*Ft,le+=de>>>16,de&=65535,le+=K*Gt,se+=le>>>16,le&=65535,le+=dt*Ft,se+=le>>>16,le&=65535,le+=Tt*Rt,se+=le>>>16,le&=65535,se+=Ut*Gt+K*Ft+dt*Rt+Tt*ue,se&=65535,l(de<<16|ye,se<<16|le,this.unsigned)},ft.mul=ft.multiply,ft.divide=function(st){if(e(st)||(st=_(st)),st.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?$:H;var Ut,K,dt;if(this.unsigned){if(st.unsigned||(st=st.toUnsigned()),st.gt(this))return $;if(st.gt(this.shru(1)))return ct;dt=$}else{if(this.eq(Kt)){if(st.eq(Y)||st.eq(rt))return Kt;if(st.eq(Kt))return Y;var Tt=this.shr(1);return Ut=Tt.div(st).shl(1),Ut.eq(H)?st.isNegative()?Y:rt:(K=this.sub(st.mul(Ut)),dt=Ut.add(K.div(st)),dt)}else if(st.eq(Kt))return this.unsigned?$:H;if(this.isNegative())return st.isNegative()?this.neg().div(st.neg()):this.neg().div(st).neg();if(st.isNegative())return this.div(st.neg()).neg();dt=H}for(K=this;K.gte(st);){Ut=Math.max(1,Math.floor(K.toNumber()/st.toNumber()));for(var ue=Math.ceil(Math.log(Ut)/Math.LN2),Rt=ue<=48?1:c(2,ue-48),Ft=s(Ut),Gt=Ft.mul(st);Gt.isNegative()||Gt.gt(K);)Ut-=Rt,Ft=s(Ut,this.unsigned),Gt=Ft.mul(st);Ft.isZero()&&(Ft=Y),dt=dt.add(Ft),K=K.sub(Gt)}return dt},ft.div=ft.divide,ft.modulo=function(st){return e(st)||(st=_(st)),this.sub(this.div(st).mul(st))},ft.mod=ft.modulo,ft.not=function(){return l(~this.low,~this.high,this.unsigned)},ft.and=function(st){return e(st)||(st=_(st)),l(this.low&st.low,this.high&st.high,this.unsigned)},ft.or=function(st){return e(st)||(st=_(st)),l(this.low|st.low,this.high|st.high,this.unsigned)},ft.xor=function(st){return e(st)||(st=_(st)),l(this.low^st.low,this.high^st.high,this.unsigned)},ft.shiftLeft=function(st){return e(st)&&(st=st.toInt()),(st&=63)===0?this:st<32?l(this.low<<st,this.high<<st|this.low>>>32-st,this.unsigned):l(0,this.low<<st-32,this.unsigned)},ft.shl=ft.shiftLeft,ft.shiftRight=function(st){return e(st)&&(st=st.toInt()),(st&=63)===0?this:st<32?l(this.low>>>st|this.high<<32-st,this.high>>st,this.unsigned):l(this.high>>st-32,this.high>=0?0:-1,this.unsigned)},ft.shr=ft.shiftRight,ft.shiftRightUnsigned=function(st){if(e(st)&&(st=st.toInt()),st&=63,st===0)return this;var Ut=this.high;if(st<32){var K=this.low;return l(K>>>st|Ut<<32-st,Ut>>>st,this.unsigned)}else return st===32?l(Ut,0,this.unsigned):l(Ut>>>st-32,0,this.unsigned)},ft.shru=ft.shiftRightUnsigned,ft.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},ft.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},ft.toBytes=function(st){return st?this.toBytesLE():this.toBytesBE()},ft.toBytesLE=function(){var st=this.high,Ut=this.low;return[Ut&255,Ut>>>8&255,Ut>>>16&255,Ut>>>24&255,st&255,st>>>8&255,st>>>16&255,st>>>24&255]},ft.toBytesBE=function(){var st=this.high,Ut=this.low;return[st>>>24&255,st>>>16&255,st>>>8&255,st&255,Ut>>>24&255,Ut>>>16&255,Ut>>>8&255,Ut&255]},t})})(x2)),x2.exports}var bct=_ct();const Rg=df(bct),xct=3,wct=30,Ect=2*wct+1,u4=180/Math.PI;function Cct(i,t,e){const n=1<<t;return[(i[0]+e[0])/n,(i[1]+e[1])/n]}function c4(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))}function Tct(i){return[c4(i[0]),c4(i[1])]}function Sct(i,[t,e]){switch(i){case 0:return[1,t,e];case 1:return[-t,1,e];case 2:return[-t,-e,1];case 3:return[-1,-e,-t];case 4:return[e,-1,-t];case 5:return[e,t,-1];default:throw new Error("Invalid face")}}function Pct([i,t,e]){const n=Math.atan2(e,Math.sqrt(i*i+t*t));return[Math.atan2(t,i)*u4,n*u4]}function Ict(i){let t=Rg.fromString(i,!0,10).toString(2);for(;t.length<xct+Ect;)t="0"+t;const e=t.lastIndexOf("1"),n=t.substring(0,3),r=t.substring(3,e),o=r.length/2,s=Rg.fromString(n,!0,2).toString(10);let l=Rg.fromString(r,!0,2).toString(4);for(;l.length<o;)l="0"+l;return`${s}/${l}`}function Mct(i,t,e,n){if(n===0){e===1&&(t[0]=i-1-t[0],t[1]=i-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function Bct(i){const t=i.split("/"),e=parseInt(t[0],10),n=t[1],r=n.length,o=[0,0];let s;for(let l=r-1;l>=0;l--){s=r-l;const c=n[l];let y=0,_=0;c==="1"?_=1:c==="2"?(y=1,_=1):c==="3"&&(y=1);const C=Math.pow(2,s-1);Mct(C,o,y,_),o[0]+=C*y,o[1]+=C*_}if(e%2===1){const l=o[0];o[0]=o[1],o[1]=l}return{face:e,ij:o,level:s}}function Rct(i){const t=i.padEnd(16,"0");return Rg.fromString(t,16)}const Lct=100;function Dct({face:i,ij:t,level:e}){const n=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(Lct*Math.pow(2,-e))),o=new Float64Array(4*r*2+2);let s=0,l=0;for(let c=0;c<4;c++){const y=n[c].slice(0),_=n[c+1],C=(_[0]-y[0])/r,I=(_[1]-y[1])/r;for(let k=0;k<r;k++){y[0]+=C,y[1]+=I;const z=Cct(t,e,y),V=Tct(z),X=Sct(i,V),H=Pct(X);Math.abs(H[1])>89.999&&(H[0]=l);const $=H[0]-l;H[0]+=$>180?-360:$<-180?360:0,o[s++]=H[0],o[s++]=H[1],l=H[0]}}return o[s++]=o[0],o[s++]=o[1],o}function kct(i){if(typeof i=="string"){if(i.indexOf("/")>0)return i;i=Rct(i)}return Ict(i.toString())}function Oct(i){const t=kct(i),e=Bct(t);return Dct(e)}const Fct={getS2Token:{type:"accessor",value:i=>i.token}};class rv extends sc{indexToBounds(){const{data:t,getS2Token:e}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(n,r)=>Oct(e(n,r))}}}rv.layerName="S2Layer";rv.defaultProps=Fct;const T1=512;function Nct(i,t){let e=0,n=0,r=1<<i.length;const o=r/T1;for(let s=0;s<i.length;s++){r>>=1;const l=parseInt(i[s]);l%2&&(e|=r),l>1&&(n|=r)}return[[e/o,T1-n/o],[(e+t)/o,T1-(n+t)/o]]}function zct(i,t=1){const[e,n]=Nct(i,t),[r,o]=lu(e),[s,l]=lu(n);return[s,o,s,l,r,l,r,o,s,o]}const Uct={getQuadkey:{type:"accessor",value:i=>i.quadkey}};class sv extends sc{indexToBounds(){const{data:t,extruded:e,getQuadkey:n}=this.props,r=e?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>zct(n(o,s),r),updateTriggers:{getPolygon:r}}}}sv.layerName="QuadkeyLayer";sv.defaultProps=Uct;class n5{constructor(t){this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,"west"in t?this.boundingBox=[[t.west,t.south],[t.east,t.north]]:this.boundingBox=[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:e,onLoad:n,onError:r}){const{index:o,id:s,bbox:l,userData:c,zoom:y}=this,_=this._loaderId;this._abortController=new AbortController;const{signal:C}=this._abortController,I=await e.scheduleRequest(this,V=>V.isSelected?1:-1);if(!I){this._isCancelled=!0;return}if(this._isCancelled){I.done();return}let k=null,z;try{k=await t({index:o,id:s,bbox:l,userData:c,zoom:y,signal:C})}catch(V){z=V||!0}finally{I.done()}if(_===this._loaderId){if(this._loader=void 0,this.content=k,this._isCancelled&&!k){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,z?r(z,this):n(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const go={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},h4=new ve,Vct=new ve;class Fw{constructor(t=[0,0,0],e=[0,0,0],n){n=n||h4.copy(t).add(e).scale(.5),this.center=new ve(n),this.halfDiagonal=new ve(e).subtract(this.center),this.minimum=new ve(t),this.maximum=new ve(e)}clone(){return new Fw(this.minimum,this.maximum,this.center)}equals(t){return this===t||!!t&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:e}=this,n=Vct.from(t.normal),r=e.x*Math.abs(n.x)+e.y*Math.abs(n.y)+e.z*Math.abs(n.z),o=this.center.dot(n)+t.distance;return o-r>0?go.INSIDE:o+r<0?go.OUTSIDE:go.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=h4.from(t).subtract(this.center),{halfDiagonal:n}=this;let r=0,o;return o=Math.abs(e.x)-n.x,o>0&&(r+=o*o),o=Math.abs(e.y)-n.y,o>0&&(r+=o*o),o=Math.abs(e.z)-n.z,o>0&&(r+=o*o),r}}const xA=new ve,f4=new ve;class Tm{constructor(t=[0,0,0],e=0){this.radius=-0,this.center=new ve,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=xA.from(e),this.center=new ve().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Tm(this.center,this.radius)}union(t){const e=this.center,n=this.radius,r=t.center,o=t.radius,s=xA.copy(r).subtract(e),l=s.magnitude();if(n>=l+o)return this.clone();if(o>=l+n)return t.clone();const c=(n+l+o)*.5;return f4.copy(s).scale((-n+c)/l).add(e),this.center.copy(f4),this.radius=c,this}expand(t){const e=xA.from(t).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=DV(xA,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=xA.from(t).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,n=this.radius,r=t.normal.dot(e)+t.distance;return r<-n?go.OUTSIDE:r<n?go.INTERSECTING:go.INSIDE}}const Gct=new ve,jct=new ve,Y0=new ve,Q0=new ve,J0=new ve,Wct=new ve,Hct=new ve,Uu={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Sm{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){this.center=new ve().from(t),this.halfAxes=new ts(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new ve(t).len(),new ve(e).len(),new ve(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),r=new ve(t).normalize(),o=new ve(e).normalize(),s=new ve(n).normalize();return new em().fromMatrix3(new ts([...r,...o,...s]))}fromCenterHalfSizeQuaternion(t,e,n){const r=new em(n),o=new ts().fromQuaternion(r);return o[0]=o[0]*e[0],o[1]=o[1]*e[0],o[2]=o[2]*e[0],o[3]=o[3]*e[1],o[4]=o[4]*e[1],o[5]=o[5]*e[1],o[6]=o[6]*e[2],o[7]=o[7]*e[2],o[8]=o[8]*e[2],this.center=new ve().from(t),this.halfAxes=o,this}clone(){return new Sm(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Tm){const e=this.halfAxes,n=e.getColumn(0,Y0),r=e.getColumn(1,Q0),o=e.getColumn(2,J0),s=Gct.copy(n).add(r).add(o);return t.center.copy(this.center),t.radius=s.magnitude(),t}intersectPlane(t){const e=this.center,n=t.normal,r=this.halfAxes,o=n.x,s=n.y,l=n.z,c=Math.abs(o*r[Uu.COLUMN0ROW0]+s*r[Uu.COLUMN0ROW1]+l*r[Uu.COLUMN0ROW2])+Math.abs(o*r[Uu.COLUMN1ROW0]+s*r[Uu.COLUMN1ROW1]+l*r[Uu.COLUMN1ROW2])+Math.abs(o*r[Uu.COLUMN2ROW0]+s*r[Uu.COLUMN2ROW1]+l*r[Uu.COLUMN2ROW2]),y=n.dot(e)+t.distance;return y<=-c?go.OUTSIDE:y>=c?go.INSIDE:go.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=jct.from(t).subtract(this.center),n=this.halfAxes,r=n.getColumn(0,Y0),o=n.getColumn(1,Q0),s=n.getColumn(2,J0),l=r.magnitude(),c=o.magnitude(),y=s.magnitude();r.normalize(),o.normalize(),s.normalize();let _=0,C;return C=Math.abs(e.dot(r))-l,C>0&&(_+=C*C),C=Math.abs(e.dot(o))-c,C>0&&(_+=C*C),C=Math.abs(e.dot(s))-y,C>0&&(_+=C*C),_}computePlaneDistances(t,e,n=[-0,-0]){let r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const s=this.center,l=this.halfAxes,c=l.getColumn(0,Y0),y=l.getColumn(1,Q0),_=l.getColumn(2,J0),C=Wct.copy(c).add(y).add(_).add(s),I=Hct.copy(C).subtract(t);let k=e.dot(I);return r=Math.min(k,r),o=Math.max(k,o),C.copy(s).add(c).add(y).subtract(_),I.copy(C).subtract(t),k=e.dot(I),r=Math.min(k,r),o=Math.max(k,o),C.copy(s).add(c).subtract(y).add(_),I.copy(C).subtract(t),k=e.dot(I),r=Math.min(k,r),o=Math.max(k,o),C.copy(s).add(c).subtract(y).subtract(_),I.copy(C).subtract(t),k=e.dot(I),r=Math.min(k,r),o=Math.max(k,o),s.copy(C).subtract(c).add(y).add(_),I.copy(C).subtract(t),k=e.dot(I),r=Math.min(k,r),o=Math.max(k,o),s.copy(C).subtract(c).add(y).subtract(_),I.copy(C).subtract(t),k=e.dot(I),r=Math.min(k,r),o=Math.max(k,o),s.copy(C).subtract(c).subtract(y).add(_),I.copy(C).subtract(t),k=e.dot(I),r=Math.min(k,r),o=Math.max(k,o),s.copy(C).subtract(c).subtract(y).subtract(_),I.copy(C).subtract(t),k=e.dot(I),r=Math.min(k,r),o=Math.max(k,o),n[0]=r,n[1]=o,n}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,Y0);e.transformAsPoint(t);const n=this.halfAxes.getColumn(1,Q0);n.transformAsPoint(t);const r=this.halfAxes.getColumn(2,J0);return r.transformAsPoint(t),this.halfAxes=new ts([...e,...n,...r]),this}getTransform(){throw new Error("not implemented")}}const d4=new ve,p4=new ve;class cl{constructor(t=[0,0,1],e=0){this.normal=new ve,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return hl(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=d4.from(t),this.normal.from(e).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,e,n,r){return this.normal.set(t,e,n),hl(Aa(this.normal.len(),1)),this.distance=r,this}clone(){return new cl(this.normal,this.distance)}equals(t){return Aa(this.distance,t.distance)&&Aa(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=p4.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}projectPointOntoPlane(t,e=[0,0,0]){const n=d4.from(t),r=this.getPointDistance(n),o=p4.copy(this.normal).scale(r);return n.subtract(o).to(e)}}const A4=[new ve([1,0,0]),new ve([0,1,0]),new ve([0,0,1])],m4=new ve,Xct=new ve;class pa{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*A4.length;const e=t.center,n=t.radius;let r=0;for(const o of A4){let s=this.planes[r],l=this.planes[r+1];s||(s=this.planes[r]=new cl),l||(l=this.planes[r+1]=new cl);const c=m4.copy(o).scale(-n).add(e);s.fromPointNormal(c,o);const y=m4.copy(o).scale(n).add(e),_=Xct.copy(o).negate();l.fromPointNormal(y,_),r+=2}return this}computeVisibility(t){let e=go.INSIDE;for(const n of this.planes)switch(t.intersectPlane(n)){case go.OUTSIDE:return go.OUTSIDE;case go.INTERSECTING:e=go.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(hl(Number.isFinite(e),"parentPlaneMask is required."),e===pa.MASK_OUTSIDE||e===pa.MASK_INSIDE)return e;let n=pa.MASK_INSIDE;const r=this.planes;for(let o=0;o<this.planes.length;++o){const s=o<31?1<<o:0;if(o<31&&(e&s)===0)continue;const l=r[o],c=t.intersectPlane(l);if(c===go.OUTSIDE)return pa.MASK_OUTSIDE;c===go.INTERSECTING&&(n|=s)}return n}}pa.MASK_OUTSIDE=4294967295;pa.MASK_INSIDE=0;pa.MASK_INDETERMINATE=2147483647;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;new ve;const Jl=new ts,qct=new ts,Kct=new ts,$0=new ts,g4=new ts;function Zct(i,t={}){const e=vG,n=10;let r=0,o=0;const s=qct,l=Kct;s.identity(),l.copy(i);const c=e*Yct(l);for(;o<n&&Qct(l)>c;)Jct(l,$0),g4.copy($0).transpose(),l.multiplyRight($0),l.multiplyLeft(g4),s.multiplyRight($0),++r>2&&(++o,r=0);return t.unitary=s.toTarget(t.unitary),t.diagonal=l.toTarget(t.diagonal),t}function Yct(i){let t=0;for(let e=0;e<9;++e){const n=i[e];t+=n*n}return Math.sqrt(t)}const w2=[1,0,0],E2=[2,2,1];function Qct(i){let t=0;for(let e=0;e<3;++e){const n=i[Jl.getElementIndex(E2[e],w2[e])];t+=2*n*n}return Math.sqrt(t)}function Jct(i,t){const e=BR;let n=0,r=1;for(let y=0;y<3;++y){const _=Math.abs(i[Jl.getElementIndex(E2[y],w2[y])]);_>n&&(r=y,n=_)}const o=w2[r],s=E2[r];let l=1,c=0;if(Math.abs(i[Jl.getElementIndex(s,o)])>e){const y=i[Jl.getElementIndex(s,s)],_=i[Jl.getElementIndex(o,o)],C=i[Jl.getElementIndex(s,o)],I=(y-_)/2/C;let k;I<0?k=-1/(-I+Math.sqrt(1+I*I)):k=1/(I+Math.sqrt(1+I*I)),l=1/Math.sqrt(1+k*k),c=k*l}return ts.IDENTITY.to(t),t[Jl.getElementIndex(o,o)]=t[Jl.getElementIndex(s,s)]=l,t[Jl.getElementIndex(s,o)]=c,t[Jl.getElementIndex(o,s)]=-c,t}const Fc=new ve,$ct=new ve,tht=new ve,eht=new ve,iht=new ve,nht=new ts,rht={diagonal:new ts,unitary:new ts};function r5(i,t=new Sm){if(!i||i.length===0)return t.halfAxes=new ts([0,0,0,0,0,0,0,0,0]),t.center=new ve,t;const e=i.length,n=new ve(0,0,0);for(const ft of i)n.add(ft);const r=1/e;n.multiplyByScalar(r);let o=0,s=0,l=0,c=0,y=0,_=0;for(const ft of i){const st=Fc.copy(ft).subtract(n);o+=st.x*st.x,s+=st.x*st.y,l+=st.x*st.z,c+=st.y*st.y,y+=st.y*st.z,_+=st.z*st.z}o*=r,s*=r,l*=r,c*=r,y*=r,_*=r;const C=nht;C[0]=o,C[1]=s,C[2]=l,C[3]=s,C[4]=c,C[5]=y,C[6]=l,C[7]=y,C[8]=_;const{unitary:I}=Zct(C,rht),k=t.halfAxes.copy(I);let z=k.getColumn(0,tht),V=k.getColumn(1,eht),X=k.getColumn(2,iht),H=-Number.MAX_VALUE,$=-Number.MAX_VALUE,Y=-Number.MAX_VALUE,ct=Number.MAX_VALUE,rt=Number.MAX_VALUE,nt=Number.MAX_VALUE;for(const ft of i)Fc.copy(ft),H=Math.max(Fc.dot(z),H),$=Math.max(Fc.dot(V),$),Y=Math.max(Fc.dot(X),Y),ct=Math.min(Fc.dot(z),ct),rt=Math.min(Fc.dot(V),rt),nt=Math.min(Fc.dot(X),nt);z=z.multiplyByScalar(.5*(ct+H)),V=V.multiplyByScalar(.5*(rt+$)),X=X.multiplyByScalar(.5*(nt+Y)),t.center.copy(z).add(V).add(X);const Ot=$ct.set(H-ct,$-rt,Y-nt).multiplyByScalar(.5),Kt=new ts([Ot[0],0,0,0,Ot[1],0,0,0,Ot[2]]);return t.halfAxes.multiplyRight(Kt),t}const $d=512,y4=3,s5=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],o5=s5.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),sht=o5.concat([[.25,.5],[.75,.5]]);class tp{constructor(t,e,n){this.x=t,this.y=e,this.z=n}get children(){if(!this._children){const t=this.x*2,e=this.y*2,n=this.z+1;this._children=[new tp(t,e,n),new tp(t,e+1,n),new tp(t+1,e,n),new tp(t+1,e+1,n)]}return this._children}update(t){const{viewport:e,cullingVolume:n,elevationBounds:r,minZ:o,maxZ:s,bounds:l,offset:c,project:y}=t,_=this.getBoundingVolume(r,c,y);if(l&&!this.insideBounds(l)||n.computeVisibility(_)<0)return!1;if(!this.childVisible){let{z:C}=this;if(C<s&&C>=o){const I=_.distanceTo(e.cameraPosition)*e.scale/e.height;C+=Math.floor(Math.log2(I))}if(C>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const C of this.children)C.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const e of this._children)e.getSelected(t);return t}insideBounds([t,e,n,r]){const o=Math.pow(2,this.z),s=$d/o;return this.x*s<n&&this.y*s<r&&(this.x+1)*s>t&&(this.y+1)*s>e}getBoundingVolume(t,e,n){if(n){const c=this.z<1?sht:this.z<2?o5:s5,y=[];for(const _ of c){const C=T2(this.x+_[0],this.y+_[1],this.z);C[2]=t[0],y.push(n(C)),t[0]!==t[1]&&(C[2]=t[1],y.push(n(C)))}return r5(y)}const r=Math.pow(2,this.z),o=$d/r,s=this.x*o+e*$d,l=$d-(this.y+1)*o;return new Fw([s,l,t[0]],[s+o,l+o,t[1]])}}function oht(i,t,e,n){const r=i instanceof HZ&&i.resolution?i.projectPosition:null,o=Object.values(i.getFrustumPlanes()).map(({normal:k,distance:z})=>new cl(k.clone().negate(),z)),s=new pa(o),l=i.distanceScales.unitsPerMeter[2],c=e&&e[0]*l||0,y=e&&e[1]*l||0,_=i instanceof rm&&i.pitch<=60?t:0;if(n){const[k,z,V,X]=n,H=$u([k,X]),$=$u([V,z]);n=[H[0],$d-H[1],$[0],$d-$[1]]}const C=new tp(0,0,0),I={viewport:i,project:r,cullingVolume:s,elevationBounds:[c,y],minZ:_,maxZ:t,bounds:n,offset:0};if(C.update(I),i instanceof rm&&i.subViewports&&i.subViewports.length>1){for(I.offset=-1;C.update(I)&&!(--I.offset<-y4););for(I.offset=1;C.update(I)&&!(++I.offset>y4););}return C.getSelected()}const tc=512,aht=[-1/0,-1/0,1/0,1/0],gy={type:"object",value:null,validate:(i,t)=>t.optional&&i===null||typeof i=="string"||Array.isArray(i)&&i.every(e=>typeof e=="string"),equal:(i,t)=>{if(i===t)return!0;if(!Array.isArray(i)||!Array.isArray(t))return!1;const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}};function Nw(i,t){const e=[t.transformAsPoint([i[0],i[1]]),t.transformAsPoint([i[2],i[1]]),t.transformAsPoint([i[0],i[3]]),t.transformAsPoint([i[2],i[3]])];return[Math.min(...e.map(n=>n[0])),Math.min(...e.map(n=>n[1])),Math.max(...e.map(n=>n[0])),Math.max(...e.map(n=>n[1]))]}function lht(i){return Math.abs(i.split("").reduce((t,e)=>(t<<5)-t+e.charCodeAt(0)|0,0))}function uf(i,t){if(!i||!i.length)return null;const{index:e,id:n}=t;if(Array.isArray(i)){const o=lht(n)%i.length;i=i[o]}let r=i;for(const o of Object.keys(e)){const s=new RegExp(`{${o}}`,"g");r=r.replace(s,String(e[o]))}return Number.isInteger(e.y)&&Number.isInteger(e.z)&&(r=r.replace(/\{-y\}/g,String(Math.pow(2,e.z)-e.y-1))),r}function uht(i,t,e){let n;return n=i.getBounds(),i.isGeospatial?[Math.max(n[0],e[0]),Math.max(n[1],e[1]),Math.min(n[2],e[2]),Math.min(n[3],e[3])]:[Math.max(Math.min(n[0],e[2]),e[0]),Math.max(Math.min(n[1],e[3]),e[1]),Math.min(Math.max(n[2],e[0]),e[2]),Math.min(Math.max(n[3],e[1]),e[3])]}function cht({viewport:i,z:t,cullRect:e}){return(i.subViewports||[i]).map(n=>C2(n,t||0,e))}function C2(i,t,e){if(!Array.isArray(t)){const o=e.x-i.x,s=e.y-i.y,{width:l,height:c}=e,y={targetZ:t},_=i.unproject([o,s],y),C=i.unproject([o+l,s],y),I=i.unproject([o,s+c],y),k=i.unproject([o+l,s+c],y);return[Math.min(_[0],C[0],I[0],k[0]),Math.min(_[1],C[1],I[1],k[1]),Math.max(_[0],C[0],I[0],k[0]),Math.max(_[1],C[1],I[1],k[1])]}const n=C2(i,t[0],e),r=C2(i,t[1],e);return[Math.min(n[0],r[0]),Math.min(n[1],r[1]),Math.max(n[2],r[2]),Math.max(n[3],r[3])]}function hht(i,t,e){return e?Nw(i,e).map(n=>n*t/tc):i.map(n=>n*t/tc)}function zw(i,t){return Math.pow(2,i)*tc/t}function T2(i,t,e){const n=zw(e,tc),r=i/n*360-180,o=Math.PI-2*Math.PI*t/n,s=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[r,s]}function v4(i,t,e,n){const r=zw(e,n);return[i/r*tc,t/r*tc]}function fht(i,t,e,n,r=tc){if(i.isGeospatial){const[y,_]=T2(t,e,n),[C,I]=T2(t+1,e+1,n);return{west:y,north:_,east:C,south:I}}const[o,s]=v4(t,e,n,r),[l,c]=v4(t+1,e+1,n,r);return{left:o,top:s,right:l,bottom:c}}function dht(i,t,e,n,r){const o=uht(i,null,n),s=zw(t,e),[l,c,y,_]=hht(o,s,r),C=[];for(let I=Math.floor(l);I<y;I++)for(let k=Math.floor(c);k<_;k++)C.push({x:I,y:k,z:t});return C}function pht({viewport:i,maxZoom:t,minZoom:e,zRange:n,extent:r,tileSize:o=tc,modelMatrix:s,modelMatrixInverse:l,zoomOffset:c=0}){let y=i.isGeospatial?Math.round(i.zoom+Math.log2(tc/o))+c:Math.ceil(i.zoom)+c;if(typeof e=="number"&&Number.isFinite(e)&&y<e){if(!r)return[];y=e}typeof t=="number"&&Number.isFinite(t)&&y>t&&(y=t);let _=r;return s&&l&&r&&!i.isGeospatial&&(_=Nw(r,s)),i.isGeospatial?oht(i,y,n,r):dht(i,y,o,_||aht,l)}function Aht(i){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(i)}function mht(i){return Number.isFinite(i.west)&&Number.isFinite(i.north)&&Number.isFinite(i.east)&&Number.isFinite(i.south)}function ght(i){let t={},e;return n=>{for(const r in n)if(!yht(n[r],t[r])){e=i(n),t=n;break}return e}}function yht(i,t){if(i===t)return!0;if(Array.isArray(i)){const e=i.length;if(!t||t.length!==e)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}return!1}const _4=1,ov=2,vht="never",_ht="no-overlap",Uw="best-available",bht=5,xht={[Uw]:Eht,[_ht]:Cht,[vht]:()=>{}},wht={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class av{constructor(t){this._getCullBounds=ght(cht),this.opts={...wht,...t},this.setOptions(this.opts),this.onTileLoad=e=>{this.opts.onTileLoad?.(e),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new a6({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new bn,this._modelMatrixInverse=new bn}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const t of this._cache.keys()){const e=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(e)?this._cache.delete(t):e.setNeedsReload()}}update(t,{zRange:e,modelMatrix:n}={zRange:null,modelMatrix:null}){const r=n?new bn(n):new bn,o=!r.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!Aa(this._zRange,e)||o){o&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=t,this._zRange=e;const l=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:e,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=l.map(c=>this._getTile(c,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(l=>this._getTile(l.index,!0)));const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(t,e,n){if(!t.isVisible)return!1;if(e&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:e});let{bbox:o}=t;for(const[s,l,c,y]of r){let _;if("west"in o)_=o.west<c&&o.east>s&&o.south<y&&o.north>l;else{if(n&&!bn.IDENTITY.equals(n)){const[k,z,V,X]=Nw([o.left,o.top,o.right,o.bottom],n);o={left:k,top:z,right:V,bottom:X}}const C=Math.min(o.top,o.bottom),I=Math.max(o.top,o.bottom);_=o.left<c&&o.right>s&&C<y&&I>l}if(_)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:e,minZoom:n,zRange:r,modelMatrix:o,modelMatrixInverse:s}){const{tileSize:l,extent:c,zoomOffset:y}=this.opts;return pht({viewport:t,maxZoom:e,minZoom:n,zRange:r,tileSize:l,extent:c,modelMatrix:o,modelMatrixInverse:s,zoomOffset:y})}getTileId(t){return`${t.x}-${t.y}-${t.z}`}getTileZoom(t){return t.z}getTileMetadata(t){const{tileSize:e}=this.opts;return{bbox:fht(this._viewport,t.x,t.y,t.z,e)}}getParentIndex(t){const e=Math.floor(t.x/2),n=Math.floor(t.y/2),r=t.z-1;return{x:e,y:n,z:r}}updateTileStates(){const t=this.opts.refinementStrategy||Uw,e=new Array(this._cache.size);let n=0;for(const r of this._cache.values())e[n++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;(typeof t=="function"?t:xht[t])(Array.from(this._cache.values())),n=0;for(const r of this._cache.values())if(e[n++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:t=0}=this.opts,e=[];let n=0;for(const r of this._cache.values())r.isLoading&&(n++,!r.isSelected&&!r.isVisible&&e.push(r));for(;t>0&&n>t&&e.length>0;)e.shift().abort(),n--}_rebuildTree(){const{_cache:t}=this;for(const e of t.values())e.parent=null,e.children&&(e.children.length=0);for(const e of t.values()){const n=this._getNearestAncestor(e);e.parent=n,n?.children&&n.children.push(e)}}_resizeCache(){const{_cache:t,opts:e}=this,n=e.maxCacheSize??(e.maxCacheByteSize!==null?1/0:bht*this.selectedTiles.length),r=e.maxCacheByteSize??1/0;if(t.size>n||this._cacheByteSize>r){for(const[o,s]of t)if(!s.isVisible&&!s.isSelected&&(this._cacheByteSize-=e.maxCacheByteSize!==null?s.byteLength:0,t.delete(o),this.opts.onTileUnload?.(s)),t.size<=n&&this._cacheByteSize<=r)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,s)=>o.zoom-s.zoom),this._dirty=!1)}_getTile(t,e){const n=this.getTileId(t);let r=this._cache.get(n),o=!1;return!r&&e?(r=new n5(t),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:n,zoom:this.getTileZoom(r.index)}),o=!0,this._cache.set(n,r),this._dirty=!0):r&&r.needsReload&&(o=!0),r&&o&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(t){const{_minZoom:e=0}=this;let n=t.index;for(;this.getTileZoom(n)>e;){n=this.getParentIndex(n);const r=this._getTile(n);if(r)return r}return null}}function Eht(i){for(const t of i)t.state=0;for(const t of i)t.isSelected&&!a5(t)&&Vw(t);for(const t of i)t.isVisible=!!(t.state&ov)}function Cht(i){for(const e of i)e.state=0;for(const e of i)e.isSelected&&a5(e);const t=Array.from(i).sort((e,n)=>e.zoom-n.zoom);for(const e of t)if(e.isVisible=!!(e.state&ov),e.children&&(e.isVisible||e.state&_4))for(const n of e.children)n.state=_4;else e.isSelected&&Vw(e)}function a5(i){let t=i;for(;t;){if(t.isLoaded||t.content)return t.state|=ov,!0;t=t.parent}return!1}function Vw(i){for(const t of i.children)t.isLoaded||t.content?t.state|=ov:Vw(t)}const Tht={TilesetClass:av,data:{type:"data",value:[]},dataComparator:gy.equal,renderSubLayers:{type:"function",value:i=>new rc(i)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:i=>console.error(i)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Uw,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class oc extends Is{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(t=>t.isLoaded&&t.layers&&t.layers.every(e=>e.isLoaded))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:e}=this.state;const n=t.propsOrDataChanged||t.updateTriggersChanged,r=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);e?n&&(e.setOptions(this._getTilesetOptions()),r?e.reloadAll():e.tiles.forEach(o=>{o.layers=null})):(e=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:e})),this._updateTileset()}_getTilesetOptions(){const{tileSize:t,maxCacheSize:e,maxCacheByteSize:n,refinementStrategy:r,extent:o,maxZoom:s,minZoom:l,maxRequests:c,debounceTime:y,zoomOffset:_}=this.props;return{maxCacheSize:e,maxCacheByteSize:n,maxZoom:s,minZoom:l,tileSize:t,refinementStrategy:r,extent:o,maxRequests:c,debounceTime:y,zoomOffset:_,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const t=this.state.tileset,{zRange:e,modelMatrix:n}=this.props,r=t.update(this.context.viewport,{zRange:e,modelMatrix:n}),{isLoaded:o}=t,s=this.state.isLoaded!==o,l=this.state.frameNumber!==r;o&&(s||l)&&this._onViewportLoad(),l&&this.setState({frameNumber:r}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:e}=this.props;e&&e(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,e){this.props.onTileError(t),e.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){const{data:e,getTileData:n,fetch:r}=this.props,{signal:o}=t;return t.url=typeof e=="string"||Array.isArray(e)?uf(e,t):null,n?n(t):r&&t.url?r(t.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo(t){const e=t.sourceLayer,n=e.props.tile,r=t.info;return r.picked&&(r.tile=n),r.sourceTile=n,r.sourceTileSubLayer=e,r}_updateAutoHighlight(t){t.sourceTileSubLayer.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{const e=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)e&&t.layers[0]&&Object.keys(e).some(n=>t.layers[0].props[n]!==e[n])&&(t.layers=t.layers.map(n=>n.clone(e)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=ky(n,Boolean).map(r=>r.clone({tile:t,...e}))}return t.layers})}filterSubLayer({layer:t,cullRect:e}){const{tile:n}=t.props,{modelMatrix:r}=this.props;return this.state.tileset.isTileVisible(n,e,r?new bn(r):null)}}oc.defaultProps=Tht;oc.layerName="TileLayer";const b4=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,Sht={name:"trips",vs:b4,fs:b4,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}},Pht={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:i=>i.timestamps}};class lv extends nh{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},t.modules=[...t.modules,Sht],t}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(t){const{fadeTrail:e,trailLength:n,currentTime:r}=this.props,o={fadeTrail:e,trailLength:n,currentTime:r};this.state.model.shaderInputs.setProps({trips:o}),super.draw(t)}}lv.layerName="TripsLayer";lv.defaultProps=Pht;const Iht=10;function Mht(i,t){let e;return i==null?e=t:typeof i=="object"?e={...i,coverage:t}:e={getHexagon:i,coverage:t},e}const Bht={...sh.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:i=>i.hexagon},extruded:!0};class pu extends Is{initializeState(){pu._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:t}){return this._shouldUseHighPrecision()?t.propsOrDataChanged:t.somethingChanged}updateState({props:t,changeFlags:e}){if(t.highPrecision!==!0&&(e.dataChanged||e.updateTriggersChanged&&e.updateTriggersChanged.getHexagon)){const n=this._calculateH3DataProps();this.setState(n)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let t=-1,e=!1,n=!1;const{iterable:r,objectInfo:o}=fu(this.props.data);for(const s of r){o.index++;const l=this.props.getHexagon(s,o),c=lf(l);if(t<0){if(t=c,!this.props.highPrecision)break}else if(t!==c){n=!0;break}if(yut(l)){e=!0;break}}return{resolution:t,edgeLengthKM:t>=0?Cut(t,"km"):0,hasMultipleRes:n,hasPentagon:e}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:t,hasPentagon:e,hasMultipleRes:n}=this.state,{viewport:r}=this.context;return!!r?.resolution||n||e||t>=0&&t<=5}return this.props.highPrecision}_updateVertices(t){if(this._shouldUseHighPrecision())return;const{resolution:e,edgeLengthKM:n,centerHex:r}=this.state;if(e<0)return;const o=this.props.centerHexagon||Mw(t.latitude,t.longitude,e);if(r===o)return;if(r)try{if(wut(r,o)*n<Iht)return}catch{}const{unitsPerMeter:s}=t.distanceScales;let l=VI(o);const[c,y]=iv(o),[_,C]=t.projectFlat([y,c]);l=l.map(I=>{const k=t.projectFlat(I);return[(k[0]-_)/s[0],(k[1]-C)/s[1]]}),this.setState({centerHex:o,vertices:l})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:t,material:e,coverage:n,extruded:r,wireframe:o,stroked:s,filled:l,lineWidthUnits:c,lineWidthScale:y,lineWidthMinPixels:_,lineWidthMaxPixels:C,getFillColor:I,getElevation:k,getLineColor:z,getLineWidth:V,transitions:X,updateTriggers:H}=this.props;return{elevationScale:t,extruded:r,coverage:n,wireframe:o,stroked:s,filled:l,lineWidthUnits:c,lineWidthScale:y,lineWidthMinPixels:_,lineWidthMaxPixels:C,material:e,getElevation:k,getFillColor:I,getLineColor:z,getLineWidth:V,transitions:X,updateTriggers:{getFillColor:H.getFillColor,getElevation:H.getElevation,getLineColor:H.getLineColor,getLineWidth:H.getLineWidth}}}_renderPolygonLayer(){const{data:t,getHexagon:e,updateTriggers:n,coverage:r}=this.props,o=this.getSubLayerClass("hexagon-cell-hifi",sh),s=this._getForwardProps();return s.updateTriggers.getPolygon=Mht(n.getHexagon,r),new o(s,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:s.updateTriggers}),{data:t,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(l,c)=>{const y=e(l,c);return JD(VI(y,r))}})}_renderColumnLayer(){const{data:t,getHexagon:e,updateTriggers:n}=this.props,r=this.getSubLayerClass("hexagon-cell",du),o=this._getForwardProps();return o.updateTriggers.getPosition=n.getHexagon,new r(o,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:o.updateTriggers}),{data:t,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:Iut.bind(null,e)})}}pu.defaultProps=Bht;pu.layerName="H3HexagonLayer";pu._checkH3Lib=()=>{};const Rht={getHexagons:{type:"accessor",value:i=>i.hexagons}};class uv extends sc{initializeState(){pu._checkH3Lib()}updateState({props:t,changeFlags:e}){if(e.dataChanged||e.updateTriggersChanged&&e.updateTriggersChanged.getHexagons){const{data:n,getHexagons:r}=t,o=[],{iterable:s,objectInfo:l}=fu(n);for(const c of s){l.index++;const y=r(c,l),_=but(y,!0);for(const C of _){for(const I of C)Bw(I);o.push(this.getSubLayerRow({polygon:C},c,l.index))}}this.setState({polygons:o})}}indexToBounds(){const{getElevation:t,getFillColor:e,getLineColor:n,getLineWidth:r}=this.props;return{data:this.state.polygons,getPolygon:o=>o.polygon,getElevation:this.getSubLayerAccessor(t),getFillColor:this.getSubLayerAccessor(e),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(r)}}}uv.layerName="H3ClusterLayer";uv.defaultProps=Rht;const S1=Math.PI/180,tg=new Float32Array(16),x4=new Float32Array(12);function w4(i,t,e){const n=t[0]*S1,r=t[1]*S1,o=t[2]*S1,s=Math.sin(o),l=Math.sin(n),c=Math.sin(r),y=Math.cos(o),_=Math.cos(n),C=Math.cos(r),I=e[0],k=e[1],z=e[2];i[0]=I*C*_,i[1]=I*c*_,i[2]=I*-l,i[3]=k*(-c*y+C*l*s),i[4]=k*(C*y+c*l*s),i[5]=k*_*s,i[6]=z*(c*s+C*l*y),i[7]=z*(-C*s+c*l*y),i[8]=z*_*y}function E4(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const l5={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,{startRow:t,endRow:e}){const{data:n,getOrientation:r,getScale:o,getTranslation:s,getTransformMatrix:l}=this.props,c=Array.isArray(l),y=c&&l.length===16,_=Array.isArray(o),C=Array.isArray(r),I=Array.isArray(s),k=y||!c&&!!l(n[0]);k?i.constant=y:i.constant=C&&_&&I;const z=i.value;if(i.constant){let V;k?(tg.set(l),V=E4(tg)):(V=x4,w4(V,r,o),V.set(s,9)),i.value=new Float32Array(V)}else{let V=t*i.size;const{iterable:X,objectInfo:H}=fu(n,t,e);for(const $ of X){H.index++;let Y;if(k)tg.set(y?l:l($,H)),Y=E4(tg);else{Y=x4;const ct=C?r:r($,H),rt=_?o:o($,H);w4(Y,ct,rt),Y.set(I?s:s($,H),9)}z[V++]=Y[0],z[V++]=Y[1],z[V++]=Y[2],z[V++]=Y[3],z[V++]=Y[4],z[V++]=Y[5],z[V++]=Y[6],z[V++]=Y[7],z[V++]=Y[8],z[V++]=Y[9],z[V++]=Y[10],z[V++]=Y[11]}}}};function u5(i,t){return t===nn.CARTESIAN||t===nn.METER_OFFSETS||t===nn.DEFAULT&&!i.isGeospatial}const C4=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,Lht={name:"simpleMesh",vs:C4,fs:C4,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},Dht=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,kht=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function P1(i){const t=i.positions||i.POSITION;$i.assert(t,'no "postions" or "POSITION" attribute in mesh');const e=t.value.length/t.size;let n=i.COLOR_0||i.colors;n||(n={size:3,value:new Float32Array(e*3).fill(1)});let r=i.NORMAL||i.normals;r||(r={size:3,value:new Float32Array(e*3).fill(0)});let o=i.TEXCOORD_0||i.texCoords;return o||(o={size:2,value:new Float32Array(e*2).fill(0)}),{positions:t,colors:n,normals:r,texCoords:o}}function T4(i){return i instanceof no?(i.attributes=P1(i.attributes),i):i.attributes?new no({...i,topology:"triangle-list",attributes:P1(i.attributes)}):new no({topology:"triangle-list",attributes:P1(i)})}const Oht=[0,0,0,255],Fht={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:Oht},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class cf extends Ps{getShaders(){return super.getShaders({vs:Dht,fs:kht,modules:[Hs,Mx,ma,Lht]})}getBounds(){if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:e}=this.props;if(!e)return null;if(t=e.header?.boundingBox,!t){const{attributes:n}=T4(e);n.POSITION=n.POSITION||n.positions,t=E6(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:l5}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:r}=t;if(e.mesh!==n.mesh||r.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),e.mesh){this.state.model=this.getModel(e.mesh);const o=e.mesh.attributes||e.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==n.texture&&e.texture instanceof ps&&this.setTexture(e.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){const{model:e}=this.state;if(!e)return;const{viewport:n,renderPass:r}=this.context,{sizeScale:o,coordinateSystem:s,_instanced:l}=this.props,c={sizeScale:o,composeModelMatrix:!l||u5(n,s),flatShading:!this.state.hasNormals};e.shaderInputs.setProps({simpleMesh:c}),e.draw(r)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(t){const e=new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:T4(t),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:r}=this.state,o={sampler:n||r,hasTexture:!!n};return e.shaderInputs.setProps({simpleMesh:o}),e}setTexture(t){const{emptyTexture:e,model:n}=this.state;if(n){const r={sampler:t||e,hasTexture:!!t};n.shaderInputs.setProps({simpleMesh:r})}}}cf.defaultProps=Fht;cf.layerName="SimpleMeshLayer";function Nht(i){return{addressModeU:S4(i.wrapS),addressModeV:S4(i.wrapT),magFilter:zht(i.magFilter),...Uht(i.minFilter)}}function S4(i){switch(i){case 33071:return"clamp-to-edge";case 10497:return"repeat";case 33648:return"mirror-repeat";default:return}}function zht(i){switch(i){case 9728:return"nearest";case 9729:return"linear";default:return}}function Uht(i){switch(i){case 9728:return{minFilter:"nearest"};case 9729:return{minFilter:"linear"};case 9984:return{minFilter:"nearest",mipmapFilter:"nearest"};case 9985:return{minFilter:"linear",mipmapFilter:"nearest"};case 9986:return{minFilter:"nearest",mipmapFilter:"linear"};case 9987:return{minFilter:"linear",mipmapFilter:"linear"};default:return{}}}function c5(i,t,e,n){const r={defines:{MANUAL_SRGB:!0,SRGB_FAST_APPROXIMATION:!0},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};r.defines.USE_TEX_LOD=!0;const{imageBasedLightingEnvironment:o}=n;return o&&(r.bindings.pbr_diffuseEnvSampler=o.diffuseEnvSampler.texture,r.bindings.pbr_specularEnvSampler=o.specularEnvSampler.texture,r.bindings.pbr_BrdfLUT=o.brdfLutTexture.texture,r.uniforms.scaleIBLAmbient=[1,1]),n?.pbrDebug&&(r.defines.PBR_DEBUG=!0,r.uniforms.scaleDiffBaseMR=[0,0,0,0],r.uniforms.scaleFGDSpec=[0,0,0,0]),e.NORMAL&&(r.defines.HAS_NORMALS=!0),e.TANGENT&&n?.useTangents&&(r.defines.HAS_TANGENTS=!0),e.TEXCOORD_0&&(r.defines.HAS_UV=!0),n?.imageBasedLightingEnvironment&&(r.defines.USE_IBL=!0),n?.lights&&(r.defines.USE_LIGHTS=!0),t&&Vht(i,t,r),r}function Vht(i,t,e){if(e.uniforms.unlit=!!t.unlit,t.pbrMetallicRoughness&&Ght(i,t.pbrMetallicRoughness,e),t.normalTexture){JA(i,t.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",e);const{scale:n=1}=t.normalTexture;e.uniforms.normalScale=n}if(t.occlusionTexture){JA(i,t.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",e);const{strength:n=1}=t.occlusionTexture;e.uniforms.occlusionStrength=n}switch(t.emissiveTexture&&(JA(i,t.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",e),e.uniforms.emissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode||"MASK"){case"MASK":const{alphaCutoff:n=.5}=t;e.defines.ALPHA_CUTOFF=!0,e.uniforms.alphaCutoff=n;break;case"BLEND":Xe.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),e.parameters.blend=!0,e.parameters.blendColorOperation="add",e.parameters.blendColorSrcFactor="src-alpha",e.parameters.blendColorDstFactor="one-minus-src-alpha",e.parameters.blendAlphaOperation="add",e.parameters.blendAlphaSrcFactor="one",e.parameters.blendAlphaDstFactor="one-minus-src-alpha",e.glParameters.blend=!0,e.glParameters.blendEquation=32774,e.glParameters.blendFunc=[770,771,1,771];break}}function Ght(i,t,e){t.baseColorTexture&&JA(i,t.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",e),e.uniforms.baseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&JA(i,t.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",e);const{metallicFactor:n=1,roughnessFactor:r=1}=t;e.uniforms.metallicRoughnessValues=[n,r]}function JA(i,t,e,n,r){const o=t.texture.source.image;let s;o.compressed?s=o:s={data:o};const l={wrapS:10497,wrapT:10497,...t?.texture?.sampler},c=i.createTexture({id:t.uniformName||t.id,sampler:Nht(l),...s});r.bindings[e]=c,n&&(r.defines[n]=!0),r.generatedTextures.push(c)}var Vh;(function(i){i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Vh||(Vh={}));function jht(i){switch(i){case Vh.POINTS:return"point-list";case Vh.LINES:return"line-list";case Vh.LINE_STRIP:return"line-strip";case Vh.TRIANGLES:return"triangle-list";case Vh.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(i))}}const Wht=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,Hht=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,Xht=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function qht(i,t){const{id:e,geometry:n,parsedPPBRMaterial:r,vertexCount:o,modelOptions:s={}}=t;Xe.info(4,"createGLTFModel defines: ",r.defines)();const l=[],c={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},y={id:e,source:Wht,vs:Hht,fs:Xht,geometry:n,topology:n.topology,vertexCount:o,modules:[Bx],...s,defines:{...r.defines,...s.defines},parameters:{...c,...r.parameters,...s.parameters}},_=new Rr(i,y),{camera:C,...I}={...r.uniforms,...s.uniforms,...r.bindings,...s.bindings};return _.shaderInputs.setProps({pbrMaterial:I,pbrProjection:{camera:C}}),new Db({managedResources:l,model:_})}const Kht={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:void 0,lights:!0,useTangents:!1};function Zht(i,t,e={}){const n={...Kht,...e};return t.scenes.map(r=>Yht(i,r,t.nodes,n))}function Yht(i,t,e,n){const r=(t.nodes||[]).map(o=>h5(i,o,e,n));return new Dp({id:t.name||t.id,children:r})}function h5(i,t,e,n){if(!t._node){const o=(t.children||[]).map(l=>h5(i,l,e,n));t.mesh&&o.push(Qht(i,t.mesh,n));const s=new Dp({id:t.name||t.id,children:o});if(t.matrix)s.setMatrix(t.matrix);else{if(s.matrix.identity(),t.translation&&s.matrix.translate(t.translation),t.rotation){const l=new bn().fromQuaternion(t.rotation);s.matrix.multiplyRight(l)}t.scale&&s.matrix.scale(t.scale)}t._node=s}const r=e.find(o=>o.id===t.id);return r._node=t._node,t._node}function Qht(i,t,e){if(!t._mesh){const n=(t.primitives||[]).map((o,s)=>Jht(i,o,s,t,e)),r=new Dp({id:t.name||t.id,children:n});t._mesh=r}return t._mesh}function Jht(i,t,e,n,r){const o=t.name||`${n.name||n.id}-primitive-${e}`,s=jht(t.mode||4),l=t.indices?t.indices.count:$ht(t.attributes),c=P4(o,t,s),y=c5(i,t.material,c.attributes,r),_=qht(i,{id:o,geometry:P4(o,t,s),parsedPPBRMaterial:y,modelOptions:r.modelOptions,vertexCount:l});return _.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],_}function $ht(i){throw new Error("getVertexCount not implemented")}function P4(i,t,e){const n={};for(const[r,o]of Object.entries(t.attributes)){const{components:s,size:l,value:c}=o;n[r]={size:l??s,value:c}}return new no({id:i,topology:e,indices:t.indices.value,attributes:n})}const I1=new em;function tft(i,{input:t,interpolation:e,output:n},r,o){const s=t[t.length-1],l=i%s,c=t.findIndex(I=>I>=l),y=Math.max(0,c-1);if(!Array.isArray(r[o]))switch(o){case"translation":r[o]=[0,0,0];break;case"rotation":r[o]=[0,0,0,1];break;case"scale":r[o]=[1,1,1];break;default:Xe.warn(`Bad animation path ${o}`)()}const _=t[y],C=t[c];switch(e){case"STEP":nft(r,o,n[y]);break;case"LINEAR":if(C>_){const I=(l-_)/(C-_);eft(r,o,n[y],n[c],I)}break;case"CUBICSPLINE":if(C>_){const I=(l-_)/(C-_),k=C-_,z=n[3*y+1],V=n[3*y+2],X=n[3*c+0],H=n[3*c+1];ift(r,o,{p0:z,outTangent0:V,inTangent1:X,p1:H,tDiff:k,ratio:I})}break;default:Xe.warn(`Interpolation ${e} not supported`)();break}}function eft(i,t,e,n,r){if(!i[t])throw new Error;if(t==="rotation"){I1.slerp({start:e,target:n,ratio:r});for(let o=0;o<I1.length;o++)i[t][o]=I1[o]}else for(let o=0;o<e.length;o++)i[t][o]=r*n[o]+(1-r)*e[o]}function ift(i,t,{p0:e,outTangent0:n,inTangent1:r,p1:o,tDiff:s,ratio:l}){if(!i[t])throw new Error;for(let c=0;c<i[t].length;c++){const y=n[c]*s,_=r[c]*s;i[t][c]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*e[c]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*y+(-2*Math.pow(l,3)+3*Math.pow(l,2))*o[c]+(Math.pow(l,3)-Math.pow(l,2))*_}}function nft(i,t,e){if(!i[t])throw new Error;for(let n=0;n<e.length;n++)i[t][n]=e[n]}class rft{animation;startTime=0;playing=!0;speed=1;constructor(t){this.animation=t.animation,this.animation.name||="unnamed",Object.assign(this,t)}setTime(t){if(!this.playing)return;const e=(t/1e3-this.startTime)*this.speed;this.animation.channels.forEach(({sampler:n,target:r,path:o})=>{tft(e,n,r,o),aft(r,r._node)})}}class sft{animations;constructor(t){this.animations=t.animations.map((e,n)=>{const r=e.name||`Animation-${n}`;return new rft({animation:{name:r,channels:e.channels}})})}animate(t){Xe.warn("GLTFAnimator#animate is deprecated. Use GLTFAnimator#setTime instead")(),this.setTime(t)}setTime(t){this.animations.forEach(e=>e.setTime(t))}getAnimations(){return this.animations}}const oft=new bn;function aft(i,t){if(t.matrix.identity(),i.translation&&t.matrix.translate(i.translation),i.rotation){const e=oft.fromQuaternion(i.rotation);t.matrix.multiplyRight(e)}i.scale&&t.matrix.scale(i.scale)}const lft={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},uft={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function cft(i){const t=uft[i.componentType],e=lft[i.type],n=e*i.count,{buffer:r,byteOffset:o=0}=i.bufferView?.data??{};return{typedArray:new t(r,o+(i.byteOffset||0),n),components:e}}function hft(i){return(i.animations||[]).map((t,e)=>{const n=t.name||`Animation-${e}`,r=t.samplers.map(({input:s,interpolation:l="LINEAR",output:c})=>({input:I4(i.accessors[s]),interpolation:l,output:I4(i.accessors[c])})),o=t.channels.map(({sampler:s,target:l})=>({sampler:r[s],target:i.nodes[l.node??0],path:l.path}));return{name:n,channels:o}})}function I4(i){if(!i._animation){const{typedArray:t,components:e}=cft(i);if(e===1)i._animation=Array.from(t);else{const n=[];for(let r=0;r<t.length;r+=e)n.push(Array.from(t.slice(r,r+e)));i._animation=n}}return i._animation}function S2(i){if(ArrayBuffer.isView(i)||i instanceof ArrayBuffer||i instanceof ImageBitmap)return i;if(Array.isArray(i))return i.map(S2);if(i&&typeof i=="object"){const t={};for(const e in i)t[e]=S2(i[e]);return t}return i}function fft(i,t,e){t=S2(t);const n=Zht(i,t,e),r=hft(t),o=new sft({animations:r});return{scenes:n,animator:o}}async function dft(i){const t=[];return i.scenes.forEach(e=>{e.traverse(n=>{})}),await pft(()=>t.some(e=>!e.loaded))}async function pft(i){for(;i();)await new Promise(t=>requestAnimationFrame(t))}const M4=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,Aft={name:"scenegraph",vs:M4,fs:M4,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},mft=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,gft=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,f5=[255,255,255,255],yft={scenegraph:{type:"object",value:null,async:!0},getScene:i=>i&&i.scenes?typeof i.scene=="object"?i.scene:i.scenes[i.scene||0]:i,getAnimator:i=>i&&i.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:f5},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[wp]};class Pm extends Ps{getShaders(){const t={};let e;this.props._lighting==="pbr"?(e=Bx,t.LIGHTING_PBR=1):e={name:"pbrMaterial"};const n=[Hs,ma,Aft,e];return super.getShaders({defines:t,vs:mft,fs:gft,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:f5,transition:!0},instanceModelMatrix:l5})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.scenegraph!==n.scenegraph?this._updateScenegraph():e._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){const t=this.props,{device:e}=this.context;let n=null;if(t.scenegraph instanceof $g)n={scenes:[t.scenegraph]};else if(t.scenegraph&&typeof t.scenegraph=="object"){const l=t.scenegraph,c=l.json?iw(l):l,y=fft(e,c,this._getModelOptions());n={gltf:c,...y},dft(y).then(()=>{this.setNeedsRedraw()}).catch(_=>{this.raiseError(_,"loading glTF")})}const r={layer:this,device:this.context.device},o=t.getScene(n,r),s=t.getAnimator(n,r);if(o instanceof Dp){this.state.scenegraph?.destroy(),this._applyAnimationsProp(s,t._animations);const l=[];o.traverse(c=>{c instanceof Db&&l.push(c.model)}),this.setState({scenegraph:o,animator:s,models:l}),this.getAttributeManager().invalidateAll()}else o!==null&&$i.warn("invalid scenegraph:",o)()}_applyAnimationsProp(t,e){if(!t||!e)return;const n=t.getAnimations();Object.keys(e).sort().forEach(r=>{const o=e[r];if(r==="*")n.forEach(s=>{Object.assign(s,o)});else if(Number.isFinite(Number(r))){const s=Number(r);s>=0&&s<n.length?Object.assign(n[s],o):$i.warn(`animation ${r} not found`)()}else{const s=n.find(({animation:l})=>l.name===r);s?Object.assign(s,o):$i.warn(`animation ${r} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e;return t&&(typeof t=="function"?e=t({gl:this.context.gl,layer:this}):e=t),{imageBasedLightingEnvironment:e,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:t}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(t.timeline.getTime()),this.setNeedsRedraw());const{viewport:e,renderPass:n}=this.context,{sizeScale:r,sizeMinPixels:o,sizeMaxPixels:s,coordinateSystem:l}=this.props,c={camera:e.cameraPosition},y=this.getNumInstances();this.state.scenegraph.traverse((_,{worldMatrix:C})=>{if(_ instanceof Db){const{model:I}=_;I.setInstanceCount(y);const k={sizeScale:r,sizeMinPixels:o,sizeMaxPixels:s,composeModelMatrix:u5(e,l),sceneModelMatrix:C};I.shaderInputs.setProps({pbrProjection:c,scenegraph:k}),I.draw(n)}})}}Pm.defaultProps=yft;Pm.layerName="ScenegraphLayer";const vft=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:Pm,SimpleMeshLayer:cf},Symbol.toStringTag,{value:"Module"})),B4=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,_ft={name:"mesh",vs:B4,fs:B4,uniformTypes:{pickFeatureIds:"f32"}},bft=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,xft=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function wft(i){const t=i.positions||i.POSITION,e=t.value.length/t.size;i.COLOR_0||i.colors||(i.colors={size:4,value:new Uint8Array(e*4).fill(255),normalized:!0})}const Eft={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Gw extends cf{getShaders(){const t=super.getShaders();return t.modules.push(Bx,_ft),{...t,vs:bft,fs:xft}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props,{model:n}=this.state;if(!n)return;const r={pickFeatureIds:!!e},o={camera:this.context.viewport.cameraPosition};n.shaderInputs.setProps({pbrProjection:o,mesh:r}),super.draw(t)}getModel(t){const{id:e}=this.props,n=this.parseMaterial(this.props.pbrMaterial,t);this.setState({parsedPBRMaterial:n});const r=this.getShaders();return wft(t.attributes),new Rr(this.context.device,{...this.getShaders(),id:e,geometry:t,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...r.defines,...n?.defines,HAS_UV_REGIONS:t.attributes.uvRegions?1:0},parameters:n?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:n}=this.props,r=this.parseMaterial(t,n);this.setState({parsedPBRMaterial:r});const{pbr_baseColorSampler:o}=r.bindings,{emptyTexture:s}=this.state,l={sampler:o||s,hasTexture:!!o},{camera:c,...y}={...r.bindings,...r.uniforms};e.shaderInputs.setProps({simpleMesh:l,pbrMaterial:y})}}parseMaterial(t,e){const n=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return c5(this.context.device,{unlit:n,...t},{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,n=new Uint8ClampedArray(e.length*t.size),r=[];for(let o=0;o<e.length;o++)this.encodePickingColor(e[o],r),n[o*3]=r[0],n[o*3+1]=r[1],n[o*3+2]=r[2];t.value=n}finalizeState(t){super.finalizeState(t),this.state.parsedPBRMaterial?.generatedTextures.forEach(e=>e.destroy()),this.setState({parsedPBRMaterial:null})}}Gw.layerName="MeshLayer";Gw.defaultProps=Eft;const Cft=6378137,Tft=6378137,Sft=6356752314245179e-9;function cv(i){return i}new ve;function Pft(i,t=[],e=cv){return"longitude"in i?(t[0]=e(i.longitude),t[1]=e(i.latitude),t[2]=i.height):"x"in i?(t[0]=e(i.x),t[1]=e(i.y),t[2]=i.z):(t[0]=e(i[0]),t[1]=e(i[1]),t[2]=i[2]),t}function Ift(i,t=[]){return Pft(i,t,Ss._cartographicRadians?cv:J7)}function Mft(i,t,e=cv){return"longitude"in t?(t.longitude=e(i[0]),t.latitude=e(i[1]),t.height=i[2]):"x"in t?(t.x=e(i[0]),t.y=e(i[1]),t.z=i[2]):(t[0]=e(i[0]),t[1]=e(i[1]),t[2]=i[2]),t}function Bft(i,t){return Mft(i,t,Ss._cartographicRadians?cv:$7)}const R4=1e-14,Rft=new ve,L4={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},M1={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},wA={east:new ve,north:new ve,up:new ve,west:new ve,south:new ve,down:new ve},Lft=new ve,Dft=new ve,kft=new ve;function D4(i,t,e,n,r,o){const s=L4[t]&&L4[t][e];hl(s&&(!n||n===s));let l,c,y;const _=Rft.copy(r);if(Aa(_.x,0,R4)&&Aa(_.y,0,R4)){const C=Math.sign(_.z);l=Lft.fromArray(M1[t]),t!=="east"&&t!=="west"&&l.scale(C),c=Dft.fromArray(M1[e]),e!=="east"&&e!=="west"&&c.scale(C),y=kft.fromArray(M1[n]),n!=="east"&&n!=="west"&&y.scale(C)}else{const{up:C,east:I,north:k}=wA;I.set(-_.y,_.x,0).normalize(),i.geodeticSurfaceNormal(_,C),k.copy(C).cross(I);const{down:z,west:V,south:X}=wA;z.copy(C).scale(-1),V.copy(I).scale(-1),X.copy(k).scale(-1),l=wA[t],c=wA[e],y=wA[n]}return o[0]=l.x,o[1]=l.y,o[2]=l.z,o[3]=0,o[4]=c.x,o[5]=c.y,o[6]=c.z,o[7]=0,o[8]=y.x,o[9]=y.y,o[10]=y.z,o[11]=0,o[12]=_.x,o[13]=_.y,o[14]=_.z,o[15]=1,o}const Sd=new ve,Oft=new ve,Fft=new ve;function Nft(i,t,e=[]){const{oneOverRadii:n,oneOverRadiiSquared:r,centerToleranceSquared:o}=t;Sd.from(i);const s=Sd.x,l=Sd.y,c=Sd.z,y=n.x,_=n.y,C=n.z,I=s*s*y*y,k=l*l*_*_,z=c*c*C*C,V=I+k+z,X=Math.sqrt(1/V);if(!Number.isFinite(X))return;const H=Oft;if(H.copy(i).scale(X),V<o)return H.to(e);const $=r.x,Y=r.y,ct=r.z,rt=Fft;rt.set(H.x*$*2,H.y*Y*2,H.z*ct*2);let nt=(1-X)*Sd.len()/(.5*rt.len()),Ot=0,Kt,ft,st,Ut;do{nt-=Ot,Kt=1/(1+nt*$),ft=1/(1+nt*Y),st=1/(1+nt*ct);const K=Kt*Kt,dt=ft*ft,Tt=st*st,ue=K*Kt,Rt=dt*ft,Ft=Tt*st;Ut=I*K+k*dt+z*Tt-1;const Gt=-2*(I*ue*$+k*Rt*Y+z*Ft*ct);Ot=Ut/Gt}while(Math.abs(Ut)>yG);return Sd.scale([Kt,ft,st]).to(e)}const eg=new ve,k4=new ve,zft=new ve,rl=new ve,Uft=new ve,ig=new ve;class _r{constructor(t=0,e=0,n=0){this.centerToleranceSquared=gG,hl(t>=0),hl(e>=0),hl(n>=0),this.radii=new ve(t,e,n),this.radiiSquared=new ve(t*t,e*e,n*n),this.radiiToTheFourth=new ve(t*t*t*t,e*e*e*e,n*n*n*n),this.oneOverRadii=new ve(t===0?0:1/t,e===0?0:1/e,n===0?0:1/n),this.oneOverRadiiSquared=new ve(t===0?0:1/(t*t),e===0?0:1/(e*e),n===0?0:1/(n*n)),this.minimumRadius=Math.min(t,e,n),this.maximumRadius=Math.max(t,e,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const n=k4,r=zft,[,,o]=t;this.geodeticSurfaceNormalCartographic(t,n),r.copy(this.radiiSquared).scale(n);const s=Math.sqrt(n.dot(r));return r.scale(1/s),n.scale(o),r.add(n),r.to(e)}cartesianToCartographic(t,e=[0,0,0]){ig.from(t);const n=this.scaleToGeodeticSurface(ig,rl);if(!n)return;const r=this.geodeticSurfaceNormal(n,k4),o=Uft;o.copy(ig).subtract(n);const s=Math.atan2(r.y,r.x),l=Math.asin(r.z),c=Math.sign(Cx(o,ig))*_R(o);return Bft([s,l,c],e)}eastNorthUpToFixedFrame(t,e=new bn){return D4(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,n,r,o=new bn){return D4(this,t,e,n,r,o)}geocentricSurfaceNormal(t,e=[0,0,0]){return eg.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const n=Ift(t),r=n[0],o=n[1],s=Math.cos(o);return eg.set(s*Math.cos(r),s*Math.sin(r),Math.sin(o)).normalize(),eg.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return eg.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return Nft(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){rl.from(t);const n=rl.x,r=rl.y,o=rl.z,s=this.oneOverRadiiSquared,l=1/Math.sqrt(n*n*s.x+r*r*s.y+o*o*s.z);return rl.multiplyScalar(l).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return rl.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return rl.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,n=[0,0,0]){hl(Aa(this.radii.x,this.radii.y,BR)),hl(this.radii.z>0),rl.from(t);const r=rl.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-e))return rl.set(0,0,r).to(n)}}_r.WGS84=new _r(Cft,Tft,Sft);class Vft{item;previous;next;constructor(t,e,n){this.item=t,this.previous=e,this.next=n}}class Gft{head=null;tail=null;_length=0;get length(){return this._length}add(t){const e=new Vft(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t,++this._length}}class jft{_list;_sentinel;_trimTiles;constructor(){this._list=new Gft,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,n){e._cacheNode||(e._cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const r=e._cacheNode;r&&(this._list.remove(r),e._cacheNode=null,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const r=this._list,o=t.maximumMemoryUsage*1024*1024,s=this._sentinel;let l=r.head;for(;l!==s&&(t.gpuMemoryUsageInBytes>o||n);){const c=l.item;l=l.next,this.unloadTile(t,c,e)}}trim(){this._trimTiles=!0}}function Wft(i,t){vr(i),vr(t);const{rtcCenter:e,gltfUpAxis:n}=t,{computedTransform:r,boundingVolume:{center:o}}=i;let s=new bn(r);switch(e&&s.translate(e),n){case"Z":break;case"Y":const _=new bn().rotateX(Math.PI/2);s=s.multiplyRight(_);break;case"X":const C=new bn().rotateY(-Math.PI/2);s=s.multiplyRight(C);break}t.isQuantized&&s.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const l=new ve(o);t.cartesianModelMatrix=s,t.cartesianOrigin=l;const c=_r.WGS84.cartesianToCartographic(l,new ve),y=_r.WGS84.eastNorthUpToFixedFrame(l).invert();t.cartographicModelMatrix=y.multiplyRight(s),t.cartographicOrigin=c,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const O4=new ve,B1=new ve,P2=new pa([new cl,new cl,new cl,new cl,new cl,new cl]);function Hft(i,t){const{cameraDirection:e,cameraUp:n,height:r}=i,{metersPerUnit:o}=i.distanceScales,s=Lg(i,i.center),l=_r.WGS84.eastNorthUpToFixedFrame(s),c=i.unprojectPosition(i.cameraPosition),y=_r.WGS84.cartographicToCartesian(c,new ve),_=new ve(l.transformAsVector(new ve(e).scale(o))).normalize(),C=new ve(l.transformAsVector(new ve(n).scale(o))).normalize();qft(i);const I=i.constructor,{longitude:k,latitude:z,width:V,bearing:X,zoom:H}=i,$=new I({longitude:k,latitude:z,height:r,width:V,bearing:X,zoom:H,pitch:0});return{camera:{position:y,direction:_,up:C},viewport:i,topDownViewport:$,height:r,cullingVolume:P2,frameNumber:t,sseDenominator:1.15}}function Xft(i,t,e){if(e===0||i.length<=e)return[i,[]];const n=[],{longitude:r,latitude:o}=t.viewport;for(const[y,_]of i.entries()){const[C,I]=_.header.mbs,k=Math.abs(r-C),z=Math.abs(o-I),V=Math.sqrt(z*z+k*k);n.push([y,V])}const s=n.sort((y,_)=>y[1]-_[1]),l=[];for(let y=0;y<e;y++)l.push(i[s[y][0]]);const c=[];for(let y=e;y<s.length;y++)c.push(i[s[y][0]]);return[l,c]}function qft(i){const t=i.getFrustumPlanes(),e=F4(t.near,i.cameraPosition),n=Lg(i,e),r=Lg(i,i.cameraPosition,B1);let o=0;P2.planes[o++].fromPointNormal(n,O4.copy(n).subtract(r));for(const s in t){if(s==="near")continue;const l=t[s],c=F4(l,e,B1),y=Lg(i,c,B1);P2.planes[o++].fromPointNormal(y,O4.copy(n).subtract(y))}}function F4(i,t,e=new ve){const n=i.normal.dot(t);return e.copy(i.normal).scale(i.distance-n).add(t),e}function Lg(i,t,e=new ve){const n=i.unprojectPosition(t);return _r.WGS84.cartographicToCartesian(n,e)}const Kft=6378137,Zft=6378137,I2=6356752314245179e-9,ep=new ve;function Yft(i,t){if(i instanceof Sm){const{halfAxes:e}=i,n=Jft(e);return Math.log2(I2/(n+t[2]))}else if(i instanceof Tm){const{radius:e}=i;return Math.log2(I2/(e+t[2]))}else if(i.width&&i.height){const{width:e,height:n}=i,r=Math.log2(Kft/e),o=Math.log2(Zft/n);return(r+o)/2}return 1}function d5(i,t,e){_r.WGS84.cartographicToCartesian([i.xmax,i.ymax,i.zmax],ep);const n=Math.sqrt(Math.pow(ep[0]-e[0],2)+Math.pow(ep[1]-e[1],2)+Math.pow(ep[2]-e[2],2));return Math.log2(I2/(n+t[2]))}function Qft(i,t,e){const[n,r,o,s]=i;return d5({xmax:o,ymax:s,zmax:0},t,e)}function Jft(i){i.getColumn(0,ep);const t=i.getColumn(1),e=i.getColumn(2);return ep.add(t).add(e).len()}const ua={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var vl;(function(i){i[i.ADD=1]="ADD",i[i.REPLACE=2]="REPLACE"})(vl||(vl={}));var Ku;(function(i){i.EMPTY="empty",i.SCENEGRAPH="scenegraph",i.POINTCLOUD="pointcloud",i.MESH="mesh"})(Ku||(Ku={}));var Ko;(function(i){i.I3S="I3S",i.TILES3D="TILES3D"})(Ko||(Ko={}));var Pp;(function(i){i.GEOMETRIC_ERROR="geometricError",i.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Pp||(Pp={}));const $ft={USE_OPTIMIZATION:1};function p5(i){return i!=null}const yo=new ve,Dg=new ve,tdt=new ve,edt=new ve,Oh=new ve,N4=new ve,z4=new ve,U4=new ve;function R1(i,t,e){if(vr(i,"3D Tile: boundingVolume must be defined"),i.box)return A5(i.box,t,e);if(i.region)return rdt(i.region);if(i.sphere)return ndt(i.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function idt(i,t){if(i.box)return sdt(t);if(i.region){const[e,n,r,o,s,l]=i.region;return[[ul(e),ul(n),s],[ul(r),ul(o),l]]}if(i.sphere)return odt(t);throw new Error("Unkown boundingVolume type")}function A5(i,t,e){const n=new ve(i[0],i[1],i[2]);t.transform(n,n);let r=[];if(i.length===10){const y=i.slice(3,6),_=new em;_.fromArray(i,6);const C=new ve([1,0,0]),I=new ve([0,1,0]),k=new ve([0,0,1]);C.transformByQuaternion(_),C.scale(y[0]),I.transformByQuaternion(_),I.scale(y[1]),k.transformByQuaternion(_),k.scale(y[2]),r=[...C.toArray(),...I.toArray(),...k.toArray()]}else r=[...i.slice(3,6),...i.slice(6,9),...i.slice(9,12)];const o=t.transformAsVector(r.slice(0,3)),s=t.transformAsVector(r.slice(3,6)),l=t.transformAsVector(r.slice(6,9)),c=new ts([o[0],o[1],o[2],s[0],s[1],s[2],l[0],l[1],l[2]]);return p5(e)?(e.center=n,e.halfAxes=c,e):new Sm(n,c)}function ndt(i,t,e){const n=new ve(i[0],i[1],i[2]);t.transform(n,n);const r=t.getScale(Dg),o=Math.max(Math.max(r[0],r[1]),r[2]),s=i[3]*o;return p5(e)?(e.center=n,e.radius=s,e):new Tm(n,s)}function rdt(i){const[t,e,n,r,o,s]=i,l=_r.WGS84.cartographicToCartesian([ul(t),ul(r),o],tdt),c=_r.WGS84.cartographicToCartesian([ul(n),ul(e),s],edt),y=new ve().addVectors(l,c).multiplyByScalar(.5);return _r.WGS84.cartesianToCartographic(y,Oh),_r.WGS84.cartographicToCartesian([ul(n),Oh[1],Oh[2]],N4),_r.WGS84.cartographicToCartesian([Oh[0],ul(r),Oh[2]],z4),_r.WGS84.cartographicToCartesian([Oh[0],Oh[1],s],U4),A5([...y,...N4.subtract(y),...z4.subtract(y),...U4.subtract(y)],new bn)}function sdt(i){const t=m5(),{halfAxes:e}=i,n=new ve(e.getColumn(0)),r=new ve(e.getColumn(1)),o=new ve(e.getColumn(2));for(let s=0;s<2;s++){for(let l=0;l<2;l++){for(let c=0;c<2;c++)yo.copy(i.center),yo.add(n),yo.add(r),yo.add(o),g5(t,yo),o.negate();r.negate()}n.negate()}return t}function odt(i){const t=m5(),{center:e,radius:n}=i,r=_r.WGS84.scaleToGeodeticSurface(e,yo);let o;r?o=_r.WGS84.geodeticSurfaceNormal(r):o=new ve(0,0,1);let s=new ve(o[2],-o[1],0);s.len()>0?s.normalize():s=new ve(0,1,0);const l=s.clone().cross(o);for(const c of[s,l,o]){Dg.copy(c).scale(n);for(let y=0;y<2;y++)yo.copy(e),yo.add(Dg),g5(t,yo),Dg.negate()}return t}function m5(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function g5(i,t){_r.WGS84.cartesianToCartographic(t,yo),i[0][0]=Math.min(i[0][0],yo[0]),i[0][1]=Math.min(i[0][1],yo[1]),i[0][2]=Math.min(i[0][2],yo[2]),i[1][0]=Math.max(i[1][0],yo[0]),i[1][1]=Math.max(i[1][1],yo[1]),i[1][2]=Math.max(i[1][2],yo[2])}new ve;new ve;new bn;new ve;new ve;new ve;function adt(i,t){const e=i*t;return 1-Math.exp(-(e*e))}function ldt(i,t){if(i.dynamicScreenSpaceError&&i.dynamicScreenSpaceErrorComputedDensity){const e=i.dynamicScreenSpaceErrorComputedDensity,n=i.dynamicScreenSpaceErrorFactor;return adt(t,e)*n}return 0}function udt(i,t,e){const n=i.tileset,r=i.parent&&i.parent.lodMetricValue||i.lodMetricValue,o=e?r:i.lodMetricValue;if(o===0)return 0;const s=Math.max(i._distanceToCamera,1e-7),{height:l,sseDenominator:c}=t,{viewDistanceScale:y}=n.options;let _=o*l*(y||1)/(s*c);return _-=ldt(n,s),_}const L1=new ve,V4=new ve,Nc=new ve,G4=new ve,cdt=new ve,D1=new bn,j4=new bn;function hdt(i,t){if(i.lodMetricValue===0||isNaN(i.lodMetricValue))return"DIG";const e=2*y5(i,t);return e<2?"OUT":!i.header.children||e<=i.lodMetricValue?"DRAW":i.header.children?"DIG":"OUT"}function y5(i,t){const{topDownViewport:e}=t,n=i.header.mbs[1],r=i.header.mbs[0],o=i.header.mbs[2],s=i.header.mbs[3],l=[...i.boundingVolume.center],c=e.unprojectPosition(e.cameraPosition);_r.WGS84.cartographicToCartesian(c,L1),V4.copy(L1).subtract(l).normalize(),_r.WGS84.eastNorthUpToFixedFrame(l,D1),j4.copy(D1).invert(),Nc.copy(L1).transform(j4);const y=Math.sqrt(Nc[0]*Nc[0]+Nc[1]*Nc[1]),_=y*y/Nc[2];G4.copy([Nc[0],Nc[1],_]);const C=G4.transform(D1).subtract(l).normalize(),I=V4.cross(C).normalize().scale(s).add(l),k=_r.WGS84.cartesianToCartographic(I),z=e.project([r,n,o]),V=e.project(k);return cdt.copy(z).subtract(V).magnitude()}function fdt(i){return{assetGltfUpAxis:i.asset&&i.asset.gltfUpAxis||"Y"}}class W4{_map=new Map;_array;_length;constructor(t=0){this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return vr(t<this._array.length),this._array[t]}set(t,e){vr(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){vr(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){vr(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const ddt={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class hv{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new W4;_emptyTraversalStack=new W4;_frameNumber=null;traversalFinished(t){return!0}constructor(t){this.options={...ddt,...t}}traverse(t,e,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const o=n.pop();let s=!1;this.canTraverse(o,e)&&(this.updateChildTiles(o,e),s=this.updateAndPushChildren(o,e,n,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const l=o.parent,c=!!(!l||l._shouldRefine),y=!s;o.hasRenderContent?o.refine===vl.ADD?(this.loadTile(o,e),this.selectTile(o,e)):o.refine===vl.REPLACE&&(this.loadTile(o,e),y&&this.selectTile(o,e)):(this.emptyTiles[o.id]=o,this.loadTile(o,e),y&&this.selectTile(o,e)),this.touchTile(o,e),o._shouldRefine=s&&c}const r=new Date().getTime();(this.traversalFinished(e)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const n=t.children;for(const r of n)this.updateTile(r,e)}updateAndPushChildren(t,e,n,r){const{loadSiblings:o,skipLevelOfDetail:s}=this.options,l=t.children;l.sort(this.compareDistanceToCamera.bind(this));const c=t.refine===vl.REPLACE&&t.hasRenderContent&&!s;let y=!1,_=!0;for(const C of l)if(C._selectionDepth=r,C.isVisibleAndInRequestVolume?(n.find(C)&&n.delete(C),n.push(C),y=!0):(c||o)&&(this.loadTile(C,e),this.touchTile(C,e)),c){let I;if(C._inRequestVolume?C.hasRenderContent?I=C.contentAvailable:I=this.executeEmptyTraversal(C,e):I=!1,_=_&&I,!_)return!1}return y||(_=!1),_}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){return t.hasChildren?t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,e):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e,n=!1){let r=t._screenSpaceError;return n&&(r=t.getScreenSpaceError(e,!0)),r>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,e){const n=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===e.viewport.id&&n.push(r);else n.push(e.viewport.id);t.updateVisibility(e,n)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let n=!1;for(const r of t.children)r.updateVisibility(e),n=n||r.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,e){let n=!0;const r=this._emptyTraversalStack;for(r.push(t);r.length>0;){const o=r.pop(),s=!o.hasRenderContent&&this.canTraverse(o,e),l=!o.hasRenderContent&&o.children.length===0;if(!s&&!o.contentAvailable&&!l&&(n=!1),this.updateTile(o,e),o.isVisibleAndInRequestVolume||(this.loadTile(o,e),this.touchTile(o,e)),s){const c=o.children;for(const y of c)r.push(y)}}return n}}const H4=new ve;function pdt(i){return i!=null}class M2{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=ua.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new bn;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new hv({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new bn;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(t,e,n,r=""){this.header=e,this.tileset=t,this.id=r||e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ua.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ua.UNLOADED}get contentExpired(){return this.contentState===ua.EXPIRED}get contentFailed(){return this.contentState===ua.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=idt(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case Ko.I3S:return y5(this,t);case Ko.TILES3D:return udt(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,n=this.refine===vl.ADD||e;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ua.UNLOADED)return-1;const r=this.parent,o=r&&(!n||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,s=t.root?t.root._screenSpaceError:0;return Math.max(s-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ua.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=ua.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,r={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await Qu(e,n,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ua.READY,this._onContentLoaded(),!0}catch(e){throw this.contentState=ua.FAILED,e}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ua.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const n=this.parent,r=n?n._visibilityPlaneMask:pa.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==pa.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:r}=this;return n.computeVisibilityWithPlaneMask(r,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return H4.subVectors(e.center,t.position),t.direction.dot(H4)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(pdt(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=ua.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new bn(t.transform):new bn;const e=this.parent,n=this.tileset,r=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new bn(r).multiplyRight(this.transform);const o=e&&e._initialTransform?e._initialTransform.clone():new bn;this._initialTransform=new bn(o).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ua.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=pa.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||vl.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=R1(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=R1(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=R1(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new bn){const e=t.clone().multiplyRight(this.transform);e.equals(this.computedTransform)||(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return fdt(this.tileset.tileset)}}}class Adt extends hv{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const s=t.children[0];this.updateTileVisibility(s,e),t._visible=s._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const r=t.refine===vl.REPLACE,o=t._optimChildrenWithinParent===$ft.USE_OPTIMIZATION;if(r&&o&&n&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:n}=t;return!n||n.hasTilesetContent||n.refine!==vl.ADD?!1:!this.shouldRefine(t,e,!0)}}class mdt{frameNumberMap=new Map;register(t,e){const n=this.frameNumberMap.get(t)||new Map,r=n.get(e)||0;n.set(e,r+1),this.frameNumberMap.set(t,n)}deregister(t,e){const n=this.frameNumberMap.get(t);if(!n)return;const r=n.get(e)||1;n.set(e,r-1)}isZero(t,e){return(this.frameNumberMap.get(t)?.get(e)||0)===0}}const k1={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class gdt{_statusMap;pendingTilesRegister=new mdt;constructor(){this._statusMap={}}add(t,e,n,r){if(!this._statusMap[e]){const{frameNumber:o,viewport:{id:s}}=r;this._statusMap[e]={request:t,callback:n,key:e,frameState:r,status:k1.REQUESTED},this.pendingTilesRegister.register(s,o),t().then(l=>{this._statusMap[e].status=k1.COMPLETED;const{frameNumber:c,viewport:{id:y}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(y,c),this._statusMap[e].callback(l,r)}).catch(l=>{this._statusMap[e].status=k1.ERROR;const{frameNumber:c,viewport:{id:y}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(y,c),n(l)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:r}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(r,n);const{frameNumber:o,viewport:{id:s}}=e;this.pendingTilesRegister.register(s,o),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class ydt extends hv{_tileManager;constructor(t){super(t),this._tileManager=new gdt}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=hdt(t,e),t._lodJudge==="DIG"}updateChildTiles(t,e){const n=t.header.children||[],r=t.children,o=t.tileset;for(const s of n){const l=`${s.id}-${e.viewport.id}`,c=r&&r.find(y=>y.id===l);if(c)c&&this.updateTile(c,e);else{let y=()=>this._loadTile(s.id,o);this._tileManager.find(l)?this._tileManager.update(l,e):(o.tileset.nodePages&&(y=()=>o.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(y,l,_=>this._onTileLoad(_,t,l),e))}}return!1}async _loadTile(t,e){const{loader:n}=e,r=e.getTileUrl(`${e.url}/nodes/${t}`),o={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await Qu(r,n,o)}_onTileLoad(t,e,n){const r=new M2(e.tileset,t,e,n);e.children.push(r);const o=this._tileManager.find(r.id).frameState;this.updateTile(r,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,o)}}const vdt={description:"",ellipsoid:_r.WGS84,modelMatrix:new bn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:i=>i,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},ng="Tiles In Tileset(s)",O1="Tiles In Memory",X4="Tiles In View",q4="Tiles To Render",K4="Tiles Loaded",F1="Tiles Loading",Z4="Tiles Unloaded",Y4="Failed Tile Loads",Q4="Points/Vertices",N1="Tile Memory Use",J4="Maximum Screen Space Error";class _dt{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new jft;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(t,e){this.options={...vdt,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||q2(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new a6({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Bp({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let e=t;return this.queryParams.length&&(e=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),e}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(t=null){this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(t=null){return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const n=[];for(const r of e){const o=r.id;this._needTraverse(o)?n.push(o):this.traverseCounter--}for(const r of e){const o=r.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!n.includes(o))continue;const s=Hft(r,this._frameNumber);this._traverser.traverse(this.roots[o],s,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[e],r=Object.values(this._traverser.selectedTiles),[o,s]=Xft(r,t,this.options.maximumTilesSelected);n.selectedTiles=o;for(const l of s)l.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const n=new Set(t.map(s=>s.id)),r=new Set(e.map(s=>s.id));let o=t.filter(s=>!r.has(s.id)).length>0;return o=o||e.filter(s=>!n.has(s.id)).length>0,o}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?e+=n.content.pointCount:e+=n.content.vertexCount);this.stats.get(X4).count=this.selectedTiles.length,this.stats.get(q4).count=t,this.stats.get(Q4).count=e,this.stats.get(J4).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===Ko.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===Ko.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===Ko.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const t=this.tileset.fullExtent;if(t){const{xmin:n,xmax:r,ymin:o,ymax:s,zmin:l,zmax:c}=t;this.cartographicCenter=new ve(n+(r-n)/2,o+(s-o)/2,l+(c-l)/2),this.cartesianCenter=new ve,_r.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=d5(t,this.cartographicCenter,this.cartesianCenter);return}const e=this.tileset.store?.extent;if(e){const[n,r,o,s]=e;this.cartographicCenter=new ve(n+(o-n)/2,r+(s-r)/2,0),this.cartesianCenter=new ve,_r.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Qft(e,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new ve,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new ve,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?(this.cartographicCenter=new ve,_r.WGS84.cartesianToCartographic(e,this.cartographicCenter)):this.cartographicCenter=new ve(0,0,-_r.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=Yft(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(ng),this.stats.get(F1),this.stats.get(O1),this.stats.get(X4),this.stats.get(q4),this.stats.get(K4),this.stats.get(Z4),this.stats.get(Y4),this.stats.get(Q4),this.stats.get(N1,"memory"),this.stats.get(J4)}_initializeTileHeaders(t,e){const n=new M2(this,t.root,e);if(e&&(e.children.push(n),n.depth=e.depth+1),this.type===Ko.TILES3D){const r=[];for(r.push(n);r.length>0;){const o=r.pop();this.stats.get(ng).incrementCount();const s=o.header.children||[];for(const l of s){const c=new M2(this,l,o);if(c.contentUrl?.includes("?session=")){const y=new URL(c.contentUrl).searchParams.get("session");y&&(this._queryParams.session=y)}o.children.push(c),c.depth=o.depth+1,r.push(c)}}}return n}_initializeTraverser(){let t;switch(this.type){case Ko.TILES3D:t=Adt;break;case Ko.I3S:t=ydt;break;default:t=hv}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(n){this._onTileLoadError(t,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(Y4).incrementCount();const n=e.message||e.toString(),r=t.url;console.error(`A 3D tile failed to load: ${t.url} ${n}`),this.options.onTileError(t,n,r)}_onTileLoad(t,e){if(e){if(this.type===Ko.I3S){const n=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(ng).reset(),this.stats.get(ng).addCount(n)}t&&t.content&&Wft(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===Ko.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Ko.TILES3D){const{extensionsRemoved:e=[]}=t.content?.gltf||{};e.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),e.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),e.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(F1).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(F1).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(K4).incrementCount(),this.stats.get(O1).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(N1).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(O1).decrementCount(),this.stats.get(Z4).incrementCount(),this.stats.get(N1).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const n of e.children)t.push(n);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const r of t.children)n.push(r);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),n=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const v5="4.3.3",EA={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function _5(i,t,e){vr(i instanceof ArrayBuffer);const n=new TextDecoder("utf8"),r=new Uint8Array(i,t,e);return n.decode(r)}function bdt(i,t=0){const e=new DataView(i);return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}const xdt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ds={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Gn={...xdt,...ds},z1={[ds.DOUBLE]:Float64Array,[ds.FLOAT]:Float32Array,[ds.UNSIGNED_SHORT]:Uint16Array,[ds.UNSIGNED_INT]:Uint32Array,[ds.UNSIGNED_BYTE]:Uint8Array,[ds.BYTE]:Int8Array,[ds.SHORT]:Int16Array,[ds.INT]:Int32Array},wdt={DOUBLE:ds.DOUBLE,FLOAT:ds.FLOAT,UNSIGNED_SHORT:ds.UNSIGNED_SHORT,UNSIGNED_INT:ds.UNSIGNED_INT,UNSIGNED_BYTE:ds.UNSIGNED_BYTE,BYTE:ds.BYTE,SHORT:ds.SHORT,INT:ds.INT},U1="Failed to convert GL type";class ru{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in z1)if(z1[e]===t)return e;throw new Error(U1)}static fromName(t){const e=wdt[t];if(!e)throw new Error(U1);return e}static getArrayType(t){switch(t){case ds.UNSIGNED_SHORT_5_6_5:case ds.UNSIGNED_SHORT_4_4_4_4:case ds.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=z1[t];if(!e)throw new Error(U1);return e}}static getByteSize(t){return ru.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!ru.getArrayType(t)}static createTypedArray(t,e,n=0,r){r===void 0&&(r=(e.byteLength-n)/ru.getByteSize(t));const o=ru.getArrayType(t);return new o(e,n,r)}}function Edt(i,t){if(!i)throw new Error(`math.gl assertion failed. ${t}`)}function Cdt(i,t=[0,0,0]){const e=i>>11&31,n=i>>5&63,r=i&31;return t[0]=e<<3,t[1]=n<<2,t[2]=r<<3,t}new Ex;new ve;new Ex;new Ex;function $4(i,t=255){return Xu(i,0,t)/t*2-1}function tM(i){return i<0?-1:1}function Tdt(i,t,e,n){if(Edt(n),i<0||i>e||t<0||t>e)throw new Error(`x and y must be unsigned normalized integers between 0 and ${e}`);if(n.x=$4(i,e),n.y=$4(t,e),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const r=n.x;n.x=(1-Math.abs(n.y))*tM(r),n.y=(1-Math.abs(r))*tM(n.y)}return n.normalize()}function Sdt(i,t,e){return Tdt(i,t,255,e)}class jw{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(t,e){this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t,e=Gn.UNSIGNED_INT,n=1){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,r.byteOffset):r}getPropertyArray(t,e,n){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(e=ru.fromName(r.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(t,e,r)}getProperty(t,e,n,r,o){const s=this.json[t];if(!s)return s;const l=this.getPropertyArray(t,e,n);if(n===1)return l[r];for(let c=0;c<n;++c)o[c]=l[n*r+c];return o}_getTypedArrayFromBinary(t,e,n,r,o){const s=this._cachedTypedArrays;let l=s[t];return l||(l=ru.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+o,r*n),s[t]=l),l}_getTypedArrayFromArray(t,e,n){const r=this._cachedTypedArrays;let o=r[t];return o||(o=ru.createTypedArray(e,n),r[t]=o),o}}const Pdt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Idt={SCALAR:(i,t)=>i[t],VEC2:(i,t)=>[i[2*t+0],i[2*t+1]],VEC3:(i,t)=>[i[3*t+0],i[3*t+1],i[3*t+2]],VEC4:(i,t)=>[i[4*t+0],i[4*t+1],i[4*t+2],i[4*t+3]],MAT2:(i,t)=>[i[4*t+0],i[4*t+1],i[4*t+2],i[4*t+3]],MAT3:(i,t)=>[i[9*t+0],i[9*t+1],i[9*t+2],i[9*t+3],i[9*t+4],i[9*t+5],i[9*t+6],i[9*t+7],i[9*t+8]],MAT4:(i,t)=>[i[16*t+0],i[16*t+1],i[16*t+2],i[16*t+3],i[16*t+4],i[16*t+5],i[16*t+6],i[16*t+7],i[16*t+8],i[16*t+9],i[16*t+10],i[16*t+11],i[16*t+12],i[16*t+13],i[16*t+14],i[16*t+15]]},Mdt={SCALAR:(i,t,e)=>{t[e]=i},VEC2:(i,t,e)=>{t[2*e+0]=i[0],t[2*e+1]=i[1]},VEC3:(i,t,e)=>{t[3*e+0]=i[0],t[3*e+1]=i[1],t[3*e+2]=i[2]},VEC4:(i,t,e)=>{t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},MAT2:(i,t,e)=>{t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},MAT3:(i,t,e)=>{t[9*e+0]=i[0],t[9*e+1]=i[1],t[9*e+2]=i[2],t[9*e+3]=i[3],t[9*e+4]=i[4],t[9*e+5]=i[5],t[9*e+6]=i[6],t[9*e+7]=i[7],t[9*e+8]=i[8],t[9*e+9]=i[9]},MAT4:(i,t,e)=>{t[16*e+0]=i[0],t[16*e+1]=i[1],t[16*e+2]=i[2],t[16*e+3]=i[3],t[16*e+4]=i[4],t[16*e+5]=i[5],t[16*e+6]=i[6],t[16*e+7]=i[7],t[16*e+8]=i[8],t[16*e+9]=i[9],t[16*e+10]=i[10],t[16*e+11]=i[11],t[16*e+12]=i[12],t[16*e+13]=i[13],t[16*e+14]=i[14],t[16*e+15]=i[15]}};function Bdt(i,t,e,n){const{componentType:r}=i;vr(i.componentType);const o=typeof r=="string"?ru.fromName(r):r,s=Pdt[i.type],l=Idt[i.type],c=Mdt[i.type];return e+=i.byteOffset,{values:ru.createTypedArray(o,t,e,s*n),type:o,size:s,unpacker:l,packer:c}}const iu=i=>i!==void 0;function Rdt(i,t,e){if(!t)return null;let n=i.getExtension("3DTILES_batch_table_hierarchy");const r=t.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=r,n=r),n?Ldt(n,e):null}function Ldt(i,t){let e,n,r;const o=i.instancesLength,s=i.classes;let l=i.classIds,c=i.parentCounts,y=i.parentIds,_=o;iu(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,o));let C;if(iu(c))for(iu(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,o)),C=new Uint16Array(o),_=0,e=0;e<o;++e)C[e]=_,_+=c[e];iu(y)&&iu(y.byteOffset)&&(y.componentType=defaultValue(y.componentType,GL.UNSIGNED_SHORT),y.type=AttributeType.SCALAR,r=getBinaryAccessor(y),y=r.createArrayBufferView(t.buffer,t.byteOffset+y.byteOffset,_));const I=s.length;for(e=0;e<I;++e){const X=s[e].length,H=s[e].instances,$=getBinaryProperties(X,H,t);s[e].instances=combine($,H)}const k=new Array(I).fill(0),z=new Uint16Array(o);for(e=0;e<o;++e)n=l[e],z[e]=k[n],++k[n];const V={classes:s,classIds:l,classIndexes:z,parentCounts:c,parentIndexes:C,parentIds:y};return Odt(V),V}function CA(i,t,e){if(!i)return;const n=i.parentCounts;return i.parentIds?e(i,t):n>0?Ddt(i,t,e):kdt(i,t,e)}function Ddt(i,t,e){const n=i.classIds,r=i.parentCounts,o=i.parentIds,s=i.parentIndexes,l=n.length,c=scratchVisited;c.length=Math.max(c.length,l);const y=++marker,_=scratchStack;for(_.length=0,_.push(t);_.length>0;){if(t=_.pop(),c[t]===y)continue;c[t]=y;const C=e(i,t);if(iu(C))return C;const I=r[t],k=s[t];for(let z=0;z<I;++z){const V=o[k+z];V!==t&&_.push(V)}}return null}function kdt(i,t,e){let n=!0;for(;n;){const r=e(i,t);if(iu(r))return r;const o=i.parentIds[t];n=o!==t,t=o}throw new Error("traverseHierarchySingleParent")}function Odt(i){const t=i.classIds.length;for(let e=0;e<t;++e)b5(i,e,stack)}function b5(i,t,e){const n=i.parentCounts,r=i.parentIds,o=i.parentIndexes,s=i.classIds.length;if(!iu(r))return;assert(t<s,`Parent index ${t} exceeds the total number of instances: ${s}`),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const l=iu(n)?n[t]:1,c=iu(n)?o[t]:t;for(let y=0;y<l;++y){const _=r[c+y];_!==t&&b5(i,_,e)}e.pop(t)}function qo(i){return i!=null}const rg=(i,t)=>i,Fdt={HIERARCHY:!0,extensions:!0,extras:!0};class x5{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(t,e,n,r={}){vr(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=this.json?.extensions||{},this._properties={};for(const o in this.json)Fdt[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Rdt(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),vr(typeof e=="string",e),this._hierarchy){const n=CA(this._hierarchy,t,(r,o)=>{const s=r.classIds[o];return r.classes[s].name===e});return qo(n)}return!1}isExactClass(t,e){return vr(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),vr(typeof e=="string",e),qo(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=qo(e)?e:[],e.length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),vr(typeof e=="string",e),this._binaryProperties){const r=this._binaryProperties[e];if(qo(r))return this._getBinaryProperty(r,t)}const n=this._properties[e];if(qo(n))return rg(n[t]);if(this._hierarchy){const r=this._getHierarchyProperty(t,e);if(qo(r))return r}}setProperty(t,e,n){const r=this.featureCount;if(this._checkBatchId(t),vr(typeof e=="string",e),this._binaryProperties){const s=this._binaryProperties[e];if(s){this._setBinaryProperty(s,t,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let o=this._properties[e];qo(o)||(this._properties[e]=new Array(r),o=this._properties[e]),o[t]=rg(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],r=this._initializeBinaryProperty(e,n);r&&(t=t||{},t[e]=r)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;vr(this.binary,`Property ${t} requires a batch table binary.`),vr(n.type,`Property ${t} requires a type.`);const r=Bdt(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=CA(this._hierarchy,t,(r,o)=>{const s=r.classIds[o],l=r.classes[s].instances;return qo(l[e])});return qo(n)}_getPropertyNamesInHierarchy(t,e){CA(this._hierarchy,t,(n,r)=>{const o=n.classIds[r],s=n.classes[o].instances;for(const l in s)s.hasOwnProperty(l)&&e.indexOf(l)===-1&&e.push(l)})}_getHierarchyProperty(t,e){return CA(this._hierarchy,t,(n,r)=>{const o=n.classIds[r],s=n.classes[o],l=n.classIndexes[r],c=s.instances[e];return qo(c)?qo(c.typedArray)?this._getBinaryProperty(c,l):rg(c[l]):null})}_setHierarchyProperty(t,e,n,r){const o=CA(this._hierarchy,e,(s,l)=>{const c=s.classIds[l],y=s.classes[c],_=s.classIndexes[l],C=y.instances[n];return qo(C)?(vr(l===e,`Inherited property "${n}" is read-only.`),qo(C.typedArray)?this._setBinaryProperty(C,_,r):C[_]=rg(r),!0):!1});return qo(o)}}const V1=4;function fv(i,t,e=0){const n=new DataView(t);if(i.magic=n.getUint32(e,!0),e+=V1,i.version=n.getUint32(e,!0),e+=V1,i.byteLength=n.getUint32(e,!0),e+=V1,i.version!==1)throw new Error(`3D Tile Version ${i.version} not supported`);return e}const Pd=4,eM="b3dm tile in legacy format.";function Ww(i,t,e){const n=new DataView(t);let r;i.header=i.header||{};let o=n.getUint32(e,!0);e+=Pd;let s=n.getUint32(e,!0);e+=Pd;let l=n.getUint32(e,!0);e+=Pd;let c=n.getUint32(e,!0);return e+=Pd,l>=570425344?(e-=Pd*2,r=o,l=s,c=0,o=0,s=0,console.warn(eM)):c>=570425344&&(e-=Pd,r=l,l=o,c=s,o=0,s=0,console.warn(eM)),i.header.featureTableJsonByteLength=o,i.header.featureTableBinaryByteLength=s,i.header.batchTableJsonByteLength=l,i.header.batchTableBinaryByteLength=c,i.header.batchLength=r,e}function Hw(i,t,e,n){return e=Ndt(i,t,e),e=zdt(i,t,e),e}function Ndt(i,t,e,n){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:o,batchLength:s}=i.header||{};if(i.featureTableJson={BATCH_LENGTH:s||0},r&&r>0){const l=_5(t,e,r);i.featureTableJson=JSON.parse(l)}return e+=r||0,i.featureTableBinary=new Uint8Array(t,e,o),e+=o||0,e}function zdt(i,t,e,n){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:o}=i.header||{};if(r&&r>0){const s=_5(t,e,r);i.batchTableJson=JSON.parse(s),e+=r,o&&o>0&&(i.batchTableBinary=new Uint8Array(t,e,o),i.batchTableBinary=new Uint8Array(i.batchTableBinary),e+=o)}return e}function w5(i,t,e){if(!t&&(!i||!i.batchIds||!e))return null;const{batchIds:n,isRGB565:r,pointCount:o=0}=i;if(n&&e){const s=new Uint8ClampedArray(o*3);for(let l=0;l<o;l++){const c=n[l],y=e.getProperty(c,"dimensions").map(_=>_*255);s[l*3]=y[0],s[l*3+1]=y[1],s[l*3+2]=y[2]}return{type:Gn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}if(t&&r){const s=new Uint8ClampedArray(o*3);for(let l=0;l<o;l++){const c=Cdt(t[l]);s[l*3]=c[0],s[l*3+1]=c[1],s[l*3+2]=c[2]}return{type:Gn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}return t&&t.length===o*3?{type:Gn.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Gn.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const iM=new ve;function Udt(i,t){if(!t)return null;if(i.isOctEncoded16P){const e=new Float32Array((i.pointsLength||0)*3);for(let n=0;n<(i.pointsLength||0);n++)Sdt(t[n*2],t[n*2+1],iM),iM.toArray(e,n*3);return{type:Gn.FLOAT,size:2,value:e}}return{type:Gn.FLOAT,size:2,value:t}}function Vdt(i,t,e){return i.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(i.isQuantized=!1,Gdt(i,t)):{type:Gn.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function Gdt(i,t){const e=new ve,n=new Float32Array(i.pointCount*3);for(let r=0;r<i.pointCount;r++)e.set(t[r*3],t[r*3+1],t[r*3+2]).scale(1/i.quantizedRange).multiply(i.quantizedVolumeScale).add(i.quantizedVolumeOffset).toArray(n,r*3);return n}async function jdt(i,t,e,n,r){e=fv(i,t,e),e=Ww(i,t,e),e=Hw(i,t,e),Wdt(i);const{featureTable:o,batchTable:s}=Hdt(i);return await Ydt(i,o,s,n,r),Xdt(i,o,n),qdt(i,o,s),Kdt(i,o),e}function Wdt(i){i.attributes={positions:null,colors:null,normals:null,batchIds:null},i.isQuantized=!1,i.isTranslucent=!1,i.isRGB565=!1,i.isOctEncoded16P=!1}function Hdt(i){const t=new jw(i.featureTableJson,i.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,i.featuresLength=e,i.pointsLength=e,i.pointCount=e,i.rtcCenter=t.getGlobalProperty("RTC_CENTER",Gn.FLOAT,3);const n=Zdt(i,t);return{featureTable:t,batchTable:n}}function Xdt(i,t,e){if(i.attributes=i.attributes||{positions:null,colors:null,normals:null,batchIds:null},!i.attributes.positions){if(t.hasProperty("POSITION"))i.attributes.positions=t.getPropertyArray("POSITION",Gn.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",Gn.UNSIGNED_SHORT,3);if(i.isQuantized=!0,i.quantizedRange=65535,i.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Gn.FLOAT,3),!i.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(i.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Gn.FLOAT,3),!i.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");i.attributes.positions=Vdt(i,n,e)}}if(!i.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function qdt(i,t,e){if(i.attributes=i.attributes||{positions:null,colors:null,normals:null,batchIds:null},!i.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",Gn.UNSIGNED_BYTE,4),i.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",Gn.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",Gn.UNSIGNED_SHORT,1),i.isRGB565=!0),i.attributes.colors=w5(i,n,e)}t.hasProperty("CONSTANT_RGBA")&&(i.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Gn.UNSIGNED_BYTE,4))}function Kdt(i,t){if(i.attributes=i.attributes||{positions:null,colors:null,normals:null,batchIds:null},!i.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",Gn.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",Gn.UNSIGNED_BYTE,2),i.isOctEncoded16P=!0),i.attributes.normals=Udt(i,e)}}function Zdt(i,t){let e=null;if(!i.batchIds&&t.hasProperty("BATCH_ID")&&(i.batchIds=t.getPropertyArray("BATCH_ID",Gn.UNSIGNED_SHORT,1),i.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:o}=i;e=new x5(r,o,n)}return e}async function Ydt(i,t,e,n,r){let o,s,l;const c=i.batchTableJson&&i.batchTableJson.extensions&&i.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(l=c.properties);const y=t.getExtension("3DTILES_draco_point_compression");if(y){s=y.properties;const C=y.byteOffset,I=y.byteLength;if(!s||!Number.isFinite(C)||!I)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=(i.featureTableBinary||[]).slice(C,C+I),i.hasPositions=Number.isFinite(s.POSITION),i.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),i.hasNormals=Number.isFinite(s.NORMAL),i.hasBatchIds=Number.isFinite(s.BATCH_ID),i.isTranslucent=Number.isFinite(s.RGBA)}if(!o)return!0;const _={buffer:o,properties:{...s,...l},batchTableProperties:l};return await Qdt(i,_,n,r)}async function Qdt(i,t,e,n){if(!n)return;const r={...e,draco:{...e?.draco,extraAttributes:t.batchTableProperties||{}}};delete r["3d-tiles"];const o=await Am(t.buffer,s8,r,n),s=o.attributes.POSITION&&o.attributes.POSITION.value,l=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,c=o.attributes.NORMAL&&o.attributes.NORMAL.value,y=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,_=s&&o.attributes.POSITION.value.quantization,C=c&&o.attributes.NORMAL.value.quantization;if(_){const k=o.POSITION.data.quantization,z=k.range;i.quantizedVolumeScale=new ve(z,z,z),i.quantizedVolumeOffset=new ve(k.minValues),i.quantizedRange=(1<<k.quantizationBits)-1,i.isQuantizedDraco=!0}C&&(i.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,i.isOctEncodedDraco=!0);const I={};if(t.batchTableProperties)for(const k of Object.keys(t.batchTableProperties))o.attributes[k]&&o.attributes[k].value&&(I[k.toLowerCase()]=o.attributes[k].value);i.attributes={positions:s,colors:w5(i,l,void 0),normals:c,batchIds:y,...I}}const B2={URI:0,EMBEDDED:1};function E5(i,t,e,n){i.rotateYtoZ=!0;const r=(i.byteOffset||0)+(i.byteLength||0)-e;if(r===0)throw new Error("glTF byte length must be greater than 0.");return i.gltfUpAxis=n?.["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",i.gltfArrayBuffer=X2(t,e,r),i.gltfByteOffset=0,i.gltfByteLength=r,e%4===0||console.warn(`${i.type}: embedded glb is not aligned to a 4-byte boundary.`),(i.byteOffset||0)+(i.byteLength||0)}async function C5(i,t,e,n){const r=e?.["3d-tiles"]||{};if(Jdt(i,t),r.loadGLTF){if(!n)return;if(i.gltfUrl){const{fetch:o}=n,s=await o(i.gltfUrl,e);i.gltfArrayBuffer=await s.arrayBuffer(),i.gltfByteOffset=0}if(i.gltfArrayBuffer){const o=await Am(i.gltfArrayBuffer,wp,e,n);i.gltf=iw(o),i.gpuMemoryUsageInBytes=qL(i.gltf),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength}}}function Jdt(i,t,e){switch(t){case B2.URI:if(i.gltfArrayBuffer){const n=new Uint8Array(i.gltfArrayBuffer,i.gltfByteOffset),r=new TextDecoder().decode(n);i.gltfUrl=r.replace(/[\s\0]+$/,"")}delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength;break;case B2.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function $dt(i,t,e,n,r){e=tpt(i,t,e,n),await C5(i,B2.EMBEDDED,n,r);const o=i?.gltf?.extensions;return o&&o.CESIUM_RTC&&(i.rtcCenter=o.CESIUM_RTC.center),e}function tpt(i,t,e,n,r){e=fv(i,t,e),e=Ww(i,t,e),e=Hw(i,t,e),e=E5(i,t,e,n);const o=new jw(i.featureTableJson,i.featureTableBinary);return i.rtcCenter=o.getGlobalProperty("RTC_CENTER",Gn.FLOAT,3),e}async function ept(i,t,e,n,r){return e=ipt(i,t,e,n),await C5(i,i.gltfFormat||0,n,r),e}function ipt(i,t,e,n,r){if(e=fv(i,t,e),i.version!==1)throw new Error(`Instanced 3D Model version ${i.version} is not supported`);e=Ww(i,t,e);const o=new DataView(t);if(i.gltfFormat=o.getUint32(e,!0),e+=4,e=Hw(i,t,e),e=E5(i,t,e,n),!i?.header?.featureTableJsonByteLength||i.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const s=new jw(i.featureTableJson,i.featureTableBinary),l=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");i.eastNorthUp=s.getGlobalProperty("EAST_NORTH_UP"),i.rtcCenter=s.getGlobalProperty("RTC_CENTER",Gn.FLOAT,3);const c=new x5(i.batchTableJson,i.batchTableBinary,l);return npt(i,s,c,l),e}function npt(i,t,e,n){const r=new Array(n),o=new ve;new ve,new ve,new ve;const s=new ts,l=new em,c=new ve,y={},_=new bn,C=[],I=[],k=[],z=[];for(let V=0;V<n;V++){let X;if(t.hasProperty("POSITION"))X=t.getProperty("POSITION",Gn.FLOAT,3,V,o);else if(t.hasProperty("POSITION_QUANTIZED")){X=t.getProperty("POSITION_QUANTIZED",Gn.UNSIGNED_SHORT,3,V,o);const nt=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Gn.FLOAT,3);if(!nt)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ot=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Gn.FLOAT,3);if(!Ot)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Kt=65535;for(let ft=0;ft<3;ft++)X[ft]=X[ft]/Kt*Ot[ft]+nt[ft]}if(!X)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(X),y.translation=o,i.normalUp=t.getProperty("NORMAL_UP",Gn.FLOAT,3,V,C),i.normalRight=t.getProperty("NORMAL_RIGHT",Gn.FLOAT,3,V,I),i.normalUp){if(!i.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");i.hasCustomOrientation=!0}else{if(i.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Gn.UNSIGNED_SHORT,2,V,C),i.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Gn.UNSIGNED_SHORT,2,V,I),i.octNormalUp)throw i.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");i.eastNorthUp?(_r.WGS84.eastNorthUpToFixedFrame(o,_),_.getRotationMatrix3(s)):s.identity()}l.fromMatrix3(s),y.rotation=l,c.set(1,1,1);const H=t.getProperty("SCALE",Gn.FLOAT,1,V,k);Number.isFinite(H)&&c.multiplyByScalar(H);const $=t.getProperty("SCALE_NON_UNIFORM",Gn.FLOAT,3,V,C);$&&c.scale($),y.scale=c;let Y=t.getProperty("BATCH_ID",Gn.UNSIGNED_SHORT,1,V,z);Y===void 0&&(Y=V);const ct=new bn().fromQuaternion(y.rotation);_.identity(),_.translate(y.translation),_.multiplyRight(ct),_.scale(y.scale);const rt=_.clone();r[V]={modelMatrix:rt,batchId:Y}}i.instances=r}async function rpt(i,t,e,n,r,o){e=fv(i,t,e);const s=new DataView(t);for(i.tilesLength=s.getUint32(e,!0),e+=4,i.tiles=[];i.tiles.length<i.tilesLength&&(i.byteLength||0)-e>12;){const l={shape:"tile3d"};i.tiles.push(l),e=await o(t,e,n,r,l)}return e}async function spt(i,t,e,n){if(i.rotateYtoZ=!0,i.gltfUpAxis=e?.["3d-tiles"]?.assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y",e?.["3d-tiles"]?.loadGLTF){if(!n)return t.byteLength;const r=await Am(t,wp,e,n);i.gltf=iw(r),i.gpuMemoryUsageInBytes=qL(i.gltf)}else i.gltfArrayBuffer=t;return t.byteLength}async function T5(i,t=0,e,n,r={shape:"tile3d"}){switch(r.byteOffset=t,r.type=bdt(i,t),r.type){case EA.COMPOSITE:return await rpt(r,i,t,e,n,T5);case EA.BATCHED_3D_MODEL:return await $dt(r,i,t,e,n);case EA.GLTF:return await spt(r,i,e,n);case EA.INSTANCED_3D_MODEL:return await ept(r,i,t,e,n);case EA.POINT_CLOUD:return await jdt(r,i,t,e,n);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const opt=1952609651,apt=1;async function lpt(i,t,e){if(new Uint32Array(i.slice(0,4))[0]!==opt)throw new Error("Wrong subtree file magic number");if(new Uint32Array(i.slice(4,8))[0]!==apt)throw new Error("Wrong subtree file verson, must be 1");const n=nM(i.slice(8,16)),r=new Uint8Array(i,24,n),o=new TextDecoder("utf8").decode(r),s=JSON.parse(o),l=nM(i.slice(16,24));let c=new ArrayBuffer(0);if(l&&(c=i.slice(24+n)),await sg(s,s.tileAvailability,c,e),Array.isArray(s.contentAvailability))for(const y of s.contentAvailability)await sg(s,y,c,e);else await sg(s,s.contentAvailability,c,e);return await sg(s,s.childSubtreeAvailability,c,e),s}async function sg(i,t,e,n){const r=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof r!="number")return;const o=i.bufferViews[r],s=i.buffers[o.buffer];if(!n?.baseUrl)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(s.uri){const c=`${n?.baseUrl||""}/${s.uri}`,y=await(await n.fetch(c)).arrayBuffer();t.explicitBitstream=new Uint8Array(y,o.byteOffset,o.byteLength);return}const l=i.buffers.slice(0,o.buffer).reduce((c,y)=>c+y.byteLength,0);t.explicitBitstream=new Uint8Array(e.slice(l,l+s.byteLength),o.byteOffset,o.byteLength)}function nM(i){const t=new DataView(i),e=t.getUint32(0,!0),n=t.getUint32(4,!0);return e+2**32*n}const S5={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:v5,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:lpt,options:{}};var La=null;try{La=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Hn(i,t,e){this.low=i|0,this.high=t|0,this.unsigned=!!e}Hn.prototype.__isLong__;Object.defineProperty(Hn.prototype,"__isLong__",{value:!0});function vo(i){return(i&&i.__isLong__)===!0}function rM(i){var t=Math.clz32(i&-i);return i?31-t:t}Hn.isLong=vo;var sM={},oM={};function _f(i,t){var e,n,r;return t?(i>>>=0,(r=0<=i&&i<256)&&(n=oM[i],n)?n:(e=jn(i,0,!0),r&&(oM[i]=e),e)):(i|=0,(r=-128<=i&&i<128)&&(n=sM[i],n)?n:(e=jn(i,i<0?-1:0,!1),r&&(sM[i]=e),e))}Hn.fromInt=_f;function Da(i,t){if(isNaN(i))return t?Zu:ml;if(t){if(i<0)return Zu;if(i>=P5)return B5}else{if(i<=-lM)return Yo;if(i+1>=lM)return M5}return i<0?Da(-i,t).neg():jn(i%Ip|0,i/Ip|0,t)}Hn.fromNumber=Da;function jn(i,t,e){return new Hn(i,t,e)}Hn.fromBits=jn;var yy=Math.pow;function Xw(i,t,e){if(i.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return t?Zu:ml;if(e=e||10,e<2||36<e)throw RangeError("radix");var n;if((n=i.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Xw(i.substring(1),t,e).neg();for(var r=Da(yy(e,8)),o=ml,s=0;s<i.length;s+=8){var l=Math.min(8,i.length-s),c=parseInt(i.substring(s,s+l),e);if(l<8){var y=Da(yy(e,l));o=o.mul(y).add(Da(c))}else o=o.mul(r),o=o.add(Da(c))}return o.unsigned=t,o}Hn.fromString=Xw;function Ua(i,t){return typeof i=="number"?Da(i,t):typeof i=="string"?Xw(i,t):jn(i.low,i.high,typeof t=="boolean"?t:i.unsigned)}Hn.fromValue=Ua;var aM=65536,upt=1<<24,Ip=aM*aM,P5=Ip*Ip,lM=P5/2,uM=_f(upt),ml=_f(0);Hn.ZERO=ml;var Zu=_f(0,!0);Hn.UZERO=Zu;var ip=_f(1);Hn.ONE=ip;var I5=_f(1,!0);Hn.UONE=I5;var R2=_f(-1);Hn.NEG_ONE=R2;var M5=jn(-1,2147483647,!1);Hn.MAX_VALUE=M5;var B5=jn(-1,-1,!0);Hn.MAX_UNSIGNED_VALUE=B5;var Yo=jn(0,-2147483648,!1);Hn.MIN_VALUE=Yo;var oi=Hn.prototype;oi.toInt=function(){return this.unsigned?this.low>>>0:this.low};oi.toNumber=function(){return this.unsigned?(this.high>>>0)*Ip+(this.low>>>0):this.high*Ip+(this.low>>>0)};oi.toString=function(i){if(i=i||10,i<2||36<i)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Yo)){var t=Da(i),e=this.div(t),n=e.mul(t).sub(this);return e.toString(i)+n.toInt().toString(i)}else return"-"+this.neg().toString(i);for(var r=Da(yy(i,6),this.unsigned),o=this,s="";;){var l=o.div(r),c=o.sub(l.mul(r)).toInt()>>>0,y=c.toString(i);if(o=l,o.isZero())return y+s;for(;y.length<6;)y="0"+y;s=""+y+s}};oi.getHighBits=function(){return this.high};oi.getHighBitsUnsigned=function(){return this.high>>>0};oi.getLowBits=function(){return this.low};oi.getLowBitsUnsigned=function(){return this.low>>>0};oi.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Yo)?64:this.neg().getNumBitsAbs();for(var i=this.high!=0?this.high:this.low,t=31;t>0&&(i&1<<t)==0;t--);return this.high!=0?t+33:t+1};oi.isSafeInteger=function(){var i=this.high>>21;return i?this.unsigned?!1:i===-1&&!(this.low===0&&this.high===-2097152):!0};oi.isZero=function(){return this.high===0&&this.low===0};oi.eqz=oi.isZero;oi.isNegative=function(){return!this.unsigned&&this.high<0};oi.isPositive=function(){return this.unsigned||this.high>=0};oi.isOdd=function(){return(this.low&1)===1};oi.isEven=function(){return(this.low&1)===0};oi.equals=function(i){return vo(i)||(i=Ua(i)),this.unsigned!==i.unsigned&&this.high>>>31===1&&i.high>>>31===1?!1:this.high===i.high&&this.low===i.low};oi.eq=oi.equals;oi.notEquals=function(i){return!this.eq(i)};oi.neq=oi.notEquals;oi.ne=oi.notEquals;oi.lessThan=function(i){return this.comp(i)<0};oi.lt=oi.lessThan;oi.lessThanOrEqual=function(i){return this.comp(i)<=0};oi.lte=oi.lessThanOrEqual;oi.le=oi.lessThanOrEqual;oi.greaterThan=function(i){return this.comp(i)>0};oi.gt=oi.greaterThan;oi.greaterThanOrEqual=function(i){return this.comp(i)>=0};oi.gte=oi.greaterThanOrEqual;oi.ge=oi.greaterThanOrEqual;oi.compare=function(i){if(vo(i)||(i=Ua(i)),this.eq(i))return 0;var t=this.isNegative(),e=i.isNegative();return t&&!e?-1:!t&&e?1:this.unsigned?i.high>>>0>this.high>>>0||i.high===this.high&&i.low>>>0>this.low>>>0?-1:1:this.sub(i).isNegative()?-1:1};oi.comp=oi.compare;oi.negate=function(){return!this.unsigned&&this.eq(Yo)?Yo:this.not().add(ip)};oi.neg=oi.negate;oi.add=function(i){vo(i)||(i=Ua(i));var t=this.high>>>16,e=this.high&65535,n=this.low>>>16,r=this.low&65535,o=i.high>>>16,s=i.high&65535,l=i.low>>>16,c=i.low&65535,y=0,_=0,C=0,I=0;return I+=r+c,C+=I>>>16,I&=65535,C+=n+l,_+=C>>>16,C&=65535,_+=e+s,y+=_>>>16,_&=65535,y+=t+o,y&=65535,jn(C<<16|I,y<<16|_,this.unsigned)};oi.subtract=function(i){return vo(i)||(i=Ua(i)),this.add(i.neg())};oi.sub=oi.subtract;oi.multiply=function(i){if(this.isZero())return this;if(vo(i)||(i=Ua(i)),La){var t=La.mul(this.low,this.high,i.low,i.high);return jn(t,La.get_high(),this.unsigned)}if(i.isZero())return this.unsigned?Zu:ml;if(this.eq(Yo))return i.isOdd()?Yo:ml;if(i.eq(Yo))return this.isOdd()?Yo:ml;if(this.isNegative())return i.isNegative()?this.neg().mul(i.neg()):this.neg().mul(i).neg();if(i.isNegative())return this.mul(i.neg()).neg();if(this.lt(uM)&&i.lt(uM))return Da(this.toNumber()*i.toNumber(),this.unsigned);var e=this.high>>>16,n=this.high&65535,r=this.low>>>16,o=this.low&65535,s=i.high>>>16,l=i.high&65535,c=i.low>>>16,y=i.low&65535,_=0,C=0,I=0,k=0;return k+=o*y,I+=k>>>16,k&=65535,I+=r*y,C+=I>>>16,I&=65535,I+=o*c,C+=I>>>16,I&=65535,C+=n*y,_+=C>>>16,C&=65535,C+=r*c,_+=C>>>16,C&=65535,C+=o*l,_+=C>>>16,C&=65535,_+=e*y+n*c+r*l+o*s,_&=65535,jn(I<<16|k,_<<16|C,this.unsigned)};oi.mul=oi.multiply;oi.divide=function(i){if(vo(i)||(i=Ua(i)),i.isZero())throw Error("division by zero");if(La){if(!this.unsigned&&this.high===-2147483648&&i.low===-1&&i.high===-1)return this;var t=(this.unsigned?La.div_u:La.div_s)(this.low,this.high,i.low,i.high);return jn(t,La.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Zu:ml;var e,n,r;if(this.unsigned){if(i.unsigned||(i=i.toUnsigned()),i.gt(this))return Zu;if(i.gt(this.shru(1)))return I5;r=Zu}else{if(this.eq(Yo)){if(i.eq(ip)||i.eq(R2))return Yo;if(i.eq(Yo))return ip;var o=this.shr(1);return e=o.div(i).shl(1),e.eq(ml)?i.isNegative()?ip:R2:(n=this.sub(i.mul(e)),r=e.add(n.div(i)),r)}else if(i.eq(Yo))return this.unsigned?Zu:ml;if(this.isNegative())return i.isNegative()?this.neg().div(i.neg()):this.neg().div(i).neg();if(i.isNegative())return this.div(i.neg()).neg();r=ml}for(n=this;n.gte(i);){e=Math.max(1,Math.floor(n.toNumber()/i.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),l=s<=48?1:yy(2,s-48),c=Da(e),y=c.mul(i);y.isNegative()||y.gt(n);)e-=l,c=Da(e,this.unsigned),y=c.mul(i);c.isZero()&&(c=ip),r=r.add(c),n=n.sub(y)}return r};oi.div=oi.divide;oi.modulo=function(i){if(vo(i)||(i=Ua(i)),La){var t=(this.unsigned?La.rem_u:La.rem_s)(this.low,this.high,i.low,i.high);return jn(t,La.get_high(),this.unsigned)}return this.sub(this.div(i).mul(i))};oi.mod=oi.modulo;oi.rem=oi.modulo;oi.not=function(){return jn(~this.low,~this.high,this.unsigned)};oi.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};oi.clz=oi.countLeadingZeros;oi.countTrailingZeros=function(){return this.low?rM(this.low):rM(this.high)+32};oi.ctz=oi.countTrailingZeros;oi.and=function(i){return vo(i)||(i=Ua(i)),jn(this.low&i.low,this.high&i.high,this.unsigned)};oi.or=function(i){return vo(i)||(i=Ua(i)),jn(this.low|i.low,this.high|i.high,this.unsigned)};oi.xor=function(i){return vo(i)||(i=Ua(i)),jn(this.low^i.low,this.high^i.high,this.unsigned)};oi.shiftLeft=function(i){return vo(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?jn(this.low<<i,this.high<<i|this.low>>>32-i,this.unsigned):jn(0,this.low<<i-32,this.unsigned)};oi.shl=oi.shiftLeft;oi.shiftRight=function(i){return vo(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?jn(this.low>>>i|this.high<<32-i,this.high>>i,this.unsigned):jn(this.high>>i-32,this.high>=0?0:-1,this.unsigned)};oi.shr=oi.shiftRight;oi.shiftRightUnsigned=function(i){return vo(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?jn(this.low>>>i|this.high<<32-i,this.high>>>i,this.unsigned):i===32?jn(this.high,0,this.unsigned):jn(this.high>>>i-32,0,this.unsigned)};oi.shru=oi.shiftRightUnsigned;oi.shr_u=oi.shiftRightUnsigned;oi.rotateLeft=function(i){var t;return vo(i)&&(i=i.toInt()),(i&=63)===0?this:i===32?jn(this.high,this.low,this.unsigned):i<32?(t=32-i,jn(this.low<<i|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)):(i-=32,t=32-i,jn(this.high<<i|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned))};oi.rotl=oi.rotateLeft;oi.rotateRight=function(i){var t;return vo(i)&&(i=i.toInt()),(i&=63)===0?this:i===32?jn(this.high,this.low,this.unsigned):i<32?(t=32-i,jn(this.high<<t|this.low>>>i,this.low<<t|this.high>>>i,this.unsigned)):(i-=32,t=32-i,jn(this.low<<t|this.high>>>i,this.high<<t|this.low>>>i,this.unsigned))};oi.rotr=oi.rotateRight;oi.toSigned=function(){return this.unsigned?jn(this.low,this.high,!1):this};oi.toUnsigned=function(){return this.unsigned?this:jn(this.low,this.high,!0)};oi.toBytes=function(i){return i?this.toBytesLE():this.toBytesBE()};oi.toBytesLE=function(){var i=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,i&255,i>>>8&255,i>>>16&255,i>>>24]};oi.toBytesBE=function(){var i=this.high,t=this.low;return[i>>>24,i>>>16&255,i>>>8&255,i&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Hn.fromBytes=function(i,t,e){return e?Hn.fromBytesLE(i,t):Hn.fromBytesBE(i,t)};Hn.fromBytesLE=function(i,t){return new Hn(i[0]|i[1]<<8|i[2]<<16|i[3]<<24,i[4]|i[5]<<8|i[6]<<16|i[7]<<24,t)};Hn.fromBytesBE=function(i,t){return new Hn(i[4]<<24|i[5]<<16|i[6]<<8|i[7],i[0]<<24|i[1]<<16|i[2]<<8|i[3],t)};typeof BigInt=="function"&&(Hn.fromBigInt=function(i,t){var e=Number(BigInt.asIntN(32,i)),n=Number(BigInt.asIntN(32,i>>BigInt(32)));return jn(e,n,t)},Hn.fromValue=function(i,t){return typeof i=="bigint"?Hn.fromBigInt(i,t):Ua(i,t)},oi.toBigInt=function(){var i=BigInt(this.low>>>0),t=BigInt(this.unsigned?this.high>>>0:this.high);return t<<BigInt(32)|i});const cpt=16;function R5(i){i==="X"&&(i="");const t=i.padEnd(cpt,"0");return Hn.fromString(t,!0,16)}function hpt(i){if(i.isZero())return"X";let t=i.countTrailingZeros();const e=t%4;t=(t-e)/4;const n=t;t*=4;const r=i.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-r.length).join("0")+r}function fpt(i,t){const e=dpt(i).shiftRightUnsigned(2);return i.add(Hn.fromNumber(2*t+1-4).multiply(e))}function dpt(i){return i.and(i.not().add(1))}const ppt=3,Apt=30,mpt=2*Apt+1,cM=180/Math.PI;function gpt(i){if(i.length===0)throw new Error(`Invalid Hilbert quad key ${i}`);const t=i.split("/"),e=parseInt(t[0],10),n=t[1],r=n.length;let o=0;const s=[0,0];for(let l=r-1;l>=0;l--){o=r-l;const c=n[l];let y=0,_=0;c==="1"?_=1:c==="2"?(y=1,_=1):c==="3"&&(y=1);const C=Math.pow(2,o-1);vpt(C,s,y,_),s[0]+=C*y,s[1]+=C*_}if(e%2===1){const l=s[0];s[0]=s[1],s[1]=l}return{face:e,ij:s,level:o}}function ypt(i){if(i.isZero())return"";let t=i.toString(2);for(;t.length<ppt+mpt;)t="0"+t;const e=t.lastIndexOf("1"),n=t.substring(0,3),r=t.substring(3,e),o=r.length/2,s=Hn.fromString(n,!0,2).toString(10);let l="";if(o!==0)for(l=Hn.fromString(r,!0,2).toString(4);l.length<o;)l="0"+l;return`${s}/${l}`}function L5(i,t,e){const n=1<<t;return[(i[0]+e[0])/n,(i[1]+e[1])/n]}function hM(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))}function D5(i){return[hM(i[0]),hM(i[1])]}function k5(i,[t,e]){switch(i){case 0:return[1,t,e];case 1:return[-t,1,e];case 2:return[-t,-e,1];case 3:return[-1,-e,-t];case 4:return[e,-1,-t];case 5:return[e,t,-1];default:throw new Error("Invalid face")}}function O5([i,t,e]){const n=Math.atan2(e,Math.sqrt(i*i+t*t));return[Math.atan2(t,i)*cM,n*cM]}function vpt(i,t,e,n){if(n===0){e===1&&(t[0]=i-1-t[0],t[1]=i-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function _pt(i){const t=L5(i.ij,i.level,[.5,.5]),e=D5(t),n=k5(i.face,e);return O5(n)}const bpt=100;function fM(i){const{face:t,ij:e,level:n}=i,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(bpt*Math.pow(2,-n))),s=new Float64Array(4*o*2+2);let l=0,c=0;for(let y=0;y<4;y++){const _=r[y].slice(0),C=r[y+1],I=(C[0]-_[0])/o,k=(C[1]-_[1])/o;for(let z=0;z<o;z++){_[0]+=I,_[1]+=k;const V=L5(e,n,_),X=D5(V),H=k5(t,X),$=O5(H);Math.abs($[1])>89.999&&($[0]=c);const Y=$[0]-c;$[0]+=Y>180?-360:Y<-180?360:0,s[l++]=$[0],s[l++]=$[1],c=$[0]}}return s[l++]=s[0],s[l++]=s[1],s}function qw(i){const t=xpt(i);return gpt(t)}function xpt(i){if(i.indexOf("/")>0)return i;const t=R5(i);return ypt(t)}function wpt(i){const t=qw(i);return _pt(t)}function Ept(i){let t;if(i.face===2||i.face===5){let e=null,n=0;for(let r=0;r<4;r++){const o=`${i.face}/${r}`,s=qw(o),l=fM(s);(typeof e>"u"||e===null)&&(e=new Float64Array(4*l.length)),e.set(l,n),n+=l.length}t=dM(e)}else{const e=fM(i);t=dM(e)}return t}function dM(i){if(i.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let n=0;n<i.length;n+=2)t.push(i[n]),e.push(i[n+1]);return t.sort((n,r)=>n-r),e.sort((n,r)=>n-r),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function Cpt(i,t){const e=t?.minimumHeight||0,n=t?.maximumHeight||0,r=qw(i),o=Ept(r),s=o.west,l=o.south,c=o.east,y=o.north,_=[];return _.push(new ve(s,y,e)),_.push(new ve(c,y,e)),_.push(new ve(c,l,e)),_.push(new ve(s,l,e)),_.push(new ve(s,y,n)),_.push(new ve(c,y,n)),_.push(new ve(c,l,n)),_.push(new ve(s,l,n)),_}function F5(i){const t=i.token,e={minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight},n=Cpt(t,e),r=wpt(t),o=r[0],s=r[1],l=_r.WGS84.cartographicToCartesian([o,s,e.maximumHeight]),c=new ve(l[0],l[1],l[2]);n.push(c);const y=r5(n);return[...y.center,...y.halfAxes]}const Tpt=4,Spt=8,Ppt={QUADTREE:Tpt,OCTREE:Spt};function Ipt(i,t,e){if(i?.box){const n=R5(i.s2VolumeInfo.token),r=fpt(n,t),o=hpt(r),s={...i.s2VolumeInfo};switch(s.token=o,e){case"OCTREE":const l=i.s2VolumeInfo,c=l.maximumHeight-l.minimumHeight,y=c/2,_=l.minimumHeight+c/2;l.minimumHeight=_-y,l.maximumHeight=_+y;break}return{box:F5(s),s2VolumeInfo:s}}}async function N5(i){const{subtree:t,subtreeData:e={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:r=0,implicitOptions:o,loaderOptions:s,s2VolumeBox:l}=i,{subdivisionScheme:c,subtreeLevels:y,maximumLevel:_,contentUrlTemplate:C,subtreesUriTemplate:I,basePath:k}=o,z={children:[],lodMetricValue:0,contentUrl:""};if(!_)return e6.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${C} won't be loaded...`),z;const V=n.localLevel+1,X=e.level+V;if(X>_)return z;const H=Ppt[c],$=Math.log2(H),Y=r&1,ct=r>>1&1,rt=r>>2&1,nt=Fh(n.localX,Y,1),Ot=Fh(n.localY,ct,1),Kt=Fh(n.localZ,rt,1),ft=Fh(e.x,nt,V),st=Fh(e.y,Ot,V),Ut=Fh(e.z,Kt,V),K=Fh(n.mortonIndex,r,$),dt=V===y&&G1(t.childSubtreeAvailability,K);let Tt,ue,Rt,Ft;if(dt){const Gt=`${k}/${I}`,se=L2(Gt,X,ft,st,Ut);Tt=await Qu(se,S5,s),Ft=0,ue={level:X,x:ft,y:st,z:Ut},Rt={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Tt=t,Ft=(H**V-1)/(H-1)+K,ue=e,Rt={mortonIndex:K,localLevel:V,localX:nt,localY:Ot,localZ:Kt};if(!G1(Tt.tileAvailability,Ft))return z;G1(Tt.contentAvailability,Ft)&&(z.contentUrl=L2(C,X,ft,st,Ut));for(let Gt=0;Gt<H;Gt++){const se=Ipt(l,Gt,c),le=await N5({subtree:Tt,subtreeData:ue,parentData:Rt,childIndex:Gt,implicitOptions:o,loaderOptions:s,s2VolumeBox:se});(le.contentUrl||le.children.length)&&z.children.push(le)}return z.contentUrl||z.children.length?Mpt(z,{level:X,x:ft,y:st,z:Ut},o,l):z}function G1(i,t){let e;return Array.isArray(i)?(e=i[0],i.length>1&&e6.once('Not supported extension "3DTILES_multiple_contents" has been detected')):e=i,"constant"in e?!!e.constant:e.explicitBitstream?Lpt(t,e.explicitBitstream):!1}function Mpt(i,t,e,n){const{basePath:r,refine:o,getRefine:s,lodMetricType:l,getTileType:c,rootLodMetricValue:y,rootBoundingVolume:_}=e,C=i.contentUrl&&i.contentUrl.replace(`${r}/`,""),I=y/2**t.level,k=n?.box?{box:n.box}:_,z=Bpt(k,t,e.subdivisionScheme);return{children:i.children,contentUrl:i.contentUrl,content:{uri:C},id:i.contentUrl,refine:s(o),type:c(i),lodMetricType:l,lodMetricValue:I,geometricError:I,transform:i.transform,boundingVolume:z}}function Bpt(i,t,e){if(i.region){const{level:n,x:r,y:o,z:s}=t,[l,c,y,_,C,I]=i.region,k=2**n,z=(y-l)/k,[V,X]=[l+z*r,l+z*(r+1)],H=(_-c)/k,[$,Y]=[c+H*o,c+H*(o+1)];let ct,rt;if(e==="OCTREE"){const nt=(I-C)/k;[ct,rt]=[C+nt*s,C+nt*(s+1)]}else[ct,rt]=[C,I];return{region:[V,$,X,Y,ct,rt]}}if(i.box)return i;throw new Error(`Unsupported bounding volume type ${JSON.stringify(i)}`)}function Fh(i,t,e){return(i<<e)+t}function L2(i,t,e,n,r){const o=Rpt({level:t,x:e,y:n,z:r});return i.replace(/{level}|{x}|{y}|{z}/gi,s=>o[s])}function Rpt(i){const t={};for(const e in i)t[`{${e}}`]=i[e];return t}function Lpt(i,t){const e=Math.floor(i/8),n=i%8;return(t[e]>>n&1)===1}function Kw(i,t=""){if(!t)return Ku.EMPTY;const e=t.split("?")[0].split(".").pop();switch(e){case"pnts":return Ku.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ku.SCENEGRAPH;default:return e||Ku.EMPTY}}function Zw(i){switch(i){case"REPLACE":case"replace":return vl.REPLACE;case"ADD":case"add":return vl.ADD;default:return i}}function D2(i,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const e=new URL(i,`${t}/`);return decodeURI(e.toString())}else if(i.startsWith("/"))return i;return UN(t,i)}function pM(i,t){if(!i)return null;let e;if(i.content){const n=i.content.uri||i.content?.url;typeof n<"u"&&(e=D2(n,t))}return{...i,id:e,contentUrl:e,lodMetricType:Pp.GEOMETRIC_ERROR,lodMetricValue:i.geometricError,transformMatrix:i.transform,type:Kw(i,e),refine:Zw(i.refine)}}async function Dpt(i,t,e){let n=null;const r=mM(i.root);r&&i.root?n=await AM(i.root,i,t,r,e):n=pM(i.root,t);const o=[];for(o.push(n);o.length>0;){const s=o.pop()||{},l=s.children||[],c=[];for(const y of l){const _=mM(y);let C;_?C=await AM(y,i,t,_,e):C=pM(y,t),C&&(c.push(C),o.push(C))}s.children=c}return n}async function AM(i,t,e,n,r){const{subdivisionScheme:o,maximumLevel:s,availableLevels:l,subtreeLevels:c,subtrees:{uri:y}}=n,_=L2(y,0,0,0,0),C=D2(_,e),I=await Qu(C,S5,r),k=i.content?.uri,z=k?D2(k,e):"",V=t?.root?.refine,X=i.geometricError,H=i.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(H){const ct={box:F5(H),s2VolumeInfo:H};i.boundingVolume=ct}const $=i.boundingVolume,Y={contentUrlTemplate:z,subtreesUriTemplate:y,subdivisionScheme:o,subtreeLevels:c,maximumLevel:Number.isFinite(l)?l-1:s,refine:V,basePath:e,lodMetricType:Pp.GEOMETRIC_ERROR,rootLodMetricValue:X,rootBoundingVolume:$,getTileType:Kw,getRefine:Zw};return await kpt(i,e,I,Y,r)}async function kpt(i,t,e,n,r){if(!i)return null;const{children:o,contentUrl:s}=await N5({subtree:e,implicitOptions:n,loaderOptions:r});let l,c=null;return s&&(l=s,c={uri:s.replace(`${t}/`,"")}),{...i,id:l,contentUrl:l,lodMetricType:Pp.GEOMETRIC_ERROR,lodMetricValue:i.geometricError,transformMatrix:i.transform,type:Kw(i,l),refine:Zw(i.refine),content:c||i.content,children:o}}function mM(i){return i?.extensions?.["3DTILES_implicit_tiling"]||i?.implicitTiling}const z5={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:v5,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Opt,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Opt(i,t={},e){const n=t["3d-tiles"]||{};let r;return n.isTileset==="auto"?r=e?.url&&e.url.indexOf(".json")!==-1:r=n.isTileset,r?Fpt(i,t,e):Npt(i,t,e)}async function Fpt(i,t,e){const n=JSON.parse(new TextDecoder().decode(i)),r=e?.url||"",o=zpt(r),s=await Dpt(n,o,t||{});return{...n,shape:"tileset3d",loader:z5,url:r,queryString:e?.queryString||"",basePath:o,root:s||n.root,type:Ko.TILES3D,lodMetricType:Pp.GEOMETRIC_ERROR,lodMetricValue:n.root?.geometricError||0}}async function Npt(i,t,e){const n={content:{shape:"tile3d",featureIds:null}};return await T5(i,0,t,e,n.content),n.content}function zpt(i){return q2(i)}var gM={},yM;function oh(){return yM||(yM=1,(function(i){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function e(o,s){return Object.prototype.hasOwnProperty.call(o,s)}i.assign=function(o){for(var s=Array.prototype.slice.call(arguments,1);s.length;){var l=s.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var c in l)e(l,c)&&(o[c]=l[c])}}return o},i.shrinkBuf=function(o,s){return o.length===s?o:o.subarray?o.subarray(0,s):(o.length=s,o)};var n={arraySet:function(o,s,l,c,y){if(s.subarray&&o.subarray){o.set(s.subarray(l,l+c),y);return}for(var _=0;_<c;_++)o[y+_]=s[l+_]},flattenChunks:function(o){var s,l,c,y,_,C;for(c=0,s=0,l=o.length;s<l;s++)c+=o[s].length;for(C=new Uint8Array(c),y=0,s=0,l=o.length;s<l;s++)_=o[s],C.set(_,y),y+=_.length;return C}},r={arraySet:function(o,s,l,c,y){for(var _=0;_<c;_++)o[y+_]=s[l+_]},flattenChunks:function(o){return[].concat.apply([],o)}};i.setTyped=function(o){o?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,r))},i.setTyped(t)})(gM)),gM}var Id={},sl={},Nh={},vM;function Upt(){if(vM)return Nh;vM=1;var i=oh(),t=4,e=0,n=1,r=2;function o(Lt){for(var je=Lt.length;--je>=0;)Lt[je]=0}var s=0,l=1,c=2,y=3,_=258,C=29,I=256,k=I+1+C,z=30,V=19,X=2*k+1,H=15,$=16,Y=7,ct=256,rt=16,nt=17,Ot=18,Kt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ft=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],st=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ut=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=512,dt=new Array((k+2)*2);o(dt);var Tt=new Array(z*2);o(Tt);var ue=new Array(K);o(ue);var Rt=new Array(_-y+1);o(Rt);var Ft=new Array(C);o(Ft);var Gt=new Array(z);o(Gt);function se(Lt,je,$e,di,oe){this.static_tree=Lt,this.extra_bits=je,this.extra_base=$e,this.elems=di,this.max_length=oe,this.has_stree=Lt&&Lt.length}var le,de,ye;function Oe(Lt,je){this.dyn_tree=Lt,this.max_code=0,this.stat_desc=je}function Le(Lt){return Lt<256?ue[Lt]:ue[256+(Lt>>>7)]}function fe(Lt,je){Lt.pending_buf[Lt.pending++]=je&255,Lt.pending_buf[Lt.pending++]=je>>>8&255}function _i(Lt,je,$e){Lt.bi_valid>$-$e?(Lt.bi_buf|=je<<Lt.bi_valid&65535,fe(Lt,Lt.bi_buf),Lt.bi_buf=je>>$-Lt.bi_valid,Lt.bi_valid+=$e-$):(Lt.bi_buf|=je<<Lt.bi_valid&65535,Lt.bi_valid+=$e)}function ei(Lt,je,$e){_i(Lt,$e[je*2],$e[je*2+1])}function ii(Lt,je){var $e=0;do $e|=Lt&1,Lt>>>=1,$e<<=1;while(--je>0);return $e>>>1}function Qe(Lt){Lt.bi_valid===16?(fe(Lt,Lt.bi_buf),Lt.bi_buf=0,Lt.bi_valid=0):Lt.bi_valid>=8&&(Lt.pending_buf[Lt.pending++]=Lt.bi_buf&255,Lt.bi_buf>>=8,Lt.bi_valid-=8)}function yi(Lt,je){var $e=je.dyn_tree,di=je.max_code,oe=je.stat_desc.static_tree,Fe=je.stat_desc.has_stree,vt=je.stat_desc.extra_bits,qe=je.stat_desc.extra_base,Ce=je.stat_desc.max_length,q,Ee,Me,St,ee,Ae,Q=0;for(St=0;St<=H;St++)Lt.bl_count[St]=0;for($e[Lt.heap[Lt.heap_max]*2+1]=0,q=Lt.heap_max+1;q<X;q++)Ee=Lt.heap[q],St=$e[$e[Ee*2+1]*2+1]+1,St>Ce&&(St=Ce,Q++),$e[Ee*2+1]=St,!(Ee>di)&&(Lt.bl_count[St]++,ee=0,Ee>=qe&&(ee=vt[Ee-qe]),Ae=$e[Ee*2],Lt.opt_len+=Ae*(St+ee),Fe&&(Lt.static_len+=Ae*(oe[Ee*2+1]+ee)));if(Q!==0){do{for(St=Ce-1;Lt.bl_count[St]===0;)St--;Lt.bl_count[St]--,Lt.bl_count[St+1]+=2,Lt.bl_count[Ce]--,Q-=2}while(Q>0);for(St=Ce;St!==0;St--)for(Ee=Lt.bl_count[St];Ee!==0;)Me=Lt.heap[--q],!(Me>di)&&($e[Me*2+1]!==St&&(Lt.opt_len+=(St-$e[Me*2+1])*$e[Me*2],$e[Me*2+1]=St),Ee--)}}function cn(Lt,je,$e){var di=new Array(H+1),oe=0,Fe,vt;for(Fe=1;Fe<=H;Fe++)di[Fe]=oe=oe+$e[Fe-1]<<1;for(vt=0;vt<=je;vt++){var qe=Lt[vt*2+1];qe!==0&&(Lt[vt*2]=ii(di[qe]++,qe))}}function Ni(){var Lt,je,$e,di,oe,Fe=new Array(H+1);for($e=0,di=0;di<C-1;di++)for(Ft[di]=$e,Lt=0;Lt<1<<Kt[di];Lt++)Rt[$e++]=di;for(Rt[$e-1]=di,oe=0,di=0;di<16;di++)for(Gt[di]=oe,Lt=0;Lt<1<<ft[di];Lt++)ue[oe++]=di;for(oe>>=7;di<z;di++)for(Gt[di]=oe<<7,Lt=0;Lt<1<<ft[di]-7;Lt++)ue[256+oe++]=di;for(je=0;je<=H;je++)Fe[je]=0;for(Lt=0;Lt<=143;)dt[Lt*2+1]=8,Lt++,Fe[8]++;for(;Lt<=255;)dt[Lt*2+1]=9,Lt++,Fe[9]++;for(;Lt<=279;)dt[Lt*2+1]=7,Lt++,Fe[7]++;for(;Lt<=287;)dt[Lt*2+1]=8,Lt++,Fe[8]++;for(cn(dt,k+1,Fe),Lt=0;Lt<z;Lt++)Tt[Lt*2+1]=5,Tt[Lt*2]=ii(Lt,5);le=new se(dt,Kt,I+1,k,H),de=new se(Tt,ft,0,z,H),ye=new se(new Array(0),st,0,V,Y)}function Pi(Lt){var je;for(je=0;je<k;je++)Lt.dyn_ltree[je*2]=0;for(je=0;je<z;je++)Lt.dyn_dtree[je*2]=0;for(je=0;je<V;je++)Lt.bl_tree[je*2]=0;Lt.dyn_ltree[ct*2]=1,Lt.opt_len=Lt.static_len=0,Lt.last_lit=Lt.matches=0}function Xn(Lt){Lt.bi_valid>8?fe(Lt,Lt.bi_buf):Lt.bi_valid>0&&(Lt.pending_buf[Lt.pending++]=Lt.bi_buf),Lt.bi_buf=0,Lt.bi_valid=0}function xi(Lt,je,$e,di){Xn(Lt),fe(Lt,$e),fe(Lt,~$e),i.arraySet(Lt.pending_buf,Lt.window,je,$e,Lt.pending),Lt.pending+=$e}function wi(Lt,je,$e,di){var oe=je*2,Fe=$e*2;return Lt[oe]<Lt[Fe]||Lt[oe]===Lt[Fe]&&di[je]<=di[$e]}function mn(Lt,je,$e){for(var di=Lt.heap[$e],oe=$e<<1;oe<=Lt.heap_len&&(oe<Lt.heap_len&&wi(je,Lt.heap[oe+1],Lt.heap[oe],Lt.depth)&&oe++,!wi(je,di,Lt.heap[oe],Lt.depth));)Lt.heap[$e]=Lt.heap[oe],$e=oe,oe<<=1;Lt.heap[$e]=di}function zi(Lt,je,$e){var di,oe,Fe=0,vt,qe;if(Lt.last_lit!==0)do di=Lt.pending_buf[Lt.d_buf+Fe*2]<<8|Lt.pending_buf[Lt.d_buf+Fe*2+1],oe=Lt.pending_buf[Lt.l_buf+Fe],Fe++,di===0?ei(Lt,oe,je):(vt=Rt[oe],ei(Lt,vt+I+1,je),qe=Kt[vt],qe!==0&&(oe-=Ft[vt],_i(Lt,oe,qe)),di--,vt=Le(di),ei(Lt,vt,$e),qe=ft[vt],qe!==0&&(di-=Gt[vt],_i(Lt,di,qe)));while(Fe<Lt.last_lit);ei(Lt,ct,je)}function cr(Lt,je){var $e=je.dyn_tree,di=je.stat_desc.static_tree,oe=je.stat_desc.has_stree,Fe=je.stat_desc.elems,vt,qe,Ce=-1,q;for(Lt.heap_len=0,Lt.heap_max=X,vt=0;vt<Fe;vt++)$e[vt*2]!==0?(Lt.heap[++Lt.heap_len]=Ce=vt,Lt.depth[vt]=0):$e[vt*2+1]=0;for(;Lt.heap_len<2;)q=Lt.heap[++Lt.heap_len]=Ce<2?++Ce:0,$e[q*2]=1,Lt.depth[q]=0,Lt.opt_len--,oe&&(Lt.static_len-=di[q*2+1]);for(je.max_code=Ce,vt=Lt.heap_len>>1;vt>=1;vt--)mn(Lt,$e,vt);q=Fe;do vt=Lt.heap[1],Lt.heap[1]=Lt.heap[Lt.heap_len--],mn(Lt,$e,1),qe=Lt.heap[1],Lt.heap[--Lt.heap_max]=vt,Lt.heap[--Lt.heap_max]=qe,$e[q*2]=$e[vt*2]+$e[qe*2],Lt.depth[q]=(Lt.depth[vt]>=Lt.depth[qe]?Lt.depth[vt]:Lt.depth[qe])+1,$e[vt*2+1]=$e[qe*2+1]=q,Lt.heap[1]=q++,mn(Lt,$e,1);while(Lt.heap_len>=2);Lt.heap[--Lt.heap_max]=Lt.heap[1],yi(Lt,je),cn($e,Ce,Lt.bl_count)}function tr(Lt,je,$e){var di,oe=-1,Fe,vt=je[1],qe=0,Ce=7,q=4;for(vt===0&&(Ce=138,q=3),je[($e+1)*2+1]=65535,di=0;di<=$e;di++)Fe=vt,vt=je[(di+1)*2+1],!(++qe<Ce&&Fe===vt)&&(qe<q?Lt.bl_tree[Fe*2]+=qe:Fe!==0?(Fe!==oe&&Lt.bl_tree[Fe*2]++,Lt.bl_tree[rt*2]++):qe<=10?Lt.bl_tree[nt*2]++:Lt.bl_tree[Ot*2]++,qe=0,oe=Fe,vt===0?(Ce=138,q=3):Fe===vt?(Ce=6,q=3):(Ce=7,q=4))}function xn(Lt,je,$e){var di,oe=-1,Fe,vt=je[1],qe=0,Ce=7,q=4;for(vt===0&&(Ce=138,q=3),di=0;di<=$e;di++)if(Fe=vt,vt=je[(di+1)*2+1],!(++qe<Ce&&Fe===vt)){if(qe<q)do ei(Lt,Fe,Lt.bl_tree);while(--qe!==0);else Fe!==0?(Fe!==oe&&(ei(Lt,Fe,Lt.bl_tree),qe--),ei(Lt,rt,Lt.bl_tree),_i(Lt,qe-3,2)):qe<=10?(ei(Lt,nt,Lt.bl_tree),_i(Lt,qe-3,3)):(ei(Lt,Ot,Lt.bl_tree),_i(Lt,qe-11,7));qe=0,oe=Fe,vt===0?(Ce=138,q=3):Fe===vt?(Ce=6,q=3):(Ce=7,q=4)}}function sr(Lt){var je;for(tr(Lt,Lt.dyn_ltree,Lt.l_desc.max_code),tr(Lt,Lt.dyn_dtree,Lt.d_desc.max_code),cr(Lt,Lt.bl_desc),je=V-1;je>=3&&Lt.bl_tree[Ut[je]*2+1]===0;je--);return Lt.opt_len+=3*(je+1)+5+5+4,je}function qn(Lt,je,$e,di){var oe;for(_i(Lt,je-257,5),_i(Lt,$e-1,5),_i(Lt,di-4,4),oe=0;oe<di;oe++)_i(Lt,Lt.bl_tree[Ut[oe]*2+1],3);xn(Lt,Lt.dyn_ltree,je-1),xn(Lt,Lt.dyn_dtree,$e-1)}function Bn(Lt){var je=4093624447,$e;for($e=0;$e<=31;$e++,je>>>=1)if(je&1&&Lt.dyn_ltree[$e*2]!==0)return e;if(Lt.dyn_ltree[18]!==0||Lt.dyn_ltree[20]!==0||Lt.dyn_ltree[26]!==0)return n;for($e=32;$e<I;$e++)if(Lt.dyn_ltree[$e*2]!==0)return n;return e}var er=!1;function Ke(Lt){er||(Ni(),er=!0),Lt.l_desc=new Oe(Lt.dyn_ltree,le),Lt.d_desc=new Oe(Lt.dyn_dtree,de),Lt.bl_desc=new Oe(Lt.bl_tree,ye),Lt.bi_buf=0,Lt.bi_valid=0,Pi(Lt)}function bi(Lt,je,$e,di){_i(Lt,(s<<1)+(di?1:0),3),xi(Lt,je,$e)}function Oi(Lt){_i(Lt,l<<1,3),ei(Lt,ct,dt),Qe(Lt)}function on(Lt,je,$e,di){var oe,Fe,vt=0;Lt.level>0?(Lt.strm.data_type===r&&(Lt.strm.data_type=Bn(Lt)),cr(Lt,Lt.l_desc),cr(Lt,Lt.d_desc),vt=sr(Lt),oe=Lt.opt_len+3+7>>>3,Fe=Lt.static_len+3+7>>>3,Fe<=oe&&(oe=Fe)):oe=Fe=$e+5,$e+4<=oe&&je!==-1?bi(Lt,je,$e,di):Lt.strategy===t||Fe===oe?(_i(Lt,(l<<1)+(di?1:0),3),zi(Lt,dt,Tt)):(_i(Lt,(c<<1)+(di?1:0),3),qn(Lt,Lt.l_desc.max_code+1,Lt.d_desc.max_code+1,vt+1),zi(Lt,Lt.dyn_ltree,Lt.dyn_dtree)),Pi(Lt),di&&Xn(Lt)}function Ar(Lt,je,$e){return Lt.pending_buf[Lt.d_buf+Lt.last_lit*2]=je>>>8&255,Lt.pending_buf[Lt.d_buf+Lt.last_lit*2+1]=je&255,Lt.pending_buf[Lt.l_buf+Lt.last_lit]=$e&255,Lt.last_lit++,je===0?Lt.dyn_ltree[$e*2]++:(Lt.matches++,je--,Lt.dyn_ltree[(Rt[$e]+I+1)*2]++,Lt.dyn_dtree[Le(je)*2]++),Lt.last_lit===Lt.lit_bufsize-1}return Nh._tr_init=Ke,Nh._tr_stored_block=bi,Nh._tr_flush_block=on,Nh._tr_tally=Ar,Nh._tr_align=Oi,Nh}var j1,_M;function U5(){if(_M)return j1;_M=1;function i(t,e,n,r){for(var o=t&65535|0,s=t>>>16&65535|0,l=0;n!==0;){l=n>2e3?2e3:n,n-=l;do o=o+e[r++]|0,s=s+o|0;while(--l);o%=65521,s%=65521}return o|s<<16|0}return j1=i,j1}var W1,bM;function V5(){if(bM)return W1;bM=1;function i(){for(var n,r=[],o=0;o<256;o++){n=o;for(var s=0;s<8;s++)n=n&1?3988292384^n>>>1:n>>>1;r[o]=n}return r}var t=i();function e(n,r,o,s){var l=t,c=s+o;n^=-1;for(var y=s;y<c;y++)n=n>>>8^l[(n^r[y])&255];return n^-1}return W1=e,W1}var xM,wM;function Yw(){return wM||(wM=1,xM={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),xM}var EM;function Vpt(){if(EM)return sl;EM=1;var i=oh(),t=Upt(),e=U5(),n=V5(),r=Yw(),o=0,s=1,l=3,c=4,y=5,_=0,C=1,I=-2,k=-3,z=-5,V=-1,X=1,H=2,$=3,Y=4,ct=0,rt=2,nt=8,Ot=9,Kt=15,ft=8,st=29,Ut=256,K=Ut+1+st,dt=30,Tt=19,ue=2*K+1,Rt=15,Ft=3,Gt=258,se=Gt+Ft+1,le=32,de=42,ye=69,Oe=73,Le=91,fe=103,_i=113,ei=666,ii=1,Qe=2,yi=3,cn=4,Ni=3;function Pi(q,Ee){return q.msg=r[Ee],Ee}function Xn(q){return(q<<1)-(q>4?9:0)}function xi(q){for(var Ee=q.length;--Ee>=0;)q[Ee]=0}function wi(q){var Ee=q.state,Me=Ee.pending;Me>q.avail_out&&(Me=q.avail_out),Me!==0&&(i.arraySet(q.output,Ee.pending_buf,Ee.pending_out,Me,q.next_out),q.next_out+=Me,Ee.pending_out+=Me,q.total_out+=Me,q.avail_out-=Me,Ee.pending-=Me,Ee.pending===0&&(Ee.pending_out=0))}function mn(q,Ee){t._tr_flush_block(q,q.block_start>=0?q.block_start:-1,q.strstart-q.block_start,Ee),q.block_start=q.strstart,wi(q.strm)}function zi(q,Ee){q.pending_buf[q.pending++]=Ee}function cr(q,Ee){q.pending_buf[q.pending++]=Ee>>>8&255,q.pending_buf[q.pending++]=Ee&255}function tr(q,Ee,Me,St){var ee=q.avail_in;return ee>St&&(ee=St),ee===0?0:(q.avail_in-=ee,i.arraySet(Ee,q.input,q.next_in,ee,Me),q.state.wrap===1?q.adler=e(q.adler,Ee,ee,Me):q.state.wrap===2&&(q.adler=n(q.adler,Ee,ee,Me)),q.next_in+=ee,q.total_in+=ee,ee)}function xn(q,Ee){var Me=q.max_chain_length,St=q.strstart,ee,Ae,Q=q.prev_length,it=q.nice_match,ut=q.strstart>q.w_size-se?q.strstart-(q.w_size-se):0,xt=q.window,Nt=q.w_mask,mt=q.prev,wt=q.strstart+Gt,lt=xt[St+Q-1],pt=xt[St+Q];q.prev_length>=q.good_match&&(Me>>=2),it>q.lookahead&&(it=q.lookahead);do if(ee=Ee,!(xt[ee+Q]!==pt||xt[ee+Q-1]!==lt||xt[ee]!==xt[St]||xt[++ee]!==xt[St+1])){St+=2,ee++;do;while(xt[++St]===xt[++ee]&&xt[++St]===xt[++ee]&&xt[++St]===xt[++ee]&&xt[++St]===xt[++ee]&&xt[++St]===xt[++ee]&&xt[++St]===xt[++ee]&&xt[++St]===xt[++ee]&&xt[++St]===xt[++ee]&&St<wt);if(Ae=Gt-(wt-St),St=wt-Gt,Ae>Q){if(q.match_start=Ee,Q=Ae,Ae>=it)break;lt=xt[St+Q-1],pt=xt[St+Q]}}while((Ee=mt[Ee&Nt])>ut&&--Me!==0);return Q<=q.lookahead?Q:q.lookahead}function sr(q){var Ee=q.w_size,Me,St,ee,Ae,Q;do{if(Ae=q.window_size-q.lookahead-q.strstart,q.strstart>=Ee+(Ee-se)){i.arraySet(q.window,q.window,Ee,Ee,0),q.match_start-=Ee,q.strstart-=Ee,q.block_start-=Ee,St=q.hash_size,Me=St;do ee=q.head[--Me],q.head[Me]=ee>=Ee?ee-Ee:0;while(--St);St=Ee,Me=St;do ee=q.prev[--Me],q.prev[Me]=ee>=Ee?ee-Ee:0;while(--St);Ae+=Ee}if(q.strm.avail_in===0)break;if(St=tr(q.strm,q.window,q.strstart+q.lookahead,Ae),q.lookahead+=St,q.lookahead+q.insert>=Ft)for(Q=q.strstart-q.insert,q.ins_h=q.window[Q],q.ins_h=(q.ins_h<<q.hash_shift^q.window[Q+1])&q.hash_mask;q.insert&&(q.ins_h=(q.ins_h<<q.hash_shift^q.window[Q+Ft-1])&q.hash_mask,q.prev[Q&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=Q,Q++,q.insert--,!(q.lookahead+q.insert<Ft)););}while(q.lookahead<se&&q.strm.avail_in!==0)}function qn(q,Ee){var Me=65535;for(Me>q.pending_buf_size-5&&(Me=q.pending_buf_size-5);;){if(q.lookahead<=1){if(sr(q),q.lookahead===0&&Ee===o)return ii;if(q.lookahead===0)break}q.strstart+=q.lookahead,q.lookahead=0;var St=q.block_start+Me;if((q.strstart===0||q.strstart>=St)&&(q.lookahead=q.strstart-St,q.strstart=St,mn(q,!1),q.strm.avail_out===0)||q.strstart-q.block_start>=q.w_size-se&&(mn(q,!1),q.strm.avail_out===0))return ii}return q.insert=0,Ee===c?(mn(q,!0),q.strm.avail_out===0?yi:cn):(q.strstart>q.block_start&&(mn(q,!1),q.strm.avail_out),ii)}function Bn(q,Ee){for(var Me,St;;){if(q.lookahead<se){if(sr(q),q.lookahead<se&&Ee===o)return ii;if(q.lookahead===0)break}if(Me=0,q.lookahead>=Ft&&(q.ins_h=(q.ins_h<<q.hash_shift^q.window[q.strstart+Ft-1])&q.hash_mask,Me=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),Me!==0&&q.strstart-Me<=q.w_size-se&&(q.match_length=xn(q,Me)),q.match_length>=Ft)if(St=t._tr_tally(q,q.strstart-q.match_start,q.match_length-Ft),q.lookahead-=q.match_length,q.match_length<=q.max_lazy_match&&q.lookahead>=Ft){q.match_length--;do q.strstart++,q.ins_h=(q.ins_h<<q.hash_shift^q.window[q.strstart+Ft-1])&q.hash_mask,Me=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart;while(--q.match_length!==0);q.strstart++}else q.strstart+=q.match_length,q.match_length=0,q.ins_h=q.window[q.strstart],q.ins_h=(q.ins_h<<q.hash_shift^q.window[q.strstart+1])&q.hash_mask;else St=t._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++;if(St&&(mn(q,!1),q.strm.avail_out===0))return ii}return q.insert=q.strstart<Ft-1?q.strstart:Ft-1,Ee===c?(mn(q,!0),q.strm.avail_out===0?yi:cn):q.last_lit&&(mn(q,!1),q.strm.avail_out===0)?ii:Qe}function er(q,Ee){for(var Me,St,ee;;){if(q.lookahead<se){if(sr(q),q.lookahead<se&&Ee===o)return ii;if(q.lookahead===0)break}if(Me=0,q.lookahead>=Ft&&(q.ins_h=(q.ins_h<<q.hash_shift^q.window[q.strstart+Ft-1])&q.hash_mask,Me=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),q.prev_length=q.match_length,q.prev_match=q.match_start,q.match_length=Ft-1,Me!==0&&q.prev_length<q.max_lazy_match&&q.strstart-Me<=q.w_size-se&&(q.match_length=xn(q,Me),q.match_length<=5&&(q.strategy===X||q.match_length===Ft&&q.strstart-q.match_start>4096)&&(q.match_length=Ft-1)),q.prev_length>=Ft&&q.match_length<=q.prev_length){ee=q.strstart+q.lookahead-Ft,St=t._tr_tally(q,q.strstart-1-q.prev_match,q.prev_length-Ft),q.lookahead-=q.prev_length-1,q.prev_length-=2;do++q.strstart<=ee&&(q.ins_h=(q.ins_h<<q.hash_shift^q.window[q.strstart+Ft-1])&q.hash_mask,Me=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart);while(--q.prev_length!==0);if(q.match_available=0,q.match_length=Ft-1,q.strstart++,St&&(mn(q,!1),q.strm.avail_out===0))return ii}else if(q.match_available){if(St=t._tr_tally(q,0,q.window[q.strstart-1]),St&&mn(q,!1),q.strstart++,q.lookahead--,q.strm.avail_out===0)return ii}else q.match_available=1,q.strstart++,q.lookahead--}return q.match_available&&(St=t._tr_tally(q,0,q.window[q.strstart-1]),q.match_available=0),q.insert=q.strstart<Ft-1?q.strstart:Ft-1,Ee===c?(mn(q,!0),q.strm.avail_out===0?yi:cn):q.last_lit&&(mn(q,!1),q.strm.avail_out===0)?ii:Qe}function Ke(q,Ee){for(var Me,St,ee,Ae,Q=q.window;;){if(q.lookahead<=Gt){if(sr(q),q.lookahead<=Gt&&Ee===o)return ii;if(q.lookahead===0)break}if(q.match_length=0,q.lookahead>=Ft&&q.strstart>0&&(ee=q.strstart-1,St=Q[ee],St===Q[++ee]&&St===Q[++ee]&&St===Q[++ee])){Ae=q.strstart+Gt;do;while(St===Q[++ee]&&St===Q[++ee]&&St===Q[++ee]&&St===Q[++ee]&&St===Q[++ee]&&St===Q[++ee]&&St===Q[++ee]&&St===Q[++ee]&&ee<Ae);q.match_length=Gt-(Ae-ee),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=Ft?(Me=t._tr_tally(q,1,q.match_length-Ft),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(Me=t._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),Me&&(mn(q,!1),q.strm.avail_out===0))return ii}return q.insert=0,Ee===c?(mn(q,!0),q.strm.avail_out===0?yi:cn):q.last_lit&&(mn(q,!1),q.strm.avail_out===0)?ii:Qe}function bi(q,Ee){for(var Me;;){if(q.lookahead===0&&(sr(q),q.lookahead===0)){if(Ee===o)return ii;break}if(q.match_length=0,Me=t._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,Me&&(mn(q,!1),q.strm.avail_out===0))return ii}return q.insert=0,Ee===c?(mn(q,!0),q.strm.avail_out===0?yi:cn):q.last_lit&&(mn(q,!1),q.strm.avail_out===0)?ii:Qe}function Oi(q,Ee,Me,St,ee){this.good_length=q,this.max_lazy=Ee,this.nice_length=Me,this.max_chain=St,this.func=ee}var on;on=[new Oi(0,0,0,0,qn),new Oi(4,4,8,4,Bn),new Oi(4,5,16,8,Bn),new Oi(4,6,32,32,Bn),new Oi(4,4,16,16,er),new Oi(8,16,32,32,er),new Oi(8,16,128,128,er),new Oi(8,32,128,256,er),new Oi(32,128,258,1024,er),new Oi(32,258,258,4096,er)];function Ar(q){q.window_size=2*q.w_size,xi(q.head),q.max_lazy_match=on[q.level].max_lazy,q.good_match=on[q.level].good_length,q.nice_match=on[q.level].nice_length,q.max_chain_length=on[q.level].max_chain,q.strstart=0,q.block_start=0,q.lookahead=0,q.insert=0,q.match_length=q.prev_length=Ft-1,q.match_available=0,q.ins_h=0}function Lt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=nt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(ue*2),this.dyn_dtree=new i.Buf16((2*dt+1)*2),this.bl_tree=new i.Buf16((2*Tt+1)*2),xi(this.dyn_ltree),xi(this.dyn_dtree),xi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(Rt+1),this.heap=new i.Buf16(2*K+1),xi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*K+1),xi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function je(q){var Ee;return!q||!q.state?Pi(q,I):(q.total_in=q.total_out=0,q.data_type=rt,Ee=q.state,Ee.pending=0,Ee.pending_out=0,Ee.wrap<0&&(Ee.wrap=-Ee.wrap),Ee.status=Ee.wrap?de:_i,q.adler=Ee.wrap===2?0:1,Ee.last_flush=o,t._tr_init(Ee),_)}function $e(q){var Ee=je(q);return Ee===_&&Ar(q.state),Ee}function di(q,Ee){return!q||!q.state||q.state.wrap!==2?I:(q.state.gzhead=Ee,_)}function oe(q,Ee,Me,St,ee,Ae){if(!q)return I;var Q=1;if(Ee===V&&(Ee=6),St<0?(Q=0,St=-St):St>15&&(Q=2,St-=16),ee<1||ee>Ot||Me!==nt||St<8||St>15||Ee<0||Ee>9||Ae<0||Ae>Y)return Pi(q,I);St===8&&(St=9);var it=new Lt;return q.state=it,it.strm=q,it.wrap=Q,it.gzhead=null,it.w_bits=St,it.w_size=1<<it.w_bits,it.w_mask=it.w_size-1,it.hash_bits=ee+7,it.hash_size=1<<it.hash_bits,it.hash_mask=it.hash_size-1,it.hash_shift=~~((it.hash_bits+Ft-1)/Ft),it.window=new i.Buf8(it.w_size*2),it.head=new i.Buf16(it.hash_size),it.prev=new i.Buf16(it.w_size),it.lit_bufsize=1<<ee+6,it.pending_buf_size=it.lit_bufsize*4,it.pending_buf=new i.Buf8(it.pending_buf_size),it.d_buf=1*it.lit_bufsize,it.l_buf=3*it.lit_bufsize,it.level=Ee,it.strategy=Ae,it.method=Me,$e(q)}function Fe(q,Ee){return oe(q,Ee,nt,Kt,ft,ct)}function vt(q,Ee){var Me,St,ee,Ae;if(!q||!q.state||Ee>y||Ee<0)return q?Pi(q,I):I;if(St=q.state,!q.output||!q.input&&q.avail_in!==0||St.status===ei&&Ee!==c)return Pi(q,q.avail_out===0?z:I);if(St.strm=q,Me=St.last_flush,St.last_flush=Ee,St.status===de)if(St.wrap===2)q.adler=0,zi(St,31),zi(St,139),zi(St,8),St.gzhead?(zi(St,(St.gzhead.text?1:0)+(St.gzhead.hcrc?2:0)+(St.gzhead.extra?4:0)+(St.gzhead.name?8:0)+(St.gzhead.comment?16:0)),zi(St,St.gzhead.time&255),zi(St,St.gzhead.time>>8&255),zi(St,St.gzhead.time>>16&255),zi(St,St.gzhead.time>>24&255),zi(St,St.level===9?2:St.strategy>=H||St.level<2?4:0),zi(St,St.gzhead.os&255),St.gzhead.extra&&St.gzhead.extra.length&&(zi(St,St.gzhead.extra.length&255),zi(St,St.gzhead.extra.length>>8&255)),St.gzhead.hcrc&&(q.adler=n(q.adler,St.pending_buf,St.pending,0)),St.gzindex=0,St.status=ye):(zi(St,0),zi(St,0),zi(St,0),zi(St,0),zi(St,0),zi(St,St.level===9?2:St.strategy>=H||St.level<2?4:0),zi(St,Ni),St.status=_i);else{var Q=nt+(St.w_bits-8<<4)<<8,it=-1;St.strategy>=H||St.level<2?it=0:St.level<6?it=1:St.level===6?it=2:it=3,Q|=it<<6,St.strstart!==0&&(Q|=le),Q+=31-Q%31,St.status=_i,cr(St,Q),St.strstart!==0&&(cr(St,q.adler>>>16),cr(St,q.adler&65535)),q.adler=1}if(St.status===ye)if(St.gzhead.extra){for(ee=St.pending;St.gzindex<(St.gzhead.extra.length&65535)&&!(St.pending===St.pending_buf_size&&(St.gzhead.hcrc&&St.pending>ee&&(q.adler=n(q.adler,St.pending_buf,St.pending-ee,ee)),wi(q),ee=St.pending,St.pending===St.pending_buf_size));)zi(St,St.gzhead.extra[St.gzindex]&255),St.gzindex++;St.gzhead.hcrc&&St.pending>ee&&(q.adler=n(q.adler,St.pending_buf,St.pending-ee,ee)),St.gzindex===St.gzhead.extra.length&&(St.gzindex=0,St.status=Oe)}else St.status=Oe;if(St.status===Oe)if(St.gzhead.name){ee=St.pending;do{if(St.pending===St.pending_buf_size&&(St.gzhead.hcrc&&St.pending>ee&&(q.adler=n(q.adler,St.pending_buf,St.pending-ee,ee)),wi(q),ee=St.pending,St.pending===St.pending_buf_size)){Ae=1;break}St.gzindex<St.gzhead.name.length?Ae=St.gzhead.name.charCodeAt(St.gzindex++)&255:Ae=0,zi(St,Ae)}while(Ae!==0);St.gzhead.hcrc&&St.pending>ee&&(q.adler=n(q.adler,St.pending_buf,St.pending-ee,ee)),Ae===0&&(St.gzindex=0,St.status=Le)}else St.status=Le;if(St.status===Le)if(St.gzhead.comment){ee=St.pending;do{if(St.pending===St.pending_buf_size&&(St.gzhead.hcrc&&St.pending>ee&&(q.adler=n(q.adler,St.pending_buf,St.pending-ee,ee)),wi(q),ee=St.pending,St.pending===St.pending_buf_size)){Ae=1;break}St.gzindex<St.gzhead.comment.length?Ae=St.gzhead.comment.charCodeAt(St.gzindex++)&255:Ae=0,zi(St,Ae)}while(Ae!==0);St.gzhead.hcrc&&St.pending>ee&&(q.adler=n(q.adler,St.pending_buf,St.pending-ee,ee)),Ae===0&&(St.status=fe)}else St.status=fe;if(St.status===fe&&(St.gzhead.hcrc?(St.pending+2>St.pending_buf_size&&wi(q),St.pending+2<=St.pending_buf_size&&(zi(St,q.adler&255),zi(St,q.adler>>8&255),q.adler=0,St.status=_i)):St.status=_i),St.pending!==0){if(wi(q),q.avail_out===0)return St.last_flush=-1,_}else if(q.avail_in===0&&Xn(Ee)<=Xn(Me)&&Ee!==c)return Pi(q,z);if(St.status===ei&&q.avail_in!==0)return Pi(q,z);if(q.avail_in!==0||St.lookahead!==0||Ee!==o&&St.status!==ei){var ut=St.strategy===H?bi(St,Ee):St.strategy===$?Ke(St,Ee):on[St.level].func(St,Ee);if((ut===yi||ut===cn)&&(St.status=ei),ut===ii||ut===yi)return q.avail_out===0&&(St.last_flush=-1),_;if(ut===Qe&&(Ee===s?t._tr_align(St):Ee!==y&&(t._tr_stored_block(St,0,0,!1),Ee===l&&(xi(St.head),St.lookahead===0&&(St.strstart=0,St.block_start=0,St.insert=0))),wi(q),q.avail_out===0))return St.last_flush=-1,_}return Ee!==c?_:St.wrap<=0?C:(St.wrap===2?(zi(St,q.adler&255),zi(St,q.adler>>8&255),zi(St,q.adler>>16&255),zi(St,q.adler>>24&255),zi(St,q.total_in&255),zi(St,q.total_in>>8&255),zi(St,q.total_in>>16&255),zi(St,q.total_in>>24&255)):(cr(St,q.adler>>>16),cr(St,q.adler&65535)),wi(q),St.wrap>0&&(St.wrap=-St.wrap),St.pending!==0?_:C)}function qe(q){var Ee;return!q||!q.state?I:(Ee=q.state.status,Ee!==de&&Ee!==ye&&Ee!==Oe&&Ee!==Le&&Ee!==fe&&Ee!==_i&&Ee!==ei?Pi(q,I):(q.state=null,Ee===_i?Pi(q,k):_))}function Ce(q,Ee){var Me=Ee.length,St,ee,Ae,Q,it,ut,xt,Nt;if(!q||!q.state||(St=q.state,Q=St.wrap,Q===2||Q===1&&St.status!==de||St.lookahead))return I;for(Q===1&&(q.adler=e(q.adler,Ee,Me,0)),St.wrap=0,Me>=St.w_size&&(Q===0&&(xi(St.head),St.strstart=0,St.block_start=0,St.insert=0),Nt=new i.Buf8(St.w_size),i.arraySet(Nt,Ee,Me-St.w_size,St.w_size,0),Ee=Nt,Me=St.w_size),it=q.avail_in,ut=q.next_in,xt=q.input,q.avail_in=Me,q.next_in=0,q.input=Ee,sr(St);St.lookahead>=Ft;){ee=St.strstart,Ae=St.lookahead-(Ft-1);do St.ins_h=(St.ins_h<<St.hash_shift^St.window[ee+Ft-1])&St.hash_mask,St.prev[ee&St.w_mask]=St.head[St.ins_h],St.head[St.ins_h]=ee,ee++;while(--Ae);St.strstart=ee,St.lookahead=Ft-1,sr(St)}return St.strstart+=St.lookahead,St.block_start=St.strstart,St.insert=St.lookahead,St.lookahead=0,St.match_length=St.prev_length=Ft-1,St.match_available=0,q.next_in=ut,q.input=xt,q.avail_in=it,St.wrap=Q,_}return sl.deflateInit=Fe,sl.deflateInit2=oe,sl.deflateReset=$e,sl.deflateResetKeep=je,sl.deflateSetHeader=di,sl.deflate=vt,sl.deflateEnd=qe,sl.deflateSetDictionary=Ce,sl.deflateInfo="pako deflate (from Nodeca project)",sl}var zh={},CM;function G5(){if(CM)return zh;CM=1;var i=oh(),t=!0,e=!0;try{String.fromCharCode.apply(null,[0])}catch{t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{e=!1}for(var n=new i.Buf8(256),r=0;r<256;r++)n[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;n[254]=n[254]=1,zh.string2buf=function(s){var l,c,y,_,C,I=s.length,k=0;for(_=0;_<I;_++)c=s.charCodeAt(_),(c&64512)===55296&&_+1<I&&(y=s.charCodeAt(_+1),(y&64512)===56320&&(c=65536+(c-55296<<10)+(y-56320),_++)),k+=c<128?1:c<2048?2:c<65536?3:4;for(l=new i.Buf8(k),C=0,_=0;C<k;_++)c=s.charCodeAt(_),(c&64512)===55296&&_+1<I&&(y=s.charCodeAt(_+1),(y&64512)===56320&&(c=65536+(c-55296<<10)+(y-56320),_++)),c<128?l[C++]=c:c<2048?(l[C++]=192|c>>>6,l[C++]=128|c&63):c<65536?(l[C++]=224|c>>>12,l[C++]=128|c>>>6&63,l[C++]=128|c&63):(l[C++]=240|c>>>18,l[C++]=128|c>>>12&63,l[C++]=128|c>>>6&63,l[C++]=128|c&63);return l};function o(s,l){if(l<65534&&(s.subarray&&e||!s.subarray&&t))return String.fromCharCode.apply(null,i.shrinkBuf(s,l));for(var c="",y=0;y<l;y++)c+=String.fromCharCode(s[y]);return c}return zh.buf2binstring=function(s){return o(s,s.length)},zh.binstring2buf=function(s){for(var l=new i.Buf8(s.length),c=0,y=l.length;c<y;c++)l[c]=s.charCodeAt(c);return l},zh.buf2string=function(s,l){var c,y,_,C,I=l||s.length,k=new Array(I*2);for(y=0,c=0;c<I;){if(_=s[c++],_<128){k[y++]=_;continue}if(C=n[_],C>4){k[y++]=65533,c+=C-1;continue}for(_&=C===2?31:C===3?15:7;C>1&&c<I;)_=_<<6|s[c++]&63,C--;if(C>1){k[y++]=65533;continue}_<65536?k[y++]=_:(_-=65536,k[y++]=55296|_>>10&1023,k[y++]=56320|_&1023)}return o(k,y)},zh.utf8border=function(s,l){var c;for(l=l||s.length,l>s.length&&(l=s.length),c=l-1;c>=0&&(s[c]&192)===128;)c--;return c<0||c===0?l:c+n[s[c]]>l?c:l},zh}var H1,TM;function j5(){if(TM)return H1;TM=1;function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return H1=i,H1}var SM;function Gpt(){if(SM)return Id;SM=1;var i=Vpt(),t=oh(),e=G5(),n=Yw(),r=j5(),o=Object.prototype.toString,s=0,l=4,c=0,y=1,_=2,C=-1,I=0,k=8;function z($){if(!(this instanceof z))return new z($);this.options=t.assign({level:C,method:k,chunkSize:16384,windowBits:15,memLevel:8,strategy:I,to:""},$||{});var Y=this.options;Y.raw&&Y.windowBits>0?Y.windowBits=-Y.windowBits:Y.gzip&&Y.windowBits>0&&Y.windowBits<16&&(Y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var ct=i.deflateInit2(this.strm,Y.level,Y.method,Y.windowBits,Y.memLevel,Y.strategy);if(ct!==c)throw new Error(n[ct]);if(Y.header&&i.deflateSetHeader(this.strm,Y.header),Y.dictionary){var rt;if(typeof Y.dictionary=="string"?rt=e.string2buf(Y.dictionary):o.call(Y.dictionary)==="[object ArrayBuffer]"?rt=new Uint8Array(Y.dictionary):rt=Y.dictionary,ct=i.deflateSetDictionary(this.strm,rt),ct!==c)throw new Error(n[ct]);this._dict_set=!0}}z.prototype.push=function($,Y){var ct=this.strm,rt=this.options.chunkSize,nt,Ot;if(this.ended)return!1;Ot=Y===~~Y?Y:Y===!0?l:s,typeof $=="string"?ct.input=e.string2buf($):o.call($)==="[object ArrayBuffer]"?ct.input=new Uint8Array($):ct.input=$,ct.next_in=0,ct.avail_in=ct.input.length;do{if(ct.avail_out===0&&(ct.output=new t.Buf8(rt),ct.next_out=0,ct.avail_out=rt),nt=i.deflate(ct,Ot),nt!==y&&nt!==c)return this.onEnd(nt),this.ended=!0,!1;(ct.avail_out===0||ct.avail_in===0&&(Ot===l||Ot===_))&&(this.options.to==="string"?this.onData(e.buf2binstring(t.shrinkBuf(ct.output,ct.next_out))):this.onData(t.shrinkBuf(ct.output,ct.next_out)))}while((ct.avail_in>0||ct.avail_out===0)&&nt!==y);return Ot===l?(nt=i.deflateEnd(this.strm),this.onEnd(nt),this.ended=!0,nt===c):(Ot===_&&(this.onEnd(c),ct.avail_out=0),!0)},z.prototype.onData=function($){this.chunks.push($)},z.prototype.onEnd=function($){$===c&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=$,this.msg=this.strm.msg};function V($,Y){var ct=new z(Y);if(ct.push($,!0),ct.err)throw ct.msg||n[ct.err];return ct.result}function X($,Y){return Y=Y||{},Y.raw=!0,V($,Y)}function H($,Y){return Y=Y||{},Y.gzip=!0,V($,Y)}return Id.Deflate=z,Id.deflate=V,Id.deflateRaw=X,Id.gzip=H,Id}var Md={},Ia={},X1,PM;function jpt(){if(PM)return X1;PM=1;var i=30,t=12;return X1=function(e,n){var r,o,s,l,c,y,_,C,I,k,z,V,X,H,$,Y,ct,rt,nt,Ot,Kt,ft,st,Ut,K;r=e.state,o=e.next_in,Ut=e.input,s=o+(e.avail_in-5),l=e.next_out,K=e.output,c=l-(n-e.avail_out),y=l+(e.avail_out-257),_=r.dmax,C=r.wsize,I=r.whave,k=r.wnext,z=r.window,V=r.hold,X=r.bits,H=r.lencode,$=r.distcode,Y=(1<<r.lenbits)-1,ct=(1<<r.distbits)-1;t:do{X<15&&(V+=Ut[o++]<<X,X+=8,V+=Ut[o++]<<X,X+=8),rt=H[V&Y];e:for(;;){if(nt=rt>>>24,V>>>=nt,X-=nt,nt=rt>>>16&255,nt===0)K[l++]=rt&65535;else if(nt&16){Ot=rt&65535,nt&=15,nt&&(X<nt&&(V+=Ut[o++]<<X,X+=8),Ot+=V&(1<<nt)-1,V>>>=nt,X-=nt),X<15&&(V+=Ut[o++]<<X,X+=8,V+=Ut[o++]<<X,X+=8),rt=$[V&ct];i:for(;;){if(nt=rt>>>24,V>>>=nt,X-=nt,nt=rt>>>16&255,nt&16){if(Kt=rt&65535,nt&=15,X<nt&&(V+=Ut[o++]<<X,X+=8,X<nt&&(V+=Ut[o++]<<X,X+=8)),Kt+=V&(1<<nt)-1,Kt>_){e.msg="invalid distance too far back",r.mode=i;break t}if(V>>>=nt,X-=nt,nt=l-c,Kt>nt){if(nt=Kt-nt,nt>I&&r.sane){e.msg="invalid distance too far back",r.mode=i;break t}if(ft=0,st=z,k===0){if(ft+=C-nt,nt<Ot){Ot-=nt;do K[l++]=z[ft++];while(--nt);ft=l-Kt,st=K}}else if(k<nt){if(ft+=C+k-nt,nt-=k,nt<Ot){Ot-=nt;do K[l++]=z[ft++];while(--nt);if(ft=0,k<Ot){nt=k,Ot-=nt;do K[l++]=z[ft++];while(--nt);ft=l-Kt,st=K}}}else if(ft+=k-nt,nt<Ot){Ot-=nt;do K[l++]=z[ft++];while(--nt);ft=l-Kt,st=K}for(;Ot>2;)K[l++]=st[ft++],K[l++]=st[ft++],K[l++]=st[ft++],Ot-=3;Ot&&(K[l++]=st[ft++],Ot>1&&(K[l++]=st[ft++]))}else{ft=l-Kt;do K[l++]=K[ft++],K[l++]=K[ft++],K[l++]=K[ft++],Ot-=3;while(Ot>2);Ot&&(K[l++]=K[ft++],Ot>1&&(K[l++]=K[ft++]))}}else if((nt&64)===0){rt=$[(rt&65535)+(V&(1<<nt)-1)];continue i}else{e.msg="invalid distance code",r.mode=i;break t}break}}else if((nt&64)===0){rt=H[(rt&65535)+(V&(1<<nt)-1)];continue e}else if(nt&32){r.mode=t;break t}else{e.msg="invalid literal/length code",r.mode=i;break t}break}}while(o<s&&l<y);Ot=X>>3,o-=Ot,X-=Ot<<3,V&=(1<<X)-1,e.next_in=o,e.next_out=l,e.avail_in=o<s?5+(s-o):5-(o-s),e.avail_out=l<y?257+(y-l):257-(l-y),r.hold=V,r.bits=X},X1}var q1,IM;function Wpt(){if(IM)return q1;IM=1;var i=oh(),t=15,e=852,n=592,r=0,o=1,s=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],y=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],_=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return q1=function(C,I,k,z,V,X,H,$){var Y=$.bits,ct=0,rt=0,nt=0,Ot=0,Kt=0,ft=0,st=0,Ut=0,K=0,dt=0,Tt,ue,Rt,Ft,Gt,se=null,le=0,de,ye=new i.Buf16(t+1),Oe=new i.Buf16(t+1),Le=null,fe=0,_i,ei,ii;for(ct=0;ct<=t;ct++)ye[ct]=0;for(rt=0;rt<z;rt++)ye[I[k+rt]]++;for(Kt=Y,Ot=t;Ot>=1&&ye[Ot]===0;Ot--);if(Kt>Ot&&(Kt=Ot),Ot===0)return V[X++]=1<<24|64<<16|0,V[X++]=1<<24|64<<16|0,$.bits=1,0;for(nt=1;nt<Ot&&ye[nt]===0;nt++);for(Kt<nt&&(Kt=nt),Ut=1,ct=1;ct<=t;ct++)if(Ut<<=1,Ut-=ye[ct],Ut<0)return-1;if(Ut>0&&(C===r||Ot!==1))return-1;for(Oe[1]=0,ct=1;ct<t;ct++)Oe[ct+1]=Oe[ct]+ye[ct];for(rt=0;rt<z;rt++)I[k+rt]!==0&&(H[Oe[I[k+rt]]++]=rt);if(C===r?(se=Le=H,de=19):C===o?(se=l,le-=257,Le=c,fe-=257,de=256):(se=y,Le=_,de=-1),dt=0,rt=0,ct=nt,Gt=X,ft=Kt,st=0,Rt=-1,K=1<<Kt,Ft=K-1,C===o&&K>e||C===s&&K>n)return 1;for(;;){_i=ct-st,H[rt]<de?(ei=0,ii=H[rt]):H[rt]>de?(ei=Le[fe+H[rt]],ii=se[le+H[rt]]):(ei=96,ii=0),Tt=1<<ct-st,ue=1<<ft,nt=ue;do ue-=Tt,V[Gt+(dt>>st)+ue]=_i<<24|ei<<16|ii|0;while(ue!==0);for(Tt=1<<ct-1;dt&Tt;)Tt>>=1;if(Tt!==0?(dt&=Tt-1,dt+=Tt):dt=0,rt++,--ye[ct]===0){if(ct===Ot)break;ct=I[k+H[rt]]}if(ct>Kt&&(dt&Ft)!==Rt){for(st===0&&(st=Kt),Gt+=nt,ft=ct-st,Ut=1<<ft;ft+st<Ot&&(Ut-=ye[ft+st],!(Ut<=0));)ft++,Ut<<=1;if(K+=1<<ft,C===o&&K>e||C===s&&K>n)return 1;Rt=dt&Ft,V[Rt]=Kt<<24|ft<<16|Gt-X|0}}return dt!==0&&(V[Gt+dt]=ct-st<<24|64<<16|0),$.bits=Kt,0},q1}var MM;function Hpt(){if(MM)return Ia;MM=1;var i=oh(),t=U5(),e=V5(),n=jpt(),r=Wpt(),o=0,s=1,l=2,c=4,y=5,_=6,C=0,I=1,k=2,z=-2,V=-3,X=-4,H=-5,$=8,Y=1,ct=2,rt=3,nt=4,Ot=5,Kt=6,ft=7,st=8,Ut=9,K=10,dt=11,Tt=12,ue=13,Rt=14,Ft=15,Gt=16,se=17,le=18,de=19,ye=20,Oe=21,Le=22,fe=23,_i=24,ei=25,ii=26,Qe=27,yi=28,cn=29,Ni=30,Pi=31,Xn=32,xi=852,wi=592,mn=15,zi=mn;function cr(oe){return(oe>>>24&255)+(oe>>>8&65280)+((oe&65280)<<8)+((oe&255)<<24)}function tr(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function xn(oe){var Fe;return!oe||!oe.state?z:(Fe=oe.state,oe.total_in=oe.total_out=Fe.total=0,oe.msg="",Fe.wrap&&(oe.adler=Fe.wrap&1),Fe.mode=Y,Fe.last=0,Fe.havedict=0,Fe.dmax=32768,Fe.head=null,Fe.hold=0,Fe.bits=0,Fe.lencode=Fe.lendyn=new i.Buf32(xi),Fe.distcode=Fe.distdyn=new i.Buf32(wi),Fe.sane=1,Fe.back=-1,C)}function sr(oe){var Fe;return!oe||!oe.state?z:(Fe=oe.state,Fe.wsize=0,Fe.whave=0,Fe.wnext=0,xn(oe))}function qn(oe,Fe){var vt,qe;return!oe||!oe.state||(qe=oe.state,Fe<0?(vt=0,Fe=-Fe):(vt=(Fe>>4)+1,Fe<48&&(Fe&=15)),Fe&&(Fe<8||Fe>15))?z:(qe.window!==null&&qe.wbits!==Fe&&(qe.window=null),qe.wrap=vt,qe.wbits=Fe,sr(oe))}function Bn(oe,Fe){var vt,qe;return oe?(qe=new tr,oe.state=qe,qe.window=null,vt=qn(oe,Fe),vt!==C&&(oe.state=null),vt):z}function er(oe){return Bn(oe,zi)}var Ke=!0,bi,Oi;function on(oe){if(Ke){var Fe;for(bi=new i.Buf32(512),Oi=new i.Buf32(32),Fe=0;Fe<144;)oe.lens[Fe++]=8;for(;Fe<256;)oe.lens[Fe++]=9;for(;Fe<280;)oe.lens[Fe++]=7;for(;Fe<288;)oe.lens[Fe++]=8;for(r(s,oe.lens,0,288,bi,0,oe.work,{bits:9}),Fe=0;Fe<32;)oe.lens[Fe++]=5;r(l,oe.lens,0,32,Oi,0,oe.work,{bits:5}),Ke=!1}oe.lencode=bi,oe.lenbits=9,oe.distcode=Oi,oe.distbits=5}function Ar(oe,Fe,vt,qe){var Ce,q=oe.state;return q.window===null&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new i.Buf8(q.wsize)),qe>=q.wsize?(i.arraySet(q.window,Fe,vt-q.wsize,q.wsize,0),q.wnext=0,q.whave=q.wsize):(Ce=q.wsize-q.wnext,Ce>qe&&(Ce=qe),i.arraySet(q.window,Fe,vt-qe,Ce,q.wnext),qe-=Ce,qe?(i.arraySet(q.window,Fe,vt-qe,qe,0),q.wnext=qe,q.whave=q.wsize):(q.wnext+=Ce,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=Ce))),0}function Lt(oe,Fe){var vt,qe,Ce,q,Ee,Me,St,ee,Ae,Q,it,ut,xt,Nt,mt=0,wt,lt,pt,d,tt,Pe,ne,Ie,ke=new i.Buf8(4),Ue,ge,Ve=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!oe||!oe.state||!oe.output||!oe.input&&oe.avail_in!==0)return z;vt=oe.state,vt.mode===Tt&&(vt.mode=ue),Ee=oe.next_out,Ce=oe.output,St=oe.avail_out,q=oe.next_in,qe=oe.input,Me=oe.avail_in,ee=vt.hold,Ae=vt.bits,Q=Me,it=St,Ie=C;t:for(;;)switch(vt.mode){case Y:if(vt.wrap===0){vt.mode=ue;break}for(;Ae<16;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if(vt.wrap&2&&ee===35615){vt.check=0,ke[0]=ee&255,ke[1]=ee>>>8&255,vt.check=e(vt.check,ke,2,0),ee=0,Ae=0,vt.mode=ct;break}if(vt.flags=0,vt.head&&(vt.head.done=!1),!(vt.wrap&1)||(((ee&255)<<8)+(ee>>8))%31){oe.msg="incorrect header check",vt.mode=Ni;break}if((ee&15)!==$){oe.msg="unknown compression method",vt.mode=Ni;break}if(ee>>>=4,Ae-=4,ne=(ee&15)+8,vt.wbits===0)vt.wbits=ne;else if(ne>vt.wbits){oe.msg="invalid window size",vt.mode=Ni;break}vt.dmax=1<<ne,oe.adler=vt.check=1,vt.mode=ee&512?K:Tt,ee=0,Ae=0;break;case ct:for(;Ae<16;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if(vt.flags=ee,(vt.flags&255)!==$){oe.msg="unknown compression method",vt.mode=Ni;break}if(vt.flags&57344){oe.msg="unknown header flags set",vt.mode=Ni;break}vt.head&&(vt.head.text=ee>>8&1),vt.flags&512&&(ke[0]=ee&255,ke[1]=ee>>>8&255,vt.check=e(vt.check,ke,2,0)),ee=0,Ae=0,vt.mode=rt;case rt:for(;Ae<32;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}vt.head&&(vt.head.time=ee),vt.flags&512&&(ke[0]=ee&255,ke[1]=ee>>>8&255,ke[2]=ee>>>16&255,ke[3]=ee>>>24&255,vt.check=e(vt.check,ke,4,0)),ee=0,Ae=0,vt.mode=nt;case nt:for(;Ae<16;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}vt.head&&(vt.head.xflags=ee&255,vt.head.os=ee>>8),vt.flags&512&&(ke[0]=ee&255,ke[1]=ee>>>8&255,vt.check=e(vt.check,ke,2,0)),ee=0,Ae=0,vt.mode=Ot;case Ot:if(vt.flags&1024){for(;Ae<16;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}vt.length=ee,vt.head&&(vt.head.extra_len=ee),vt.flags&512&&(ke[0]=ee&255,ke[1]=ee>>>8&255,vt.check=e(vt.check,ke,2,0)),ee=0,Ae=0}else vt.head&&(vt.head.extra=null);vt.mode=Kt;case Kt:if(vt.flags&1024&&(ut=vt.length,ut>Me&&(ut=Me),ut&&(vt.head&&(ne=vt.head.extra_len-vt.length,vt.head.extra||(vt.head.extra=new Array(vt.head.extra_len)),i.arraySet(vt.head.extra,qe,q,ut,ne)),vt.flags&512&&(vt.check=e(vt.check,qe,ut,q)),Me-=ut,q+=ut,vt.length-=ut),vt.length))break t;vt.length=0,vt.mode=ft;case ft:if(vt.flags&2048){if(Me===0)break t;ut=0;do ne=qe[q+ut++],vt.head&&ne&&vt.length<65536&&(vt.head.name+=String.fromCharCode(ne));while(ne&&ut<Me);if(vt.flags&512&&(vt.check=e(vt.check,qe,ut,q)),Me-=ut,q+=ut,ne)break t}else vt.head&&(vt.head.name=null);vt.length=0,vt.mode=st;case st:if(vt.flags&4096){if(Me===0)break t;ut=0;do ne=qe[q+ut++],vt.head&&ne&&vt.length<65536&&(vt.head.comment+=String.fromCharCode(ne));while(ne&&ut<Me);if(vt.flags&512&&(vt.check=e(vt.check,qe,ut,q)),Me-=ut,q+=ut,ne)break t}else vt.head&&(vt.head.comment=null);vt.mode=Ut;case Ut:if(vt.flags&512){for(;Ae<16;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if(ee!==(vt.check&65535)){oe.msg="header crc mismatch",vt.mode=Ni;break}ee=0,Ae=0}vt.head&&(vt.head.hcrc=vt.flags>>9&1,vt.head.done=!0),oe.adler=vt.check=0,vt.mode=Tt;break;case K:for(;Ae<32;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}oe.adler=vt.check=cr(ee),ee=0,Ae=0,vt.mode=dt;case dt:if(vt.havedict===0)return oe.next_out=Ee,oe.avail_out=St,oe.next_in=q,oe.avail_in=Me,vt.hold=ee,vt.bits=Ae,k;oe.adler=vt.check=1,vt.mode=Tt;case Tt:if(Fe===y||Fe===_)break t;case ue:if(vt.last){ee>>>=Ae&7,Ae-=Ae&7,vt.mode=Qe;break}for(;Ae<3;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}switch(vt.last=ee&1,ee>>>=1,Ae-=1,ee&3){case 0:vt.mode=Rt;break;case 1:if(on(vt),vt.mode=ye,Fe===_){ee>>>=2,Ae-=2;break t}break;case 2:vt.mode=se;break;case 3:oe.msg="invalid block type",vt.mode=Ni}ee>>>=2,Ae-=2;break;case Rt:for(ee>>>=Ae&7,Ae-=Ae&7;Ae<32;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if((ee&65535)!==(ee>>>16^65535)){oe.msg="invalid stored block lengths",vt.mode=Ni;break}if(vt.length=ee&65535,ee=0,Ae=0,vt.mode=Ft,Fe===_)break t;case Ft:vt.mode=Gt;case Gt:if(ut=vt.length,ut){if(ut>Me&&(ut=Me),ut>St&&(ut=St),ut===0)break t;i.arraySet(Ce,qe,q,ut,Ee),Me-=ut,q+=ut,St-=ut,Ee+=ut,vt.length-=ut;break}vt.mode=Tt;break;case se:for(;Ae<14;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if(vt.nlen=(ee&31)+257,ee>>>=5,Ae-=5,vt.ndist=(ee&31)+1,ee>>>=5,Ae-=5,vt.ncode=(ee&15)+4,ee>>>=4,Ae-=4,vt.nlen>286||vt.ndist>30){oe.msg="too many length or distance symbols",vt.mode=Ni;break}vt.have=0,vt.mode=le;case le:for(;vt.have<vt.ncode;){for(;Ae<3;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}vt.lens[Ve[vt.have++]]=ee&7,ee>>>=3,Ae-=3}for(;vt.have<19;)vt.lens[Ve[vt.have++]]=0;if(vt.lencode=vt.lendyn,vt.lenbits=7,Ue={bits:vt.lenbits},Ie=r(o,vt.lens,0,19,vt.lencode,0,vt.work,Ue),vt.lenbits=Ue.bits,Ie){oe.msg="invalid code lengths set",vt.mode=Ni;break}vt.have=0,vt.mode=de;case de:for(;vt.have<vt.nlen+vt.ndist;){for(;mt=vt.lencode[ee&(1<<vt.lenbits)-1],wt=mt>>>24,lt=mt>>>16&255,pt=mt&65535,!(wt<=Ae);){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if(pt<16)ee>>>=wt,Ae-=wt,vt.lens[vt.have++]=pt;else{if(pt===16){for(ge=wt+2;Ae<ge;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if(ee>>>=wt,Ae-=wt,vt.have===0){oe.msg="invalid bit length repeat",vt.mode=Ni;break}ne=vt.lens[vt.have-1],ut=3+(ee&3),ee>>>=2,Ae-=2}else if(pt===17){for(ge=wt+3;Ae<ge;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}ee>>>=wt,Ae-=wt,ne=0,ut=3+(ee&7),ee>>>=3,Ae-=3}else{for(ge=wt+7;Ae<ge;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}ee>>>=wt,Ae-=wt,ne=0,ut=11+(ee&127),ee>>>=7,Ae-=7}if(vt.have+ut>vt.nlen+vt.ndist){oe.msg="invalid bit length repeat",vt.mode=Ni;break}for(;ut--;)vt.lens[vt.have++]=ne}}if(vt.mode===Ni)break;if(vt.lens[256]===0){oe.msg="invalid code -- missing end-of-block",vt.mode=Ni;break}if(vt.lenbits=9,Ue={bits:vt.lenbits},Ie=r(s,vt.lens,0,vt.nlen,vt.lencode,0,vt.work,Ue),vt.lenbits=Ue.bits,Ie){oe.msg="invalid literal/lengths set",vt.mode=Ni;break}if(vt.distbits=6,vt.distcode=vt.distdyn,Ue={bits:vt.distbits},Ie=r(l,vt.lens,vt.nlen,vt.ndist,vt.distcode,0,vt.work,Ue),vt.distbits=Ue.bits,Ie){oe.msg="invalid distances set",vt.mode=Ni;break}if(vt.mode=ye,Fe===_)break t;case ye:vt.mode=Oe;case Oe:if(Me>=6&&St>=258){oe.next_out=Ee,oe.avail_out=St,oe.next_in=q,oe.avail_in=Me,vt.hold=ee,vt.bits=Ae,n(oe,it),Ee=oe.next_out,Ce=oe.output,St=oe.avail_out,q=oe.next_in,qe=oe.input,Me=oe.avail_in,ee=vt.hold,Ae=vt.bits,vt.mode===Tt&&(vt.back=-1);break}for(vt.back=0;mt=vt.lencode[ee&(1<<vt.lenbits)-1],wt=mt>>>24,lt=mt>>>16&255,pt=mt&65535,!(wt<=Ae);){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if(lt&&(lt&240)===0){for(d=wt,tt=lt,Pe=pt;mt=vt.lencode[Pe+((ee&(1<<d+tt)-1)>>d)],wt=mt>>>24,lt=mt>>>16&255,pt=mt&65535,!(d+wt<=Ae);){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}ee>>>=d,Ae-=d,vt.back+=d}if(ee>>>=wt,Ae-=wt,vt.back+=wt,vt.length=pt,lt===0){vt.mode=ii;break}if(lt&32){vt.back=-1,vt.mode=Tt;break}if(lt&64){oe.msg="invalid literal/length code",vt.mode=Ni;break}vt.extra=lt&15,vt.mode=Le;case Le:if(vt.extra){for(ge=vt.extra;Ae<ge;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}vt.length+=ee&(1<<vt.extra)-1,ee>>>=vt.extra,Ae-=vt.extra,vt.back+=vt.extra}vt.was=vt.length,vt.mode=fe;case fe:for(;mt=vt.distcode[ee&(1<<vt.distbits)-1],wt=mt>>>24,lt=mt>>>16&255,pt=mt&65535,!(wt<=Ae);){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if((lt&240)===0){for(d=wt,tt=lt,Pe=pt;mt=vt.distcode[Pe+((ee&(1<<d+tt)-1)>>d)],wt=mt>>>24,lt=mt>>>16&255,pt=mt&65535,!(d+wt<=Ae);){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}ee>>>=d,Ae-=d,vt.back+=d}if(ee>>>=wt,Ae-=wt,vt.back+=wt,lt&64){oe.msg="invalid distance code",vt.mode=Ni;break}vt.offset=pt,vt.extra=lt&15,vt.mode=_i;case _i:if(vt.extra){for(ge=vt.extra;Ae<ge;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}vt.offset+=ee&(1<<vt.extra)-1,ee>>>=vt.extra,Ae-=vt.extra,vt.back+=vt.extra}if(vt.offset>vt.dmax){oe.msg="invalid distance too far back",vt.mode=Ni;break}vt.mode=ei;case ei:if(St===0)break t;if(ut=it-St,vt.offset>ut){if(ut=vt.offset-ut,ut>vt.whave&&vt.sane){oe.msg="invalid distance too far back",vt.mode=Ni;break}ut>vt.wnext?(ut-=vt.wnext,xt=vt.wsize-ut):xt=vt.wnext-ut,ut>vt.length&&(ut=vt.length),Nt=vt.window}else Nt=Ce,xt=Ee-vt.offset,ut=vt.length;ut>St&&(ut=St),St-=ut,vt.length-=ut;do Ce[Ee++]=Nt[xt++];while(--ut);vt.length===0&&(vt.mode=Oe);break;case ii:if(St===0)break t;Ce[Ee++]=vt.length,St--,vt.mode=Oe;break;case Qe:if(vt.wrap){for(;Ae<32;){if(Me===0)break t;Me--,ee|=qe[q++]<<Ae,Ae+=8}if(it-=St,oe.total_out+=it,vt.total+=it,it&&(oe.adler=vt.check=vt.flags?e(vt.check,Ce,it,Ee-it):t(vt.check,Ce,it,Ee-it)),it=St,(vt.flags?ee:cr(ee))!==vt.check){oe.msg="incorrect data check",vt.mode=Ni;break}ee=0,Ae=0}vt.mode=yi;case yi:if(vt.wrap&&vt.flags){for(;Ae<32;){if(Me===0)break t;Me--,ee+=qe[q++]<<Ae,Ae+=8}if(ee!==(vt.total&4294967295)){oe.msg="incorrect length check",vt.mode=Ni;break}ee=0,Ae=0}vt.mode=cn;case cn:Ie=I;break t;case Ni:Ie=V;break t;case Pi:return X;case Xn:default:return z}return oe.next_out=Ee,oe.avail_out=St,oe.next_in=q,oe.avail_in=Me,vt.hold=ee,vt.bits=Ae,(vt.wsize||it!==oe.avail_out&&vt.mode<Ni&&(vt.mode<Qe||Fe!==c))&&Ar(oe,oe.output,oe.next_out,it-oe.avail_out),Q-=oe.avail_in,it-=oe.avail_out,oe.total_in+=Q,oe.total_out+=it,vt.total+=it,vt.wrap&&it&&(oe.adler=vt.check=vt.flags?e(vt.check,Ce,it,oe.next_out-it):t(vt.check,Ce,it,oe.next_out-it)),oe.data_type=vt.bits+(vt.last?64:0)+(vt.mode===Tt?128:0)+(vt.mode===ye||vt.mode===Ft?256:0),(Q===0&&it===0||Fe===c)&&Ie===C&&(Ie=H),Ie}function je(oe){if(!oe||!oe.state)return z;var Fe=oe.state;return Fe.window&&(Fe.window=null),oe.state=null,C}function $e(oe,Fe){var vt;return!oe||!oe.state||(vt=oe.state,(vt.wrap&2)===0)?z:(vt.head=Fe,Fe.done=!1,C)}function di(oe,Fe){var vt=Fe.length,qe,Ce,q;return!oe||!oe.state||(qe=oe.state,qe.wrap!==0&&qe.mode!==dt)?z:qe.mode===dt&&(Ce=1,Ce=t(Ce,Fe,vt,0),Ce!==qe.check)?V:(q=Ar(oe,Fe,vt,vt),q?(qe.mode=Pi,X):(qe.havedict=1,C))}return Ia.inflateReset=sr,Ia.inflateReset2=qn,Ia.inflateResetKeep=xn,Ia.inflateInit=er,Ia.inflateInit2=Bn,Ia.inflate=Lt,Ia.inflateEnd=je,Ia.inflateGetHeader=$e,Ia.inflateSetDictionary=di,Ia.inflateInfo="pako inflate (from Nodeca project)",Ia}var BM,RM;function W5(){return RM||(RM=1,BM={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),BM}var K1,LM;function Xpt(){if(LM)return K1;LM=1;function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return K1=i,K1}var DM;function qpt(){if(DM)return Md;DM=1;var i=Hpt(),t=oh(),e=G5(),n=W5(),r=Yw(),o=j5(),s=Xpt(),l=Object.prototype.toString;function c(C){if(!(this instanceof c))return new c(C);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},C||{});var I=this.options;I.raw&&I.windowBits>=0&&I.windowBits<16&&(I.windowBits=-I.windowBits,I.windowBits===0&&(I.windowBits=-15)),I.windowBits>=0&&I.windowBits<16&&!(C&&C.windowBits)&&(I.windowBits+=32),I.windowBits>15&&I.windowBits<48&&(I.windowBits&15)===0&&(I.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var k=i.inflateInit2(this.strm,I.windowBits);if(k!==n.Z_OK)throw new Error(r[k]);if(this.header=new s,i.inflateGetHeader(this.strm,this.header),I.dictionary&&(typeof I.dictionary=="string"?I.dictionary=e.string2buf(I.dictionary):l.call(I.dictionary)==="[object ArrayBuffer]"&&(I.dictionary=new Uint8Array(I.dictionary)),I.raw&&(k=i.inflateSetDictionary(this.strm,I.dictionary),k!==n.Z_OK)))throw new Error(r[k])}c.prototype.push=function(C,I){var k=this.strm,z=this.options.chunkSize,V=this.options.dictionary,X,H,$,Y,ct,rt=!1;if(this.ended)return!1;H=I===~~I?I:I===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof C=="string"?k.input=e.binstring2buf(C):l.call(C)==="[object ArrayBuffer]"?k.input=new Uint8Array(C):k.input=C,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new t.Buf8(z),k.next_out=0,k.avail_out=z),X=i.inflate(k,n.Z_NO_FLUSH),X===n.Z_NEED_DICT&&V&&(X=i.inflateSetDictionary(this.strm,V)),X===n.Z_BUF_ERROR&&rt===!0&&(X=n.Z_OK,rt=!1),X!==n.Z_STREAM_END&&X!==n.Z_OK)return this.onEnd(X),this.ended=!0,!1;k.next_out&&(k.avail_out===0||X===n.Z_STREAM_END||k.avail_in===0&&(H===n.Z_FINISH||H===n.Z_SYNC_FLUSH))&&(this.options.to==="string"?($=e.utf8border(k.output,k.next_out),Y=k.next_out-$,ct=e.buf2string(k.output,$),k.next_out=Y,k.avail_out=z-Y,Y&&t.arraySet(k.output,k.output,$,Y,0),this.onData(ct)):this.onData(t.shrinkBuf(k.output,k.next_out))),k.avail_in===0&&k.avail_out===0&&(rt=!0)}while((k.avail_in>0||k.avail_out===0)&&X!==n.Z_STREAM_END);return X===n.Z_STREAM_END&&(H=n.Z_FINISH),H===n.Z_FINISH?(X=i.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,X===n.Z_OK):(H===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),k.avail_out=0),!0)},c.prototype.onData=function(C){this.chunks.push(C)},c.prototype.onEnd=function(C){C===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg};function y(C,I){var k=new c(I);if(k.push(C,!0),k.err)throw k.msg||r[k.err];return k.result}function _(C,I){return I=I||{},I.raw=!0,y(C,I)}return Md.Inflate=c,Md.inflate=y,Md.inflateRaw=_,Md.ungzip=y,Md}var Z1,kM;function Kpt(){if(kM)return Z1;kM=1;var i=oh().assign,t=Gpt(),e=qpt(),n=W5(),r={};return i(r,t,e,n),Z1=r,Z1}var Zpt=Kpt();const Bd=df(Zpt),OM=[0],Ypt={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:z5,onTilesetLoad:{type:"function",value:i=>{}},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:(i,t,e)=>{}},_getMeshColor:{type:"function",value:i=>[255,255,255]}};class Qw extends Is{initializeState(){"onTileLoadFail"in this.props&&$i.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:e,changeFlags:n}){if(t.data&&t.data!==e.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:r}=this.state;for(const o in r)r[o].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,e[t.id]=t;const r=n?.[t.id];(!r||!t.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:t,sourceLayer:e}){const n=e&&e.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer({layer:t,viewport:e}){const{tile:n}=t.props,{id:r}=e;return n.selected&&n.viewportIds.includes(r)}_updateAutoHighlight(t){const e=t.sourceTile,n=this.state.layerMap[e?.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props,n=this.props.loader||this.props.loaders,r=Array.isArray(n)?n[0]:n,o={loadOptions:{...e}};let s=t;if(r.preload){const y=await r.preload(t,e);y.url&&(s=y.url),y.headers&&(o.loadOptions.fetch={...o.loadOptions.fetch,headers:y.headers}),Object.assign(o,y)}const l=await Qu(s,r,o.loadOptions),c=new _dt(l,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...o});this.setState({tileset3d:c,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(c)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:n}=this.context,r=Object.keys(t).length;!n||!r||!e||e.selectTiles(Object.values(t)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case Ku.POINTCLOUD:return this._makePointCloudLayer(t,e);case Ku.SCENEGRAPH:return this._make3DModelLayer(t);case Ku.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${t.content.type}`)}}_makePointCloudLayer(t,e){const{attributes:n,pointCount:r,constantRGBA:o,cartographicOrigin:s,modelMatrix:l}=t.content,{positions:c,normals:y,colors:_}=n;if(!c)return null;const C=e&&e.props.data||{header:{vertexCount:r},attributes:{POSITION:c,NORMAL:y,COLOR_0:_}},{pointSize:I,getPointColor:k}=this.props,z=this.getSubLayerClass("pointcloud",xm);return new z({pointSize:I},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${t.id}`,tile:t,data:C,coordinateSystem:nn.METER_OFFSETS,coordinateOrigin:s,modelMatrix:l,getColor:o||k,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:n,cartographicOrigin:r,modelMatrix:o}=t.content,s=this.getSubLayerClass("scenegraph",Pm);return new s({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${t.id}`,tile:t,data:n||OM,scenegraph:e,coordinateSystem:nn.METER_OFFSETS,coordinateOrigin:r,modelMatrix:o,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const n=t.content,{attributes:r,indices:o,modelMatrix:s,cartographicOrigin:l,coordinateSystem:c=nn.METER_OFFSETS,material:y,featureIds:_}=n,{_getMeshColor:C}=this.props,I=e&&e.props.mesh||new no({topology:"triangle-list",attributes:Qpt(r),indices:o}),k=this.getSubLayerClass("mesh",Gw);return new k(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${t.id}`,tile:t,mesh:I,data:OM,getColor:C(t),pbrMaterial:y,modelMatrix:s,coordinateOrigin:l,coordinateSystem:c,featureIds:_,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map(n=>{const r=e[n.id]=e[n.id]||{tile:n};let{layer:o}=r;return n.selected&&(o?r.needsUpdate&&(o=this._getSubLayer(n,o),r.needsUpdate=!1):o=this._getSubLayer(n)),r.layer=o,o}).filter(Boolean):null}}Qw.defaultProps=Ypt;Qw.layerName="Tile3DLayer";function Qpt(i){const t={};return t.positions={...i.positions,value:new Float32Array(i.positions.value)},i.normals&&(t.normals=i.normals),i.texCoords&&(t.texCoords=i.texCoords),i.colors&&(t.colors=i.colors),i.uvRegions&&(t.uvRegions=i.uvRegions),t}const Jpt="4.3.3",H5={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:Jpt,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({...H5});const FM=[1],$pt={...oc.defaultProps,elevationData:gy,texture:{...gy,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[H5]};function NM(i){return Array.isArray(i)?i.join(";"):i||""}class Jw extends Is{updateState({props:t,oldProps:e}){const n=t.elevationData!==e.elevationData;if(n){const{elevationData:o}=t,s=o&&(Array.isArray(o)||tAt(o));this.setState({isTiled:s})}const r=n||t.meshMaxError!==e.meshMaxError||t.elevationDecoder!==e.elevationDecoder||t.bounds!==e.bounds;if(!this.state.isTiled&&r){const o=this.loadTerrain(t);this.setState({terrain:o})}t.workerUrl&&$i.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:t,bounds:e,elevationDecoder:n,meshMaxError:r,signal:o}){if(!t)return null;let s=this.getLoadOptions();s={...s,terrain:{skirtHeight:this.state.isTiled?r*2:0,...s?.terrain,bounds:e,meshMaxError:r,elevationDecoder:n}};const{fetch:l}=this.props;return l(t,{propName:"elevationData",layer:this,loadOptions:s,signal:o})}getTiledTerrainData(t){const{elevationData:e,fetch:n,texture:r,elevationDecoder:o,meshMaxError:s}=this.props,{viewport:l}=this.context,c=uf(e,t),y=r&&uf(r,t),{signal:_}=t;let C=[0,0],I=[0,0];if(l.isGeospatial){const X=t.bbox;C=l.projectFlat([X.west,X.south]),I=l.projectFlat([X.east,X.north])}else{const X=t.bbox;C=[X.left,X.bottom],I=[X.right,X.top]}const k=[C[0],C[1],I[0],I[1]],z=this.loadTerrain({elevationData:c,bounds:k,elevationDecoder:o,meshMaxError:s,signal:_}),V=y?n(y,{propName:"texture",layer:this,loaders:[],signal:_}).catch(X=>null):Promise.resolve(null);return Promise.all([z,V])}renderSubLayers(t){const e=this.getSubLayerClass("mesh",cf),{color:n,wireframe:r,material:o}=this.props,{data:s}=t;if(!s)return null;const[l,c]=s;return new e(t,{data:FM,mesh:l,texture:c,_instanced:!1,coordinateSystem:nn.CARTESIAN,getPosition:y=>[0,0,0],getColor:n,wireframe:r,material:o})}onViewportLoad(t){if(!t)return;const{zRange:e}=this.state,n=t.map(s=>s.content).filter(Boolean).map(s=>s[0].header.boundingBox.map(l=>l[2]));if(n.length===0)return;const r=Math.min(...n.map(s=>s[0])),o=Math.max(...n.map(s=>s[1]));(!e||r<e[0]||o>e[1])&&this.setState({zRange:[r,o]})}renderLayers(){const{color:t,material:e,elevationData:n,texture:r,wireframe:o,meshMaxError:s,elevationDecoder:l,tileSize:c,maxZoom:y,minZoom:_,extent:C,maxRequests:I,onTileLoad:k,onTileUnload:z,onTileError:V,maxCacheSize:X,maxCacheByteSize:H,refinementStrategy:$}=this.props;if(this.state.isTiled)return new oc(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:NM(n),texture:NM(r),meshMaxError:s,elevationDecoder:l}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:c,maxZoom:y,minZoom:_,extent:C,maxRequests:I,onTileLoad:k,onTileUnload:z,onTileError:V,maxCacheSize:X,maxCacheByteSize:H,refinementStrategy:$});if(!n)return null;const Y=this.getSubLayerClass("mesh",cf);return new Y(this.getSubLayerProps({id:"mesh"}),{data:FM,mesh:this.state.terrain,texture:r,_instanced:!1,getPosition:ct=>[0,0,0],getColor:t,material:e,wireframe:o})}}Jw.defaultProps=$pt;Jw.layerName="TerrainLayer";const tAt=i=>i.includes("{x}")&&(i.includes("{y}")||i.includes("{-y}")),eAt={clipBounds:[0,0,1,1],clipByInstance:void 0},X5=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,iAt={name:"clip",vs:X5,uniformTypes:{bounds:"vec4<f32>"}},nAt={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},rAt={name:"clip",fs:X5,uniformTypes:{bounds:"vec4<f32>"}},sAt={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class dv extends zy{getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(t=!!this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[iAt],inject:nAt}:{modules:[rAt],inject:sAt}}draw(){const{clipBounds:t}=this.props,e={};if(this.state.clipByInstance)e.bounds=t;else{const n=this.projectPosition([t[0],t[1],0]),r=this.projectPosition([t[2],t[3],0]);e.bounds=[Math.min(n[0],r[0]),Math.min(n[1],r[1]),Math.max(n[0],r[0]),Math.max(n[1],r[1])]}this.setShaderModuleProps({clip:e})}}dv.defaultProps=eAt;dv.extensionName="ClipExtension";const oAt=`
in float collisionPriorities;

uniform sampler2D collision_texture;

uniform collisionUniforms {
  bool sort;
  bool enabled;
} collision;

vec2 collision_getCoords(vec4 position) {
  vec4 collision_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}

float collision_match(vec2 tex, vec3 pickingColor) {
  vec4 collision_pickingColor = texture(collision_texture, tex);
  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collision.enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project.viewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collision_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,aAt={"vs:#decl":`
  float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collision.sort) {
    float collisionPriority = collisionPriorities;
    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
  }

  if (collision.enabled) {
    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collision_texCoords = collision_getCoords(collision_common_position);
    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
    if (collision_fade < 0.0001) {
      // Position outside clip space bounds to discard
      position = vec4(0.0, 0.0, 2.0, 1.0);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collision_fade;
  `},lAt=i=>{if(!i||!("dummyCollisionMap"in i))return{};const{enabled:t,collisionFBO:e,drawToCollisionMap:n,dummyCollisionMap:r}=i;return{enabled:t&&!n,sort:!!n,collision_texture:!n&&e?e.colorAttachments[0]:r}},uAt={name:"collision",dependencies:[Ly],vs:oAt,inject:aAt,getUniforms:lAt,uniformTypes:{sort:"i32",enabled:"i32"}};class cAt extends Dy{renderCollisionMap(t,e){const n=[0,0,0,0],r=[1,1,t.width-2,t.height-2];this.render({...e,clearColor:n,scissorRect:r,target:t,pass:"collision"})}getLayerParameters(t,e,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}getShaderModuleProps(){return{collision:{drawToCollisionMap:!0},picking:{isActive:1,isAttribute:!1},lighting:{enabled:!1}}}}const Y1=2;class hAt{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(t){this.context=t;const{device:e}=t;this.dummyCollisionMap=e.createTexture({width:1,height:1}),this.collisionFilterPass=new cAt(e,{id:"default-collision-filter"})}preRender({effects:t,layers:e,layerFilter:n,viewports:r,onViewportActive:o,views:s,isPicking:l,preRenderStats:c={}}){const{device:y}=this.context;if(l)return;const _=e.filter(({props:{visible:X,collisionEnabled:H}})=>X&&H);if(_.length===0){this.channels={};return}const C=t?.filter(X=>X.useInPicking&&c[X.id]),I=c["mask-effect"]?.didRender,k=this._groupByCollisionGroup(y,_),z=r[0],V=!this.lastViewport||!this.lastViewport.equals(z)||I;for(const X in k){const H=this.collisionFBOs[X],$=k[X],[Y,ct]=y.canvasContext.getPixelSize();H.resize({width:Y/Y1,height:ct/Y1}),this._render($,{effects:C,layerFilter:n,onViewportActive:o,views:s,viewport:z,viewportChanged:V})}}_render(t,{effects:e,layerFilter:n,onViewportActive:r,views:o,viewport:s,viewportChanged:l}){const{collisionGroup:c}=t,y=this.channels[c];if(!y)return;const _=l||t===y||!Or(y.layers,t.layers,1)||t.layerBounds.some((C,I)=>!Aa(C,y.layerBounds[I]))||t.allLayersLoaded!==y.allLayersLoaded||t.layers.some(C=>C.props.transitions);if(this.channels[c]=t,_){this.lastViewport=s;const C=this.collisionFBOs[c];this.collisionFilterPass.renderCollisionMap(C,{pass:"collision-filter",isPicking:!0,layers:t.layers,effects:e,layerFilter:n,viewports:s?[s]:[],onViewportActive:r,views:o,shaderModuleProps:{collision:{enabled:!0,dummyCollisionMap:this.dummyCollisionMap},project:{devicePixelRatio:C.device.canvasContext.getDevicePixelRatio()/Y1}}})}}_groupByCollisionGroup(t,e){const n={};for(const r of e){const o=r.props.collisionGroup;let s=n[o];s||(s={collisionGroup:o,layers:[],layerBounds:[],allLayersLoaded:!0},n[o]=s),s.layers.push(r),s.layerBounds.push(r.getBounds()),r.isLoaded||(s.allLayersLoaded=!1)}for(const r of Object.keys(n))this.collisionFBOs[r]||this.createFBO(t,r),this.channels[r]||(this.channels[r]=n[r]);for(const r of Object.keys(this.collisionFBOs))n[r]||this.destroyFBO(r);return n}getShaderModuleProps(t){const{collisionGroup:e,collisionEnabled:n}=t.props,{collisionFBOs:r,dummyCollisionMap:o}=this,s=r[e];return{collision:{enabled:n&&!!s,collisionFBO:s,dummyCollisionMap:o}}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const t of Object.keys(this.collisionFBOs))this.destroyFBO(t);this.collisionFBOs={},this.lastViewport=void 0}createFBO(t,e){const{width:n,height:r}=t.getDefaultCanvasContext().canvas,o=t.createTexture({format:"rgba8unorm",width:n,height:r,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=t.createTexture({format:"depth16unorm",width:n,height:r});this.collisionFBOs[e]=t.createFramebuffer({id:`collision-${e}`,width:n,height:r,colorAttachments:[o],depthStencilAttachment:s})}destroyFBO(t){const e=this.collisionFBOs[t];e.colorAttachments[0]?.destroy(),e.depthStencilAttachment?.destroy(),e.destroy(),delete this.collisionFBOs[t]}}const fAt={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}};class $w extends zy{getShaders(){return{modules:[uAt]}}draw({shaderModuleProps:t}){t.collision?.drawToCollisionMap&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(t,e){this.getAttributeManager()!==null&&(this.context.deck?._addDefaultEffect(new hAt),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}}))}getNeedsPickingBuffer(){return this.props.collisionEnabled}}$w.defaultProps=fAt;$w.extensionName="CollisionFilterExtension";function k2(i,t){const e=t?.globalFeatureId;return e!==void 0?dAt(i,e):pAt(i,t?.type)}function dAt(i,t){const e=q5(i);for(const n of e){let r=0,o=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){const l=n.featureIds.value[s];if(l!==o){if(t===n.globalFeatureIds.value[r])return vy(n,r,s);r=s,o=l}}if(t===n.globalFeatureIds.value[r])return vy(n,r,n.featureIds.value.length)}throw new Error(`featureId:${t} not found`)}function pAt(i,t){const e=q5(i);return mAt(e)}function AAt(i,t,e){switch(i.type){case"Point":return _At(i,t,e);case"LineString":return vAt(i,t,e);case"Polygon":return K5(i,t,e);default:const n=i;throw new Error(`Unsupported geometry type: ${n?.type}`)}}function q5(i,t){const e=[];return i.points&&(i.points.type="Point",e.push(i.points)),i.lines&&(i.lines.type="LineString",e.push(i.lines)),i.polygons&&(i.polygons.type="Polygon",e.push(i.polygons)),e}function mAt(i){const t=[];for(const e of i){if(e.featureIds.value.length===0)continue;let n=0,r=e.featureIds.value[0];for(let o=0;o<e.featureIds.value.length;o++){const s=e.featureIds.value[o];s!==r&&(t.push(vy(e,n,o)),n=o,r=s)}t.push(vy(e,n,e.featureIds.value.length))}return t}function vy(i,t,e){const n=AAt(i,t,e),r=yAt(i,t),o=gAt(i,t);return{type:"Feature",geometry:n,properties:r,...o}}function gAt(i,t=0,e){return i.fields&&i.fields[i.featureIds.value[t]]}function yAt(i,t=0,e){const n=Object.assign({},i.properties[i.featureIds.value[t]]);for(const r in i.numericProps)n[r]=i.numericProps[r].value[t];return n}function K5(i,t=-1/0,e=1/0){const{positions:n}=i,r=i.polygonIndices.value.filter(l=>l>=t&&l<=e),o=i.primitivePolygonIndices.value.filter(l=>l>=t&&l<=e);if(!(r.length>2)){const l=[];for(let c=0;c<o.length-1;c++){const y=o[c],_=o[c+1],C=_y(n,y,_);l.push(C)}return{type:"Polygon",coordinates:l}}const s=[];for(let l=0;l<r.length-1;l++){const c=r[l],y=r[l+1],_=K5(i,c,y).coordinates;s.push(_)}return{type:"MultiPolygon",coordinates:s}}function vAt(i,t=-1/0,e=1/0){const{positions:n}=i,r=i.pathIndices.value.filter(s=>s>=t&&s<=e);if(!(r.length>2))return{type:"LineString",coordinates:_y(n,r[0],r[1])};const o=[];for(let s=0;s<r.length-1;s++){const l=_y(n,r[s],r[s+1]);o.push(l)}return{type:"MultiLineString",coordinates:o}}function _At(i,t,e){const{positions:n}=i,r=_y(n,t,e);return r.length>1?{type:"MultiPoint",coordinates:r}:{type:"Point",coordinates:r[0]}}function _y(i,t,e){t=t||0,e=e||i.value.length/i.size;const n=[];for(let r=t;r<e;r++){const o=Array();for(let s=r*i.size;s<(r+1)*i.size;s++)o.push(Number(i.value[s]));n.push(o)}return n}var Q1={},zM;function bAt(){return zM||(zM=1,Q1.read=function(i,t,e,n,r){var o,s,l=r*8-n-1,c=(1<<l)-1,y=c>>1,_=-7,C=e?r-1:0,I=e?-1:1,k=i[t+C];for(C+=I,o=k&(1<<-_)-1,k>>=-_,_+=l;_>0;o=o*256+i[t+C],C+=I,_-=8);for(s=o&(1<<-_)-1,o>>=-_,_+=n;_>0;s=s*256+i[t+C],C+=I,_-=8);if(o===0)o=1-y;else{if(o===c)return s?NaN:(k?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-y}return(k?-1:1)*s*Math.pow(2,o-n)},Q1.write=function(i,t,e,n,r,o){var s,l,c,y=o*8-r-1,_=(1<<y)-1,C=_>>1,I=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=n?0:o-1,z=n?1:-1,V=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,s=_):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),s+C>=1?t+=I/c:t+=I*Math.pow(2,1-C),t*c>=2&&(s++,c/=2),s+C>=_?(l=0,s=_):s+C>=1?(l=(t*c-1)*Math.pow(2,r),s=s+C):(l=t*Math.pow(2,C-1)*Math.pow(2,r),s=0));r>=8;i[e+k]=l&255,k+=z,l/=256,r-=8);for(s=s<<r|l,y+=r;y>0;i[e+k]=s&255,k+=z,s/=256,y-=8);i[e+k-z]|=V*128}),Q1}var J1,UM;function xAt(){if(UM)return J1;UM=1,J1=t;var i=bAt();function t(K){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(K)?K:new Uint8Array(K||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var e=65536*65536,n=1/e,r=12,o=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");t.prototype={destroy:function(){this.buf=null},readFields:function(K,dt,Tt){for(Tt=Tt||this.length;this.pos<Tt;){var ue=this.readVarint(),Rt=ue>>3,Ft=this.pos;this.type=ue&7,K(Rt,dt,this),this.pos===Ft&&this.skip(ue)}return dt},readMessage:function(K,dt){return this.readFields(K,dt,this.readVarint()+this.pos)},readFixed32:function(){var K=nt(this.buf,this.pos);return this.pos+=4,K},readSFixed32:function(){var K=Kt(this.buf,this.pos);return this.pos+=4,K},readFixed64:function(){var K=nt(this.buf,this.pos)+nt(this.buf,this.pos+4)*e;return this.pos+=8,K},readSFixed64:function(){var K=nt(this.buf,this.pos)+Kt(this.buf,this.pos+4)*e;return this.pos+=8,K},readFloat:function(){var K=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,K},readDouble:function(){var K=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,K},readVarint:function(K){var dt=this.buf,Tt,ue;return ue=dt[this.pos++],Tt=ue&127,ue<128||(ue=dt[this.pos++],Tt|=(ue&127)<<7,ue<128)||(ue=dt[this.pos++],Tt|=(ue&127)<<14,ue<128)||(ue=dt[this.pos++],Tt|=(ue&127)<<21,ue<128)?Tt:(ue=dt[this.pos],Tt|=(ue&15)<<28,s(Tt,K,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var K=this.readVarint();return K%2===1?(K+1)/-2:K/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var K=this.readVarint()+this.pos,dt=this.pos;return this.pos=K,K-dt>=r&&o?st(this.buf,dt,K):ft(this.buf,dt,K)},readBytes:function(){var K=this.readVarint()+this.pos,dt=this.buf.subarray(this.pos,K);return this.pos=K,dt},readPackedVarint:function(K,dt){if(this.type!==t.Bytes)return K.push(this.readVarint(dt));var Tt=l(this);for(K=K||[];this.pos<Tt;)K.push(this.readVarint(dt));return K},readPackedSVarint:function(K){if(this.type!==t.Bytes)return K.push(this.readSVarint());var dt=l(this);for(K=K||[];this.pos<dt;)K.push(this.readSVarint());return K},readPackedBoolean:function(K){if(this.type!==t.Bytes)return K.push(this.readBoolean());var dt=l(this);for(K=K||[];this.pos<dt;)K.push(this.readBoolean());return K},readPackedFloat:function(K){if(this.type!==t.Bytes)return K.push(this.readFloat());var dt=l(this);for(K=K||[];this.pos<dt;)K.push(this.readFloat());return K},readPackedDouble:function(K){if(this.type!==t.Bytes)return K.push(this.readDouble());var dt=l(this);for(K=K||[];this.pos<dt;)K.push(this.readDouble());return K},readPackedFixed32:function(K){if(this.type!==t.Bytes)return K.push(this.readFixed32());var dt=l(this);for(K=K||[];this.pos<dt;)K.push(this.readFixed32());return K},readPackedSFixed32:function(K){if(this.type!==t.Bytes)return K.push(this.readSFixed32());var dt=l(this);for(K=K||[];this.pos<dt;)K.push(this.readSFixed32());return K},readPackedFixed64:function(K){if(this.type!==t.Bytes)return K.push(this.readFixed64());var dt=l(this);for(K=K||[];this.pos<dt;)K.push(this.readFixed64());return K},readPackedSFixed64:function(K){if(this.type!==t.Bytes)return K.push(this.readSFixed64());var dt=l(this);for(K=K||[];this.pos<dt;)K.push(this.readSFixed64());return K},skip:function(K){var dt=K&7;if(dt===t.Varint)for(;this.buf[this.pos++]>127;);else if(dt===t.Bytes)this.pos=this.readVarint()+this.pos;else if(dt===t.Fixed32)this.pos+=4;else if(dt===t.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+dt)},writeTag:function(K,dt){this.writeVarint(K<<3|dt)},realloc:function(K){for(var dt=this.length||16;dt<this.pos+K;)dt*=2;if(dt!==this.length){var Tt=new Uint8Array(dt);Tt.set(this.buf),this.buf=Tt,this.length=dt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(K){this.realloc(4),Ot(this.buf,K,this.pos),this.pos+=4},writeSFixed32:function(K){this.realloc(4),Ot(this.buf,K,this.pos),this.pos+=4},writeFixed64:function(K){this.realloc(8),Ot(this.buf,K&-1,this.pos),Ot(this.buf,Math.floor(K*n),this.pos+4),this.pos+=8},writeSFixed64:function(K){this.realloc(8),Ot(this.buf,K&-1,this.pos),Ot(this.buf,Math.floor(K*n),this.pos+4),this.pos+=8},writeVarint:function(K){if(K=+K||0,K>268435455||K<0){y(K,this);return}this.realloc(4),this.buf[this.pos++]=K&127|(K>127?128:0),!(K<=127)&&(this.buf[this.pos++]=(K>>>=7)&127|(K>127?128:0),!(K<=127)&&(this.buf[this.pos++]=(K>>>=7)&127|(K>127?128:0),!(K<=127)&&(this.buf[this.pos++]=K>>>7&127)))},writeSVarint:function(K){this.writeVarint(K<0?-K*2-1:K*2)},writeBoolean:function(K){this.writeVarint(!!K)},writeString:function(K){K=String(K),this.realloc(K.length*4),this.pos++;var dt=this.pos;this.pos=Ut(this.buf,K,this.pos);var Tt=this.pos-dt;Tt>=128&&I(dt,Tt,this),this.pos=dt-1,this.writeVarint(Tt),this.pos+=Tt},writeFloat:function(K){this.realloc(4),i.write(this.buf,K,this.pos,!0,23,4),this.pos+=4},writeDouble:function(K){this.realloc(8),i.write(this.buf,K,this.pos,!0,52,8),this.pos+=8},writeBytes:function(K){var dt=K.length;this.writeVarint(dt),this.realloc(dt);for(var Tt=0;Tt<dt;Tt++)this.buf[this.pos++]=K[Tt]},writeRawMessage:function(K,dt){this.pos++;var Tt=this.pos;K(dt,this);var ue=this.pos-Tt;ue>=128&&I(Tt,ue,this),this.pos=Tt-1,this.writeVarint(ue),this.pos+=ue},writeMessage:function(K,dt,Tt){this.writeTag(K,t.Bytes),this.writeRawMessage(dt,Tt)},writePackedVarint:function(K,dt){dt.length&&this.writeMessage(K,k,dt)},writePackedSVarint:function(K,dt){dt.length&&this.writeMessage(K,z,dt)},writePackedBoolean:function(K,dt){dt.length&&this.writeMessage(K,H,dt)},writePackedFloat:function(K,dt){dt.length&&this.writeMessage(K,V,dt)},writePackedDouble:function(K,dt){dt.length&&this.writeMessage(K,X,dt)},writePackedFixed32:function(K,dt){dt.length&&this.writeMessage(K,$,dt)},writePackedSFixed32:function(K,dt){dt.length&&this.writeMessage(K,Y,dt)},writePackedFixed64:function(K,dt){dt.length&&this.writeMessage(K,ct,dt)},writePackedSFixed64:function(K,dt){dt.length&&this.writeMessage(K,rt,dt)},writeBytesField:function(K,dt){this.writeTag(K,t.Bytes),this.writeBytes(dt)},writeFixed32Field:function(K,dt){this.writeTag(K,t.Fixed32),this.writeFixed32(dt)},writeSFixed32Field:function(K,dt){this.writeTag(K,t.Fixed32),this.writeSFixed32(dt)},writeFixed64Field:function(K,dt){this.writeTag(K,t.Fixed64),this.writeFixed64(dt)},writeSFixed64Field:function(K,dt){this.writeTag(K,t.Fixed64),this.writeSFixed64(dt)},writeVarintField:function(K,dt){this.writeTag(K,t.Varint),this.writeVarint(dt)},writeSVarintField:function(K,dt){this.writeTag(K,t.Varint),this.writeSVarint(dt)},writeStringField:function(K,dt){this.writeTag(K,t.Bytes),this.writeString(dt)},writeFloatField:function(K,dt){this.writeTag(K,t.Fixed32),this.writeFloat(dt)},writeDoubleField:function(K,dt){this.writeTag(K,t.Fixed64),this.writeDouble(dt)},writeBooleanField:function(K,dt){this.writeVarintField(K,!!dt)}};function s(K,dt,Tt){var ue=Tt.buf,Rt,Ft;if(Ft=ue[Tt.pos++],Rt=(Ft&112)>>4,Ft<128||(Ft=ue[Tt.pos++],Rt|=(Ft&127)<<3,Ft<128)||(Ft=ue[Tt.pos++],Rt|=(Ft&127)<<10,Ft<128)||(Ft=ue[Tt.pos++],Rt|=(Ft&127)<<17,Ft<128)||(Ft=ue[Tt.pos++],Rt|=(Ft&127)<<24,Ft<128)||(Ft=ue[Tt.pos++],Rt|=(Ft&1)<<31,Ft<128))return c(K,Rt,dt);throw new Error("Expected varint not more than 10 bytes")}function l(K){return K.type===t.Bytes?K.readVarint()+K.pos:K.pos+1}function c(K,dt,Tt){return Tt?dt*4294967296+(K>>>0):(dt>>>0)*4294967296+(K>>>0)}function y(K,dt){var Tt,ue;if(K>=0?(Tt=K%4294967296|0,ue=K/4294967296|0):(Tt=~(-K%4294967296),ue=~(-K/4294967296),Tt^4294967295?Tt=Tt+1|0:(Tt=0,ue=ue+1|0)),K>=18446744073709552e3||K<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");dt.realloc(10),_(Tt,ue,dt),C(ue,dt)}function _(K,dt,Tt){Tt.buf[Tt.pos++]=K&127|128,K>>>=7,Tt.buf[Tt.pos++]=K&127|128,K>>>=7,Tt.buf[Tt.pos++]=K&127|128,K>>>=7,Tt.buf[Tt.pos++]=K&127|128,K>>>=7,Tt.buf[Tt.pos]=K&127}function C(K,dt){var Tt=(K&7)<<4;dt.buf[dt.pos++]|=Tt|((K>>>=3)?128:0),K&&(dt.buf[dt.pos++]=K&127|((K>>>=7)?128:0),K&&(dt.buf[dt.pos++]=K&127|((K>>>=7)?128:0),K&&(dt.buf[dt.pos++]=K&127|((K>>>=7)?128:0),K&&(dt.buf[dt.pos++]=K&127|((K>>>=7)?128:0),K&&(dt.buf[dt.pos++]=K&127)))))}function I(K,dt,Tt){var ue=dt<=16383?1:dt<=2097151?2:dt<=268435455?3:Math.floor(Math.log(dt)/(Math.LN2*7));Tt.realloc(ue);for(var Rt=Tt.pos-1;Rt>=K;Rt--)Tt.buf[Rt+ue]=Tt.buf[Rt]}function k(K,dt){for(var Tt=0;Tt<K.length;Tt++)dt.writeVarint(K[Tt])}function z(K,dt){for(var Tt=0;Tt<K.length;Tt++)dt.writeSVarint(K[Tt])}function V(K,dt){for(var Tt=0;Tt<K.length;Tt++)dt.writeFloat(K[Tt])}function X(K,dt){for(var Tt=0;Tt<K.length;Tt++)dt.writeDouble(K[Tt])}function H(K,dt){for(var Tt=0;Tt<K.length;Tt++)dt.writeBoolean(K[Tt])}function $(K,dt){for(var Tt=0;Tt<K.length;Tt++)dt.writeFixed32(K[Tt])}function Y(K,dt){for(var Tt=0;Tt<K.length;Tt++)dt.writeSFixed32(K[Tt])}function ct(K,dt){for(var Tt=0;Tt<K.length;Tt++)dt.writeFixed64(K[Tt])}function rt(K,dt){for(var Tt=0;Tt<K.length;Tt++)dt.writeSFixed64(K[Tt])}function nt(K,dt){return(K[dt]|K[dt+1]<<8|K[dt+2]<<16)+K[dt+3]*16777216}function Ot(K,dt,Tt){K[Tt]=dt,K[Tt+1]=dt>>>8,K[Tt+2]=dt>>>16,K[Tt+3]=dt>>>24}function Kt(K,dt){return(K[dt]|K[dt+1]<<8|K[dt+2]<<16)+(K[dt+3]<<24)}function ft(K,dt,Tt){for(var ue="",Rt=dt;Rt<Tt;){var Ft=K[Rt],Gt=null,se=Ft>239?4:Ft>223?3:Ft>191?2:1;if(Rt+se>Tt)break;var le,de,ye;se===1?Ft<128&&(Gt=Ft):se===2?(le=K[Rt+1],(le&192)===128&&(Gt=(Ft&31)<<6|le&63,Gt<=127&&(Gt=null))):se===3?(le=K[Rt+1],de=K[Rt+2],(le&192)===128&&(de&192)===128&&(Gt=(Ft&15)<<12|(le&63)<<6|de&63,(Gt<=2047||Gt>=55296&&Gt<=57343)&&(Gt=null))):se===4&&(le=K[Rt+1],de=K[Rt+2],ye=K[Rt+3],(le&192)===128&&(de&192)===128&&(ye&192)===128&&(Gt=(Ft&15)<<18|(le&63)<<12|(de&63)<<6|ye&63,(Gt<=65535||Gt>=1114112)&&(Gt=null))),Gt===null?(Gt=65533,se=1):Gt>65535&&(Gt-=65536,ue+=String.fromCharCode(Gt>>>10&1023|55296),Gt=56320|Gt&1023),ue+=String.fromCharCode(Gt),Rt+=se}return ue}function st(K,dt,Tt){return o.decode(K.subarray(dt,Tt))}function Ut(K,dt,Tt){for(var ue=0,Rt,Ft;ue<dt.length;ue++){if(Rt=dt.charCodeAt(ue),Rt>55295&&Rt<57344)if(Ft)if(Rt<56320){K[Tt++]=239,K[Tt++]=191,K[Tt++]=189,Ft=Rt;continue}else Rt=Ft-55296<<10|Rt-56320|65536,Ft=null;else{Rt>56319||ue+1===dt.length?(K[Tt++]=239,K[Tt++]=191,K[Tt++]=189):Ft=Rt;continue}else Ft&&(K[Tt++]=239,K[Tt++]=191,K[Tt++]=189,Ft=null);Rt<128?K[Tt++]=Rt:(Rt<2048?K[Tt++]=Rt>>6|192:(Rt<65536?K[Tt++]=Rt>>12|224:(K[Tt++]=Rt>>18|240,K[Tt++]=Rt>>12&63|128),K[Tt++]=Rt>>6&63|128),K[Tt++]=Rt&63|128)}return Tt}return J1}var wAt=xAt();const EAt=df(wAt),CAt="4.3.3",Z5={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:CAt,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...Z5});const TAt={Point:Y5,MultiPoint:SAt,LineString:Q5,MultiLineString:PAt,Polygon:J5,MultiPolygon:IAt};function Y5([i,t],[e,n],r){const o=gl(e[0],n[0],i),s=gl(e[1],n[1],t);return r.unprojectFlat([o,s])}function t3(i,t,e){return i.map(n=>Y5(n,t,e))}function SAt(i,t,e){return t3(i,t,e)}function Q5(i,t,e){return t3(i,t,e)}function PAt(i,t,e){return i.map(n=>Q5(n,t,e))}function J5(i,t,e){return i.map(n=>t3(n,t,e))}function IAt(i,t,e){return i.map(n=>J5(n,t,e))}function MAt(i,t,e){const n=e.projectFlat([t.west,t.north]),r=e.projectFlat([t.east,t.south]),o=[n,r];return{...i,coordinates:TAt[i.type](i.coordinates,o,e)}}const BAt=["points","lines","polygons"];function RAt(i,t,e,n){for(const r of BAt){const o=i[r]&&LAt(i[r],t,e,n);if(o>=0)return o}return-1}function LAt(i,t,e,n){const r=i.featureIds.value;if(!r.length)return-1;let o=0,s=r[r.length-1]+1;if(n){const c=DAt(i,n);if(c)o=c[0],s=c[1]+1;else return-1}let l=-1;if(t in i.numericProps){const c=i.numericProps[t].value.findIndex((y,_)=>y===e&&r[_]>=o&&r[_]<s);return c>=0?i.globalFeatureIds.value[c]:-1}else t?l=VM(i.properties,c=>c[t]===e,o,s):i.fields&&(l=VM(i.fields,c=>c.id===e,o,s));return l>=0?kAt(i,l):-1}function DAt(i,t){if(!i.__layers){const e={},{properties:n}=i;for(let r=0;r<n.length;r++){const{layerName:o}=n[r];o&&(e[o]?e[o][1]=r:e[o]=[r,r])}i.__layers=e}return i.__layers[t]}function kAt(i,t){if(!i.__ids){const e=[],n=i.featureIds.value,r=i.globalFeatureIds.value;for(let o=0;o<n.length;o++)e[n[o]]=r[o];i.__ids=e}return i.__ids[t]}function VM(i,t,e,n){for(let r=e;r<n;r++)if(t(i[r],r))return r;return-1}const $1=512,OAt={...rc.defaultProps,data:gy,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[Z5],binary:!0};class Fp extends oc{initializeState(){super.initializeState();const t=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:t,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:t,oldProps:e,context:n,changeFlags:r}){r.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:t,oldProps:e,context:n,changeFlags:r}),this._setWGS84PropertyForTiles());const{highlightColor:o}=t;o!==e.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let t=this.props.data,e=null;if(typeof t=="string"&&!Aht(t)){const{onDataLoad:n,fetch:r}=this.props;this.setState({data:null,tileJSON:null});try{e=await r(t,{propName:"data",layer:this,loaders:[]})}catch(o){this.raiseError(o,"loading TileJSON"),t=null}n&&n(e,{propName:"data",layer:this})}else t&&typeof t=="object"&&"tilejson"in t&&(e=t);e&&(t=e.tiles),this.setState({data:t,tileJSON:e})}_getTilesetOptions(){const t=super._getTilesetOptions(),e=this.state.tileJSON,{minZoom:n,maxZoom:r}=this.props;return e&&(Number.isFinite(e.minzoom)&&e.minzoom>n&&(t.minZoom=e.minzoom),Number.isFinite(e.maxzoom)&&(!Number.isFinite(r)||e.maxzoom<r)&&(t.maxZoom=e.maxzoom)),t}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(t){const{data:e,binary:n}=this.state,{index:r,signal:o}=t,s=uf(e,t);if(!s)return Promise.reject("Invalid URL");let l=this.getLoadOptions();const{fetch:c}=this.props;return l={...l,mimeType:"application/x-protobuf",mvt:{...l?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:r},gis:n?{format:"binary"}:{}},c(s,{propName:"data",layer:this,loadOptions:l,signal:o})}renderSubLayers(t){const{x:e,y:n,z:r}=t.tile.index,o=Math.pow(2,r),s=$1/o,l=-s,c=$1*e/o,y=$1*(1-n/o),_=new bn().scale([s,l,1]);t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=_,t.coordinateOrigin=[c,y,0],t.coordinateSystem=nn.CARTESIAN,t.extensions=[...t.extensions||[],new dv]);const C=super.renderSubLayers(t);return this.state.binary&&!(C instanceof rc)&&$i.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),C}_updateAutoHighlight(t){const{uniqueIdProperty:e}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:r}=this.state,o=t.object;let s=null,l=null;o&&(s=tb(o,e),l=GM(o));let{highlightColor:c}=this.props;typeof c=="function"&&(c=c(t)),(n!==s||r!==l)&&this.setState({highlightColor:c,hoveredFeatureId:s,hoveredFeatureLayerName:l})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(t){const e=super.getPickingInfo(t);if(this.state.binary&&e.index!==-1){const{data:n}=t.sourceLayer.props;e.object=k2(n,{globalFeatureId:e.index})}return e.object&&!this._isWGS84()&&(e.object=WM(e.object,e.tile.bbox,this.context.viewport)),e}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:e,hoveredFeatureLayerName:n,binary:r}=this.state,{uniqueIdProperty:o,highlightedFeatureId:s}=this.props,l=t.content,c=jM(s);if(!(jM(e)||c))return-1;const y=c?s:e;return Array.isArray(l)?l.findIndex(_=>{const C=tb(_,o)===y,I=c||GM(_)===n;return C&&I}):l&&r?RAt(l,o,y,c?"":n):-1}_pickObjects(t){const{deck:e,viewport:n}=this.context,r=n.width,o=n.height,s=n.x,l=n.y,c=[this.id];return e.pickObjects({x:s,y:l,width:r,height:o,layerIds:c,maxObjects:t})}getRenderedFeatures(t=null){const e=this._pickObjects(t),n=new Set,r=[];for(const o of e){const s=tb(o.object,this.props.uniqueIdProperty);s===void 0?r.push(o.object):n.has(s)||(n.add(s),r.push(o.object))}return r}_setWGS84PropertyForTiles(){const t="dataInWGS84";this.state.tileset.selectedTiles.forEach(e=>{e.hasOwnProperty(t)||Object.defineProperty(e,t,{get:()=>{if(!e.content)return null;if(this.state.binary&&Array.isArray(e.content)&&!e.content.length)return[];const{bbox:n}=e;if(e._contentWGS84===void 0&&mht(n)){const r=this.state.binary?k2(e.content):e.content;e._contentWGS84=r.map(o=>WM(o,n,this.context.viewport))}return e._contentWGS84}})})}}Fp.layerName="MVTLayer";Fp.defaultProps=OAt;function tb(i,t){if(i.properties&&t)return i.properties[t];if("id"in i)return i.id}function GM(i){return i.properties?.layerName||null}function jM(i){return i!=null&&i!==""}function WM(i,t,e){const n={...i,geometry:{type:i.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>MAt(i.geometry,t,e).coordinates}),n}const HM="0123456789bcdefghjkmnpqrstuvwxyz",$5={};for(let i=0;i<HM.length;i++)$5[HM.charAt(i)]=i;const FAt=-90,NAt=90,zAt=-180,UAt=180;function VAt(i){let t=!0,e=NAt,n=FAt,r=UAt,o=zAt,s,l=0;for(let c=0,y=i.length;c<y;c++){const _=i[c].toLowerCase();l=$5[_];for(let C=4;C>=0;C--){const I=l>>C&1;t?(s=(r+o)/2,I===1?o=s:r=s):(s=(e+n)/2,I===1?n=s:e=s),t=!t}}return[n,o,e,r]}function GAt(i){const[t,e,n,r]=VAt(i);return[r,n,r,t,e,t,e,n,r,n]}const jAt={getGeohash:{type:"accessor",value:i=>i.geohash}};class pv extends sc{indexToBounds(){const{data:t,getGeohash:e}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(n,r)=>GAt(e(n,r))}}}pv.layerName="GeohashLayer";pv.defaultProps=jAt;const WAt=Object.freeze(Object.defineProperty({__proto__:null,A5Layer:Rw,GeohashLayer:pv,GreatCircleLayer:Ow,H3ClusterLayer:uv,H3HexagonLayer:pu,MVTLayer:Fp,QuadkeyLayer:sv,S2Layer:rv,TerrainLayer:Jw,Tile3DLayer:Qw,TileLayer:oc,TripsLayer:lv,_GeoCellLayer:sc,_Tile2DHeader:n5,_Tileset2D:av,_WMSLayer:kw,_getURLFromTemplate:uf},Symbol.toStringTag,{value:"Module"}));function HAt({pointCount:i,getBinId:t}){const e=new Map;for(let n=0;n<i;n++){const r=t(n);if(r===null)continue;let o=e.get(String(r));o?o.points.push(n):(o={id:r,index:e.size,points:[n]},e.set(String(r),o))}return Array.from(e.values())}function XAt({bins:i,dimensions:t,target:e}){const n=i.length*t;(!e||e.length<n)&&(e=new Float32Array(n));for(let r=0;r<i.length;r++){const{id:o}=i[r];Array.isArray(o)?e.set(o,r*t):e[r]=o}return e}const qAt=i=>i.length,tk=(i,t)=>{let e=0;for(const n of i)e+=t(n);return e},KAt=(i,t)=>i.length===0?NaN:tk(i,t)/i.length,ZAt=(i,t)=>{let e=1/0;for(const n of i){const r=t(n);r<e&&(e=r)}return e},YAt=(i,t)=>{let e=-1/0;for(const n of i){const r=t(n);r>e&&(e=r)}return e},QAt={COUNT:qAt,SUM:tk,MEAN:KAt,MIN:ZAt,MAX:YAt};function JAt({bins:i,getValue:t,operation:e,target:n}){(!n||n.length<i.length)&&(n=new Float32Array(i.length));let r=1/0,o=-1/0;for(let s=0;s<i.length;s++){const{points:l}=i[s];n[s]=e(l,t),n[s]<r&&(r=n[s]),n[s]>o&&(o=n[s])}return{value:n,domain:[r,o]}}function XM(i,t,e){const n={};for(const o of i.sources||[]){const s=t[o];if(s)n[o]=$At(s);else throw new Error(`Cannot find attribute ${o}`)}const r={};return o=>{for(const s in n)r[s]=n[s](o);return i.getValue(r,o,e)}}function $At(i){const t=i.value,{offset:e=0,stride:n,size:r}=i.getAccessor(),o=t.BYTES_PER_ELEMENT,s=e/o,l=n?n/o:r;if(r===1)return i.isConstant?()=>t[0]:y=>{const _=s+l*y;return t[_]};let c;return i.isConstant?(c=Array.from(t),()=>c):(c=new Array(r),y=>{const _=s+l*y;for(let C=0;C<r;C++)c[C]=t[_+C];return c})}class Np{constructor(t){this.bins=[],this.binIds=null,this.results=[],this.dimensions=t.dimensions,this.channelCount=t.getValue.length,this.props={...t,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(t)}destroy(){}get binCount(){return this.bins.length}setProps(t){const e=this.props;if(t.binOptions&&(Or(t.binOptions,e.binOptions,2)||this.setNeedsUpdate()),t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==e.operations[n]&&this.setNeedsUpdate(n);if(t.customOperations)for(let n=0;n<this.channelCount;n++)!!t.customOperations[n]!=!!e.customOperations[n]&&this.setNeedsUpdate(n);t.pointCount!==void 0&&t.pointCount!==e.pointCount&&this.setNeedsUpdate(),t.attributes&&(t.attributes={...e.attributes,...t.attributes}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[t]=!0)}update(){if(this.needsUpdate===!0){this.bins=HAt({pointCount:this.props.pointCount,getBinId:XM(this.props.getBin,this.props.attributes,this.props.binOptions)});const t=XAt({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:t,type:"float32",size:this.dimensions}}for(let t=0;t<this.channelCount;t++)if(this.needsUpdate===!0||this.needsUpdate[t]){const e=this.props.customOperations[t]||QAt[this.props.operations[t]],{value:n,domain:r}=JAt({bins:this.bins,getValue:XM(this.props.getValue[t],this.props.attributes,void 0),operation:e,target:this.results[t]?.value});this.results[t]={value:n,domain:r,type:"float32",size:1},this.props.onUpdate?.({channel:t})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(t){return this.results[t]}getResultDomain(t){return this.results[t]?.domain??[1/0,-1/0]}getBin(t){const e=this.bins[t];if(!e)return null;const n=new Array(this.channelCount);for(let r=0;r<n.length;r++){const o=this.results[r];n[r]=o?.value[t]}return{id:e.id,value:n,count:e.points.length,pointIndices:e.points}}}function ek(i,t,e){return i.createFramebuffer({width:t,height:e,colorAttachments:[i.createTexture({width:t,height:e,format:"rgba32float",sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const tmt=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,emt={name:"binSorter",vs:tmt,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},ik=[1,2,4,8],qM=3e38,imt={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},kg=1024;class nmt{constructor(t,e){this.binsFBO=null,this.device=t,this.model=smt(t,e)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(t){if(!this.binsFBO)return null;const e=t%kg,n=Math.floor(t/kg),r=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:e,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(r)}setDimensions(t,e){const n=kg,r=Math.ceil(t/n);this.binsFBO?this.binsFBO.height<r&&this.binsFBO.resize({width:n,height:r}):this.binsFBO=ek(this.device,n,r);const o={binIdRange:[e[0][0],e[0][1],e[1]?.[0]||0,e[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:o})}setModelProps(t){const e=this.model;t.attributes&&e.setAttributes(t.attributes),t.constantAttributes&&e.setConstantAttributes(t.constantAttributes),t.vertexCount!==void 0&&e.setVertexCount(t.vertexCount),t.shaderModuleProps&&e.shaderInputs.setProps(t.shaderModuleProps)}update(t){if(!this.binsFBO)return;const e=rmt(t);this._updateBins("SUM",e.SUM+e.MEAN),this._updateBins("MIN",e.MIN),this._updateBins("MAX",e.MAX)}_updateBins(t,e){if(e===0)return;e|=ik[3];const n=this.model,r=this.binsFBO,o=t==="MAX"?-qM:t==="MIN"?qM:0,s=this.device.beginRenderPass({id:`gpu-aggregation-${t}`,framebuffer:r,parameters:{viewport:[0,0,r.width,r.height],colorMask:e},clearColor:[o,o,o,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:t==="MAX"?"max":t==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(s),s.end()}}function rmt(i){const t={...imt};for(let e=0;e<i.length;e++){const n=i[e];n&&(t[n]+=ik[e])}return t}function smt(i,t){let e=t.vs;t.dimensions===2&&(e+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${e}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,r=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Rr(i,{bufferLayout:t.bufferLayout,modules:[...t.modules||[],emt],defines:{...t.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:t.channelCount},isInstanced:!1,vs:n,fs:r,topology:"point-list",disableWarnings:!0})}const omt=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,amt={name:"aggregatorTransform",vs:omt,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class lmt{constructor(t,e){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=t,this.channelCount=e.channelCount,this.transform=umt(t,e),this.domainFBO=ek(t,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const t=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,e=new Float32Array(t);this._domains=[[-e[4],e[0]],[-e[5],e[1]],[-e[6],e[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(t,e){const{model:n,transformFeedback:r}=this.transform;n.setVertexCount(t);const o={binIdRange:[e[0][0],e[0][1],e[1]?.[0]||0,e[1]?.[1]||0]};n.shaderInputs.setProps({aggregatorTransform:o});const s=t*e.length*4;(!this.binBuffer||this.binBuffer.byteLength<s)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:s}),r.setBuffer("binIds",this.binBuffer));const l=t*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<l)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:l}),r.setBuffer("values",this.valueBuffer))}update(t,e){if(!t)return;const n=this.transform,r=this.domainFBO,o=[0,1,2].map(c=>e[c]==="COUNT"?1:0),s=[0,1,2].map(c=>e[c]==="MEAN"?1:0),l={isCount:o,isMean:s,bins:t};n.model.shaderInputs.setProps({aggregatorTransform:l}),n.run({id:"gpu-aggregation-domain",framebuffer:r,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function umt(i,t){const e=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new rf(i,{vs:e,fs:n,topology:"point-list",modules:[amt],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:t.dimensions,NUM_CHANNELS:t.channelCount,SAMPLER_WIDTH:kg},varyings:["binIds","values"],disableWarnings:!0})}class ka{static isSupported(t){return t.features.has("float32-renderable-webgl")&&t.features.has("texture-blend-float-webgl")}constructor(t,e){this.binCount=0,this.binIds=null,this.results=[],this.device=t,this.dimensions=e.dimensions,this.channelCount=e.channelCount,this.props={...e,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new nmt(t,e),this.aggregationTransform=new lmt(t,e),this.setProps(e)}getBins(){const t=this.aggregationTransform.binBuffer;return t?(this.binIds?.buffer!==t&&(this.binIds={buffer:t,type:"float32",size:this.dimensions}),this.binIds):null}getResult(t){const e=this.aggregationTransform.valueBuffer;return!e||t>=this.channelCount?null:(this.results[t]?.buffer!==e&&(this.results[t]={buffer:e,type:"float32",size:1,stride:this.channelCount*4,offset:t*4}),this.results[t])}getResultDomain(t){return this.aggregationTransform.domains[t]}getBin(t){if(t<0||t>=this.binCount)return null;const{binIdRange:e}=this.props;let n;if(this.dimensions===1)n=[t+e[0][0]];else{const[[l,c],[y]]=e,_=c-l;n=[t%_+l,Math.floor(t/_)+y]}const r=this.binSorter.getBinValues(t);if(!r)return null;const o=r[3],s=[];for(let l=0;l<this.channelCount;l++){const c=this.props.operations[l];c==="COUNT"?s[l]=o:o===0?s[l]=NaN:s[l]=c==="MEAN"?r[l]/o:r[l]}return{id:n,value:s,count:o}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(t){const e=this.props;if("binIdRange"in t&&!Or(t.binIdRange,e.binIdRange,2)){const n=t.binIdRange;if($i.assert(n.length===this.dimensions),this.dimensions===1){const[[r,o]]=n;this.binCount=o-r}else{const[[r,o],[s,l]]=n;this.binCount=(o-r)*(l-s)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==e.operations[n]&&this.setNeedsUpdate(n);if(t.pointCount!==void 0&&t.pointCount!==e.pointCount&&(this.binSorter.setModelProps({vertexCount:t.pointCount}),this.setNeedsUpdate()),t.binOptions&&(Or(t.binOptions,e.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:t.binOptions})),t.attributes){const n={},r={};for(const o of Object.values(t.attributes))for(const[s,l]of Object.entries(o.getValue()))ArrayBuffer.isView(l)?r[s]=l:l&&(n[s]=l);this.binSorter.setModelProps({attributes:n,constantAttributes:r})}t.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:t.shaderModuleProps}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate.fill(!0):this.needsUpdate[t]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;const{operations:t}=this.props,e=this.needsUpdate.map((n,r)=>n?t[r]:null);this.binSorter.update(e),this.aggregationTransform.update(this.binSorter.texture,t);for(let n=0;n<this.channelCount;n++)this.needsUpdate[n]&&(this.needsUpdate[n]=!1,this.props.onUpdate?.({channel:n}))}}let zp=class extends Is{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(i){super.updateState(i);const t=this.getAggregatorType();if(i.changeFlags.extensionsChanged||this.state.aggregatorType!==t){this.state.aggregator?.destroy();const e=this.createAggregator(t);return e.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:e,aggregatorType:t}),!0}return!1}finalizeState(i){super.finalizeState(i),this.state.aggregator.destroy()}updateAttributes(i){const{aggregator:t}=this.state;t.setProps({attributes:i});for(const e in i)this.onAttributeChange(e);t.update()}draw({shaderModuleProps:i}){const{aggregator:t}=this.state;t.setProps({shaderModuleProps:i}),t.preDraw()}_getAttributeManager(){return new Fy(this.context.device,{id:this.props.id,stats:this.context.stats})}};zp.layerName="AggregationLayer";const Av=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function nk(i,t=!1,e=Float32Array){let n;if(Number.isFinite(i[0]))n=new e(i);else{n=new e(i.length*4);let r=0;for(let o=0;o<i.length;o++){const s=i[o];n[r++]=s[0],n[r++]=s[1],n[r++]=s[2],n[r++]=Number.isFinite(s[3])?s[3]:255}}if(t)for(let r=0;r<n.length;r++)n[r]/=255;return n}const by={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function e3(i,t){i.setSampler({minFilter:by[t],magFilter:by[t]})}function i3(i,t,e="linear"){const n=nk(t,!1,Uint8Array);return i.createTexture({format:"rgba8unorm",sampler:{minFilter:by[e],magFilter:by[e],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}const cmt=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`,hmt=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,fmt=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,dmt={name:"screenGrid",vs:fmt,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};class rk extends Ps{getShaders(){return super.getShaders({vs:cmt,fs:hmt,modules:[ma,dmt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:r}=t,o=this.state.model;if(n.colorRange!==e.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=i3(this.context.device,e.colorRange,e.colorScaleType);const s={colorRange:this.state.colorTexture};o.shaderInputs.setProps({screenGrid:s})}else n.colorScaleType!==e.colorScaleType&&e3(this.state.colorTexture,e.colorScaleType);if(n.cellMarginPixels!==e.cellMarginPixels||n.cellSizePixels!==e.cellSizePixels||r.viewportChanged){const{width:s,height:l}=this.context.viewport,{cellSizePixels:c,cellMarginPixels:y}=this.props,_=Math.max(c-y,0),C={gridSizeClipspace:[c/s*2,c/l*2],cellSizeClipspace:[_/s*2,_/l*2]};o.shaderInputs.setProps({screenGrid:C})}}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}draw({uniforms:t}){const e=this.props.colorDomain(),n=this.state.model,r={colorDomain:e};n.shaderInputs.setProps({screenGrid:r}),n.draw(this.context.renderPass)}_getModel(){return new Rr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new no({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}}rk.layerName="ScreenGridCellLayer";const pmt=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,Amt={name:"binOptions",vs:pmt,uniformTypes:{cellSizePixels:"f32"}},mmt={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:Av,colorScaleType:"linear",getPosition:{type:"accessor",value:i=>i.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"};class n3 extends zp{getAggregatorType(){return this.props.gpuAggregation&&ka.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){return t==="cpu"||!ka.isSupported(this.context.device)?new Np({dimensions:2,getBin:{sources:["positions"],getValue:({positions:e},n,r)=>{const o=this.context.viewport,s=o.project(e),l=r.cellSizePixels;return s[0]<0||s[0]>=o.width||s[1]<0||s[1]>=o.height?null:[Math.floor(s[0]/l),Math.floor(s[1]/l)]}},getValue:[{sources:["counts"],getValue:({counts:e})=>e}]}):new ka(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Hs,Amt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){const e=super.updateState(t),{props:n,oldProps:r,changeFlags:o}=t,{cellSizePixels:s,aggregation:l}=n;if(e||o.dataChanged||o.updateTriggersChanged||o.viewportChanged||l!==r.aggregation||s!==r.cellSizePixels){const{width:c,height:y}=this.context.viewport,{aggregator:_}=this.state;_ instanceof ka&&_.setProps({binIdRange:[[0,Math.ceil(c/s)],[0,Math.ceil(y/s)]]}),_.setProps({pointCount:this.getNumInstances(),operations:[l],binOptions:{cellSizePixels:s}})}return o.viewportChanged&&this.state.aggregator.setNeedsUpdate(),e}onAttributeChange(t){const{aggregator:e}=this.state;switch(t){case"positions":e.setNeedsUpdate();break;case"counts":e.setNeedsUpdate(0);break}}renderLayers(){const{aggregator:t}=this.state,e=this.getSubLayerClass("cells",rk),n=t.getBins(),r=t.getResult(0);return new e(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:t.binCount,attributes:{getBin:n,getWeight:r}},dataComparator:(o,s)=>o.length===s.length,updateTriggers:{getBin:[n],getWeight:[r]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||t.getResultDomain(0),extensions:[]})}getPickingInfo(t){const e=t.info,{index:n}=e;if(n>=0){const r=this.state.aggregator.getBin(n);let o;r&&(o={col:r.id[0],row:r.id[1],value:r.value[0],count:r.count},r.pointIndices&&(o.pointIndices=r.pointIndices,o.points=Array.isArray(this.props.data)?r.pointIndices.map(s=>this.props.data[s]):[])),e.object=o}return e}}n3.layerName="ScreenGridLayer";n3.defaultProps=mmt;class xy{constructor(t,e){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=t,this.inputLength=e,this.attribute=t}getScalePercentile(){if(!this._percentile){const t=KM(this.input,this.inputLength);this._percentile=ymt(t)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const t=KM(this.input,this.inputLength);this._ordinal=gmt(t)}return this._ordinal}getCutoff({scaleType:t,lowerPercentile:e,upperPercentile:n}){if(t==="quantile")return[e,n-1];if(e>0||n<100){const{domain:r}=this.getScalePercentile();let o=r[Math.floor(e)-1]??-1/0,s=r[Math.floor(n)-1]??1/0;if(t==="ordinal"){const{domain:l}=this.getScaleOrdinal();o=l.findIndex(c=>c>=o),s=l.findIndex(c=>c>s)-1,s===-2&&(s=l.length-1)}return[o,s]}return null}update(t){const e=this.props;if(t.scaleType!==e.scaleType)switch(t.scaleType){case"quantile":{const{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{const{attribute:n,domain:r}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,r.length-1];break}default:this.attribute=this.input,this.domain=null}return(t.scaleType!==e.scaleType||t.lowerPercentile!==e.lowerPercentile||t.upperPercentile!==e.upperPercentile)&&(this.cutoff=this.getCutoff(t)),this.props=t,this}}function gmt(i){const t=new Set;for(const r of i)Number.isFinite(r)&&t.add(r);const e=Array.from(t).sort(),n=new Map;for(let r=0;r<e.length;r++)n.set(e[r],r);return{attribute:{value:i.map(r=>Number.isFinite(r)?n.get(r):NaN),type:"float32",size:1},domain:e}}function ymt(i,t=100){const e=Array.from(i).filter(Number.isFinite).sort(vmt);let n=0;const r=Math.max(1,t),o=new Array(r-1);for(;++n<r;)o[n-1]=_mt(e,n/r);return{attribute:{value:i.map(s=>Number.isFinite(s)?bmt(o,s):NaN),type:"float32",size:1},domain:o}}function KM(i,t){const e=(i.stride??4)/4,n=(i.offset??0)/4;let r=i.value;if(!r){const s=i.buffer?.readSyncWebGL(0,e*4*t);s&&(r=new Float32Array(s.buffer),i.value=r)}if(e===1)return r.subarray(0,t);const o=new Float32Array(t);for(let s=0;s<t;s++)o[s]=r[s*e+n];return o}function vmt(i,t){return i-t}function _mt(i,t){const e=i.length;if(t<=0||e<2)return i[0];if(t>=1)return i[e-1];const n=(e-1)*t,r=Math.floor(n),o=i[r],s=i[r+1];return o+(s-o)*(n-r)}function bmt(i,t){let e=0,n=i.length;for(;e<n;){const r=e+n>>>1;i[r]>t?n=r:e=r+1}return e}function r3({dataBounds:i,getBinId:t,padding:e=0}){const n=[i[0],i[1],[i[0][0],i[1][1]],[i[1][0],i[0][1]]].map(c=>t(c)),r=Math.min(...n.map(c=>c[0]))-e,o=Math.min(...n.map(c=>c[1]))-e,s=Math.max(...n.map(c=>c[0]))+e+1,l=Math.max(...n.map(c=>c[1]))+e+1;return[[r,s],[o,l]]}const sk=Math.PI/3,mv=2*Math.sin(sk),gv=1.5,xmt=Array.from({length:6},(i,t)=>{const e=t*sk;return[Math.sin(e),-Math.cos(e)]});function eb([i,t],e){let n=Math.round(t=t/e/gv),r=Math.round(i=i/e/mv-(n&1)/2);const o=t-n;if(Math.abs(o)*3>1){const s=i-r,l=r+(i<r?-1:1)/2,c=n+(t<n?-1:1),y=i-l,_=t-c;s*s+o*o>y*y+_*_&&(r=l+(n&1?1:-1)/2,n=c)}return[r,n]}const wmt=`
const vec2 DIST = vec2(${mv}, ${gv});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function ZM([i,t],e){return[(i+(t&1)/2)*e*mv,t*e*gv]}const Emt=`
const vec2 DIST = vec2(${mv}, ${gv});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,Cmt=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${Emt}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Tmt=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,Smt={name:"hexagon",vs:Tmt,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class ok extends du{getShaders(){const t=super.getShaders();return t.modules.push(Smt),{...t,vs:Cmt}}initializeState(){super.initializeState();const t=this.getAttributeManager();t.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),t.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t,r=this.state.fillModel;if(n.colorRange!==e.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=i3(this.context.device,e.colorRange,e.colorScaleType);const o={colorRange:this.state.colorTexture};r.shaderInputs.setProps({hexagon:o})}else n.colorScaleType!==e.colorScaleType&&e3(this.state.colorTexture,e.colorScaleType)}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}draw({uniforms:t}){const{radius:e,hexOriginCommon:n,elevationRange:r,elevationScale:o,extruded:s,coverage:l,colorDomain:c,elevationDomain:y}=this.props,_=this.props.colorCutoff||[-1/0,1/0],C=this.props.elevationCutoff||[-1/0,1/0],I=this.state.fillModel;I.vertexArray.indexBuffer&&I.setIndexBuffer(null),I.setVertexCount(this.state.fillVertexCount);const k={colorDomain:[Math.max(c[0],_[0]),Math.min(c[1],_[1]),Math.max(c[0]-1,_[0]),Math.min(c[1]+1,_[1])],elevationDomain:[Math.max(y[0],C[0]),Math.min(y[1],C[1]),Math.max(y[0]-1,C[0]),Math.min(y[1]+1,C[1])],elevationRange:[r[0]*o,r[1]*o],originCommon:n};I.shaderInputs.setProps({column:{extruded:s,coverage:l,radius:e},hexagon:k}),I.draw(this.context.renderPass)}}ok.layerName="HexagonCellLayer";const Pmt=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,Imt={name:"binOptions",vs:Pmt,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function YM(){}const Mmt={gpuAggregation:!0,colorDomain:null,colorRange:Av,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:YM,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:YM,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:i=>i.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class s3 extends zp{getAggregatorType(){const{gpuAggregation:t,hexagonAggregator:e,getColorValue:n,getElevationValue:r}=this.props;return t&&(e||n||r)?($i.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):t&&ka.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){if(t==="cpu"){const{hexagonAggregator:e,radius:n}=this.props;return new Np({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},o,s)=>{if(e)return e(r,n);const l=this.state.aggregatorViewport.projectPosition(r),{radiusCommon:c,hexOriginCommon:y}=s;return eb([l[0]-y[0],l[1]-y[1]],c)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:r})=>r},{sources:["elevationWeights"],getValue:({elevationWeights:r})=>r}]})}return new ka(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Hs,Imt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${wmt}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(t){const e=super.updateState(t),{props:n,oldProps:r,changeFlags:o}=t,{aggregator:s}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(fu(n.data).iterable)),e||o.dataChanged||n.radius!==r.radius||n.getColorValue!==r.getColorValue||n.getElevationValue!==r.getElevationValue||n.colorAggregation!==r.colorAggregation||n.elevationAggregation!==r.elevationAggregation){this._updateBinOptions();const{radiusCommon:l,hexOriginCommon:c,binIdRange:y,dataAsArray:_}=this.state;if(s.setProps({binIdRange:y,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:l,hexOriginCommon:c},onUpdate:this._onAggregationUpdate.bind(this)}),_){const{getColorValue:C,getElevationValue:I}=this.props;s.setProps({customOperations:[C&&(k=>C(k.map(z=>_[z]),{indices:k,data:n.data})),I&&(k=>I(k.map(z=>_[z]),{indices:k,data:n.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&s.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&s.setNeedsUpdate(1),e}_updateBinOptions(){const t=this.getBounds();let e=1,n=[0,0],r=[[0,1],[0,1]],o=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let s=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2];const{radius:l}=this.props,{unitsPerMeter:c}=o.getDistanceScales(s);e=c[0]*l;const y=eb(o.projectFlat(s),e);s=o.unprojectFlat(ZM(y,e));const _=o.constructor;o=o.isGeospatial?new _({longitude:s[0],latitude:s[1],zoom:12}):new ec({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],r=r3({dataBounds:t,getBinId:C=>{const I=o.projectFlat(C);return I[0]-=n[0],I[1]-=n[1],eb(I,e)},padding:1})}this.setState({radiusCommon:e,hexOriginCommon:n,binIdRange:r,aggregatorViewport:o})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate({channel:t}){const e=this.getCurrentLayer().props,{aggregator:n}=this.state;if(t===0){const r=n.getResult(0);this.setState({colors:new xy(r,n.binCount)}),e.onSetColorDomain(n.getResultDomain(0))}else if(t===1){const r=n.getResult(1);this.setState({elevations:new xy(r,n.binCount)}),e.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(t){const{aggregator:e}=this.state;switch(t){case"positions":e.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:n,hexOriginCommon:r,binIdRange:o}=this.state;e.setProps({binIdRange:o,binOptions:{radiusCommon:n,hexOriginCommon:r}});break;case"colorWeights":e.setNeedsUpdate(0);break;case"elevationWeights":e.setNeedsUpdate(1);break}}renderLayers(){const{aggregator:t,radiusCommon:e,hexOriginCommon:n}=this.state,{elevationScale:r,colorRange:o,elevationRange:s,extruded:l,coverage:c,material:y,transitions:_,colorScaleType:C,lowerPercentile:I,upperPercentile:k,colorDomain:z,elevationScaleType:V,elevationLowerPercentile:X,elevationUpperPercentile:H,elevationDomain:$}=this.props,Y=this.getSubLayerClass("cells",ok),ct=t.getBins(),rt=this.state.colors?.update({scaleType:C,lowerPercentile:I,upperPercentile:k}),nt=this.state.elevations?.update({scaleType:V,lowerPercentile:X,upperPercentile:H});return!rt||!nt?null:new Y(this.getSubLayerProps({id:"cells"}),{data:{length:t.binCount,attributes:{getBin:ct,getColorValue:rt.attribute,getElevationValue:nt.attribute}},dataComparator:(Ot,Kt)=>Ot.length===Kt.length,updateTriggers:{getBin:[ct],getColorValue:[rt.attribute],getElevationValue:[nt.attribute]},diskResolution:6,vertices:xmt,radius:e,hexOriginCommon:n,elevationScale:r,colorRange:o,colorScaleType:C,elevationRange:s,extruded:l,coverage:c,material:y,colorDomain:rt.domain||z||t.getResultDomain(0),elevationDomain:nt.domain||$||t.getResultDomain(1),colorCutoff:rt.cutoff,elevationCutoff:nt.cutoff,transitions:_&&{getFillColor:_.getColorValue||_.getColorWeight,getElevation:_.getElevationValue||_.getElevationWeight},extensions:[]})}getPickingInfo(t){const e=t.info,{index:n}=e;if(n>=0){const r=this.state.aggregator.getBin(n);let o;if(r){const s=ZM(r.id,this.state.radiusCommon),l=this.context.viewport.unprojectFlat(s);o={col:r.id[0],row:r.id[1],position:l,colorValue:r.value[0],elevationValue:r.value[1],count:r.count},r.pointIndices&&(o.pointIndices=r.pointIndices,o.points=Array.isArray(this.props.data)?r.pointIndices.map(c=>this.props.data[c]):[])}e.object=o}return e}}s3.layerName="HexagonLayer";s3.defaultProps=Mmt;const hi=.5,Mi=1/6,Te={N:[0,hi],E:[hi,0],S:[0,-hi],W:[-hi,0],NE:[hi,hi],NW:[-hi,hi],SE:[hi,-hi],SW:[-hi,-hi]},Rd=[Te.W,Te.SW,Te.S],Ld=[Te.S,Te.SE,Te.E],Dd=[Te.E,Te.NE,Te.N],kd=[Te.NW,Te.W,Te.N],Od=[[-hi,Mi],[-hi,-Mi],[-Mi,-hi],[Mi,-hi]],Fd=[[-Mi,-hi],[Mi,-hi],[hi,-Mi],[hi,Mi]],Nd=[[hi,-Mi],[hi,Mi],[Mi,hi],[-Mi,hi]],zd=[[-hi,Mi],[-hi,-Mi],[Mi,hi],[-Mi,hi]],QM=[Te.W,Te.SW,Te.SE,Te.E],JM=[Te.S,Te.SE,Te.NE,Te.N],$M=[Te.NW,Te.W,Te.E,Te.NE],tB=[Te.NW,Te.SW,Te.S,Te.N],eB=[[-hi,Mi],[-hi,-Mi],[hi,-Mi],[hi,Mi]],iB=[[-Mi,-hi],[Mi,-hi],[Mi,hi],[-Mi,hi]],Bmt=[Te.NW,Te.SW,Te.SE,Te.NE],nB=[Te.NW,Te.SW,Te.SE,Te.E,Te.N],rB=[Te.W,Te.SW,Te.SE,Te.NE,Te.N],sB=[Te.NW,Te.W,Te.S,Te.SE,Te.NE],oB=[Te.NW,Te.SW,Te.S,Te.E,Te.NE],aB=[Te.NW,Te.W,[hi,-Mi],[hi,Mi],Te.N],lB=[[-Mi,-hi],[Mi,-hi],Te.E,Te.NE,Te.N],uB=[[-hi,Mi],[-hi,-Mi],Te.S,Te.SE,Te.E],cB=[Te.W,Te.SW,Te.S,[Mi,hi],[-Mi,hi]],hB=[Te.NW,Te.W,[-Mi,-hi],[Mi,-hi],Te.N],fB=[[-hi,Mi],[-hi,-Mi],Te.E,Te.NE,Te.N],dB=[Te.S,Te.SE,Te.E,[Mi,hi],[-Mi,hi]],pB=[Te.W,Te.SW,Te.S,[hi,-Mi],[hi,Mi]],AB=[Te.W,Te.SW,Te.SE,Te.E,[Mi,hi],[-Mi,hi]],mB=[[-hi,Mi],[-hi,-Mi],Te.S,Te.SE,Te.NE,Te.N],gB=[Te.NW,Te.W,[-Mi,-hi],[Mi,-hi],Te.E,Te.NE],yB=[Te.NW,Te.SW,Te.S,[hi,-Mi],[hi,Mi],Te.N],Ud=[Te.W,Te.SW,Te.S,Te.E,Te.NE,Te.N],Vd=[Te.NW,Te.W,Te.S,Te.SE,Te.E,Te.N],og=[[-hi,Mi],[-hi,-Mi],[-Mi,-hi],[Mi,-hi],Te.E,Te.NE,Te.N],ag=[Te.W,Te.SW,Te.S,[hi,-Mi],[hi,Mi],[Mi,hi],[-Mi,hi]],lg=[Te.NW,Te.W,[-Mi,-hi],[Mi,-hi],[hi,-Mi],[hi,Mi],Te.N],ug=[[-hi,Mi],[-hi,-Mi],Te.S,Te.SE,Te.E,[Mi,hi],[-Mi,hi]],vB=[[-hi,Mi],[-hi,-Mi],[-Mi,-hi],[Mi,-hi],[hi,-Mi],[hi,Mi],[Mi,hi],[-Mi,hi]],Rmt={0:[],1:[[Te.W,Te.S]],2:[[Te.S,Te.E]],3:[[Te.W,Te.E]],4:[[Te.N,Te.E]],5:{0:[[Te.W,Te.S],[Te.N,Te.E]],1:[[Te.W,Te.N],[Te.S,Te.E]]},6:[[Te.N,Te.S]],7:[[Te.W,Te.N]],8:[[Te.W,Te.N]],9:[[Te.N,Te.S]],10:{0:[[Te.W,Te.N],[Te.S,Te.E]],1:[[Te.W,Te.S],[Te.N,Te.E]]},11:[[Te.N,Te.E]],12:[[Te.W,Te.E]],13:[[Te.S,Te.E]],14:[[Te.W,Te.S]],15:[]};function Ai(i){return parseInt(i,4)}const Lmt={[Ai("0000")]:[],[Ai("2222")]:[],[Ai("2221")]:[Rd],[Ai("2212")]:[Ld],[Ai("2122")]:[Dd],[Ai("1222")]:[kd],[Ai("0001")]:[Rd],[Ai("0010")]:[Ld],[Ai("0100")]:[Dd],[Ai("1000")]:[kd],[Ai("2220")]:[Od],[Ai("2202")]:[Fd],[Ai("2022")]:[Nd],[Ai("0222")]:[zd],[Ai("0002")]:[Od],[Ai("0020")]:[Fd],[Ai("0200")]:[Nd],[Ai("2000")]:[zd],[Ai("0011")]:[QM],[Ai("0110")]:[JM],[Ai("1100")]:[$M],[Ai("1001")]:[tB],[Ai("2211")]:[QM],[Ai("2112")]:[JM],[Ai("1122")]:[$M],[Ai("1221")]:[tB],[Ai("2200")]:[eB],[Ai("2002")]:[iB],[Ai("0022")]:[eB],[Ai("0220")]:[iB],[Ai("1111")]:[Bmt],[Ai("1211")]:[nB],[Ai("2111")]:[rB],[Ai("1112")]:[sB],[Ai("1121")]:[oB],[Ai("1011")]:[nB],[Ai("0111")]:[rB],[Ai("1110")]:[sB],[Ai("1101")]:[oB],[Ai("1200")]:[aB],[Ai("0120")]:[lB],[Ai("0012")]:[uB],[Ai("2001")]:[cB],[Ai("1022")]:[aB],[Ai("2102")]:[lB],[Ai("2210")]:[uB],[Ai("0221")]:[cB],[Ai("1002")]:[hB],[Ai("2100")]:[fB],[Ai("0210")]:[dB],[Ai("0021")]:[pB],[Ai("1220")]:[hB],[Ai("0122")]:[fB],[Ai("2012")]:[dB],[Ai("2201")]:[pB],[Ai("0211")]:[AB],[Ai("2110")]:[mB],[Ai("1102")]:[gB],[Ai("1021")]:[yB],[Ai("2011")]:[AB],[Ai("0112")]:[mB],[Ai("1120")]:[gB],[Ai("1201")]:[yB],[Ai("2101")]:[Ud],[Ai("0121")]:[Ud],[Ai("1012")]:[Vd],[Ai("1210")]:[Vd],[Ai("0101")]:{0:[Rd,Dd],1:[Ud],2:[Ud]},[Ai("1010")]:{0:[kd,Ld],1:[Vd],2:[Vd]},[Ai("2121")]:{0:[Ud],1:[Ud],2:[Rd,Dd]},[Ai("1212")]:{0:[Vd],1:[Vd],2:[kd,Ld]},[Ai("2120")]:{0:[og],1:[og],2:[Od,Dd]},[Ai("2021")]:{0:[ag],1:[ag],2:[Rd,Nd]},[Ai("1202")]:{0:[lg],1:[lg],2:[kd,Fd]},[Ai("0212")]:{0:[ug],1:[ug],2:[Ld,zd]},[Ai("0102")]:{0:[Od,Dd],1:[og],2:[og]},[Ai("0201")]:{0:[Rd,Nd],1:[ag],2:[ag]},[Ai("1020")]:{0:[kd,Fd],1:[lg],2:[lg]},[Ai("2010")]:{0:[Ld,zd],1:[ug],2:[ug]},[Ai("2020")]:{0:[zd,Fd],1:[vB],2:[Od,Nd]},[Ai("0202")]:{0:[Nd,Od],1:[vB],2:[zd,Fd]}};function TA(i,t){return Number.isNaN(i)?0:Array.isArray(t)?i<t[0]?0:i<t[1]?1:2:i>=t?1:0}function Dmt(i){const{x:t,y:e,xRange:n,yRange:r,getValue:o,threshold:s}=i,l=t<n[0],c=t>=n[1]-1,y=e<r[0],_=e>=r[1]-1,C=l||c||y||_;let I=0,k,z,V,X;if(l||_)V=0;else{const Y=o(t,e+1);V=TA(Y,s),I+=Y}if(c||_)X=0;else{const Y=o(t+1,e+1);X=TA(Y,s),I+=Y}if(c||y)z=0;else{const Y=o(t+1,e);z=TA(Y,s),I+=Y}if(l||y)k=0;else{const Y=o(t,e);k=TA(Y,s),I+=Y}let H=-1;Number.isFinite(s)&&(H=V<<3|X<<2|z<<1|k),Array.isArray(s)&&(H=V<<6|X<<4|z<<2|k);let $=0;return C||($=TA(I/4,s)),{code:H,meanCode:$}}function kmt(i){const{x:t,y:e,z:n,code:r,meanCode:o}=i;let s=Lmt[r];Array.isArray(s)||(s=s[o]);const l=t+1,c=e+1,y=[];return s.forEach(_=>{const C=[];_.forEach(I=>{const k=l+I[0],z=c+I[1];C.push([k,z,n])}),y.push(C)}),y}function Omt(i){const{x:t,y:e,z:n,code:r,meanCode:o}=i;let s=Rmt[r];Array.isArray(s)||(s=s[o]);const l=t+1,c=e+1,y=[];return s.forEach(_=>{_.forEach(C=>{const I=l+C[0],k=c+C[1];y.push([I,k,n])})}),y}function Fmt({contours:i,getValue:t,xRange:e,yRange:n}){const r=[],o=[];let s=0,l=0;for(let c=0;c<i.length;c++){const y=i[c],_=y.zIndex??c,{threshold:C}=y;for(let I=e[0]-1;I<e[1];I++)for(let k=n[0]-1;k<n[1];k++){const{code:z,meanCode:V}=Dmt({getValue:t,threshold:C,x:I,y:k,xRange:e,yRange:n}),X={x:I,y:k,z:_,code:z,meanCode:V};if(Array.isArray(C)){const H=kmt(X);for(const $ of H)o[l++]={vertices:$,contour:y}}else{const H=Omt(X);H.length>0&&(r[s++]={vertices:H,contour:y})}}}return{lines:r,polygons:o}}function Nmt(i){const{aggregator:t,binIdRange:e,channel:n}=i;if(t instanceof ka){const r=t.getResult(n)?.buffer;if(r){const o=new Float32Array(r.readSyncWebGL().buffer);return zmt(o,e)}}if(t instanceof Np){const r=t.getResult(n)?.value,o=t.getBins()?.value;if(o&&r)return Umt(r,o,t.binCount)}return null}function zmt(i,t){const[[e,n],[r,o]]=t,s=n-e,l=o-r;return(c,y)=>(c-=e,y-=r,c<0||c>=s||y<0||y>=l?NaN:i[y*s+c])}function Umt(i,t,e){const n={};for(let r=0;r<e;r++){const o=t[r*2],s=t[r*2+1];n[o]=n[o]||{},n[o][s]=i[r]}return(r,o)=>n[r]?.[o]??NaN}const Vmt=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Gmt={name:"binOptions",vs:Vmt,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}},_B=[255,255,255,255],jmt=1,Wmt={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:i=>i.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005};let o3=class extends zp{getAggregatorType(){return this.props.gpuAggregation&&ka.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(i){return i==="cpu"?new Np({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},e,n)=>{const r=this.state.aggregatorViewport.projectPosition(t),{cellSizeCommon:o,cellOriginCommon:s}=n;return[Math.floor((r[0]-s[0])/o[0]),Math.floor((r[1]-s[1])/o[1])]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}],onUpdate:this._onAggregationUpdate.bind(this)}):new ka(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Hs,Gmt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(i){const t=super.updateState(i),{props:e,oldProps:n,changeFlags:r}=i,{aggregator:o}=this.state;if(t||r.dataChanged||e.cellSize!==n.cellSize||!Or(e.gridOrigin,n.gridOrigin,1)||e.aggregation!==n.aggregation){this._updateBinOptions();const{cellSizeCommon:s,cellOriginCommon:l,binIdRange:c}=this.state;o.setProps({binIdRange:c,pointCount:this.getNumInstances(),operations:[e.aggregation],binOptions:{cellSizeCommon:s,cellOriginCommon:l}})}return Or(n.contours,e.contours,2)||this.setState({contourData:null}),t}_updateBinOptions(){const i=this.getBounds(),t=[1,1];let e=[0,0],n=[[0,1],[0,1]],r=this.context.viewport;if(i&&Number.isFinite(i[0][0])){let o=[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2];const{cellSize:s,gridOrigin:l}=this.props,{unitsPerMeter:c}=r.getDistanceScales(o);t[0]=c[0]*s,t[1]=c[1]*s;const y=r.projectFlat(o);e=[Math.floor((y[0]-l[0])/t[0])*t[0]+l[0],Math.floor((y[1]-l[1])/t[1])*t[1]+l[1]],o=r.unprojectFlat(e);const _=r.constructor;r=r.isGeospatial?new _({longitude:o[0],latitude:o[1],zoom:12}):new ec({position:[o[0],o[1],0],zoom:12}),e=[Math.fround(r.center[0]),Math.fround(r.center[1])],n=r3({dataBounds:i,getBinId:C=>{const I=r.projectFlat(C);return[Math.floor((I[0]-e[0])/t[0]),Math.floor((I[1]-e[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:e,binIdRange:n,aggregatorViewport:r})}draw(i){i.shaderModuleProps.project&&(i.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(i)}_onAggregationUpdate(){const{aggregator:i,binIdRange:t}=this.state;this.setState({aggregatedValueReader:Nmt({aggregator:i,binIdRange:t,channel:0}),contourData:null})}_getContours(){const{aggregatedValueReader:i}=this.state;if(!i)return null;if(!this.state.contourData){const{binIdRange:t}=this.state,{contours:e}=this.props,n=Fmt({contours:e,getValue:i,xRange:t[0],yRange:t[1]});this.state.contourData=n}return this.state.contourData}onAttributeChange(i){const{aggregator:t}=this.state;switch(i){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:e,cellOriginCommon:n,binIdRange:r}=this.state;t.setProps({binIdRange:r,binOptions:{cellSizeCommon:e,cellOriginCommon:n}});break;case"counts":t.setNeedsUpdate(0);break}}renderLayers(){const i=this._getContours();if(!i)return null;const{lines:t,polygons:e}=i,{zOffset:n}=this.props,{cellOriginCommon:r,cellSizeCommon:o}=this.state,s=this.getSubLayerClass("lines",nh),l=this.getSubLayerClass("bands",rh),c=new bn().translate([r[0],r[1],0]).scale([o[0],o[1],n]),y=t&&t.length>0&&new s(this.getSubLayerProps({id:"lines"}),{data:t,coordinateSystem:nn.CARTESIAN,modelMatrix:c,getPath:C=>C.vertices,getColor:C=>C.contour.color??_B,getWidth:C=>C.contour.strokeWidth??jmt,widthUnits:"pixels"}),_=e&&e.length>0&&new l(this.getSubLayerProps({id:"bands"}),{data:e,coordinateSystem:nn.CARTESIAN,modelMatrix:c,getPolygon:C=>C.vertices,getFillColor:C=>C.contour.color??_B});return[y,_]}getPickingInfo(i){const t=i.info,{object:e}=t;return e&&(t.object={contour:e.contour}),t}};o3.layerName="ContourLayer";o3.defaultProps=Wmt;const Hmt=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Xmt=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,qmt={name:"grid",vs:Xmt,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};class ak extends du{getShaders(){const t=super.getShaders();return t.modules.push(qmt),{...t,vs:Hmt}}initializeState(){super.initializeState();const t=this.getAttributeManager();t.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),t.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t,r=this.state.fillModel;if(n.colorRange!==e.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=i3(this.context.device,e.colorRange,e.colorScaleType);const o={colorRange:this.state.colorTexture};r.shaderInputs.setProps({grid:o})}else n.colorScaleType!==e.colorScaleType&&e3(this.state.colorTexture,e.colorScaleType)}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}_updateGeometry(){const t=new nL;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){const{cellOriginCommon:e,cellSizeCommon:n,elevationRange:r,elevationScale:o,extruded:s,coverage:l,colorDomain:c,elevationDomain:y}=this.props,_=this.props.colorCutoff||[-1/0,1/0],C=this.props.elevationCutoff||[-1/0,1/0],I=this.state.fillModel,k={colorDomain:[Math.max(c[0],_[0]),Math.min(c[1],_[1]),Math.max(c[0]-1,_[0]),Math.min(c[1]+1,_[1])],elevationDomain:[Math.max(y[0],C[0]),Math.min(y[1],C[1]),Math.max(y[0]-1,C[0]),Math.min(y[1]+1,C[1])],elevationRange:[r[0]*o,r[1]*o],originCommon:e,sizeCommon:n};I.shaderInputs.setProps({column:{extruded:s,coverage:l},grid:k}),I.draw(this.context.renderPass)}}ak.layerName="GridCellLayer";const Kmt=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Zmt={name:"binOptions",vs:Kmt,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function bB(){}const Ymt={gpuAggregation:!0,colorDomain:null,colorRange:Av,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:bB,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:bB,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:i=>i.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class a3 extends zp{getAggregatorType(){const{gpuAggregation:t,gridAggregator:e,getColorValue:n,getElevationValue:r}=this.props;return t&&(e||n||r)?($i.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):t&&ka.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){if(t==="cpu"){const{gridAggregator:e,cellSize:n}=this.props;return new Np({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},o,s)=>{if(e)return e(r,n);const l=this.state.aggregatorViewport.projectPosition(r),{cellSizeCommon:c,cellOriginCommon:y}=s;return[Math.floor((l[0]-y[0])/c[0]),Math.floor((l[1]-y[1])/c[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:r})=>r},{sources:["elevationWeights"],getValue:({elevationWeights:r})=>r}]})}return new ka(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Hs,Zmt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(t){const e=super.updateState(t),{props:n,oldProps:r,changeFlags:o}=t,{aggregator:s}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(fu(n.data).iterable)),e||o.dataChanged||n.cellSize!==r.cellSize||n.getColorValue!==r.getColorValue||n.getElevationValue!==r.getElevationValue||n.colorAggregation!==r.colorAggregation||n.elevationAggregation!==r.elevationAggregation){this._updateBinOptions();const{cellSizeCommon:l,cellOriginCommon:c,binIdRange:y,dataAsArray:_}=this.state;if(s.setProps({binIdRange:y,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{cellSizeCommon:l,cellOriginCommon:c},onUpdate:this._onAggregationUpdate.bind(this)}),_){const{getColorValue:C,getElevationValue:I}=this.props;s.setProps({customOperations:[C&&(k=>C(k.map(z=>_[z]),{indices:k,data:n.data})),I&&(k=>I(k.map(z=>_[z]),{indices:k,data:n.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&s.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&s.setNeedsUpdate(1),e}_updateBinOptions(){const t=this.getBounds(),e=[1,1];let n=[0,0],r=[[0,1],[0,1]],o=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let s=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2];const{cellSize:l}=this.props,{unitsPerMeter:c}=o.getDistanceScales(s);e[0]=c[0]*l,e[1]=c[1]*l;const y=o.projectFlat(s);n=[Math.floor(y[0]/e[0])*e[0],Math.floor(y[1]/e[1])*e[1]],s=o.unprojectFlat(n);const _=o.constructor;o=o.isGeospatial?new _({longitude:s[0],latitude:s[1],zoom:12}):new ec({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],r=r3({dataBounds:t,getBinId:C=>{const I=o.projectFlat(C);return[Math.floor((I[0]-n[0])/e[0]),Math.floor((I[1]-n[1])/e[1])]}})}this.setState({cellSizeCommon:e,cellOriginCommon:n,binIdRange:r,aggregatorViewport:o})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate({channel:t}){const e=this.getCurrentLayer().props,{aggregator:n}=this.state;if(t===0){const r=n.getResult(0);this.setState({colors:new xy(r,n.binCount)}),e.onSetColorDomain(n.getResultDomain(0))}else if(t===1){const r=n.getResult(1);this.setState({elevations:new xy(r,n.binCount)}),e.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(t){const{aggregator:e}=this.state;switch(t){case"positions":e.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:r,binIdRange:o}=this.state;e.setProps({binIdRange:o,binOptions:{cellSizeCommon:n,cellOriginCommon:r}});break;case"colorWeights":e.setNeedsUpdate(0);break;case"elevationWeights":e.setNeedsUpdate(1);break}}renderLayers(){const{aggregator:t,cellOriginCommon:e,cellSizeCommon:n}=this.state,{elevationScale:r,colorRange:o,elevationRange:s,extruded:l,coverage:c,material:y,transitions:_,colorScaleType:C,lowerPercentile:I,upperPercentile:k,colorDomain:z,elevationScaleType:V,elevationLowerPercentile:X,elevationUpperPercentile:H,elevationDomain:$}=this.props,Y=this.getSubLayerClass("cells",ak),ct=t.getBins(),rt=this.state.colors?.update({scaleType:C,lowerPercentile:I,upperPercentile:k}),nt=this.state.elevations?.update({scaleType:V,lowerPercentile:X,upperPercentile:H});return!rt||!nt?null:new Y(this.getSubLayerProps({id:"cells"}),{data:{length:t.binCount,attributes:{getBin:ct,getColorValue:rt.attribute,getElevationValue:nt.attribute}},dataComparator:(Ot,Kt)=>Ot.length===Kt.length,updateTriggers:{getBin:[ct],getColorValue:[rt.attribute],getElevationValue:[nt.attribute]},cellOriginCommon:e,cellSizeCommon:n,elevationScale:r,colorRange:o,colorScaleType:C,elevationRange:s,extruded:l,coverage:c,material:y,colorDomain:rt.domain||z||t.getResultDomain(0),elevationDomain:nt.domain||$||t.getResultDomain(1),colorCutoff:rt.cutoff,elevationCutoff:nt.cutoff,transitions:_&&{getFillColor:_.getColorValue||_.getColorWeight,getElevation:_.getElevationValue||_.getElevationWeight},extensions:[]})}getPickingInfo(t){const e=t.info,{index:n}=e;if(n>=0){const r=this.state.aggregator.getBin(n);let o;r&&(o={col:r.id[0],row:r.id[1],colorValue:r.value[0],elevationValue:r.value[1],count:r.count},r.pointIndices&&(o.pointIndices=r.pointIndices,o.points=Array.isArray(this.props.data)?r.pointIndices.map(s=>this.props.data[s]):[])),e.object=o}return e}}a3.layerName="GridLayer";a3.defaultProps=Ymt;function Qmt(i){const t=i.map(l=>l[0]),e=i.map(l=>l[1]),n=Math.min.apply(null,t),r=Math.max.apply(null,t),o=Math.min.apply(null,e),s=Math.max.apply(null,e);return[n,o,r,s]}function Jmt(i,t){return t[0]>=i[0]&&t[2]<=i[2]&&t[1]>=i[1]&&t[3]<=i[3]}const xB=new Float32Array(12);function wB(i,t=2){let e=0;for(const n of i)for(let r=0;r<t;r++)xB[e++]=n[r]||0;return xB}function $mt(i,t,e){const[n,r,o,s]=i,l=o-n,c=s-r;let y=l,_=c;l/c<t/e?y=t/e*c:_=e/t*l,y<t&&(y=t,_=e);const C=(o+n)/2,I=(s+r)/2;return[C-y/2,I-_/2,C+y/2,I+_/2]}function t0t(i,t){const[e,n,r,o]=t;return[(i[0]-e)/(r-e),(i[1]-n)/(o-n)]}const e0t=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,i0t=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,EB=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,n0t={name:"triangle",vs:EB,fs:EB,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class lk extends Ps{getShaders(){return super.getShaders({vs:e0t,fs:i0t,modules:[Hs,n0t]})}initializeState({device:t}){this.setState({model:this._getModel(t)})}_getModel(t){const{vertexCount:e,data:n}=this.props;return new Rr(t,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:e})}draw(){const{model:t}=this.state,{aggregationMode:e,colorDomain:n,intensity:r,threshold:o,colorTexture:s,maxTexture:l,weightsTexture:c}=this.props,y={aggregationMode:e,colorDomain:n,intensity:r,threshold:o,colorTexture:s,maxTexture:l,weightsTexture:c};t.shaderInputs.setProps({triangle:y}),t.draw(this.context.renderPass)}}lk.layerName="TriangleLayer";function r0t(i,t){const e={};for(const n in i)t.includes(n)||(e[n]=i[n]);return e}class uk extends Is{initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:r0t(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:t,mousePosition:e,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:e,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(t){}isAggregationDirty(t,e={}){const{props:n,oldProps:r,changeFlags:o}=t,{compareAll:s=!1,dimension:l}=e,{ignoreProps:c}=this.state,{props:y,accessors:_=[]}=l,{updateTriggersChanged:C}=o;if(o.dataChanged)return!0;if(C){if(C.all)return!0;for(const I of _)if(C[I])return!0}if(s)return o.extensionsChanged?!0:qx({oldProps:r,newProps:n,ignoreProps:c,propTypes:this.constructor._propTypes});for(const I of y)if(n[I]!==r[I])return!0;return!1}isAttributeChanged(t){const{changedAttributes:e}=this.state;return t?e&&e[t]!==void 0:!s0t(e)}_getAttributeManager(){return new Fy(this.context.device,{id:this.props.id,stats:this.context.stats})}}uk.layerName="AggregationLayer";function s0t(i){let t=!0;for(const e in i){t=!1;break}return t}const ib=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,nb=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,o0t=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,a0t=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,l0t=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,u0t={name:"weight",vs:l0t,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},c0t={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},h0t=2,rb={format:"rgba8unorm",dimension:"2d",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},CB=[0,0],f0t={SUM:0,MEAN:1},d0t={getPosition:{type:"accessor",value:i=>i.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Av,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},p0t=["float32-renderable-webgl","texture-blend-float-webgl"],A0t={data:{props:["radiusPixels"]}};class l3 extends uk{getShaders(t){let e=[Hs];return t.modules&&(e=[...e,...t.modules]),super.getShaders({...t,modules:e})}initializeState(){super.initializeAggregationLayer(A0t),this.setState({colorDomain:CB}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t),this._updateHeatmapState(t)}_updateHeatmapState(t){const{props:e,oldProps:n}=t,r=this._getChangeFlags(t);if((r.dataChanged||r.viewportChanged)&&(r.boundsChanged=this._updateBounds(r.dataChanged),this._updateTextureRenderingBounds()),r.dataChanged||r.boundsChanged){if(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0}),r.dataChanged){const o=this.getShaders({vs:ib,fs:nb});this._createWeightsTransform(o)}}else r.viewportZoomChanged&&this._debouncedUpdateWeightmap();e.colorRange!==n.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){const{weightsTexture:t,triPositionBuffer:e,triTexCoordBuffer:n,maxWeightsTexture:r,colorTexture:o,colorDomain:s}=this.state,{updateTriggers:l,intensity:c,threshold:y,aggregation:_}=this.props,C=this.getSubLayerClass("triangle",lk);return new C(this.getSubLayerProps({id:"triangle-layer",updateTriggers:l}),{coordinateSystem:nn.DEFAULT,data:{attributes:{positions:e,texCoords:n}},vertexCount:4,maxTexture:r,colorTexture:o,aggregationMode:f0t[_]||0,weightsTexture:t,intensity:c,threshold:y,colorDomain:s})}finalizeState(t){super.finalizeState(t);const{weightsTransform:e,weightsTexture:n,maxWeightTransform:r,maxWeightsTexture:o,triPositionBuffer:s,triTexCoordBuffer:l,colorTexture:c,updateTimer:y}=this.state;e?.destroy(),n?.destroy(),r?.destroy(),o?.destroy(),s?.destroy(),l?.destroy(),c?.destroy(),y&&clearTimeout(y)}_getAttributeManager(){return new Fy(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){const e={},{dimensions:n}=this.state;e.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(t,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",e.viewportChanged=t.changeFlags.viewportChanged;const{zoom:r}=this.state;return(!t.context.viewport||t.context.viewport.zoom!==r)&&(e.viewportZoomChanged=!0),e}_createTextures(){const{textureSize:t,format:e}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...rb,width:t,height:t,format:e}),maxWeightsTexture:this.context.device.createTexture({...rb,width:1,height:1,format:e})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:t}=this.context,{weightsTextureSize:e}=this.props,n=Math.min(e,t.limits.maxTextureDimension2D),r=p0t.every(l=>t.features.has(l)),o=r?"rgba32float":"rgba8unorm",s=r?1:1/255;this.setState({textureSize:n,format:o,weightsScale:s}),r||$i.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(t){let{weightsTransform:e}=this.state;const{weightsTexture:n}=this.state,r=this.getAttributeManager();e?.destroy(),e=new OT(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:r.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...t,modules:[...t.modules,u0t]}),this.setState({weightsTransform:e})}_setupResources(){this._createTextures();const{device:t}=this.context,{textureSize:e,weightsTexture:n,maxWeightsTexture:r}=this.state,o=this.getShaders({vs:ib,fs:nb});this._createWeightsTransform(o);const s=this.getShaders({vs:o0t,fs:a0t,modules:[c0t]}),l=new OT(t,{id:`${this.id}-max-weights-transform`,targetTexture:r,...s,vertexCount:e*e,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),c={inTexture:n,textureSize:e};l.model.shaderInputs.setProps({maxWeight:c}),this.setState({weightsTexture:n,maxWeightsTexture:r,maxWeightTransform:l,zoom:null,triPositionBuffer:t.createBuffer({byteLength:48}),triTexCoordBuffer:t.createBuffer({byteLength:48})})}updateShaders(t){this._createWeightsTransform({vs:ib,fs:nb,...t})}_updateMaxWeightValue(){const{maxWeightTransform:t}=this.state;t.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(t=!1){const{viewport:e}=this.context,n=[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([0,e.height]),e.unproject([e.width,e.height])].map(l=>l.map(Math.fround)),r=Qmt(n),o={visibleWorldBounds:r,viewportCorners:n};let s=!1;if(t||!this.state.worldBounds||!Jmt(this.state.worldBounds,r)){const l=this._worldToCommonBounds(r),c=this._commonToWorldBounds(l);this.props.coordinateSystem===nn.LNGLAT&&(c[1]=Math.max(c[1],-85.051129),c[3]=Math.min(c[3],85.051129),c[0]=Math.max(c[0],-360),c[2]=Math.min(c[2],360));const y=this._worldToCommonBounds(c);o.worldBounds=c,o.normalizedCommonBounds=y,s=!0}return this.setState(o),s}_updateTextureRenderingBounds(){const{triPositionBuffer:t,triTexCoordBuffer:e,normalizedCommonBounds:n,viewportCorners:r}=this.state,{viewport:o}=this.context;t.write(wB(r,3));const s=r.map(l=>t0t(o.projectPosition(l),n));e.write(wB(s,2))}_updateColorTexture(t){const{colorRange:e}=t.props;let{colorTexture:n}=this.state;const r=nk(e,!1,Uint8Array);n?.destroy(),n=this.context.device.createTexture({...rb,data:r,width:e.length,height:1}),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:t,colorDomain:e,aggregation:n}=this.props,{worldBounds:r,textureSize:o,weightsScale:s,weightsTexture:l}=this.state,c=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const y=this._worldToCommonBounds(r,{useLayerCoordinateSystem:!0});if(e&&n==="SUM"){const{viewport:$}=this.context,Y=$.distanceScales.metersPerUnit[2]*(y[2]-y[0])/o;this.state.colorDomain=e.map(ct=>ct*Y*s)}else this.state.colorDomain=e||CB;const _=this.getAttributeManager().getAttributes(),C=this.getModuleSettings();this._setModelAttributes(c.model,_),c.model.setVertexCount(this.getNumInstances());const I={radiusPixels:t,commonBounds:y,textureWidth:o,weightsScale:s,weightsTexture:l},{viewport:k,devicePixelRatio:z,coordinateSystem:V,coordinateOrigin:X}=C,{modelMatrix:H}=this.props;c.model.shaderInputs.setProps({project:{viewport:k,devicePixelRatio:z,modelMatrix:H,coordinateSystem:V,coordinateOrigin:X},weight:I}),c.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(t=!1){let{updateTimer:e}=this.state;const{debounceTimeout:n}=this.props;t?(e=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(e),e=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:e})}_worldToCommonBounds(t,e={}){const{useLayerCoordinateSystem:n=!1}=e,[r,o,s,l]=t,{viewport:c}=this.context,{textureSize:y}=this.state,{coordinateSystem:_}=this.props,C=n&&(_===nn.LNGLAT_OFFSETS||_===nn.METER_OFFSETS),I=C?c.projectPosition(this.props.coordinateOrigin):[0,0],k=y*h0t/c.scale;let z,V;return n&&!C?(z=this.projectPosition([r,o,0]),V=this.projectPosition([s,l,0])):(z=c.projectPosition([r,o,0]),V=c.projectPosition([s,l,0])),$mt([z[0]-I[0],z[1]-I[1],V[0]-I[0],V[1]-I[1]],k,k)}_commonToWorldBounds(t){const[e,n,r,o]=t,{viewport:s}=this.context,l=s.unprojectPosition([e,n]),c=s.unprojectPosition([r,o]);return l.slice(0,2).concat(c.slice(0,2))}}l3.layerName="HeatmapLayer";l3.defaultProps=d0t;const m0t=Object.freeze(Object.defineProperty({__proto__:null,CPUAggregator:Np,ContourLayer:o3,GridLayer:a3,HeatmapLayer:l3,HexagonLayer:s3,ScreenGridLayer:n3,WebGLAggregator:ka,_AggregationLayer:zp},Symbol.toStringTag,{value:"Module"})),ck=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],hk=[0n,1n,2n,4n,8n,16n];function g0t(i){return BigInt(`0x${i}`)}function O2(i){return i.toString(16)}function y0t(i){if(i.z<0||i.z>26)throw new Error("Wrong zoom");const t=BigInt(i.z);let e=BigInt(i.x)<<32n-t,n=BigInt(i.y)<<32n-t;for(let r=0;r<5;r++){const o=hk[5-r],s=ck[4-r];e=(e|e<<o)&s,n=(n|n<<o)&s}return 0x4000000000000000n|1n<<59n|t<<52n|(e|n<<1n)>>12n|0xfffffffffffffn>>t*2n}function fk(i){const t=i>>59n&7n,e=i>>57n&3n,n=i>>52n&0x1fn,r=(i&0xfffffffffffffn)<<12n;if(t!==1n&&e!==0n)throw new Error("Wrong mode");let o=r,s=r>>1n;for(let l=0;l<6;l++){const c=hk[l],y=ck[l];o=(o|o>>c)&y,s=(s|s>>c)&y}return o=o>>32n-n,s=s>>32n-n,{z:Number(n),x:Number(o),y:Number(s)}}function u3(i){return i>>52n&0x1fn}function dk(i){const t=u3(i)-1n;return i&~(0x1fn<<52n)|t<<52n|0xfffffffffffffn>>t*2n}function hf(i,t){$i.assert(i,t)}function v0t(i,t){const{properties:e,numericProps:n}=i;return new Proxy(e[t]||{},{get(r,o){return o in n?n[o].value[t]:r[o]},has(r,o){return o in n||o in r},ownKeys(r){return[...Object.keys(n),...Reflect.ownKeys(r)]},getOwnPropertyDescriptor(r,o){return{enumerable:!0,configurable:!0}}})}function yv(i,t){return`https://unpkg.com/@deck.gl/carto@${t}/dist/${i}-worker.js`}const $A=new Uint16Array,sb={positions:{value:new Float32Array,size:2},properties:[],numericProps:{},featureIds:{value:$A,size:1},globalFeatureIds:{value:$A,size:1}};function pk(){return{shape:"binary-feature-collection",points:{type:"Point",...sb},lines:{type:"LineString",pathIndices:{value:$A,size:1},...sb},polygons:{type:"Polygon",polygonIndices:{value:$A,size:1},primitivePolygonIndices:{value:$A,size:1},...sb}}}function c3(i,t,e,n,r,o=2){return{type:"Point",positions:{value:new Float32Array(i),size:o},featureIds:{value:new Uint16Array(t),size:1},globalFeatureIds:{value:new Uint32Array(e),size:1},numericProps:n,properties:r}}function Ak(i,t){const e={};return t&&Object.keys(t).forEach(n=>{e[n]={value:new Float32Array(i),size:1}}),e}function mk(i,t,e,n){Object.keys(i).forEach(r=>{t[r].value[n]=i[r].value[e]})}function _0t(i,t,e,n=[],r,o,s="quadbin"){if(!i.content)return!1;i.userData||(i.userData={});const l=t.get(e)?.[0];if(l){if(n.every(y=>y.name in l))return!1;t.clear()}const c={};for(const y of i.content){let _=y.id;const C=typeof r=="function"?r(y,{}):r;for(let X=0;X<e-1;X++)if(s==="h3"){const H=lf(_);_=YD(_,Math.max(0,H-1))}else _=dk(_);const I=String(_);if(!(I in c)){c[I]={id:_,count:0,position:[0,0]};for(const{name:X,aggregation:H}of n)H==="any"?c[I][X]=y.properties[X]:c[I][X]=0}const k=c[I].count;c[I].count+=typeof o=="function"?o(y,{}):o;const z=c[I].count,V=z-k;c[I].position[0]=(k*c[I].position[0]+V*C[0])/z,c[I].position[1]=(k*c[I].position[1]+V*C[1])/z;for(const{name:X,aggregation:H}of n){const $=c[I][X],Y=y.properties[X];H==="average"?c[I][X]=(k*$+V*Y)/z:H==="count"||H==="sum"?c[I][X]=$+Y:H==="max"?c[I][X]=Math.max($,Y):H==="min"&&(c[I][X]=Math.min($,Y))}}return t.set(e,Object.values(c)),!0}function b0t(i){const t=[],e=["any","average","count","min","max","sum"];for(const n of Object.keys(i.content[0].properties)){let r=n.split("_").pop().toLowerCase();e.includes(r)||($i.warn(`No valid aggregation present in ${n} property`)(),r="any"),t.push({name:n,aggregation:r})}return t}function x0t(i,t){const e={};for(const{name:n,aggregation:r}of t)if(e[n]={min:1/0,max:-1/0},r!=="any")for(const o of i)e[n].min=Math.min(e[n].min,o[n]),e[n].max=Math.max(e[n].max,o[n]);return e}function w0t(i){const t=new Float32Array(i.length*2),e=new Uint16Array(i.length);for(let n=0;n<i.length;n++)t.set(i[n].position,2*n),e[n]=n;return{...pk(),points:c3(t,e,e,{},i)}}const Up=512;class vv extends av{getTileIndices(t){return super.getTileIndices(t).map(y0t).map(e=>({q:e,i:O2(e)}))}getTileId({q:t,i:e}){return e||O2(t)}getTileMetadata({q:t}){return super.getTileMetadata(fk(t))}getTileZoom({q:t}){return Number(u3(t))}getParentIndex({q:t}){return{q:dk(t)}}}const TB=85.051128;function gk({west:i,north:t,east:e,south:n},r,o=1){const s=[[t,e],[n,e],[n,i],[t,i]].map(y=>Mw(y[0],y[1],r)).map(y=>Math.max(...xut(y).map(_=>Eut(_,dp.rads)))*180/Math.PI),l=Math.max(...s)*o,c=Math.min(180,l/Math.cos((t+n)/2*Math.PI/180));return{north:Math.min(t+l,TB),east:e+c,south:Math.max(n-l,-TB),west:i-c}}function yk({west:i,north:t,east:e,south:n},r){const o=Math.abs(e-i);if(o>180){const s=Math.ceil(o/180);let l=[];for(let c=0;c<s;c++){const y=i+c*180,_=Math.min(y+179.9999999,e);l=l.concat(yk({west:y,north:t,east:_,south:n},r))}return[...new Set(l)]}return _ut([[t,e],[n,e],[n,i],[t,i],[t,e]],r)}function E0t(i){const t=ZD(i),e=t.map(c=>c[0]),n=t.map(c=>c[1]),r=Math.min(...n),o=Math.min(...e),s=Math.max(...n),l=Math.max(...e);return gk({west:r,south:o,east:s,north:l},lf(i),.12)}const C0t=2;function wy(i,t){const e=Math.log2(t/512),n=2/3*(i.zoom-e),r=Math.log(1/Math.cos(Math.PI*i.latitude/180));return Math.max(0,Math.floor(n+r-C0t))}class h3 extends av{getTileIndices({viewport:t,minZoom:e,maxZoom:n}){if(t.latitude===void 0)return[];const[r,o,s,l]=t.getBounds(),{tileSize:c}=this.opts;let y=wy(t,c),_;if(typeof e=="number"&&Number.isFinite(e)&&y<e)return[];if(typeof n=="number"&&Number.isFinite(n)&&y>n){y=n;const C=Mw(t.latitude,t.longitude,n);_=vut(C,1)}else{const C=gk({west:r,north:l,east:s,south:o},y);_=yk(C,y)}return _.map(C=>({i:C}))}getTileId({i:t}){return t}getTileMetadata({i:t}){return{bbox:E0t(t)}}getTileZoom({i:t}){return lf(t)}getParentIndex(t){const e=lf(t.i);return{i:YD(t.i,e-1)}}}const SB=512;function vk(i){const{x:t,y:e,z:n}=fk(i),r=SB/(1<<n);return[t*r,SB-e*r,r]}function T0t(i,t){const[e,n,r]=vk(i);return[[e,n],[e+t*r,n-t*r]]}function _k(i,t=1){const[e,n]=T0t(i,t),[r,o]=lu(e),[s,l]=lu(n);return[s,o,s,l,r,l,r,o,s,o]}const cg=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),PB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);PB&&parseFloat(PB[1]);function S0t(i){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,i)}function P0t(...i){return I0t(i)}function I0t(i){const t=i.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),e=t.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(e);let r=0;for(const o of t)n.set(o,r),r+=o.byteLength;return n.buffer}async function M0t(i){const t=[];for await(const e of i)t.push(e);return P0t(...t)}function B0t(i){return i&&typeof i=="object"&&i.isBuffer}function hg(i){if(B0t(i)||i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const t=i;return new TextEncoder().encode(t).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function fg(i){return t=>new Promise((e,n)=>i(t,(r,o)=>r?n(r):e(o)))}class R0t{constructor(t){this.compressBatches=this.compressBatches.bind(this),this.decompressBatches=this.decompressBatches.bind(this)}async preload(t={}){S0t(t)}async compress(t){return await this.preload(),this.compressSync(t)}async decompress(t,e){return await this.preload(),this.decompressSync(t,e)}compressSync(t){throw new Error(`${this.name}: sync compression not supported`)}decompressSync(t,e){throw new Error(`${this.name}: sync decompression not supported`)}async*compressBatches(t){const e=await this.concatenate(t);yield this.compress(e)}async*decompressBatches(t){const e=await this.concatenate(t);yield this.decompress(e)}concatenate(t){return M0t(t)}improveError(t){return t.message.includes(this.name)||(t.message=`${this.name} ${t.message}`),t}}class L0t extends R0t{name="deflate";extensions=[];contentEncodings=["deflate"];isSupported=!0;options;_chunks=[];constructor(t={}){super(t),this.options=t}async compress(t){if(!cg&&this.options.deflate?.useZlib){const e=this.options.deflate?.gzip?await fg(Lc.gzip)(t):await fg(Lc.deflate)(t);return hg(e)}return this.compressSync(t)}async decompress(t){if(!cg&&this.options.deflate?.useZlib){const e=this.options.deflate?.gzip?await fg(Lc.gunzip)(t):await fg(Lc.inflate)(t);return hg(e)}return this.decompressSync(t)}compressSync(t){if(!cg&&this.options.deflate?.useZlib){const r=this.options.deflate?.gzip?Lc.gzipSync(t):Lc.deflateSync(t);return hg(r)}const e=this.options?.deflate||{},n=new Uint8Array(t);return(this.options?.raw?Bd.deflateRaw:Bd.deflate)(n,e).buffer}decompressSync(t){if(!cg&&this.options.deflate?.useZlib){const r=this.options.deflate?.gzip?Lc.gunzipSync(t):Lc.inflateSync(t);return hg(r)}const e=this.options?.deflate||{},n=new Uint8Array(t);return(this.options?.raw?Bd.inflateRaw:Bd.inflate)(n,e).buffer}async*compressBatches(t){const e=this.options?.deflate||{},n=new Bd.Deflate(e);yield*this.transformBatches(n,t)}async*decompressBatches(t){const e=this.options?.deflate||{},n=new Bd.Inflate(e);yield*this.transformBatches(n,t)}async*transformBatches(t,e){t.onData=this._onData.bind(this),t.onEnd=this._onEnd.bind(this);for await(const r of e){const o=new Uint8Array(r);if(!t.push(o,!1))throw new Error(`${this._getError()}write`);yield*this._getChunks()}const n=new Uint8Array(0);t.push(n,!0),yield*this._getChunks()}_onData(t){this._chunks.push(t)}_onEnd(t){if(t!==0)throw new Error(this._getError(t)+this._chunks.length)}_getChunks(){const t=this._chunks;return this._chunks=[],t}_getError(t=0){const e={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};return`${this.name}: ${e[t]}`}}class D0t extends L0t{name="gzip";extensions=["gz","gzip"];contentEncodings=["gzip","x-gzip"];isSupported=!0;constructor(t){super({...t,deflate:{...t?.gzip,gzip:!0}})}}function _v(i,t,e,n){const r=t.type===2?t.readVarint()+t.pos:t.pos+1,o=t.buf.buffer.slice(t.pos,r);if(n?.compression==="gzip"){const s=new D0t().decompressSync(o);e.value=new i(s)}else e.value=new i(o);return t.pos=r,e.value}class f3{static read(t,e){return t.readFields(f3._readField,{key:"",value:null},e)}static _readField(t,e,n){t===1?e.key=n.readString():t===2&&(e.value=n.readString())}}class bf{static read(t,e){return t.readFields(bf._readField,{},e)}static _readField(t,e,n){if(t===1){const{key:r,value:o}=f3.read(n,n.readVarint()+n.pos);e[r]=o}}}class Im{static read(t,e){const{value:n,size:r}=t.readFields(Im._readField,{value:[],size:0},e);return{value:n,size:r}}static _readField(t,e,n){t===1?_v(Float64Array,n,e):t===2&&(e.size=n.readVarint(!0))}}class Ba{static read(t,e){const{value:n,size:r}=t.readFields(Ba._readField,{value:[],size:0},e);return{value:new Uint32Array(n),size:r}}static _readField(t,e,n){t===1?n.readPackedVarint(e.value):t===2&&(e.size=n.readVarint(!0))}}class Mm{static read(t,e){return t.readFields(Mm._readField,{id:0},e)}static _readField(t,e,n){t===1&&(e.id=n.readVarint())}}class d3{static read(t,e){return t.readFields(d3._readField,{value:[]},e)}static _readField(t,e,n){t===1&&_v(Float64Array,n,e)}}class xf{static read(t,e){return t.readFields(xf._readField,{key:"",value:null},e)}static _readField(t,e,n){t===1?e.key=n.readString():t===2&&(e.value=d3.read(n,n.readVarint()+n.pos))}}class p3{static read(t,e){return t.readFields(p3._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},e)}static _readField(t,e,n){if(t===1)e.positions=Im.read(n,n.readVarint()+n.pos);else if(t===2)e.globalFeatureIds=Ba.read(n,n.readVarint()+n.pos);else if(t===3)e.featureIds=Ba.read(n,n.readVarint()+n.pos);else if(t===4)e.properties.push(bf.read(n,n.readVarint()+n.pos));else if(t===5){const r=xf.read(n,n.readVarint()+n.pos);e.numericProps[r.key]=r.value}else t===6&&e.fields.push(Mm.read(n,n.readVarint()+n.pos))}}class A3{static read(t,e){return t.readFields(A3._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},e)}static _readField(t,e,n){if(t===1)e.positions=Im.read(n,n.readVarint()+n.pos);else if(t===2)e.pathIndices=Ba.read(n,n.readVarint()+n.pos);else if(t===3)e.globalFeatureIds=Ba.read(n,n.readVarint()+n.pos);else if(t===4)e.featureIds=Ba.read(n,n.readVarint()+n.pos);else if(t===5)e.properties.push(bf.read(n,n.readVarint()+n.pos));else if(t===6){const r=xf.read(n,n.readVarint()+n.pos);e.numericProps[r.key]=r.value}else t===7&&e.fields.push(Mm.read(n,n.readVarint()+n.pos))}}class m3{static read(t,e){return t.readFields(m3._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},e)}static _readField(t,e,n){if(t===1)e.positions=Im.read(n,n.readVarint()+n.pos);else if(t===2)e.polygonIndices=Ba.read(n,n.readVarint()+n.pos);else if(t===3)e.globalFeatureIds=Ba.read(n,n.readVarint()+n.pos);else if(t===4)e.featureIds=Ba.read(n,n.readVarint()+n.pos);else if(t===5)e.primitivePolygonIndices=Ba.read(n,n.readVarint()+n.pos);else if(t===6)e.triangles=Ba.read(n,n.readVarint()+n.pos);else if(t===7)e.properties.push(bf.read(n,n.readVarint()+n.pos));else if(t===8){const r=xf.read(n,n.readVarint()+n.pos);e.numericProps[r.key]=r.value}else t===9&&e.fields.push(Mm.read(n,n.readVarint()+n.pos))}}let k0t=class bk{static read(t,e){return t.readFields(bk._readField,{points:null,lines:null,polygons:null},e)}static _readField(t,e,n){t===1?e.points=p3.read(n,n.readVarint()+n.pos):t===2?e.lines=A3.read(n,n.readVarint()+n.pos):t===3&&(e.polygons=m3.read(n,n.readVarint()+n.pos))}};class g3{static read(t,e){return t.readFields(g3._readField,{value:[]},e)}static _readField(t,e,n){t===1&&_v(BigUint64Array,n,e)}}class y3{static read(t,e){return t.readFields(y3._readField,{indices:null,properties:[],numericProps:{}},e)}static _readField(t,e,n){if(t===1)e.indices=g3.read(n,n.readVarint()+n.pos);else if(t===2)e.properties.push(bf.read(n,n.readVarint()+n.pos));else if(t===3){const r=xf.read(n,n.readVarint()+n.pos);e.numericProps[r.key]=r.value}}}let O0t=class xk{static read(t,e){return t.readFields(xk._readField,{scheme:0,cells:null},e)}static _readField(t,e,n){t===1?e.scheme=n.readVarint():t===2&&(e.cells=y3.read(n,n.readVarint()+n.pos))}};function bv(i,t){const e=new EAt(i);return t.read(e)}function F0t(i){const{cells:t,scheme:e}=i,n=t.indices.value.length,r=[];for(let o=0;o<n;o++){const s=e==="h3"?O2(t.indices.value[o]):t.indices.value[o],l={...t.properties[o]};for(const c of Object.keys(t.numericProps))l[c]=t.numericProps[c].value[o];r.push({id:s,properties:l})}return r}const wk="9.2.2",Ek="cartoSpatialTile",N0t={cartoSpatialTile:{scheme:"quadbin",workerUrl:yv(Ek,wk)}},Ck={name:"CARTO Spatial Tile",version:wk,id:Ek,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(i,t)=>IB(i,t),parseSync:IB,worker:!0,options:N0t};function IB(i,t){if(!i)return null;const e=bv(i,O0t),{cells:n}=e,r=t?.cartoSpatialTile?.scheme;return F0t({cells:n,scheme:r})}function Vp(i,t,e=0){if(!i)return t;if(!t)return i;if(e>10)return t;const n={...i};for(const r in t){const o=t[r];o===i||o===t||(typeof o=="object"&&o!==null?n[r]=Vp(i[r],o,e+1):n[r]=o)}return n}function z0t(i,t){const e={};for(const{geoid:n,...r}of t.properties)n in e?$i.warn("Duplicate geoid key in boundary mapping, using first occurance")():e[n]=r;for(const n of["points","lines","polygons"]){const r=i[n];if(r.positions.value.length===0)continue;r.properties=r.properties.map(({geoid:y})=>e[y]);const{positions:o,globalFeatureIds:s}=r;let l=null;n==="lines"&&(l=r.pathIndices.value),n==="polygons"&&(l=r.polygonIndices.value);const c=o.value.length/o.size;for(const y in t.numericProps){const _=t.numericProps[y].value,C=_.constructor,I=new C(c);if(r.numericProps[y]={value:I,size:1},l)for(let k=0;k<l.length-1;k++){const z=l[k],V=l[k+1],X=s.value[z];I.fill(_[X],z,V)}else for(let k=0;k<c;k++){const z=s.value[k];I[k]=_[z]}}}return i}const ff={type:"object",value:null,validate:(i,t)=>t.optional&&i===null||typeof i=="object"&&Array.isArray(i.tiles)&&i.tiles.every(e=>typeof e=="string"),equal:(i,t)=>Or(i,t,2),async:!0};Rp([Ck]);function MB(i){if(i===h3)return"h3";if(i===vv)return"quadbin";throw new Error("Invalid tileset class")}const Tk={data:ff,clusterLevel:{type:"number",value:5,min:1},getPosition:{type:"accessor",value:({id:i})=>{if(typeof i=="string"){const[t,e]=iv(i);return[e,t]}return _k(i,.5).slice(2,4)}},getWeight:{type:"accessor",value:1},refinementStrategy:"no-overlap",tileSize:Up};class v3 extends oc{initializeState(){super.initializeState(),this.state.aggregationCache=new WeakMap,this.state.scheme=MB(this.props.TilesetClass)}updateState(t){const{props:e}=t,n=MB(e.TilesetClass);this.state.scheme!==n&&(this.setState({scheme:n,tileset:null}),this.state.aggregationCache=new WeakMap),super.updateState(t)}renderLayers(){const t=this.state.tileset?.tiles.filter(k=>k.isLoaded&&k.content&&this.state.tileset.isTileVisible(k));if(!t?.length||!this.state.tileset)return null;t.sort((k,z)=>z.zoom-k.zoom);const{getPosition:e,getWeight:n}=this.props,{aggregationCache:r,scheme:o}=this.state,s=o==="h3",l=b0t(t[0]),c=[];let y=!1;const _=this._getAggregationLevels(t);for(const k of t){let z=r.get(k.content);z||(z=new Map,r.set(k.content,z));const V=_0t(k,z,_,l,e,n,s?"h3":"quadbin");y||(y=V),c.push(...z.get(_))}c.sort((k,z)=>Number(z.count-k.count));const C=c?.map(k=>k.id);if(y||(y=!Or(C,this.state.clusterIds,1)),this.setState({clusterIds:C}),y){const k=x0t(c,l),z=w0t(c);z.points.attributes={stats:k},this.setState({data:z})}const I={...this.props,id:"clusters",data:this.state.data,dataComparator:(k,z)=>{const V=k?.points?.properties?.map(H=>H.id),X=z?.points?.properties?.map(H=>H.id);return Or(V,X,1)}};return new rc(this.getSubLayerProps(I))}getPickingInfo(t){const e=t.info;if(e.index!==-1){const{data:n}=t.sourceLayer.props;e.object=k2(n,{globalFeatureId:e.index})}return e}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}filterSubLayer(){return!0}_getAggregationLevels(t){const e=this.state.scheme==="h3",n=t[0];let r,o;e?(r=lf(n.id),o=wy(this.context.viewport,this.state.tileset.opts.tileSize)):(r=n.zoom,o=this.context.viewport.zoom);const s=Math.round(o-r);return Math.round(this.props.clusterLevel)-s}}v3.layerName="ClusterGeoJsonLayer";v3.defaultProps=Tk;class _3 extends Is{getLoadOptions(){const t=this.props.data,e=t&&"scheme"in t?t.scheme:"quadbin";return Vp(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}},cartoSpatialTile:{scheme:e}})}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:e,maxresolution:n}=t,r=t&&"scheme"in t&&t.scheme==="h3"?h3:vv;return[new v3(this.props,{id:`cluster-geojson-layer-${this.props.id}`,data:e,TilesetClass:r,maxZoom:n,loadOptions:this.getLoadOptions()})]}}_3.layerName="ClusterTileLayer";_3.defaultProps=Tk;Rp([Ck]);function U0t(i){return i!=null&&i!==""}const V0t={tileSize:Up};class xv extends oc{_updateAutoHighlight(t){const{hoveredFeatureId:e}=this.state,n=t.object;let r=null;if(n&&(r=n.id),e!==r){let{highlightColor:o}=this.props;typeof o=="function"&&(o=o(t)),this.setState({highlightColor:o,hoveredFeatureId:r})}}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:e}=this.state,n=t.content;return!U0t(e)||!Array.isArray(n)||!this._featureInTile(t,e)?-1:n.findIndex(r=>r.id===e)}_featureInTile(t,e){const n=this.state.tileset,r=n.getTileZoom(t.index),o=t.index.q?"q":"i";let s={[o]:e},l=n.getTileZoom(s);for(;!(l<=r);)s=n.getParentIndex(s),l=n.getTileZoom(s);return s[o]===t.index[o]}}xv.layerName="SpatialIndexTileLayer";xv.defaultProps=V0t;const G0t=i=>{const{data:t}=i,{index:e}=i.tile;return!t||!t.length?null:new pu(i,{getHexagon:n=>n.id,centerHexagon:e,highPrecision:!0})},j0t={data:ff,tileSize:Up};class wv extends Is{initializeState(){pu._checkH3Lib()}getLoadOptions(){const t=this.props.data;return Vp(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}},cartoSpatialTile:{scheme:"h3"}})}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:e}=t;let{minresolution:n,maxresolution:r}=t;this.props.minZoom&&(n=Math.max(n,wy({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(r=Math.min(r,wy({zoom:this.props.maxZoom,latitude:0},this.props.tileSize)));const o=this.getSubLayerClass("spatial-index-tile",xv);return new o(this.props,{id:`h3-tile-layer-${this.props.id}`,data:e,TilesetClass:h3,renderSubLayers:G0t,minZoom:n,maxZoom:r,loadOptions:this.getLoadOptions()})}}wv.layerName="H3TileLayer";wv.defaultProps=j0t;const W0t=`uniform heatmapUniforms {
  vec2 colorDomain;
  vec2 delta;
  float intensity;
  float opacity;
  float radiusPixels;
} heatmap;

uniform sampler2D colorTexture;

vec3 colorGradient(float value) {
  return texture(colorTexture, vec2(value, 0.5)).rgb;
}

const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
  return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
  return 255.0 * dot(color, SHIFT);
}

vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
  bool firstPass = (heatmap.delta.y < 0.5);
  float accumulator = 0.0;

  // Controls quality of heatmap, larger values increase quality at expense of performance
  float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);

  // Gaussian normalization parameters
  float sigma = SUPPORT / 3.0;
  float a = -0.5 / (sigma * sigma);
  float w0 = 0.3989422804014327 / sigma; // 1D normalization
  for (float t = -SUPPORT; t <= SUPPORT; t++) {
    vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
    vec2 delta = percent * heatmap.radiusPixels / texSize;
    vec4 offsetColor = texture(source, texCoord + delta);

    // Unpack float
    float value = unpack(offsetColor.rgb);

    // Gaussian
    float weight = w0 * exp(a * t * t);
    
    accumulator += value * weight;
  }

  if (firstPass) {
    return pack(accumulator);
  }

  // Undo scaling to obtain normalized density
  float density = 10.0 * heatmap.intensity * accumulator / SCALE;
 
  // Domain also in normalized density units
  vec2 domain = heatmap.colorDomain;

  // Apply domain
  float f = (density - domain[0]) / (domain[1] - domain[0]);

  // sqrt/log scaling??
  // float f = (log(density) - log(domain[0] + 1.0)) / (log(domain[1] + 1.0) - log(domain[0] + 1.0));
  // f = sqrt(f);

  // Color map
  vec4 color = vec4(0.0);
  color.rgb = colorGradient(f);

  color.a = smoothstep(0.0, 0.1, f);
  color.a = pow(color.a, 1.0 / 2.2);
  color.a *= heatmap.opacity;

  // Use premultiplied alpha for compatibility with blending in ScreenPass
  color.rgb *= color.a;

  return color;
}
`,Sk={name:"heatmap",uniformPropTypes:{colorDomain:{value:[0,1]},delta:{value:[0,1]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1},radiusPixels:{value:20,min:0,softMax:100}},uniformTypes:{colorDomain:"vec2<f32>",delta:"vec2<f32>",intensity:"f32",opacity:"f32",radiusPixels:"f32"},getUniforms:i=>{if(!i)return{};const{colorDomain:t=[0,1],colorTexture:e,delta:n=[1,0],intensity:r=1,opacity:o=1,radiusPixels:s=20}=i;return{colorDomain:t,colorTexture:e,delta:n,intensity:r,opacity:o,radiusPixels:s}},fs:W0t,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},H0t={format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function F2(i){for(;i.parent&&!i.applyPostProcess;)i=i.parent;return i}class Pk extends Ps{initializeState(){this.id=`draw-callback-${F2(this).props.id}`}_drawLayer(){F2(this).applyPostProcess()}}Pk.layerName="DrawCallbackLayer";function Ik(i){var t;return t=class extends i{draw(e){const{shaderModuleProps:n}=e,{picking:r}=n,o=F2(this);r.isActive||o.enableRTT(e),super.draw(e),r.isActive||o.disableRTT()}},t.layerName=`RTT-${i.layerName}`,t}function b3(i,t){var e;return e=class extends i{initializeState(n){super.initializeState(n),this._createTextures(),this.internalState.postProcess=new jH(t,this.props),this.internalState.postProcess.setup(n)}updateState(n){super.updateState(n),this.internalState.postProcess.setProps(this.props)}renderLayers(){let n=super.renderLayers();return n?(n=Array.isArray(n)?n:[n],[...n,new Pk]):null}_createTextures(){const{device:n}=this.context;this.internalState.renderBuffers=[0,1].map(r=>n.createFramebuffer({id:`layer-fbo-${r}`,colorAttachments:[n.createTexture(H0t)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(n){const{shaderModuleProps:r}=n,{viewport:o}=this.context,{devicePixelRatio:s}=r.project,l=s*o.width,c=s*o.height;this.internalState.renderBuffers.forEach(y=>y.resize({width:l,height:c}))}enableRTT(n){this._resizeBuffers(n),this.internalState.originalRenderPass=this.context.renderPass;const[r]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:r,parameters:{viewport:[0,0,r.width,r.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[n,r]=this.internalState.renderBuffers,{framebuffer:o}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:n,swapBuffer:r,target:o}),this.internalState.renderInProgress=!1}_finalize(){this.internalState.renderBuffers.forEach(n=>{n.destroy()}),this.internalState.renderBuffers=null,this.internalState.postProcess.cleanup()}},e.layerName=`PostProcess${i.layerName}`,e}const X0t=`vec4 copy_filterColor_ext(vec4 color, vec2 texSize, vec2 texCoord) {
  return color;
}
`,q0t={name:"copy",fs:X0t,getUniforms:()=>({}),passes:[{filter:!0}]},K0t={getQuadbin:{type:"accessor",value:i=>i.quadbin}};class x3 extends sc{indexToBounds(){const{data:t,extruded:e,getQuadbin:n}=this.props,r=e?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>_k(n(o,s),r),updateTriggers:{getPolygon:r}}}}x3.layerName="QuadbinLayer";x3.defaultProps=K0t;const Z0t=i=>{const{data:t}=i;if(!t||!t.length)return null;const e=typeof t[0].id=="bigint";return new x3(i,{getQuadbin:e?n=>n.id:n=>g0t(n.id)})},Y0t={data:ff,tileSize:Up};class Ev extends Is{getLoadOptions(){const t=this.props.data;return Vp(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:e,maxresolution:n}=t,r=this.getSubLayerClass("spatial-index-tile",xv);return new r(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:e,TilesetClass:vv,renderSubLayers:Z0t,maxZoom:n,loadOptions:this.getLoadOptions()})}}Ev.layerName="QuadbinTileLayer";Ev.defaultProps=Y0t;const Q0t=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],J0t={format:"rgba8unorm",dimension:"2d",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function Mk(i){const t=Number(u3(i));return Math.pow(4,t)}function Bk(i){const t=Number(lf(i));return Tut(t)}function $0t(i){const t=new Uint8Array(i.length*4);let e=0;for(let n=0;n<i.length;n++){const r=i[n];t[e++]=r[0],t[e++]=r[1],t[e++]=r[2],t[e++]=Number.isFinite(r[3])?r[3]:255}return t}const tgt=`uniform densityUniforms {
  float factor;
} density;
`,egt={name:"density",vs:tgt,uniformTypes:{factor:"f32"}};class Rk extends Ik(rh){getShaders(t){const e=super.getShaders(t);return e.inject={"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density
  weight *= density.factor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},e.modules=[...e.modules,egt],e}draw(t){const e=this.props.data[0];if(e){const n=this.props.elevationScale,{scheme:r}=this.parent.parent.parent.parent.parent.state,o={factor:(r==="h3"?Bk(e.id):Mk(e.id))/n};for(const s of this.state.models)s.shaderInputs.setProps({density:o})}super.draw(t)}}Rk.layerName="RTTSolidPolygonLayer";const igt=b3(Ev,Sk),ngt=b3(wv,Sk),rgt={data:ff,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},colorRange:Q0t,intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class w3 extends Is{initializeState(){this.state={isLoaded:!1,scheme:null,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:t}){const{viewportChanged:e}=t;return this.setState({viewportChanged:e}),t.somethingChanged}updateState(t){const{props:e,oldProps:n}=t;super.updateState(t),Or(e.colorRange,n.colorRange,2)||this._updateColorTexture(t);const r=e.data&&"scheme"in e.data?e.data.scheme:null;this.state.scheme!==r&&(this.setState({scheme:r}),this.state.tiles.clear())}renderLayers(){const{data:t,getWeight:e,colorDomain:n,intensity:r,radiusPixels:o,_subLayerProps:s,updateTriggers:l,onMaxDensityChange:c,onViewportLoad:y,onTileLoad:_,onTileUnload:C,...I}=this.props,k=this.state.scheme==="h3",z=k?"hexagon-cell-hifi":"cell",V={...s,[z]:{...s?.[z],_subLayerProps:{...s?.[z]?._subLayerProps,fill:{...s?.[z]?._subLayerProps?.fill,type:Rk}}}};let X=0,H=0;const $=[...this.state.tiles].filter(ft=>ft.content),Y=$.filter(ft=>ft.isVisible),ct=Y.length?Y:$;for(const ft of ct){const st=ft.content[0],Ut=k?Bk(st.id):Mk(st.id);H=Math.max(ft.userData.maxWeight*Ut,H),X=Math.max(ft.zoom,X)}let rt,nt;k?(rt=2/3*this.context.viewport.zoom-X-2.25,nt=2.2):(rt=this.context.viewport.zoom-X,nt=2),H=H*Math.pow(nt,rt),typeof c=="function"&&c(H);const Ot=k?ngt:igt,Kt=I;return new Ot(Kt,this.getSubLayerProps({id:"heatmap",data:t,getFillColor:0,getElevation:e,elevationScale:H,colorDomain:n,radiusPixels:o,intensity:r,_subLayerProps:V,refinementStrategy:"no-overlap",colorTexture:this.state.colorTexture,extruded:!1,stroked:!1,updateTriggers:{getElevation:l.getWeight},onViewportLoad:ft=>{this.setState({isLoaded:!0}),typeof y=="function"&&y(ft)},onTileLoad:ft=>{let st=-1/0;if(typeof e!="function")st=e;else if(ft.content)for(const Ut of ft.content)st=Math.max(e(Ut,{}),st);ft.userData={maxWeight:st},this.state.tiles.add(ft),typeof _=="function"&&_(ft)},onTileUnload:ft=>{this.state.tiles.delete(ft),typeof C=="function"&&C(ft)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}_updateColorTexture(t){const{colorRange:e}=t.props;let{colorTexture:n}=this.state;const r=$0t(e);n?.destroy(),n=this.context.device.createTexture({...J0t,data:r,width:e.length,height:1}),this.setState({colorTexture:n})}}w3.layerName="HeatmapTileLayer";w3.defaultProps=rgt;const[BB,RB,LB,DB]=[0,1,2,3];class Lk extends Em{getShaders(){const t=super.getShaders();let e=t.vs;return e=e.replaceAll("textBackground.padding.","_padding."),e=e.replace("void main(void) {",`void main(void) {
  vec4 _padding = textBackground.padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...t,vs:e}}}Lk.layerName="EnhancedTextBackgroundLayer";class Dk extends vf{filterSubLayer({layer:t,renderPass:e}){const n=t.id.includes("primary-background");return e==="collision"?n:!n}}Dk.layerName="EnhancedTextLayer";const sgt={...vf.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}};class Cv extends Is{calculatePixelOffset(t){const{getTextAnchor:e,getAlignmentBaseline:n,getRadius:r,getSecondaryText:o,radiusScale:s,secondarySizeScale:l,sizeScale:c}=this.props,y=e==="middle"?0:e==="start"?1:-1,_=n==="center"?0:n==="bottom"?1:-1,C=c/4,I=c*(1+1/4),k=.6*(1-_)*c;let z=t?k:0;e==="middle"&&n==="top"&&o&&(z-=k,z-=l,z+=c);const V=1+1/4;return typeof r=="function"?(X,H)=>{const $=(H?r(X,H):1)*s*V;return[y*($+C),_*($+I)+z]}:[y*(r*s*V+C),_*(r*s*V+I)+z]}calculateBackgroundPadding(){const{getTextAnchor:t,getAlignmentBaseline:e,sizeScale:n}=this.props,r=12*n,o=3*n,s=[0,0,0,0];return e==="top"?s[RB]=o:e==="bottom"?s[DB]=o:(s[RB]=.5*o,s[DB]=.5*o),t==="start"?s[BB]=r:t==="end"?s[LB]=r:(s[BB]=.5*r,s[LB]=.5*r),s}renderTextLayer(t,{updateTriggers:e={},...n}){const{data:r,characterSet:o,fontFamily:s,fontSettings:l,fontWeight:c,outlineColor:y,outlineWidth:_,sizeScale:C,radiusScale:I,getAlignmentBaseline:k,getColor:z,getPosition:V,getTextAnchor:X,updateTriggers:H}=this.props;if(C<2){const $=this.parent?.props?.textSizeScale?"textSizeScale":"sizeScale";$i.warn(`${$} has small value (${C}). Note getTextSize is not supported on PointLabelLayer`)()}return new Dk(this.getSubLayerProps({id:t,data:r,characterSet:o,fontFamily:s,fontSettings:l,fontWeight:c,outlineColor:y,outlineWidth:_,sizeScale:C,getAlignmentBaseline:k,getColor:z,getPosition:V,getTextAnchor:X,updateTriggers:{...H,...e,getPixelOffset:[H.getRadius,H.getTextAnchor,H.getAlignmentBaseline,I,C]}}),{getSize:1,_subLayerProps:{background:{type:Lk}}},n)}renderLayers(){const{getText:t,getSecondaryColor:e,getSecondaryText:n,secondaryOutlineColor:r,secondarySizeScale:o,updateTriggers:s}=this.props,l=this.calculatePixelOffset(!1),c=this.calculateBackgroundPadding();return[this.renderTextLayer(`${s.getText}-primary`,{backgroundPadding:c,getText:t,getPixelOffset:l,background:!0}),!!n&&this.renderTextLayer(`${s.getSecondaryText}-secondary`,{getText:n,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...e&&{getColor:e},...o&&{sizeScale:o},...r&&{outlineColor:r}})]}}Cv.layerName="PointLabelLayer";Cv.defaultProps=sgt;const ogt=`#version 300 es
#define SHADER_NAME raster-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
vec2 tileOrigin = column.offset.xy;
float scale = column.widthScale;
int yIndex = - (gl_InstanceID / BLOCK_WIDTH);
int xIndex = gl_InstanceID + (yIndex * BLOCK_WIDTH);
vec2 cellCenter = scale * vec2(float(xIndex) + 0.5, float(yIndex) - 0.5);
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float cellWidth = column.coverage * scale;
geometry.position = vec4(tileOrigin, 0.0, 1.0);
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
geometry.position.xyz -= project.commonOrigin;
}
geometry.position.xy += cellCenter;
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float halfOffset = project_pixel_size(column.widthScale) / cellWidth;
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
geometry.pickingColor = instancePickingColors;
vec2 base = positions.xy * scale * strokeOffsetRatio * column.coverage * shouldRender;
vec3 cell = vec3(base, project_size(elevation));
DECKGL_FILTER_SIZE(cell, geometry);
geometry.position.xyz += cell;
gl_Position = project_common_position_to_clipspace(geometry.position);
geometry.normal = project_normal(normals);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,agt={...du.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class kk extends Ik(du){getShaders(){const t=super.getShaders(),e=this.props.data,n=e.data.blockSize??Math.sqrt(e.length);return{...t,defines:{...t.defines,BLOCK_WIDTH:n},vs:ogt}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}kk.layerName="RasterColumnLayer";function lgt(i,t){return i.data===t.data&&i.length===t.length}class E3 extends Is{renderLayers(){const{data:t,getElevation:e,getFillColor:n,getLineColor:r,getLineWidth:o,tileIndex:s,updateTriggers:l}=this.props;if(!t||!s)return null;const c=t.blockSize??0,[y,_,C]=vk(s),I=[y,_],k=C/c,z=this.getSubLayerClass("column",kk),{highlightedObjectIndex:V,highlightColor:X}=this.state;return new z(this.props,this.getSubLayerProps({id:"cell",updateTriggers:l,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(n),getLineColor:this.getSubLayerAccessor(r),getLineWidth:this.getSubLayerAccessor(o)}),{data:{data:t,length:c*c},dataComparator:lgt,offset:I,lineWidthScale:k,highlightedObjectIndex:V,highlightColor:X})}getSubLayerAccessor(t){return typeof t!="function"?super.getSubLayerAccessor(t):(e,n)=>{const{data:r,index:o}=n,s=r.data,l=v0t(s.cells,o);return t({properties:l},n)}}getPickingInfo(t){const e=super.getPickingInfo(t);return e.index!==-1&&(e.object=this.getSubLayerAccessor(n=>n)(void 0,{data:this.props,index:e.index})),e}_updateAutoHighlight(t){const{highlightedObjectIndex:e}=this.state;let n=-1;if(t.index!==-1&&(n=t.index),e!==n){let{highlightColor:r}=this.props;typeof r=="function"&&(r=r(t)),this.setState({highlightColor:r,highlightedObjectIndex:n})}}}E3.layerName="RasterLayer";E3.defaultProps=agt;const ugt={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class C3{static read(t,e){return t.readFields(C3._readField,{name:"",type:"",data:null},e)}static _readField(t,e,n){if(t===1)e.name=n.readString();else if(t===2)e.type=n.readString();else if(t===3){const r=ugt[e.type];if(!r)throw Error(`Invalid data type: ${e.type}`);e.data={};const{compression:o}=N2;_v(r,n,e.data,{compression:o})}}}let N2=class Ok{static read(t,e){return t.readFields(Ok._readField,{blockSize:0,bands:[]},e)}static _readField(t,e,n){t===1?e.blockSize=n.readVarint():t===2&&e.bands.push(C3.read(n,n.readVarint()+n.pos))}};const Fk="9.2.2",Nk="cartoRasterTile",cgt={cartoRasterTile:{metadata:null,workerUrl:yv(Nk,Fk)}},hgt={name:"CARTO Raster Tile",version:Fk,id:Nk,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(i,t)=>kB(i,t),parseSync:kB,worker:!0,options:cgt};function kB(i,t){const e=t?.cartoRasterTile?.metadata;if(!i||!e)return null;N2.compression=e.compression;const n=bv(i,N2),{bands:r,blockSize:o}=n,s={};for(let l=0;l<r.length;l++){const{name:c,data:y}=r[l];s[c]=y}return{blockSize:o,cells:{numericProps:s,properties:[]}}}Rp([hgt]);const fgt=i=>{const t=i.tile?.index?.q;return t?new E3(i,{tileIndex:t}):null},dgt={data:ff,refinementStrategy:"no-overlap",tileSize:Up};class pgt extends b3(oc,q0t){filterSubLayer(t){const{tile:e}=t.layer.props;return e?super.filterSubLayer(t):!0}}class T3 extends Is{getLoadOptions(){const t=this.props.data;return Vp(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}}})}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:e,minzoom:n,maxzoom:r,raster_metadata:o}=t,s=this.getSubLayerClass("tile",pgt),l=this.getLoadOptions();return new s(this.props,{id:`raster-tile-layer-${this.props.id}`,data:e,TilesetClass:vv,renderSubLayers:fgt,minZoom:n,maxZoom:r,loadOptions:{...l,cartoRasterTile:{...l?.cartoRasterTile,metadata:o}}})}}T3.layerName="RasterTileLayer";T3.defaultProps=dgt;class S3{static read(t,e){return t.readFields(S3._readField,{properties:[],numericProps:{}},e)}static _readField(t,e,n){if(t===1)e.properties.push(bf.read(n,n.readVarint()+n.pos));else if(t===2){const r=xf.read(n,n.readVarint()+n.pos);e.numericProps[r.key]=r.value}}}const zk="9.2.2",Uk="cartoPropertiesTile",Agt={cartoPropertiesTile:{workerUrl:yv(Uk,zk)}},mgt={name:"CARTO Properties Tile",version:zk,id:Uk,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!0,parse:async(i,t)=>OB(i),parseSync:OB,options:Agt};function OB(i,t){return i?bv(i,S3):null}const Vk="9.2.2",Gk="cartoVectorTile",ggt={cartoVectorTile:{workerUrl:yv(Gk,Vk)}},ygt={name:"CARTO Vector Tile",version:Vk,id:Gk,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(i,t)=>FB(i),parseSync:FB,worker:!0,options:ggt};function vgt(i,t,{startPosition:e,endPosition:n,indices:r}){const o=i.positions.size,s=e*o,l=n*o,c=i.positions.value.subarray(s,l),y=r.slice(1).map(C=>C-e),_=N8(c,y,o);for(let C=0,I=_.length;C<I;++C)t.push(e+_[C])}function _gt(i){const{polygonIndices:t,primitivePolygonIndices:e}=i,n=[];let r=0;for(let o=0;o<t.value.length-1;o++){const s=t.value[o],l=t.value[o+1],c=e.value.indexOf(l),y=e.value.subarray(r,c);r=c,vgt(i,n,{startPosition:s,endPosition:l,indices:y})}i.triangles={value:new Uint32Array(n),size:1}}function FB(i,t){if(!i)return null;const e=bv(i,k0t);return e.polygons&&!e.polygons.triangles&&_gt(e.polygons),e}function bgt(i,t){const e=t?t in i.numericProps:!1,n=new Map;for(let _=0;_<i.pathIndices.value.length-1;_++){const C=i.pathIndices.value[_],I=i.featureIds.value[C];let k;t===void 0?k=I:e?k=i.numericProps[t].value[C]:i.properties[I]&&t in i.properties[I]?k=i.properties[I][t]:k=void 0;const z=Pgt(i,_);(!n.has(k)||z>n.get(k).length)&&n.set(k,{index:_,length:z})}const r=[],o=[],s=[],l=[],c=Ak(n.size,i.numericProps);let y=0;for(const[_,{index:C}]of n){const I=Igt(i,C);r.push(...I);const k=i.pathIndices.value[C],z=i.featureIds.value[k];s.push(y),o.push(i.properties[z]),l.push(i.globalFeatureIds.value[k]),mk(i.numericProps,c,k,y),y++}return c3(r,s,l,c,o)}function xgt(i,t,e){const{west:n,south:r,east:o,north:s}=t,l=(o-n)*(s-r)*1e-4,c=[],y=[],_=[],C=[],I=Ak(i.polygonIndices.value.length-1,i.numericProps);let k=0,z=0;const{extruded:V}=e;for(let X=0;X<i.polygonIndices.value.length-1;X++){const H=i.polygonIndices.value[X],$=i.polygonIndices.value[X+1];if(wgt(i,X)<l)continue;const Y=Tgt(i,X);let ct=-1,rt=[0,0],nt=!1;for(;z<i.triangles.value.length;){const Kt=i.triangles.value[z];if(Kt>=$)break;if(nt){z+=3;continue}const ft=i.triangles.value[z+1],st=i.triangles.value[z+2],Ut=i.positions.value.subarray(Kt*i.positions.size,Kt*i.positions.size+i.positions.size),K=i.positions.value.subarray(ft*i.positions.size,ft*i.positions.size+i.positions.size),dt=i.positions.value.subarray(st*i.positions.size,st*i.positions.size+i.positions.size);if(Cgt(Y,Ut,K,dt))nt=!0;else{const Tt=jk(Ut,K,dt);Tt>ct&&(ct=Tt,rt=[(Ut[0]+K[0]+dt[0])/3,(Ut[1]+K[1]+dt[1])/3])}z+=3}const Ot=nt?Y:rt;if(Egt(Ot,t)){c.push(...Ot);const Kt=i.featureIds.value[H];if(V){const ft=e.getElevation(void 0,{data:i,index:Kt});c.push(ft*e.elevationScale)}y.push(i.properties[Kt]),_.push(k),C.push(i.globalFeatureIds.value[H]),mk(i.numericProps,I,H,k),k++}}return i.numericProps&&Object.keys(I).forEach(X=>{I[X].value=I[X].value.slice(0,k)}),c3(c,_,C,I,y,V?3:2)}function wgt(i,t){const{positions:{value:e,size:n},polygonIndices:{value:r},triangles:{value:o}}=i,s=r[t],l=r[t+1];let c=0,y=0;for(;y<o.length&&!(o[y]>=s);)y+=3;for(;y<o.length;){const _=o[y];if(_>=l)break;const C=o[y+1],I=o[y+2],k=e.subarray(_*n,_*n+n),z=e.subarray(C*n,C*n+n),V=e.subarray(I*n,I*n+n);c+=jk(k,z,V),y+=3}return c}function Egt([i,t],{west:e,east:n,south:r,north:o}){return i>=e&&i<n&&t>=r&&t<o}function Cgt(i,t,e,n){const r=Math.abs((e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1]))/2,o=Math.abs((t[0]-i[0])*(e[1]-i[1])-(e[0]-i[0])*(t[1]-i[1]))/2,s=Math.abs((e[0]-i[0])*(n[1]-i[1])-(n[0]-i[0])*(e[1]-i[1]))/2,l=Math.abs((n[0]-i[0])*(t[1]-i[1])-(t[0]-i[0])*(n[1]-i[1]))/2;return Math.abs(r-(o+s+l))<1e-10}function jk([i,t],[e,n],[r,o]){return Math.abs((i*(n-o)+e*(o-t)+r*(t-n))/2)}function Tgt(i,t){const{positions:{value:e,size:n}}=i,r=n*i.polygonIndices.value[t],o=n*i.polygonIndices.value[t+1];let s=1/0,l=1/0,c=-1/0,y=-1/0;for(let _=r;_<o;_+=n){const[C,I]=e.subarray(_,_+2);s=Math.min(s,C),l=Math.min(l,I),c=Math.max(c,C),y=Math.max(y,I)}return[(s+c)/2,(l+y)/2]}function Sgt(i,t){const{positions:{value:e}}=i,[n,r,o,s]=e.subarray(t,t+4);return Math.sqrt(Math.pow(o-n,2)+Math.pow(s-r,2))}function Pgt(i,t){const{positions:{size:e}}=i,n=e*i.pathIndices.value[t],r=e*i.pathIndices.value[t+1];let o=0;for(let s=n;s<r;s+=e)o+=Sgt(i,s);return o}function Igt(i,t){const{positions:{value:e},pathIndices:{value:n}}=i,r=n[t]*2,o=(n[t+1]*2-r)/2;if(o===2){const[l,c,y,_]=e.subarray(r,r+4);return[(l+y)/2,(c+_)/2]}const s=r+Math.floor(o/2)*2;return[e[s],e[s+1]]}Rp([mgt,ygt]);const Mgt={...Fp.defaultProps,autoLabels:!1,data:ff,dataComparator:ff.equal,tileSize:Up};class P3 extends Fp{constructor(...t){super(...t)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(t){const{props:e}=t;if(e.data){super.updateState(t);const n=new URL(e.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:n})}}getLoadOptions(){const t=this.props.data;return Vp(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}},gis:{format:"binary"}})}async getTileData(t){const e=this.props.data,{tiles:n,properties_tiles:r}=e,o=uf(n,t);if(!o)return Promise.reject("Invalid URL");const s=this.getLoadOptions(),{fetch:l}=this.props,{signal:c}=t,y=l(o,{propName:"data",layer:this,loadOptions:s,signal:c});if(!r)return await y;const _=uf(r,t);if(!_)return Promise.reject("Invalid properties URL");const C=l(_,{propName:"data",layer:this,loadOptions:s,signal:c}),[I,k]=await Promise.all([y,C]);return I?k?z0t(I,k):I:null}renderSubLayers(t){if(t.data===null)return null;const e=t.tile.bbox,n=[],r={"points-text":{type:Cv,...t?._subLayerProps?.["points-text"],extensions:[new $w,...t.extensions||[],...t?._subLayerProps?.["points-text"]?.extensions||[]]}};if(this.state.mvt)n.push(super.renderSubLayers(t));else{const{west:o,south:s,east:l,north:c}=e,y=[new dv,...t.extensions||[]],_={clipBounds:[o,s,l,c]},C=k=>({[k]:{..._,...t?._subLayerProps?.[k],extensions:[...y,...t?._subLayerProps?.[k]?.extensions||[]]}}),I={...t,data:{...t.data,tileBbox:e},autoHighlight:!1,_subLayerProps:{...t._subLayerProps,...r,...C("polygons-fill"),...C("polygons-stroke"),...C("linestrings")}};n.push(new rc(I))}if(n[0]&&t.autoLabels){const o=pk();t.data.lines&&t.data.lines.positions.value.length>0&&(o.points=bgt(t.data.lines,typeof t.autoLabels=="object"?t.autoLabels.uniqueIdProperty:void 0)),t.data.polygons&&t.data.polygons.positions.value.length>0&&(o.points=xgt(t.data.polygons,e,t)),n.push(n[0].clone({id:`${t.id}-labels`,data:o,pickable:!1,autoHighlight:!1}))}return n}renderLayers(){const t=super.renderLayers();if(!this.props.autoLabels)return t;const e=t.flat().filter(Boolean);return e.sort((n,r)=>{const o=n.id.includes("labels"),s=r.id.includes("labels");return o&&!s?1:!o&&s?-1:0}),e.map(n=>n.id.includes("labels")?n.clone({highlightedObjectIndex:-1}):n)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}P3.layerName="VectorTileLayer";P3.defaultProps=Mgt;var On={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},Bgt={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},Rgt={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},Lgt={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},Dgt={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},kgt={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},Ogt={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},Fgt={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},Ngt={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},zgt={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},Ugt={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},Vgt={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},Ggt={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},jgt={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},Wgt={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},Hgt={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},Xgt={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},qgt={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},Kgt={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},Zgt={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},Ygt={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},Qgt={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},Jgt={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},$gt={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},tyt={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},eyt={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},iyt={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},nyt={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},ryt={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},syt={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},oyt={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},ayt={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},lyt={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},uyt={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},cyt={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},hyt={...On.BuGn,tags:["quantitative"]},fyt={...On.BuPu,tags:["quantitative"]},dyt={...On.GnBu,tags:["quantitative"]},pyt={...On.OrRd,tags:["quantitative"]},Ayt={...On.PuBu,tags:["quantitative"]},myt={...On.PuBuGn,tags:["quantitative"]},gyt={...On.PuRd,tags:["quantitative"]},yyt={...On.RdPu,tags:["quantitative"]},vyt={...On.YlGn,tags:["quantitative"]},_yt={...On.YlGnBu,tags:["quantitative"]},byt={...On.YlOrBr,tags:["quantitative"]},xyt={...On.YlOrRd,tags:["quantitative"]},wyt={...On.Accent,tags:["qualitative"]},Eyt={...On.Dark2,tags:["qualitative"]},Cyt={...On.Paired,tags:["qualitative"]},Tyt={...On.Pastel1,tags:["qualitative"]},Syt={...On.Pastel2,tags:["qualitative"]},Pyt={...On.Set1,tags:["qualitative"]},Iyt={...On.Set2,tags:["qualitative"]},Myt={...On.Set3,tags:["qualitative"]},Byt={...On.Blues,tags:["quantitative"]},Ryt={...On.Greens,tags:["quantitative"]},Lyt={...On.Greys,tags:["quantitative"]},Dyt={...On.Oranges,tags:["quantitative"]},kyt={...On.Purples,tags:["quantitative"]},Oyt={...On.Reds,tags:["quantitative"]},Fyt={...On.BrBG,tags:["diverging"]},Nyt={...On.PiYG,tags:["diverging"]},zyt={...On.PRGn,tags:["diverging"]},Uyt={...On.PuOr,tags:["diverging"]},Vyt={...On.RdBu,tags:["diverging"]},Gyt={...On.RdGy,tags:["diverging"]},jyt={...On.RdYlBu,tags:["diverging"]},Wyt={...On.RdYlGn,tags:["diverging"]},Hyt={...On.Spectral,tags:["diverging"]};const Xyt=Object.freeze(Object.defineProperty({__proto__:null,Antique:syt,ArmyRose:Jgt,BluGrn:Ngt,BluYl:Ggt,Bold:oyt,BrwnYl:Qgt,Burg:Bgt,BurgYl:Rgt,DarkMint:zgt,Earth:ryt,Emrld:Ugt,Fall:$gt,Geyser:tyt,Magenta:Kgt,Mint:Fgt,OrYel:Dgt,Pastel:ayt,Peach:kgt,PinkYl:Ogt,Prism:lyt,Purp:Hgt,PurpOr:Xgt,RedOr:Lgt,Safe:uyt,Sunset:qgt,SunsetDark:Zgt,Teal:jgt,TealGrn:Wgt,TealRose:iyt,Temps:eyt,Tropic:nyt,Vivid:cyt,ag_GrnYl:Vgt,ag_Sunset:Ygt,cb_Accent:wyt,cb_Blues:Byt,cb_BrBG:Fyt,cb_BuGn:hyt,cb_BuPu:fyt,cb_Dark2:Eyt,cb_GnBu:dyt,cb_Greens:Ryt,cb_Greys:Lyt,cb_OrRd:pyt,cb_Oranges:Dyt,cb_PRGn:zyt,cb_Paired:Cyt,cb_Pastel1:Tyt,cb_Pastel2:Syt,cb_PiYG:Nyt,cb_PuBu:Ayt,cb_PuBuGn:myt,cb_PuOr:Uyt,cb_PuRd:gyt,cb_Purples:kyt,cb_RdBu:Vyt,cb_RdGy:Gyt,cb_RdPu:yyt,cb_RdYlBu:jyt,cb_RdYlGn:Wyt,cb_Reds:Oyt,cb_Set1:Pyt,cb_Set2:Iyt,cb_Set3:Myt,cb_Spectral:Hyt,cb_YlGn:vyt,cb_YlGnBu:_yt,cb_YlOrBr:byt,cb_YlOrRd:xyt},Symbol.toStringTag,{value:"Module"})),I3="PurpOr",M3=[204,204,204],qyt=[119,119,119];function B3(i,t){const e=Xyt[i];let n=t;hf(e,`Palette "${i}" not found. Expected a CARTOColors string`);const r=Object.keys(e).filter(c=>c!=="tags").map(Number),o=Math.max(...r),s=Math.min(...r);!Number.isInteger(t)||t>o?n=o:t<s&&(n=s);let l=e[n];return e.tags&&e.tags.includes("qualitative")&&(l=l.slice(0,-1)),l.map(c=>Kyt(c))}function Kyt(i){let t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(i);return t?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),255]:(t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(i),t?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),parseInt(t[4]+t[4],16)]:(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),255]:(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),hf(t,`Hexadecimal color "${i}" was not parsed correctly`),[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16)])))}const Zyt=Object.freeze(["function","string"]);function R3(i,t,e){return hf(typeof t=="object",'Expected "data" to be an object'),hf(Zyt.includes(typeof i),'Expected "attr" to be a function or string'),typeof i=="function"?i(t,e):t?.properties?.[i]}function Yyt({attr:i,domain:t,colors:e=I3,nullColor:n=M3}){hf(Array.isArray(t),'Expected "domain" to be an array of numbers');const r=typeof e=="string"?B3(e,t.length+1):e,o=LF().domain(t).range(r);return(s,l)=>{const c=R3(i,s,l);return typeof c=="number"&&Number.isFinite(c)?o(c):n}}function Qyt({attr:i,domain:t,colors:e=I3,nullColor:n=M3,othersColor:r=qyt}){hf(Array.isArray(t),'Expected "domain" to be an array of numbers or strings');const o={},s=typeof e=="string"?B3(e,t.length):e;for(const[l,c]of t.entries())o[c]=s[l];return(l,c)=>{const y=R3(i,l,c);return typeof y=="number"&&Number.isFinite(y)||typeof y=="string"?o[y]||r:n}}function Jyt({attr:i,domain:t,colors:e=I3,nullColor:n=M3}){hf(Array.isArray(t),'Expected "domain" to be an array of numbers');const r=typeof e=="string"?B3(e,t.length):e,o=RF().domain(t).range(r);return(s,l)=>{const c=R3(i,s,l);return typeof c=="number"&&Number.isFinite(c)?o(c):n}}const $yt={ClusterTileLayer:_3,H3TileLayer:wv,HeatmapTileLayer:w3,PointLabelLayer:Cv,QuadbinTileLayer:Ev,RasterTileLayer:T3,VectorTileLayer:P3};function z2(i,t=""){if(!i)throw new Error(`JSON conversion error ${t}`)}function tvt(i,t){const e=ivt(t);let n=i;for(const r of e)n=evt(n)?n[r]:void 0;return n}function evt(i){return i!==null&&typeof i=="object"}const NB={};function ivt(i){if(typeof i=="string"){let t=NB[i];return t||(t=i.split("."),NB[i]=t),t}return Array.isArray(i)?i:[i]}var ob={exports:{}},zB;function nvt(){return zB||(zB=1,(function(i,t){(function(e){var n="Compound",r="Identifier",o="MemberExpression",s="Literal",l="ThisExpression",c="CallExpression",y="UnaryExpression",_="BinaryExpression",C="LogicalExpression",I="ConditionalExpression",k="ArrayExpression",z=46,V=44,X=39,H=34,$=40,Y=41,ct=91,rt=93,nt=63,Ot=59,Kt=58,ft=function(Le,fe){var _i=new Error(Le+" at character "+fe);throw _i.index=fe,_i.description=Le,_i},st=!0,Ut={"-":st,"!":st,"~":st,"+":st},K={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},dt=function(Le){var fe=0,_i;for(var ei in Le)(_i=ei.length)>fe&&Le.hasOwnProperty(ei)&&(fe=_i);return fe},Tt=dt(Ut),ue=dt(K),Rt={true:!0,false:!1,null:null},Ft="this",Gt=function(Le){return K[Le]||0},se=function(Le,fe,_i){var ei=Le==="||"||Le==="&&"?C:_;return{type:ei,operator:Le,left:fe,right:_i}},le=function(Le){return Le>=48&&Le<=57},de=function(Le){return Le===36||Le===95||Le>=65&&Le<=90||Le>=97&&Le<=122||Le>=128&&!K[String.fromCharCode(Le)]},ye=function(Le){return Le===36||Le===95||Le>=65&&Le<=90||Le>=97&&Le<=122||Le>=48&&Le<=57||Le>=128&&!K[String.fromCharCode(Le)]},Oe=function(Le){for(var fe=0,_i=Le.charAt,ei=Le.charCodeAt,ii=function(Ke){return _i.call(Le,Ke)},Qe=function(Ke){return ei.call(Le,Ke)},yi=Le.length,cn=function(){for(var Ke=Qe(fe);Ke===32||Ke===9||Ke===10||Ke===13;)Ke=Qe(++fe)},Ni=function(){var Ke=Xn(),bi,Oi;if(cn(),Qe(fe)===nt){if(fe++,bi=Ni(),bi||ft("Expected expression",fe),cn(),Qe(fe)===Kt)return fe++,Oi=Ni(),Oi||ft("Expected expression",fe),{type:I,test:Ke,consequent:bi,alternate:Oi};ft("Expected :",fe)}else return Ke},Pi=function(){cn();for(var Ke=Le.substr(fe,ue),bi=Ke.length;bi>0;){if(K.hasOwnProperty(Ke)&&(!de(Qe(fe))||fe+Ke.length<Le.length&&!ye(Qe(fe+Ke.length))))return fe+=bi,Ke;Ke=Ke.substr(0,--bi)}return!1},Xn=function(){var Ke,bi,Oi,on,Ar,Lt,je,$e,di;if(Lt=xi(),bi=Pi(),!bi)return Lt;for(Ar={value:bi,prec:Gt(bi)},je=xi(),je||ft("Expected expression after "+bi,fe),on=[Lt,Ar,je];(bi=Pi())&&(Oi=Gt(bi),Oi!==0);){for(Ar={value:bi,prec:Oi},di=bi;on.length>2&&Oi<=on[on.length-2].prec;)je=on.pop(),bi=on.pop().value,Lt=on.pop(),Ke=se(bi,Lt,je),on.push(Ke);Ke=xi(),Ke||ft("Expected expression after "+di,fe),on.push(Ar,Ke)}for($e=on.length-1,Ke=on[$e];$e>1;)Ke=se(on[$e-1].value,on[$e-2],Ke),$e-=2;return Ke},xi=function(){var Ke,bi,Oi;if(cn(),Ke=Qe(fe),le(Ke)||Ke===z)return wi();if(Ke===X||Ke===H)return mn();if(Ke===ct)return sr();for(bi=Le.substr(fe,Tt),Oi=bi.length;Oi>0;){if(Ut.hasOwnProperty(bi)&&(!de(Qe(fe))||fe+bi.length<Le.length&&!ye(Qe(fe+bi.length))))return fe+=Oi,{type:y,operator:bi,argument:xi(),prefix:!0};bi=bi.substr(0,--Oi)}return de(Ke)||Ke===$?tr():!1},wi=function(){for(var Ke="",bi,Oi;le(Qe(fe));)Ke+=ii(fe++);if(Qe(fe)===z)for(Ke+=ii(fe++);le(Qe(fe));)Ke+=ii(fe++);if(bi=ii(fe),bi==="e"||bi==="E"){for(Ke+=ii(fe++),bi=ii(fe),(bi==="+"||bi==="-")&&(Ke+=ii(fe++));le(Qe(fe));)Ke+=ii(fe++);le(Qe(fe-1))||ft("Expected exponent ("+Ke+ii(fe)+")",fe)}return Oi=Qe(fe),de(Oi)?ft("Variable names cannot start with a number ("+Ke+ii(fe)+")",fe):Oi===z&&ft("Unexpected period",fe),{type:s,value:parseFloat(Ke),raw:Ke}},mn=function(){for(var Ke="",bi=ii(fe++),Oi=!1,on;fe<yi;)if(on=ii(fe++),on===bi){Oi=!0;break}else if(on==="\\")switch(on=ii(fe++),on){case"n":Ke+=`
`;break;case"r":Ke+="\r";break;case"t":Ke+="	";break;case"b":Ke+="\b";break;case"f":Ke+="\f";break;case"v":Ke+="\v";break;default:Ke+=on}else Ke+=on;return Oi||ft('Unclosed quote after "'+Ke+'"',fe),{type:s,value:Ke,raw:bi+Ke+bi}},zi=function(){var Ke=Qe(fe),bi=fe,Oi;for(de(Ke)?fe++:ft("Unexpected "+ii(fe),fe);fe<yi&&(Ke=Qe(fe),ye(Ke));)fe++;return Oi=Le.slice(bi,fe),Rt.hasOwnProperty(Oi)?{type:s,value:Rt[Oi],raw:Oi}:Oi===Ft?{type:l}:{type:r,name:Oi}},cr=function(Ke){for(var bi,Oi=[],on,Ar=!1,Lt=0;fe<yi;)if(cn(),bi=Qe(fe),bi===Ke){Ar=!0,fe++,Ke===Y&&Lt&&Lt>=Oi.length&&ft("Unexpected token "+String.fromCharCode(Ke),fe);break}else if(bi===V){if(fe++,Lt++,Lt!==Oi.length){if(Ke===Y)ft("Unexpected token ,",fe);else if(Ke===rt)for(var je=Oi.length;je<Lt;je++)Oi.push(null)}}else on=Ni(),(!on||on.type===n)&&ft("Expected comma",fe),Oi.push(on);return Ar||ft("Expected "+String.fromCharCode(Ke),fe),Oi},tr=function(){var Ke,bi;for(Ke=Qe(fe),Ke===$?bi=xn():bi=zi(),cn(),Ke=Qe(fe);Ke===z||Ke===ct||Ke===$;)fe++,Ke===z?(cn(),bi={type:o,computed:!1,object:bi,property:zi()}):Ke===ct?(bi={type:o,computed:!0,object:bi,property:Ni()},cn(),Ke=Qe(fe),Ke!==rt&&ft("Unclosed [",fe),fe++):Ke===$&&(bi={type:c,arguments:cr(Y),callee:bi}),cn(),Ke=Qe(fe);return bi},xn=function(){fe++;var Ke=Ni();if(cn(),Qe(fe)===Y)return fe++,Ke;ft("Unclosed (",fe)},sr=function(){return fe++,{type:k,elements:cr(rt)}},qn=[],Bn,er;fe<yi;)Bn=Qe(fe),Bn===Ot||Bn===V?fe++:(er=Ni())?qn.push(er):fe<yi&&ft('Unexpected "'+ii(fe)+'"',fe);return qn.length===1?qn[0]:{type:n,body:qn}};Oe.version="0.3.5",Oe.toString=function(){return"JavaScript Expression Parser (JSEP) v"+Oe.version},Oe.addUnaryOp=function(Le){return Tt=Math.max(Le.length,Tt),Ut[Le]=st,this},Oe.addBinaryOp=function(Le,fe){return ue=Math.max(Le.length,ue),K[Le]=fe,this},Oe.addLiteral=function(Le,fe){return Rt[Le]=fe,this},Oe.removeUnaryOp=function(Le){return delete Ut[Le],Le.length===Tt&&(Tt=dt(Ut)),this},Oe.removeAllUnaryOps=function(){return Ut={},Tt=0,this},Oe.removeBinaryOp=function(Le){return delete K[Le],Le.length===ue&&(ue=dt(K)),this},Oe.removeAllBinaryOps=function(){return K={},ue=0,this},Oe.removeLiteral=function(Le){return delete Rt[Le],this},Oe.removeAllLiterals=function(){return Rt={},this},i.exports?t=i.exports=Oe:t.parse=Oe})()})(ob,ob.exports)),ob.exports}var rvt=nvt();const svt=df(rvt),UB={"||":(i,t)=>i||t,"&&":(i,t)=>i&&t,"|":(i,t)=>i|t,"^":(i,t)=>i^t,"&":(i,t)=>i&t,"==":(i,t)=>i==t,"!=":(i,t)=>i!=t,"===":(i,t)=>i===t,"!==":(i,t)=>i!==t,"<":(i,t)=>i<t,">":(i,t)=>i>t,"<=":(i,t)=>i<=t,">=":(i,t)=>i>=t,"<<":(i,t)=>i<<t,">>":(i,t)=>i>>t,">>>":(i,t)=>i>>>t,"+":(i,t)=>i+t,"-":(i,t)=>i-t,"*":(i,t)=>i*t,"/":(i,t)=>i/t,"%":(i,t)=>i%t},ovt={"-":i=>-i,"+":i=>+i,"~":i=>~i,"!":i=>!i};function VB(i,t){return i.map(function(e){return to(e,t)})}function GB(i,t){const e=to(i.object,t);let n;if(i.computed?n=to(i.property,t):n=i.property.name,/^__proto__|prototype|constructor$/.test(n))throw Error(`Access to member "${n}" disallowed.`);return[e,e[n]]}function to(i,t){const e=i;switch(e.type){case"ArrayExpression":return VB(e.elements,t);case"BinaryExpression":return UB[e.operator](to(e.left,t),to(e.right,t));case"CallExpression":let n,r,o;return e.callee.type==="MemberExpression"?(o=GB(e.callee,t),n=o[0],r=o[1]):r=to(e.callee,t),typeof r!="function"?void 0:r.apply(n,VB(e.arguments,t));case"ConditionalExpression":return to(e.test,t)?to(e.consequent,t):to(e.alternate,t);case"Identifier":return t[e.name];case"Literal":return e.value;case"LogicalExpression":return e.operator==="||"?to(e.left,t)||to(e.right,t):e.operator==="&&"?to(e.left,t)&&to(e.right,t):UB[e.operator](to(e.left,t),to(e.right,t));case"MemberExpression":return GB(e,t)[1];case"ThisExpression":return t;case"UnaryExpression":return ovt[e.operator](to(e.argument,t));default:return}}const ab={"-":i=>i};function Wk(i,t){if(i in ab)return ab[i];let e;const n=svt(i);return n.type==="Identifier"?e=r=>tvt(r,i):(U2(n,r=>{if(r.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),e=r=>to(n,r)),ab[i]=e,e}function U2(i,t){if(Array.isArray(i))i.forEach(e=>U2(e,t));else if(i&&typeof i=="object"){i.type&&t(i);for(const e in i)U2(i[e],t)}}const Ey="@@=",jB="@@#",avt="@@type",Hk="@@function",WB=i=>i&&typeof i=="object";class V2{constructor(...t){this.typeKey=avt,this.functionKey=Hk,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=Wk,this.preProcessClassProps=(e,n)=>n,this.postProcessConvertedJson=e=>e;for(const e of t)this.merge(e)}merge(t){for(const e in t)switch(e){case"layers":case"views":Object.assign(this.classes,t[e]);break;default:if(e in this){const n=t[e];this[e]=WB(this[e])?Object.assign(this[e],n):n}}}validate(t){return z2(!this.typeKey||typeof this.typeKey=="string"),z2(WB(this.classes)),!0}}function lvt(i){return typeof i=="string"&&i.startsWith(Ey)}function uvt(i){return i.replace(Ey,"")}function Xk(i,t){const e={};for(const n in i){let r=i[n];lvt(r)&&(r=uvt(r),r=Wk(r)),e[n]=r}return e}function cvt(i,t,e){const n=e.classes[i],r=e.reactComponents[i];if(!n&&!r){const{log:o}=e;if(o){const s=JSON.stringify(t,null,0).slice(0,40);o.warn(`JSON converter: No registered class of type ${i}(${s}...)  `)}return null}return n?hvt(n,t,e):fvt(r,t,e)}function hvt(i,t,e){return e.preProcessClassProps&&(t=e.preProcessClassProps(i,t,e)),t=Xk(t),new i(t)}function fvt(i,t,e){const{React:n}=e,{children:r=[]}=t;return delete t.children,e.preProcessClassProps&&(t=e.preProcessClassProps(i,t,e)),t=Xk(t),n.createElement(i,t,r)}function dvt(i,t,e){const n=e.functions[i];if(!n){const{log:r}=e;if(r){const o=JSON.stringify(t,null,0).slice(0,40);r.warn(`JSON converter: No registered function ${i}(${o}...)  `)}return null}return n(t)}function pvt(i){return typeof i=="string"?JSON.parse(i):i}const L3=i=>i&&typeof i=="object";class Avt{constructor(t){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(t)}finalize(){}setProps(t){"configuration"in t&&(this.configuration=t.configuration instanceof V2?t.configuration:new V2(t.configuration)),"onJSONChange"in t&&(this.onJSONChange=t.onJSONChange)}mergeConfiguration(t){this.configuration.merge(t)}convert(t){if(!t||t===this.json)return this.convertedJson;this.json=t;const e=pvt(t);let n=mvt(e,this.configuration);return n=this.configuration.postProcessConvertedJson(n),this.convertedJson=n,n}convertJson(t){return this.convert(t)}}function mvt(i,t){return t=new V2(t),D3(i,"",t)}function D3(i,t,e){return Array.isArray(i)?i.map((n,r)=>D3(n,String(r),e)):gvt(i,e)?yvt(i,e):L3(i)?Hk in i?vvt(i,e):k3(i,e):typeof i=="string"?_vt(i,t,e):i}function gvt(i,t){const{typeKey:e}=t;return L3(i)&&!!i[e]}function yvt(i,t){const{typeKey:e}=t,n=i[e];let r={...i};return delete r[e],r=k3(r,t),cvt(n,r,t)}function vvt(i,t){const{functionKey:e}=t,n=i[e];let r={...i};return delete r[e],r=k3(r,t),dvt(n,r,t)}function k3(i,t){z2(L3(i));const e={};for(const n in i){const r=i[n];e[n]=D3(r,n,t)}return e}function _vt(i,t,e){if(i.startsWith(Ey)&&e.convertFunction)return i=i.replace(Ey,""),e.convertFunction(i,e);if(i.startsWith(jB)){if(i=i.replace(jB,""),e.constants[i])return e.constants[i];const[n,r]=i.split(".");return e.enumerations[n][r]}return i}const bvt={classes:{...hst,...m0t,...WAt,...vft,...$yt},functions:{colorBins:Yyt,colorCategories:Qyt,colorContinuous:Jyt}},qk=new Avt({configuration:bvt}),xvt={[pv.layerName]:["getFillColor"],[uv.layerName]:["getFillColor"],[pu.layerName]:["getFillColor"],[Fp.layerName]:["getFillColor"],[sv.layerName]:["getFillColor"],[rv.layerName]:["getFillColor"],[lv.layerName]:["getColor"],[bm.layerName]:["getTargetColor","getSourceColor"],[du.layerName]:["getFillColor"],[rc.layerName]:["getFillColor"],[Op.layerName]:["getColor"],[qy.layerName]:["getColor"],[nh.layerName]:["getColor"],[xm.layerName]:["getColor"],[sh.layerName]:["getFillColor"],[wm.layerName]:["getFillColor","getColor","getLineColor"],[rh.layerName]:["getFillColor"],[vf.layerName]:["getColor"],[Pm.layerName]:["getColor"],[cf.layerName]:["getColor"]},wvt=({object:i,objectInfo:t,originalFillFunction:e})=>{const n=typeof e=="function"?e(i,t):e;if(Array.isArray(n))return[n[0]||0,n[1]||0,n[2]||0,n[3]||255];if(typeof n=="string"&&n.startsWith("@@=")){const r=qk.convert({originalColor:n}).originalColor(i);return[r[0]||0,r[1]||0,r[2]||0,r[3]||255]}return null},HB=({isSelected:i,object:t,objectInfo:e,opacity:n,originalFillFunction:r})=>{const o=wvt({object:t,objectInfo:e,originalFillFunction:r});if(!o)return null;let s=0;return i?s=Math.max(typeof o[3]=="number"?o[3]:n,n):s=Math.min(typeof o[3]=="number"?o[3]:n,n),[o[0]||0,o[1]||0,o[2]||0,s]},Evt=({isSelected:i,object:t,objectInfo:e,originalFillFunction:n,selectedColor:r,selectedOpacity:o=255,unselectedColor:s,unselectedOpacity:l=Math.floor(255*.4)})=>i?HB({opacity:o,isSelected:!0,object:t,objectInfo:e,originalFillFunction:n})||r:HB({opacity:l,isSelected:!1,object:t,objectInfo:e,originalFillFunction:n})||s,pm={selection:{indices:{},objects:{}}},XB=(i,t)=>{const e=t.match(/{(.*?)}/g);return e&&e.forEach(n=>{const r=n.substring(1,n.length-1);Object.hasOwn(i.object,r)?t=t.replace(n,i.object[r]):Object.hasOwn(i.object,"properties")&&Object.hasOwn(i.object.properties,r)&&(t=t.replace(n,i.object.properties[r]))}),t};function Cvt(i,t){return t.id?i.getElementState(t.id,"selection")??pm:pm}function Tvt(i,t){if(!t.id)return pm;const e=i.getStringValue(t);return(e?ub.parse(e):null)??pm}function Svt(i,t,e,n){i.id&&t.setStringValue(i,JSON.stringify(e.value),{fromUi:e.fromUi},n)}const Pvt=i=>{const{height:t,width:e,expanded:n}=qB(QB),{element:r,fragmentId:o,isLightTheme:s,theme:l,widgetMgr:c}=i,{selectionMode:y,tooltip:_,useContainerWidth:C}=r,I=n??!1,[k,z]=zF({element:r,getDefaultState:Cvt,getStateFromWidgetMgr:Tvt,updateWidgetMgrState:Svt,widgetMgr:c,fragmentId:o}),[V,X]=Re.useState(null),{height:H,width:$}=Zit({element:r,isFullScreen:I,shouldUseContainerWidth:C,container:{height:t,width:e},heightFallback:V?.initialViewState?.height||l.sizes.defaultMapHeight}),[Y,ct]=Re.useState(null),rt=y[0],nt=rt!==void 0,Ot=nt&&Object.keys(k.selection.indices).length>0,Kt=Re.useMemo(()=>Object.freeze(ub.parse(r.json)),[I,s,r.json]),ft=Re.useMemo(()=>{const K={...Kt};if(K.mapStyle||(K.mapStyle=s?"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json":"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json"),(K?.mapProvider=="carto"||K?.mapStyle&&K.mapStyle?.indexOf("cartocdn")>=0)&&!K.cartoKey&&(K.cartoKey="x7g2plm9yq8vfrc"),K.layers){const dt=Object.values(k.selection.indices).some(ue=>ue?.length),Tt=K.layers.some(ue=>Object.hasOwn(ue,"pickable"));K.layers=K.layers.map(ue=>{if(!ue||Array.isArray(ue)||!nt)return ue;Tt||(ue.pickable=!0);const Rt=`${ue.id||null}`,Ft=k?.selection?.indices?.[Rt]||[],Gt=xvt[ue["@@type"]];if(!Gt)return ue;const se={...ue};return Gt.forEach(le=>{se.updateTriggers={[le]:[...se.updateTriggers?.[le]||[],Ft,dt]};const de=!dt,ye=ue[le];if(de||!ye)return se;const Oe=255,Le=Math.floor(255*.4),fe=nC(l.colors.primary),_i=[fe[0],fe[1],fe[2],Oe],ei=nC(l.colors.gray20),ii=[ei[0],ei[1],ei[2],Le],Qe=(yi,cn)=>Evt({isSelected:Ft.includes(cn.index),object:yi,objectInfo:cn,originalFillFunction:ye,selectedColor:_i,unselectedColor:ii,selectedOpacity:Oe,unselectedOpacity:Le});se[le]=Qe}),se})}return delete K?.views,qk.convert(K)},[k.selection.indices,s,nt,Kt,l.colors.gray20,l.colors.primary]);Re.useEffect(()=>{if(!MF(ft.initialViewState,Y)){const K=Object.keys(ft.initialViewState).reduce((dt,Tt)=>ft.initialViewState[Tt]===Y?.[Tt]?dt:{...dt,[Tt]:ft.initialViewState[Tt]},{});X(dt=>({...dt,...K})),ct(ft.initialViewState)}},[ft.initialViewState,Y,V]);const st=Re.useCallback(K=>{if(!K?.object||!_)return null;const dt=ub.parse(_);return dt.html?dt.html=XB(K,dt.html):dt.text=XB(K,dt.text),dt},[_]),Ut=Re.useCallback(({viewState:K})=>{X(K)},[X]);return{createTooltip:st,data:k,deck:ft,hasActiveSelection:Ot,height:H,isSelectionModeActivated:nt,onViewStateChange:Ut,selectionMode:rt,setSelection:z,viewState:V,width:$}};Rp([Yx,wp]);const lb=pm.selection,Ivt=[],Mvt=i=>{const{disabled:t,disableFullscreenMode:e,element:n,fragmentId:r,widgetMgr:o}=i,{libConfig:s}=Re.useContext(SF),l=PF(),{expanded:c,expand:y,collapse:_}=qB(QB),{createTooltip:C,data:I,deck:k,hasActiveSelection:z,height:V,isSelectionModeActivated:X,onViewStateChange:H,selectionMode:$,setSelection:Y,viewState:ct,width:rt}=Pvt({element:n,fragmentId:r,isLightTheme:KB(l),theme:l,widgetMgr:o}),nt=n.mapboxToken||s.mapboxToken,Ot=k.mapProvider=="mapbox"||k?.mapStyle&&k.mapStyle?.indexOf("mapbox")>=0,[Kt,ft]=Re.useState(!1);Re.useEffect(()=>{ft(!0)},[]);const st=Re.useCallback(K=>{if($===void 0)return;const{index:dt,object:Tt}=K,ue=`${K.layer?.id||null}`,Rt=I,Ft=dt===-1,Gt=(()=>{if(Ft)return lb;switch($){case iC.SelectionMode.SINGLE_OBJECT:return Rt.selection.indices[ue]?.[0]===dt?lb:{indices:{[`${ue}`]:[dt]},objects:{[`${ue}`]:[Tt]}};case iC.SelectionMode.MULTI_OBJECT:{const se=new Map((Rt?.selection?.indices?.[ue]||[]).map((le,de)=>[le,Rt.selection?.objects?.[ue]?.[de]]));if(se.has(dt)?se.delete(dt):se.set(dt,Tt),se.size===0){const{[ue]:le,...de}=Rt.selection.indices,{[ue]:ye,...Oe}=Rt.selection.objects;return{indices:de,objects:Oe}}return{indices:{...Rt.selection.indices,[`${ue}`]:Array.from(se.keys())},objects:{...Rt.selection.objects,[`${ue}`]:Array.from(se.values())}}}default:throw IF($),new Error("Invalid selection mode")}})();JSON.stringify(Gt)!==JSON.stringify(Rt.selection)&&Y({fromUi:!0,value:{selection:Gt}})},[$,I,Y]),Ut=Re.useCallback(()=>{Y({value:{selection:lb},fromUi:!0})},[Y]);return $l.jsxs(DP,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",height:V,children:[Ot?$l.jsx(qit,{}):null,$l.jsx(FF,{isFullScreen:c,disableFullscreenMode:e,onExpand:y,onCollapse:_,target:DP,locked:z&&!t?!0:void 0,children:z&&!t&&$l.jsx(NF,{label:"Clear selection",onClick:Ut,icon:kF})}),ct&&$l.jsxs(sY,{viewState:ct,onViewStateChange:H,height:V,width:rt,layers:Kt?k.layers:Ivt,getTooltip:C,ContextProvider:yf.Provider,controller:!0,onClick:X&&!t?st:void 0,children:[$l.jsx(nc,{height:V,width:rt,mapStyle:k.mapStyle&&(typeof k.mapStyle=="string"?k.mapStyle:k.mapStyle[0]),mapboxApiAccessToken:nt}),$l.jsx(Kit,{children:$l.jsx(jit,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})},Bvt=OF(Mvt),zvt=Re.memo(Bvt);export{zvt as default};
